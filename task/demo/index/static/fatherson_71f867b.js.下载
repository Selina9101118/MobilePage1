define("poidetail:widget/ui/fatherson/fatherson.js",function(require,exports,module){var constant=require("common:widget/ui/constant/Constant.js"),style=".poidetail-widget-fatherson{padding:0 10px;line-height:40px}.poidetail-widget-fatherson .poidetail-widget-fatherson-list{border-bottom:1px dashed #eee;overflow:hidden}.poidetail-widget-fatherson .poidetail-widget-fatherson-list:last-child{border-bottom:0}.poidetail-widget-fatherson .poidetail-widget-fatherson-list li{color:#666;cursor:pointer;text-align:center;float:left;box-sizing:border-box;width:33%;position:relative;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.poidetail-widget-fatherson .poidetail-widget-fatherson-list li:hover{text-decoration:underline}.poidetail-widget-fatherson .poidetail-widget-fatherson-list li:after{content:'';width:1px;height:20px;background:#eee;position:absolute;right:0;top:10px}.poidetail-widget-fatherson .poidetail-widget-fatherson-list li:nth-of-type(3):after{display:none}";require.loadCss({content:style,name:"fatherson"});var ico=new BMap.Icon(constant.A_J_MARKER_IMG_NEW,new BMap.Size(22,34),{imageOffset:new BMap.Size(-200,-189),offset:new BMap.Size(11,34),infoWindowOffset:new BMap.Size(13,1),srcSet:constant.A_J_MARKER_IMG_NEW2X_SRCSET}),highlightIco=new BMap.Icon(constant.A_J_MARKER_IMG_NEW,new BMap.Size(22,34),{imageOffset:new BMap.Size(-200,-225),offset:new BMap.Size(11,34),infoWindowOffset:new BMap.Size(13,1),srcSet:constant.A_J_MARKER_IMG_NEW2X_SRCSET});module.exports=Widget.extend({render:function(data){try{if(this.data=this.processData(data),this.data){var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="poidetail-widget-fatherson bottom-split">    <div class="title">        <span class="icon" style="background-color:#839bc2;">',"undefined"==typeof title.substr(0,1)?"":baidu.template._encodeHTML(title.substr(0,1)),'</span>        <span class="caption">',"undefined"==typeof title?"":baidu.template._encodeHTML(title),"</span>    </div>    ");for(var i=0;i<Math.ceil(contents.length/3);i++){_template_fun_array.push('    <ul class="poidetail-widget-fatherson-list">        ');for(var j=3*i;j<Math.min(3*i+3,contents.length);j++){_template_fun_array.push("        ");var item=contents[j],nameArray=item.name.split("-");_template_fun_array.push('        <li title="',"undefined"==typeof item.name?"":baidu.template._encodeHTML(item.name),'" data-index="',"undefined"==typeof j?"":baidu.template._encodeHTML(j),'">',"undefined"==typeof nameArray[nameArray.length-1]?"":baidu.template._encodeHTML(nameArray[nameArray.length-1]),"</li>        ")}_template_fun_array.push("    </ul>    ")}_template_fun_array.push("</div>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],html=template(this.data);return html}return""}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"poidetail:widget/ui/fatherson/fatherson.js",ln:40})}},renderMarker:function(e,t){try{var i=this;t.childMarkers=[],e.contents.forEach(function(e,a){var n=new BMap.Marker(new BMap.Point(e.x,e.y),{icon:ico});n.unhighlightMarker=function(){n.setIcon(ico)},t.childMarkers.push(n),map.addOverlay(n),n.addEventListener("mouseover",function(){n.setIcon(highlightIco)}),n.addEventListener("mouseout",function(){n.selected||n.setIcon(ico)}),n.addEventListener("click",function(){i.sonClick(t,a),addStat("poidetail.fatherson.marker","click")})})}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"poidetail:widget/ui/fatherson/fatherson.js",ln:67})}},sonClick:function(e,t){var i=e.childMarkers[t];e.foldCard(!0),e.childMarkers.forEach(function(e){e.selected=!1,e.setIcon(ico)}),i.selected=!0,i.setIcon(highlightIco);var a=require("poidetail:widget/libs/poiDetailMgr/poiDetailMgr.js");a.create({uid:this.data.contents[t].son_uid},{withMarker:!0,marker:i}).then(function(e){i.openSimpleInfoWindow(e.poiDetailCard.infoWindow)}),a.preMainCard=e},processData:function(e){if(e&&e.content&&e.content.ext&&e.content.ext.detail_info&&e.content.ext.detail_info.detail_cloud_control&&e.content.ext.detail_info.detail_cloud_control.list)for(var t=e.content.ext.detail_info.detail_cloud_control.list,i=0;i<t.length;i++)if("father_son"===t[i].detail_type)return t[i];return null},renderComplete:function(e,t){try{addStat("poidetail.fatherson.view","show");var i=this;this.data&&this.renderMarker(this.data,t),e.find(".poidetail-widget-fatherson-list li").bind("mouseenter",function(e){e.stopPropagation();var i=this.getAttribute("data-index");t.childMarkers[i].setIcon(highlightIco)}),e.find(".poidetail-widget-fatherson-list li").bind("mouseleave",function(e){e.stopPropagation();var i=this.getAttribute("data-index"),a=t.childMarkers[i];a.selected||a.setIcon(ico)}),e.find(".poidetail-widget-fatherson-list li").bind("click",function(e){e.stopPropagation();var a=this.getAttribute("data-index");i.sonClick(t,a),addStat("poidetail.fatherson.item","click")})}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"poidetail:widget/ui/fatherson/fatherson.js",ln:140})}},name:"fatherson"})});