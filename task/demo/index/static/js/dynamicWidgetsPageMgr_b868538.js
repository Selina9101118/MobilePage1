define("common:widget/com/dynamicWidgetsPageMgr.js",function(e,t,n){function r(e){T.lang.Class.call(this),this.opts=e||{},this._listener={},this.resources=[],this.widgetIndex=0,this.widgetContainerIndex=0}T.inherits(r,T.lang.Class,"DynamicWidgetsPageMgr"),T.extend(r.prototype,{setOpts:function(e){e=e||{},this.opts=T.extend(this.opts,e)},createContainer:function(e,t){t=t||"",this.container=T("<div></div>"),this.container.addClass(t)},analysisResource:function(e,t,n){t=t||this.container,n=n||this;for(var r in e){var i=e[r],a=i.wrapClass||"";if(i.children){var s=n.getWidgetContainerIndex(),d=T('<div class="dynamic-widget-container-'+s+'"></div>');arguments.callee(i.children,d,n)}else{var s=n.getWidgetIndex(),d=T('<div class="dynamic-widget-'+s+'"></div>'),o={};o.js=i.js,o.data=i.data,o.index=s,n.resources.push(o)}d.addClass(a),t.append(d)}},getWidgetIndex:function(){return this.widgetIndex++},getWidgetContainerIndex:function(){return this.widgetContainerIndex++},buildPage:function(t){var n=this,r=this.opts.widgets,i=[],a=[],s=["render"],d=n.opts.pageData||{},o=n.opts.containerClass||"";n.createContainer(r,o),n.analysisResource(r);for(var c=0,g=n.resources.length;g>c;c++){var l=n.resources[c];i.push(l.js),a.push(l.data||{})}var u=baidu.dom.q("customerHead");if(u.length&&window.lastUid&&d.content.uid===window.lastUid)return void n.trigger("endLoading");try{e.async(i,function(){n.trigger("resourceReady");for(var e=0,r=arguments.length;r>e;e++){var i=arguments[e],o=new i;if(!n.implementCheck(o,s)){var c="Widget must implement functions ["+s.join(",")+"]";throw new Error(c)}var g=T.object.clone(d),l=T.extend(g,a[e]);if(o.setPageData(l),"figure"!==o.name)if("comment"!==o.name){var u=o.render(l),h=n.container.find(".dynamic-widget-"+e);h.append(T(u)),o.renderComplete&&o.renderComplete(h,t)}else var m=T.object.clone(o),p=l,f=e;else var v=T.object.clone(o),w=l,C=e}n.trigger("renderComplete");var y=d.content.ext.src_name,x=d.content.uid,j={ugc_type:"3",ugc_ver:"1",qt:"detailUgcInfo",industry:y,uid:x,t:(new Date).getTime()};T.ajax("/",{method:"GET",data:j,timeout:3e3,dataType:"json",success:function(e){var r=T.extend(w,e);if(v){v.setPageData(r);var i=v.render(r),a=n.container.find(".dynamic-widget-"+C);a.append(T(i)),v.renderComplete&&v.renderComplete(a,t)}if(m){var r=T.extend(p,e.comments);m.setPageData(r);var i=m.render(r),a=n.container.find(".dynamic-widget-"+f);a.append(T(i)),m.renderComplete&&m.renderComplete(a,t)}window.lastUid=x},error:function(){}})})}catch(h){throw new Error(h)}},getPageDom:function(){return this.container},implementCheck:function(e,t){for(var n=t.length-1;n>=0;n--)if(!e[t[n]])return!1;return!0},addEventListener:function(e,t){this._listener[e]=this._listener[e]||[],this._listener[e].push(t)},trigger:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();if(this._listener[t])for(var n=this._listener[t].length-1;n>=0;n--)try{this._listener[t][n].apply(this,e)}catch(r){throw new Error(r)}}}),n.exports=r});