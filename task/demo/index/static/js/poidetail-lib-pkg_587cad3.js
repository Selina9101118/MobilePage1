define("poidetail:widget/libs/poiDetailCard/poiDetailCard.js",function(i,e,a){function t(i){i=i||{},i.padding=0,i.monopolize=!0,i.overflow="hidden",n.call(this,i),this.uid=i.uid,this.name=i.name,this.geo=i.geo,this.cardLevel=2,this.canNotFold=!0,this.returnTitle="返回“"+this.name+"”的详情",this.recordUrl="poi:"+this.uid,i.withMarker&&(this.pBindMarkerAndBubble(i.marker),this.withMarker=i.marker)}var n=i("common:widget/ui/card/Card.js"),o=i("common:widget/ui/card/cardMgr.js"),r=i("common:widget/ui/searchBox/searchBox.js"),d=i("common:widget/ui/util/util.js"),s=i("common:widget/ui/mapUtil/mapUtil.js"),h=i("common:widget/ui/constant/Constant.js"),l={common:{image:h.A_J_MARKER_IMG_NEW,size:new BMap.Size(25,40),offset:h.A_J_MARKER_RED_OFFSET,imageOffset:new BMap.Size(0,-193),infoWindowOffset:h.A_J_MARKER_INFOWND_OFFSET,imageSize:new BMap.Size(h.A_J_MARKER_IMG_NEW_WIDTH,h.A_J_MARKER_IMG_NEW_HEIGHT),srcSet:h.A_J_MARKER_IMG_NEW2X_SRCSET},highlight:{image:h.A_J_MARKER_IMG_NEW,size:new BMap.Size(25,40),offset:h.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(0,-233),infoWindowOffset:h.A_J_MARKER_INFOWND_OFFSET,imageSize:new BMap.Size(h.A_J_MARKER_IMG_NEW_WIDTH,h.A_J_MARKER_IMG_NEW_HEIGHT),srcSet:h.A_J_MARKER_IMG_NEW2X_SRCSET},clicked:{image:h.A_J_MARKER_IMG_NEW,size:new BMap.Size(25,40),offset:h.A_J_MARKER_BLUE_OFFSET,imageOffset:new BMap.Size(0,-233),infoWindowOffset:h.A_J_MARKER_INFOWND_OFFSET,imageSize:new BMap.Size(h.A_J_MARKER_IMG_NEW_WIDTH,h.A_J_MARKER_IMG_NEW_HEIGHT),srcSet:h.A_J_MARKER_IMG_NEW2X_SRCSET}};T.inherits(t,n,"PoiDetailCard"),T.extend(t.prototype,{render:function(){try{}catch(i){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"poidetail:widget/libs/poiDetailCard/poiDetailCard.js",ln:76})}},onResize:function(i){function e(){var i=$(".poidetail-container").find(".generalHead-left-header"),e=$(".poidetail-container").find(".generalHead-right-header"),a=$(".poidetail-container").find(".generalHead-padding");i.removeClass("animation-heightrelease").addClass("animation-heightadd"),e.removeClass("animation-heightrelease").addClass("animation-heightadd"),a.removeClass("animation-paddingrelease").addClass("animation-paddingadd"),$(".poidetail-container").find(".generalHead-right-route").removeClass("animation-route-button-hide").addClass("animation-route-button-show"),$(".generalHead-left-header-aoitag").removeClass("animation-route-aoitag-hide").addClass("animation-aoitag-show"),$(".generalHead-left-header-visit").removeClass("animation-visittag-hide").addClass("animation-visittag-show")}function a(){var i=$(".poidetail-container").find(".generalHead-left-header"),e=$(".poidetail-container").find(".generalHead-right-header"),a=$(".poidetail-container").find(".generalHead-padding");i.removeClass("animation-heightadd").addClass("animation-heightrelease"),e.removeClass("animation-heightadd").addClass("animation-heightrelease"),a.removeClass("animation-paddingadd").addClass("animation-paddingrelease"),$(".poidetail-container").find(".generalHead-right-route").removeClass("animation-route-button-show").addClass("animation-route-button-hide"),$(".generalHead-left-header-aoitag").removeClass("animation-aoitag-show").addClass("animation-aoitag-hide"),$(".generalHead-left-header-visit").removeClass("animation-visittag-show").addClass("animation-visittag-hide")}var t=this.$cardEl,n=$(".poidetail-container").find(".customerHead"),o=$(".poidetail-container").find(".customerOther");if(o.length){var r=o.height();o.css("height","auto"),o.css("overflow-y","auto"),o.css("max-height",i-n.height());var d,s=(t.height(),0),h=!0;o.off("scroll").on("scroll",function(){var i=$(this)[0].scrollTop;d=i>s?"down":"up",s=i,s>0&&"down"===d&&(h&&(a(),h=!1),r>=t.height()-45&&o.height(t.height()-45)),0===s&&"up"===d&&(h=!0,e(),setTimeout(function(){o.height(t.height()-n.height())},600))})}},initialize:function(){try{window.iFrameResize({log:!1},".hotelBookFrame")}catch(i){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"poidetail:widget/libs/poiDetailCard/poiDetailCard.js",ln:161})}},setInfoWindow:function(i){this.infoWindow=i},onFold:function(){o.removeCardFromGroup(this.cardId,"sole"),o.removeCardFromGroup(this.cardId,"result"),o.removeCardFromGroup(this.cardId,"poidetail"),this.withMarker&&!this.lockMarkerHighlight&&this.withMarker.unhighlight&&this.withMarker.unhighlight()},onUnfold:function(){o.addCardToGroup(this.cardId,"poidetail"),o.addCardToGroup(this.cardId,"sole"),o.addCardToGroup(this.cardId,"result"),r.setState("sole",{query:this.name,cardId:this.cardId}),this.childMarkers&&this.childMarkers.forEach(function(i){i.unhighlightMarker&&i.unhighlightMarker()}),this.withMarker&&this.withMarker.highlight&&this.withMarker.highlight()},pBindMarkerAndBubble:function(i){var e=d.getPointByStr(d.parseGeo(this.geo).points),a=this;if(e){var t=!1;i||(this.marker=new BMap.Marker(e,{icon:this.pCreateIcon(l.common),zIndexFixed:!0,startAnimation:"marker-raise marker-0"}),map.addOverlay(this.marker),s.setViewport([e],10),t=!0),this.name&&"string"==typeof this.name&&d.loadSearchSimpleInfo(function(i){var n=i.createCommonInfoWindow({name:a.name},{x:e.lng,y:e.lat,uid:a.uid,isFromMPC:!1});n&&(a.infoWindow=n,t&&a.pBindEvents())})}},pCreateIcon:function(i){return new BMap.Icon(i.image,i.size,{offset:i.offset,imageOffset:i.imageOffset,infoWindowOffset:i.infoWindowOffset,imageSize:i.imageSize,srcSet:i.srcSet})},pBindEvents:function(){var i=this;this.marker.addEventListener("click",function(){this.setIcon(i.pCreateIcon(l.clicked)),this.openSimpleInfoWindow(i.infoWindow),this.clicked=!0}),this.marker.addEventListener("mouseover",function(){this.clicked!==!0&&this.setIcon(i.pCreateIcon(l.highlight))}),this.marker.addEventListener("mouseout",function(){this.clicked!==!0&&this.setIcon(i.pCreateIcon(l.common))}),this.infoWindow.addEventListener("close",function(){i.marker.clicked=!1,i.marker.setIcon(i.pCreateIcon(l.common))})},unload:function(){window.temp&&window.temp.detailInfoPop&&window.temp.detailInfoPop.close(),this.infoWindow&&(this.infoWindow.close(),this.infoWindow=null),this.marker&&(map.removeOverlay(this.marker),this.marker=null),this.childMarkers&&(this.childMarkers.forEach(function(i){map.removeOverlay(i)}),this.childMarkers=null),this.dispatchEvent("unload")}}),a.exports=t});
;define("poidetail:widget/libs/poiDetailMgr/poiDetailMgr.js",function(e,t,i){var o=".poidetail-container{color:#999;font-size:12px}.poidetail-container .mt10{margin-top:10px}.poidetail-container .bottom-split{border-bottom:1px solid #e0e0e0}.poidetail-container .top-border-override{border-top:1px solid #fff;position:relative;top:-1px}.poidetail-container .text-overflow{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.poidetail-container .title{height:40px;line-height:45px;border-bottom:1px dashed #eee;position:relative}.poidetail-container .title .icon{width:21px;height:21px;display:inline-block;border-radius:50%;color:#FFF;background-color:#6cc8ef;position:absolute;left:0;top:11px;line-height:22px;text-align:center}.poidetail-container .title .caption{margin-left:25px;color:#333}.poidetail-container .title .more{position:absolute;display:block;right:0;top:15px;line-height:normal;color:#999;text-decoration:none}.poidetail-container .accept-default-image{border:0;background:url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_84736f1.png);background:-webkit-image-set(url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_84736f1.png) 1x,url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image-2x_7e65b13.png) 2x);background:-moz-image-set(url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_84736f1.png) 1x,url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image-2x_7e65b13.png) 2x);background:-o-image-set(url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_84736f1.png) 1x,url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image-2x_7e65b13.png) 2x);background:-ms-image-set(url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image_84736f1.png) 1x,url(//webmap0.bdimg.com/wolfman/static/poidetail/images/default-image-2x_7e65b13.png) 2x);background-size:cover}.poidetail-container .customerOther>div:last-child>div.bottom-split{border-bottom:0}";e.loadCss({content:o,name:"poiDetailMgr"});var a=e("common:widget/com/dynamicWidgetsPageMgr.js"),n=e("common:widget/ui/card/cardMgr.js"),r=e("poidetail:widget/libs/poiDetailCard/poiDetailCard.js"),d=e("common:widget/ui/searchBox/searchBox.js"),c=e("common:widget/ui/toast/toast.js"),s={create:function(e,t){listener.trigger("poiDeatailMagr.create"),window.testbegin=new Date,this.opts=e||{};var i=this,o=T.extend({ugc_type:"3",ugc_ver:"1",qt:"detailConInfo",t:(new Date).getTime()},e);return d.loading(),new Promise(function(e,a){T.ajax("/",{method:"GET",data:o,timeout:3e3,dataType:"json",success:function(o){i.processData(o,t,{resolve:e,reject:a})},error:function(){i.error(null,a)}})})},error:function(e,t){e=e||"当前信息加载失败，请稍后再试",c.show(e,"warning"),d.endLoading(),t(e)},processData:function(e,t,i){if(!e||!e.content)return void this.error("",i.reject);this.opts&&this.opts.isBizPoi&&(e.isBizPoi=!0);var o=e.content.indoor_pano||"";if(e.content.indoor_pano_id="",""!==o){var a=/&sid=([0-9a-z]+?)&/i.exec(o);a&&(e.content.indoor_pano_id=a[1])}e._extra_={enableComment:!0},e.content.ext=e.content.ext||{},e.content.ext.detail_info=e.content.ext.detail_info||{},e.content.ext.detail_info.groupon=e.content.ext.detail_info.groupon||[],e.content.ext.rich_info=e.content.ext.rich_info||{},e.content.ext.other_info=e.content.ext.other_info||{},e.content.ext.src_name=e.content.ext.src_name||"",e.interSource=e.interSource||"",e.hasDetailPage="ninf"===e.interSource?!0:!1;for(var n=e.content.ext.detail_info.std_tag||e.content.ext.detail_info.tag||e.content.ext.src_name||"",r=["医疗","公交","车站","地铁站","dt_stop","房地产","政府机构","洗浴按摩"],d=r.length-1;d>=0;d--){var c=new RegExp(r[d],"i");if(c.test(n)){e._extra_.enableComment=!1;break}}e.content.poiType&&1===e.content.poiType&&(e._extra_.enableComment=!1),this.distribute(e,t,i)},distribute:function(t,i,o){var a={};t.content&&t.content.ext&&(a=t.content.ext);var n,r=a.src_name||this.opts.industry||"";switch(r){case"scope":n=e("poidetail:widget/industry/scopeIndustryMgr.js");break;case"hotel":n=e("poidetail:widget/industry/hotelIndustryMgr.js");break;case"cater":n=e("poidetail:widget/industry/caterIndustryMgr.js");break;default:n=e(a.movie_forsearch&&"movie"===a.movie_forsearch.business_scope_type?"poidetail:widget/industry/movieIndustryMgr.js":"poidetail:widget/industry/lifeIndustryMgr.js")}this.buildPoiDetailPage(n,t,i,o)},buildPoiDetailPage:function(e,t,i,o){e.init(t,function(e){var c=t&&t.content&&t.content.uid,s=t&&t.content&&t.content.name,l=t&&t.content&&t.content.geo;i=i||{},i=T.extend({record:!0},i),i=T.extend(i,{uid:c,name:s,geo:l});var p=new r(i);o.resolve({poiDetailCard:p,data:t}),e.pageData=e.pageData||t,e.containerClass="poidetail-container";var g=[];g.push({js:"poidetail:widget/ui/generalHead/generalHead.js",data:t.content,wrapClass:"customerHead"}),g.push({children:e.widgets,wrapClass:"customerOther"}),e.widgets=g;var m=new a(e);m.addEventListener("renderComplete",function(){try{p.render=function(){try{if(addStat("poidetail.card.render","show"),e&&e.pageData){var t=e.pageData;t.industry&&addStat("poidetail."+t.industry+".render","show")}return m.getPageDom()}catch(i){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"poidetail:widget/libs/poiDetailMgr/poiDetailMgr.js",ln:217})}},d.endLoading(),n.add(p).then(function(){d.setState("sole",{query:s,cardId:p.cardId},{keepResult:i.record})}),n.addCardToGroup(p.cardId,"poidetail")}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"poidetail:widget/libs/poiDetailMgr/poiDetailMgr.js",ln:225})}}),m.addEventListener("endLoading",function(){d.endLoading()}),m.buildPage(p)})}};i.exports=s});
;define("poidetail:widget/libs/poiDetailUtil/poiDetailUtil.js",function(e,r,t){var n={isIE:function(e){var r=document.createElement("b");return r.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->",1===r.getElementsByTagName("i").length},len:function(e){for(var r=0,t=e.length,n=-1,i=0;t>i;i++){var n=e.charCodeAt(i);r+=n>=0&&128>=n?1:2}return r},sub:function(e,r){var t=/[^\x00-\xff]/g;if(e.replace(t,"mm").length<=r)return e;for(var n=Math.floor(r/2),i=n;i<e.length;i++)if(e.substr(0,i).replace(t,"mm").length>=r)return e.substr(0,i)+"...";return e},isEmptyobj:function(e){if(e){for(var r in e)return!1;return!0}return!0}};t.exports=n});