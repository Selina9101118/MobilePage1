define("poidetail:widget/ui/comment/comment.js",function(require,exports,module){var style=".poidetail-widget-comment{padding:0 10px}.poidetail-widget-comment .title-sticky{position:absolute;top:45px;width:342px;border-bottom:1px solid #eee;background:#fff;z-index:50}.poidetail-widget-comment .ib{display:inline-block}.poidetail-widget-comment .ml12{margin-left:12px}.poidetail-widget-comment .ml12 a{color:#999}.poidetail-widget-comment .mt2{margin-top:2px}.poidetail-widget-comment .no-comment-tip{height:62px;line-height:62px;text-align:center;border-bottom:1px dashed #eee;color:#333}.poidetail-widget-comment .comment-list li{padding:10px 0;border-bottom:1px dashed #eee}.poidetail-widget-comment .comment-list li .rating-box,.poidetail-widget-comment .comment-list li .rating{width:55px;height:11px;background:url(//webmap0.bdimg.com/wolfman/static/poidetail/images/rate_4244cd5.png) no-repeat;background-size:55px auto}.poidetail-widget-comment .comment-list li .rating-box{background-position:0 0;position:relative;top:1px}.poidetail-widget-comment .comment-list li .rating{background-position:0 -11px}.poidetail-widget-comment .comment-list li .rating-score{color:#fd7e2b;margin-left:5px;position:relative;top:1px}.poidetail-widget-comment .comment-list li .my-comment{color:#333;margin-right:6px}.poidetail-widget-comment .comment-list li .comment-detail{color:#666;line-height:20px}.poidetail-widget-comment .buttons{position:absolute;top:0;left:180px}.poidetail-widget-comment .buttons .btn{width:70px;height:24px;line-height:24px;text-align:center;border:1px solid #ddd;border-radius:2px}.poidetail-widget-comment .buttons .write-comment{background:#fd7e2b;color:#fff;border-color:#fd7e2b}.poidetail-widget-comment .buttons .upload-photo{background:#fff;color:#fd7e2b;margin-left:6px}.poidetail-widget-comment .comment-more{text-align:center;display:block;cursor:pointer;padding-bottom:12px;padding-top:12px}.poidetail-widget-comment .comment-fold{bottom:10px;text-align:center;display:none;cursor:pointer;padding-bottom:12px;padding-top:12px}.poidetail-widget-comment .comment-fold-sticky{position:absolute;bottom:0;width:342px;background:#fff;z-index:50;border-top:1px solid #eee}.poidetail-widget-comment .comment-others{display:none}.poidetail-widget-comment .comment-loading{width:100%;height:38px;background:url(//webmap1.bdimg.com/wolfman/static/poidetail/images/comment-loading_05bd277.gif) no-repeat;background-position:160px;display:none}.poidetail-widget-comment .place{display:none;height:50px;width:100%}";require.loadCss({content:style,name:"comment"}),module.exports=Widget.extend({render:function(data){try{this.currentIndex=1,this.hasMoreComments=data.comments.data.comment_num>10?!0:!1,this.canLoad=!0,data=this.processData(data);var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push(""),_extra_.enableComment){if(_template_fun_array.push('<div class="poidetail-widget-comment bottom-split"><div class="title"><span class="icon" style="background-color:#fd7e2b">评</span><span class="caption">评价</span><div class="buttons"><a href="http://map.baidu.com/ugc/remark/index?uid=',"undefined"==typeof content.uid?"":baidu.template._encodeHTML(content.uid),'" target="_blank" class="btn write-comment ib">写评论</a><a href="http://map.baidu.com/ugc/upload/index?uid=',"undefined"==typeof content.uid?"":baidu.template._encodeHTML(content.uid),'" target="_blank" class="btn upload-photo ib">传照片</a></div></div>'),commentsCombine.length){for(_template_fun_array.push('<ul class="comment-list">'),i=0,len=commentsCombine.slice(0,2).length;len>i;i++){_template_fun_array.push("");var item=commentsCombine[i];_template_fun_array.push("<li><div>"),"myComment"===item.source&&_template_fun_array.push('<span class="my-comment ib">我的评论</span>'),_template_fun_array.push(""),blockInvalidRate&&"0.0"===item.overallRating||_template_fun_array.push('<span class="rating-box ib"><span class="rating ib" style="width:',"undefined"==typeof(20*item.overallRating)?"":baidu.template._encodeHTML(20*item.overallRating),'%"></span></span><span class="rating-score ib">',"undefined"==typeof item.overallRating?"":baidu.template._encodeHTML(item.overallRating),"</span>"),_template_fun_array.push('</div><div class="comment-detail mt2">',"undefined"==typeof item.content?"":baidu.template._encodeHTML(item.content),'</div><div class="comment-info mt2"><span class="ib">',"undefined"==typeof item.userName?"":baidu.template._encodeHTML(item.userName),'</span><span class="ib ml12">',"undefined"==typeof item.date?"":baidu.template._encodeHTML(item.date),"</span>                "),item.commentUrl?_template_fun_array.push('                    <span class="ib ml12"><a target="_blank" href="',"undefined"==typeof item.commentUrl?"":baidu.template._encodeHTML(item.commentUrl),'">',"undefined"==typeof item.cnName?"":baidu.template._encodeHTML(item.cnName),"</a></span>                "):_template_fun_array.push('                    <span class="ib ml12">',"undefined"==typeof item.cnName?"":baidu.template._encodeHTML(item.cnName),"</span>                "),_template_fun_array.push("</div></li>")}for(_template_fun_array.push('</ul><ul class="comment-list comment-others">'),i=2,len=commentsCombine.length;len>i;i++){_template_fun_array.push("");var item=commentsCombine[i];_template_fun_array.push("<li><div>"),blockInvalidRate&&"0.0"===item.overallRating||_template_fun_array.push('<span class="rating-box ib"><span class="rating ib" style="width:',"undefined"==typeof(20*item.overallRating)?"":baidu.template._encodeHTML(20*item.overallRating),'%"></span></span><span class="rating-score ib">',"undefined"==typeof item.overallRating?"":baidu.template._encodeHTML(item.overallRating),"</span>"),_template_fun_array.push('</div><div class="comment-detail mt2">',"undefined"==typeof item.content?"":baidu.template._encodeHTML(item.content),'</div><div class="comment-info mt2"><span class="ib">',"undefined"==typeof item.userName?"":baidu.template._encodeHTML(item.userName),'</span><span class="ib ml12">',"undefined"==typeof item.date?"":baidu.template._encodeHTML(item.date),"</span>                "),item.commentUrl?_template_fun_array.push('                    <span class="ib ml12"><a target="_blank" href="',"undefined"==typeof item.commentUrl?"":baidu.template._encodeHTML(item.commentUrl),'">',"undefined"==typeof item.cnName?"":baidu.template._encodeHTML(item.cnName),"</a></span>                "):_template_fun_array.push('                    <span class="ib ml12">',"undefined"==typeof item.cnName?"":baidu.template._encodeHTML(item.cnName),"</span>                "),_template_fun_array.push("</div></li>")}_template_fun_array.push('</ul><div class="comment-loading"></div><div class="place"></div>'),commentsCombine.length>2&&_template_fun_array.push('<span class="comment-more">点击查看更多</span>'),_template_fun_array.push('<span class="comment-fold">点击收起</span>')}else _template_fun_array.push('<div class="no-comment-tip">这里还没人点评，快抢沙发~</div>');_template_fun_array.push("</div>")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],html=template(data);return this.uid=data.content.uid,this.industry=data.content.ext.src_name,html}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"poidetail:widget/ui/comment/comment.js",ln:28})}},processData:function(e){var t=[];if(e.myComment&&0===e.myComment.err_no&&e.myComment.result&&e.myComment.result.cmt_info.length){var a=e.myComment.result.cmt_info[0],n={};n.overallRating=a.overall_rating,n.content=a.content,n.userName=a.user_name,n.date=a.date,n.cnName=a.cn_name,n.cnName&&n.cnName.indexOf("大众点评")>-1&&(n.cnName="去大众点评查看全部",n.commentUrl=a.comment_url||""),n.source="myComment",t.push(n)}if(e.comments&&0===e.comments.err_no&&e.comments.data&&e.comments.data.comment_list.length)for(var i=0,m=e.comments.data.comment_list.length;m>i;i++){var a=e.comments.data.comment_list[i],n={};n.overallRating=a.overall_rating,n.content=a.content,n.userName=a.user_name,n.date=a.date,n.cnName=a.cn_name,n.cnName&&n.cnName.indexOf("大众点评")>-1&&(n.cnName="去大众点评查看全部",n.commentUrl=a.comment_url||""),n.source="commonComment",t.push(n)}for(var i=0,m=t.length;m>i;i++){var a=t[i];a.overallRating=parseFloat(a.overallRating),a.overallRating=a.overallRating.toFixed(1),a.content.length>80&&(a.content=a.content.substr(0,80)+"......")}return e.commentsCombine=t,e.blockInvalidRate=e.blockInvalidRate||!1,"movie"===e.industry&&(e.industry="shopping"),e},renderComplete:function(e){try{var t=this;e.find(".write-comment").bind("click",function(){addStat("poidetail.comment.write-comment","click")}),e.find(".upload-photo").bind("click",function(){addStat("poidetail.comment.upload-photos","click")}),addStat("poidetail.comment.view","show"),e.find(".comment-more").bind("click",function(){T(".comment-others").css("display","block"),T(".comment-more").hide(),T(".comment-fold").css("display","block"),t.bindCommentScroll(),T(".comment-fold").addClass("comment-fold-sticky");var e=T(".poidetail-widget-comment").parent().nextAll();e.hide(),T(".place").css("display","block"),addStat("poidetail.comment.more","click")}),e.find(".comment-fold").bind("click",function(){T(".comment-others").hide(),T(".comment-more").css("display","block"),T(".comment-fold").hide(),t.unbindCommentScroll();var a=T(".poidetail-widget-comment .title");a.removeClass("title-sticky");var n=T(".poidetail-widget-comment").parent().nextAll();n.show(),T(".place").hide(),e.resize()})}catch(a){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"poidetail:widget/ui/comment/comment.js",ln:147})}},bindCommentScroll:function(){for(var e=this,t=T(".dynamic-widget-container-0")[0],a=T(".poidetail-widget-comment").parent().nextAll(),n=T(".poidetail-widget-comment").parent().prevAll(),i=T(".poidetail-widget-comment .title"),m=0,o=0,l=a.length;l>o;o++)m+=a[o].scrollHeight;for(var d=0,o=0,l=n.length;l>o;o++)d+=n[o].scrollHeight;t.onscroll=function(){var a=t.clientHeight,n=t.scrollTop,m=t.scrollHeight,o=m-a-n;150>o&&e.hasMoreComments&&e.canLoad&&(e.canLoad=!1,T(".comment-loading").css("display","block"),e.currentIndex+=1,e.dynamicLoadComments()),n>=d&&i.addClass("title-sticky"),d>n&&i.removeClass("title-sticky"),d-n+70>=a?T(".comment-fold").hide():T(".comment-fold").css("display","block")}},unbindCommentScroll:function(){var e=T(".dynamic-widget-container-0")[0];e.onscroll=null},dynamicLoadComments:function(){var me=this,param={qt:"comments",poiId:this.uid,type:this.industry,pageIndex:me.currentIndex,pageCount:10,t:(new Date).getTime()};T.ajax("/",{method:"GET",data:param,timeout:3e3,dataType:"json",success:function(data){if(T(".comment-loading").hide(),0!==data.data.comment_list.length){var template=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';for(eval(_template_varName),_template_fun_array.push(""),i=0,len=commentsCombine.length;len>i;i++){_template_fun_array.push("");var item=commentsCombine[i];_template_fun_array.push("<li>    <div>        "),blockInvalidRate&&"0.0"===item.overallRating||_template_fun_array.push('        <span class="rating-box ib">                <span class="rating ib" style="width:',"undefined"==typeof(20*item.overallRating)?"":baidu.template._encodeHTML(20*item.overallRating),'%"></span>            </span>        <span class="rating-score ib">',"undefined"==typeof item.overallRating?"":baidu.template._encodeHTML(item.overallRating),"</span>        "),_template_fun_array.push('    </div>    <div class="comment-detail mt2">        ',"undefined"==typeof item.content?"":baidu.template._encodeHTML(item.content),'    </div>    <div class="comment-info mt2">        <span class="ib">',"undefined"==typeof item.userName?"":baidu.template._encodeHTML(item.userName),'</span>        <span class="ib ml12">',"undefined"==typeof item.date?"":baidu.template._encodeHTML(item.date),"</span>        "),item.commentUrl?_template_fun_array.push('            <span class="ib ml12"><a target="_blank" href="',"undefined"==typeof item.commentUrl?"":baidu.template._encodeHTML(item.commentUrl),'">',"undefined"==typeof item.cnName?"":baidu.template._encodeHTML(item.cnName),"</a></span>        "):_template_fun_array.push('            <span class="ib ml12">',"undefined"==typeof item.cnName?"":baidu.template._encodeHTML(item.cnName),"</span>        "),_template_fun_array.push("    </div></li>")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],tempData={};tempData.comments=data,data=me.processData(tempData);var html=template(data);T(".comment-others").append(html)}else me.hasMoreComments=!1;me.canLoad=!0},error:function(){me.canLoad=!0}})},name:"comment"})});