!function(t,e){"use strict";t.returnExports=e()}(this,function(){var t,e=Array,r=e.prototype,n=Object,o=n.prototype,i=Function.prototype,a=String,u=a.prototype,l=Number,c=l.prototype,f=r.slice,s=r.splice,p=r.push,h=r.unshift,g=r.concat,y=i.call,d=Math.max,v=Math.min,m=o.toString,w="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,b=Function.prototype.toString,T=function(t){try{return b.call(t),!0}catch(e){return!1}},x="[object Function]",O="[object GeneratorFunction]";t=function(t){if("function"!=typeof t)return!1;if(w)return T(t);var e=m.call(t);return e===x||e===O};var S,j=RegExp.prototype.exec,E=function(t){try{return j.call(t),!0}catch(e){return!1}},I="[object RegExp]";S=function(t){return"object"!=typeof t?!1:w?E(t):m.call(t)===I};var D,k=String.prototype.valueOf,M=function(t){try{return k.call(t),!0}catch(e){return!1}},N="[object String]";D=function(t){return"string"==typeof t?!0:"object"!=typeof t?!1:w?M(t):m.call(t)===N};var F=function(t){var e,r=n.defineProperty&&function(){try{var t={};n.defineProperty(t,"x",{enumerable:!1,value:t});for(var e in t)return!1;return t.x===t}catch(r){return!1}}();return e=r?function(t,e,r,o){!o&&e in t||n.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!0,value:r})}:function(t,e,r,n){!n&&e in t||(t[e]=r)},function(r,n,o){for(var i in n)t.call(n,i)&&e(r,i,n[i],o)}}(o.hasOwnProperty),R=function(t){var e=typeof t;return null===t||"object"!==e&&"function"!==e},$={ToInteger:function(t){var e=+t;return e!==e?e=0:0!==e&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e},ToPrimitive:function(e){var r,n,o;if(R(e))return e;if(n=e.valueOf,t(n)&&(r=n.call(e),R(r)))return r;if(o=e.toString,t(o)&&(r=o.call(e),R(r)))return r;throw new TypeError},ToObject:function(t){if(null==t)throw new TypeError("can't convert "+t+" to object");return n(t)},ToUint32:function(t){return t>>>0}},A=function(){};F(i,{bind:function(e){var r=this;if(!t(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var o,i=f.call(arguments,1),a=function(){if(this instanceof o){var t=r.apply(this,g.call(i,f.call(arguments)));return n(t)===t?t:this}return r.apply(e,g.call(i,f.call(arguments)))},u=d(0,r.length-i.length),l=[],c=0;u>c;c++)p.call(l,"$"+c);return o=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this, arguments); }")(a),r.prototype&&(A.prototype=r.prototype,o.prototype=new A,A.prototype=null),o}});var U=y.bind(o.hasOwnProperty),C=y.bind(o.toString),P=y.bind(u.slice),Z=y.bind(u.split),J=e.isArray||function(t){return"[object Array]"===C(t)},z=1!==[].unshift(0);F(r,{unshift:function(){return h.apply(this,arguments),this.length}},z),F(e,{isArray:J});var B=n("a"),G="a"!==B[0]||!(0 in B),H=function(t){var e=!0,r=!0;return t&&(t.call("foo",function(t,r,n){"object"!=typeof n&&(e=!1)}),t.call([1],function(){"use strict";r="string"==typeof this},"x")),!!t&&e&&r};F(r,{forEach:function(e){var r,n=$.ToObject(this),o=G&&D(this)?Z(this,""):n,i=-1,a=o.length>>>0;if(arguments.length>1&&(r=arguments[1]),!t(e))throw new TypeError("Array.prototype.forEach callback must be a function");for(;++i<a;)i in o&&("undefined"!=typeof r?e.call(r,o[i],i,n):e(o[i],i,n))}},!H(r.forEach)),F(r,{map:function(r){var n,o=$.ToObject(this),i=G&&D(this)?Z(this,""):o,a=i.length>>>0,u=e(a);if(arguments.length>1&&(n=arguments[1]),!t(r))throw new TypeError("Array.prototype.map callback must be a function");for(var l=0;a>l;l++)l in i&&(u[l]="undefined"!=typeof n?r.call(n,i[l],l,o):r(i[l],l,o));return u}},!H(r.map)),F(r,{filter:function(e){var r,n,o=$.ToObject(this),i=G&&D(this)?Z(this,""):o,a=i.length>>>0,u=[];if(arguments.length>1&&(n=arguments[1]),!t(e))throw new TypeError("Array.prototype.filter callback must be a function");for(var l=0;a>l;l++)l in i&&(r=i[l],("undefined"==typeof n?e(r,l,o):e.call(n,r,l,o))&&p.call(u,r));return u}},!H(r.filter)),F(r,{every:function(e){var r,n=$.ToObject(this),o=G&&D(this)?Z(this,""):n,i=o.length>>>0;if(arguments.length>1&&(r=arguments[1]),!t(e))throw new TypeError("Array.prototype.every callback must be a function");for(var a=0;i>a;a++)if(a in o&&!("undefined"==typeof r?e(o[a],a,n):e.call(r,o[a],a,n)))return!1;return!0}},!H(r.every)),F(r,{some:function(e){var r,n=$.ToObject(this),o=G&&D(this)?Z(this,""):n,i=o.length>>>0;if(arguments.length>1&&(r=arguments[1]),!t(e))throw new TypeError("Array.prototype.some callback must be a function");for(var a=0;i>a;a++)if(a in o&&("undefined"==typeof r?e(o[a],a,n):e.call(r,o[a],a,n)))return!0;return!1}},!H(r.some));var L=!1;r.reduce&&(L="object"==typeof r.reduce.call("es5",function(t,e,r,n){return n})),F(r,{reduce:function(e){var r=$.ToObject(this),n=G&&D(this)?Z(this,""):r,o=n.length>>>0;if(!t(e))throw new TypeError("Array.prototype.reduce callback must be a function");if(0===o&&1===arguments.length)throw new TypeError("reduce of empty array with no initial value");var i,a=0;if(arguments.length>=2)i=arguments[1];else for(;;){if(a in n){i=n[a++];break}if(++a>=o)throw new TypeError("reduce of empty array with no initial value")}for(;o>a;a++)a in n&&(i=e(i,n[a],a,r));return i}},!L);var X=!1;r.reduceRight&&(X="object"==typeof r.reduceRight.call("es5",function(t,e,r,n){return n})),F(r,{reduceRight:function(e){var r=$.ToObject(this),n=G&&D(this)?Z(this,""):r,o=n.length>>>0;if(!t(e))throw new TypeError("Array.prototype.reduceRight callback must be a function");if(0===o&&1===arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var i,a=o-1;if(arguments.length>=2)i=arguments[1];else for(;;){if(a in n){i=n[a--];break}if(--a<0)throw new TypeError("reduceRight of empty array with no initial value")}if(0>a)return i;do a in n&&(i=e(i,n[a],a,r));while(a--);return i}},!X);var Y=r.indexOf&&-1!==[0,1].indexOf(1,2);F(r,{indexOf:function(t){var e=G&&D(this)?Z(this,""):$.ToObject(this),r=e.length>>>0;if(0===r)return-1;var n=0;for(arguments.length>1&&(n=$.ToInteger(arguments[1])),n=n>=0?n:d(0,r+n);r>n;n++)if(n in e&&e[n]===t)return n;return-1}},Y);var q=r.lastIndexOf&&-1!==[0,1].lastIndexOf(0,-3);F(r,{lastIndexOf:function(t){var e=G&&D(this)?Z(this,""):$.ToObject(this),r=e.length>>>0;if(0===r)return-1;var n=r-1;for(arguments.length>1&&(n=v(n,$.ToInteger(arguments[1]))),n=n>=0?n:r-Math.abs(n);n>=0;n--)if(n in e&&t===e[n])return n;return-1}},q);var K=function(){var t=[1,2],e=t.splice();return 2===t.length&&J(e)&&0===e.length}();F(r,{splice:function(){return 0===arguments.length?[]:s.apply(this,arguments)}},!K);var Q=function(){var t={};return r.splice.call(t,0,0,1),1===t.length}();F(r,{splice:function(t,e){if(0===arguments.length)return[];var r=arguments;return this.length=d($.ToInteger(this.length),0),arguments.length>0&&"number"!=typeof e&&(r=f.call(arguments),r.length<2?p.call(r,this.length-t):r[1]=$.ToInteger(e)),s.apply(this,r)}},!Q);var V=function(){var t=new e(1e5);return t[8]="x",t.splice(1,1),7===t.indexOf("x")}(),W=function(){var t=256,e=[];return e[t]="a",e.splice(t+1,0,"b"),"a"===e[t]}();F(r,{splice:function(t,e){for(var r,n=$.ToObject(this),o=[],i=$.ToUint32(n.length),u=$.ToInteger(t),l=0>u?d(i+u,0):v(u,i),c=v(d($.ToInteger(e),0),i-l),s=0;c>s;)r=a(l+s),U(n,r)&&(o[s]=n[r]),s+=1;var p,h=f.call(arguments,2),g=h.length;if(c>g){for(s=l;i-c>s;)r=a(s+c),p=a(s+g),U(n,r)?n[p]=n[r]:delete n[p],s+=1;for(s=i;s>i-c+g;)delete n[s-1],s-=1}else if(g>c)for(s=i-c;s>l;)r=a(s+c-1),p=a(s+g-1),U(n,r)?n[p]=n[r]:delete n[p],s-=1;s=l;for(var y=0;y<h.length;++y)n[s]=h[y],s+=1;return n.length=i-c+g,o}},!V||!W);var _=!{toString:null}.propertyIsEnumerable("toString"),te=function(){}.propertyIsEnumerable("prototype"),ee=!U("x","0"),re=function(t){var e=t.constructor;return e&&e.prototype===t},ne={$window:!0,$console:!0,$parent:!0,$self:!0,$frames:!0,$frameElement:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0},oe=function(){if("undefined"==typeof window)return!1;for(var t in window)try{!ne["$"+t]&&U(window,t)&&null!==window[t]&&"object"==typeof window[t]&&re(window[t])}catch(e){return!0}return!1}(),ie=function(t){if("undefined"==typeof window||!oe)return re(t);try{return re(t)}catch(e){return!1}},ae=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],ue=ae.length,le=function(t){return"[object Arguments]"===C(t)},ce=function(e){return null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&!J(e)&&t(e.callee)},fe=le(arguments)?le:ce;F(n,{keys:function(e){var r=t(e),n=fe(e),o=null!==e&&"object"==typeof e,i=o&&D(e);if(!o&&!r&&!n)throw new TypeError("Object.keys called on a non-object");var u=[],l=te&&r;if(i&&ee||n)for(var c=0;c<e.length;++c)p.call(u,a(c));if(!n)for(var f in e)l&&"prototype"===f||!U(e,f)||p.call(u,a(f));if(_)for(var s=ie(e),h=0;ue>h;h++){var g=ae[h];s&&"constructor"===g||!U(e,g)||p.call(u,g)}return u}});var se=n.keys&&function(){return 2===n.keys(arguments).length}(1,2),pe=n.keys&&function(){var t=n.keys(arguments);return 1!==arguments.length||1!==t.length||1!==t[0]}(1),he=n.keys;F(n,{keys:function(t){return he(fe(t)?f.call(t):t)}},!se||pe);var ge=-621987552e5,ye="-000001",de=Date.prototype.toISOString&&-1===new Date(ge).toISOString().indexOf(ye),ve=Date.prototype.toISOString&&"1969-12-31T23:59:59.999Z"!==new Date(-1).toISOString();F(Date.prototype,{toISOString:function(){var t,e,r,n,o;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");for(n=this.getUTCFullYear(),o=this.getUTCMonth(),n+=Math.floor(o/12),o=(o%12+12)%12,t=[o+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],n=(0>n?"-":n>9999?"+":"")+P("00000"+Math.abs(n),n>=0&&9999>=n?-4:-6),e=t.length;e--;)r=t[e],10>r&&(t[e]="0"+r);return n+"-"+f.call(t,0,2).join("-")+"T"+f.call(t,2).join(":")+"."+P("000"+this.getUTCMilliseconds(),-3)+"Z"}},de||ve);var me=function(){try{return Date.prototype.toJSON&&null===new Date(0/0).toJSON()&&-1!==new Date(ge).toJSON().indexOf(ye)&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(t){return!1}}();me||(Date.prototype.toJSON=function(){var e=n(this),r=$.ToPrimitive(e);if("number"==typeof r&&!isFinite(r))return null;var o=e.toISOString;if(!t(o))throw new TypeError("toISOString property is not callable");return o.call(e)});var we=1e15===Date.parse("+033658-09-27T01:46:40.000Z"),be=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z")),Te=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));(Te||be||!we)&&(Date=function(t){var e=function(r,n,o,i,u,l,c){var f,s=arguments.length;return f=this instanceof t?1===s&&a(r)===r?new t(e.parse(r)):s>=7?new t(r,n,o,i,u,l,c):s>=6?new t(r,n,o,i,u,l):s>=5?new t(r,n,o,i,u):s>=4?new t(r,n,o,i):s>=3?new t(r,n,o):s>=2?new t(r,n):s>=1?new t(r):new t:t.apply(this,arguments),R(f)||F(f,{constructor:e},!0),f},r=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),n=[0,31,59,90,120,151,181,212,243,273,304,334,365],o=function(t,e){var r=e>1?1:0;return n[e]+Math.floor((t-1969+r)/4)-Math.floor((t-1901+r)/100)+Math.floor((t-1601+r)/400)+365*(t-1970)},i=function(e){return l(new t(1970,0,1,0,0,0,e))};for(var u in t)U(t,u)&&(e[u]=t[u]);F(e,{now:t.now,UTC:t.UTC},!0),e.prototype=t.prototype,F(e.prototype,{constructor:e},!0);var c=function(e){var n=r.exec(e);if(n){var a,u=l(n[1]),c=l(n[2]||1)-1,f=l(n[3]||1)-1,s=l(n[4]||0),p=l(n[5]||0),h=l(n[6]||0),g=Math.floor(1e3*l(n[7]||0)),y=Boolean(n[4]&&!n[8]),d="-"===n[9]?1:-1,v=l(n[10]||0),m=l(n[11]||0);return(p>0||h>0||g>0?24:25)>s&&60>p&&60>h&&1e3>g&&c>-1&&12>c&&24>v&&60>m&&f>-1&&f<o(u,c+1)-o(u,c)&&(a=60*(24*(o(u,c)+f)+s+v*d),a=1e3*(60*(a+p+m*d)+h)+g,y&&(a=i(a)),a>=-864e13&&864e13>=a)?a:0/0}return t.parse.apply(this,arguments)};return F(e,{parse:c}),e}(Date)),Date.now||(Date.now=function(){return(new Date).getTime()});var xe=c.toFixed&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==0xde0b6b3a7640080.toFixed(0)),Oe={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function(t,e){for(var r=-1,n=e;++r<Oe.size;)n+=t*Oe.data[r],Oe.data[r]=n%Oe.base,n=Math.floor(n/Oe.base)},divide:function(t){for(var e=Oe.size,r=0;--e>=0;)r+=Oe.data[e],Oe.data[e]=Math.floor(r/t),r=r%t*Oe.base},numToString:function(){for(var t=Oe.size,e="";--t>=0;)if(""!==e||0===t||0!==Oe.data[t]){var r=a(Oe.data[t]);""===e?e=r:e+=P("0000000",0,7-r.length)+r}return e},pow:function $e(t,e,r){return 0===e?r:e%2===1?$e(t,e-1,r*t):$e(t*t,e/2,r)},log:function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}};F(c,{toFixed:function(t){var e,r,n,o,i,u,c,f;if(e=l(t),e=e!==e?0:Math.floor(e),0>e||e>20)throw new RangeError("Number.toFixed called with invalid number of decimals");if(r=l(this),r!==r)return"NaN";if(-1e21>=r||r>=1e21)return a(r);if(n="",0>r&&(n="-",r=-r),o="0",r>1e-21)if(i=Oe.log(r*Oe.pow(2,69,1))-69,u=0>i?r*Oe.pow(2,-i,1):r/Oe.pow(2,i,1),u*=4503599627370496,i=52-i,i>0){for(Oe.multiply(0,u),c=e;c>=7;)Oe.multiply(1e7,0),c-=7;for(Oe.multiply(Oe.pow(10,c,1),0),c=i-1;c>=23;)Oe.divide(1<<23),c-=23;Oe.divide(1<<c),Oe.multiply(1,1),Oe.divide(2),o=Oe.numToString()}else Oe.multiply(0,u),Oe.multiply(1<<-i,0),o=Oe.numToString()+P("0.00000000000000000000",2,2+e);return e>0?(f=o.length,o=e>=f?n+P("0.0000000000000000000",0,e-f+2)+o:n+P(o,0,f-e)+"."+P(o,f-e)):o=n+o,o}},xe),2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?!function(){var t="undefined"==typeof/()??/.exec("")[1];u.split=function(e,r){var n=this;if("undefined"==typeof e&&0===r)return[];if(!S(e))return Z(this,e,r);var o,i,a,u,l=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),s=0,h=new RegExp(e.source,c+"g");n+="",t||(o=new RegExp("^"+h.source+"$(?!\\s)",c));var g="undefined"==typeof r?-1>>>0:$.ToUint32(r);for(i=h.exec(n);i&&(a=i.index+i[0].length,!(a>s&&(p.call(l,P(n,s,i.index)),!t&&i.length>1&&i[0].replace(o,function(){for(var t=1;t<arguments.length-2;t++)"undefined"==typeof arguments[t]&&(i[t]=void 0)}),i.length>1&&i.index<n.length&&p.apply(l,f.call(i,1)),u=i[0].length,s=a,l.length>=g)));)h.lastIndex===i.index&&h.lastIndex++,i=h.exec(n);return s===n.length?(u||!h.test(""))&&p.call(l,""):p.call(l,P(n,s)),l.length>g?P(l,0,g):l}}():"0".split(void 0,0).length&&(u.split=function(t,e){return"undefined"==typeof t&&0===e?[]:Z(this,t,e)});var Se=u.replace,je=function(){var t=[];return"x".replace(/x(.)?/g,function(e,r){p.call(t,r)}),1===t.length&&"undefined"==typeof t[0]}();je||(u.replace=function(e,r){var n=t(r),o=S(e)&&/\)[*?]/.test(e.source);if(n&&o){var i=function(t){var n=arguments.length,o=e.lastIndex;e.lastIndex=0;var i=e.exec(t)||[];return e.lastIndex=o,p.call(i,arguments[n-2],arguments[n-1]),r.apply(this,i)};return Se.call(this,e,i)}return Se.call(this,e,r)});var Ee=u.substr,Ie="".substr&&"b"!=="0b".substr(-1);F(u,{substr:function(t,e){var r=t;return 0>t&&(r=d(this.length+t,0)),Ee.call(this,r,e)}},Ie);var De="	\n\f\r   ᠎             　\u2028\u2029﻿",ke="​",Me="["+De+"]",Ne=new RegExp("^"+Me+Me+"*"),Fe=new RegExp(Me+Me+"*$"),Re=u.trim&&(De.trim()||!ke.trim());F(u,{trim:function(){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");return a(this).replace(Ne,"").replace(Fe,"")}},Re),(8!==parseInt(De+"08")||22!==parseInt(De+"0x16"))&&(parseInt=function(t){var e=/^0[xX]/;return function(r,n){var o=a(r).trim(),i=l(n)||(e.test(o)?16:10);return t(o,i)}}(parseInt))});
;(function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function n(t){return"function"==typeof t}function e(t){return"object"==typeof t&&null!==t}function r(t){U=t}function o(t){G=t}function i(){return function(){process.nextTick(f)}}function u(){return function(){N(f)}}function s(){var t=0,n=new Q(f),e=document.createTextNode("");return n.observe(e,{characterData:!0}),function(){e.data=t=++t%2}}function c(){var t=new MessageChannel;return t.port1.onmessage=f,function(){t.port2.postMessage(0)}}function a(){return function(){setTimeout(f,1)}}function f(){for(var t=0;B>t;t+=2){var n=X[t],e=X[t+1];n(e),X[t]=void 0,X[t+1]=void 0}B=0}function l(){try{var t=require,n=t("vertx");return N=n.runOnLoop||n.runOnContext,u()}catch(e){return a()}}function p(){}function _(){return new TypeError("You cannot resolve a promise with itself")}function h(){return new TypeError("A promises callback cannot return that same promise.")}function v(t){try{return t.then}catch(n){return nn.error=n,nn}}function d(t,n,e,r){try{t.call(n,e,r)}catch(o){return o}}function y(t,n,e){G(function(t){var r=!1,o=d(e,n,function(e){r||(r=!0,n!==e?g(t,e):A(t,e))},function(n){r||(r=!0,E(t,n))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,E(t,o))},t)}function m(t,n){n._state===$?A(t,n._result):n._state===tn?E(t,n._result):j(n,void 0,function(n){g(t,n)},function(n){E(t,n)})}function b(t,e){if(e.constructor===t.constructor)m(t,e);else{var r=v(e);r===nn?E(t,nn.error):void 0===r?A(t,e):n(r)?y(t,e,r):A(t,e)}}function g(n,e){n===e?E(n,_()):t(e)?b(n,e):A(n,e)}function w(t){t._onerror&&t._onerror(t._result),S(t)}function A(t,n){t._state===Z&&(t._result=n,t._state=$,0!==t._subscribers.length&&G(S,t))}function E(t,n){t._state===Z&&(t._state=tn,t._result=n,G(w,t))}function j(t,n,e,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=n,o[i+$]=e,o[i+tn]=r,0===i&&t._state&&G(S,t)}function S(t){var n=t._subscribers,e=t._state;if(0!==n.length){for(var r,o,i=t._result,u=0;u<n.length;u+=3)r=n[u],o=n[u+e],r?x(e,r,o,i):o(i);t._subscribers.length=0}}function T(){this.error=null}function P(t,n){try{return t(n)}catch(e){return en.error=e,en}}function x(t,e,r,o){var i,u,s,c,a=n(r);if(a){if(i=P(r,o),i===en?(c=!0,u=i.error,i=null):s=!0,e===i)return void E(e,h())}else i=o,s=!0;e._state!==Z||(a&&s?g(e,i):c?E(e,u):t===$?A(e,i):t===tn&&E(e,i))}function C(t,n){try{n(function(n){g(t,n)},function(n){E(t,n)})}catch(e){E(t,e)}}function M(t,n){var e=this;e._instanceConstructor=t,e.promise=new t(p),e._validateInput(n)?(e._input=n,e.length=n.length,e._remaining=n.length,e._init(),0===e.length?A(e.promise,e._result):(e.length=e.length||0,e._enumerate(),0===e._remaining&&A(e.promise,e._result))):E(e.promise,e._validationError())}function O(t){return new rn(this,t).promise}function k(t){function n(t){g(o,t)}function e(t){E(o,t)}var r=this,o=new r(p);if(!z(t))return E(o,new TypeError("You must pass an array to race.")),o;for(var i=t.length,u=0;o._state===Z&&i>u;u++)j(r.resolve(t[u]),void 0,n,e);return o}function Y(t){var n=this;if(t&&"object"==typeof t&&t.constructor===n)return t;var e=new n(p);return g(e,t),e}function q(t){var n=this,e=new n(p);return E(e,t),e}function F(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function I(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function D(t){this._id=an++,this._state=void 0,this._result=void 0,this._subscribers=[],p!==t&&(n(t)||F(),this instanceof D||I(),C(this,t))}function K(){var t;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(n){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;(!e||"[object Promise]"!==Object.prototype.toString.call(e.resolve())||e.cast)&&(t.Promise=fn)}var L;L=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var N,U,W,z=L,B=0,G=({}.toString,function(t,n){X[B]=t,X[B+1]=n,B+=2,2===B&&(U?U(f):W())}),H="undefined"!=typeof window?window:void 0,J=H||{},Q=J.MutationObserver||J.WebKitMutationObserver,R="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),V="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,X=new Array(1e3);W=R?i():Q?s():V?c():void 0===H&&"function"==typeof require?l():a();var Z=void 0,$=1,tn=2,nn=new T,en=new T;M.prototype._validateInput=function(t){return z(t)},M.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},M.prototype._init=function(){this._result=new Array(this.length)};var rn=M;M.prototype._enumerate=function(){for(var t=this,n=t.length,e=t.promise,r=t._input,o=0;e._state===Z&&n>o;o++)t._eachEntry(r[o],o)},M.prototype._eachEntry=function(t,n){var r=this,o=r._instanceConstructor;e(t)?t.constructor===o&&t._state!==Z?(t._onerror=null,r._settledAt(t._state,n,t._result)):r._willSettleAt(o.resolve(t),n):(r._remaining--,r._result[n]=t)},M.prototype._settledAt=function(t,n,e){var r=this,o=r.promise;o._state===Z&&(r._remaining--,t===tn?E(o,e):r._result[n]=e),0===r._remaining&&A(o,r._result)},M.prototype._willSettleAt=function(t,n){var e=this;j(t,void 0,function(t){e._settledAt($,n,t)},function(t){e._settledAt(tn,n,t)})};var on=O,un=k,sn=Y,cn=q,an=0,fn=D;D.all=on,D.race=un,D.resolve=sn,D.reject=cn,D._setScheduler=r,D._setAsap=o,D._asap=G,D.prototype={constructor:D,then:function(t,n){var e=this,r=e._state;if(r===$&&!t||r===tn&&!n)return this;var o=new this.constructor(p),i=e._result;if(r){var u=arguments[r-1];G(function(){x(r,o,u,i)})}else j(e,o,t,n);return o},"catch":function(t){return this.then(null,t)}};var ln=K,pn={Promise:fn,polyfill:ln};"function"==typeof define&&define.amd?define(function(){return pn}):"undefined"!=typeof module&&module.exports?module.exports=pn:"undefined"!=typeof this&&(this.ES6Promise=pn),ln()}).call(this);
;!function(){if(!window.FeatureStyle){var t="20171031",e="001";"undefined"!=typeof MSV&&MSV.mapstyle&&(t=MSV.mapstyle.updateDate,e=MSV.mapstyle.version);var i="udt="+t+"&v="+e,n="//mapor0.bdimg.com/sty/";document.write('<script type="text/javascript" src="'+n+"icons_pl.js?"+i+'"></script>'),document.write('<script type="text/javascript" src="'+n+"icons_pl2_0.js?"+i+'"></script>'),document.write('<script type="text/javascript" src="'+n+"vpl.js?"+i+'"></script>')}}(),function(){function dg(t,e){this._size=t,this._cache=[],this._totalGetTimes=0,this._totalHitTimes=0,this._options={clearCallback:null,removeOldCallback:null},e=e||{};for(var i in e)e.hasOwnProperty(i)&&(this._options[i]=e[i])}function S(){}function bE(t,e){if("string"==typeof t&&(t=document.getElementById(t)),co.call(this),this.container=t,this.width=t.clientWidth,this.height=t.clientHeight,this.offsetX=0,this.offsetY=0,this._setStyle(t),t.unselectable="on",t.innerHTML="",t.appendChild(this.render()),this._initDate=new Date,this.platform=t.children[0],this.maskLayer=this.platform.children[0],this._panes={},this.centerPoint=null,this.zoomLevel=0,this._heading=0,this._tilt=0,this._bounds=new ca,this.lastLevel=0,this._lock=!1,this._enableTiltZoom=7,this._enableHeadingZoom=7,this.defaultZoomLevel=null,this.defaultCenter=null,this.currentOperation=cc.idle,this._setConfig(e),this._initMapRenderType(),this._animationInfo={},this._animationInfoUnstopable={},this._displayOptions={showText:!0,showOverlay:!0,showLayers:!0},this.suspendLoad=!1,"webgl"===this._renderType&&(this.benchmark=new K,this._setupWebGLMap(),this.deviceInfo={hardwareInfo:{renderer:"",vendor:""},platformInfo:window.detect.parse(navigator.userAgent)},av.ifSupportWebGL._renderer&&(this.deviceInfo.hardwareInfo.renderer=av.ifSupportWebGL._renderer,this.deviceInfo.hardwareInfo.vendor=av.ifSupportWebGL._vendor)),a6[this.config.mapType]||(this.config.mapType=BMAP_NORMAL_MAP),this.config.mapType!==BMAP_EARTH_MAP||this.config.enableEarth||this.forceEnableEarth()===!1&&(this.config.mapType=BMAP_NORMAL_MAP),this.mapType=this.config.mapType,this.preMapType=null,this.config.enableEarth){var i=this.maskLayer.style;i.opacity=0,i.background="#000",setTimeout(function(){i.WebkitTransition=i.transition="opacity .6s"},100)}this._isHybridShow=!0,this.temp={operating:!1,arrow:0,lastDomMoveTime:0,lastLoadTileTime:0,lastMovingTime:0,canKeyboard:!1,I:function(t){return v.I(t)},curSpots:[],curSpotsArray:[],curAreaSpot:null,spotsGuid:1,registerIndex:-1,hoverOnSpot:null,isStdCtrlBusy:!1},"webgl"===this._renderType?(WorkerMgr.init(this),v.extend(this,bD.prototype),this.jobScheduler=new dh(this)):v.extend(this,S.prototype),window.InstanceCore=this.temp.I,this.platform.style.cursor=this.config.defaultCursor,this._bind();for(var n=0;n<d5._register.length;n++)d5._register[n](this);this.temp.registerIndex=n;var a=this;"webgl"===this._renderType?cl.load("oppcgl",function(){a._asyncRegister()}):cl.load("oppc",function(){a._asyncRegister()}),t=null}function aV(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}function m(t){var e={duration:1e3,fps:30,delay:0,transition:bh.linear,dropLastAnimation:!1};if(t)for(var i in t)e[i]=t[i];if(t.beginTime&&(this._beginTime=t.beginTime),this._callbacks=[],this._options=e,e.delay){var n=this;setTimeout(function(){n._doStart()},e.delay)}else this._doStart()}function cl(){}function K(){this._timeData={}}function dA(t){this._elemType=t,this._counter=0,this._objCollection={}}function bV(t){return t=t.toLowerCase(),M.indexOf(t)>=0?!0:t.indexOf("mobile")>=0?!0:!1}function db(t){t=t.toLowerCase();for(var e=0;e<bg.length;e++)if(t.indexOf(bg[e])>=0)return!0;return!1}function ce(t){return t?bV(t)?!1:db(t)?!0:!1:!1}function cN(t,e){this._size=t,this._curSize=0,this._cache={},this._least=null,this._most=null,this._options={clearCallback:null,removeOldCallback:null},e=e||{};for(var i in e)this._options[i]=e[i];this._getDataTimes=0,this._hitTimes=0}function au(){this._map=null,this._container,this._type="control",this.blockInfoWindow=!0,this._visible=!0}function b3(t){au.call(this),t=t||{},this._opts={printable:!1},v.extend(this._opts,t),this._copyrightCollection=[],this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT,this.defaultOffset=new ck(5,2),this.setAnchor(t.anchor),this._canShow=!0,this.sateMapStyle=!1,this.blockInfoWindow=!1,this._asyncLoadCode()}function d2(t){au.call(this),t=t||{},this._opts={printable:!1},this._opts=v.extend(v.extend(this._opts,{unit:"metric"}),t),this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT,this.defaultOffset=new ck(81,18),this.setAnchor(t.anchor),this._units={metric:{name:"metric",conv:1,incon:1e3,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5280,u1:"英尺",u2:"英里"}},this.sateMapStyle=!1,this._units[this._opts.unit]||(this._opts.unit="metric"),this._scaleText=null,this._numberArray={},this._asyncLoadCode()}function bT(t){au.call(this),t=t||{},this._opts={printable:!1},v.extend(this._opts,t),this.controlHeight=[{width:65,height:227,zoomHeight:227,zoomWidth:37,sliderHeight:180},{width:65,height:47,zoomHeight:this._opts.forceNew===!0?56:47,zoomWidth:37,sliderHeight:0},{width:37,height:57,zoomHeight:0,zoomWidth:0,sliderHeight:0},{width:26,height:47,zoomHeight:47,zoomWidth:6,sliderHeight:0},{width:56,height:47,zoomHeight:47,zoomWidth:37,sliderHeight:180}],this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT,this.defaultOffset=new ck(10,10),this.setAnchor(t.anchor),this.setType(t.type),this._maxTotalZoomLv=19,this._minZoomLevel=-1,this._maxZoomLevel=-1,this._totalZoomLv=-1,this._sliderInterval=10,this._sliderHeight=180,this._minBarY=1,this._maxBarY=-1,this._curBarY=-1,this._zoomDom=null,this._zoomBtnDom=null,this._sliderDom=null,this._sliderBaseDom=null,this._cZIndex="1100",this._asyncLoadCode()}function aL(t){au.call(this),t=t||{},this._opts={printable:!1},this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT,this.defaultOffset=new ck(10,10),this.setAnchor(t.anchor),this._opts=v.extend(v.extend(this._opts,{offset:this.defaultOffset,enableSwitch:!0}),t);var e=this;cl.load("control",function(){e._asyncDraw()})}function dI(t,e){this._map=t,this._indoorInfo=e,this._visible=!0,this._adjustVisible=!0,this._init()}function cK(t){this._map=t,t._navigationCtrl=this,this._firstAnimation=!0,this._init()}function ef(t,e){this._map=t,this._target=t;var i=t.temp.originMapType||t.mapType;"B_EARTH_MAP"===i&&t._earth&&(this._target=t._earth),this._outContainer=e||t.getContainer(),this._imgRatio=ar()>=1.5?2:1,this._imgPath=cR.imgPath+"earth-navi-control-pc4"+(2===this._imgRatio?"-2x.png":".png"),this._enabled=!0;var n=this;this._setHeadingOptions={callback:function(){n._target.setLock(!1)}},this._init()}function cv(t,e){this._map=t,this._target=t;var i=t.temp.originMapType||t.mapType;"B_EARTH_MAP"===i&&t._earth&&(this._target=t._earth),this._outContainer=e||t.getContainer(),this._imgRatio=ar()>=1.5?2:1,this._imgPath=cR.imgPath+"gl-navi-control-pc4"+(2===this._imgRatio?"-2x.png":".png"),this._enabled=!0;var n=this;this._setTiltOptions={callback:function(){n._target.setLock(!1)}},this._init()}function bb(t){co.call(this),this._opts={container:null,cursor:"default"},this._opts=v.extend(this._opts,t),this._type="contextmenu",this._map=null,this._container,this._left=0,this._top=0,this._items=[],this._rItems=[],this._dividers=[],this._enable=!0,this.curPixel=null,this.curPoint=null,this._isOpen=!1;var e=this;cl.load("menu",function(){e._draw()})}function c8(t,e,i){if(t&&e&&"function"==typeof e){co.call(this),this._opts={width:100,id:""},i=i||{},this._opts.width=1*i.width?i.width:100,this._opts.id=i.id?i.id:"",this._text=t+"",this._callback=e,this._map=null,this._type="menuitem",this._contextmenu=null,this._container=null,this._enabled=!0;var n=this;cl.load("menu",function(){n._draw()})}}function ca(t,e,i,n){this.setValues(t,e,i,n)}function d8(t,e){isNaN(t)&&(t=dX(t),t=isNaN(t)?0:t),"string"==typeof t&&(t=parseFloat(t)),isNaN(e)&&(e=dX(e),e=isNaN(e)?0:e),"string"==typeof e&&(e=parseFloat(e)),this.lng=t,this.lat=e}function ct(){}function bB(t,e){for(-90>t?t=-90:t>90&&(t=90);-180>e;)e+=360;for(;e>180;)e-=360;this.lat=t||0,this.lng=e||0}function cA(t,e){t&&!e&&(e=t),this._sw=this._ne=null,this._swLng=this._swLat=null,this._neLng=this._neLat=null,t&&(this._sw=new bB(t.lat,t.lng),this._ne=new bB(e.lat,e.lng),this._swLng=t.lng,this._swLat=t.lat,this._neLng=e.lng,this._neLat=e.lat)}function aB(){this._type="overlay"}function bt(){v.BaseClass.call(this),aB.call(this),this._visible=!0,this._visibleInternal=!0,this.infoWindow=null,this._dblclickTime=0}function cM(t){this.map=t,this._overlays={},this._overlayArray=[],this._customOverlays=[],t._overlays=this._overlays,t._overlayArray=this._overlayArray,t._customOverlays=this._customOverlays,this._zoomingOrMoving=!1,this._init()}function q(t){bt.call(this),this._config={strokeColor:"#3a6bdb",strokeWeight:5,strokeOpacity:.65,strokeStyle:"solid",strokeLineCap:"round",strokeLineJoin:"round",enableMassClear:!0,getParseTolerance:null,getParseCacheIndex:null,enableParse:!0,enableEditing:!1,mouseOverTolerance:15},this.setConfig(t),this._config.strokeWeight<=0&&(this._config.strokeWeight=5),(this._config.strokeOpacity<0||this._config.strokeOpacity>1)&&(this._config.strokeOpacity=.65),(this._config.fillOpacity<0||this._config.fillOpacity>1)&&(this._config.fillOpacity=.65),"solid"!=this._config.strokeStyle&&"dashed"!=this._config.strokeStyle&&"dotted"!=this._config.strokeStyle&&(this._config.strokeStyle="solid"),this.domElement=null,this._bounds=new d5.Bounds(0,0,0,0),this._parseCache=[],this._parseCacheGL=[],this._parseCacheGLRaw=[],this._areaCacheGL=[],this._strokeStyleInfoForGL=[[]],this._fillStyleInfoForGL="",this.vertexMarkers=[],this._temp={}}function d0(t,e,i){if(t&&e){this.imageUrl=t,this.size=e;var n=new ck(Math.floor(e.width/2),Math.floor(e.height/2)),a={offset:n,imageOffset:new ck(0,0)};i=i||{};for(var o in i)typeof a[o]==typeof i[o]&&(a[o]=i[o]);this.offset=a.offset,this.imageOffset=a.imageOffset,this.infoWindowOffset=i.infoWindowOffset||this.offset,this.printImageUrl=i.printImageUrl||"",this.imageSize=i.imageSize,this.srcSetObject={},this.setImageSrcset(i.srcSet)}}function T(t,e){v.BaseClass.call(this),this.content=t,this.map=null,this._config={width:0,height:0,maxWidth:600,offset:new ck(0,0),title:"",maxContent:"",enableMaximize:!1,enableAutoPan:!0,enableCloseOnClick:!0,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:!1,onClosing:function(){return!0}},this.setConfig(e),0!=this._config.width&&(this._config.width<220&&(this._config.width=220),this._config.width>730&&(this._config.width=730)),0!=this._config.height&&(this._config.height<60&&(this._config.height=60),this._config.height>650&&(this._config.height=650)),0!=this._config.maxWidth&&(this._config.maxWidth<220&&(this._config.maxWidth=220),this._config.maxWidth>730&&(this._config.maxWidth=730)),this.isWinMax=!1,this.IMG_PATH=cR.imgPath,this.overlay=null;var i=this;cl.load("infowindow",function(){i._draw()})}function ac(t,e){bt.call(this),this.content=t,this.map=null,this.domElement=null,this._config={width:0,offset:new ck(0,0),styles:{backgroundColor:"#fff",border:"1px solid #f00",padding:"1px",whiteSpace:"nowrap",fontSize:"12px",zIndex:"80",MozUserSelect:"none"},point:null,enableMassClear:!0},e=e||{},this.setConfig(e),this._config.width<0&&(this._config.width=0),this.point=this._config.point;var i=this;cl.load("marker",function(){i._draw()})}function bS(t,e){bt.call(this),e=e||{},this.point=t,this.latLng=ct.convertMC2LL(t),this.map=null,this._animation=null,this.domElement=null,this.iconDom=null,this.infoWindowDom=null,this.siblingElement=null,this.textureCoord=null,this.textureCoordGLMap=null,this._config={offset:new ck(0,0),opacity:1,icon:null,title:"",infoWindow:null,label:null,baseZIndex:0,clickable:!0,zIndexFixed:!1,isTop:!1,enableMassClear:!0,enableDragging:!1,raiseOnDrag:!1,restrictDraggingArea:!1,startAnimation:""},this.setConfig(e),e.icon||(this._config.icon=new d5.Icon(cR.imgPath+"marker_red.png",new ck(23,25),{offset:new ck(10,25),infoWindowOffset:new ck(10,0)})),this._isDragging=!1;var i=this;cl.load("marker",function(){i._draw()})}function a(t,e){q.call(this,e),this.setPoints(t);var i=this;cl.load("poly",function(){i._draw()})}function c2(t,e){q.call(this,e),this.setPoints(t);var i=this;cl.load("poly",function(){i._draw()})}function ah(t,e){q.call(this,e),e=e||{},this._config.fillOpacity="number"==typeof e.fillOpacity?e.fillOpacity:.65,dc(this._config.fillOpacity,0,1),this._config.fillColor=""==e.fillColor?"":e.fillColor?e.fillColor:"#fff",this._parseFillCacheWebGL=[],this.setPoints(t);var i=this;cl.load("poly",function(){i._draw()})}function du(t,e,i){this.point=t,this.radius=Math.abs(e),ah.call(this,[],i)}function eg(t,e){v.BaseClass.call(this),this.content=t,this.map=null,this._config={width:0,height:0,maxWidth:600,offset:new ck(0,0),title:"",maxContent:"",enableMaximize:!1,enableAutoPan:!0,enableCloseOnClick:!0,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:!1,onClosing:function(){return!0}},this.setConfig(e),this._config.width<50&&(this._config.width=50),this._config.width>730&&(this._config.width=730),0!=this._config.height&&(this._config.height<50&&(this._config.height=50),this._config.height>650&&(this._config.height=650)),0!==this._config.maxWidth&&(this._config.maxWidth<50&&(this._config.maxWidth=50),this._config.maxWidth>730&&(this._config.maxWidth=730)),this.isWinMax=!1,this.IMG_PATH=cR.imgPath,this.overlay=null;var i=this;cl.load("simpleInfowindow",function(){i._draw()})}function cs(t,e){t=isNaN(t)?0:t,e=isNaN(e)?0:e,this.x=t,this.y=e}function ck(t,e){this.width=parseFloat(t)||0,this.height=parseFloat(e)||0}function aW(t,e,i,n,a){this.mgr=t,this.position=i,this._cbks=[],this.name=t.getTileName(n,a),this.info=n,this._transparentPng=a.isTransparentPng();var o=F("img");bP(o),o.galleryImg=!1;var r=o.style;r.position="absolute",r.width=t.tileSize+"px",r.height=t.tileSize+"px",r.left=i[0]+"px",r.top=i[1]+"px",this.img=o,this.src=e,J&&0===i._offsetX&&(r.opacity=0,r.willChange="opacity");var s=this;this.img.onload=function(t){if(s.mgr){var e=s.mgr,n=e.bufferTiles;e.bufferNumber>0&&(n[s.name]=s,n.push(s.name));for(var o=n.length-e.bufferNumber,r=0;o>0&&r<n.length;r++){var l=n[r];if(!e.mapTiles[l]){if(n[l]){n[l].mgr=null;var h=n[l].img;h.parentNode&&(c4(h),h.parentNode.removeChild(h)),h=null,n[l].img=null,n[l]=null,delete n[l]}n.splice(r,1),r--,o--}}if(s.loaded=!0,e.imgNumber++,!d1(s.img)&&a.tilesDiv&&(a.tilesDiv.appendChild(s.img),FeBrowser.ie<=6&&FeBrowser.ie>0&&1==a.isTransparentPng())){var c=s.img.style,d=c.width,u=c.height,p='position:absolute;FILTER: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+s.src+'",sizingMethod=scale);';c.cssText=p,c.width=d,c.height=u,c.left=s.position[0]+"px",c.top=s.position[1]+"px"}var t=new aw("onimagechange");t.action="show",t.tile=s.name,e.map.dispatchEvent(t),J&&0===i._offsetX&&new m({fps:10,duration:300,render:function(t){s.img&&s.img.style&&(s.img.style.opacity=1*t)},finish:function(){s.img&&s.img.style&&(delete s.img.style.opacity,s.img.style.willChange="auto")}}),s._callCbks()}},this.img.onerror=function(){if(s.error=!0,s._callCbks(),s.mgr){var t=(s.mgr,a6[a.mapType]);t.errorUrl&&(s.img.src=t.errorUrl),d1(s.img)||a.tilesDiv&&a.tilesDiv.appendChild(s.img)}},o=null;var l=new aw("onimagebefore");l.tile=s.name,t.map.dispatchEvent(l)}function cX(t){this.tileLayers=[],this.map=t,this.bufferNumber=300,this.mapTiles=[],this.bufferTiles=[],this.config=a6[this.map.mapType],this.errorUrl=this.config.errorUrl,this.tileSize=this.config.tileSize,this.baseUnits=this.config.baseUnits,this.baseZoomLevel=this.config.zoomLevelBase,this.tileURLs=this.config.tileUrls,this.imgNumber=0,this.numLoading=0,this.temp={}}function bs(t){this.opts=t||{},this.copyright=this.opts.copyright||{},this.transparentPng=this.opts.transparentPng||!1,this.png8=this.opts.png8||!1,this.baseLayer=this.opts.baseLayer||!1,this.dataType=this.opts.dataType||1,this.offset=[0,0],this._type="tilelayer",this.cacheSize=this.opts.cacheSize||256;var e=this;this.tileCache=new cN(this.cacheSize,{clearCallback:function(t){e._removeIndoorData(t)}}),this.scaler=ar()>=1.5?2:1,this.normalUdt="20171031",window.TVC&&window.TVC.ditu&&window.TVC.ditu.normal&&(this.normalUdt=TVC.ditu.normal.updateDate),this.numLoading=0,this.customLayer="boolean"==typeof this.opts.customLayer?this.opts.customLayer:!0}function bC(t,e,i){this.bounds=t,this.content=e,this.mapType=i}function O(t){this._map=t,this._tileMgr=t.tileMgr,this._animationDiv=null,this._preAnimationDiv=null,this._animation=null,this._baseLayerDiv=null,this._transformStyleName=av.ifSupportCSS3("transform",!0),this._transformOriginStyleName=av.ifSupportCSS3("transformOrigin",!0),this._preZoomTimes=1,this._preRenderTick=1,this._enableCanvas2dMap=!("canvas"!==t.getRenderType()),this._isIE9=!(9!==v.Browser.ie);var e=this;t.addEventListener("maptypechange",function(){e.hide()}),t.addEventListener("load",function(){e.hide()})}function b(t){this._initVars(t),this._initColorCanvas(),this._bindEvent(t)}function cn(t){this._initVars(t)}function N(t){this._map=t,this._initCanvas(),this._initVars(),this._bindEvent()}function ao(t){this._canvas2dMapMgr=t;var e=this.ratio=t._map.config.ratio;this._featureStyle=null;var i="udt=20171031&v=001";"undefined"!=typeof MSV&&MSV.mapstyle&&(i="udt="+MSV.mapstyle.updateDate+"&v="+MSV.mapstyle.version),e>1?(this.iconSetInfo=window.iconSetInfo_high,this._iconSetUrl=cR.iconSetPath+"icons_pl2_0.png?"+i):(this.iconSetInfo=window.iconSetInfo,this._iconSetUrl=cR.iconSetPath+"icons_pl.png?"+i),this.sizeRatio=this.ratio>1?2:1,this._iconSetImg=null,this._iconSetImgRequested=!1,this._iconSetImgCallBacks=[],this._initColorCanvas()}function dR(t){this.initVars(t)}function bD(){}function dh(t){this._jobQueue=[],this._idleOnlyJobQueue=[];var e=this;this.isIdle=!0,t.on("updateframe",function(t){var i=12-t.frameTime;i=1>i?1:i,e.isIdle=!1,e.idleWorkTimer&&(clearInterval(e.idleWorkTimer),e.idleWorkTimer=null),e.runJobs(i)}),this._idleWorkerTicker=function(t){return function(){t.isIdle&&(t.runJobs(),t.runIdleOnlyJobs())}}(this),t.on("mapglidle",function(){e.isIdle=!0,e.runJobs(),e.runIdleOnlyJobs(),e.idleWorkTimer=setInterval(e._idleWorkerTicker,dh.MAX_IDLE_TIME)})}function bO(t,e){this.map=t.map,this.layer=t,e=e||[],this.allLabels=[],this.wordSpaceRatio=ar(),this.ratio=ar(),this.ratio>1?(this.iconSetInfo=window.iconSetInfo_high,this.textSizeRatio=2):(this.iconSetInfo=window.iconSetInfo,this.textSizeRatio=1);var i=this.iconSetInfo.iconSetSize;this.iconSetWidth=i[0],this.iconSetHeight=i[1],this._strategyInfo=null,this.RANK1=1e6,this.RANK2=2e6,this.RANK3=3e6,this.RANK4=4e6,this.RANK5=5e6,this._useRound=!0,this._mapIsMoving=!1,this._onMapIdleCallback=e.onMapIdleCallback,this.map.temp.isPermitSpotOver=!0,this.currentSelectedLabel=null,this.map._labelProcessor=this,this.fixedLabelData=[],this.lineLabelData=[],this.highlightLabelData=[],this.bind()}function cb(t){this.tileLayers=[],this.map=t;var e=this.config=a6[this.map.mapType];this.errorUrl=e.errorUrl,this.tileSize=e.tileSize,this.baseUnits=e.baseUnits,this.baseZoomLevel=e.zoomLevelBase,this.tileURLs=e.tileUrls,this.loadDelay=10}function ak(t){this._indoorData={},this._map=t,this.currentUid=null,this.currentFloor=null,this._indoorControl=null,this.enterMethod=null,this.showMask=!1,this._init(t),window._indoorMgr=this}function dq(t){co.call(this),t&&(this._opts={},this._map=t)}function dQ(t,e){dq.call(this,t),e=e||{},this._opts=v.extend(v.extend(this._opts||{},{autoClear:!1,tips:"测距",followText:"单击确定起点，双击结束绘制",unit:"metric",showResult:!0,lineColor:"blue",lineStroke:2,opacity:1,lineStyle:"solid",cursor:cR.imgPath+"ruler.cur",styleCodes:{lnCode:0,spCode:0,slCode:0,tlCode:0},enableMassClear:!0}),e),0==this._opts.showResult&&("undefined"==typeof e.tips&&(this._opts.tips="绘制折线"),e.cursor||(this._opts.cursor="crosshair")),this._opts.lineStroke<=0&&(lineStroke=2),this._opts.opacity>1?this._opts.opacity=1:this._opts.opacity<0&&(this._opts.opacity=0),"solid"!=this._opts.lineStyle&&"dashed"!=this._opts.lineStyle&&(this._opts.lineStyle="solid"),this._checked=!1,this._drawing=null,this.followTitle=null,this._totalDis={},this._points=[],this._paths=[],this._dots=[],this._segDistance=[],this._overlays=[],this._units={metric:{name:"metric",conv:1,incon:1e3,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5279.856,u1:"英尺",u2:"英里"}},this._units[this._opts.unit]||(this._opts.unit="metric"),this._dLineColor="#ff6319",this._dLineStroke=3,this._dOpacity=.8,this._dLineStyle="solid",this._dCursor=cR.imgPath+"ruler.cur",this._opts.showResult&&(this._opts.followText="单击确定起点"),this._followTextM="单击确定地点，双击结束",this._movingTimerId=null,this.text=this._opts.showResult?"测距":"绘线",this._isOpen=!1;var i=this;cl.load("tools",function(){i._draw()})}function bH(t){return t.style}function bP(t){if(v.Browser.ie>0)t.unselectable="on",t.selectstart=function(){return!1},t.onmousedown=function(t){return t.preventDefault(),!1};else{var e=bH(t);e.MozUserSelect="none",e.WebkitUserSelect="none",t.addEventListener("mousedown",function(t){t.preventDefault()},!1)}}function d1(t){return t&&t.parentNode&&11!=t.parentNode.nodeType}function b4(t,e){return t.insertAdjacentHTML("beforeEnd",e),t.lastChild}function ed(t,e){var i=document.createElement("div");i.innerHTML=e;var n=i.childNodes[0];return t.parentNode.insertBefore(n,t)}function g(t){t=t||window.event,t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function aX(t){return t=t||window.event,t.preventDefault?t.preventDefault():t.returnValue=!1,!1}function bG(t){return g(t),aX(t)}function df(){var t=document.documentElement,e=document.body;return t&&(t.scrollTop||t.scrollLeft)?[t.scrollTop,t.scrollLeft]:e?[e.scrollTop,e.scrollLeft]:[0,0]}function c4(t){if(t){t.onload=t.onerror=null;var e,i,n,a=t.attributes;if(a)for(i=a.length,e=0;i>e;e+=1)n=a[e].name,"function"==typeof t[n]&&(t[n]=null);if(a=t.children)for(i=a.length,e=0;i>e;e+=1)c4(t.children[e])}}function aO(t,e,i){var n=e.lng-i.lng,a=e.lat-i.lat;if(0==n)return Math.abs(t.lng-e.lng);if(0==a)return Math.abs(t.lat-e.lat);var o=a/n,r=e.lat-o*e.lng;return Math.abs(o*t.lng-t.lat+r)/Math.sqrt(o*o+1)}function dU(t,e){return t&&e?Math.round(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))):void 0}function bz(t,e){var i=Math.round((t.x+e.x)/2),n=Math.round((t.y+e.y)/2);return new cs(i,n)}function d4(t,e){var i=[];e=e||function(t){return t};for(var n in t)i.push(n+"="+e(t[n]));return i.join("&")}function F(t,e,i){var n=document.createElement(t);i&&(n=document.createElementNS(i,t)),e=e||{};for(var a in e){var o={"for":"htmlFor","class":"cssClass"}[a]||a;if("style"!=a)if("class"!=a)if(n.setAttribute)n.setAttribute(o,e[a]);else try{n[o]=e[a]}catch(n){}else v.ac(n,e[a]);else n.style.cssText=e[a]}return n}function dm(t){return t.currentStyle?t.currentStyle:t.ownerDocument&&t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):void 0}function aY(t){return"function"==typeof t}function dX(t){var e,i,n,a,o,r="",s="",l="",h=0,c=/[^A-Za-z0-9\+\/\=]/g;if(!t||c.exec(t))return t;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=d6.indexOf(t.charAt(h++)),a=d6.indexOf(t.charAt(h++)),o=d6.indexOf(t.charAt(h++)),l=d6.indexOf(t.charAt(h++)),e=n<<2|a>>4,i=(15&a)<<4|o>>2,s=(3&o)<<6|l,r+=String.fromCharCode(e),64!=o&&(r+=String.fromCharCode(i)),64!=l&&(r+=String.fromCharCode(s)),e=i=s="",n=a=o=l="";while(h<t.length);return r}function ds(){return aG()||cx()}function aG(){var t=navigator.userAgent;return t.indexOf("iPhone")>-1||t.indexOf("iPad")>-1?!0:!1}function cx(){var t=navigator.userAgent;return t.indexOf("Android")>-1?!0:!1}function b5(t){return t*Math.PI/180}function bI(t){return t/Math.PI*180}function b7(t,e){var i=Math.pow(10,e);if("number"==typeof t)return Math.round(t*i)/i;for(var n=0;n<t.length;n++)t[n]=b7(t[n],e);return t}function dc(t,e,i){return e>t?t=e:t>i&&(t=i),t}function dn(t,e){for(;0>t;)t+=e;return t%e}function cj(t,e){return t>=0&&e>=0||0>t&&0>e}function aq(t){if(t._gl)return t._gl;var e={alpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,stencil:!1},i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);return t._gl=i,i}function cC(t,e){for(var i=0;i<e.length;i++)v.on(t,e[i],g)}function ek(t,e,i){e[i]=t.getUniformLocation(e,i)}function cP(t,e,i,n,a){var o="";switch(a){case"mat4":return void t.uniformMatrix4fv(e[i],!1,n);case"v3":o="uniform3fv";break;case"f":o="uniform1f";break;case"i":o="uniform1i"}if(""===o)throw"error";t[o](e[i],n)}function B(t,e){for(;0>t;)t+=360;t%=360;var i=e.width,n=e.height,a=i,o=n;if(90>t)var r=Math.sin(b5(t))*i,s=Math.sin(b5(t))*n,l=Math.cos(b5(t))*i,h=Math.cos(b5(t))*n,a=Math.ceil(l+s),o=Math.ceil(r+h);else if(180>t)var t=t-90,r=Math.sin(b5(t))*i,s=Math.sin(b5(t))*n,l=Math.cos(b5(t))*i,h=Math.cos(b5(t))*n,a=Math.ceil(r+h),o=Math.ceil(l+s);else if(270>t)var t=t-180,r=Math.sin(b5(t))*i,s=Math.sin(b5(t))*n,l=Math.cos(b5(t))*i,h=Math.cos(b5(t))*n,a=Math.ceil(l+s),o=Math.ceil(r+h);else var t=t-270,r=Math.sin(b5(t))*i,s=Math.sin(b5(t))*n,l=Math.cos(b5(t))*i,h=Math.cos(b5(t))*n,a=Math.ceil(r+h),o=Math.ceil(l+s);var c=a-i,d=o-n;return[0-c/2,0-d/2,i+c/2,n+d/2]}function dL(t){return t.toDataURL()==dL._blankData?!0:!1}function dF(t,e,i){var n=[i.lng-t.lng,i.lat-t.lat],a=[e.lng-t.lng,e.lat-t.lat];return n[0]*a[1]-n[1]*a[0]}function bd(t,e,i){var n,a,o,r;return t.lng<e.lng?(n=t.lng,o=e.lng):(n=e.lng,o=t.lng),t.lat<e.lat?(a=t.lat,r=e.lat):(a=e.lat,r=t.lat),i.lng<n||i.lng>o||i.lat<a||i.lat>r?!1:!0}function dH(t,e,i,n){var a=dF(i,n,t),o=dF(i,n,e),r=dF(t,e,i),s=dF(t,e,n);return 0>a*o&&0>r*s?!0:0===a&&bd(i,n,t)?!0:0===o&&bd(i,n,e)?!0:0===r&&bd(t,e,i)?!0:0===s&&bd(t,e,n)?!0:!1}function eb(t,e){var i=e.parentNode;i.lastChild==e?i.appendChild(t):i.insertBefore(t,e.nextSibling)}function ee(t,e){if(0==e)return t;var i=0,n=0;if(!t)throw"异常";if(0===t.length)return[];for(var a=1,o=t.length-1;o>a;a++){var r=aO(t[a],t[0],t[t.length-1]);r>i&&(n=a,i=r)}var s=[];if(i>=e){for(var l=t.slice(0,n),h=t.slice(n,t.length),c=ee(l,e),d=ee(h,e),a=0,o=c.length;o>a;a++)s.push(c[a]);for(var a=0,o=d.length;o>a;a++)s.push(d[a])}else s.push(t[0]),s.push(t[t.length-1]);return s}function cy(t){return Math.log2?Math.log2(t):Math.log(t)/Math.LN2}function aD(t,e,i){return Math.min(i,Math.max(e,t))}function br(t,e){if(!e)return t;var i=e[0],n=e[1],a=e[2],o=e[3],r=[],s=[];return r[0]=o*t[0]+a*t[2],r[1]=t[1],r[2]=-a*t[0]+o*t[2],s[0]=r[0],s[1]=n*r[1]-i*r[2],s[2]=i*r[1]+n*r[2],s}function aJ(t){var e=(t-Date.UTC(2e3,0,1,12))/864e5/36525,i=(d3.utcDay.floor(t)-t)/864e5*360-180;return[i-G(e)*x,dJ(e)*x]}function G(t){var e=dt(t),i=b6(t),n=Q(t),a=Math.tan(dr(t)/2);return a*=a,a*Math.sin(2*n)-2*e*Math.sin(i)+4*e*a*Math.sin(i)*Math.cos(2*n)-.5*a*a*Math.sin(4*n)-1.25*e*e*Math.sin(2*i)}function dJ(t){return Math.asin(Math.sin(dr(t))*Math.sin(dW(t)))}function dW(t){return ay(t)-(.00569+.00478*Math.sin((125.04-1934.136*t)*ag))*ag}function ay(t){return Q(t)+b8(t)}function b6(t){return(357.52911+t*(35999.05029-1537e-7*t))*ag}function Q(t){var e=(280.46646+t*(36000.76983+3032e-7*t))%360;return(0>e?e+360:e)/180*Math.PI}function b8(t){var e=b6(t);return(Math.sin(e)*(1.914602-t*(.004817+14e-6*t))+Math.sin(e+e)*(.019993-101e-6*t)+289e-6*Math.sin(e+e+e))*ag}function dr(t){return cW(t)+.00256*Math.cos((125.04-1934.136*t)*ag)*ag}function cW(t){return(23+(26+(21.448-t*(46.815+t*(59e-5-.001813*t)))/60)/60)*ag}function dt(t){return.016708634-t*(42037e-9+1.267e-7*t)}function ar(){return window.devicePixelRatio||1}function Y(t){var e,i,n;return t>=0?(n=65536*Math.floor(t/65536),e=n,i=t-n):(n=65536*Math.floor(-t/65536),e=-n,i=t+n),[e,i]}function z(t){return t.lng>=0&&t.lat>=0?new d8(t.lng-1e7,t.lat-6e6):t.lng>=0&&t.lat<0?new d8(t.lng-1e7,t.lat+6e6):t.lng<0&&t.lat>=0?new d8(t.lng+1e7,t.lat-6e6):t.lng<0&&t.lat<0?new d8(t.lng+1e7,t.lat+6e6):void 0}function aR(t,e,i){var n="mouseWheel";return!isNaN(t)&&(10>t||120!==t)&&e%1===0&&(n="padScroll"),v.Browser.firefox&&0===i&&(n="padScroll"),v.Browser.safari&&12===t&&(n="mouseWheel"),n}function bK(t,e){for(var i=t[0],n=t[1],a=!1,o=0,r=e.length-2;o<e.length;o+=2){var s=e[o],l=e[o+1],h=e[r],c=e[r+1],d=l>n!=c>n&&(h-s)*(n-l)/(c-l)+s>i;d&&(a=!a),r=o}return a}function bo(t,e,i,n){return n=n||.4,t>i?t=Math.pow(t-i+1,n)+i-1:e>t&&(t=e-Math.pow(e-t+1,n)+1),t}function bk(){var t=3,e=256,i=Math.pow(2,18-t)*e,n=2,a=(n+1)*i,o=ct.convertLL2MC(new d8(180,0)),r=o.lng,s=a-r,l=-3,h=l*i,c=ct.convertLL2MC(new d8(-180,0)),d=c.lng,u=d-h;this._validPixels=r/Math.pow(2,18-t),this._mc180X=r,this._mcM180X=d,this._loopOffset=s+u,this._mcTSpan=r-d,this._spaceDistance=s,this._mSpaceDistance=u}var v=v||{version:"20150702",emptyFn:function(){}};if(function(){v._log=[];var t=0,e={};v.BaseClass=function(t){e[this.hashCode=t||v.BaseClass.guid()]=this},v.BaseClass.guid=function(){return"mz_"+(t++).toString(36)},v.BaseClass.create=function(){var t=new v.BaseClass;return t.decontrol(),t};v.instance=v.I=function(t){return e[t]};v.BaseClass.prototype.dispose=function(){this.hashCode&&delete e[this.hashCode];for(var t in this)"function"!=typeof this[t]&&delete this[t]},v.BaseClass.prototype.getHashCode=function(){return this.hashCode||(e[this.hashCode=v.BaseClass.guid()]=this),this.hashCode},v.BaseClass.prototype.decontrol=function(){delete e[this.hashCode]},v.BaseClass.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},v.BaseClass.prototype._wlog=function(t,e){var i=v._log;i.length>100&&(i.reverse().length=50,i.reverse()),i[i.length]="["+t+"]["+(this._className||"Object")+" "+this.hashCode+"] "+e}}(),Function.prototype.inherits=function(t,e){var i,n,a=this.prototype,o=function(){};o.prototype=t.prototype,n=this.prototype=new o,"string"==typeof e&&(n._className=e);for(i in a)n[i]=a[i];return this.prototype.constructor=a.constructor,a=o=null,n},v.BaseEvent=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=this.srcElement=null,this.cancelBubble=!1,this.domEvent=null},v.BaseClass.prototype.on=v.BaseClass.prototype.addEventListener=function(t,e,i){if("function"!=typeof e)return this._wlog("error","addEventListener:"+e+" is not a function");this._listeners||(this._listeners={});var n,a=this._listeners;"string"==typeof i&&i&&(/[^\w\-]/.test(i)?this._wlog("warning","nonstandard key:"+i):(e.hashCode=i,n=i)),0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof a[t]&&(a[t]={}),n=n||v.BaseClass.guid(),e.hashCode=n,a[t][n]&&this._wlog("warning","repeat key:"+n),a[t][n]=e},v.BaseClass.prototype.off=v.BaseClass.prototype.removeEventListener=function(t,e){if("function"==typeof e)e=e.hashCode;else if("string"!=typeof e)return;this._listeners||(this._listeners={}),0!=t.indexOf("on")&&(t="on"+t);var i=this._listeners;i[t]&&i[t][e]&&delete i[t][e]},v.BaseClass.prototype.fire=v.BaseClass.prototype.dispatchEvent=function(t){this._listeners||(this._listeners={});var e,i=this._listeners,n=t.type;if(t.target=t.srcElement=t.target||t.srcElement||this,t.currentTarget=this,"function"==typeof this[n]&&this[n](t),"object"==typeof i[n])for(e in i[n])"function"==typeof i[n][e]&&i[n][e].call(this,t);return t.returnValue},v.BaseEvent.prototype.inherit=function(t){var e=this;return this.domEvent=t=window.event||t,e.clientX=t.clientX||t.pageX,e.clientY=t.clientY||t.pageY,e.offsetX=t.offsetX||t.layerX,e.offsetY=t.offsetY||t.layerY,e.screenX=t.screenX,e.screenY=t.screenY,e.ctrlKey=t.ctrlKey||t.metaKey,e.shiftKey=t.shiftKey,e.altKey=t.altKey,e},v.Browser=function(){var t=navigator.userAgent,e=0,i=0,n=0,a=0,o=0,r=0,s=0,l=0,h=0,c=0;"object"==typeof window.opera&&/Opera(\s|\/)(\d+(\.\d+)?)/.test(t)?n=parseFloat(RegExp.$2):/OPR(\/(\d+)(\..?)?)/.test(t)?n=parseInt(RegExp.$2,10):/Edge\/((\d+)\.\d+)/.test(t)?e=parseInt(RegExp.$2,10):/MSIE (\d+(\.\d+)?)/.test(t)?i=parseFloat(RegExp.$1):t.indexOf("Trident")>-1&&/rv:(\d+(\.\d+)?)/.test(t)?i=parseInt(RegExp.$1,10):/Firefox(\s|\/)(\d+(\.\d+)?)/.test(t)?o=parseFloat(RegExp.$2):"Netscape"===navigator.vendor&&/Netscape(\s|\/)(\d+(\.\d+)?)/.test(t)?s=parseFloat(RegExp.$2):t.indexOf("Safari")>-1&&/Version\/(\d+(\.\d+)?)/.test(t)&&(a=parseFloat(RegExp.$1)),t.indexOf("Trident")>-1&&/Trident\/(\d+(\.\d+)?)/.test(t)?l=parseInt(RegExp.$1,10):!i&&!e&&t.indexOf("Gecko")>-1&&-1===t.indexOf("KHTML")&&/rv\:(\d+(\.\d+)?)/.test(t)?h=parseFloat(RegExp.$1):!e&&/chrome\/(\d+(\.\d+)?)/i.test(t)?r=parseFloat(RegExp.$1):!e&&/AppleWebKit\/(\d+(\.\d+)?)/.test(t)&&(c=parseInt(RegExp.$1,10));
var d={edge:e,ie:i,firefox:o,netscape:s,opera:n,safari:a,chrome:r,gecko:h,trident:l,webkit:c};return d}(),window.FeBrowser=v.Browser,v.Dom={},v.Dom.createDom=function(t,e){v.isIE&&e&&e.name&&(t="<"+t+' name="'+v.String.escapeHTML(e.name)+'">');var i=document.createElement(t);return e&&v.Dom.setProperties(i,e),i},v.Dom.getOffset=function(t){var e=v.Dom.getOwnerDocument(t),i=v.isGecko>0&&e.getBoxObjectFor&&"absolute"==v.Dom.getStyle(t,"position")&&(""===t.style.top||""===t.style.left),n={left:0,top:0},a=v.isIE&&!v.isStrict?e.body:e.documentElement;if(t==a)return n;var o,r=null;if(t.getBoundingClientRect)o=t.getBoundingClientRect(),n.left=o.left+Math.max(e.documentElement.scrollLeft,e.body.scrollLeft),n.top=o.top+Math.max(e.documentElement.scrollTop,e.body.scrollTop),n.left-=e.documentElement.clientLeft,n.top-=e.documentElement.clientTop,v.isIE&&!v.isStrict&&(n.left-=2,n.top-=2);else if(e.getBoxObjectFor&&!i){o=e.getBoxObjectFor(t);var s=e.getBoxObjectFor(a);n.left=o.screenX-s.screenX,n.top=o.screenY-s.screenY}else{r=t;do{if(n.left+=r.offsetLeft,n.top+=r.offsetTop,v.isWebkit>0&&"fixed"==v.Dom.getStyle(r,"position")){n.left+=e.body.scrollLeft,n.top+=e.body.scrollTop;break}r=r.offsetParent}while(r&&r!=t);for((v.isOpera>0||v.isWebkit>0&&"absolute"==v.Dom.getStyle(t,"position"))&&(n.top-=e.body.offsetTop),r=t.offsetParent;r&&r!=e.body;)n.left-=r.scrollLeft,v.isOpera&&"TR"==r.tagName||(n.top-=r.scrollTop),r=r.offsetParent}return n},v.Dom.getOwnerDocument=function(t){return 9==t.nodeType?t:t.ownerDocument||t.document},v.Dom.setProperties=function(t,e){v.each(e,function(e,i){v.Dom._setProperty(t,i,e)})},v.Dom._setProperty=function(t,e,i){"style"==e?t.style.cssText=i:"class"==e?t.className=i:"for"==e?t.htmlFor=i:e in v.Dom._DIRECT_ATTRIBUTE_MAP?t.setAttribute(v.Dom._DIRECT_ATTRIBUTE_MAP[e],i):t[e]=i},v.Dom._DIRECT_ATTRIBUTE_MAP={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",height:"height",width:"width",usemap:"useMap",frameborder:"frameBorder"},v.G=function(){for(var t=[],e=arguments.length-1;e>-1;e--){var i=arguments[e];t[e]=null,"object"==typeof i&&i&&i.dom?t[e]=i.dom:"object"==typeof i&&i&&i.tagName||i==window||i==document?t[e]=i:"string"==typeof i&&(i=document.getElementById(i))&&(t[e]=i)}return t.length<2?t[0]:t},v.ac=function(t,e){(t=this.G(t))&&(e=this.trim(e),new RegExp("(^| )"+e.replace(/(\W)/g,"\\$1")+"( |$)").test(t.className)||(t.className=t.className.split(/\s+/).concat(e).join(" ")))},v.addClassName=v.ac,v.each=function(t,e){if("function"!=typeof e)return t;if(t)if(void 0===t.length)for(var i in t)e.call(t[i],t[i],i);else for(var n=0,a=t.length;a>n;n++)e.call(t[n],t[n],n);return t},v.extend=function(t,e){if(t&&e&&"object"==typeof e){for(var i in e)t[i]=e[i];for(var n,a=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],o=0;o<a.length;o++)n=a[o],Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},v.hide=function(){v.each(arguments,function(t){(t=v.G(t))&&(t.style.display="none")})},v.inherit=function(t,e,i){var n=t.prototype,a=function(){};a.prototype=e.prototype;var o=t.prototype=new a;"string"==typeof i&&(o._className=i);for(var r in n)o[r]=n[r];return t.prototype.constructor=n.constructor,n=null,o},v.isIE=0,function(){navigator.userAgent.indexOf("MSIE")>0&&!window.opera&&(/MSIE (\d+(\.\d+)?)/.test(navigator.userAgent),v.isIE=parseFloat(RegExp.$1))}(),v.rc=function(t,e){if(t=this.G(t)){e=this.trim(e);var i=t.className.replace(new RegExp("(^| +)"+e.replace(/(\W)/g,"\\$1")+"( +|$)","g"),"$2");t.className!=i&&(t.className=i)}},v.removeClassName=v.rc,v.show=function(){this.each(arguments,function(t){(t=v.G(t))&&(t.style.display="")})},v.trim=function(t){return t.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")},"undefined"!=typeof HTMLElement&&HTMLElement.prototype.__lookupGetter__&&!HTMLElement.prototype.__lookupGetter__("children")&&!window.opera)try{HTMLElement.prototype.__defineGetter__("children",function(){for(var t,e=[],i=0,n=0,a=this.childNodes.length;a>n;n++)t=this.childNodes[n],1==t.nodeType&&(e[i++]=t,t.name&&(e[t.name]||(e[t.name]=[]),e[t.name][e[t.name].length]=t),t.id&&(e[t.id]=t));return e})}catch(dG){}"undefined"==typeof HTMLElement||window.opera||!HTMLElement.prototype||HTMLElement.prototype.insertAdjacentHTML||(HTMLElement.prototype.insertAdjacentHTML=function(t,e){var i=this.ownerDocument.createRange();switch(i.setStartBefore(this),i=i.createContextualFragment(e),t){case"beforeBegin":this.parentNode.insertBefore(i,this);break;case"afterBegin":this.insertBefore(i,this.firstChild);break;case"beforeEnd":this.appendChild(i);break;case"afterEnd":this.nextSibling?this.parentNode.insertBefore(i,this.nextSibling):this.parentNode.appendChild(i)}}),"undefined"==typeof HTMLElement||window.opera||(HTMLElement.prototype.contains=function(t){if(t==this)return!0;for(;t=t.parentNode;)if(t==this)return!0;return!1}),v.Browser.ie||"undefined"==typeof Event||window.opera||(Event.prototype.__defineSetter__("returnValue",function(t){return t||this.preventDefault(),t}),Event.prototype.__defineSetter__("cancelBubble",function(t){return t&&this.stopPropagation(),t})),v.each=function(t,e){if(aY(e))for(var i=0,n=t.length;n>i&&e.call(t,t[i],i)!==!1;i++);return t},v.Platform={x11:0,macintosh:0,windows:0,android:0,iphone:0,ipad:0};for(var dC in v.Platform)v.Platform.hasOwnProperty(dC)&&(v.Platform[dC]=new RegExp(dC,"i").test(window.navigator.userAgent)?1:0);"undefined"==typeof v.Dom&&(v.Dom={}),v.Dom.getComputedStyle=function(t,e){var i,n=9==t.nodeType?t:t.ownerDocument||t.document;if(n.defaultView&&n.defaultView.getComputedStyle){if(i=n.defaultView.getComputedStyle(t,null))return i[e]||i.getPropertyValue(e)}else if(t.currentStyle)return t.currentStyle[e]||"";return""};var aw=v.BaseEvent,co=v.BaseClass;co.prototype.toString=function(){return this._className||""},v.on=function(t,e,i){return(t=v.G(t))?(e=e.replace(/^on/,""),t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,i),t):t},v.un=function(t,e,i){return(t=v.G(t))?(e=e.replace(/^on/,""),t.removeEventListener?t.removeEventListener(e,i,!1):t.detachEvent&&t.detachEvent("on"+e,i),t):t},v.hc=function(t,e){if(!t||!t.className||"string"!=typeof t.className)return!1;var i=-1;try{i=t.className==e||t.className.search(new RegExp("(\\s|^)"+e+"(\\s|$)"))}catch(n){return!1}return i>-1};var cL={imgPath:"//webmap0.bdimg.com/image/api/",tilePath:["//mapor0.bdimg.com","//mapor1.bdimg.com","//online2.map.bdimg.com","//online3.map.bdimg.com"],iconSetPath:"//mapor0.bdimg.com/sty/"},cR=cL;v.Browser.ie||v.Browser.edge?v.extend(cR,{distCursor:"url("+cR.imgPath+"ruler.cur),crosshair",defaultCursor:"url("+cR.imgPath+"openhand.cur),default",draggingCursor:"url("+cR.imgPath+"closedhand.cur),move"}):v.Browser.firefox?v.extend(cR,{distCursor:"url("+cR.imgPath+"ruler.cur),crosshair",defaultCursor:"-moz-grab",draggingCursor:"-moz-grabbing"}):v.Browser.chrome||v.Browser.safari?(v.extend(cR,{distCursor:"url("+cR.imgPath+"ruler.cur) 2 6,crosshair",defaultCursor:"url("+cR.imgPath+"openhand.cur) 8 8,default",draggingCursor:"url("+cR.imgPath+"closedhand.cur) 8 8,move"}),v.Platform.macintosh&&(cR.defaultCursor="-webkit-grab",cR.draggingCursor="-webkit-grabbing")):v.extend(cR,{distCursor:"url("+cR.imgPath+"ruler.cur),crosshair",defaultCursor:"url("+cR.imgPath+"openhand.cur),default",draggingCursor:"url("+cR.imgPath+"closedhand.cur),move"});var d5=d5||{version:"1.1",_register:new Array,register:function(t){this._register[this._register.length]=t}};dg.prototype.setData=function(t,e){var i=this._cache,n=this._size;0!==n&&(i.length>n&&this._removeOld(),i[t]||i.push(e),i[t]=e,e._key_=t)},dg.prototype.getHitRate=function(){return Math.round(this._totalHitTimes/this._totalGetTimes*1e3)/1e3},dg.prototype.getData=function(t){var e=this._cache[t];return e&&this._totalHitTimes++,this._totalGetTimes++,e},dg.prototype.removeData=function(t){this._options.clearCallback&&this._options.clearCallback(this._cache[t]);for(var e=this._cache,i=e[t],n=0,a=e.length;a>n;n++)if(e[n]===i){e.splice(n,1);break}delete e[t]},dg.prototype._removeOld=function(){for(var t=this._cache,e=Math.round(.6*this._size),i=0;e>i;i++){var n=t[i]._key_;this._options.clearCallback&&this._options.clearCallback(t[n]),delete t[n]}t.splice(0,e),this._options.removeOldCallback&&this._options.removeOldCallback()},dg.prototype.clear=function(){for(var t=this._cache,e=0,i=t.length;i>e;e++){var n=t[e]._key_;this._options.clearCallback&&this._options.clearCallback(t[n]),delete t[n]}this._cache=t=[]},dg.prototype.forEach=function(t){for(var e=this._cache,i=0,n=e.length;n>i;i++){var a=e[i]._key_;t(e[a])}},dg.prototype.getBatch=function(t){for(var e=[],i=0,n=t.length;n>i;i++)this.getData(t[i])&&(e[e.length]=this.getData(t[i]));return e},dg.prototype.clearExcept=function(t){for(var e=this._cache,i=e.length,n=i-1;n>=0;n--){var a=this._cache[n]._key_;t[a]||(e.splice(n,1),this._options.clearCallback&&this._options.clearCallback(e[a]),delete e[a])}},dg.prototype.getDataCount=function(){return this._cache.length},v.extend(S.prototype,{centerAndZoom:function(t,e,i){var n=this;if(t||e){t=t||this.centerPoint,e=e||this.zoomLevel,e=this._getProperZoom(e).zoom,this.mapType===BMAP_EARTH_MAP&&(this._earth||(this.mapType=BMAP_NORMAL_MAP,this.temp.originMapType=BMAP_EARTH_MAP,cl.load("earth",function(){n._earth=new d5.Earth(n),n._proxyEarthEvents(),n._changeEarthMapType(BMAP_EARTH_MAP),n._navigationCtrl||(n._navigationCtrl=new d5.NavigationControl3D(n)),delete n.temp.originMapType}))),this.lastLevel=this.zoomLevel||e,this.zoomLevel=e;var a=new aw("onload");if(a.point=t,a.zoom=e,this.centerPoint=this.restrictCenter(new d8(t.lng,t.lat)),this.centerPoint.zoom&&(this.zoomLevel=this.centerPoint.zoom),this.defaultZoomLevel=this.defaultZoomLevel||this.zoomLevel,this.defaultCenter=this.defaultCenter||this.centerPoint,!this.loaded&&this.temp.originMapType!==BMAP_EARTH_MAP){var o=this.config.defaultMaxBounds,r=new bC(o,"baidu",this.mapType),s=new bs({mapType:this.mapType,copyright:r,customLayer:!1});s._isInnerLayer=!0,s.baseLayer=!0,this.addTileLayer(s),this.mapType===BMAP_SATELLITE_MAP&&this._isHybridShow===!0&&this._addHybirdMap()}this.dispatchEvent(a),this.loaded=!0,i=i||{},i.callback&&i.callback()}},_setPlatformPosition:function(t,e,i){if(i=i||{},0!==t||0!==e||i.point){isNaN(i.initMapOffsetX)&&(i.initMapOffsetX=this.offsetX),isNaN(i.initMapOffsetY)&&(i.initMapOffsetY=this.offsetY);var n=t+i.initMapOffsetX,a=e+i.initMapOffsetY;if(i.point){var o=this.restrictCenter(i.point);o.equals(this.centerPoint)||(this.centerPoint=o.clone(),this.fire(new aw("oncenter_changed")))}else{var r=this.offsetX-n,s=this.offsetY-a,l=this.getZoomUnits(),h=this.centerPoint.lng,c=this.centerPoint.lat,d=new d8(h,c);this.centerPoint=this.restrictCenter(new d8(d.lng+r*l,d.lat-s*l),l),this.fire(new aw("oncenter_changed")),this.zoomLevel<10&&(n=this.offsetX-(this.centerPoint.lng-d.lng)/l,a=this.offsetY+(this.centerPoint.lat-d.lat)/l)}n=Math.round(n),a=Math.round(a),this.offsetX=n,this.offsetY=a;var u=this.platform.style;u.left=n+"px",u.top=a+"px",this.maskLayer.style.left=-n+"px",this.maskLayer.style.top=-a+"px",i.dispatchEvent!==!1&&this.dispatchEvent(new aw("onmoving"))}},zoomTo:function(t,e){if("number"==typeof t){var i=a6[this.mapType];if(i){var n=t;if(t=this._getProperZoom(t).zoom,t===this.zoomLevel){var a=new aw("onzoomexceeded");return a.targetZoom=n,void this.dispatchEvent(a)}if(this.lastLevel=this.zoomLevel,e)this.temp._cPoint=e,this.temp._cPixel=this.pointToPixel(e);else if(this.getInfoWindow()){var o=this.getInfoWindow().getPoint();this.temp._cPixel=this.pointToPixel(o),this.temp._cPoint=o}if(e||this.temp.infoWin&&this.temp.infoWin.isOpen()){var r=this.temp._cPoint,s=this.temp._cPixel,l=this.getZoomUnits(t),h=new d8(r.lng+l*(this.width/2-s.x),r.lat-l*(this.height/2-s.y));this.centerPoint=this.restrictCenter(h,l,t),this.centerPoint.zoom&&(t=this.centerPoint.zoom)}this.dispatchEvent(new aw("onzoomstart")),this.dispatchEvent(new aw("onzoomstartcode")),t!==this.zoomLevel&&(this.zoomLevel=t)}}},deepZoomMedia:function(t){var e=this;e.temp.isStdCtrlBusy||(e.temp.isStdCtrlBusy=!0,e.deepZoomTo(e.zoomLevel+t),setTimeout(function(){e.temp.isStdCtrlBusy=!1},400))},deepZoomTo:function(t){var e=t-this.zoomLevel,i=this._getProperZoom(t);if(i.exceeded){var n=new aw("onzoomexceeded");return n.targetZoom=t,void this.dispatchEvent(n)}var a=new cs(this.width/2,this.height/2);this.lastLevel=this.zoomLevel,this.getInfoWindow()&&(a=this.pointToPixel(this.getInfoWindow().getPoint(),{zoom:this.lastLevel}));var o=this.deepZoom||new aN(this),r=e>0?1:-1;o.zoomMap(a,e,r)},flyTo:function(t,e){if(e===this.zoomLevel)return void this.panTo(t);var i=this._getProperZoom(e);if(i.exceeded){var n=new aw("onzoomexceeded");return n.targetZoom=e,void this.dispatchEvent(n)}var a=e-this.zoomLevel,o=new cs(this.width/2,this.height/2),r=this.pointToPixel(t),s=new ck(r.x-o.x,r.y-o.y);if(this.lastLevel=this.zoomLevel,Math.abs(a)>=4||Math.abs(s.width)>this.width||Math.abs(s.height)>this.height)return void this.centerAndZoom(t,e);var l=this.deepZoom||new aN(this),h=a>0?1:-1;l.zoomMap(r,a,h,s)},panTo:function(t,e){if(e=e||{},!t||t.equals(this.centerPoint))return void(e.callback&&e.callback());var i=this.pointToPixel(t),n=Math.round(this.width/2),a=Math.round(this.height/2);Math.abs(n-i.x)>this.width||Math.abs(a-i.y)>this.height||e.noAnimation===!0?(this._panTo(n-i.x,a-i.y,t),e.callback&&e.callback()):this._panBy(n-i.x,a-i.y,e)},_panTo:function(t,e,i){var n=this.temp;n.operating!==!0&&(n.dragAni&&(n.dragAni.stop(),n.dragAni=null,this.dispatchEvent(new aw("onmoveend"))),this.dispatchEvent(new aw("onmovestart")),this._setPlatformPosition(t,e,{point:i}),this.dispatchEvent(new aw("onmoveend")))},panBy:function(t,e,i){i=i||{},t=Math.round(t)||0,e=Math.round(e)||0,Math.abs(t)<=this.width&&Math.abs(e)<=this.height&&i.noAnimation!==!0?this._panBy(t,e,i):(this._panTo(t,e),i.callback&&i.callback())},_panBy:function(t,e,i){if(this.temp.operating!==!0){i=i||{},this.dispatchEvent(new aw("onmovestart"));var n=this,a=n.temp;a.pl=n.offsetX,a.pt=n.offsetY,a.tlPan&&a.tlPan.cancel(),a.dragAni&&(a.dragAni.stop(),a.dragAni=null,this.dispatchEvent(new aw("onmoveend"))),a.tlPan=new m({fps:i.fps||n.config.fps,duration:i.duration||n.config.actionDuration,transition:i.transition||bh.easeInOutQuad,render:function(i){this.terminative=n.temp.operating,n.temp.operating||n._setPlatformPosition(Math.ceil(t*i),Math.ceil(e*i),{initMapOffsetX:a.pl,initMapOffsetY:a.pt})},finish:function(){n.dispatchEvent(new aw("onmoveend")),n.temp.tlPan=!1,n.temp.stopArrow===!0&&(n.temp.stopArrow=!1,0!==n.temp.arrow&&n._arrow()),i.callback&&i.callback()}})}},getCenter:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},setTilt:function(){},getTilt:function(){return this._tilt},setHeading:function(){},getHeading:function(){return this._heading},restrictCenter:function(t,e,i){this.isRestrict=!1,e=e||this.getZoomUnits(),i=i||this.zoomLevel;var n=this.pixelToPoint(new cs(0,0),{center:t,zoom:i}),a=this.pixelToPoint(new cs(0,this.height),{center:t,zoom:i});if(this.zoomLevel<5&&n.lat>bE.MAX_LAT&&a.lat<bE.MIN_LAT){this.isRestrict=!0;var o,r=bE.MAX_LAT-t.lat,s=t.lat-bE.MIN_LAT;o=s>r?r/(this.height/2):s/(this.height/2);var l=18-cy(o);return this.zoomLevel=Math.ceil(l),t.zoom=Math.ceil(l),t}return n.lat>bE.MAX_LAT?(this.isRestrict=!0,t.lat=bE.MAX_LAT-this.height/2*e):a.lat<bE.MIN_LAT&&(this.isRestrict=!0,t.lat=bE.MIN_LAT+this.height/2*e),t}}),bE.MAX_TILT=87,bE.MAX_LAT=19431424,bE.MIN_LAT=-16023552,bE.inherits(co,"Map"),v.extend(bE.prototype,{render:function(){var t=F("div",{id:"platform"}),e=t.style;e.overflow="visible",e.position="absolute",e.zIndex=5,e.top=e.left="0px";var i=F("div",{id:"mask","class":"BMap_mask"}),n=i.style;return n.position="absolute",n.top=n.left="0px",n.zIndex="9",n.overflow="hidden",n.WebkitUserSelect="none",n.width=this.width+"px",n.height=this.height+"px",t.appendChild(i),t},_initMapRenderType:function(){switch(this.config.forceRenderType){case"dom":this._renderType="dom";break;case"canvas":if(av.isModernBrowser){this._renderType="canvas";break}case"webgl":if(av.ifSupportWebGL()){this._renderType="webgl";break}default:if(av.ifSupportWebGL()&&av.ifEnableWebGLMap())return void(this._renderType="webgl");if(av.isModernBrowser&&av.ifEnableCanvas2dMap())return void(this._renderType="canvas");this._renderType="dom"}},_setConfig:function(t){t=t||{},this.config={clickInterval:200,enableDragging:!0,enableKeyboard:!1,enableDblclickZoom:!0,enableContinuousZoom:!1,enableWheelZoom:!1,enableMouseDown:!0,fps:25,zoomerDuration:240,actionDuration:450,defaultCursor:cR.defaultCursor,draggingCursor:cR.draggingCursor,isOverviewMap:!1,coordType:BMAP_COORD_MERCATOR,mapType:BMAP_NORMAL_MAP,restrictBounds:!1,drawer:BMAP_SYS_DRAWER,enableInertialDragging:!1,drawMargin:500,drawMarginGL:500,enableFulltimeSpotClick:!1,enableResizeOnCenter:!1,isModernBrowser:av.isModernBrowser,forceRenderType:"",ratio:ar(),enableEarth:av.ifEnableEarth(),defaultMaxBounds:new ca(-21364736,-10616832,23855104,15859712)};for(var e in t)t.hasOwnProperty(e)&&(this.config[e]=t[e])},getMinZoom:function(){return a6[this.mapType][this._renderType]?a6[this.mapType][this._renderType].minZoom:a6[this.mapType].minZoom},getMaxZoom:function(){return a6[this.mapType][this._renderType]?a6[this.mapType][this._renderType].maxZoom:a6[this.mapType].maxZoom},_drawFrame:function(){this._webglMapScene._painter.draw()},_setupWebGLMap:function(){var t=this;cl.load("mapgl",function(){t._asyncRegister()})},_setStyle:function(t){var e=t.style;e.overflow="hidden","absolute"!=dm(t).position&&(e.position="relative"),e.backgroundImage="url("+cR.imgPath+"bg.png)",e.textAlign="left",e.touchAction=e.MSTouchAction="none"},_bind:function(){var t=this;t._watchSize="webgl"!==t._renderType?function(){var e=t.getContainerSize();if(t.width!==e.width||t.height!==e.height){var i=(e.width-t.width)/2,n=(e.height-t.height)/2,a=t.getZoomUnits(),o=t.centerPoint;o&&!t.config.enableResizeOnCenter&&(t.centerPoint=new d8(o.lng+i*a,o.lat-n*a)),t.maskLayer.style.width=(t.width=e.width)+"px",t.maskLayer.style.height=(t.height=e.height)+"px";var r=new aw("onresize");r.size=e,t.dispatchEvent(r),t.fire(new aw("onsize_changed"));var s=parseInt(t.platform.style.left,10)||0,l=parseInt(t.platform.style.top,10)||0;"undefined"===t.currentOperation||t.currentOperation===cc.idle||t.offsetX===s&&t.offsetY===l||t._setPlatformPosition(s,l)}}:function(){var e=t.getContainerSize();if(t.width!==e.width||t.height!==e.height){t.maskLayer.style.width=e.width+"px",t.maskLayer.style.height=e.height+"px",ar()!==t.config.ratio&&(t.config.ratio=ar());var i=new aw("onresize");i.size=e,t.dispatchEvent(i);var n=new aw("onsize_changed");n.size=e,t.fire(n)}},setInterval(t._watchSize,16)},addControl:function(t){t&&aY(t._i)&&(t._i(this),this.dispatchEvent(new aw("onaddcontrol",t)))},removeControl:function(t){t&&aY(t.remove)&&(t.remove(),this.dispatchEvent(new aw("onremovecontrol",t)))},addContextMenu:function(t){t&&"contextmenu"==t._type&&"function"==typeof t.initialize&&(t.initialize(this),this.dispatchEvent(new aw("onaddcontextmenu",t)))},removeContextMenu:function(t){t&&"contextmenu"==t._type&&"function"==typeof t.remove&&(this.dispatchEvent(new aw("onremovecontextmenu",t)),t.remove())},addOverlay:function(t){if(t&&aY(t._i)){var e=new aw("onbeforeaddoverlay",t);e.overlay=t,this.dispatchEvent(e),t._i(this),e=new aw("onaddoverlay",t),e.overlay=t,this.dispatchEvent(e)}},removeOverlay:function(t){if(t&&aY(t.remove)){var e=new aw("onremoveoverlay",t);e.overlay=t,t.remove(),this.dispatchEvent(e)}},clearOverlays:function(){this.dispatchEvent(new aw("onclearoverlays"))},addTileLayer:function(t){for(var e=0,i=this.tileMgr.tileLayers.length;i>e;e++){var n=this.tileMgr.tileLayers[e];if(n===t||n.getMapType()===t.getMapType())return}t&&"tilelayer"===t._type&&aY(t.initialize)&&(t.initialize(this),this.dispatchEvent(new aw("onaddtilelayer",t)))},removeTileLayer:function(t){t&&"tilelayer"===t._type&&aY(t.remove)&&(t.remove(),this.dispatchEvent(new aw("onremovetilelayer",t)))},getTileLayer:function(t){return this.tileMgr?this.tileMgr.getTileLayer(t):null},setMapType:function(t){var e=this;if(this.mapType!==t&&!this._mapTypeChanging&&!(t===BMAP_EARTH_MAP&&!this.config.enableEarth||this._earth&&this._earth.getLock()))if(this._mapTypeChanging=!0,this.preMapType=this.mapType,this._boundsInPreMapType=this.getBounds(),this.preMapType===BMAP_SATELLITE_MAP&&(this._preStreetLayerShow=this._isHybridShow),t===BMAP_EARTH_MAP){if(!d5.Earth)return void cl.load("earth",function(){e._changeEarthMapType(t)});e._changeEarthMapType(t)}else this.preMapType!==BMAP_EARTH_MAP?(this._changeFlatMapType(t),this._mapTypeChanging=!1):this._setMapTypeStatus(t,function(i,n){var a=e._earth.getEarthCanvas();e._changeFlatMapType(t,this.preMapType),e._mapTypeChangAni&&e._mapTypeChangAni.stop(),e._mapTypeChangAni=c1.start({el:a,style:"opacity",startValue:1,endValue:0,duration:200,callback:function(){e._mapTypeChangAni=null,e._mapTypeChanging=!1}}),i=ct.convertLL2MC(i),"webgl"===e._renderType?(v.extend(e,bD.prototype),e.setCenter(i,{noAnimation:!0}),e.zoomTo(n,null,{noAnimation:!0})):(v.extend(e,S.prototype),e.centerAndZoom(i,n))})},_changeFlatMapType:function(t){if(t&&a6[t]){var e=this.preMapType;this.mapType=t;var i=this.getTileLayer(e);if(i&&this.removeTileLayer(i),e!==BMAP_EARTH_MAP||"webgl"!==this._renderType||this.baseLayerAdded!==!0){var n=new ca(-21364736,-10616832,23855104,15859712),a=new bC(n,"baidu",t),o="webgl"===this._renderType?2:1,r=new bs({mapType:t,copyright:a,dataType:o,customLayer:!1});r.baseLayer=!0,r._isInnerLayer=!0,this.addTileLayer(r),"webgl"!==this._renderType||this.baseLayerAdded||(this.baseLayerAdded=!0)}e==BMAP_SATELLITE_MAP?(this._preStreetLayerShow=this._isHybridShow,this._removeHybirdMap()):t==BMAP_SATELLITE_MAP&&(this._preStreetLayerShow===!0||"undefined"==typeof this._preStreetLayerShow)&&this._addHybirdMap();for(var s=this.tileMgr.tileLayers,l=0,h=s.length;h>l;l++){var c=s[l],d=c.tilesDiv;c._isInnerLayer||"hidden"!==d.style.visibility||(d.style.visibility="")}var u=new aw("onmaptypechange");u.zoomLevel=this.zoomLevel,u.mapType=t,u.exMapType=e,this.dispatchEvent(u)}},showStreetLayer:function(t){t?this._addHybirdMap():this._removeHybirdMap()},_addHybirdMap:function(){if("B_EARTH_MAP"===this.mapType)return void this._earth.showStreetLayer();if(this._hybridTileLayer){this._isHybridShow=!0,this.addTileLayer(this._hybridTileLayer);var t=new aw("onstreetlayer_show");return void this.dispatchEvent(t)}var e=new ca(-21364736,-10616832,23855104,15859712),i=new bC(e,"",BMAP_HYBRID_MAP),n=new bs({copyright:i,transparentPng:!0});n._isInnerLayer=!0;var a=this.isCanvasMap();n.getTilesUrl=function(t,e){var i=a6[BMAP_HYBRID_MAP];if("object"!=typeof i)return null;var n=i.baseUnits*Math.pow(2,i.zoomLevelBase-e),o=parseInt(t.lng/n),r=parseInt(t.lat/n),s="015";"undefined"!=typeof TVC&&(s=TVC.ditu.satelliteStreet.version);var l="20130501";"undefined"!=typeof TVC&&(l=TVC.ditu.satelliteStreet.updateDate);var h=i.tileUrls[Math.abs(o+r)%i.tileUrls.length]+"?qt=tile&x="+(o+"").replace(/-/gi,"M")+"&y="+(r+"").replace(/-/gi,"M")+"&z="+e+"&styles=sl"+(6==v.Browser.ie?"&color_dep=32&colors=50":"")+"&v="+s+"&udt="+l+"&p="+(a?0:1);return"1"===window.nuzad&&(h+="&tcode=nuzad"),h},this._isHybridShow=!0,this.addTileLayer(n),this._hybridTileLayer=n;var t=new aw("onstreetlayer_show");this.dispatchEvent(t)},_removeHybirdMap:function(){if("B_EARTH_MAP"===this.mapType)return void this._earth.hideStreetLayer();if(this._hybridTileLayer){this._isHybridShow=!1,this.removeTileLayer(this._hybridTileLayer);var t=new aw("onstreetlayer_hide");this.dispatchEvent(t)}},isStreetLayerShow:function(){return"B_SATELLITE_MAP"===this.mapType?this._isHybridShow:"B_EARTH_MAP"===this.mapType?this._earth._streetLayerVisible:void 0},getTileId:function(t,e){var i=a6[this.mapType];if("object"!=typeof i)return null;var n=i.baseUnits*Math.pow(2,i.zoomLevelBase-e),a=parseInt(t.lng/n),o=parseInt(t.lat/n);return{row:a,column:o,level:e}},reset:function(){this.centerAndZoom(this.defaultCenter,this.defaultZoomLevel,!0)},enableDragging:function(){this.config.enableDragging=!0},disableDragging:function(){this.config.enableDragging=!1},enableInertialDragging:function(){this.config.enableInertialDragging=!0},disableInertialDragging:function(){this.config.enableInertialDragging=!1},enableScrollWheelZoom:function(){this.config.enableWheelZoom=!0},disableScrollWheelZoom:function(){this.config.enableWheelZoom=!1},enableContinuousZoom:function(){this.config.enableContinuousZoom=!0},disableContinuousZoom:function(){this.config.enableContinuousZoom=!1},enableResizeOnCenter:function(){this.config.enableResizeOnCenter=!0},disableResizeOnCenter:function(){this.config.enableResizeOnCenter=!1},enableDoubleClickZoom:function(){this.config.enableDblclickZoom=!0},disableDoubleClickZoom:function(){this.config.enableDblclickZoom=!1},enableKeyboard:function(){this.config.enableKeyboard=!0},disableKeyboard:function(){this.config.enableKeyboard=!1},getSize:function(){return new ck(this.width,this.height)},getContainerSize:function(){return new ck(this.container.clientWidth,this.container.clientHeight)},_getProperZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),n=!1;return e>t&&(n=!0,t=e),t>i&&(n=!0,t=i),{zoom:t,exceeded:n}},getContainer:function(){return this.container},getZoomUnits:function(t){if(this.mapType===BMAP_EARTH_MAP)return Math.pow(2,18-this._earth.getImageZoom());var e=a6[this.mapType];if("object"!=typeof e)return null;var i=t||this.zoomLevel;return Math.pow(2,e.zoomLevelBase-i)},pointToPixel:function(t,e){if(t){if(e=e||{},this.mapType==BMAP_EARTH_MAP){var i;t._llPt||(i=ct.convertMC2LL(t),t._llPt=i),i=t._llPt;var n=null,a=null;if("number"==typeof e.zoom){var o=this._earth,r=o._getEarthZoomByImgZoom(e.zoom);3>=r&&(n=o._generateTmpPMatrix(r)),a=o._generateTmpMVMatrix(o.getCenter(),r)}var s=this._earth.fromLatLngToPixel(i,{useRound:!1,isCalcOnBack:!0,matrixInfo:{modelViewMatrix:a,projectionMatrix:n}});return s}if(this._heading%360===0&&0===this._tilt){var l=this.getZoomUnits(e.zoom),h=e.center||this.centerPoint,c=this.width/2,d=this.height/2,u=(t.lng-h.lng)/l+c,p=(h.lat-t.lat)/l+d;return e.useRound!==!1&&(u=Math.round(u),p=Math.round(p)),new cs(u,p)}var f=this._webglMapCamera.fromMCToScreenPixel(t.lng,t.lat,e);return e.useRound===!1?f:(f.x=Math.round(f.x),f.y=Math.round(f.y),f)}},pixelToPoint:function(t,e){if(t){if(e=e||{},this.mapType==BMAP_EARTH_MAP){if("number"==typeof e.zoom){var i=this._earth,n=null,a=null,o=i._getEarthZoomByImgZoom(e.zoom);3>=o&&(n=i._generateTmpPMatrix(o)),a=i._generateTmpMVMatrix(i.getCenter(),o)}var r=this._earth.fromPixelToLatLng(t,{matrixInfo:{modelViewMatrix:a,projectionMatrix:n}});return null===r?null:ct.convertLL2MC(r)}if(this._heading%360!==0||this._tilt>0)return this._webglMapCamera.fromScreenPixelToMC(t.x,t.y,e);var s=e.center||this.centerPoint,l=this.getZoomUnits(e.zoom),h=s.lng+l*(t.x-this.width/2),c=s.lat-l*(t.y-this.height/2);return new d8(h,c)}},pointToOverlayPixel:function(t,e,i){var n=this.pointToPixel(t,{zoom:e,center:i});if(n)return"webgl"!==this._renderType&&(n.x-=this.offsetX,n.y-=this.offsetY),n},overlayPixelToPoint:function(t,e){if(t){var i=new cs(t.x,t.y);return"webgl"!==this._renderType&&(i.x+=this.offsetX,i.y+=this.offsetY),this.pixelToPoint(i,{zoom:e})}},lnglatToMercator:function(t,e){var i=new d8(t,e),n=ct.convertLL2MC(i);return[n.lng,n.lat]},mercatorToLnglat:function(t,e){if(isNaN(t)||isNaN(e))return[];t=parseFloat(t),e=parseFloat(e);var i=new d8(t,e),n=ct.convertMC2LL(i);return[n.lng,n.lat]},getBounds:function(){if(this.mapType===BMAP_EARTH_MAP){var t=this._earth.getCustomBounds();if(!t)return this.config.defaultMaxBounds;var e=t.getSouthWest(),i=t.getNorthEast();e.lng>i.lng&&(i.lng=180);var n=ct.convertLL2MC(e),a=ct.convertLL2MC(i),o=this.config.defaultMaxBounds,r=Math.max(n.lng,o.minX),s=Math.max(n.lat,o.minY),l=Math.min(a.lng,o.maxX),h=Math.min(a.lat,o.maxY),c=new ca(r,s,l,h);return c.pointBottomLeft=new d8(r,s),c.pointBottomRight=new d8(l,s),c.pointTopLeft=new d8(r,h),c.pointTopRight=new d8(l,h),c}var d=arguments[0]||{},u=d.margins||[0,0,0,0],p=this.pixelToPoint({x:u[3],y:this.height-u[2]},d),f=this.pixelToPoint({x:this.width-u[1],y:u[0]},d),m="number"==typeof d.heading?d.heading:this._heading%360,g="number"==typeof d.tilt?d.tilt:this._tilt;if(0===m&&0===g)return this._bounds.setValues(p.lng,p.lat,f.lng,f.lat),this._bounds.pointBottomLeft=p,this._bounds.pointBottomRight=new d8(f.lng,p.lat),this._bounds.pointTopRight=f,this._bounds.pointTopLeft=new d8(p.lng,f.lat),this._bounds;for(var _=this.pixelToPoint({x:u[3],y:u[0]},d),v=this.pixelToPoint({x:this.width-u[1],y:this.height-u[2]},d),y=[p,f,_,v],b=y[0].lng,w=y[0].lat,x=y[0].lng,M=y[0].lat,T=1;4>T;T++)y[T].lng<b&&(b=y[T].lng),y[T].lng>x&&(x=y[T].lng),y[T].lat<w&&(w=y[T].lat),y[T].lat>M&&(M=y[T].lat);return this._bounds.setValues(b,w,x,M),this._bounds.pointTopLeft=_,this._bounds.pointTopRight=f,this._bounds.pointBottomRight=v,this._bounds.pointBottomLeft=p,this._bounds},isLoaded:function(){return!!this.loaded},_getBestLevel:function(t,e){var i=0;"webgl"===this._renderType&&(i=100);var n=e.margins||[10,10,10,10],a=e.zoomFactor||0,o=n[1]+n[3],r=n[0]+n[2],s=this.getMinZoom(),l=this.getMaxZoom(),h=(t.maxX-t.minX)/(this.width-o-i),c=(t.maxY-t.minY)/(this.height-r-i),d=18-cy(Math.max(h,c));return d+=a,s>d&&(d=s),d>l&&(d=l),"webgl"!==this._renderType&&(d=Math.floor(d)),d},getViewport:function(t,e){if(this.mapType===BMAP_EARTH_MAP){t=t||[];for(var i=[],n=0;n<t.length;n++)t[n]&&i.push(ct.convertMC2LL(t[n]));var a=this._earth.getViewport(i,e),o=a.center,r=a.zoom,s=ct.convertLL2MC(o);return{center:s,zoom:r}}var l={center:this.getCenter(),zoom:this.getZoom()};if(!t||0==t.length)return l;e=e||{};var h;if(t instanceof ca)h=t;else{var c=t;h=new ca;for(var n=c.length-1;n>=0;n--)h.extend(c[n]);if(h.isEmpty())return l}var d=h.getCenter(),u=this._getBestLevel(h,e);if(e.margins){var p=e.margins,f=(p[1]-p[3])/2,m=(p[0]-p[2])/2,g=this.getZoomUnits(u);d.lng=d.lng+g*f,d.lat=d.lat+g*m}return{center:d,zoom:u}},setViewport:function(t,e){if(this.mapType===BMAP_EARTH_MAP){var i;if(t&&t.center){var n=ct.convertMC2LL(t.center),a=this._earth._getEarthZoomByImgZoom(t.zoom,n);i={center:n,zoom:a}}else{i=[];for(var o=0;o<t.length;o++){var r=ct.convertMC2LL(t[o]);i[o]=new bB(r.lat,r.lng)}}return void this._earth.setViewport(i,e)}var s;return s=t&&t.center?t:this.getViewport(t,e),e=e||{},"webgl"===this._renderType?void this.centerAndZoom(s.center,s.zoom,e):void(s.zoom==this.zoomLevel&&0!=e.enableAnimation?this.panTo(s.center,{duration:200,callback:e.callback}):this.centerAndZoom(s.center,s.zoom,e))},addSpots:function(t,e){if(t&&0!=t.length){e=e||{};var i=e.zIndex||0,n="undefined"==typeof e.enableMultiResponse?!0:!!e.enableMultiResponse;this.spotsPool=this.spotsPool||{};var a="sp"+this.temp.spotsGuid++;this.spotsPool[a]={spots:t.slice(0),zIndex:i,enableMultiResponse:n};var o=this;return cl.load("hotspot",function(){o._asyncRegister()}),a}},getSpots:function(t){return this.spotsPool[t]&&this.spotsPool[t].spots||[]},removeSpots:function(t){t&&this.spotsPool[t]&&delete this.spotsPool[t]},clearSpots:function(){delete this.spotsPool},setBounds:function(t){a6[this.mapType].bounds=new ca(t.minX,t.minY,t.maxX,t.maxY)},getCoordType:function(){return this.config.coordType},getPanes:function(){return this._panes},getInfoWindow:function(){return this.temp.infoWin&&this.temp.infoWin.isOpen()?this.temp.infoWin:null},getDistance:function(t,e){if(t&&e){if(this.mapType===BMAP_EARTH_MAP){var i=ct.convertMC2LL(t),n=ct.convertMC2LL(e);return this._earth.getDistance(i,n)}var a=ct.getDistanceByMC(t,e);return a}},getOverlays:function(){var t=[],e=this._overlays,i=this._customOverlays;if(e)for(var n in e)e[n]instanceof bt&&t.push(e[n]);if(i)for(var n=0,a=i.length;a>n;n++)t.push(i[n]);return t},getMapType:function(){return this.mapType},_asyncRegister:function(){for(var t=this.temp.registerIndex;t<d5._register.length;t++)d5._register[t](this);
this.temp.registerIndex=t},setDefaultCursor:function(t){this.config.defaultCursor=t,this.platform&&(this.platform.style.cursor=this.config.defaultCursor)},getDefaultCursor:function(){return this.config.defaultCursor},setDraggingCursor:function(t){this.config.draggingCursor=t},getDraggingCursor:function(){return this.config.draggingCursor},_changeEarthMapType:function(t){var e=this,i=e.tileMgr.tileLayers;if(this._mapTypeChangAni&&this._mapTypeChangAni.stop(),this._earth){var n=this._earth.getEarthCanvas();n.style.opacity=1}if(this._earth||(this.maskLayer.style.opacity=1,this.maskLayer.style.zIndex=999,this.maskLayer.style.background="#000"),this._mapTypeChangAni=new m({duration:400,render:function(t){if(e._earth)for(var n=i.length-1,a=n;a>=0;a--){var o=i[a].tilesDiv;o&&(o.style.opacity=1-t)}},finish:function(){for(var n=i.length-1,a=n;a>=0;a--){var o=i[a].tilesDiv;o&&(o.style.opacity=1,o.style.visibility="hidden"),i[a]._isInnerLayer&&"webgl"!==e._renderType&&e.removeTileLayer(i[a])}if(e._mapTypeChangAni=null,e._mapTypeChanging=!1,!e._earth){var r=e.getZoom()-2,s=e.getCenter(),l=ct.convertMC2LL(s);e._earth=new d5.Earth(e,{center:l,zoom:r}),e._proxyEarthEvents();var h=e.mapType;e.mapType=t;var c=new aw("onmaptypechange");c.zoomLevel=this.zoomLevel,c.mapType=t,c.exMapType=h,e.dispatchEvent(c),e._setMapTypeStatus(t),v.extend(e,d5.EarthView.prototype),e._navigationCtrl||(e._navigationCtrl=new d5.NavigationControl3D(e)),setTimeout(function(){e.maskLayer.style.zIndex=9,e.maskLayer.style.opacity=0},1e3)}}}),this._earth){var a=this.mapType;this.mapType=t;var o=new aw("onmaptypechange");o.zoomLevel=this.zoomLevel,o.mapType=t,o.exMapType=a,this.dispatchEvent(o),e._setMapTypeStatus(t)}},_setMapTypeStatus:function(t){var e=arguments[1];if(t===BMAP_EARTH_MAP){var i=this._earth.getEarthCanvas();i.style.display="";var n={noAnimation:!0};this._earth.setCenter(ct.convertMC2LL(this.centerPoint),n),this._earth.setImageZoom(this.zoomLevel,n),this._earth.setTilt(this.getTilt(),n),this._earth.setHeading(this.getHeading(),n)}else if(this.preMapType===BMAP_EARTH_MAP&&this._earth){var a=this._earth,o=a.getMapZoom(),r=a._imageRawZoom||o,s=r-o,l=a.getCenter();if("webgl"===this._renderType)return this._tilt=a.getTilt(),this.zoomLevel>7?(this._heading=a.getHeading(),void(e&&e(l,o))):void(0!==a.getHeading()?(a.setTilt(this.getTilt()),a.setHeading(this.getHeading(),{callback:function(){e&&e(l,o)}})):e&&e(l,o));if(.1>s&&0===a.getTilt()&&0===a.getHeading())return void(e&&e(l,o));a.setTilt(0),a.setHeading(0),a.setZoom(a.getZoom()-s,{callback:function(){e&&e(l,o)}})}},_proxyEarthEvents:function(){function t(t){e.fire(t)}var e=this,i=this._earth;i.on("tilesload",function(t){e.fire(t)}),i.on("centerandzoom",function(){e.dispatchEvent(new aw("onmoveend")),e.dispatchEvent(new aw("onzoomend"))});for(var n=["zoomstart","zoomend","tilesload","sunlighttime_change","sunlighttime_clear","centerandzoom","animation_start","animation_stop","movestart","moveend","moving","dragstart","dragend","dragging"],a=0;a<n.length;a++)i.on(n[a],t)},startSunLightAnimation:function(){this.mapType===BMAP_EARTH_MAP&&this._earth.startSunLightAnimation()},forceEnableEarth:function(){return this.config.forceEnableEarth=!0,this.config.enableEarth=av.ifEnableEarth(!0),this.dispatchEvent(new aw("forceenableearth")),this.config.enableEarth},stopSunLightAnimation:function(t){this.mapType===BMAP_EARTH_MAP&&this._earth.stopSunLightAnimation(t)},setLock:function(t){this.mapType===BMAP_EARTH_MAP&&this._earth.setLock(t),this._lock=t},getLock:function(){return this.mapType===BMAP_EARTH_MAP?this._earth.getLock():this._lock},getEarth:function(){return this._earth},isSupportEarth:function(){return this.config.enableEarth},isCanvasMap:function(){return!("canvas"!==this._renderType||"B_EARTH_MAP"===this.getMapType())},getCanvasMapCoordByUid:function(t){if("webgl"===this._renderType){for(var e=this.tileMgr.tileLayers,i=0;i<e.length;i++)if(e[i].labelProcessor)return e[i].labelProcessor.getLabelByUid(t,"");return null}var n=this.canvas2dMapMgr._labelClick,a=n.findLabelByUid(t);return a?new d8(a.iconPos.geoX,a.iconPos.geoY):null},loadBizData:function(t){var e=new aw("onloadbizdata");e.data=t,this.dispatchEvent(e)},unloadBizData:function(){var t=new aw("onunloadbizdata");this.dispatchEvent(t)},zoomIn:function(t){this.zoomTo(this.zoomLevel+1,t)},zoomOut:function(t){this.zoomTo(this.zoomLevel-1,t)},setCenter:function(t,e){this.panTo(t,e)},getRenderType:function(){return this._renderType},getSolarInfo:function(t){t=t||this._initDate;var e=aJ(t),i=ct.convertLL2MC(new d8(e[0],e[1])),n=i.latLng,a=d5.Projection.convertMC2LL(this.centerPoint),o=t.getUTCHours(),r=o+24*a.lng/360,s=r-12,l=60*s*.25,h=Math.asin(Math.sin(b5(a.lat))*Math.sin(b5(n.lat))+Math.cos(b5(a.lat))*Math.cos(b5(n.lat))*Math.cos(b5(l))),c=Math.asin(Math.sin(b5(l))*Math.cos(b5(n.lat))/Math.cos(h)),d="north";return a.lat<n.lat&&(d="south"),{zenith:i,solarAltitude:h,solarAzimuth:c,centerPosition:d,position:i}},setDisplayOptions:function(t){if(t){for(var e in this._displayOptions)this._displayOptions.hasOwnProperty(e)&&"boolean"==typeof t[e]&&(this._displayOptions[e]=t[e]);this.fire(new aw("ondisplayoptions_changed"))}},getHorizonPosY:function(t){if(!t)return null;var e=this._webglMapCamera.fromMCToScreenPixel(t.lng,t.lat,{heading:0});return e.y},getIndoorInfo:function(){return this._indoorMgr?this._indoorMgr.getData():void 0},showIndoor:function(t,e){var i=new aw("onindoor_status_changed");i.uid=t,i.floor=e,this.fire(i)},addAreaSpot:function(t,e){if(t&&0!==t.length){e=e||{},this.areaSpots=this.areaSpots||{};var i=e.id||"sp"+this.temp.spotsGuid++;return this.areaSpots[i]={spot:t,userData:e.userData},i}},getAreaSpot:function(t){return this.areaSpots&&this.areaSpots[t]?this.areaSpots[t]:null},removeAreaSpot:function(t){t&&this.areaSpots[t]&&delete this.areaSpots[t]},clearAreaSpots:function(){this.areaSpots={}},resetSpotStatus:function(){this.fire(new aw("onspot_status_reset"))}}),window.BMAP_NORMAL_MAP="B_NORMAL_MAP",window.BMAP_SATELLITE_MAP="B_SATELLITE_MAP",window.BMAP_HYBRID_MAP="B_STREET_MAP",window.BMAP_EARTH_MAP="B_EARTH_MAP",window.BMAP_COORD_MERCATOR=1,window.BMAP_SYS_DRAWER=0,window.BMAP_SVG_DRAWER=1,window.BMAP_VML_DRAWER=2,window.BMAP_CANVAS_DRAWER=3;var w={request:function(t,e){var i=F("script",{src:t,type:"text/javascript",charset:"utf-8"});i.addEventListener?(i.addEventListener("load",function(t){var e=t.target;e.parentNode.removeChild(e)},!1),i.addEventListener("error",function(){e&&e([,,,,,])},!1)):i.attachEvent&&i.attachEvent("onreadystatechange",function(){var t=window.event.srcElement;!t||"loaded"!=t.readyState&&"complete"!=t.readyState||t.parentNode.removeChild(t)}),document.getElementsByTagName("head")[0].appendChild(i),i=null}};aV.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},aV.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},aV.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},aV.prototype.solveCurveX=function(t,e){"undefined"==typeof e&&(e=1e-6);var i,n,a,o,r;for(a=t,r=0;8>r;r++){if(o=this.sampleCurveX(a)-t,Math.abs(o)<e)return a;var s=this.sampleCurveDerivativeX(a);if(Math.abs(s)<1e-6)break;a-=o/s}if(i=0,n=1,a=t,i>a)return i;if(a>n)return n;for(;n>i;){if(o=this.sampleCurveX(a),Math.abs(o-t)<e)return a;t>o?i=a:n=a,a=.5*(n-i)+i}return a},aV.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var bh={};m.prototype._doStart=function(){if(window.requestAnimationFrame){var t=this;t._timer=window.requestAnimationFrame(function(e){t._loop(e)})}else this._beginTime=(new Date).getTime(),this._endTime=this._beginTime+this._options.duration,this._loop()},m.prototype._loop=function(t){var e=this;if(t=t||(new Date).getTime(),this._beginTime||(this._beginTime=t),this._endTime||(this._endTime=this._beginTime+this._options.duration),t>=e._endTime){e._options.dropLastAnimation===!1&&e._options.render(e._options.transition(1),1,t),"function"==typeof e._options.finish&&e._options.finish(t);for(var i=0,n=e._callbacks.length;n>i;i++)e._callbacks[i]()}else{var a=(t-e._beginTime)/e._options.duration;e.schedule=e._options.transition(a),e._options.render(e.schedule,a,t),e.terminative||(e._timer=window.requestAnimationFrame?requestAnimationFrame(function(t){e._loop(t)}):setTimeout(function(){e._loop()},1e3/e._options.fps))}},m.prototype.stop=function(t,e){this.terminative=!0,this._timer&&(window.cancelAnimationFrame?cancelAnimationFrame(this._timer):clearTimeout(this._timer),this._timer=null,"function"==typeof this._options.onStop&&this._options.onStop(e)),t&&(this._endTime=this._beginTime,this._loop())},m.prototype.cancel=function(){this.stop()},m.prototype.append=function(t){return this._callbacks.push(t),this},bh={_p1:1,_p2:1.525,linear:function(t){return t},reverse:function(t){return 1-t},easeInQuad:function(t){return t*t},easeInCubic:function(t){return Math.pow(t,3)},easeInBiquad:function(t){return Math.pow(t,4)},easeInBack:function(t){return t*t*((bh._p1+1)*t-bh._p1)},easeOutQuad:function(t){return-(t*(t-2))},easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeOutBiquad:function(t){return 1-Math.pow(t-1,4)},easeOutBack:function(t){return(t-=1)*t*((bh._p1+1)*t+bh._p1)+1},easeInOutQuad:function(t){return.5>t?t*t*2:-2*(t-2)*t-1},easeInOutCubic:function(t){return.5>t?4*Math.pow(t,3):4*Math.pow(t-1,3)+1},easeInOutBiquad:function(t){return.5>t?8*Math.pow(t,4):1-8*Math.pow(t-1,4)},easeInOutSine:function(t){return(1-Math.cos(Math.PI*t))/2}},bh.ease=function(){var t=new aV(.4,0,.6,1);return function(e){return t.solve(e)}}(),bh["ease-in"]=bh.easeInQuad,bh["ease-out"]=bh.easeOutQuad;var c1={start:function(t){var e=t.el,i=t.style,n=t.startValue,a=t.endValue,o=t.duration||1400,r=t.transition||bh.linear,s=t.callback,l=a-n,h=t.unit||"";return new m({fps:60,duration:o,transition:r,render:function(t){e.style[i]=n+l*t+h},finish:function(){s&&s()}})}};v.extend(cl,{Request:{INITIAL:-1,WAITING:0,LOADED:1,COMPLETED:2},Dependency:{poly:["marker"],infowindow:["marker"],simpleInfowindow:["marker"],hotspot:["poly"],tools:["marker","poly"],mapgl:["glcommon","poly"],earth:["glcommon"]},MD5Mapping:{control:"vpb0d0",marker:"m5i5qv",poly:"4kwzm4",infowindow:"4m3cgj",simpleInfowindow:"0fenuq",hotspot:"felfk3",menu:"zvllh0",tools:"2bd0mj",oppc:"k5ow3t",oppcgl:"w21tyi",mapgl:"ufp53y",markeranimation:"a3jlzh",earth:"2cr3rj",glcommon:"t0s0t2"},Config:{baseUrl:"/?qt=getjsmods&v=1.1&sample=newui&udt=20170122",jsModPath:"/res/newui/",timeout:5e3},delayFlag:!1,Module:{modules:{},modulesNeedToLoad:[]},_getMd5ModsStr:function(t){for(var e=[],i=0,n=t.length;n>i;i++){var a=t[i],o=this.MD5Mapping[a],r="$"+a+"$";o!==r&&e.push(a+"_"+o)}return e.join(",")},load:function(t,e,i){function n(e){var i=o.getModuleInfo(t);if(i.status!==o.Request.COMPLETED&&window.map){var n=new aw("onmod_timeout");n.timeout=e/1e3,n.moduleName=t,window.map.fire(n)}}var a=this.getModuleInfo(t);if(a.status===this.Request.COMPLETED)return void(i===!0&&e());if(a.status===this.Request.INITIAL){this.combine(t),this.addToLoadQueue(t);var o=this;o.delayFlag===!1&&(o.delayFlag=!0,setTimeout(function(){var t=o.Config.baseUrl+"&mod="+o._getMd5ModsStr(o.Module.modulesNeedToLoad);w.request(t),o.Module.modulesNeedToLoad.length=0,o.delayFlag=!1},1)),a.status=this.Request.WAITING,setTimeout(n,this.Config.timeout,this.Config.timeout),setTimeout(n,2*this.Config.timeout,2*this.Config.timeout)}a.callbacks.push(e)},combine:function(t){if(t&&this.Dependency[t])for(var e=this.Dependency[t],i=0;i<e.length;i++)this.combine(e[i]),this.Module.modules[e[i]]||this.addToLoadQueue(e[i])},addToLoadQueue:function(t){var e=this.getModuleInfo(t);e.status===this.Request.INITIAL&&(e.status=this.Request.WAITING,this.Module.modulesNeedToLoad.push(t))},run:function(el,em){var eq=this.getModuleInfo(el),et=this.Dependency[el];if(et)for(var eo=0;eo<et.length;eo++){var ep=this.getModuleInfo(et[eo]);if(ep.status!==this.Request.COMPLETED)return void ep.modsNeedToRun.push({name:el,code:em})}try{eval(em)}catch(er){return}eq.status=this.Request.COMPLETED;for(var eo=0,en=eq.callbacks.length;en>eo;eo++)eq.callbacks[eo]();for(eq.callbacks.length=0,eo=0;eo<eq.modsNeedToRun.length;eo++){var es=eq.modsNeedToRun[eo];this.run(es.name,es.code)}eq.modsNeedToRun.length=0},getModuleInfo:function(t){var e;return this.Module.modules[t]||(this.Module.modules[t]={status:this.Request.INITIAL,callbacks:[],modsNeedToRun:[]}),e=this.Module.modules[t]}}),window._jsload=function(t,e){var i=cl.getModuleInfo(t);if(i.status=cl.Request.LOADED,""!==e)cl.run(t,e);else{if(window.map){var n=new aw("ongetmodules_fail");n.moduleName=t,window.map.fire(n)}var a=document.createElement("script"),o=cl.MD5Mapping[t];a.src=cl.Config.jsModPath+t+"_"+o+".js",document.getElementsByTagName("head")[0].appendChild(a)}};var cU;cU="undefined"!=typeof window?window:self,K.prototype.mark=function(t){this._timeData[t]=this._getTime()},K.prototype.getMark=function(t){return this._timeData[t]},K.prototype.getTime=function(t,e){return(this._timeData[e]-this._timeData[t]).toFixed(2)},K.prototype.print=function(){},K.prototype.clear=function(){this._timeData={}},K.prototype._getTime=cU.performance&&cU.performance.now?function(){return performance.now()}:function(){return Date.now()},!function(t,e){e(t.d3=t.d3||{})}(window,function(t){function e(t,i,n,r){function s(e){return t(e=new Date(+e)),e}return s.floor=s,s.ceil=function(e){return t(e=new Date(e-1)),i(e,1),t(e),e},s.round=function(t){var e=s(t),i=s.ceil(t);return i-t>t-e?e:i},s.offset=function(t,e){return i(t=new Date(+t),null==e?1:Math.floor(e)),t},s.range=function(e,n,a){var o=[];if(e=s.ceil(e),a=null==a?1:Math.floor(a),!(n>e&&a>0))return o;do o.push(new Date(+e));while(i(e,a),t(e),n>e);return o},s.filter=function(n){return e(function(e){for(;t(e),!n(e);)e.setTime(e-1)},function(t,e){for(;--e>=0;)for(;i(t,1),!n(t););})},n&&(s.count=function(e,i){return a.setTime(+e),o.setTime(+i),t(a),t(o),Math.floor(n(a,o))},s.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?s.filter(r?function(e){return r(e)%t===0}:function(e){return s.count(0,e)%t===0}):s:null}),s}function i(t){return e(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+7*e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*h)/u})}function n(t){return e(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+7*e)},function(t,e){return(e-t)/u})}var a=new Date,o=new Date,r=e(function(){},function(t,e){t.setTime(+t+e)},function(t,e){return e-t});r.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?e(function(e){e.setTime(Math.floor(e/t)*t)},function(e,i){e.setTime(+e+i*t)},function(e,i){return(i-e)/t}):r:null};var s=r.range,l=1e3,h=6e4,c=36e5,d=864e5,u=6048e5,p=e(function(t){t.setTime(Math.floor(t/l)*l)},function(t,e){t.setTime(+t+e*l)},function(t,e){return(e-t)/l},function(t){return t.getUTCSeconds()}),f=p.range,m=e(function(t){t.setTime(Math.floor(t/h)*h)},function(t,e){t.setTime(+t+e*h)},function(t,e){return(e-t)/h},function(t){return t.getMinutes()}),g=m.range,_=e(function(t){var e=t.getTimezoneOffset()*h%c;0>e&&(e+=c),t.setTime(Math.floor((+t-e)/c)*c+e)},function(t,e){t.setTime(+t+e*c)},function(t,e){return(e-t)/c},function(t){return t.getHours()}),v=_.range,y=e(function(t){t.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*h)/d},function(t){return t.getDate()-1}),b=y.range,w=i(0),x=i(1),M=i(2),T=i(3),L=i(4),C=i(5),P=i(6),S=w.range,A=x.range,D=M.range,I=T.range,k=L.range,E=C.range,z=P.range,B=e(function(t){t.setDate(1),t.setHours(0,0,0,0)},function(t,e){t.setMonth(t.getMonth()+e)},function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())},function(t){return t.getMonth()}),O=B.range,R=e(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t,e){return e.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});R.every=function(t){return isFinite(t=Math.floor(t))&&t>0?e(function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i*t)}):null};var N=R.range,W=e(function(t){t.setUTCSeconds(0,0)},function(t,e){t.setTime(+t+e*h)},function(t,e){return(e-t)/h},function(t){return t.getUTCMinutes()}),Z=W.range,X=e(function(t){t.setUTCMinutes(0,0,0)},function(t,e){t.setTime(+t+e*c)},function(t,e){return(e-t)/c},function(t){return t.getUTCHours()}),Y=X.range,H=e(function(t){t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+e)},function(t,e){return(e-t)/d},function(t){return t.getUTCDate()-1}),U=H.range,F=n(0),G=n(1),V=n(2),j=n(3),q=n(4),K=n(5),$=n(6),J=F.range,Q=G.range,te=V.range,ee=j.range,ie=q.range,ne=K.range,ae=$.range,oe=e(function(t){t.setUTCDate(1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCMonth(t.getUTCMonth()+e)},function(t,e){return e.getUTCMonth()-t.getUTCMonth()+12*(e.getUTCFullYear()-t.getUTCFullYear())},function(t){return t.getUTCMonth()}),re=oe.range,se=e(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)},function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()});se.every=function(t){return isFinite(t=Math.floor(t))&&t>0?e(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i*t)}):null};var le=se.range;t.timeInterval=e,t.timeMillisecond=r,t.timeMilliseconds=s,t.utcMillisecond=r,t.utcMilliseconds=s,t.timeSecond=p,t.timeSeconds=f,t.utcSecond=p,t.utcSeconds=f,t.timeMinute=m,t.timeMinutes=g,t.timeHour=_,t.timeHours=v,t.timeDay=y,t.timeDays=b,t.timeWeek=w,t.timeWeeks=S,t.timeSunday=w,t.timeSundays=S,t.timeMonday=x,t.timeMondays=A,t.timeTuesday=M,t.timeTuesdays=D,t.timeWednesday=T,t.timeWednesdays=I,t.timeThursday=L,t.timeThursdays=k,t.timeFriday=C,t.timeFridays=E,t.timeSaturday=P,t.timeSaturdays=z,t.timeMonth=B,t.timeMonths=O,t.timeYear=R,t.timeYears=N,t.utcMinute=W,t.utcMinutes=Z,t.utcHour=X,t.utcHours=Y,t.utcDay=H,t.utcDays=U,t.utcWeek=F,t.utcWeeks=J,t.utcSunday=F,t.utcSundays=J,t.utcMonday=G,t.utcMondays=Q,t.utcTuesday=V,t.utcTuesdays=te,t.utcWednesday=j,t.utcWednesdays=ee,t.utcThursday=q,t.utcThursdays=ie,t.utcFriday=K,t.utcFridays=ne,t.utcSaturday=$,t.utcSaturdays=ae,t.utcMonth=oe,t.utcMonths=re,t.utcYear=se,t.utcYears=le,Object.defineProperty(t,"__esModule",{value:!0})}),dA.prototype.get=function(){var t=null;for(var e in this._objCollection)if(this._objCollection[e]&&this._objCollection[e]._free===!0)return this._objCollection[e]._free=!1,this._objCollection[e];return t=F(this._elemType),e=this.getGUID(),this._objCollection[e]=t,t},dA.prototype.free=function(t){t&&(t._free=!0,"img"===t.tagName.toLowerCase()&&(t.crossOrigin=null))},dA.prototype.getGUID=function(){return this._counter++,"obj_"+this._counter},dA.prototype.clear=function(){for(var t in this._objCollection)this._objCollection[t]&&"img"===this._objCollection[t].tagName.toLowerCase&&(this._objCollection[t].onload=this._objCollection[t].onerror=null);this._objCollection={},this._counter=0};var av={},M=["swiftshader","microsoft basic render driver"],bg=["intel","nvidia","amd","apple","geforce"];av.ifEnableEarth=function(t){var e=av.ifEnableEarth;return t||"boolean"!=typeof e._enable?av.ifSupportWebGL()?(e._enable=!0,!0):(e._enable=!1,!1):e._enable},av.ifEnableWebGLMap=function(t){var e=av.ifEnableWebGLMap;return t||"boolean"!=typeof e._enable?av.ifSupportWebGL()?(e._enable=!0,!0):(e._enable=!1,!1):e._enable},av.ifSupportWebGL=function(){var t=av.ifSupportWebGL;if("boolean"==typeof t._supportWebGL)return t._supportWebGL;if(!window.WebGLRenderingContext)return t._supportWebGL=!1,!1;if(v.Browser.ie)return t._supportWebGL=!1,!1;var e=document.createElement("canvas");e.width=300,e.height=150;var i=null,n={alpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!1};try{i=e.getContext("webgl",n)||e.getContext("experimental-webgl",n)}catch(a){t._supportWebGL=!1}if(null===i)t._supportWebGL=!1;else{t._supportWebGL=!0;var o=i.getExtension("WEBGL_debug_renderer_info");if(o){var r=i.getParameter(o.UNMASKED_RENDERER_WEBGL);ce(r)===!0&&(t._supportWebGL=!0);var s=i.getParameter(o.UNMASKED_VENDOR_WEBGL);t._renderer=r,t._vendor=s}!o&&v.Browser.firefox&&(t._supportWebGL=!0),!o&&v.Platform.macintosh&&(t._supportWebGL=!0),(i.drawingBufferWidth!==e.width||i.drawingBufferHeight!==e.height)&&(t._supportWebGL=!1),i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<4&&(t._supportWebGL=!1),i.getParameter(i.MAX_TEXTURE_SIZE)<4096&&(t._supportWebGL=!1),(!i.getShaderPrecisionFormat||i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision<23)&&(t._supportWebGL=!1)}return t._supportWebGL},av.ifSupportCanvas2d=function(){var t=av.ifSupportCanvas2d;if("boolean"==typeof t.supportCanvas2d)return t.supportCanvas2d;var e=document.createElement("canvas"),i=null;try{i=e.getContext("2d")}catch(n){t.supportCanvas2d=!1}return t.supportCanvas2d=null===i?!1:!0,t.supportCanvas2d},av.ifEnableCanvas2dMap=function(){var t=navigator.userAgent,e=0,i=0,n=0;if(/macintosh/gi.test(t)){var a=0;return/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(t)&&!/chrome/i.test(t)&&(a=parseInt(RegExp.$1||RegExp.$2,10)),a>0?!1:!0}if(/windows nt (\d+\.\d)/gi.test(t)&&(i=parseFloat(RegExp.$1),i>=6.1)){if(/chrome\/(\d+\.\d)/i.test(t)&&(e=parseFloat(RegExp.$1),e>=31))return!0;if(/MSIE (\d+(\.\d+)?)/.test(t)&&(n=parseFloat(RegExp.$1),n>=10))return!0;if(/Firefox/.test(t))return!0;if(/rv:11.0/gi.test(t))return!0;if(/edge/gi.test(t))return!0}return!1},av.ifSupportCSS3=function(t,e){var i=document.createElement("div"),n="Webkit Moz O ms".split(" "),a=n.length,o="",r=i.style;t in r&&(o=t),t=t.replace(/^[a-z]/,function(t){return t.toUpperCase()});for(;a--;){var s=n[a]+t;if(s in r){o=s;break}}return e?o:o.length>0?!0:!1},av.isModernBrowser=av.ifSupportCanvas2d()&&av.ifSupportCSS3("transform"),cN.prototype.setData=function(t,e){var i=this._cache,n=this._size;if(0!==n){var a=this._curSize;a===n&&this._removeOld();var o;if(i[t]){if(o=i[t],o.data=e,this._most===o)return;o.older&&(o.older.newer=o.newer),o.newer&&(o.newer.older=o.older),this._least===o&&(this._least=o.newer)}else o={key:t,data:e},i[t]=o,null===this._least&&(this._least=o),null===this._most&&(this._most=o),this._curSize++;this._most&&this._most!==o&&(this._most.newer=o,o.older=this._most,this._most=o,o.newer=null)}},cN.prototype.getData=function(t){var e=this._cache[t];if(this._getDataTimes++,e){this._hitTimes++;var i=e.data;return this._most===e?i:(e.older&&(e.older.newer=e.newer),e.newer&&(e.newer.older=e.older),this._least===e&&(this._least=e.newer),this._most.newer=e,e.older=this._most,e.newer=null,this._most=e,i)}return null},cN.prototype.getHitRate=function(){return this._hitTimes/this._getDataTimes},cN.prototype.removeData=function(t){var e=this._cache,i=e[t];i&&(this._options.clearCallback&&this._options.clearCallback(i.data,i.key),i.older&&(i.older.newer=i.newer),i.newer&&(i.newer.older=i.older),this._least===i&&(this._least=i.newer),this._most===i&&(this._most=i.older),delete e[t],this._curSize--)},cN.prototype._removeOld=function(){for(var t=this._cache,e=Math.round(.6*this._size),i=0;this._least&&e>i;){var n=this._least;this._least=n.newer,n.newer&&(n.newer.older=null),this._options.clearCallback&&this._options.clearCallback(n.data,n.key),delete t[n.key],i++}this._curSize-=i,this._options.removeOldCallback&&this._options.removeOldCallback()},cN.prototype.clear=function(){var t=(this._cache,this._least);if(this._options.clearCallback)for(;t;)this._options.clearCallback(t.data,t.key),t=t.newer;this._least=this._most=null,this._cache={},this._curSize=0},cN.prototype.forEach=function(t){for(var e=this._least;e;)t(e.data),e=e.newer},cN.prototype.clearExcept=function(t){for(var e=this._cache,i=this._least;i;)t[i.key]||(this._options.clearCallback&&this._options.clearCallback(i.data,i.key),i.older&&(i.older.newer=i.newer),i.newer&&(i.newer.older=i.older),this._least===i&&(this._least=i.newer),this._most===i&&(this._most=i.older),delete e[i.key],this._curSize--),i=i.newer},au.inherits(co,"Control"),v.extend(au.prototype,{initialize:function(t){return this._map=t,this._container?(this._opts&&this._opts.container?this._opts.container.appendChild(this._container):t.container.appendChild(this._container),this._container):void 0},_i:function(t){!this._container&&this.initialize&&aY(this.initialize)&&(this._container=this.initialize(t)),this._opts=this._opts||{printable:!1},this._setStyle(),this._setPosition(),this._container&&(this._container._jsobj=this)},_setStyle:function(){var t=this._container;if(t){var e=t.style;e.position="absolute",e.zIndex=this._cZIndex||"10",e.MozUserSelect="none",this._opts.printable||v.ac(t,"BMap_noprint"),v.on(t,"contextmenu",bG)}},remove:function(){this._map=null,this._container&&(this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container._jsobj=null,this._container=null)},_render:function(){return this._container=this._opts&&this._opts.container?b4(this._opts.container,'<div unselectable="on"></div>'):b4(this._map.container,'<div unselectable="on"></div>'),0==this._visible&&(this._container.style.display="none"),this._container},_setPosition:function(){this.setAnchor(this._opts.anchor)},setAnchor:function(t){(this.anchorFixed||"number"!=typeof t||isNaN(t)||BMAP_ANCHOR_TOP_LEFT>t||t>BMAP_ANCHOR_BOTTOM_RIGHT)&&(t=this.defaultAnchor),this._opts.offset=this._opts.offset||this.defaultOffset;var e=this._opts.anchor;if(this._opts.anchor=t,this._container){var i=this._container,n=this._opts.offset.width,a=this._opts.offset.height;switch(i.style.left=i.style.top=i.style.right=i.style.bottom="auto",t){case BMAP_ANCHOR_TOP_LEFT:i.style.top=a+"px",i.style.left=n+"px";break;case BMAP_ANCHOR_TOP_RIGHT:i.style.top=a+"px",i.style.right=n+"px";break;case BMAP_ANCHOR_BOTTOM_LEFT:i.style.bottom=a+"px",i.style.left=n+"px";break;case BMAP_ANCHOR_BOTTOM_RIGHT:i.style.bottom=a+"px",i.style.right=n+"px"}var o=["TL","TR","BL","BR"];v.rc(this._container,"anchor"+o[e]),v.ac(this._container,"anchor"+o[t])}},getAnchor:function(){return this._opts.anchor},setOffset:function(t){!t||t&&"Size"!=t.toString()||(this._opts.offset=new ck(t.width,t.height),this._container&&this.setAnchor(this._opts.anchor))},getOffset:function(){return this._opts.offset},getDom:function(){return this._container},show:function(){1!=this._visible&&(this._visible=!0,this._container&&(this._container.style.display=""),this.dispatchEvent(new aw("onshow")))},hide:function(){0!=this._visible&&(this._visible=!1,this._container&&(this._container.style.display="none"),this.dispatchEvent(new aw("onhide")))},isPrintable:function(){return!!this._opts.printable},isVisible:function(){return this._container||this._map?!!this._visible:!1}}),window.BMAP_ANCHOR_TOP_LEFT=0,window.BMAP_ANCHOR_TOP_RIGHT=1,window.BMAP_ANCHOR_BOTTOM_LEFT=2,window.BMAP_ANCHOR_BOTTOM_RIGHT=3,b3.inherits(au,"CopyrightControl"),v.extend(b3.prototype,{initialize:function(t){return this._map=t,this._container},addCopyright:function(t){var e={minZoom:0,bounds:null,content:"",mapType:""};for(var i in t)e[i]=t[i];if(this._map){var n=e.minZoom;(-1===n||n<this._map.getMinZoom()||n>this._map.getMaxZoom())&&(e.minZoom=this._map.getMinZoom()),""===e.mapType||a6[e.mapType]||(e.mapType=BMAP_NORMAL_MAP)}var a=this.getCopyright(t.id);if(a)for(var o in e)a[o]=e[o];else this._copyrightCollection.push(e)},getCopyright:function(t){for(var e=0,i=this._copyrightCollection.length;i>e;e++)if(this._copyrightCollection[e].id===t)return this._copyrightCollection[e]},_asyncLoadCode:function(){var t=this;cl.load("control",function(){t._asyncDraw()})},addSateMapStyle:function(){this.sateMapStyle=!0,this._container&&v.ac(this._container,"BMap_cpyCtrl_w")},removeSateMapStyle:function(){this.sateMapStyle=!1,this._container&&v.rc(this._container,"BMap_cpyCtrl_w")}}),window.BMAP_UNIT_METRIC="metric",window.BMAP_UNIT_IMPERIAL="us",d2.inherits(au,"ScaleControl"),v.extend(d2.prototype,{initialize:function(t){return this._map=t,this._container},setUnit:function(t){this._opts.unit=this._units[t]&&this._units[t].name||this._opts.unit},getUnit:function(){return this._opts.unit},_asyncLoadCode:function(){var t=this;cl.load("control",function(){t._asyncDraw()})},addSateMapStyle:function(){this.sateMapStyle=!0;var t=this._container;t&&v.ac(t.children[0],"dark")},removeSateMapStyle:function(){this.sateMapStyle=!1;var t=this._container;t&&v.rc(t.children[0],"dark")}}),window.BMAP_NAVIGATION_CONTROL_LARGE=0,window.BMAP_NAVIGATION_CONTROL_SMALL=1,window.BMAP_NAVIGATION_CONTROL_PAN=2,window.BMAP_NAVIGATION_CONTROL_ZOOM=3,window.BMAP_NAVIGATION_CONTROL_ANIM=4,bT.inherits(au,"NavigationControl"),v.extend(bT.prototype,{initialize:function(t){return this._map=t,this._container},setType:function(t){this._opts.type="number"==typeof t&&t>=BMAP_NAVIGATION_CONTROL_LARGE&&BMAP_NAVIGATION_CONTROL_ANIM>=t?t:BMAP_NAVIGATION_CONTROL_LARGE},getType:function(){return this._opts.type},_asyncLoadCode:function(){var t=this;cl.load("control",function(){t._asyncDraw()})}}),aL.inherits(au,"MapTypeControl"),v.extend(aL.prototype,{initialize:function(t){return this._map=t,this._container},showStreetLayer:function(t){this._map.showStreetLayer(t)}}),dI.prototype._init=function(){this._render(),this._bindDom(),this._bind(),this._adjustDisplayHeight()},dI.prototype._render=function(){if(this._indoorInfo){var t=this._div=F("div");v.ac(t,"floor-select-container");var e=this._btnTop=F("button");v.ac(e,"floor-switch-top");var i=F("div");v.ac(i,"floor-switch-top-icon"),e.appendChild(i);var n=this._btnBottom=F("button"),a=F("div");v.ac(a,"floor-switch-bottom-icon"),n.appendChild(a),v.ac(n,"floor-switch-bottom");var o=this._floorsContainer=F("div");v.ac(o,"floors-container"),o.appendChild(this._createFloorsDom()),this._div.appendChild(e),this._div.appendChild(o),this._div.appendChild(n);var r=0;""===this._btnTop.style.display&&(r=30),this._div.style.height=parseInt(this._floorsContainer.style.height,10)+r+"px",this._map.getContainer().appendChild(this._div)}},dI.prototype._createFloorsDom=function(){if(this._indoorInfo){for(var t=this._ol=F("ol"),e=this._indoorInfo.currentFloor,i=this._indoorInfo.floors.length-1;i>=0;i--){var n=this._indoorInfo.floors[i].floorName,a=F("li"),o=F("button");v.ac(o,"btn-select-floor"),i===e&&v.ac(o,"selected"),o.setAttribute("data-floor",i),o.innerHTML=n,a.appendChild(o),t.appendChild(a)}return t}},dI.prototype._updateUI=function(){return this._ol?(this._ol=null,this._ol=this._createFloorsDom(),this._floorsContainer.innerHTML="",this._floorsContainer.appendChild(this._ol),void this._adjustDisplayHeight()):(this._render(),void this._bind())},dI.prototype._bindDom=function(){var t=this;v.on(this._floorsContainer,"click",function(e){var i=e.target||e.srcElement;"button"===i.tagName.toLowerCase()&&t._map.showIndoor(t._indoorInfo.uid,parseInt(i.getAttribute("data-floor"),10))}),v.on(this._floorsContainer,"mouseover",function(t){var e=t.target;"button"===e.tagName.toLowerCase()&&v.ac(e,"hover")}),v.on(this._floorsContainer,"mouseout",function(t){var e=t.target;"button"===e.tagName.toLowerCase()&&v.rc(e,"hover")}),v.on(this._btnTop,"mouseover",function(){this._disable||v.ac(this,"hover")}),v.on(this._btnTop,"mouseout",function(){v.rc(this,"hover")}),v.on(this._btnBottom,"mouseover",function(){this._disable||v.ac(this,"hover")}),v.on(this._btnBottom,"mouseout",function(){v.rc(this,"hover")}),v.on(this._btnTop,"click",function(){t._setBarSliderTop(parseInt(t._ol.style.top,10)+26)}),v.on(this._btnBottom,"click",function(){t._setBarSliderTop(parseInt(t._ol.style.top,10)-26)}),v.on(this._div,"mousemove",g),v.on(this._div,"wheel",bG),v.on(this._div,"mousewheel",bG),v.on(window,"resize",function(){t._adjustDisplayHeight()
})},dI.prototype._adjustDisplayHeight=function(){if(this._indoorInfo){var t=window.innerHeight,e=26,i=t-291-100,n=this._indoorInfo.floors.length,a=n*e,o=n,r=0;for(this._showArrow=a>i?!0:!1;a>i&&0!==o;)o--,a=26*o+30,r=30;this._currentDisplayHeight=a,this._setAdjustVisbile(3>o?!1:!0),this._floorsContainer.style.height=o*e+"px";var s=this._indoorInfo.currentFloor;this._div.style.height=parseInt(this._floorsContainer.style.height,10)+r+"px";var l=-(n-(s+Math.round(o/2)))*e;this._setBarSliderTop(l),n>o?(v.show(this._btnTop),v.show(this._btnBottom)):(v.hide(this._btnTop),v.hide(this._btnBottom),this._setBarSliderTop(0))}},dI.prototype._setBarSliderTop=function(t){var e=26,i=this._indoorInfo.floors.length,n=i*e;this._currentDisplayHeight&&(n=this._showArrow?this._currentDisplayHeight-30:this._currentDisplayHeight),n-t>=i*e?(t=n-i*e,v.ac(this._btnBottom,"disable"),v.rc(this._btnBottom,"hover"),this._btnBottom._disable=!0):(v.rc(this._btnBottom,"disable"),this._btnBottom._disable=!1),t>=0?(t=0,v.ac(this._btnTop,"disable"),v.rc(this._btnTop,"hover"),this._btnTop._disable=!0):(v.rc(this._btnTop,"disable"),this._btnTop._disable=!1),this._ol.style.top=t+"px"},dI.prototype._setAdjustVisbile=function(t){this._adjustVisible!==t&&(this._adjustVisible=t,t&&this._visible?v.show(this._div):v.hide(this._div))},dI.prototype._bind=function(){var t=this._map,e=this;t.on("indoor_status_changed",function(t){if(e._visible!==!1){var i=e._ol,n=t.uid;if(n)for(var a=t.floor,o=0;o<i.children.length;o++){var r=i.children[o].children[0];parseInt(r.getAttribute("data-floor"),10)===a?v.ac(r,"selected"):v.rc(r,"selected")}}}),t.on("zoomend",function(){e._setAdjustVisbile(this.getZoom()<17?!1:!0)})},dI.prototype.setInfo=function(t){this._indoorInfo&&this._indoorInfo.uid===t.uid||(this._indoorInfo=t,this._updateUI())},dI.prototype.show=function(){this._visible!==!0&&(this._visible=!0,this._div.style.display="")},dI.prototype.hide=function(){this._visible!==!1&&(this._visible=!1,this._div.style.display="none")},v.extend(cK.prototype,{_init:function(){this._createDom(),this._bindDom(),this._bind(),ds()||(this._headingControl=new ef(this._map,this._div)),this._tiltControl=new cv(this._map,this._div),this._render();var t=this._map.getMapType(),e=this;"B_EARTH_MAP"===t||"webgl"===this._map._renderType?(e._div.style.opacity="1",e._div.style.visibility="visible"):(e._div.style.opacity="0",e._div.style.visibility="hidden")},_createDom:function(){var t=this._div=F("div"),e=t.style;e.position="absolute",e.zIndex=5,e.width="52px",e.height="82px",e.right="-3px",e.bottom="79px",e.opacity="0",e.visibility="hidden",e.WebkitTransition=e.transition="opacity .3s ease-out,visibility .3s ease-out"},_render:function(){var t=document.getElementById("map-operate");t?t.appendChild(this._div):this._map.getContainer().appendChild(this._div)},_bindDom:function(){this._div.addEventListener("mousemove",g)},_bind:function(){if("webgl"!==this._map._renderType){var t=this;this._map.on("maptypechange",function(){"B_EARTH_MAP"===this.mapType?t._firstAnimation?(t._firstAnimation=!1,setTimeout(function(){t._div.style.opacity="1",t._div.style.visibility="visible"},300)):(t._div.style.opacity="1",t._div.style.visibility="visible"):(t._div.style.opacity="0",t._div.style.visibility="hidden")})}}}),v.extend(ef.prototype,{_init:function(){this._createDom(),this._render(),this._bindDom(),this._bind(),this._updateUI(),this._checkEnable()},_checkEnable:function(){this._target.getZoom()>=this._target._enableHeadingZoom?this.enable():this.disable()},_createDom:function(){var t=this._div=F("div"),e=t.style;e.position="absolute",e.zIndex=5,e.top="0",e.left="0",e.width="52px",e.height="54px",e.background="url("+this._imgPath+") no-repeat",e.backgroundSize="266px auto",this._rotateCCW=this._createButton(),this._rotateCCW.title="逆时针转动",e=this._rotateCCW.style,e.left="2px",e.top="5px",e.zIndex="1",e.width="15px",e.height="42px",e.backgroundPosition="-75px -5px",this._rotateCW=this._createButton(),this._rotateCW.title="顺时针转动",e=this._rotateCW.style,e.right="2px",e.top="5px",e.zIndex="1",e.width="15px",e.height="42px",e.backgroundPosition="-75px -5px",e.WebkitTransform=e.transform="scaleX(-1)",this._compass=this._createButton(),this._compass.title="恢复正北方向",e=this._compass.style,e.left="19px",e.top="4px",e.width="14px",e.height="44px",e.backgroundPosition="-56px -4px",e.WebkitTransform=e.transform="rotate(0deg)",this._div.appendChild(this._rotateCCW),this._div.appendChild(this._compass),this._div.appendChild(this._rotateCW),this._domRendered=!0},_createButton:function(){var t=F("button"),e=t.style;return e.position="absolute",e.outline="none",e.border="none",e.background="url("+this._imgPath+") no-repeat",e.backgroundSize="266px auto",e.cursor="pointer",t},_render:function(){this._outContainer.appendChild(this._div)},enable:function(){this._enabled=!0,this._domRendered&&(this._rotateCCW.style.cursor="pointer",this._rotateCCW.style.opacity=1,this._rotateCW.style.cursor="pointer",this._rotateCW.style.opacity=1,this._compass.style.cursor="pointer",this._compass.style.opacity=1)},disable:function(){this._enabled=!1,this._domRendered&&(this._rotateCCW.style.cursor="",this._rotateCCW.style.opacity=.4,this._rotateCW.style.cursor="",this._rotateCW.style.opacity=.4,this._compass.style.cursor="",this._compass.style.opacity=.4)},_bindDom:function(){cC(this._div,["mousedown","click","dblclick"]);var t=this._map,e=this;this._rotateCW.addEventListener("click",function(){e._isOperating||e._enabled===!1||e._target.getLock()||(360===e._target.getHeading()&&e._target.setHeading(0),e._target.setLock(!0),e._target.setHeading(e._target.getHeading()+90,e._setHeadingOptions),t.fire(new aw("onrotatecwclick")))},!1),this._rotateCCW.addEventListener("click",function(){e._isOperating||e._enabled===!1||e._target.getLock()||(-360===e._target.getHeading()&&e._target.setHeading(0),e._target.setLock(!0),e._target.setHeading(e._target.getHeading()-90,e._setHeadingOptions),t.fire(new aw("onrotateccwclick")))},!1),this._rotateCW.addEventListener("mouseover",function(){e._enabled!==!1&&(this.style.backgroundPosition="-89px -5px")},!1),this._rotateCW.addEventListener("mouseout",function(){e._enabled!==!1&&(this.style.backgroundPosition="-75px -5px")},!1),this._rotateCCW.addEventListener("mouseover",function(){e._enabled!==!1&&(this.style.backgroundPosition="-89px -5px")},!1),this._rotateCCW.addEventListener("mouseout",function(){e._enabled!==!1&&(this.style.backgroundPosition="-75px -5px")},!1),this._compass.addEventListener("click",function(){if(!e._isOperating&&e._enabled!==!1&&!e._target.getLock()){e._target.setLock(!0);var i=e._target.getHeading();i%=360,e._target.setHeading(i,{noAnimation:!0}),i>180?e._target.setHeading(360,e._setHeadingOptions):e._target.getHeading()<=-180?e._target.setHeading(-360,e._setHeadingOptions):e._target.setHeading(0,e._setHeadingOptions),e._target.setTilt(0,e._setHeadingOptions),t.fire(new aw("oncompassclick"))}},!1)},_bind:function(){var t=this;this._bindTarget(this._target),"webgl"===this._map._renderType&&this._map.addEventListener("maptypechange",function(){t._target="B_EARTH_MAP"===this.mapType?t._map._earth:t._map,t._bindTarget(t._target),t._checkEnable()})},_bindTarget:function(t){if(!(t===this._map&&this._mapBinded||t===this._map._earth&&this._earthBinded)){var e=this;t.addEventListener("heading_changed",function(){e._updateUI()}),t.addEventListener("animation_start",function(){e._isOperating=!0}),t.addEventListener("animation_end",function(){e._isOperating=!1}),t.on("load",function(){e._checkEnable()}),t.on("zoom_changed",function(){e._checkEnable()}),t===this._map?this._mapBinded=!0:this._earthBinded=!0}},_updateUI:function(){var t=this._target.getHeading(),e=this._compass.style;e.WebkitTransform=e.transform="rotate("+t+"deg)"},hide:function(){this._div.style.display="none"},show:function(){this._div.style.display="block"}}),cv.MAX_TILT=47,v.extend(cv.prototype,{_init:function(){this._createDom(),this._render(),this._bindDom(),this._bind(),this._checkEnable()},_checkEnable:function(){this._target.getZoom()>=this._target._enableTiltZoom?this.enable():this.disable()},_createDom:function(){var t=this._div=F("button");t.title="倾斜";var e=t.style;e.position="absolute",e.zIndex=5,e.outline="none",e.border="none",e.cursor="pointer",e.width="26px",e.height="26px",e.top="56px",e.right="13px",e.background="url("+this._imgPath+") no-repeat #fff",e.backgroundSize="266px auto",e.backgroundPosition="-110px 1px",e.boxShadow="1px 2px 1px rgba(0, 0, 0, 0.15)"},enable:function(){this._enabled=!0,this._div&&(this._div.style.cursor="pointer"),this._updateUI()},disable:function(){this._enabled=!1,this._div&&(this._div.style.cursor=""),this._updateUI()},_render:function(){this._outContainer.appendChild(this._div)},_bindDom:function(){var t=this;this._div.addEventListener("mousedown",function(e){if(t._enabled&&!t._target.getLock()){var i,n=t._target.getTilt();i=n===cv.MAX_TILT?"out":0===n?"in":t._preTrend?t._preTrend:"in",t._curTrend=i,t._clickTimer=setTimeout(function(){t._map.fire(new aw("ontiltmsdown")),t._tiltAni=new m({duration:9999999,render:function(){n=t._target.getTilt(),"in"===i&&n<cv.MAX_TILT?t._target.setTilt(n+1,{noAnimation:!0}):"out"===i&&n>0&&t._target.setTilt(n-1,{noAnimation:!0})},finish:function(){t._tiltAni=null}}),t._clickTimer=null},200),e.stopPropagation()}},!1),this._div.addEventListener("mouseup",function(){t._enabled&&(t._tiltAni&&t._tiltAni.stop(),t._preTrend=t._curTrend)},!1),this._div.addEventListener("click",function(e){if(t._enabled&&t._clickTimer&&!t._target.getLock()){clearTimeout(t._clickTimer),t._map.fire(new aw("ontiltclick"));var i=t._target.getTilt();t._target.setLock(!0),e.stopPropagation(),"in"===t._curTrend?t._target.setTilt(cv.MAX_TILT,t._setTiltOptions):"out"===t._curTrend?t._target.setTilt(0,t._setTiltOptions):i<cv.MAX_TILT?t._target.setTilt(cv.MAX_TILT,t._setTiltOptions):t._target.setTilt(0,t._setTiltOptions)}},!1),this._div.addEventListener("mouseover",function(){t._enabled&&(t._mouseOver=!0,t._updateUI())},!1),this._div.addEventListener("mouseout",function(){t._enabled&&(t._mouseOver=!1,t._updateUI())},!1),cC(this._div,["mousedown","click","dblclick"])},_bind:function(){{var t=this;this._map}this._bindTarget(this._target),"webgl"===this._map._renderType&&this._map.addEventListener("maptypechange",function(){t._target="B_EARTH_MAP"===this.mapType?t._map._earth:t._map,t._bindTarget(t._target),t._checkEnable()})},_bindTarget:function(t){if(!(t===this._map&&this._mapBinded||t===this._map._earth&&this._earthBinded)){var e=this;t.on("load",function(){e._checkEnable()}),t.on("zoom_changed",function(){e._checkEnable()}),t.on("tilt_changed",function(){e._updateUI()}),t===this._map?this._mapBinded=!0:this._earthBinded=!0}},_updateUI:function(){var t=this._target.getTilt(),e=0,i=0,n=0;t>0&&(e=78),this._mouseOver&&(n=52),this._enabled===!1&&(i=26,n=0,e=0);var a="-"+(110+e+i+n)+"px 1px";this._div&&(this._div.style.backgroundPosition=a),this._enabled?t>0?this._div&&(this._div.title="恢复"):this._div&&(this._div.title="倾斜"):this._div&&(this._div.title="请放大地图后操作")},hide:function(){this._div.style.display="none"},show:function(){this._div.style.display="block"}}),bb.inherits(co,"ContextMenu"),v.extend(bb.prototype,{initialize:function(t){this._map=t},remove:function(){this._map=null},addItem:function(t,e){if(t&&"menuitem"==t._type&&""!=t._text&&!(t._width<=0)){for(var i=0,n=this._items.length;n>i;i++)if(this._items[i]===t)return;(void 0===e||e>this._items.length-1)&&(e=-1),t._insertIndex=e,-1===e?(this._items.push(t),this._rItems.push(t)):(this._items.splice(e,0,t),this._rItems.splice(e,0,t))}},removeItem:function(t){if(t&&"menuitem"==t._type){for(var e=0,i=this._items.length;i>e;e++)this._items[e]===t&&(this._items[e].remove(),this._items.splice(e,1),delete t._insertIndex,i--);for(var e=0,i=this._rItems.length;i>e;e++)this._rItems[e]===t&&(this._rItems[e].remove(),this._rItems.splice(e,1),delete t._insertIndex,i--)}},addSeparator:function(t){(void 0===t||t>this._items.length-1)&&(t=-1);var e={_type:"divider",_dIndex:this._dividers.length,_insertIndex:t};this._dividers.push({dom:null}),-1===t?this._items.push(e):this._items.splice(t,0,e)},removeSeparator:function(t){if(this._dividers[t]){for(var e=0,i=this._items.length;i>e;e++)this._items[e]&&"divider"==this._items[e]._type&&this._items[e]._dIndex==t&&(this._items.splice(e,1),i--),this._items[e]&&"divider"==this._items[e]._type&&this._items[e]._dIndex>t&&this._items[e]._dIndex--;this._dividers.splice(t,1)}},getDom:function(){return this._container},show:function(){1!=this._isOpen&&(this._isOpen=!0)},hide:function(){0!=this._isOpen&&(this._isOpen=!1)},setCursor:function(t){t&&(this._opts.cursor=t)},getItem:function(t){return this._rItems[t]},enable:function(){this._enable=!0},disable:function(){this._enable=!1}}),c8.inherits(co,"MenuItem"),v.extend(c8.prototype,{initialize:function(t,e){this._map=t,this._contextmenu=e},remove:function(){this._contextmenu=null,this._map=null},setText:function(t){t&&(this._text=t+"")},getDom:function(){return this._container},enable:function(){this._enabled=!0},disable:function(){this._enabled=!1}}),v.extend(ca.prototype,{setValues:function(t,e,i,n){this.minX=t||null,this.minY=e||null,this.maxX=i||null,this.maxY=n||null},isEmpty:function(){var t="number";return typeof this.minX!==t||typeof this.minY!==t||typeof this.maxX!==t||typeof this.maxY!==t},equals:function(t){return t?this.minX===t.minX&&this.minY===t.minY&&this.maxX===t.maxX&&this.maxY===t.maxY:void 0},containsBounds:function(t){return t?t.minX>this.minX&&t.maxX<this.maxX&&t.minY>this.minY&&t.maxY<this.maxY:void 0},getCenter:function(){return new d8((this.minX+this.maxX)/2,(this.minY+this.maxY)/2)},intersects:function(t){if(t){if(Math.max(t.minX,t.maxX)<Math.min(this.minX,this.maxX)||Math.min(t.minX,t.maxX)>Math.max(this.minX,this.maxX)||Math.max(t.minY,t.maxY)<Math.min(this.minY,this.maxY)||Math.min(t.minY,t.maxY)>Math.max(this.minY,this.maxY))return null;var e=Math.max(this.minX,t.minX),i=Math.min(this.maxX,t.maxX),n=Math.max(this.minY,t.minY),a=Math.min(this.maxY,t.maxY);return new ca(e,n,i,a)}},containsPoint:function(t){return t?t.lng>=this.minX&&t.lng<=this.maxX&&t.lat>=this.minY&&t.lat<=this.maxY:void 0},extend:function(t){if(t){var e=t.lng,i=t.lat;(!this.minX||this.minX>e)&&(this.minX=e),(!this.maxX||this.maxX<e)&&(this.maxX=e),(!this.minY||this.minY>i)&&(this.minY=i),(!this.maxY||this.maxY<i)&&(this.maxY=i)}},getMin:function(){return new d8(this.minX,this.minY)},getMax:function(){return new d8(this.maxX,this.maxY)},div:function(t){return(this.maxX-this.minX)*(this.maxY-this.minY)/((t.maxX-t.minX)*(t.maxY-t.minY))},toString:function(){return"Bounds"}});var ch=d8.prototype;ch.equals=function(t){return t&&"Point"==t.toString()?this.lat==t.lat&&this.lng==t.lng:void 0},ch.clone=function(){return new d8(this.lng,this.lat)},ch.add=function(t){return new d8(this.lng+t.lng,this.lat+t.lat)},ch.sub=function(t){return new d8(this.lng-t.lng,this.lat-t.lat)},ch.mult=function(t){return new d8(this.lng*t,this.lat*t)},ch.div=function(t){return new d8(this.lng/t,this.lat/t)},ch.mag=function(){return Math.sqrt(this.lng*this.lng+this.lat*this.lat)},ch.toString=function(){return"Point"},v.extend(ct,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],getDistanceByMC:function(t,e){if(!t||!e)return 0;var i,n,a,o;return(t=this.convertMC2LL(t))?(i=b5(t.lng),n=b5(t.lat),(e=this.convertMC2LL(e))?(a=b5(e.lng),o=b5(e.lat),this.getDistance(i,a,n,o)):0):0},getDistanceByLL:function(t,e){if(!t||!e)return 0;t.lng=this.getLoop(t.lng,-180,180),t.lat=this.getRange(t.lat,-80,84),e.lng=this.getLoop(e.lng,-180,180),e.lat=this.getRange(e.lat,-80,84);var i,n,a,o;return i=b5(t.lng),a=b5(t.lat),n=b5(e.lng),o=b5(e.lat),this.getDistance(i,n,a,o)},convertMC2LL:function(t){if(null===t)return t;if(!t)return new d8(0,0);var e,i;e=new d8(Math.abs(t.lng),Math.abs(t.lat));for(var n=0;n<this.MCBAND.length;n++)if(e.lat>=this.MCBAND[n]){i=this.MC2LL[n];break}var a=this.convertor(t,i);return new bB(a.lat,a.lng)},convertLL2MC:function(t){if(!t)return new d8(0,0);t.lng=this.getLoop(t.lng,-180,180);for(var e,i=0;i<this.LLBAND.length;i++)if(t.lat>=this.LLBAND[i]){e=this.LL2MC[i];break}if(!e)for(i=0;i<this.LLBAND.length;i++)if(t.lat<=-this.LLBAND[i]){e=this.LL2MC[i];break}var n=new d8(t.lng,t.lat),a=this.convertor(n,e),o=new d8(a.lng,a.lat);return o.latLng=t.clone(),o},convertor:function(t,e){if(t&&e){var i=e[0]+e[1]*Math.abs(t.lng),n=Math.abs(t.lat)/e[9],a=e[2]+e[3]*n+e[4]*n*n+e[5]*n*n*n+e[6]*n*n*n*n+e[7]*n*n*n*n*n+e[8]*n*n*n*n*n*n;return i*=t.lng<0?-1:1,a*=t.lat<0?-1:1,new d8(i,a)}},getDistance:function(t,e,i,n){return this.EARTHRADIUS*Math.acos(Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos(e-t))},getRange:function(t,e,i){return null!=e&&(t=Math.max(t,e)),null!=i&&(t=Math.min(t,i)),t},getLoop:function(t,e,i){for(;t>i;)t-=i-e;for(;e>t;)t+=i-e;return t}}),v.extend(bB.prototype,{equals:function(t){return this.lat===t.lat&&this.lng===t.lng},clone:function(){return new bB(this.lat,this.lng)},getLngSpan:function(t){var e=this.lng,i=Math.abs(t-e);return i>180&&(i=360-i),i},sub:function(t){return new bB(this.lat-t.lat,this.lng-t.lng)},toString:function(){return this.lat+", "+this.lng}}),v.extend(cA.prototype,{isEmpty:function(){return!this._sw||!this._ne},equals:function(t){return this.isEmpty()?!1:this.getSouthWest().equals(t.getSouthWest())&&this.getNorthEast().equals(t.getNorthEast())},getSouthWest:function(){return this._sw},getNorthEast:function(){return this._ne},containsBounds:function(t){return this.isEmpty()||t.isEmpty()?!1:t._swLng>this._swLng&&t._neLng<this._neLng&&t._swLat>this._swLat&&t._neLat<this._neLat},getCenter:function(){return this.isEmpty()?null:new bB((this._swLat+this._neLat)/2,(this._swLng+this._neLng)/2)},intersects:function(t){if(Math.max(t._swLng,t._neLng)<Math.min(this._swLng,this._neLng)||Math.min(t._swLng,t._neLng)>Math.max(this._swLng,this._neLng)||Math.max(t._swLat,t._neLat)<Math.min(this._swLat,this._neLat)||Math.min(t._swLat,t._neLat)>Math.max(this._swLat,this._neLat))return!1;var e=Math.max(this._swLng,t._swLng),i=Math.min(this._neLng,t._neLng),n=Math.max(this._swLat,t._swLat),a=Math.min(this._neLat,t._neLat);return this._sw=new bB(n,e),this._ne=new bB(a,i),this._swLng=e,this._swLat=n,this._neLng=i,this._neLat=a,!0},containsPoint:function(t){return this.isEmpty()?!1:t.lng>=this._swLng&&t.lng<=this._neLng&&t.lat>=this._swLat&&t.lat<=this._neLat},extend:function(t){var e=t.lng,i=t.lat;this._sw||(this._sw=new bB(0,0)),this._ne||(this._ne=new bB(0,0)),(!this._swLng||this._swLng>e)&&(this._sw.lng=this._swLng=e),(!this._neLng||this._neLng<e)&&(this._ne.lng=this._neLng=e),(!this._swLat||this._swLat>i)&&(this._sw.lat=this._swLat=i),(!this._neLat||this._neLat<i)&&(this._ne.lat=this._neLat=i)},toSpan:function(){return this.isEmpty()?new bB(0,0):new bB(Math.abs(this._neLat-this._swLat),Math.abs(this._neLng-this._swLng))},union:function(t){if(t.isEmpty())return!1;var e=t.getSouthWest(),i=t.getNorthEast();return this._swLat>e.lat&&(this._swLat=e.lat),this._swLng>e.lng&&(this._swLng=e.lng),this._neLat<i.lat&&(this._neLat=i.lat),this._neLng<i.lng&&(this._neLng=i.lng),this._sw=new bB(this._swLat,this._swLng),this._ne=new bB(this._neLat,this._neLng),!0},toString:function(){return this._swLat+", "+this._swLng+", "+this._neLat+", "+this._neLng}});var cc={idle:0,freeze:1,zooming:2,dragging:3,moving:4,readyToDrag:5,readyToPinch:6,pinching:7,stdMapCtrlDrag:8,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,arrowOpCodes:{37:1,38:2,39:4,40:8}},cr={_map:null,_html:"<div class='BMap_opMask' unselectable='on'></div>",_maskElement:null,_cursor:"default",inUse:!1,show:function(t){this._map||(this._map=t),this.inUse=!0,this._maskElement||this._createMask(t),this._maskElement.style.display="block"},_createMask:function(t){if(this._map||(this._map=t),this._map){var e=this._maskElement=b4(this._map.container,this._html);v.on(e,"mouseup",function(t){2==t.button&&bG(t)}),v.on(e,"contextmenu",bG),e.style.display="none"}},getDrawPoint:function(t,e,i){t=window.event||t;var n=t.offsetX||t.layerX||0,a=parseInt(t.offsetY)||parseInt(t.layerY)||0,o=t.target||t.srcElement;if(o!=cr.getDom(this._map)&&1==e)for(;o&&o!=this._map.container;)0==o.clientWidth&&0==o.clientHeight&&o.offsetParent&&"td"==o.offsetParent.nodeName.toLowerCase()||(n+=o.offsetLeft,a+=o.offsetTop),o=o.offsetParent;return o!=cr.getDom(this._map)&&o!=this._map.container||"undefined"==typeof n||"undefined"==typeof a||isNaN(n)||isNaN(a)?void 0:(i&&(n+=i.x,a+=i.y),this._map.pixelToPoint(new cs(n,a)))},hide:function(){this._map&&(this.inUse=!1,this._maskElement&&(this._maskElement.style.display="none"))},getDom:function(t){return this._maskElement||this._createMask(t),this._maskElement},setCursor:function(t){this._cursor=t||"default",this._maskElement&&(this._maskElement.style.cursor=this._cursor)}};aB.inherits(v.BaseClass,"Overlay"),aB.getZIndex=function(t,e){return(t=1*t)?(e&&(t=ct.convertMC2LL(new d5.Point(0,t)).lat),-1e5*t<<1):0},v.extend(aB.prototype,{_i:function(t){!this.domElement&&aY(this.initialize)&&(this.domElement=this.initialize(t),this.domElement&&(this.domElement.style.WebkitUserSelect="none")),this.draw()},initialize:function(){throw"initialize方法未实现"},draw:function(){throw"draw方法未实现"},remove:function(){this.domElement&&this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.domElement=null,this.dispatchEvent(new aw("onremove"))},hide:function(){v.hide(this.domElement)},show:function(){v.show(this.domElement)},dispose:function(){v.BaseClass.prototype.decontrol.call(this)}}),bt.inherits(aB,"OverlayInternal"),v.extend(bt.prototype,{initialize:function(t){return this.map=t,v.BaseClass.call(this,this.hashCode),null},draw:function(){},remove:function(){this.map=null,this.decontrol(),aB.prototype.remove.call(this)},hide:function(){this._visible=!1},show:function(){this._visible=!0},getDom:function(){return this.domElement},setConfig:function(t){t=t||{};for(var e in t)typeof this._config[e]==typeof t[e]&&(this._config[e]=t[e])},getPoint:function(t,e){if(!t)return this.point;var i=e?e.width:0,n=e?e.height:0;if(this.map){var a=this.map.pointToPixel(this.point);return this._config&&this._config.offset?(a.x=a.x+this._config.offset.width+i,a.y=a.y+this._config.offset.height+n):(a.x=a.x+i,a.y=a.y+n),this.map.pixelToPoint(a)}},setZIndex:function(t){this.zIndex=t},isVisible:function(){return this.domElement?!!this._visible:!1},enableMassClear:function(){this._config.enableMassClear=!0},disableMassClear:function(){this._config.enableMassClear=!1},showInternal:function(){this._visibleInternal=!0},hideInternal:function(){this._visibleInternal=!1}}),cM.prototype._init=function(){"webgl"!==this.map._renderType?this._createOverlayContainers():this._createWebGLOverlayContainers(),this._bind()},cM.prototype._createOverlayContainers=function(){var t=this.map;t.temp.overlayDiv=t.overlayDiv=this._createOverlayDiv(t.platform,200),t.temp.overlayDivEx=t.overlayDivEx=this._createOverlayDiv(t.platform,50),t._panes.floatPane=this._createOverlayDiv(t.temp.overlayDiv,800),t._panes.markerMouseTarget=this._createOverlayDiv(t.temp.overlayDiv,700),t._panes.floatShadow=this._createOverlayDiv(t.temp.overlayDiv,600),t._panes.labelPane=this._createOverlayDiv(t.temp.overlayDiv,500),t._panes.markerPane=this._createOverlayDiv(t.temp.overlayDiv,400),t._panes.mapPane=t.isCanvasMap()?this._createOverlayDiv(t.temp.overlayDivEx,50):this._createOverlayDiv(t.temp.overlayDiv,200)},cM.prototype._createWebGLOverlayContainers=function(){var t=this.map;t.temp.overlayDiv=t.overlayDiv=this._createOverlayDiv(t.platform,200),t._panes.floatPane=this._createOverlayDiv(t.temp.overlayDiv,800),t._panes.markerMouseTarget=this._createOverlayDiv(t.temp.overlayDiv,700),t._panes.floatShadow=this._createOverlayDiv(t.temp.overlayDiv,600),t._panes.labelPane=this._createOverlayDiv(t.temp.overlayDiv,500)},cM.prototype._createOverlayDiv=function(t,e){var i=F("div"),n=i.style;return n.position="absolute",n.top=n.left=n.width=n.height="0",n.zIndex=e,t.appendChild(i),i},cM.prototype._bind=function(){function t(t){a.draw(t)}function e(){("B_EARTH_MAP"===this.getMapType()||"webgl"===this._renderType)&&a._zoomingOrMoving===!1&&(this._panes.markerMouseTarget.style.display="none",a._zoomingOrMoving=!0)}function i(t){if(("B_EARTH_MAP"===this.getMapType()||"webgl"===this._renderType)&&a._zoomingOrMoving===!0){this._panes.markerMouseTarget.style.display="",a._zoomingOrMoving=!1;for(var e=0;e<a._overlayArray.length;e++){var i=a._overlayArray[e];i instanceof bS==!0&&i.draw(t)}}}var n=this.map,a=this;"webgl"!==n._renderType?(n.addEventListener("load",t),n.addEventListener("moveend",t),n.addEventListener("resize",t),n.addEventListener("zoomend",t),n.addEventListener("zooming",t)):n.on("update",t),n.addEventListener("zoomend",function(){"B_EARTH_MAP"===this.mapType&&(this._earth.getZoom()<2?(this.temp.overlayDiv.style.display="none",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display="none")):"none"===this.temp.overlayDiv.style.display&&(this.temp.overlayDiv.style.display="",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display=""),this.temp.infoWin&&this.temp.infoWin.isOpen()&&this.temp.infoWin.redraw()))}),n.addEventListener("oncenterandzoom",function(t){a.draw(t),"B_EARTH_MAP"===this.mapType&&(this._earth.getZoom()<2?(this.temp.overlayDiv.style.display="none",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display="none")):"none"===this.temp.overlayDiv.style.display&&(this.temp.overlayDiv.style.display="",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display=""),this.temp.infoWin&&this.temp.infoWin.isOpen()&&this.temp.infoWin.redraw()))}),n.addEventListener("maptypechange",function(t){"B_EARTH_MAP"===this.mapType?(this._panes.mapPane&&(this._panes.mapPane.style.display="none"),this._earth.getZoom()<2?(this.temp.overlayDiv.style.display="none",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display="none")):"none"===this.temp.overlayDiv.style.display&&(this.temp.overlayDiv.style.display="",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display=""),this.temp.infoWin&&this.temp.infoWin.isOpen()&&this.temp.infoWin.redraw()),this._panes.markerPane&&(this._panes.markerPane.style.display="none")):(this._panes.mapPane&&(this._panes.mapPane.style.display=""),this._panes.markerPane&&(this._panes.markerPane.style.display=""),"none"===this.temp.overlayDiv.style.display&&(this.temp.overlayDiv.style.display="",this.temp.overlayDivEx&&(this.temp.overlayDivEx.style.display=""),this.temp.infoWin&&this.temp.infoWin.isOpen()&&this.temp.infoWin.redraw())),a.draw(t)}),n.on("earthstatuschange",function(t){a.draw(t)}),n.addEventListener("addoverlay",function(t){var e=t.target;if(e instanceof bt)a._overlays[e.hashCode]||(a._overlays[e.hashCode]=e,a._overlayArray.push(e));else{for(var i=!1,n=0,o=a._customOverlays.length;o>n;n++)if(a._customOverlays[n]===e){i=!0;break}i||a._customOverlays.push(e)}}),n.addEventListener("removeoverlay",function(t){var e=t.target;if(e instanceof bt){delete a._overlays[e.hashCode];for(var i=0;i<a._overlayArray.length;i++)if(a._overlayArray[i]===e){a._overlayArray.splice(i,1);break}}else for(var i=0,n=a._customOverlays.length;n>i;i++)if(a._customOverlays[i]===e){a._customOverlays.splice(i,1);break}}),n.addEventListener("clearoverlays",function(){this.closeInfoWindow(),this.closeSimpleInfoWindow();for(var t in a._overlays)a._overlays[t]._config.enableMassClear&&this.removeOverlay(a._overlays[t]);for(var e=0,i=a._customOverlays.length;i>e;e++)a._customOverlays[e]?a._customOverlays[e].enableMassClear!==!1&&(this.removeOverlay(a._customOverlays[e]),a._customOverlays[e]=null,a._customOverlays.splice(e,1),e--,i--):(a._customOverlays.splice(e,1),e--,i--)}),n.addEventListener("infowindowopen",function(){var t=this.infoWindow;t&&(v.hide(t.popDom),v.hide(t.shadowDom))}),n.addEventListener("movestart",e),n.addEventListener("moveend",i),n.addEventListener("zoomstart",e),n.addEventListener("zoomend",i),n.addEventListener("animation_start",e),n.addEventListener("animation_end",i),n.addEventListener("displayoptions_changed",function(){this.temp.overlayDiv.style.display=this._displayOptions.showOverlay===!1?"none":""})},cM.prototype.draw=function(t){if(t=t||{},"B_EARTH_MAP"===this.map.getMapType())for(var e=0;e<this._overlayArray.length;e++){var i=this._overlayArray[e];i instanceof q!=!0&&(this._zoomingOrMoving&&i instanceof bS==!0||i.draw(t))}else for(var e=0,n=this._overlayArray.length;n>e;e++){var i=this._overlayArray[e];this._zoomingOrMoving&&i instanceof bS==!0||i.draw(t)}if(v.each(this._customOverlays,function(e){e.draw(t)}),this.map.temp.infoWin&&this.map.temp.infoWin.setPosition(t.center,t.zoom),"B_EARTH_MAP"!==this.map.getMapType()&&"webgl"!==this.map._renderType&&d5.DrawerSelector){var a=d5.DrawerSelector.getDrawer(this.map);a.setPalette()}},d5.register(function(t){new cM(t)}),q.JOININDEX={miter:0,round:1,bevel:2},q.CAPINDEX={round:0,butt:1,square:2},q.inherits(bt,"Graph"),q.getGraphPoints=function(t){var e=[];if(!t||0===t.length)return e;if("string"==typeof t){var i=t.split(";");v.each(i,function(t){var i=t.split(",");e.push(new d8(i[0],i[1]))})}return t.constructor==Array&&t.length>0&&(e=t),e},q.parseTolerance={0:[.09,.005,1e-4,1e-5],1:[9e3,500,10,1]},v.extend(q.prototype,{initialize:function(t){return this.map=t,null},draw:function(){},setPoints:function(t){this._parseCache.length=0,this._parseCacheGL.length=0,this._parseCacheGLRaw.length=0,this._areaCacheGL.length=0,this.points=q.getGraphPoints(t).slice(0),this._calcBounds()},_calcBounds:function(){if(this.points){var t=this;t._bounds=new ca,v.each(this.points,function(e){t._bounds.extend(e)})}},getPoints:function(){return this.points},setPointAt:function(t,e){e&&this.points[t]&&(this._parseCache.length=0,this._parseCacheGL.length=0,this._parseCacheGLRaw.length=0,this._areaCacheGL.length=0,this.points[t]=new d8(e.lng,e.lat),this._calcBounds())
},setStrokeColor:function(t){this._config.strokeColor=t},getStrokeColor:function(){return this._config.strokeColor},setStrokeLineCap:function(t){this._config.strokeLineCap=t},getStrokeLineCap:function(){return this._config.strokeLineCap},setStrokeLineJoin:function(t){this._config.strokeLineJoin=t},getStrokeLineJoin:function(){return this._config.strokeLineJoin},setStrokeWeight:function(t){t>0&&(this._config.strokeWeight=t)},getStrokeWeight:function(){return this._config.strokeWeight},setStrokeOpacity:function(t){!t||t>1||0>t||(this._config.strokeOpacity=t)},getStrokeOpacity:function(){return this._config.strokeOpacity},setFillOpacity:function(t){t>1||0>t||(this._config.fillOpacity=t)},getFillOpacity:function(){return this._config.fillOpacity},setStrokeStyle:function(t){("solid"==t||"dashed"==t||"dotted"==t)&&(this._config.strokeStyle=t)},getStrokeStyle:function(){return this._config.strokeStyle},setFillColor:function(t){this._config.fillColor=t||""},getFillColor:function(){return this._config.fillColor},getBounds:function(){return this._bounds},remove:function(){this.map&&this.map.removeEventListener("onmousemove",this._graphMouseEvent),bt.prototype.remove.call(this),this._parseCache.length=0,this._parseCacheGL.length=0,this._parseCacheGLRaw.length=0,this._areaCacheGL.length=0;var t=new aw("onlineupdate");t.action="remove",t.overlay=this,this.fire(t)},enableEditing:function(){this._config.enableEditing=!0},disableEditing:function(){this._config.enableEditing=!1},getParsedPoints:function(){var t,e=this.map,i=this.getParseCacheIndex(e.getZoom());if(this._parseCache[i])t=this._parseCache[i];else{var n=ee(this.points,this.getParseTolerance(e.getZoom(),e.config.coordType));t=this._parseCache[i]=n}return[t]}}),v.Browser.ie&&document.namespaces&&!document.namespaces.olv&&document.namespaces.add("olv","urn:schemas-microsoft-com:vml");var ej=d0.prototype;ej.setImageUrl=function(t){t&&(this.imageUrl=t,this._renderData=null)},ej.setPrintImageUrl=function(t){t&&(this.printImageUrl=t)},ej.setSize=function(t){t&&(this.size=new ck(t.width,t.height),this._renderData=null)},ej.setOffset=function(t){t&&(this.offset=new ck(t.width,t.height),this._renderData=null)},ej.setImageOffset=function(t){t&&(this.imageOffset=new ck(t.width,t.height),this._renderData=null)},ej.setInfoWindowOffset=function(t){t&&(this.infoWindowOffset=new ck(t.width,t.height))},ej.toString=function(){return"Icon"},ej.setImageSize=function(t){t&&(this.imageSize=new ck(t.width,t.height))},ej.setImageSrcset=function(t){var e="";if(t){for(var i in t)t.hasOwnProperty(i)&&(this.srcSetObject[i]=t[i],e=t[i]+" "+i+",");this.srcSet=e}},ej.generateRenderData=function(){var t=this.offset,e=this.size,i=(this.imageOffset,[]);return i.push(-t.width,t.height-e.height,0),i.push(e.width-t.width,t.height-e.height,0),i.push(e.width-t.width,t.height,0),i.push(-t.width,t.height-e.height,0),i.push(e.width-t.width,t.height,0),i.push(-t.width,t.height,0),{vertex:i}},ej.getRenderData=function(){return this._renderData||(this._renderData=this.generateRenderData()),this._renderData},T.inherits(v.BaseClass,"InfoWindow"),v.extend(T.prototype,{setWidth:function(t){t=1*t,!t&&0!=t||isNaN(t)||0>t||(0!=t&&(220>t&&(t=220),t>730&&(t=730)),this._config.width=t)},setHeight:function(t){t=1*t,!t&&0!=t||isNaN(t)||0>t||(0!=t&&(60>t&&(t=60),t>650&&(t=650)),this._config.height=t)},setMaxWidth:function(t){t=1*t,!t&&0!=t||isNaN(t)||0>t||(0!=t&&(220>t&&(t=220),t>730&&(t=730)),this._config.maxWidth=t)},setTitle:function(t){this._config.title=t||""},setContent:function(t){this.content=t||""},setMaxContent:function(t){this._config.maxContent=t||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=!0},disableAutoPan:function(){this._config.enableAutoPan=!1},enableCloseOnClick:function(){this._config.enableCloseOnClick=!0},disableCloseOnClick:function(){this._config.enableCloseOnClick=!1},enableMaximize:function(){this._config.enableMaximize=!0},disableMaximize:function(){this._config.enableMaximize=!1},show:function(){this._visible=!0},hide:function(){this._visible=!1},close:function(){this.hide()},dispose:function(){v.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=!0},restore:function(){this.isWinMax=!1},setConfig:function(t){if(t)for(var e in t)typeof this._config[e]==typeof t[e]&&(this._config[e]=t[e])},isVisible:function(){return this.isOpen()},isOpen:function(){return!1},getPoint:function(){return this.overlay&&this.overlay.getPoint?this.overlay.getPoint():void 0},getOffset:function(){return this._config.offset},dispose:function(){v.BaseClass.prototype.decontrol.call(this)},toString:function(){return"InfoWindow"}}),bE.prototype.openInfoWindow=function(t,e){if(t&&"InfoWindow"==t.toString()&&e&&"Point"==e.toString()){var i=this.temp;if(i.marker)i.marker.setPoint(e);else{var n=new d0(cR.imgPath+"blank.gif",{width:1,height:1});i.marker=new bS(e,{icon:n,width:1,height:1,offset:new ck(0,0),infoWindowOffset:new ck(0,0),clickable:!1}),i.marker._fromMap=1}this.addOverlay(i.marker),i.marker.show(),i.marker.openInfoWindow(t)}},bE.prototype.closeInfoWindow=function(){var t=this.temp.infoWin||this.temp._infoWin;t&&t.overlay&&t.overlay.closeInfoWindow()},bt.prototype.openInfoWindow=function(t){this.map&&(this.map.closeInfoWindow(),t._visible=!0,this.map.temp._infoWin=t,t.overlay=this,v.BaseClass.call(t,t.hashCode))},bt.prototype.closeInfoWindow=function(){this.map&&this.map.temp._infoWin&&(this.map.temp._infoWin._visible=!1,this.map.temp._infoWin.decontrol(),this.map.temp._infoWin=null)},ac.inherits(bt,"Label"),v.extend(ac.prototype,{setPoint:function(t){t&&"Point"===t.toString()&&!this.getMarker()&&(this.point=this._config.point=new d8(t.lng,t.lat))},setContent:function(t){this.content=t},setOpacity:function(t){t>=0&&1>=t&&(this._config.opacity=t)},setOffset:function(t){t&&"Size"===t.toString()&&(this._config.offset=new ck(t.width,t.height))},getOffset:function(){return this._config.offset},setStyle:function(t){t=t||{},this._config.styles=v.extend(this._config.styles,t)},setStyles:function(t){this.setStyle(t)},setTitle:function(t){this._config.title=t||""},getTitle:function(){return this._config.title},setMarker:function(t){this._marker&&this._marker!==t&&(this._marker._config.label=null),this._marker=t,this.point=this._config.point=t?t.getPoint():null},getMarker:function(){return this._marker||null}}),window.BMAP_ANIMATION_DROP=1,window.BMAP_ANIMATION_BOUNCE=2,bS.TOP_ZINDEX=aB.getZIndex(-90)+1e6,bS.DRAG_ZINDEX=bS.TOP_ZINDEX+1e6,bS._injectMethond=function(t){v.extend(bS.prototype,t)},bS.inherits(bt,"Marker"),v.extend(bS.prototype,{setIcon:function(t){t&&"Icon"==t.toString()&&(this._config.icon=t,this.textureCoord=this.textureCoordGLMap=null)},getIcon:function(){return this._config.icon},setLabel:function(t){t&&"Label"==t.toString()&&(this._config.label=t,t._config.enableMassClear=this._config.enableMassClear,t.setPoint(this.point))},getLabel:function(){return this._config.label},enableDragging:function(){this._config.enableDragging=!0},disableDragging:function(){this._config.enableDragging=!1},setPoint:function(t){t&&"Point"==t.toString()&&(this.point=this._config.point=new d8(t.lng,t.lat),this.pointForHigherZoom=z(this.point),this.latLng=ct.convertMC2LL(t))},setTop:function(t,e){this._config.isTop=!!t,t&&(this._addi=e||0)},setTitle:function(t){this._config.title=t},getTitle:function(){return this._config.title||""},setOffset:function(t){t&&"Size"==t.toString()&&(this._config.offset=t)},getOffset:function(){return this._config.offset},setAnimation:function(t){this._animation=t}}),a.inherits(q,"Polyline"),c2.inherits(a,"PolylineMultipart"),v.extend(c2.prototype,{setPoints:function(t){this._parseCache.length=0,this._parseCacheGL.length=0,this._parseCacheGLRaw.length=0,this._areaCacheGL.length=0;var e=[];t&&t.constructor===Array&&(v.each(t,function(t){e.push(q.getGraphPoints(t))}),this.points=e,this._calcBounds())},_calcBounds:function(){if(this.points){var t=this;t._bounds=new ca,v.each(this.points,function(e){v.each(e,function(e){t._bounds.extend(e)})})}}}),ah.inherits(q,"Polygon"),v.extend(ah.prototype,{setPoints:function(t,e){this._userPoints=q.getGraphPoints(t).slice(0);var i=q.getGraphPoints(t).slice(0);i.length>1&&!i[0].equals(i[i.length-1])&&i.push(new d8(i[0].lng,i[0].lat)),q.prototype.setPoints.call(this,i,e)},setPointAt:function(t,e){this._userPoints[t]&&(this._userPoints[t]=new d8(e.lng,e.lat),this.points[t]=new d8(e.lng,e.lat),0!=t||this.points[0].equals(this.points[this.points.length-1])||(this.points[this.points.length-1]=new d8(e.lng,e.lat)),this._calcBounds())},getPoints:function(){var t=this._userPoints;return 0==t.length&&(t=this.points),t}}),du.parseTolerance={0:[.01,1e-4,1e-5,4e-6],1:[1e3,10,1,.4]},du.inherits(ah,"Circle"),v.extend(du.prototype,{initialize:function(t){return this.map=t,this.points=this._getPerimeterPoints(this.point,this.radius),this._calcBounds(),null},getPoint:function(){return this.point},getCenter:function(){return this.point},setPoint:function(t){t&&(this.point=t)},setCenter:function(t,e){this.setPoint(t,e)},getRadius:function(){return this.radius},setRadius:function(t){this.radius=Math.abs(t)},_getPerimeterPoints:function(t,e){if(!t||!e||!this.map)return[];var i=(this.map,t.lng),n=t.lat,a=ct.convertMC2LL(t);i=a.lng,n=a.lat;for(var o=[],r=e/6370996.81,s=Math.PI/180*n,l=Math.PI/180*i,h=0;360>h;h+=9){var c=Math.PI/180*h,d=Math.asin(Math.sin(s)*Math.cos(r)+Math.cos(s)*Math.sin(r)*Math.cos(c)),u=Math.atan2(Math.sin(c)*Math.sin(r)*Math.cos(s),Math.cos(r)-Math.sin(s)*Math.sin(d)),p=(l-u+Math.PI)%(2*Math.PI)-Math.PI,f=new bB(d*(180/Math.PI),p*(180/Math.PI));o.push(ct.convertLL2MC(f))}var m=o[0];return o.push(new d8(m.lng,m.lat)),this._radiusMercator=m?Math.sqrt(Math.pow(m.lng-this.point.lng,2)+Math.pow(m.lat-this.point.lat,2)):this.radius,o}});var aK={};eg.inherits(v.BaseClass,"SimpleInfoWindow"),v.extend(eg.prototype,{setWidth:function(t){t=1*t,!t&&0!=t||isNaN(t)||0>t||(0!=t&&(50>t&&(t=50),t>730&&(t=730)),this._config.width=t)},setHeight:function(t){t=1*t,t-=10,!t&&0!=t||isNaN(t)||0>t||(0!=t&&(50>t&&(t=50),t>650&&(t=650)),this._config.height=t)},setMaxWidth:function(t){t=1*t,!t&&0!=t||isNaN(t)||0>t||(0!=t&&(50>t&&(t=50),t>730&&(t=730)),this._config.maxWidth=t)},setTitle:function(t){this._config.title=t||""},setContent:function(t){this.content=t||""},setMaxContent:function(t){this._config.maxContent=t||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=!0},disableAutoPan:function(){this._config.enableAutoPan=!1},enableCloseOnClick:function(){this._config.enableCloseOnClick=!0},disableCloseOnClick:function(){this._config.enableCloseOnClick=!1},enableMaximize:function(){this._config.enableMaximize=!0},disableMaximize:function(){this._config.enableMaximize=!1},show:function(){this._visible=!0},hide:function(){this._visible=!1},close:function(){this.hide()},dispose:function(){v.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=!0},restore:function(){this.isWinMax=!1},setConfig:function(t){if(t)for(var e in t)typeof this._config[e]==typeof t[e]&&(this._config[e]=t[e])},isVisible:function(){return this.isOpen()},isOpen:function(){return!1},getPoint:function(){return this.overlay&&this.overlay.getPoint?this.overlay.getPoint():void 0},getOffset:function(){return this._config.offset},dispose:function(){v.BaseClass.prototype.decontrol.call(this)},toString:function(){return"SimpleInfoWindow"}}),bE.prototype.openSimpleInfoWindow=function(t,e){if(t&&"SimpleInfoWindow"==t.toString()&&e&&"Point"==e.toString()){var i=this.temp;if(i.marker)i.marker.setPoint(e);else{var n=new d0(cR.imgPath+"blank.gif",{width:1,height:1});i.marker=new bS(e,{icon:n,width:1,height:1,offset:new ck(0,0),infoWindowOffset:new ck(0,0),clickable:!1}),i.marker._fromMap=1}this.addOverlay(i.marker),i.marker.show(),i.marker.openSimpleInfoWindow(t)}},bE.prototype.closeSimpleInfoWindow=function(){var t=this.temp.infoWin||this.temp._infoWin;t&&t.overlay&&t.overlay.closeSimpleInfoWindow()},bt.prototype.openSimpleInfoWindow=function(t){this.map&&(this.map.closeSimpleInfoWindow(),t._visible=!0,this.map.temp._infoWin=t,t.overlay=this,v.BaseClass.call(t,t.hashCode))},bt.prototype.closeSimpleInfoWindow=function(){this.map&&this.map.temp._infoWin&&(this.map.temp._infoWin._visible=!1,this.map.temp._infoWin.decontrol(),this.map.temp._infoWin=null)},cs.prototype.equals=function(t){return t?t.x==this.x&&t.y==this.y:!1},cs.prototype.clone=function(){return new cs(this.x,this.y)},cs.prototype.toString=function(){return"Pixel"},ck.prototype.equals=function(t){return!(!t||this.width!=t.width||this.height!=t.height)},ck.prototype.toString=function(){return"Size"};var aQ={B_NORMAL_MAP:{tileUrls:["//online0.map.bdimg.com/onlinelabel/","//online1.map.bdimg.com/onlinelabel/","//online2.map.bdimg.com/onlinelabel/","//online3.map.bdimg.com/onlinelabel/"],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,webgl:{minZoom:3,maxZoom:21},zoomLevelBase:18,errorUrl:cR.imgPath+"bg.png",bounds:new ca(-21364736,-11708041.66,23855104,12474104.17),imgExtend:"png"},B_SATELLITE_MAP:{tileUrls:["https://ss0.bdstatic.com/5bwHcj7lABFU8t_jkk_Z1zRvfdw6buu/it/","https://ss1.bdstatic.com/5bwHcj7lABFU8t_jkk_Z1zRvfdw6buu/it/","https://ss2.bdstatic.com/5bwHcj7lABFU8t_jkk_Z1zRvfdw6buu/it/","https://ss3.bdstatic.com/5bwHcj7lABFU8t_jkk_Z1zRvfdw6buu/it/"],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:cR.imgPath+"bg.png",bounds:new ca(-21364736,-10616832,23855104,15859712),imgExtend:"png"},B_STREET_MAP:{tileUrls:["http://mapor0.bdimg.com/onlinelabel/","http://mapor1.bdimg.com/onlinelabel/"],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:cR.imgPath+"bg.png",bounds:new ca(-21364736,-10616832,23855104,15859712),imgExtend:"png"},BMAP_CUSTOM_LAYER:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:cR.imgPath+"blank.gif",bounds:new ca(-21364736,-10616832,23855104,15859712),imgExtend:"png"},B_EARTH_MAP:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,webgl:{minZoom:3,maxZoom:21},zoomLevelBase:18,errorUrl:cR.imgPath+"blank.gif",bounds:new ca(-21364736,-10616832,23855104,15859712),imgExtend:"png"}},a6=aQ;aW.prototype._addLoadCbk=function(t){this._cbks.push(t)},aW.prototype._load=function(){this.img.src=FeBrowser.ie<=6&&FeBrowser.ie>0&&this._transparentPng?cR.imgPath+"blank.gif":this.src},aW.prototype._callCbks=function(){for(var t=this,e=0;e<t._cbks.length;e++)t._cbks[e]();t._cbks.length=0};var J=!v.Browser.ie||v.Browser.ie>8;d5.register(function(t){if("webgl"!==t._renderType){var e=t.tileMgr=new cX(t);t.addEventListener("mousewheel",function(t){e.mouseWheel(t)}),t.addEventListener("dblclick",function(t){e.dblClick(t)}),t.addEventListener("rightdblclick",function(t){e.dblClick(t)}),t.addEventListener("minuspress",function(t){e.keypress(t)}),t.addEventListener("pluspress",function(t){e.keypress(t)}),t.addEventListener("load",function(){this.mapType!==BMAP_EARTH_MAP&&e.loadTiles()}),t.addEventListener("zoomstartcode",function(t){this.mapType!==BMAP_EARTH_MAP&&e._zoom(t)}),t.addEventListener("moving",function(){this.mapType!==BMAP_EARTH_MAP&&e.moveGridTiles()}),t.addEventListener("resize",function(t){this.mapType!==BMAP_EARTH_MAP&&e.resizeMap(t)}),t.addEventListener("addtilelayer",function(t){e.addTileLayer(t)}),t.addEventListener("removetilelayer",function(t){e.removeTileLayer(t)})}}),v.extend(cX.prototype,{addTileLayer:function(t){var e=this,i=t.target;e.tileLayers.push(i),e.map.loaded&&e.moveGridTiles()},removeTileLayer:function(t){var e=this,i=t.target,n=i.mapType,a=e.mapTiles,o=e.bufferTiles;for(var r in o){var s=r.split("-")[1];s==n&&delete o[r]}for(var r in a){var s=r.split("-")[1];s==n&&delete a[r]}e.zoomsDiv&&e.zoomsDiv.parentNode&&(e.zoomsDiv.parentNode.removeChild(e.zoomsDiv),e.zoomsDiv.innerHTML="");var l=e.map;if(l.deepZoom){var h=l.deepZoom.preDeepZoomDiv;h&&h.parentNode&&h.parentNode.removeChild(h)}for(var c=0,d=e.tileLayers.length;d>c;c++)i==e.tileLayers[c]&&e.tileLayers.splice(c,1);e.moveGridTiles()},hideDeepZoomDiv:function(){var t=this,e=t.map;if(e.deepZoom){var i=e.deepZoom.preDeepZoomDiv;i&&"none"!=i.style.display&&(i.style.display="none")}},getTileLayer:function(t){for(var e=this,i=0,n=e.tileLayers.length;n>i;i++)if(tilelayer=e.tileLayers[i],tilelayer.mapType==t)return tilelayer;return null},_zoom:function(){var t=this;t.zoomsDiv&&"none"!=t.zoomsDiv.style.display&&(t.zoomsDiv.style.display="none"),t.hideDeepZoomDiv(),setTimeout(function(){t.moveGridTiles(),t.map.dispatchEvent(new aw("onzoomend"))},10)},resizeMap:function(){this.loaded=!1,this.moveGridTiles()},_checkTilesLoaded:function(){this.numLoading--;var t=this;0==this.numLoading&&(this._checkLoadedTimer&&(clearTimeout(this._checkLoadedTimer),this._checkLoadedTimer=null),this._checkLoadedTimer=setTimeout(function(){0==t.numLoading&&t.map.dispatchEvent(new aw("ontilesloaded")),t._checkLoadedTimer=null},80))},getTileName:function(t,e){var i=e.mapType,n="TILE-"+i+"-"+t[0]+"-"+t[1]+"-"+t[2];return n},hideTile:function(t,e){var i=t.img;d1(i)&&(t.loaded&&this.imgNumber--,i.parentNode&&(c4(i),i.parentNode.removeChild(i)));var n=new aw("onimagechange");n.tile=this.getTileName(t.info,e),n.action="hide",delete this.mapTiles[t.name],t.loaded||(c4(i),t._callCbks(),i=null,t.img=null,t.mgr=null),this.map.dispatchEvent(n)},loadTiles:function(){var t=this;if(v.Browser.ie)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e){}this.zoomsDiv&&"none"!=this.zoomsDiv.style.display&&(this.zoomsDiv.style.display="none"),t.hideDeepZoomDiv(),t.moveGridTiles()},getCell:function(t,e){var i=this.baseUnits*Math.pow(2,this.baseZoomLevel-e),n=parseInt(t.lng/i),a=parseInt(t.lat/i);return[n,a,i*(n+.5),i*(a+.5)]},moveGridTiles:function(){var t=this.map,e=t.getMapType(),i=this.tileLayers.length,n=t.centerPoint;e!==BMAP_SATELLITE_MAP&&(n=cg.calcLoopCenterPoint(n));for(var a=t.width,o=t.getZoomUnits(),r=o*a,s=n.lng-r/2,l=n.lng+r/2,h=cg.isAddWidth(s,l),c=0;i>c;c++){var d=this.tileLayers[c];(d.baseLayer||1==i)&&(this.tilesDiv=d.tilesDiv);for(var u=a6[d.mapType],p=t.zoomLevel,f=t.getZoomUnits(t.zoomLevel),m=u.baseUnits*Math.pow(2,u.zoomLevelBase-p),g=Math.floor(n.lng/m),_=Math.floor(n.lat/m),v=u.tileSize,y=[g,_,(n.lng-g*m)/m*v,(n.lat-_*m)/m*v],b=h?t.width/2*1.5:t.width/2,w=y[0]-Math.ceil((b-y[2])/v),x=y[1]-Math.ceil((t.height/2-y[3])/v),M=y[0]+Math.ceil((b+y[2])/v),T=y[1]+Math.ceil((t.height/2+y[3])/v),L=[],C=w;M>C;C++)for(var P=x;T>P;P++){L.push([C,P]);var S="id_"+C+"_"+P+"_"+p;L[S]=!0}d.mapType!==BMAP_SATELLITE_MAP&&(L=cg.calcLoopTiles(L,p)),L.sort(function(t){return function(e,i){return.4*Math.abs(e[0]-t[0])+.6*Math.abs(e[1]-t[1])-(.4*Math.abs(i[0]-t[0])+.6*Math.abs(i[1]-t[1]))}}([y[0],y[1]]));var A=this.mapTiles,D=-n.lng/f,I=n.lat/f,k=[Math.round(D),Math.round(I)];for(var E in A){var z=A[E],B=z.info;if(B){var S="id_"+B[0]+"_"+B[1]+"_"+B[2];L[S]||this.hideTile(z,d)}}var O=-t.offsetX+t.width/2,R=-t.offsetY+t.height/2;d.tilesDiv.style.left=Math.round(D+O)-k[0]+"px",d.tilesDiv.style.top=Math.round(I+R)-k[1]+"px",this.numLoading+=L.length;for(var C=0,N=L.length;N>C;C++)this.showTile([L[C][0],L[C][1],t.zoomLevel],k,d,C)}},showTile:function(t,e,i,n){this.centerPos=e;var a=a6[i.mapType],o=this.getTileName(t,i),r=t[0]*a.tileSize+e[0],s=(-1-t[1])*a.tileSize+e[1],l=[r,s];if(i.mapType!==BMAP_SATELLITE_MAP){var h=cg.calcLoopParam(t[0],t[2]).offsetX;l[0]+=h,l._offsetX=h}var c=this,d=this.mapTiles[o];if(d)return d.img.style.left=l[0]+"px",d.img.style.top=l[1]+"px",void(d.loaded?this._checkTilesLoaded():d._addLoadCbk(function(){c._checkTilesLoaded()}));if(d=this.bufferTiles[o]){this.imgNumber++,i.tilesDiv.insertBefore(d.img,i.tilesDiv.lastChild),this.mapTiles[o]=d,d.img.style.left=l[0]+"px",d.img.style.top=l[1]+"px",d.loaded?this._checkTilesLoaded():d._addLoadCbk(function(){c._checkTilesLoaded()});var u=new aw("onimagechange");u.action="cache",u.tile=this.getTileName(t,i),this.map.dispatchEvent(u)}else{var p=a.baseUnits*Math.pow(2,a.zoomLevelBase-t[2]),f=new d8(t[0]*p,t[1]*p),m=i.getTilesUrl(f,t[2]);if(d=new aW(this,m,l,t,i),d._addLoadCbk(function(){c._checkTilesLoaded()}),0===n&&(i.mapType==window.BMAP_NORMAL_MAP||i.opts.requestMonitor)){var g=(new Date).getTime();d._addLoadCbk(function(){var t=(new Date).getTime(),e=t-g,n={value:e,detail:m,unique:!0};d.error?(n.type="fail",n.subvalue="fail"):e>=2e3?(n.type="slow",n.subvalue=4e3>e?"req_slow2":6e3>e?"req_slow4":"req_slow6"):(n.type="succ",n.subvalue="succ");var a="tile",o=.02;i.mapType!==window.BMAP_NORMAL_MAP&&i.opts.monitorOpts&&(a=i.opts.monitorOpts.name||"tile",o=i.opts.monitorOpts.seed||.02),d5.Utils.ErrorMonitor(a,o,n)})}d._load(),this.mapTiles[o]=d}},mouseWheel:function(t){var e=this.map;if(e.config.enableWheelZoom){var i=e.zoomLevel+(t.trend===!0?1:-1),n=e._getProperZoom(i);if(n.exceeded){var a=new aw("onzoomexceeded");return a.targetZoom=i,void e.dispatchEvent(a)}e.dispatchEvent(new aw("onzoomstart")),e.lastLevel=e.zoomLevel,e.zoomLevel=n.zoom;var o=t.pixel,r=e.pixelToPoint(o,{zoom:e.lastLevel}),s=e.getZoomUnits(e.zoomLevel);e.centerPoint=new d8(r.lng+s*(e.width/2-o.x),r.lat-s*(e.height/2-o.y)),this.zoom(o)}},dblClick:function(t){var e=this.map;if(e.config.enableDblclickZoom&&"B_EARTH_MAP"!==e.mapType&&e.currentOperation!==cc.dragging){var i=t.pixel,n=e.pixelToPoint(i),a=1,o=i;"onrightdblclick"==t.type&&(a=-1);var r=e.zoomLevel+a,s=e._getProperZoom(r);if(s.exceeded){var l=new aw("onzoomexceeded");l.targetZoom=r,e.dispatchEvent(l)}else{e.dispatchEvent(new aw("onzoomstart"));var h=e.deepZoom;if(h)h.zoomMap(o,a,a);else{e.lastLevel=e.zoomLevel,e.zoomLevel=s.zoom;var c=e.getZoomUnits(e.zoomLevel);e.centerPoint=new d8(n.lng+c*(e.width/2-i.x),n.lat-c*(e.height/2-i.y)),this.zoom(i)}}}},keypress:function(t){var e=this.map;if(e.getMapType()!==BMAP_EARTH_MAP){if(!e.config.enableContinuousZoom)return void("onpluspress"==t.type?e.zoomIn():e.zoomOut());if(!this._zTimeLine){var i=e.deepZoom;if(i){var n="onpluspress"==t.type?1:-1;e.deepZoomMedia(n)}else{var a=e.zoomLevel+("onpluspress"==t.type?1:-1),o=e._getProperZoom(a);if(o.exceeded){var r=new aw("onzoomexceeded");return r.targetZoom=a,void e.dispatchEvent(r)}e.dispatchEvent(new aw("onzoomstart"));var s=new cs(e.width/2,e.height/2);if(e.lastLevel=e.zoomLevel,e.zoomLevel=o.zoom,e.getInfoWindow()){s=e.pointToPixel(e.getInfoWindow().getPoint(),{zoom:e.lastLevel});var l=e.pixelToPoint(s,{zoom:e.lastLevel}),h=e.getZoomUnits(e.zoomLevel);e.centerPoint=new d8(l.lng+h*(e.width/2-s.x),l.lat-h*(e.height/2-s.y))}this.zoom(s)}}}}}),bs.inherits(co,"TileLayer"),v.extend(bs.prototype,{isTransparentPng:function(){return this.transparentPng},getTilesUrl:function(t,e){var i=a6[this.mapType];if("object"!=typeof i)return null;var n=i.baseUnits*Math.pow(2,i.zoomLevelBase-e),a=parseInt(t.lng/n)-this.offset[0],o=parseInt(t.lat/n-this.offset[1]);if(this.mapType!==BMAP_SATELLITE_MAP)var a=cg.calcLoopParam(a,e).col;var r="";if(this.opts.tileUrlTemplate)r=this.opts.tileUrlTemplate,r=r.replace(/\{X\}/,a),r=r.replace(/\{Y\}/,o),r=r.replace(/\{Z\}/,e);else{if(this.mapType==BMAP_NORMAL_MAP){var s=this.isCanvasMap?0:1;r=i.tileUrls[Math.abs(a+o)%i.tileUrls.length]+"?qt=tile&x="+a+"&y="+o+"&z="+e+"&styles=pl&udt="+this.normalUdt+"&scaler="+this.scaler+"&p="+s,"1"===window.nuzad&&(r+="&tcode=nuzad"),r=r.replace(/-(\d+)/gi,"M$1")}if(this.mapType==BMAP_SATELLITE_MAP){var l="009";"undefined"!=typeof TVC&&(l=TVC.ditu.satellite.version);var h="20130501";"undefined"!=typeof TVC&&(h=TVC.ditu.satellite.updateDate),r=i.tileUrls[Math.abs(a+o)%i.tileUrls.length]+"u=x="+a+";y="+o+";z="+e+";v="+l+";type=sate&fm=46&udt="+h,r=r.replace(/-(\d+)/gi,"M$1")}}return r},initialize:function(t){if(this.map=t,"webgl"===t._renderType){var e=null;this.customLayer!==!1&&(e=this.getTilesUrl),v.extend(this,dj),this.labelProcessor=new bO(this),this.callbackDataQueue=[],e&&(this.getTilesUrl=e);var i=this;t.on("indoor_data_refresh",function(t){i._refreshIndoorData(t.uid,t.floor)}),t.on("reload_icon_image",function(){i.loadIconSetImg(!0)})}t.temp.layerZIndex||(t.temp.layerZIndex=0),this.zIndex=this.zIndex||0,this.baseLayer&&(this.zIndex=0),t.temp.layid||(t.temp.layid=0),this.opts.mapType?this.mapType=this.opts.mapType:(this.mapType="BMAP_CUSTOM_LAYER_"+t.temp.layid,t.temp.layid++);var n=a6[this.mapType];if(n||(a6[this.mapType]={tileUrls:[],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:19,minZoom:3,maxZoom:19,minDataZoom:3,maxDataZoom:19,zoomLevelBase:18,errorUrl:cR.imgPath+"/blank.gif",bounds:new ca(-21364736,-10616832,23855104,15859712),imgExtend:"png"}),"webgl"!==t._renderType){var a=b4(t.platform,'<div style="position:absolute;z-index:'+this.zIndex+'"></div>');a.style.display="",a.style.left=Math.ceil(-t.offsetX+t.width/2)+"px",a.style.top=Math.ceil(-t.offsetY+t.height/2)+"px",this.tilesDiv=a}this.isCanvasMap=t.isCanvasMap(),this.lastZoom=t.getZoom()},remove:function(){this.tilesDiv&&this.tilesDiv.parentNode&&(this.tilesDiv.innerHTML="",this.tilesDiv.parentNode.removeChild(this.tilesDiv)),delete this.tilesDiv},getCopyright:function(){return this.copyright},getMapType:function(){return this.mapType},setZIndex:function(t){this.zIndex=t,this.tilesDiv&&(this.tilesDiv.style.zIndex=t)}}),bC.inherits(co,"Copyright");var dB={get:function(t){return dB.singleton||(dB.singleton=new O(t)),dB.singleton}};v.extend(O.prototype,{prepareLayer:function(){var t=this._map,e=this._tileMgr;this._canvas2dMapMgr=t.canvas2dMapMgr;var i=this._baseLayerDiv=e.tilesDiv;if(!this._animationDiv){var n=this._preAnimationDiv;n&&(n.parentNode&&n.parentNode.removeChild(n),this._preAnimationDiv=null),this._preAnimationDiv=this._animationDiv=i.cloneNode(!0),t.platform.insertBefore(this._animationDiv,t.platform.firstChild)}this.show()},prepareLabelLayer:function(){var t=this._map;if(this._enableCanvas2dMap&&t.canvas2dMapMgr){this.touchZoomLabelCanvas&&this.touchZoomLabelCanvas.parentNode.removeChild(this.touchZoomLabelCanvas);var e=t.canvas2dMapMgr._labelCanvas;this.touchZoomLabelCanvas=e.cloneNode(!1);var i=this.touchZoomLabelCanvas.getContext("2d");i.drawImage(e,0,0),t.platform.insertBefore(this.touchZoomLabelCanvas,t.platform.firstChild);var n=parseInt(e.style.left,10),a=parseInt(e.style.top,10);this.touchZoomLabelCanvas.style.zIndex=9,this.touchZoomLabelCanvas.style[this._transformOriginStyleName]=this._fixPosition.x-(t.offsetX+n)+"px "+(this._fixPosition.y-(t.offsetY+a))+"px",e.style.visibility="hidden"}},show:function(){this._animationDiv&&(this._animationDiv.style.visibility="")},showLabel:function(){var t=this._map;if(this._enableCanvas2dMap&&t.canvas2dMapMgr){var e=t.canvas2dMapMgr._labelCanvas;e&&(e.style.visibility=""),this.touchZoomLabelCanvas&&(this.touchZoomLabelCanvas.style.zIndex=-2,this.touchZoomLabelCanvas.style.visibility="hidden")}},hide:function(){this._animationDiv&&(this._animationDiv.style.visibility="hidden"),this._preAnimationDiv&&(this._preAnimationDiv.style.visibility="hidden")},hideNonAnimationLayers:function(){var t=this._map;"dom"===t.getRenderType()&&(t.overlayDiv&&(t.overlayDiv.style.visibility="hidden"),t.overlayDivEx&&(t.overlayDivEx.style.visibility="hidden"));for(var e,i=t.tileMgr.tileLayers,n=0,a=i.length;a>n;n++)e=i[n],e.tilesDiv.style.visibility="hidden"},showNonAnimationLayers:function(){var t=this._map;"dom"===t.getRenderType()&&(t.overlayDiv&&(t.overlayDiv.style.visibility=""),t.overlayDivEx&&(t.overlayDivEx.style.visibility=""));for(var e,i=t.tileMgr.tileLayers,n=0,a=i.length;a>n;n++)e=i[n],e.tilesDiv.style.visibility=""},setFixPosition:function(t){this._fixPosition=t},setZoom:function(t,e){var i=this._fixPosition,n=this._map,a=this._baseLayerDiv,o={x:i.x-parseInt(a.style.left,10)-n.offsetX,y:i.y-parseInt(a.style.top,10)-n.offsetY},r=this._animationDiv;if(r){for(var s,l,h,c=r.children.length,d=this._transformStyleName,u=this._transformOriginStyleName,p=this,f=c-1;f>-1;f--){var m={};s=r.children[f].style,m.top=parseInt(s.top,10),m.left=parseInt(s.left,10),s[u]="0% 0%",s[d]="";var g=m.left-o.x,_=m.top-o.y;m.dx=g*t-g,m.dy=_*t-_,m.preDx=g-g,m.preDy=_-_,l=m.preDx+(m.dx-m.preDx),h=m.preDy+(m.dy-m.preDy)+e,s[d]=p._isIE9?"translate("+l+"px, "+h+"px) scale("+t+")":"translate3d("+l+"px, "+h+"px, 0) scale("+t+")"}if(this._enableCanvas2dMap){var v=p._isIE9?"translate(0px, "+e+"px) scale("+t+")":"translate3d(0px, "+e+"px, 0) scale("+t+")";this.touchZoomLabelCanvas.style[d]=v}}},setZoomFinish:function(){this._animationDiv=null},startAnimation:function(t){this.prepareLayer(),this.hideNonAnimationLayers();var e=this._map;this.touchZoomLabelCanvas&&(this.touchZoomLabelCanvas.style.display="none"),t=t||{};var i=t.zoomCount||0,n=t.fixPosition,a=(t.fixMCPosition,t.pixOffset);this._zoomCount=i;for(var o=e.getZoom(),r=o+i,s=e.config.enableContinuousZoom,l=.5,h=5,c=Math.pow(2,i),d=this._baseLayerDiv,u={x:n.x-parseInt(d.style.left,10)-e.offsetX,y:n.y-parseInt(d.style.top,10)-e.offsetY},p=this._animationDiv,f=p.children.length,g=this._preZoomTimes,_=[],v=this._transformStyleName,y=this._transformOriginStyleName,b=f-1;b>-1;b--){var w={},x=p.children[b].style;w.top=parseInt(x.top,10),w.left=parseInt(x.left,10),x[y]="0% 0%",x[v]="";var M=w.left-u.x,T=w.top-u.y;w.dx=M*c-M,w.dy=T*c-T,w.preDx=M*g-M,w.preDy=T*g-T,_[b]=w}var L,C,P,S=this;return this._zoomAni=new m({fps:60,duration:s?500:1,transition:function(t){return t=t*h/(2*l),h*t-l*t*t},render:function(s){s=4*s*l/(h*h),L=g+s*(c-g);var d=o+cy(L),u=null,f=0,m=0;if(t.onAnimationBeforeLooping){var y=t.onAnimationBeforeLooping(s,d);u=y.loopingCenter,f=y.yDiff,m=y.totalYDiff}for(var b=_.length-1;b>-1;b--){var w=_[b];if(p.children[b]){var x=p.children[b].style;C=w.preDx+(w.dx-w.preDx)*s-a.width*s,P=w.preDy+(w.dy-w.preDy)*s-a.height*s+f,x[v]=S._isIE9?"translate("+C+"px, "+P+"px) scale("+L+")":"translate3d("+C+"px, "+P+"px, 0) scale("+L+")"}}var M=a.width*s,T=a.height*s;e.isRestrict?S._enableCanvas2dMap&&S._canvas2dMapMgr.clearLabel():S._enableCanvas2dMap&&S._canvas2dMapMgr.drawLabel(L,n,o,r,i,s,M,T,m,f),S._preZoomTimes=L,S._preRenderTick=s,t.onAnimationLooping&&t.onAnimationLooping(s,d,u)},finish:function(){S._preZoomTimes=1,S._zoomAni=null,S._animationDiv=null,t.onAnimationFinish&&t.onAnimationFinish(),S.showNonAnimationLayers()}}),this._zoomAni},stopAnimation:function(){this._zoomAni&&(this._zoomAni.stop(),this._zoomAni=null)}}),v.extend(b.prototype,{_initVars:function(t){this._map=t._map,this._canvas2dMapMgr=t,this._labelCtx=t._labelCtx,this.ratio=this._map.config.ratio,this.sizeRatio=this.ratio>1?2:1,this.RANK1=1e6,this.RANK2=2e6,this.RANK3=3e6,this.RANK4=4e6,this.RANK5=5e6},_initColorCanvas:function(){var t=256,e=F("canvas"),i=e.style;i.width=t+"px",i.height=t+"px",e.width=t,e.height=t,this._colorCvsSize=t,this._colorCvs=e,this._colorCtx=e.getContext("2d")},getLabelImageData:function(t){var e=t.textImg,i=t.textPos,n=this.ratio,a=this.sizeRatio/n,o=this._colorCtx,r=this._colorCvsSize;o.clearRect(0,0,r,r);for(var s=i[0].width/a,l=0,h=0,c=i.length;c>h;h++){var d=i[h];o.drawImage(e,d.srcX,d.srcY,d.width,d.height,0,l,d.width/a,d.height/a),d.width/a>s&&(s=d.width/a),l+=d.height/a}var u=o.getImageData(0,0,s,l),p=o.getImageData(0,0,s,l);return[u,p]},_bindEvent:function(t){var e=this,i=t._map;i.addEventListener("onspotmouseover",function(t){if(this.isCanvasMap()&&this.temp.isPermitSpotOver&&t.spots.length>0){var i=t.spots[0].userdata.uid,n=e.findLabelByUid(i);n&&e._toHighLightColor(n)}}),i.addEventListener("onspotmouseout",function(t){if(this.isCanvasMap()&&this.temp.isPermitSpotOver&&t.spots.length>0){var i=t.spots[0].userdata.uid,n=e.findLabelByUid(i);n&&e._toDefaultColor(n)}}),i.addEventListener("onspotclick",function(t){if(this.isCanvasMap()&&this.temp.isPermitSpotOver)if(t.spots&&t.spots.length>0){var i=t.spots[0].userdata.uid,n=e.findLabelByUid(i);n&&e._changeBaseMapState(n)
}else e._recoverNormalState()}),i.on("spot_status_reset",function(){e._recoverNormalState()})},_getTextBound:function(t){if(!t.textPos)return null;for(var e=this.ratio,i=this.sizeRatio/e,n=t.textPos,a=t.baseDrawX,o=t.baseDrawY,r=a*e+(n[0].drawX-a)/i,s=o*e+(n[0].drawY-o)/i,l=r+n[0].width/i,h=s+n[0].height/i,c=0,d=n.length;d>c;c++){var u=n[c],p=a*e+(u.drawX-a)/i;r>p&&(r=p);var f=o*e+(u.drawY-o)/i;s>f&&(s=f),p+u.width>l&&(l=p+u.width),f+u.height>h&&(h=f+u.height)}return[r,s,l,h]},_toHighLightColor:function(t){if(!t._tempRank||t._tempRank!=this.RANK5){var e=this._getTextBound(t);if(e){var i=Math.round(e[0]),n=Math.round(e[1]),a=this.getLabelImageData(t),o=a[0],r=a[1],s=this._canvas2dMapMgr.getFilterImageData(o,this.RANK5);t._oldImgData=r,this._labelCtx.putImageData(s,i,n)}}},_toDefaultColor:function(t){if((!t._tempRank||t._tempRank!=this.RANK5)&&t._oldImgData){var e=(this.sizeRatio,this._getTextBound(t));if(!e)return;this._labelCtx.putImageData(t._oldImgData,Math.round(e[0]),Math.round(e[1])),t._oldImgData=null}},_changeBaseMapState:function(t){var e=this._canvas2dMapMgr,i=t.guid,n=t.guidExt,a={guid:i,guidExt:n};e._labelStrategy.setStrategyInfo(a),e._loadData()},_recoverNormalState:function(){var t=this._canvas2dMapMgr;t._labelStrategy.setStrategyInfo(null),t._loadData()},findLabelByUid:function(t){for(var e=this._canvas2dMapMgr,i=e._computedLabel,n=0,a=i.length;a>n;n++){var o=i[n];if(e.isClickableLabel(o)&&o.guid==t)return o}return null}}),v.extend(cn.prototype,{_initVars:function(t){this._map=t._map,this._canvas2dMapMgr=t,this.ratio=this._map.config.ratio,this._strategyInfo=null,this.RANK1=1e6,this.RANK2=2e6,this.RANK3=3e6,this.RANK4=4e6,this.RANK5=5e6},setStrategyInfo:function(t){this._strategyInfo=t},preComputeLabel:function(t,e,i,n,a,o){var r=[],s=t._centerX,l=t._centerY,h=n*a,c=this.ratio,d=this._map.getZoom(),u=0;5===d&&(u=1),t.sort(function(t,e){return t.x*t.y<e.x*e.y?-1:1});for(var p=0,f=t.length;f>p;p++)for(var m=t[p],g=m.x,_=m.y,v=m.z,y=cg.calcLoopParam(g,v).offsetX,b=g*h,w=(_+1)*h,x=(b-s)/n+e/2+y,M=(l-w)/n+i/2,T=0,L=m.length;L>T;T++){var C=m[T],P=void 0,S=void 0,A=void 0,D=void 0,I=C.baseDrawX=x+C.baseX,k=C.baseDrawY=M+C.baseY;if("fixed"==C.type){var E=C.iconPos,z=C.textPos,B=C.textImg;if(E&&(E.drawX=x+E.destX,E.drawY=M+E.destY,P=E.drawX,S=E.drawY,A=E.drawX+E.width,D=E.drawY+E.height),z&&B){var O=z[0];if(O.drawX=x+O.destX,O.drawY=M+O.destY,void 0!=P?(O.drawX<P&&(P=O.drawX),O.drawY<S&&(S=O.drawY),O.drawX+O.width>A&&(A=O.drawX+O.width),O.drawY+O.height>D&&(D=O.drawY+O.height)):(P=O.drawX,S=O.drawY,A=O.drawX+O.width,D=O.drawY+O.height),2==z.length){var R=z[1];R.drawX=x+R.destX,R.drawY=M+R.destY,R.drawX<P&&(P=R.drawX),R.drawY<S&&(S=R.drawY),R.drawX+R.width>A&&(A=R.drawX+R.width),R.drawY+R.height>D&&(D=R.drawY+R.height)}}}else C.tileX=x,C.tileY=M,P=x+C._minX,S=M+C._minY,A=x+C._maxX,D=M+C._maxY;if(void 0!=P){var N=I+(P-I)/c,W=k+(S-k)/c,Z=I+(A-I)/c,X=k+(D-k)/c;C.minX=N,C.minY=W,C.maxX=Z,C.maxY=X;var Y=(N+Z)/2,H=(W+X)/2,U=s+(Y-e/2)*n,F=l+(i/2-H)*n;C.geoX=U,C.geoY=F,r.push(C)}}if(o){for(var p=0,f=o.length;f>p;p++){var G=o[p],V=G[0],j=G[1],E=V.iconPos,q=E.geoX,K=E.geoY,I=(q-s)/n+e/2,k=(l-K)/n+i/2,P=I+E.destX,S=k+E.destY,A=P+E.width,D=S+E.height;V.textPos=V.textPos||V._textPos;var z=V.textPos,O=z[0],$=I+O.destX,J=k+O.destY;if(S>J&&(S=J),$+O.width>A&&(A=$+O.width),J+O.height>D&&(D=J+O.height),2===z.length){var R=z[1],Q=I+R.destX,te=k+R.destY;S>te&&(S=te),Q+R.width>A&&(A=Q+R.width),te+R.height>D&&(D=te+R.height)}V._tempBounds=[P,S,A,D];var E=j.iconPos,q=E.geoX,K=E.geoY,I=(q-s)/n+e/2,k=(l-K)/n+i/2,P=I+E.destX,S=k+E.destY,A=P+E.width,D=S+E.height;j.textPos=j.textPos||j._textPos;var z=j.textPos,O=z[0],$=I+O.destX,J=k+O.destY;if(P>$&&(P=$),S>J&&(S=J),J+O.height>D&&(D=J+O.height),2===z.length){var R=z[1],Q=I+R.destX,te=k+R.destY;P>Q&&(P=Q),S>te&&(S=te),te+R.height>D&&(D=te+R.height)}j._tempBounds=[P,S,A,D]}for(var p=0,f=o.length;f>p;p++){var G=o[p],V=G[0],j=G[1];0===p&&j.textPos&&(j._textPos=j.textPos,delete j.textPos);var ee=V;!V.textPos&&j.textPos&&(ee=j);var ie=ee._tempBounds;for(T=p+1;f>T;T++){var ne=o[T],ae=ne[0],oe=ne[1],re=0,se=ae._tempBounds;ie[2]<se[0]||ie[0]>se[2]||ie[3]<se[1]||ie[1]>se[3]||(re++,ae.textPos&&(ae._textPos=ae.textPos,delete ae.textPos));var se=oe._tempBounds;ie[2]<se[0]||ie[0]>se[2]||ie[3]<se[1]||ie[1]>se[3]||(re++,oe.textPos&&(oe._textPos=oe.textPos,delete oe.textPos)),re>=2&&ee.textPos&&(ee._textPos=ee.textPos,delete ee.textPos)}}for(var p=0,f=o.length;f>p;p++){var G=o[p],V=G[0],j=G[1],le=V;!V.textPos&&j.textPos&&(le=j);var E=le.iconPos,q=E.geoX,K=E.geoY,I=le.baseDrawX=(q-s)/n+e/2,k=le.baseDrawY=(l-K)/n+i/2;E.drawX=I+E.destX,E.drawY=k+E.destY;var P=E.drawX,S=E.drawY,A=E.drawX+E.width,D=E.drawY+E.height,z=le.textPos;if(z){var O=z[0];if(O.drawX=I+O.destX,O.drawY=k+O.destY,O.drawX<P&&(P=O.drawX),O.drawY<S&&(S=O.drawY),O.drawX+O.width>A&&(A=O.drawX+O.width),O.drawY+O.height>D&&(D=O.drawY+O.height),2===z.length){var R=z[1];R.drawX=I+R.destX,R.drawY=k+R.destY,R.drawX<P&&(P=R.drawX),R.drawY<S&&(S=R.drawY),R.drawX+R.width>A&&(A=R.drawX+R.width),R.drawY+R.height>D&&(D=R.drawY+R.height)}}var N=I+(P-I)/c,W=k+(S-k)/c,Z=I+(A-I)/c,X=k+(D-k)/c;le.minX=N,le.minY=W,le.maxX=Z,le.maxY=X;var he=(N+Z)/2,ce=(W+X)/2,de=s+(he-e/2)*n,ue=l+(i/2-ce)*n;le.geoX=de,le.geoY=ue,r.push(le)}}var pe=this._strategyInfo;if(pe)for(var fe=pe.guid,me=pe.guidExt,p=0,f=r.length;f>p;p++){var ge=r[p];delete ge._tempRank,this._canvas2dMapMgr.isClickableLabel(ge)&&(1!==me||ge.guidExt)&&fe==ge.guid&&(ge._tempRank=this.RANK5)}else for(var p=0,f=r.length;f>p;p++){var ge=r[p];"line"!=ge.type&&ge.iconPos&&delete ge._tempRank}r.sort(function(t,e){var i=t._tempRank?t._tempRank:t.rank,n=e._tempRank?e._tempRank:e.rank;return n-i});for(var p=0,f=r.length;f>p;p++){var ee=r[p];for(ee.isDel=!1,ee.isFadeout=!1,ee._schedule=0,ee._isIgnore=!1,ee.arrIntersectIndex=[],T=p+1;f>T;T++){var _e=r[T];ee.maxX-u<_e.minX||ee.minX>_e.maxX-u||ee.maxY-u<_e.minY||ee.minY>_e.maxY-u||ee.arrIntersectIndex.push(T)}}for(var p=0,f=r.length;f>p;p++){var ge=r[p];if(0==ge.isDel)for(var ve=ge.arrIntersectIndex,T=0,L=ve.length;L>T;T++){var ye=r[ve[T]];ye.isDel=!0,1===ye.guidExt&&(ye.isDel=!1)}}return r}}),d5.register(function(t){"canvas"===t.getRenderType()&&(t.canvas2dMapMgr=new N(t))}),v.extend(N.prototype,{_initCanvas:function(){var t=this._map,e=t.getSize(),i=e.width,n=e.height,a=t.platform,o=F("canvas"),r=o.style,s=this.ratio=t.config.ratio;this._width=i,this._height=n,r.cssText="position: absolute;left:0;top:0;width:"+i+"px;height:"+n+"px;z-index:100;",o.width=i*s,o.height=n*s,this._labelCanvas=o,this._labelCtx=o.getContext("2d"),a.appendChild(o)},_initVars:function(){this._udt="20170626",this._version="001","undefined"!=typeof TVC&&(this._udt=TVC.ditu.normal.updateDate,this._version=TVC.ditu.normal.version),this._labelDataUrls=["//online0.map.bdimg.com/pvd/?","//online1.map.bdimg.com/pvd/?","//online2.map.bdimg.com/pvd/?","//online3.map.bdimg.com/pvd/?"],this._tileSize=256,this._style=FeatureStyle,this._labelCount=0,this._vectorDrawLib=new ao(this),this._cache={maxNum:500,delNum:50,arrCache:[]},this._computedLabel=null,this._spotData=null,this._labelStrategy=new cn(this),this._labelClick=new b(this),this._biz=new dR(this),this._map.temp.isPermitSpotOver=!0,this.labelStyleParam="pl",this.statRequestCount=0,this.statResponseCount=0},_resizeHandler:function(){var t=this,e=t._map,i=e.getSize(),n=i.width,a=i.height,o=this.ratio,r=this._labelCanvas,s=r.style;s.width=n+"px",s.height=a+"px",r.width=n*o,r.height=a*o,t._width=n,t._height=a;var l=!0;t._loadData(l)},_bindEvent:function(){var t=this,e=t._map;e.addEventListener("load",function(){t.clearLabel(),t._loadData()}),e.addEventListener("zoomend",function(e){e.notClearLabel||t.clearLabel(),t._loadData()}),e.addEventListener("moveend",function(){t._loadData()}),e.addEventListener("resize",function(e){t._resizeHandler(e)}),e.addEventListener("maptypechange",function(e){e.mapType===BMAP_EARTH_MAP?t.hideLabelCanvas():(t.showLabelCanvas(),e.mapType===BMAP_NORMAL_MAP?t.labelStyleParam="pl":e.mapType===BMAP_SATELLITE_MAP&&(t.labelStyleParam="sl"),t._loadData())}),e.addEventListener("streetlayer_show",function(){this.isCanvasMap()&&t.showLabelCanvas()}),e.addEventListener("streetlayer_hide",function(){this.isCanvasMap()&&t.hideLabelCanvas()}),e.addEventListener("loadbizdata",function(e){var i=e.data;t._biz.proecessBizData(i,function(){t.updateLabel()})}),e.addEventListener("unloadbizdata",function(){t._biz.clearBizData(),t.updateLabel()}),t.isDrawText=!1,setTimeout(function(){t.isDrawText||e.dispatchEvent(new aw("onmapwhitescreen"))},1e4)},getStyle:function(){return this._style},_getZoomUnits:function(t){return Math.pow(2,18-t)},_createCacheForm:function(t,e,i){var n=this,a=n._cache,o=a.arrCache,r="_"+t+"_"+e+"_"+i+"_"+this.labelStyleParam,s={id:r,updateLabelCounter:0};return o.push(s),o[r]=s,s},_getCache:function(t,e,i){return this._cache.arrCache["_"+t+"_"+e+"_"+i+"_"+this.labelStyleParam]},_setCacheValue:function(t,e,i,n){var a=this,o=a._cache,r=o.arrCache,s=o.maxNum,l=o.delNum,h="_"+t+"_"+e+"_"+i+"_"+this.labelStyleParam,c=r[h];if(n&&(c.lb=n),r.length>s){arrDel=r.splice(0,l);for(var d=0,u=arrDel.length;u>d;d++){var p=arrDel[d],f=p.id;r[f].lb&&(r[f].lb=null),r[f]=null,delete r[f]}arrDel=null}},_loadData:function(t){var e=this._map;if(e.isCanvasMap()){var i=e.getCenter(),n=cg.calcLoopCenterPoint(i),a=this._width/2,o=this._height,r=e.getZoom(),s=e.getZoomUnits(r),l=s*a,h=n.lng-l,c=n.lng+l,d=cg.isAddWidth(h,c);a=d?1.5*a:a;var u=this._tileSize,p=u*s,f=Math.floor(n.lng/p),m=Math.floor(n.lat/p),g=[f,m,(n.lng-f*p)/p*u,(n.lat-m*p)/p*u],_=g[0]-Math.ceil((a-g[2])/u),v=g[1]-Math.ceil((o/2-g[3])/u),y=g[0]+Math.ceil((a+g[2])/u),b=g[1]+Math.ceil((o/2+g[3])/u);e.temp.isPermitSpotOver=!1;for(var w=[],x=_;y>x;x++)for(var M=v;b>M;M++){w.push([x,M]);var T="id_"+x+"_"+M+"_"+r;w[T]=!0}w._zoom=r,w=cg.calcLoopTiles(w,r),w.sort(function(t){return function(e,i){return.4*Math.abs(e[0]-t[0])+.6*Math.abs(e[1]-t[1])-(.4*Math.abs(i[0]-t[0])+.6*Math.abs(i[1]-t[1]))}}([g[0],g[1]]));var L=this._cache.arrCache;this._curViewLabels=[];var C="viewKey_"+Math.floor(i.lng)+"_"+Math.floor(i.lat)+"_"+r;this.statRequestCount=0,this.statResponseCount=0,this._labelCount+=w.length;for(var x=0,P=w.length;P>x;x++){var f=w[x][0],m=w[x][1],r=w._zoom,S="_"+f+"_"+m+"_"+r+"_"+this.labelStyleParam,A=L[S];A||(A=this._createCacheForm(f,m,r)),"undefined"==typeof A.lb?(A.lb=null,this._loadLabelData(f,m,r,C),this.statRequestCount++):A.lb?(this._curViewLabels.push(A.lb),this._labelCount--):(t&&this._loadLabelData(f,m,r,C),A.updateLabelCounter++)}0===this._labelCount&&this.updateLabel();var D=this;D.errorTimer&&clearTimeout(D.errorTimer),D.errorTimer=setTimeout(function(){0!==D._labelCount&&(D._labelCount=0,D.updateLabel());var t=new aw("onloaddatatimeout"),e=0,i=0,n=0,a=0;D.statRequestCount===D.statResponseCount?e=1:i=1,1===i&&(a=D.statRequestCount-D.statResponseCount,n=D.statResponseCount),t.noTimeoutCount=e,t.timeoutCount=i,t.timeoutNoLoaded=a,t.timeoutLoaded=n,D._map.dispatchEvent(t)},500)}},clearLabel:function(){var t=this._width,e=this._height,i=this.ratio;this._labelCtx.clearRect(0,0,t*i,e*i)},updateLabel:function(){var t=this._map,e=t.getCenter(),i=this._width,n=this._height,a=this._tileSize,o=t.getZoom(),r=this._getZoomUnits(o),s=this._labelCtx;this._labelCanvas.style.left=-t.offsetX+"px",this._labelCanvas.style.top=-t.offsetY+"px";var l=this._curViewLabels;l._centerX=e.lng,l._centerY=e.lat;var h=this._biz.bizLabels;this._computedLabel=this._labelStrategy.preComputeLabel(l,i,n,r,a,h),this._computedLabel._zoom=o,this.clearLabel(),this._vectorDrawLib.drawIconAndText(s,this._computedLabel,o),this._addSpotData(),t.temp.isPermitSpotOver=!0,l.length>0&&(this.isDrawText=!0)},_loadLabelData:function(t,e,i,n){var a=t.toString(),o=e.toString(),r="cbk_"+a.replace("-","_")+"_"+o.replace("-","__")+"_"+Math.floor(i),s=this._labelDataUrls,l=Math.abs(t+e)%s.length,h="BMap."+r,c=s[l],d=this.labelStyleParam,u=i>=3&&9>=i?100:60,p="qt=tile&x={x}&y={y}&z={z}&udt={udt}&v={v}&styles={styles}&b=0&limit={limit}&scaler={scaler}&fn="+h;"1"===window.nuzad&&(p+="&tcode=nuzad");var f=cg.calcLoopParam(t,i).col,m=this.ratio>1?2:1,g=p.replace(/{x}/,f).replace(/{y}/,e).replace(/{z}/,Math.floor(i)).replace(/{styles}/,d).replace(/{limit}/,u).replace(/{udt}/,this._udt).replace(/{v}/,this._version).replace(/{scaler}/,m),_=c+g,v=this,y=v._map,b=v._tileSize;d5[r]=function(a){v._vectorDrawLib.parseLabelData(a,t,e,i,b,function(a){var o=y.getCenter(),s=y.getZoom(),l="viewKey_"+Math.floor(o.lng)+"_"+Math.floor(o.lat)+"_"+s;v._labelCount--;var h=v._getCache(t,e,i).updateLabelCounter;v._labelCount-=h;var c=v._curViewLabels;if((l===n||v._labelCount<0&&s===i)&&c.push(a),l===n&&v.statResponseCount++,v._labelCount<=0){var d=(new Date).getTime();v.updateLabel();var u=(new Date).getTime(),p=new aw("oncanvasmaploaded");p.drawTime=u-d,v.statResponseCount===v.statRequestCount&&(p.isAllLoadedDrawing=!0),y.dispatchEvent(p)}v._setCacheValue(t,e,i,a),delete d5[r]})},w.request(_,d5[r])},drawLabel:function(t,e,i,n,a,o,r,s,l,h){var c=this;if(c._computedLabel){if(c._computedLabel._zoom!==i)return void c.clearLabel();c._map.temp.isPermitSpotOver=!1,c.clearLabel(),c._vectorDrawLib.zoomingIconAndText(this._labelCtx,c._computedLabel,t,e,n,a,o,r,s,l,h)}},_addSpotData:function(){this._spotData=[];for(var t=this._map.getZoom(),e=0,i=this._computedLabel.length;i>e;e++){var n=this._computedLabel[e];if(this.isClickableLabel(n)&&!(1===n.guidExt&&n.startScale>t)){var a=[];a[0]=(n.minX-n.maxX)/2,a[1]=(n.minY-n.maxY)/2,a[2]=(n.maxX-n.minX)/2,a[3]=(n.maxY-n.minY)/2;var o=null;n.iconPos&&(o=new d8(n.iconPos.geoX,n.iconPos.geoY));var r=n.name;n.iconPos&&n.iconPos.iconType.indexOf("ditie")>-1&&this._map.getZoom()>14&&(r="");var s={n:r,pt:new d8(n.geoX,n.geoY),userdata:{iconPoint:o,uid:n.guid,name:r,type:n.iconPos.iconType,iconImg:n.iconImg,adver_log:n.adver_log||""},bd:a,tag:"MAP_SPOT_INFO"};this._spotData.push(s)}}var l=new aw("onspotsdataready");l.spots=this._spotData,this._map._spotDataOnCanvas=this._spotData,this._map.dispatchEvent(l)},isClickableLabel:function(t){return t.isDel||"line"===t.type||!t.iconPos||t.iconPos.iconType.indexOf("ditie_zaijian")>-1||"0202"===t.catalog&&this._map.getZoom()>9||"0"===t.guid?!1:!0},getFilterImageData:function(t,e){for(var i=t.data,n=this._labelStrategy,e=parseInt(e),a=0,o=i.length;o>a;a+=4){var r=i[a],s=i[a+1],l=i[a+2],h=i[a+3];if(0!==h){var c=Math.round((r+s+l)/3),d=c-90;d=0>d?0:d,e===n.RANK5&&(i[a]=51+1.3*d,i[a+1]=133+.8*d,i[a+2]=255)}}return t},showLabelCanvas:function(){this._labelCanvas.style.visibility=""},hideLabelCanvas:function(){this._labelCanvas.style.visibility="hidden"}}),v.extend(ao.prototype,{_initColorCanvas:function(){var t=256,e=F("canvas"),i=e.style;i.width=t+"px",i.height=t+"px",e.width=t,e.height=t,this._colorCvs=e,this._colorCtx=e.getContext("2d")},parseLabelData:function(t,e,i,n,a,o){this._featureStyle||(this._featureStyle=this._canvas2dMapMgr.getStyle());var r=this;if(this._iconSetImg)this.loadTextPng(t,a,e,i,n,o);else if(this._iconSetImgRequested===!1){this._iconSetImgRequested=!0;var s=new Image;s.crossOrigin="anonymous",s.onload=function(){r._iconSetImg=this,r.loadTextPng(t,a,e,i,n,o);for(var s=0,l=r._iconSetImgCallBacks.length;l>s;s++)r.loadTextPng.apply(r,r._iconSetImgCallBacks[s]);r._iconSetImgCallBacks.length=0,delete this.onload};var r=this;setTimeout(function(){s.src=r._iconSetUrl},1)}else this._iconSetImgCallBacks.push([t,a,e,i,n,o])},loadTextPng:function(t,e,i,n,a,o){var r=this,s=t[4];if(s){var l=new Image;l.onload=function(){r.calcIconAndTextInfo(t,l,e,i,n,a,o),delete this.onload},l.src=s}else setTimeout(function(){r.calcIconAndTextInfo(t,null,e,i,n,a,o)},1)},calcIconAndTextInfo:function(t,e,i,n,a,o,r){var s=this,l=s._featureStyle,h=[];h.x=n,h.y=a,h.z=o;for(var c=s._canvas2dMapMgr,d=c._getZoomUnits(o),u=n*d*i,p=(a+1)*d*i,f={tileLeft:u,tileTop:p,zoomUnits:d},m=t[0]||[],g=0,_=m.length;_>g;g++){var v=m[g],y=v[5],b=v[2]||"",w=v[4],x=y.split(","),M=l[x[0]],T=null,L=v[6],C=v[1],P=v[9],S=3,A=v[11];if(v[0][1]=i-v[0][1],2==x.length&&(T=l[x[1]]),T&&1!==T[0]&&1===M[0]){var D=T;T=M,M=D}var I={type:"fixed",name:b,textImg:e,rank:v[3],catalog:w,baseX:v[0][0],baseY:v[0][1],iconPos:null,textPos:null,startScale:S,guid:C,relation_guids:P,pGuid:A};if(M&&T&&1===T[0]){var k=this.calcIconPos(v,M,f),E=k.width,z=k.height;I.iconPos=k,o>=3&&9>=o?0===L?(I.textPos=this.calcTextPosTop(v,z),I.textDirTop=!0):1===L?(I.textPos=this.calcTextPosBottom(v,z),I.textDirBottom=!0):2===L?(I.textPos=this.calcTextPosLeft(v,E),I.textDirLeft=!0):I.textPos=this.calcTextPos(v,E):(12===o&&"65e1ee886c885190f60e77ff"===C&&(L=1),L?(I.textPos=this.calcTextPosLeft(v,E),I.textDirLeft=!0):I.textPos=this.calcTextPos(v,E))}else M&&1!==M[0]?I.iconPos=this.calcIconPos(v,M,f):M&&1===M[0]?I.textPos=this.calcTextPos(v):I=null;I&&h.push(I)}for(var B=t[5]||[],g=0,_=B.length;_>g;g++){var O=B[g],R=0;if(O[8])for(var N=0,W=O[8].length;W>N;N++){var Z=O[8][N];R+=Z[0].length}R>0&&O[7]&&R==O[7].length&&this.addLineTextPos(h,O,e,i)}r(h)},addLineTextPos:function(t,e,i,n){for(var a=e[8],o=e[7],r=0,s=this.ratio,l=s,h=0,c=a.length;c>h;h++){var d=a[h],u=[],p=1==d[1]?!0:!1,f=d[0];p&&o.reverse();for(var m=f[0][0][0],g=n-f[0][0][1],_=m-o[r][2]/2,v=g-o[r][3]/2,y=_+o[r][2],b=v+o[r][3],w=0,x=f.length;x>w;w++){var M=f[w],T=o[r][2],L=o[r][3],C=m+(M[0][0]-m)*l-T/2,P=g+(n-M[0][1]-g)*l-L/2,S={angle:M[1],srcX:o[r][0],srcY:o[r][1],destX:C,destY:P,width:T,height:L};_>C&&(_=C),v>P&&(v=P),C+T>y&&(y=C+T),P+L>b&&(b=P+L),u.push(S),r++}var A={type:"line",textImg:i,rank:e[3],baseX:m,baseY:g,arrWordPos:u,_minX:_,_minY:v,_maxX:y,_maxY:b};t.push(A)}},calcIconPos:function(t,e,i){var n=t[0],a=n[0],o=n[1],r=e[1];isNaN(r[0])||(r="_"+r);var s=this.iconSetInfo[r],l=s[0],h=s[1],c=s[2],d=s[3],u=i.tileLeft+a*i.zoomUnits,p=i.tileTop-o*i.zoomUnits;return{srcX:l,srcY:h,destX:a-c/2,destY:o-d/2,width:c,height:d,geoX:u,geoY:p,iconType:r}},calcTextPos:function(t,e){var i=t[0],n=i[0],a=i[1],o=t[7];if(!o)return null;var r=t[8],s=o[0],l=o[1],h=o[2],c=o[3],d=e?e/2:-h/2,u=[];if(r){var p={srcX:s,srcY:l,destX:n+d,destY:a-c,width:h,height:c},f=e?e/2:-r[2]/2,m={srcX:r[0],srcY:r[1],destX:n+f,destY:a,width:r[2],height:r[3]};u.push(p),u.push(m)}else{var p={srcX:s,srcY:l,destX:n+d,destY:a-c/2,width:h,height:c};u.push(p)}return u},calcTextPosLeft:function(t,e){var i=t[0],n=i[0],a=i[1],o=t[7];if(!o)return null;var r=t[8],s=o[0],l=o[1],h=o[2],c=o[3],d=e/2,u=[];if(r){var p={srcX:s,srcY:l,destX:n-d-h,destY:a-c,width:h,height:c},f={srcX:r[0],srcY:r[1],destX:n-d-h,destY:a,width:r[2],height:r[3]};u.push(p),u.push(f)}else{var p={srcX:s,srcY:l,destX:n-d-h,destY:a-c/2,width:h,height:c};u.push(p)}return u},calcTextPosTop:function(t,e){var i=t[0],n=i[0],a=i[1],o=t[7];if(!o)return null;var r=o[0],s=o[1],l=o[2],h=o[3];return[{srcX:r,srcY:s,destX:n-l/2,destY:a-e/2-h,width:l,height:h}]},calcTextPosBottom:function(t,e){var i=t[0],n=i[0],a=i[1],o=t[7];if(!o)return null;var r=o[0],s=o[1],l=o[2],h=o[3];return[{srcX:r,srcY:s,destX:n-l/2,destY:a+e/2,width:l,height:h}]},alterColor:function(t,e,i){var n=this._colorCtx,a=this._canvas2dMapMgr;n.clearRect(0,0,t.width,t.height),n.drawImage(e,t.srcX,t.srcY,t.width,t.height,0,0,t.width,t.height);var o=n.getImageData(0,0,t.width,t.height),r=a.getFilterImageData(o,i);n.putImageData(r,0,0)},drawIconAndText:function(t,e,i){for(var n=this.ratio,a=this.sizeRatio/n,o=0,r=e.length;r>o;o++){var s=e[o];if(0==s.isDel){var l=s.baseDrawX,h=s.baseDrawY;if("fixed"==s.type){var c=s.iconPos,d=s.textPos,u=s.textImg,p=s.startScale,f=s.iconImg||this._iconSetImg;if(c&&i>=p&&t.drawImage(f,c.srcX,c.srcY,c.width,c.height,Math.round(l*n+(c.drawX-l)/a),Math.round(h*n+(c.drawY-h)/a),c.width/a,c.height/a),d&&u&&i>=p){var m=d[0];if(s._tempRank?(this.alterColor(m,u,s._tempRank),t.drawImage(this._colorCvs,0,0,m.width,m.height,Math.round(l*n+(m.drawX-l)/a),Math.round(h*n+(m.drawY-h)/a),m.width/a,m.height/a)):t.drawImage(u,m.srcX,m.srcY,m.width,m.height,Math.round(l*n+(m.drawX-l)/a),Math.round(h*n+(m.drawY-h)/a),m.width/a,m.height/a),2==d.length){var g=d[1];s._tempRank?(this.alterColor(g,u,s._tempRank),t.drawImage(this._colorCvs,0,0,g.width,g.height,Math.round(l*n+(g.drawX-l)/a),Math.round(h*n+(g.drawY-h)/a),g.width/a,g.height/a)):t.drawImage(u,g.srcX,g.srcY,g.width,g.height,Math.round(l*n+(g.drawX-l)/a),Math.round(h*n+(g.drawY-h)/a),g.width/a,g.height/a)}}}else for(var _=s.arrWordPos,u=s.textImg,v=s.tileX,y=s.tileY,b=0,w=_.length;w>b;b++){var x=_[b],M=Math.round(v+x.destX),T=Math.round(y+x.destY),L=x.angle;if(M=l*n+M-l,T=h*n+T-h,L>10&&350>L){t.save();var C=Math.round(M+x.width/2),P=Math.round(T+x.height/2);t.translate(C,P),t.rotate(-L/180*Math.PI),t.drawImage(u,x.srcX,x.srcY,x.width,x.height,-Math.round(x.width/2),-Math.round(x.height/2),x.width/a,x.height/a),t.restore()}else t.drawImage(u,x.srcX,x.srcY,x.width,x.height,M,T,x.width/a,x.height/a)}}}},isCollide:function(t,e,i,n,a,o,r){for(var s=0,l=o.length;l>s;s++){var h=o[s],c=1/Math.pow(2,r+1),d=c*h[3]/2,u=c*h[4]/2,p=h[0];if(p!=t&&!(e+n<h[1]-d||e>h[1]+h[3]+d||i+a<h[2]-u||i>h[2]+h[4]+u))return!0}return!1},zoomingIconAndText:function(t,e,i,n,a,o,r,s,l,h,c){var d=this.ratio,u=this.sizeRatio/d,p=n.x,f=n.y;0!==c&&(f+=h);var m=void 0,g=void 0,_=void 0,v=void 0,y=void 0,b=o>0?!0:!1;if(!b){m=[];var w=1-r}for(var x=0,M=e.length;M>x;x++){var T=e[x];if(0==T.isDel){var L=T.baseDrawX,C=T.baseDrawY;if(t.save(),t.translate(-s*d,-l*d),T.isFadeout){if(b||!(T._schedule<=r)||T._isIgnore){T._isIgnore=!0;continue}t.globalAlpha=w,T._schedule=r}if("fixed"==T.type){var P=T.iconPos,S=T.textPos,A=T.textImg,D=T.startScale,I=T.iconImg||this._iconSetImg;if(P&&a>=D&&(v=P.width,y=P.height,g=(p+(L-p)*i)*d-v/2/u,_=(f+(C-f)*i)*d-y/2/u+c,!b&&this.isCollide(x,g,_,v,y,m,o)&&(T.isFadeout=!0),t.drawImage(I,P.srcX,P.srcY,v,y,Math.round(g),Math.round(_),v/u,y/u),!b&&m.push([x,g,_,v,y])),S&&A&&a>=D)if(P){var k=2==S.length?2:1,E=S[0],z=P.width/2,B=E.height/2*k;if(T.textDirLeft?z=-(P.width/2+E.width):T.textDirTop?(z=-E.width/2,B=P.height/2+E.height):T.textDirBottom&&(z=-E.width/2,B=-P.height/2),g=(p+(L-p)*i)*d+z/u,_=(f+(C-f)*i)*d-B/u+c,v=E.width,y=E.height,!b&&this.isCollide(x,g,_,v,y,m,o)&&(T.isFadeout=!0),T._tempRank?(this.alterColor(E,A,T._tempRank),t.drawImage(this._colorCvs,0,0,v,y,Math.round(g),Math.round(_),v/u,y/u)):t.drawImage(A,E.srcX,E.srcY,v,y,Math.round(g),Math.round(_),v/u,y/u),!b&&m.push([x,g,_,v,y]),2==k){var O=S[1];g=(p+(L-p)*i)*d+z/u,_=(f+(C-f)*i)*d+c,v=O.width,y=O.height,!b&&this.isCollide(x,g,_,v,y,m,o)&&(T.isFadeout=!0),T._tempRank?(this.alterColor(O,A,T._tempRank),t.drawImage(this._colorCvs,0,0,v,y,Math.round(g),Math.round(_),v/u,y/u)):t.drawImage(A,O.srcX,O.srcY,v,y,Math.round(g),Math.round(_),v/u,y/u),!b&&m.push([x,g,_,v,y])}}else{var k=2==S.length?2:1,E=S[0];if(g=(p+(L-p)*i)*d-E.width/2/u,_=(f+(C-f)*i)*d-E.height/2*k/u+c,v=E.width,y=E.height,!b&&this.isCollide(x,g,_,v,y,m,o)&&(T.isFadeout=!0),t.drawImage(A,E.srcX,E.srcY,v,y,Math.round(g),Math.round(_),v/u,y/u),!b&&m.push([x,g,_,v,y]),2==k){var O=S[1];g=(p+(L-p)*i)*d-O.width/2/u,_=(f+(C-f)*i)*d+c,v=O.width,y=O.height,!b&&this.isCollide(x,g,_,v,y,m,o)&&(T.isFadeout=!0),t.drawImage(A,O.srcX,O.srcY,v,y,Math.round(g),Math.round(_),v/u,y/u),!b&&m.push([x,g,_,v,y])}}}else for(var R=T.arrWordPos,A=T.textImg,N=T.tileX,W=T.tileY,Z=R[0],X=Math.round(N+Z.destX),Y=Math.round(W+Z.destY),H=0,U=R.length;U>H;H++){var F=R[H],G=Math.round(N+F.destX),V=Math.round(W+F.destY),j=F.angle,q=Math.round((p+(L-p)*i)*d-Z.width/2+G-X),K=Math.round((f+(C-f)*i)*d-Z.height/2+V-Y);if(g=q,_=K,v=F.width,y=F.height,!b&&this.isCollide(x,g,_,v,y,m,o)&&(T.isFadeout=!0),j>10&&350>j){var $=q+F.width/2,J=K+F.height/2,Q=j/180*Math.PI,te=Math.cos(Q),ee=Math.sin(Q),ie=te,ne=te,ae=ee,oe=-ee,re=$-$*te-J*ee,se=J+$*ee-J*te;t.save(),t.transform(ie,oe,ae,ne,re,se),t.drawImage(A,F.srcX,F.srcY,v,y,g,_,v/u,y/u),t.restore()}else t.drawImage(A,F.srcX,F.srcY,v,y,g,_,v/u,y/u);!b&&m.push([x,g,_,v,y])}t.restore()}}}}),v.extend(dR.prototype,{initVars:function(t){this._map=t._map,this._canvas2dMapMgr=t,this.base64Prefix="data:image/png;base64,",this.bizData=null,this.objTextsPng=null,this.arrIconsPng=null,this.bizLabels=null},proecessBizData:function(t,e){var i=this;this.bizData=t,this.objTextsPng=null,this.arrIconsPng=null;var n=t.textsPng,a=t.iconsPng;if(n&&a){var o=new Image;o.onload=function(){i.objTextsPng=this,i.calcIconAndTextInfo(e),this.onload=null},o.src=this.base64Prefix+n;for(var r=a.length,s=[],l=0;r>l;l++){var h=a[l],c=new Image;!function(t){c.onload=function(){r--,s[t]=this,0===r&&(i.arrIconsPng=s,i.calcIconAndTextInfo(e)),this.onload=null}}(l),c.src=this.base64Prefix+h}}},calcIconAndTextInfo:function(t){if(this.objTextsPng&&this.arrIconsPng){for(var e=this.bizData,i=e.pois,n=[],a=0,o=i.length;o>a;a++){var r=i[a],s=this.arrIconsPng[r.iconPng],l=s.height/2,h={type:"fixed",name:"",textImg:this.objTextsPng,iconImg:s,rank:r.rank,iconPos:{srcX:0,srcY:0,destX:-s.width/2,destY:-l/2,width:s.width,height:l,geoX:r.x,geoY:r.y,iconType:"vectorCustom"},textPos:this.calcTextPos(r.pos,s),startScale:r.from<12?12:r.from,guid:r.guid,guidExt:1,adver_log:r.adver_log||""},c={type:"fixed",textDirLeft:"left",name:"",textImg:this.objTextsPng,iconImg:s,rank:r.rank,iconPos:{srcX:0,srcY:0,destX:-s.width/2,destY:-l/2,width:s.width,height:l,geoX:r.x,geoY:r.y,iconType:"vectorCustom"},textPos:this.calcTextPosLeft(r.pos,s),startScale:r.from<12?12:r.from,guid:r.guid,guidExt:1,adver_log:r.adver_log||""},d=[h,c];n.push(d)}this.bizLabels=n,t&&t()}},calcTextPos:function(t,e){var i=[],n=t.length/4,a=e.width/2;if(1===n){var o={srcX:t[0],srcY:t[1],destX:a,destY:-t[3]/2,width:t[2],height:t[3]};i.push(o)}else{var o={srcX:t[0],srcY:t[1],destX:a,destY:-t[3],width:t[2],height:t[3]},r={srcX:t[4],srcY:t[5],destX:a,destY:0,width:t[6],height:t[7]};i.push(o),i.push(r)}return i},calcTextPosLeft:function(t,e){var i=[],n=t.length/4,a=e.width/2;if(1===n){var o={srcX:t[0],srcY:t[1],destX:-a-t[2],destY:-t[3]/2,width:t[2],height:t[3]};i.push(o)}else{var o={srcX:t[0],srcY:t[1],destX:-a-t[2],destY:-t[3],width:t[2],height:t[3]},r={srcX:t[4],srcY:t[5],destX:-a-t[2],destY:0,width:t[6],height:t[7]};i.push(o),i.push(r)}return i},clearBizData:function(){this.bizData=null,this.bizLabels=null}}),v.extend(bD.prototype,{centerAndZoom:function(t,e,i){if(i=i||{},this.loaded||(this.firstTileLoad=!1),i.noAnimation!==!0&&this.loaded)return void this.flyTo(t,e,i);var n=this;if(t||e){t&&!t.equals(this.centerPoint)&&this.fire(new aw("oncenter_changed")),e&&e!==this.zoomLevel&&this.fire(new aw("oncenter_changed")),t=t||this.centerPoint,e=e||this.zoomLevel,e=this._getProperZoom(e).zoom,this.mapType===BMAP_EARTH_MAP&&(this._earth||(this.mapType=BMAP_NORMAL_MAP,this.temp.originMapType=BMAP_EARTH_MAP,cl.load("earth",function(){n._earth=new d5.Earth(n),n._proxyEarthEvents(),n._changeEarthMapType(BMAP_EARTH_MAP),delete n.temp.originMapType}))),this.lastLevel=this.zoomLevel||e,this.zoomLevel=e;var a=new aw("onload");if(a.point=t,a.zoom=e,this.centerPoint=new d8(t.lng,t.lat),this.defaultZoomLevel=this.defaultZoomLevel||this.zoomLevel,this.defaultCenter=this.defaultCenter||this.centerPoint,this.mapType!==BMAP_EARTH_MAP&&(this.centerPoint=this.restrictCenter(this.centerPoint)),!this.loaded&&this.temp.originMapType!==BMAP_EARTH_MAP){var o=this.config.defaultMaxBounds,r=new bC(o,"baidu",this.mapType),s=new bs({mapType:this.mapType,copyright:r,dataType:dD,customLayer:!1});s._isInnerLayer=!0,s.baseLayer=!0,this.addTileLayer(s),this.mapType===BMAP_SATELLITE_MAP&&this._isHybridShow===!0&&this._addHybirdMap(),this.baseLayerAdded=!0,this.on("zoom_changed",function(){if(0!==this._heading&&this.getZoom()<7){for(var t=this._heading;0>t;)t+=360;t%=360,0!==t&&n.setHeading(0,{unstopable:!0})}})}this.dispatchEvent(a),this.loaded=!0,i.callback&&i.callback()}},_setPlatformPosition:function(t,e,i){if(i=i||{},0!==t||0!==e||i.point){isNaN(i.initMapOffsetX)&&(i.initMapOffsetX=this.offsetX),isNaN(i.initMapOffsetY)&&(i.initMapOffsetY=this.offsetY);var n=b5(this._heading),a=t*Math.cos(n)+e*Math.sin(n),o=-t*Math.sin(n)+e*Math.cos(n);if(a+=i.initMapOffsetX,o+=i.initMapOffsetY,i.point){var r=this.restrictCenter(i.point);r.equals(this.centerPoint)||(this.centerPoint=r.clone(),this.fire(new aw("oncenter_changed")))}else{var s=this.offsetX-a,l=this.offsetY-o,h=this.centerPoint.lng,c=this.centerPoint.lat,d=new d8(h,c),u=this.getZoomUnits();this.centerPoint=this.restrictCenter(new d8(d.lng+s*u,d.lat-l*u),u),this.fire(new aw("oncenter_changed"))}this.offsetX=a,this.offsetY=o,this.dispatchEvent(new aw("onmoving"))}},restrictCenter:function(t,e){e=e||this.getZoomUnits();var i=this.pixelToPoint(new cs(0,0),{center:t}),n=this.pixelToPoint(new cs(0,this.height),{center:t});if(this.zoomLevel<5&&i.lat>bE.MAX_LAT&&n.lat<bE.MIN_LAT){var a,o=bE.MAX_LAT-t.lat,r=t.lat-bE.MIN_LAT;a=r>o?o/(this.height/2):r/(this.height/2);var s=18-cy(a);return this.zoomLevel=s,t}return i.lat>bE.MAX_LAT?t.lat=bE.MAX_LAT-this.height/2*e:n.lat<bE.MIN_LAT&&(t.lat=bE.MIN_LAT+this.height/2*e),t},zoomTo:function(t,e,i){var n=a6[this.mapType];if(n){var a=this._getProperZoom(t);if(t=a.zoom,this.zoomLevel!==t){this.lastLevel=this.zoomLevel,i=i||{},i.fireEvent!==!1&&this.dispatchEvent(new aw("onzoomstart")),!e&&this.getInfoWindow()&&this.temp.infoWin&&this.temp.infoWin.isOpen()&&(e=this.getInfoWindow().getPoint());var o;e&&(o=this.pointToPixel(e));var r=this.pixelToPoint(o),s=this.centerPoint.clone();if(this.fixPoint=e,this.fixPixel=o,this.fixCenter=s,this.mousePosMCPoint=r,i.noAnimation){if(t=a.zoom,this.zoomLevel=t,this.fire(new aw("onzoom_changed")),e){if(this._heading%360!==0||this._tilt>0){var l=this._webglMapCamera.fromScreenPixelToMC(o.x,o.y,{center:s,zoom:this.zoomLevel});if(l){var h=l.sub(r),c=s.sub(h);this.centerPoint=this.restrictCenter(c)}}else{var d=this.getZoomUnits(),c=new d8(e.lng-d*(o.x-this.width/2),e.lat+d*(o.y-this.height/2));this.centerPoint=this.restrictCenter(c,d)}this.fire(new aw("oncenter_changed"))}return void(i.fireEvent!==!1&&this.dispatchEvent(new aw("onzoomend")))}this._animationInfo.zoom={current:this.zoomLevel,diff:t-this.zoomLevel,target:t};var u=this;return i.fireEvent!==!1&&(i.callback=function(){u.dispatchEvent(new aw("onzoomend"))}),this.fixPoint&&(i.renderCallback=function(){u.fixPixel;if(u.fixPixel&&u.fixPoint){var t=u.fixPixel,e=u.fixPoint,i=u.fixCenter,n=u.mousePosMCPoint;if(u._heading%360!==0||u._tilt>0){var a=u._webglMapCamera.fromScreenPixelToMC(t.x,t.y,{center:i,zoom:u.zoomLevel});if(a){var o=a.sub(n),r=i.sub(o);u.centerPoint=u.restrictCenter(r)}}else{var s=t,l=u.getZoomUnits(),r=new d8(e.lng-l*(s.x-u.width/2),e.lat+l*(s.y-u.height/2));u.centerPoint=u.restrictCenter(r,l)}u.fire(new aw("oncenter_changed"))}}),i.fromMouseWheel===!0?void this._startInfiniteZoomAnimation(i):void this._startAnimation(i)}}},deepZoomMedia:function(t){var e=this;e.temp.isStdCtrlBusy||(e.temp.isStdCtrlBusy=!0,e.deepZoomTo(e.zoomLevel+t),setTimeout(function(){e.temp.isStdCtrlBusy=!1},400))},deepZoomTo:function(t){this.zoomTo(t)},flyTo:function(t,e,i){function n(t){var e=(M*M-x*x+(t?-1:1)*L*L*T*T)/(2*(t?M:x)*L*T);return Math.log(Math.sqrt(e*e+1)-e)}function a(t){return(Math.exp(t)-Math.exp(-t))/2}function o(t){return(Math.exp(t)+Math.exp(-t))/2}function r(t){return a(t)/o(t)}if(i=i||{},!this.centerPoint.equals(t)||this.zoomLevel!==e||"number"==typeof i.heading||"number"==typeof i.tilt){var s=dn(this.getHeading(),360),l=this.getTilt(),h=0,c=0,d=this.getBounds().containsPoint(t);"number"==typeof i.heading?h=i.heading:d&&(h=s),"number"==typeof i.tilt?c=i.tilt:d&&(c=l),this._heading=s;var u=h-s,p=c-l,f=this,m=this.zoomLevel,g=1.42,_=this.zoomScale(e-m),v=this.getZoomUnits(),y=this.centerPoint.div(v),b=t.div(v),w=(this.worldSize(),g),x=Math.max(this.width,this.height),M=x/_,T=b.sub(y).mag(),L=w*w,C=n(0),P=function(t){return o(C)/o(C+w*t)},S=function(t){return x*((o(C)*r(C+w*t)-a(C))/L)/T},A=(n(1)-C)/w;if(Math.abs(T)<1e-6){if(Math.abs(x-M)<1e-6)return this._animationInfo.zoom={current:this.zoomLevel,diff:e-this.zoomLevel},this._animationInfo.center={current:this.centerPoint,diff:t.sub(this.centerPoint)},this._animationInfo.heading={current:s,diff:h-s},this._animationInfo.tilt={current:l,diff:c-l},void this._startAnimation({callback:i.callback,duration:i.duration});
var D=x>M?-1:1;A=Math.abs(Math.log(M/x))/w,S=function(){return 0},P=function(t){return Math.exp(D*w*t)}}var I=1.7;.3>A?I=.8:A>5&&(I=(A-5)/2+I);var k=i.duration||1e3*A/I;this.fire(new aw("onmovestart")),this.fire(new aw("onzoomstart")),this._startAnimation({duration:k,renderCallback:function(t){var e=t*A,i=S(e),n=m+f.scaleZoom(1/P(e));if(n<f.getMinZoom()&&(n=f.getMinZoom()),n>f.getMaxZoom()&&(n=f.getMaxZoom()),n!==f.zoomLevel&&(f.zoomLevel=n,f.fire(new aw("onzoom_changed"))),f.centerPoint=y.add(b.sub(y).mult(i)).mult(v),f.fire(new aw("oncenter_changed")),"number"==typeof h){var a=t/.7;a>1&&(a=1),f.setHeading(s+u*t,{noAnimation:!0})}"number"==typeof c&&f.setTilt(l+p*t,{noAnimation:!0})},callback:function(t,n){return n&&n.stop===!0?(f.fire(new aw("onmoveend")),void f.fire(new aw("onzoomend"))):(e!==f.zoomLevel&&(f.zoomLevel=e,f.fire(new aw("onzoom_changed"))),f.fire(new aw("onmoveend")),f.fire(new aw("onzoomend")),void(i.callback&&i.callback(t)))}})}},zoomScale:function(t){return Math.pow(2,t)},scaleZoom:function(t){return Math.log(t)/Math.LN2},worldSize:function(){var t=40075452,e=this.zoomLevel;return t/Math.pow(2,18-e)},panTo:function(t,e){if(e=e||{},!t||t.equals(this.centerPoint))return void(e.callback&&e.callback());var i=this.pointToPixel(t),n=Math.round(this.width/2),a=Math.round(this.height/2);return e.noAnimation===!0?(this._panTo(n-i.x,a-i.y,t),void(e.callback&&e.callback())):void this.flyTo(t,this.zoomLevel,e)},_panTo:function(t,e,i){var n=this.temp;n.operating!==!0&&(n.dragAni&&(n.dragAni.stop(!1,{readyToMove:!0}),n.dragAni=null),this.dispatchEvent(new aw("onmovestart")),this._setPlatformPosition(t,e,{point:i}),this.dispatchEvent(new aw("onmoveend")))},panBy:function(t,e,i){t=Math.round(t)||0,e=Math.round(e)||0,i=i||{},Math.abs(t)<=this.width&&Math.abs(e)<=this.height&&i.noAnimation!==!0?this._panBy(t,e,i):(this._panTo(t,e),i.callback&&i.callback())},_panBy:function(t,e,i){if(this.temp.operating!==!0){i=i||{},this.dispatchEvent(new aw("onmovestart"));var n=this,a=n.temp;a.pl=n.offsetX,a.pt=n.offsetY,a.tlPan&&a.tlPan.cancel(),a.dragAni&&(a.dragAni.stop(!1,{readyToMove:!0}),a.dragAni=null),a.tlPan=new m({fps:i.fps||n.config.fps,duration:i.duration||n.config.actionDuration,transition:i.transition||bh.easeInOutQuad,render:function(i){this.terminative=n.temp.operating,n.temp.operating||n._setPlatformPosition(t*i,e*i,{initMapOffsetX:a.pl,initMapOffsetY:a.pt})},finish:function(){n.dispatchEvent(new aw("onmoveend")),n.temp.tlPan=!1,n.temp.stopArrow===!0&&(n.temp.stopArrow=!1,0!==n.temp.arrow&&n._arrow())}})}},_startAnimation:function(t){var e=this._animationInfo,i=this;t=t||{},i._ani&&i._ani.stop(!!t.goToEnd,{stopCurrentAnimation:t.stopCurrentAnimation}),i._infiniteAni&&(i._infiniteAni.stop(),i._infiniteAni=null);var n=t.duration||500,a=t.transition||bh.ease,o=new aw("onanimation_start");this.fire(o),t.unstopable&&(e=this._animationInfoUnstopable);var r=new m({duration:n,transition:a,render:function(n,a){for(var o in e)if(e.hasOwnProperty(o)){var r=e[o].current,s=e[o].diff;i._setValueTick(o,r,s,n)}t.renderCallback&&t.renderCallback(n,a)},finish:function(e){i.fire(new aw("onanimation_end")),t.unstopable?(i._animationInfoUnstopable={},i._unstopableAni=null):(i._ani=null,i._animationInfo={}),t.mapNeedCbk&&t.mapNeedCbk(),t.callback&&t.callback(e)},onStop:function(e){e=e||{},i.fire(new aw("onanimation_end")),e.stopCurrentAnimation&&(i._animationInfo={}),i._ani=null,t.mapNeedCbk&&t.mapNeedCbk(),t.callback&&t.callback(null,{stop:!0})}});t.unstopable?i._unstopableAni=r:i._ani=r},_startInfiniteZoomAnimation:function(t){var e=this;e._ani&&e._ani.stop(!!t.goToEnd,{stopCurrentAnimation:t.stopCurrentAnimation}),e._infiniteAni||(this.fire(new aw("onanimation_start")),e._infiniteAni=new m({duration:1e4,transition:bh.linear,render:function(){var i=e._animationInfo.zoom;return Math.abs(i.current-i.target)<.001?(e._setValue("zoom",i.target),void e._infiniteAni.stop()):(i.current+=.35*(i.target-i.current),e._setValue("zoom",i.current),void(t.renderCallback&&t.renderCallback()))},finish:function(){e._infiniteAni=null,e._animationInfo={},e.fire(new aw("onanimation_end")),t.callback&&t.callback()},onStop:function(){e._infiniteAni=null,e._animationInfo={},e.fire(new aw("onanimation_end")),t.callback&&t.callback()}}))},_setValue:function(t,e){if("zoom"===t){this._preZoomLevel=this.zoomLevel;var i=this._getProperZoom(e);return e=i.zoom,void(e!==this.zoomLevel&&(this.zoomLevel=e,5>e&&this.restrictCenter(this.centerPoint),this.fire(new aw("on"+t+"_changed"))))}"center"===t&&(this.centerPoint=e),this["_"+t]=e,this.fire(new aw("on"+t+"_changed"))},_setValueTick:function(t,e,i,n){if("center"===t){var a=new d8(e.lng+i.lng*n,e.lat+i.lat*n);return void this._setValue(t,a)}return"zoom"===t?void this._setValue(t,Math.pow(e,1-n)*Math.pow(e+i,n)):void this._setValue(t,e+i*n)},setHeading:function(t,e){if(e=e||{},t===this._heading)return void(e.callback&&e.callback());var i=dn(this._heading,360),n=dn(t,360);return n===i?(this._heading=t,void(e.callback&&e.callback())):e.noAnimation?(this._setValue("heading",t),void(e.callback&&e.callback())):(e.unstopable?this._animationInfoUnstopable.heading={current:this._heading,diff:t-this._heading}:this._animationInfo.heading={current:this._heading,diff:t-this._heading},void this._startAnimation(e))},getHeading:function(){return this._heading},setTilt:function(t,e){return e=e||{},t===this._tilt?void(e.callback&&e.callback()):(t>bE.MAX_TILT&&(t=bE.MAX_TILT),e&&e.noAnimation?(this._setValue("tilt",t),void(e.callback&&e.callback())):(this._animationInfo.tilt={current:this._tilt,diff:t-this._tilt},void this._startAnimation(e)))},getTilt:function(){return this._tilt},getCenter:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},getCameraPosition:function(t){t=t||{};var e=t.center||this.centerPoint,i=t.zoom||this.zoomLevel,n="number"==typeof t.heading?t.heading:this._heading,a="number"==typeof t.tilt?t.tilt:this._tilt,o=this._webglMapCamera.generateMVMatrix(e,i,n,a),r=mat4.create(Float32Array);return mat4.invert(r,o),this._webglMapCamera.getPosition(r)}}),dh.MAX_IDLE_TIME=50,dh.MAX_FRAME_TIME=6,dh.prototype.runJobs=function(t){if(0!==this._jobQueue.length){var e=da(),i=0;for(t=t||dh.MAX_FRAME_TIME;this._jobQueue.length&&t>i;){var n=this._jobQueue.shift();"invalid"!==n.state&&n.call(),i=da()-e}}},dh.prototype.runIdleOnlyJobs=function(){if(0!==this._idleOnlyJobQueue.length)for(var t=da(),e=0;this._idleOnlyJobQueue.length&&e<dh.MAX_IDLE_TIME;){var i=this._idleOnlyJobQueue.shift();"invalid"!==i.state&&i.call(),e=da()-t}},dh.prototype.checkIdleRunning=function(){this.isIdle&&!this.idleWorkTimer&&(this.runJobs(),this.runIdleOnlyJobs(),this.idleWorkTimer=setInterval(this._idleWorkerTicker,50))},dh.prototype.addJob=function(t){this._jobQueue.push(t),this.checkIdleRunning()},dh.prototype.clearJobs=function(){this._jobQueue.length=0,this._idleOnlyJobQueue.length=0},dh.prototype.addIdleOnlyJob=function(t){this._idleOnlyJobQueue.push(t),this.checkIdleRunning()};var a9={},bJ={result:{bkData:[],eleData:[[],[],[],[],[],[]],tileLabels:[]},getResult:function(){return this.result},setData:function(t,e,i,n){var a=this.result.bkData;a[e]||(a[e]=[],a[e].dataType=i||2,a[e].png8=n||!1,a[e].replacePos={}),a[e].push(t);var o=t[0].tileInfo,r=o[0],s=o[1],l=o[2],h="pos_"+r+"_"+s+"_"+l;a[e].replacePos[h]=a[e].length-1},replaceData:function(t,e){var i=this.result.bkData;if(i[e]&&i[e].replacePos){var n=t[0].tileInfo,a=n[0],o=n[1],r=n[2],s="pos_"+a+"_"+o+"_"+r,l=i[e].replacePos[s];i[e][l]&&(i[e][l]=t)}},setLabelData:function(t){this.result.tileLabels=t},getLabelData:function(){return this.result.tileLabels},setOverlayData:function(t,e){this.result.eleData[e]&&(this.result.eleData[e]=t)},clearLabelOverlayData:function(){this.result.eleData[2]=[],this.result.eleData[3]=[],this.result.eleData[4]=[]},clearData:function(){this.result.bkData.length=0}},ax=bJ;d5.FeatureMgr=ax,window.xxx=ax;var cB=1,dD=2,dj={drawIndex:0,devicePixelRatio:window.devicePixelRatio||1,zoomState:1,curViewTilesInfo:null,iconSetImg:null,LAST_CALC_ZOOM:-1,LAST_LOAD_VECTOR_ZOOM_CHANGE:!1,vectorDataURLs:["//online0.map.bdimg.com","//online1.map.bdimg.com","//online2.map.bdimg.com","//online3.map.bdimg.com"],requestPath:"/pvd/?qt=tile",remove:function(){this.tileCache.clear()},setZIndex:function(t){this.zIndex=t},getTileKey:function(t,e,i){return this.mapType+"_"+t+"_"+e+"_"+i},getTileUnits:function(t){var e=this.map,i=a6[e.getMapType()],n=i.baseUnits*Math.pow(2,i.zoomLevelBase-t);return n},getVectorVersionInfo:function(){if(this.versionInfo)return this.versionInfo;var t="undefined"!=typeof TVC?TVC.ditu.normal:{},e=t.version?t.version:"001",i=t.updateDate?t.updateDate:"20171031";return this.versionInfo={ver:e,udt:i},this.versionInfo},getTilesUrl:function(t,e){var i=this.getTileUnits(e),n=Math.floor(t.lng/i),a=Math.floor(t.lat/i),o=this.getVectorVersionInfo(),r=o.ver,s=o.udt;n=cg.calcLoopParam(n,e).col;var l=cR.tilePath;window.offLineIPAddress&&(l=[window.offLineIPAddress]);var h=Math.abs(n+a)%l.length,c="&x="+n+"&y="+a+"&z="+Math.floor(e),d=e>=3&&9>=e?100:80,u=this.devicePixelRatio>1?"&scaler=2":"",p=l[h]+this.requestPath+c+"&styles=pl&p=0&cm=1&limit="+d+u+"&v="+r+"&udt="+s;return"1"===window.nuzad&&(p+="&tcode=nuzad"),p},getRasterTilesUrl:function(t,e,i){var n=a6[this.map.mapType],a=n.tileUrls[Math.abs(e+t)%n.tileUrls.length]+"?qt=tile&x="+t+"&y="+e+"&z="+i+"&styles=pl&udt="+this.normalUdt+"&scaler="+this.scaler+"&p=1";return a=a.replace(/-(\d+)/gi,"M$1")},getZoomState:function(){var t=this.map,e=t.getZoom(),i=e-this.lastZoom;return i>0?this.zoomState=1:0>i&&(this.zoomState=-1),this.lastZoom=e,this.zoomState},releaseOutViewTileData:function(t){for(var e=WorkerMgr.releasePendingData(t),i=0,n=e.length;n>i;i++){var a=e[i],o=a[0],r=a[1],s=a[2],l=this.getTileKey(o,r,s);this.tileCache.removeData(l)}},loadLayerData:function(t,e,i){this.hasZoomChange=i,this.curViewTilesInfo=t,this.releaseOutViewTileData(t);var n=this.getZoomState();this.dataType===dD?(e?this.getVectorLayerDataFromCache(t,n):this.loadVectorLayerData(t),this.isLoadIconSetImg||(this.isLoadIconSetImg=!0,this.loadIconSetImg())):this.loadRasterLayerData(t,e)},loadIconSetImg:function(t){var e="udt=20171031&v=001";t&&(e+="&ts="+Date.now().toString()),"undefined"!=typeof MSV&&MSV.mapstyle&&(e="udt="+MSV.mapstyle.updateDate+"&v="+MSV.mapstyle.version);var i="";i=this.devicePixelRatio>1?cR.iconSetPath+"icons_pl2_0.png?"+e:cR.iconSetPath+"icons_pl.png?"+e;var n=this,a=new Image;a.crossOrigin="anonymous",a.onload=function(){n.iconSetImg=this,delete this.onload,n.dataBackCollideLabels();var t=new aw("onrefresh");n.map.dispatchEvent(t)},a.src=i},getVectorLayerDataFromCache:function(t,e){this.map.temp.isPermitSpotOver=!1,this.tileLabels=[];for(var i=-1,n=0,a=t.length;a>n;n++){var o=t[n],r=o[0],s=o[1],l=o[2];i=l;var h=this.getTileKey(r,s,l),c=this.tileCache.getData(h);if(c&&"ready"===c.status){var d=[c];if(d.dataType=c.dataType||dD,d5.FeatureMgr.setData(d,this.drawIndex,dD),c.label)if("ready"===c.label.status){if(this.tileLabels.push(c.label),c.label.textImg&&this.map._webglMapScene){var u=this.map._webglMapScene._painter;u._labelTextureAtlasOffset[h]||(c.label.textureSource=c.label.textImg,c.label.textureHeight=c.label.textRealHeight,u._addToAsyncJob(c.label))}}else"processing"!==c.label.status&&this.processLabelData(c)}else{var p=[{tileInfo:[r,s,l,0]}];p.dataType=dD,this.setThumbData(r,s,l,e,p)}}this.tileLabels.labelZoom=i,this.updateLabels(e);var f=this.map.getZoom(),m=Math.floor(f),g=f-m,_=Math.floor(this.LAST_CALC_ZOOM),v=this.LAST_CALC_ZOOM-_,y=!1;this.hasZoomChange?(Math.abs(f-this.LAST_CALC_ZOOM)>=.5?y=!0:.5>g&&v>=.5?y=!0:g>=.5&&.5>v&&(y=!0),y&&this.cacheDataCollideLabels(0),this.LAST_CALC_ZOOM=f):this.LAST_LOAD_VECTOR_ZOOM_CHANGE||this.tileLabels.length>0&&this.cacheDataCollideLabels(30),this.LAST_LOAD_VECTOR_ZOOM_CHANGE=this.hasZoomChange},loadVectorLayerData:function(t){this.map.temp.isPermitSpotOver=!1;for(var e=this,i=0,n=t.length;n>i;i++){var a=t[i],o=a[0],r=a[1],s=a[2],l=a[3],h=this.getTileKey(o,r,s),c=this.tileCache.getData(h);if(!c||"ready"!==c.status&&"loading"!==c.status){this.numLoading++;var d={status:"loading"};this.tileCache.setData(h,d),this.loadVectorTileData(o,r,s,l,function(t,i){if(!t||t.error){var n=new aw("ontileloaderror");return t=t||{},n.error=t.error||"",n.message=t.message||"",e.map.fire(n),void e.tileCache.removeData(i)}if(t.useUrl===!0){var a=t.tileInfo[0],o=t.tileInfo[1],r=t.tileInfo[2],s=e.getRasterTilesUrl(a,o,r),l=e.loadTileImage(s,t.tileKey,function(t,i){e.rasterTileDataCbk(t,i)});return void(l.tileInfo=t.tileInfo)}e.callbackDataQueue.push([t,i]),e.processDataTimer||(e.processDataTimer=setTimeout(function(){for(;e.callbackDataQueue.length>0;){var t=e.callbackDataQueue.shift();e.vectorTileDataCbk(t[0],t[1]),e._checkTilesLoaded()}e.processDataTimer=null},200))})}}},setThumbData:function(t,e,i,n,a){1===n?this._findParentZoomTile(t,e,i,8,a)===!1&&this._findChildZoomTile(t,e,i,3,a):-1===n&&this._findChildZoomTile(t,e,i,3,a)===!1&&this._findParentZoomTile(t,e,i,8,a),d5.FeatureMgr.setData(a,this.drawIndex,dD)},_findParentZoomTile:function(t,e,i,n,a){for(var o=a6[this.getMapType()],r=o.minDataZoom,s=(o.maxDataZoom,1);n>=s;s++){var l=i-s;if(r>l)return!1;var h=Math.pow(2,s),c=Math.floor(t/h),d=Math.floor(e/h),u=this.getTileKey(c,d,l),p=this.tileCache.getData(u);if(p&&"ready"===p.status)return a.push(p),!0}return!1},_findChildZoomTile:function(t,e,i,n,a){for(var o=a6[this.getMapType()],r=(o.minDataZoom,o.maxDataZoom),s=!0,l=1;n>=l;l++){var h=i+l;if(h>r)return!1;for(var c=!1,d=Math.pow(2,l),u=t*d,p=e*d,f=0;d>f;f++)for(var m=u+f,g=0;d>g;g++){var _=p+g,v=this.getTileKey(m,_,h),y=this.tileCache.getData(v);y&&"ready"===y.status?(a.push(y),c=!0):s=!1}if(c)break}return s},loadVectorTileData:function(t,e,i,n,a){var o=this.getTileUnits(i),r=new d8(t*o,e*o),s=this.getTilesUrl(r,i),l=[t,e,i,n],h=this.getTileKey(t,e,i);if(!this.processData)return void WorkerMgr.loadTileData(s,l,h,a);var a="cbk"+h,c=this;d5[a]=function(n){var o=function(n){return function(){n.tileInfo=l;var a=c.processData(n);if(a.road){var o={tileInfo:[t,e,i,0],road:[[]],status:"ready",key:h,mapType:c.mapType};d5.lineVertexUtil.initLineModule(function(){for(var t=0;t<a.road.length;t++){for(var e=a.road[t],i=-1,n=0;n<e.length;n++){var r=e[n],s=r[3];i=d5.lineVertexUtil.solidLine(r[0],r[1],r[2],s,r[4],i)}o.road[0].push({style:[],styleData:[d5.lineVertexUtil.getVertices(),d5.lineVertexUtil.getIndices()]}),d5.lineVertexUtil.reset()}c.tileCache.setData(h,o,dD),d5.FeatureMgr.replaceData([o],c.drawIndex),c.map.dispatchEvent(new aw("onrefresh"))})}}}(n);c.map.jobScheduler.addJob(o),delete d5[a]},s+="&fn=BMap."+a,w.request(s)},vectorTileDataCbk:function(t,e){var i=new aw("ontileloaded");i.perfStat=t.perfStat||[];var n=this.map;n.fire(i);var a=t.tileInfo,o=a[0],r=a[1],s=a[2],l=cg.calcLoopParam(o,s),h=l.geoOffsetX;t.tileInfo[3]=h,t.status="ready",t.key=e,t.mapType=this.mapType,this.tileCache.setData(e,t,dD);var c="id_"+o+"_"+r+"_"+s;if(!this.curViewTilesInfo[c])return void n.fire(new aw("ontilenotinview"));var d=[t];d.dataType=dD,d5.FeatureMgr.replaceData(d,this.drawIndex),this.processLabelData(t),d[0].indoorData&&(n._indoorMgr.setData(d[0].indoorData),n._indoorMgr.currentUid&&this._refreshIndoorData(n._indoorMgr.currentUid,n._indoorMgr.currentFloor));var u=new aw("onrefresh");u.source="webgllayer",this.map.dispatchEvent(u)},_refreshIndoorData:function(t,e){for(var i=this.map._indoorMgr.getIndoorData(t),n=i.tileKeys,a=0;a<n.length;a++){var o=n[a],r=this.tileCache.getData(o);if(!r)return;r.indoorArea=[],r.indoorBorder=[],r.indoorBorder3D=[],r.indoorArea3D=[],r.label.indoorLabel=[],this.labelProcessor.clearCollisionCache(r.label);for(var s in r.indoorData)if("tileInfo"!==s){var l=r.indoorData[s],h=l.defaultFloor;s===t&&(h=e,l.currentFloor=e),l.floors[h].area&&r.indoorArea.push(l.floors[h].area),l.floors[h].indoorBorder&&r.indoorBorder.push([l.floors[h].indoorBorder]),l.floors[h].indoorBorder3D&&r.indoorBorder3D.push([l.floors[h].indoorBorder3D]),l.floors[h].area3D&&r.indoorArea3D.push(l.floors[h].area3D),r.label.indoorLabel=r.label.indoorLabel.concat(l.floors[h].pois)}d5.FeatureMgr.replaceData([r],this.drawIndex)}this.dataBackCollideLabels(),this.map.dispatchEvent(new aw("onrefresh"))},_removeIndoorData:function(t){if(t.indoorData)for(var e in t.indoorData)"tileInfo"!==e&&this.map._indoorMgr.removeData(e,t.key)},processLabelData:function(t){if("processing"!==t.label.status){t.label.status="processing";var e=this;this.labelProcessor.process(t.label.textImgStr,function(i){var n=t.label;if(n.textImgStr="",n.tileInfo=t.tileInfo,n.status="ready",n.textImg=i,n.textImg&&(i.id=t.key,e.map._webglMapScene)){var a=e.map._webglMapScene._painter;n.textureSource=n.textImg,n.textureHeight=n.textRealHeight,a._addToAsyncJob(n)}e.tileLabels.push(n),e.collisionTimer||(e.collisionTimer=setTimeout(function(){e.dataBackCollideLabels(),e.collisionTimer=null},300))})}},cacheDataCollideLabels:function(t){function e(){i.cacheLabelTimer=null;var t,e=i.map.getTilt(),n=i.map.getHeading()%360;if(0===i.tileLabels.length)t=ax.getLabelData(),t.length>0&&(t=i.labelProcessor.collisionTest(t,-1));else{if(e||n)return this._collisionTimer&&clearTimeout(this._collisionTimer),void(this._collisionTimer=setTimeout(function(){t=i.labelProcessor.collisionTest(i.tileLabels),t&&i.iconSetImg&&(t.iconSetImg=i.iconSetImg,ax.setLabelData(t)),i.updateLabels(),i.map.dispatchEvent(new aw("onrefresh")),i._collisionTimer=null},60));t=i.labelProcessor.getCachedLabels(i.tileLabels)}t&&i.iconSetImg&&(t.iconSetImg=i.iconSetImg,ax.setLabelData(t)),i.updateLabels(),i.map.dispatchEvent(new aw("onrefresh"))}var i=this;if(t){if(i.cacheLabelTimer)return;i.cacheLabelTimer=setTimeout(function(){e()},t)}else clearTimeout(i.cacheLabelTimer),e()},dataBackCollideLabels:function(){var t=this;if((!t.tileLabels||0!==t.tileLabels.length)&&t.iconSetImg){var e;t.labelProcessor.cacheLabelResult(t.tileLabels),e=t.labelProcessor.getCachedLabels(t.tileLabels),e&&t.iconSetImg&&(e.iconSetImg=t.iconSetImg,ax.setLabelData(e)),t.updateLabels(),t.map.dispatchEvent(new aw("onrefresh"))}},updateLabels:function(){var t=this.map,e=ax.getLabelData();if(e.length>0){var i=t.getZoom();if(e.labelZoom-i<3){this.labelProcessor.updateLabels(e);var n=this.labelProcessor.fixDataFormat(e);ax.setOverlayData(n[0],2),ax.setOverlayData(n[1],3),ax.setOverlayData(n[2],4)}else ax.clearLabelOverlayData();t.temp.isPermitSpotOver=!1,this.labelProcessor.curSpotAdded=!1}},loadRasterLayerData:function(t,e){if(e)for(var i=0,n=t.length;n>i;i++){var a=t[i],o=a[0],r=a[1],s=a[2],l=this.getTileKey(o,r,s),h=this.tileCache.getData(l);if(h&&"ready"===h.status){var c=[h];c.dataType=cB,c.png8=this.png8||!1,d5.FeatureMgr.setData(c,this.drawIndex,cB,this.png8)}}else for(var i=0,n=t.length;n>i;i++){var a=t[i],o=a[0],r=a[1],s=a[2],d=a[3],l=this.getTileKey(o,r,s),h=this.tileCache.getData(l);if(!h){this.tileCache.setData(l,{});var u=this;this.loadRasterTileData(o,r,s,d,function(t,e){u.rasterTileDataCbk(t,e)})}}},loadRasterTileData:function(t,e,i,n,a){var o=this.getTileUnits(i),r=new d8(t*o,e*o),s=this.getTilesUrl(r,i),l=[t,e,i,n],h=this.getTileKey(t,e,i),c=this.loadTileImage(s,h,a);c.tileInfo=l},loadTileImage:function(t,e,i){var n=new Image;return n.crossOrigin="anonymous",n.onload=function(){i&&i(this,e)},n.onerror=function(){i&&i(null,e)},n.src=t,n},rasterTileDataCbk:function(t,e){if(!t)return void this.tileCache.removeData(e);var i=t.tileInfo,n=i[0],a=i[1],o=i[2],r=this.tileCache.getData(e);if(r){var s=cg.calcLoopParam(n,o),l=s.geoOffsetX;t.tileInfo[3]=l,r.textureSource=t,r.dataType=cB,r.tileInfo=i,r.renderData={vertexAll:[0,0,0,0,0,256,0,0,1,0,256,256,0,1,1,0,0,0,0,0,256,256,0,1,1,0,256,0,0,1]},r.status="ready",this.tileCache.setData(e,r);var h="id_"+n+"_"+a+"_"+o,c=!1;if(this.curViewTilesInfo[h]){var d=[r];d.dataType=cB,d.png8=this.png8||!1,d5.FeatureMgr.setData(d,this.drawIndex,cB,this.png8),c=!0}if(c){var u=new aw("onrefresh");u.source="webgllayer",this.map.dispatchEvent(u)}}},_checkTilesLoaded:function(){this.numLoading--,this.map.firstTileLoad===!1&&(this.map.dispatchEvent(new aw("onfirsttilesloaded")),this.map.firstTileLoad=!0);var t=this;0===this.numLoading&&(this._checkLoadedTimer&&(clearTimeout(this._checkLoadedTimer),this._checkLoadedTimer=null),this._checkLoadedTimer=setTimeout(function(){0===t.numLoading&&t.map.dispatchEvent(new aw("ontilesloaded")),t._checkLoadedTimer=null},60))},isClickableLabel:function(t){return t.isDel||!t.iconPos||t.iconPos.iconType.indexOf("ditie_zaijian")>-1||"0202"===t.catalog&&this.map.getZoom()>9||"0"===t.guid?!1:!0}};v.extend(bO.prototype,{bind:function(){var t=this.map,e=this;t.addEventListener("mapstatusbusy_inner",function(){e._useRound=!1,e._mapIsMoving=!0}),t.addEventListener("mapstatusidle_inner",function(){e._useRound=!0,e._mapIsMoving=!1}),t.addEventListener("onspotmouseover",function(t){if(this.temp.isPermitSpotOver&&t.spots.length>0){var i=t.spots[0].userdata.uid,n=t.spots[0].userdata.tilePosStr,a=e.getLabelByUid(i,n);a&&a.formatedData&&e._toHighlightColor(a.formatedData)}}),t.addEventListener("onspotmouseout",function(t){if(this.temp.isPermitSpotOver&&t.spots.length>0){var i=t.spots[0].userdata.uid,n=t.spots[0].userdata.tilePosStr,a=e.getLabelByUid(i,n);a&&a.formatedData&&e._toDefaultColor(a.formatedData)}}),t.addEventListener("onspotclick",function(t){if(t.spots&&t.spots.length>0){if(t.spots[0].userdata.zoom<10)return;var i=t.spots[0].userdata.uid,n=t.spots[0].userdata.tilePosStr;!e.currentSelectedLabel||e.currentSelectedLabel.uid===i&&e.currentSelectedLabel.tilePosStr===n||e._recoverNormalState();var a=e.getLabelByUid(i,n);a&&e._changeBaseMapState(a)}else e._recoverNormalState()}),t.on("spot_status_reset",function(){e._recoverNormalState()}),t.addEventListener("mousemove",function(){e.curSpotAdded||this.currentOperation===cc.idle&&e._mapIsMoving!==!0&&(e._refreshSpotData(),this.temp.isPermitSpotOver=!0,e.curSpotAdded=!0)})},getLabelByUid:function(t,e){for(var i=ax.getResult().tileLabels,n=0;n<i.length;n++){for(var a=i[n].fixedLabel,o=0;o<a.length;o++)if(i[n].fixedLabel[o].guid===t&&i[n].fixedLabel[o].tilePosStr===e)return i[n].fixedLabel[o];for(var r=i[n].indoorLabel,o=0;o<r.length;o++)if(i[n].indoorLabel[o].guid===t&&i[n].indoorLabel[o].tilePosStr===e)return i[n].indoorLabel[o]}return null},getTileByLabelUid:function(t){for(var e=ax.getResult().tileLabels,i=0;i<e.length;i++){for(var n=e[i].fixedLabel,a=0;a<n.length;a++)if(e[i].fixedLabel[a].guid===t)return e[i];for(var o=e[i].indoorLabel,a=0;a<o.length;a++)if(e[i].indoorLabel[a].guid===t)return e[i]}return null},_toHighlightColor:function(t){if(!t.tempRank||t.tempRank!==this.RANK5){for(var e=ax.getResult().eleData[4]||[],i=!1,n=0;n<e.length;n++)if(e[n]===t||e[n].guid===t.guid&&e[n].tilePosStr===t.tilePosStr&&e[n].zoom===t.zoom){i=!0;break}i||(e.push(t),ax.setOverlayData(e,4),this.map.dispatchEvent(new aw("onrefresh")))}},_toDefaultColor:function(t){if(!t.tempRank||t.tempRank!==this.RANK5){for(var e=ax.getResult().eleData[4]||[],i=0;i<e.length;i++)if(t===e[i]||t.guid===e[i].guid&&t.tilePosStr===e[i].tilePosStr&&t.zoom===e[i].zoom){e.splice(i,1);break}ax.setOverlayData(e,4),this.map.dispatchEvent(new aw("onrefresh"))}},_changeBaseMapState:function(t){var e=t.guid,i=t.formatedData.guidExt,n={guid:e,tilePosStr:t.tilePosStr,guidExt:i};this._strategyInfo=n,this.currentSelectedLabel=t;var a=ax.getLabelData();a=this.collisionTest(a),this.updateLabels(a);var o=this.fixDataFormat(a);ax.setOverlayData(o[0],2),ax.setOverlayData(o[1],3),ax.setOverlayData(o[2],4);var r=this.getTileByLabelUid(e);this.currentSelectedLabel.tileInfo=r.tileInfo,this.clearCollisionCache(r);for(var s=0;s<a.length;s++)1===Math.abs(a[s].tileInfo[0]-r.tileInfo[0])&&1===Math.abs(a[s].tileInfo[1]-r.tileInfo[1])&&this.clearCollisionCache(a[s])},_recoverNormalState:function(){this._strategyInfo=null;var t=!1,e=ax.getLabelData();if(this.currentSelectedLabel){var i=this.currentSelectedLabel.guid;this.clearCollisionCache(this.getTileByLabelUid(i));for(var n=0;n<e.length;n++)1===Math.abs(e[n].tileInfo[0]-this.currentSelectedLabel.tileInfo[0])&&1===Math.abs(e[n].tileInfo[1]-this.currentSelectedLabel.tileInfo[1])&&this.clearCollisionCache(e[n]);this.currentSelectedLabel.tempRank=null,this.currentSelectedLabel=null,t=!0}e=this.collisionTest(e),this.updateLabels(e);var a=this.fixDataFormat(e);ax.setOverlayData(a[0],2),ax.setOverlayData(a[1],3),ax.setOverlayData([],4),this.map.dispatchEvent(new aw("onrefresh")),t&&(this.curSpotAdded=!1,this._refreshSpotData())},process:function(t,e){if(!t)return void(e&&e(null));var i=new Image;i.onload=function(){e&&e(this),this.onload=null},i.src=t},collisionTest:function(t,e,i){if(!t)return[];var n=this.map,a=n.getHeading();a=this.calcLoopHeading(a);var o=n.height,r=this.allLabels;r.length=0,t.sort(function(t,e){var i=t.tileInfo,n=e.tileInfo;return i[0]*i[1]<n[0]*n[1]?-1:1});var s,l=(t.labelZoom,n.getTilt());s=i?i:this.getZoomStep();for(var h=0,c=t.length;c>h;h++){var d=t[h],u=d.tileInfo,p=u[2],f=u[3]/Math.pow(2,18-p);if(a||l||!d.unnecessaryCollisionTest||!d.unnecessaryCollisionTest[i]){for(var m=d.fixedLabel||[],g=0,_=m.length;_>g;g++){var v=m[g];v.zoom=p,-1===e&&v.isDel||(this.calcCollisionBounds(v,s,f,o),r.push(v))}for(var y=d.indoorLabel,g=0,_=y.length;_>g;g++){var v=y[g];v.zoom=p,-1===e&&v.isDel||(this.calcCollisionBounds(v,s,f,o),r.push(v))}for(var b=d.lineLabel||[],g=0,_=b.length;_>g;g++){var v=b[g];if(-1!==e||!v.isDel){var w=v.pt,x=n.pointToPixel(w,{zoom:s,useRound:this._useRound}),M=x.x+f,T=o-x.y,L=v.bds,C=L[0],P=L[1],S=L[2],A=L[3],D=C,I=P,k=S,E=A;a>=0&&45>a||a>=315&&360>a?(D=C,I=P,k=S,E=A):a>=45&&135>a?(D=P,I=-S,k=A,E=-C):a>=135&&225>a?(D=-S,I=-A,k=-C,E=-P):a>=225&&315>a&&(D=-A,I=C,k=-P,E=S),v._tempBds=[M+D,T+I,M+k,T+E],r.push(v)}}}}var z=this._strategyInfo;if(z){for(var B=z.guid,O=z.guidExt,R=!1,h=0,c=r.length;c>h;h++){var N=r[h];delete N.tempRank,this.layer.isClickableLabel(N)&&(1!==O||N.guidExt)&&B===N.guid&&z.tilePosStr===N.tilePosStr&&(N.tempRank=this.RANK5,R=!0)}if(!R&&this.currentSelectedLabel){this.currentSelectedLabel.tempRank=this.RANK5;var u=this.currentSelectedLabel.tileInfo,p=u[2],f=u[3]/Math.pow(2,18-p);this.calcCollisionBounds(this.currentSelectedLabel,s,f,o),r.push(this.currentSelectedLabel)}}else for(var h=0,c=r.length;c>h;h++){var N=r[h];"line"!==N.type&&N.iconPos&&delete N.tempRank}r.sort(function(t,e){var i=t.tempRank?t.tempRank:t.rank,n=e.tempRank?e.tempRank:e.rank;return n-i});var W=0;l>0&&(W=6);for(var Z=2,h=0,c=r.length;c>h;h++){var X=r[h],Y=X._tempBds;for(X.isDel=!1,X._intersectIdx=[],g=h+1;c>g;g++){var H=r[g],U=H._tempBds;Y[2]+W+Z<U[0]-W||Y[0]-W>U[2]+W+Z||Y[3]+W+Z<U[1]-W||Y[1]-W>U[3]+W+Z||X._intersectIdx.push(g)}}for(var h=0,c=r.length;c>h;h++)for(var N=r[h],F=N._intersectIdx,g=0,_=F.length;_>g;g++)r[F[g]].isDel=!0;return t},calcCollisionBounds:function(t,e,i,n){var a=t.pt,o=this.map,r=o.pointToPixel(a,{zoom:e,useRound:this._useRound}),s=r.x+i,l=n-r.y,h=t.bds;t._tempBds=[s+h[0],l+h[1],s+h[2],l+h[3]]},getZoomStep:function(){var t=this.map.getZoom(),e=Math.floor(t),i=t-e>=.5?e+.5:e;return i},clearCollisionCache:function(t){t&&(t.cacheState=null,t.unnecessaryCollisionTest=null)},getCachedLabels:function(t){t=t||[];for(var e=this.getZoomStep(),i=!0,n=0;n<t.length;n++){var a=t[n];if(!a.cacheState||!a.cacheState[e]){i=!1;break}}return i||this.cacheLabelResult(t),t},cacheLabelResult:function(t){var e,i,n=this.getZoomStep(),a={};t=this.collisionTest(t,void 0,n);for(var o=0;o<t.length;o++){e=t[o],i=e.tileInfo;var r=i[0]+","+i[1];a[r]=1}for(var s={},o=0;o<t.length;o++){e=t[o],e.cacheState||(e.cacheState={}),i=e.tileInfo;var l=i[0],h=i[1];if(r=l+","+h,"stable"!==e.cacheState[n]){for(var c=0;c<e.fixedLabel.length;c++){var d=e.fixedLabel[c];d.cachedIsDel||(d.cachedIsDel={}),d.cachedIsDel[n]=d.isDel}for(var c=0;c<e.indoorLabel.length;c++){var d=e.indoorLabel[c];d.cachedIsDel||(d.cachedIsDel={}),d.cachedIsDel[n]=d.isDel}for(var c=0;c<e.lineLabel.length;c++){var d=e.lineLabel[c];d.cachedIsDel||(d.cachedIsDel={}),d.cachedIsDel[n]=d.isDel}a[l-1+","+(h-1)]&&a[l-1+","+h]&&a[l-1+","+(h+1)]&&a[l+","+(h-1)]&&a[l+","+(h+1)]&&a[l+1+","+(h-1)]&&a[l+1+","+h]&&a[l+1+","+(h+1)]?(e.cacheState[n]="stable",s[r]=1):e.cacheState[n]||(e.cacheState[n]="unstable")}else s[r]=1}for(var o=0;o<t.length;o++){var e=t[o];i=e.tileInfo;var r=i[0]+","+i[1],l=+i[0],h=+i[1];s[l-1+","+(h-1)]&&s[l-1+","+h]&&s[l-1+","+(h+1)]&&s[l+","+(h-1)]&&s[l+","+(h+1)]&&s[l+1+","+(h-1)]&&s[l+1+","+h]&&s[l+1+","+(h+1)]&&(e.unnecessaryCollisionTest||(e.unnecessaryCollisionTest={}),e.unnecessaryCollisionTest[n]=1)}},updateLabels:function(t){var e=this.map,i=(e.height,e.getZoomUnits()),n=e.getZoom(),a=(this.textSizeRatio,e.getHeading());a=this.calcLoopHeading(a);for(var o=e.getTilt(),r=this.getZoomStep(),s=0,l=t.length;l>s;s++){var h=t[s],c=h.tileInfo,d=c[3];this.updateFixedLabel(h.fixedLabel,o,a,h,r,n,d),this.updateFixedLabel(h.indoorLabel,o,a,h,r,n,d);for(var u=h.lineLabel||[],p=0,f=u.length;f>p;p++){var m=u[p];if(!o&&!a&&h.cacheState&&h.cacheState[r]&&(m.isDel=m.cachedIsDel[r]),!m.isDel)for(var g=m.pt,_=g.lng+d,v=g.lat,y=m.wordsInfo,b=y.labelAngle,w=0,x=y.length;x>w;w++){var M=y[w],T=M.calcInfo,L=M.offset[0],C=M.offset[1],P=M.size[0],S=M.size[1],A=M.angle;if(!T||a!==T.mapHeading||i!==T.zoomUnits){T={mapHeading:a,zoomUnits:i};var D=0,I=!1;if(a>=90&&180>a?(D=90,(b>=45&&135>=b||b>=225&&315>=b)&&(I=!0)):a>=180&&270>a?(D=180,I=!0):a>=270&&360>=a&&(D=270,(b>=135&&225>=b||b>=315&&360>=b||b>=0&&45>=b)&&(I=!0)),I){var k=y[x-1-w];L=k.offset[0],C=k.offset[1],A=k.angle}var E=_+(L-P/2)*i,z=v+(C+S/2)*i,B=v+(C-S/2)*i,O=_+(L+P/2)*i,R=(E+O)/2,N=(z+B)/2;T.centerX=R,T.centerY=N,T.rotationCenter={lng:T.centerX,lat:T.centerY},T.calcHeading=D,T.angle=A,T.offsetX=L,T.offsetY=C,M.calcInfo=T}M.rtVertex||(M.rtVertex=[]);var W=T.calcHeading+T.angle;M.rtVertex.length=0;var Z=T.rotationCenter,X=Y(_),H=Y(v),U=Y(Z.lng),F=Y(Z.lat);L=T.offsetX,C=T.offsetY,M.rtVertex.push(X[0],H[0],X[1],H[1],L-P/2,C+S/2,U[0],F[0],U[1],F[1],W,M.texcoord[0],M.texcoord[1],X[0],H[0],X[1],H[1],L-P/2,C-S/2,U[0],F[0],U[1],F[1],W,M.texcoord[2],M.texcoord[3],X[0],H[0],X[1],H[1],L+P/2,C+S/2,U[0],F[0],U[1],F[1],W,M.texcoord[4],M.texcoord[5],X[0],H[0],X[1],H[1],L-P/2,C-S/2,U[0],F[0],U[1],F[1],W,M.texcoord[6],M.texcoord[7],X[0],H[0],X[1],H[1],L+P/2,C-S/2,U[0],F[0],U[1],F[1],W,M.texcoord[8],M.texcoord[9],X[0],H[0],X[1],H[1],L+P/2,C+S/2,U[0],F[0],U[1],F[1],W,M.texcoord[10],M.texcoord[11])}}}},updateFixedLabel:function(t,e,i,n,a,o,r){for(var s=0,l=t.length;l>s;s++){var h=t[s];if(!e&&!i&&n.cacheState&&n.cacheState[a]&&(h.isDel=h.cachedIsDel[a]),h.startScale>o&&(h.isDel=!0),!h.isDel){var c=h.pt,d=h.iconPos;if(d&&!d.rtVertex){d.rtVertex=[];var u=d.vertex,p=Y(c.lng),f=Y(c.lat);d.rtVertex=[p[0],f[0],p[1],f[1],u[0],u[1],0,0,0,0,0,d.texcoord[0],d.texcoord[1],p[0],f[0],p[1],f[1],u[2],u[3],0,0,0,0,0,d.texcoord[2],d.texcoord[3],p[0],f[0],p[1],f[1],u[4],u[5],0,0,0,0,0,d.texcoord[4],d.texcoord[5],p[0],f[0],p[1],f[1],u[6],u[7],0,0,0,0,0,d.texcoord[6],d.texcoord[7],p[0],f[0],p[1],f[1],u[8],u[9],0,0,0,0,0,d.texcoord[8],d.texcoord[9],p[0],f[0],p[1],f[1],u[10],u[11],0,0,0,0,0,d.texcoord[10],d.texcoord[11]]}var m=h.textPos;if(m&&!m.rtVertex){m.rtVertex=[];for(var u=m.vertex,g=m.rtVertex,p=Y(c.lng),f=Y(c.lat),_=Y(r),v=0,y=u.length;y>v;v+=12)g.push(p[0],f[0],p[1],f[1],u[v],u[v+1],0,0,_[0],_[1],0,m.texcoord[0],m.texcoord[1]),g.push(p[0],f[0],p[1],f[1],u[v+2],u[v+3],0,0,_[0],_[1],0,m.texcoord[2],m.texcoord[3]),g.push(p[0],f[0],p[1],f[1],u[v+4],u[v+5],0,0,_[0],_[1],0,m.texcoord[4],m.texcoord[5]),g.push(p[0],f[0],p[1],f[1],u[v+6],u[v+7],0,0,_[0],_[1],0,m.texcoord[6],m.texcoord[7]),g.push(p[0],f[0],p[1],f[1],u[v+8],u[v+9],0,0,_[0],_[1],0,m.texcoord[8],m.texcoord[9]),g.push(p[0],f[0],p[1],f[1],u[v+10],u[v+11],0,0,_[0],_[1],0,m.texcoord[10],m.texcoord[11])}}}},calcLoopHeading:function(t){for(;t>=360;)t-=360;for(;0>t;)t+=360;return t},fixDataFormat:function(t){var e=this.fixedLabelData,i=this.lineLabelData,n=this.highlightLabelData;e[0]?e[0].renderData.vertex.length=0:e[0]={textureSource:t.iconSetImg,mergeTexture:!1,renderData:{vertex:[]}},e[0].textureSource||(e[0].textureSource=t.iconSetImg);
var a,o=1,r=0,s=0;if(this.currentSelectedLabel){var l=this.getLabelByUid(this.currentSelectedLabel.guid,this.currentSelectedLabel.tilePosStr);(!l||l.isDel)&&(e[o]=this.currentSelectedLabel.formatedData,o++,n[s]=this.currentSelectedLabel.formatedData,s++)}for(var h=0;h<t.length;h++){var c=t[h],d=c.fixedLabel,u=c.indoorLabel,p=c.lineLabel;for(a=this.fixFixedLabelDataFormat(d,c,e,o,n,s),o=a[0],s=a[1],a=this.fixFixedLabelDataFormat(u,c,e,o,n,s),o=a[0],s=a[1],j=0;j<p.length;j++)if(!p[j].isDel){var f=p[j].wordsInfo;if(f)for(var m=0;m<f.length;m++)if(f[m].rtVertex){var g=f[m].formatedData;g||(g={textureSource:c.textImg,textureHeight:c.textRealHeight,renderData:{vertex:f[m].rtVertex,textureCoord:f[m].texcoord}},f[m].formatedData=g),i[r]=g,r++}}}return e.length=o,i.length=r,n.length=s,[i,e,n]},fixFixedLabelDataFormat:function(t,e,i,n,a,o){for(var r=0;r<t.length;r++)if(!t[r].isDel){var s=t[r].textPos,l=t[r].iconPos,h=null;s&&s.rtVertex&&(t[r].formatedData?(h=t[r].formatedData,h.tempRank=t[r].tempRank):(h={guid:t[r].guid,guidExt:t[r].guidExt,tilePosStr:t[r].tilePosStr,zoom:t[r].zoom,tempRank:t[r].tempRank,textureSource:e.textImg,textureHeight:e.textRealHeight,renderData:{vertex:s.rtVertex,textureCoord:s.texcoord}},t[r].formatedData=h),this.currentSelectedLabel&&h.guid===this.currentSelectedLabel.guid&&h.tilePosStr===this.currentSelectedLabel.tilePosStr&&(a[o]=h,o++)),l&&l.rtVertex&&(h?h.iconRenderData||(h.iconRenderData={vertex:l.rtVertex,textureCoord:l.texcoord}):(h={guid:t[r].guid,guidExt:t[r].guidExt,zoom:t[r].zoom,tempRank:t[r].tempRank,iconRenderData:{vertex:l.rtVertex,textureCoord:l.texcoord}},t[r].formatedData=h)),i[n]=h,n++}return[n,o]},_refreshSpotData:function(){this._spotData=[];for(var t=this.map,e=Math.floor(t.getZoom()),i=ax.getLabelData(),n=(this.textSizeRatio,0),a=i.length;a>n;n++)this._addFixedSpotData(i[n].fixedLabel,e),this._addFixedSpotData(i[n].indoorLabel,e);var o=this.currentSelectedLabel;o&&!this.getTileByLabelUid(o.guid,o.tilePosStr)&&this._spotData.push(this._getSpotDataFromLabel(this.currentSelectedLabel));var r=new aw("onspotsdataready");r.spots=this._spotData,t._spotDataOnCanvas=this._spotData,t.dispatchEvent(r)},_addFixedSpotData:function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(this.layer.isClickableLabel(n)&&!(1===n.guidExt&&n.startScale>e)){var a=this._getSpotDataFromLabel(t[i]);this._spotData.push(a)}}},_getSpotDataFromLabel:function(t){var e=this.map,i=t.bds.slice(0),n=null;t.iconPos&&(n=new d8(t.pt.lng,t.pt.lat));var a=t.name;t.iconPos&&t.iconPos.iconType.indexOf("ditie")>-1&&e.getZoom()>14&&(a="");var o={n:a,pt:new d8(t.pt.lng,t.pt.lat),userdata:{iconPoint:n,uid:t.guid,name:a,type:t.iconPos.iconType,rank:t.rank,zoom:t.zoom,tilePosStr:t.tilePosStr},bd:i,tag:"MAP_SPOT_INFO"};return o}});var by={is64Bit:function(){return/Windows/.test(navigator.userAgent)?/Win64; x64/.test(navigator.userAgent)?!0:/WOW64/.test(navigator.userAgent)?!0:!1:!0},canUseWebAssembly:function(){return window.WebAssembly&&this.is64Bit()}},am={dataProcessPool:[],init:function(t){var e=this;this.map=t,this.arrPendingData=[];var i=navigator.hardwareConcurrency||4;this.arrWorker=[],this.ratio=ar(),this.wordSpaceRatio=this.ratio,this.ratio>1?(this.iconSetInfo=window.iconSetInfo_high,this.textSizeRatio=2):(this.iconSetInfo=window.iconSetInfo,this.textSizeRatio=1);var n=this.iconSetInfo.iconSetSize;this.iconSetWidth=n[0],this.iconSetHeight=n[1];for(var a=0;i>a;a++){var o;o=by.canUseWebAssembly()?"/res/newui/worker_wasm_tkuv2j.js":"/res/newui/worker_asm_wdbpn1.js";var r=new Worker(o);r.onmessage=function(i){this._parsingTileInfo.join(",");if(i.data?this._cbk&&this._cbk(i.data,this._parsingTileKey):this._cbk&&this._cbk(null,this._parsingTileKey),this._isBusy=!1,this._cbk=null,this._parsingTileInfo=null,this._parsingTileKey=null,e.arrPendingData.length>0){var n=e.arrPendingData.shift(),a=n.cbk;e.loadTileData(n.url,n.tileInfo,n.tileKey,a)}var o=new aw("onrefresh");o.source="workermgr",t.fire(o)},this.arrWorker.push(r)}},getIdleWorker:function(){for(var t=0,e=this.arrWorker.length;e>t;t++){var i=this.arrWorker[t];if(!i._isBusy)return i._isBusy=!0,i}return null},releasePendingData:function(t){for(var e=[],i=this.arrPendingData,n=i.length-1;n>=0;n--){var a=i[n],o=a.tileInfo,r="id_"+o[0]+"_"+o[1]+"_"+o[2];t[r]||(i.splice(n,1),e.push(o))}return e},loadTileData:function(t,e,i,n){var a=this.getIdleWorker();if(a){a._cbk=n,a._parsingTileInfo=e,a._parsingTileKey=i;var o={action:"loadTileData",url:t,tileInfo:e,tileKey:i,iconInfo:{wordSpaceRatio:this.wordSpaceRatio,textSizeRatio:this.textSizeRatio,iconSetWidth:this.iconSetWidth,iconSetHeight:this.iconSetHeight}};a.isSendFS||(WorkerMgr.stringifiedFeatureStyle||(WorkerMgr.stringifiedFeatureStyle=JSON.stringify(FeatureStyle)),WorkerMgr.stringifiedIconSetInfo||(WorkerMgr.stringifiedIconSetInfo=JSON.stringify(this.iconSetInfo)),o.featureStyle=WorkerMgr.stringifiedFeatureStyle,o.iconSetInfo=WorkerMgr.stringifiedIconSetInfo,a.isSendFS=!0),a.postMessage(o)}else{var r={url:t,tileInfo:e,tileKey:i,cbk:n};this.arrPendingData.push(r)}},collideTest:function(){}};window.WorkerMgr=am,d5.register(function(t){if("webgl"===t._renderType){var e=t.tileMgr=new cb(t);t.addEventListener("addtilelayer",function(t){e.addWebGLLayer(t.target)}),t.addEventListener("removetilelayer",function(t){e.removeWebGLLayer(t.target)}),t.on("update",function(t){var i=t.changedStatus.onzoom_changed?!0:!1;e.reLoadWebGLLayersData(i)})}}),v.extend(cb.prototype,{addWebGLLayer:function(t){this.tileLayers.push(t),this.reLoadWebGLLayersData(!1)},removeWebGLLayer:function(t){for(var e=0,i=this.tileLayers.length;i>e;e++)if(t===this.tileLayers[e]){this.tileLayers.splice(e,1);break}this.reLoadWebGLLayersData(!1);var n=new aw("onrefresh");n.source="removewebgllayer",this.map.fire(n)},reLoadWebGLLayersData:function(t){if(!this.map.suspendLoad){var e=this;this.syncLoadTimer||(this.syncLoadTimer=setTimeout(function(){d5.FeatureMgr.clearData();var i=e.tileLayers;i.sort(function(t,e){return t.zIndex-e.zIndex>0});for(var n=e.calcTilesInfo(),a=i.length,o=0;a>o;o++){var r=i[o];r.drawIndex=o,r.loadLayerData(n,!0,t)}e.syncLoadTimer=null},30)),this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){for(var i=e.calcTilesInfo(),n=e.tileLayers.length,a=0;n>a;a++){var o=e.tileLayers[a];o.drawIndex=a,o.loadLayerData(i,!1,t)}e.timer=null},this.loadDelay),this.loadDelay=80}},calcTilesInfo:function(){var t=256,e=this.map,i=e.getMapType(),n=a6[i],a=e.getZoom(),o=Math.floor(a);o=dc(o,n.minDataZoom,n.maxDataZoom),t*=Math.pow(2,a-o);var r,s,l,h,c=e.getZoomUnits(),d=c*t,u=e.getCenter();i!==BMAP_SATELLITE_MAP&&(u=cg.calcLoopCenterPoint(u));var p=Math.floor(u.lng/d),f=Math.floor(u.lat/d),m=e.getBounds(),g=0,_=0;if(m=cg.calcLoopMapBounds(m),m.maxX>cg._mc180X){var v=cg.getSpaceDistanceInPixel(a),y=m.maxX-cg._mc180X;g=Math.ceil((y/c+v)/t)}if(m.minX<cg._mcM180X){var v=cg.getSpaceDistanceInPixel(a),b=cg._mcM180X-m.minX;_=Math.ceil((b/c+v)/t)}var w=[Math.floor(m.minX/d)-_,Math.floor(m.minY/d)],x=[Math.floor(m.maxX/d)+g,Math.floor(m.maxY/d)];r=w[0],s=x[0]+1,l=w[1],h=x[1]+1;for(var M=[],T=r;s>T;T++)if(cg.isTileBlank(T,o)!==!0)for(var L=l;h>L;L++){M.push([T,L,o,0]);var C="id_"+T+"_"+L+"_"+o;M[C]=!0}if(i!==BMAP_SATELLITE_MAP&&(M=cg.calcLoopTiles(M,o)),3===o)for(var P=0,S=M.length;S>P;P++){var T=M[P][0],L=M[P][1],A=cg.calcLoopParam(T,o),D=A.T,I=T>=0?T-D:T+D,k="id_"+I+"_"+L+"_"+o;M[k]||(M.push([I,L,o,0]),M[k]=!0)}if(this.map._tilt>0&&this.map.getZoom()>=5)for(var E=e.getZoomUnits(o),P=0;P<M.length;P++){var z=M[P],B=z[0],O=z[1],R=[];R.minX=256*B*E,R.maxX=256*(B+1)*E,R.minY=256*O*E,R.maxY=256*(O+1)*E;var N=new d8(0,0);N.lng=(R.minX+R.maxX)/2,N.lat=(R.minY+R.maxY)/2;var W=e.pointToPixel(N);W.x>0&&W.x<this.map.width&&W.y>0&&W.y<this.map.height||this.ifTileInMapBounds(R,m,B,O)||(M.splice(P,1),P--)}return M.sort(function(t){return function(e,i){return.4*Math.abs(e[0]-t[0])+.6*Math.abs(e[1]-t[1])-(.4*Math.abs(i[0]-t[0])+.6*Math.abs(i[1]-t[1]))}}([p,f])),M.zoom=o,M},ifTileInMapBounds:function(t,e){for(var i=e.pointBottomLeft,n=e.pointTopRight,a=e.pointTopLeft,o=e.pointBottomRight,r=!1,s=new d8(t.minX,t.minY),l=new d8(t.maxX,t.maxY),h=new d8(l.lng,s.lat),c=new d8(s.lng,l.lat),d=[c,l,h,s],u=0,p=d.length;p>u;u++){var f=u+1;f===p&&(f=0);var m=u,g=dH(d[f],d[m],a,i);if(g){r=!0;break}if(g=dH(d[f],d[m],o,n)){r=!0;break}if(g=dH(d[f],d[m],n,a)){r=!0;break}if(g=dH(d[f],d[m],i,o)){r=!0;break}}return r},getTileLayer:function(t){for(var e=0,i=this.tileLayers.length;i>e;e++){var n=this.tileLayers[e];if(n.mapType===t)return n}return null}}),ak.prototype._init=function(t){var e=this;t.on("indoor_status_changed",function(i){var n=i.uid,a=i.floor;if(null===n)n=e.currentUid,e._indoorData[n]&&(a=e._indoorData[n].defaultFloor),e._indoorControl&&e._indoorControl.hide(),e.currentUid=null,e.currentFloor=null,e.enterMethod=null;else if(e._indoorData[n]){var o=e._indoorData[n];a="number"==typeof a?a:o.defaultFloor,e._indoorControl?(e._indoorControl.setInfo(o),e._indoorControl.show()):e._indoorControl=new dI(t,o),e.currentUid=n,e.currentFloor=a}if(!e._indoorData||!e._indoorData[n]||e._indoorData[n].currentFloor===a)return void this.fire(new aw("onrefresh"));var r=new aw("onindoor_data_refresh");r.uid=n,r.floor=a,r.tileKey=e._indoorData[n].tileKey,e._indoorData[n].currentFloor=a,e.currentFloor=a,this.fire(r)}),t.on("spotclick",function(i){var n=null;return i.curAreaSpot&&this.areaSpots[i.curAreaSpot]&&(n=this.areaSpots[i.curAreaSpot].userData.uid),n===e.currentUid?void(i.curAreaSpot&&(e.enterMethod="byClick")):void(null===n?e.currentUid&&"byClick"===e.enterMethod&&(t.showIndoor(null),e.enterMethod=null):(e.enterMethod="byClick",e.currentUid&&t.showIndoor(e.currentUid,e._indoorData[e.currentUid].defaultFloor),t.showIndoor(n,e._indoorData[n].defaultFloor)))}),t.on("moveend",function(){this.getZoom()>=19&&e._checkIndoorByMove()}),t.on("zoomend",function(){this.getZoom()>=19?e._checkIndoorByMove():"byClick"!==e.enterMethod&&null!==e.currentUid&&this.showIndoor(null)})},ak.prototype._checkIndoorByMove=function(){var t=this._map,e=t.getSize(),i={x:e.width/2,y:e.height/2},n=(Math.max(e.width,e.height),[]);for(var a in this._indoorData){var o=this._indoorData[a].center,r=t.pointToPixel(new d5.Point(o[0],o[1])),s=dU(i,r);n.push({uid:a,distance:s})}if(0!==n.length){n.sort(function(t,e){return t.distance-e.distance});for(var l=n[0],h=t.getCenter(),c=!1,d=0;d<this._indoorData[l.uid].contour.length;d++)if(bK([h.lng,h.lat],this._indoorData[l.uid].contour[d])){c=!0;break}c?"byClick"!==this.enterMethod&&(null!==this.currentUid&&this.currentUid!==l.uid&&this._map.showIndoor(this.currentUid,this._indoorData[this.currentUid].defaultFloor),this.currentUid!==l.uid&&this._map.showIndoor(l.uid,this._indoorData[l.uid].defaultFloor),this.enterMethod="byMove"):"byClick"!==this.enterMethod&&this._map.showIndoor(null)}},ak.prototype.setData=function(t){if(null!==t){for(var e in t)if("tileInfo"!==e){var i=t[e].tileKey;if(this._indoorData[e])this._indoorData[e][i]||(this._indoorData[e].tileKeys.push(i),this._indoorData[e][i]=!0);else{this._indoorData[e]=t[e],this._indoorData[e].tileKeys=[t[e].tileKey],this._indoorData[e][i]=!0;for(var n=0;n<this._indoorData[e].contour.length;n++)this._map.addAreaSpot(this._indoorData[e].contour[n],{id:e+n,userData:{uid:e}})}}this._map.getZoom()>=19&&this._checkIndoorByMove()}},ak.prototype.removeData=function(t,e){if(this._indoorData[t]){for(var i=this._indoorData[t],n=0;n<i.tileKeys.length;n++)if(i.tileKeys[n]===e){i.tileKeys.splice(n,1);break}delete i[e],0===i.tileKeys.length&&delete this._indoorData[t]}},ak.prototype.getIndoorData=function(t){return this._indoorData[t]||null},ak.prototype.getData=function(){return this._indoorData},d5.register(function(t){t._indoorMgr=new ak(t)}),dq.inherits(co,"ToolbarItem"),v.extend(dq.prototype,{open:function(){return 1==this._isOpen?!0:this._map._toolInUse?!1:(this._map._toolInUse=!0,this._isOpen=!0,!0)},close:function(){this._isOpen&&(this._map._toolInUse=!1,this._isOpen=!1)},_checkStr:function(t){return t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}}),dQ.inherits(dq,"PolylineTItem"),v.extend(dQ.prototype,{setLineColor:function(t){this._opts.lineColor=t},setLineStroke:function(t){Math.round(t)>0&&(this._opts.lineStroke=Math.round(t))},setOpacity:function(t){t>=0&&1>=t&&(this._opts.opacity=t)},setLineStyle:function(t){("solid"==t||"dashed"==t)&&(this._opts.lineStyle=t)},clear:function(){for(var t=0,e=this._overlays.length;e>t;t++)this._overlays[t]&&this._map.removeOverlay(this._overlays[t]);this._overlays.length=0;for(var t=0,e=this._dots.length;e>t;t++)this._dots[t]&&this._dots[t].parentNode&&this._dots[t].parentNode.removeChild(this._dots[t]);this._dots.length=0},setCursor:function(t){1==this._opts.showResult||(this._opts.cursor=t)},getCursor:function(){if(1==this._opts.showResult)return this._dCursor;var t=this._opts.cursor.match(/^url\((.+)\)(,.*)?/);return null!=t?t[1]:this._opts.cursor},showResult:function(t){this._opts.showResult=!!t},toString:function(){return"DistanceTool"}});var d6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";!function(t){t||(t=window.BMap={}),t.Utils||(t.Utils={});var e=t.Utils;e.format=function(){function t(t,e,i){var n=i[+e];return"function"==typeof n?n(e):n}function e(t,e,i){var n=e,a=[],o=e.split(":");2===o.length&&(n=o[0],a.push(o[1]));var r=typeof i[n];return"function"===r?i[n].apply(void 0,a):"undefined"===r?t:String(i[n])}return function(i,n){var a=n.splice?t:e,o=i.splice?i.join(""):i;return o.replace(/{([a-zA-Z0-9_$:.]+)}/g,function(t,e){return a(t,e,n)})}}();e.ErrorMonitor=function(){},e.canUseWebAssembly=by.canUseWebAssembly()}(d5);var ag=Math.PI/180,x=180/Math.PI,da=null;da=window.performance&&window.performance.now?function(){return performance.now()}:Date.now?function(){return Date.now()}:function(){return(new Date).getTime()},function(t){Array.prototype.map||(Array.prototype.map=function(t,e){var i,n,a;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),r=o.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(e&&(i=e),n=new Array(r),a=0;r>a;){var s,l;a in o&&(s=o[a],l=t.call(i,s,a,o),n[a]=l),a++}return n});var e=t.detect=function(){var t=function(){},e={browser_parsers:[{regex:"^(Opera)/(\\d+)\\.(\\d+) \\(Nintendo Wii",family_replacement:"Wii",manufacturer:"Nintendo"},{regex:"(SeaMonkey|Camino)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)",family_replacement:"Camino",other:!0},{regex:"(Pale[Mm]oon)/(\\d+)\\.(\\d+)\\.?(\\d+)?",family_replacement:"Pale Moon (Firefox Variant)",other:!0},{regex:"(Fennec)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)",family_replacement:"Firefox Mobile"},{regex:"(Fennec)/(\\d+)\\.(\\d+)(pre)",family_replacment:"Firefox Mobile"},{regex:"(Fennec)/(\\d+)\\.(\\d+)",family_replacement:"Firefox Mobile"},{regex:"Mobile.*(Firefox)/(\\d+)\\.(\\d+)",family_replacement:"Firefox Mobile"},{regex:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?)",family_replacement:"Firefox ($1)"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(a\\d+[a-z]*)",family_replacement:"Firefox Alpha"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(b\\d+[a-z]*)",family_replacement:"Firefox Beta"},{regex:"(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(a\\d+[a-z]*)",family_replacement:"Firefox Alpha"},{regex:"(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(b\\d+[a-z]*)",family_replacement:"Firefox Beta"},{regex:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?",family_replacement:"Firefox ($1)"},{regex:"(Firefox).*Tablet browser (\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"MicroB",tablet:!0},{regex:"(MozillaDeveloperPreview)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?"},{regex:"(Flock)/(\\d+)\\.(\\d+)(b\\d+?)",family_replacement:"Flock",other:!0},{regex:"(RockMelt)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Rockmelt",other:!0},{regex:"(Navigator)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Netscape"},{regex:"(Navigator)/(\\d+)\\.(\\d+)([ab]\\d+)",family_replacement:"Netscape"},{regex:"(Netscape6)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Netscape"},{regex:"(MyIBrow)/(\\d+)\\.(\\d+)",family_replacement:"My Internet Browser",other:!0},{regex:"(Opera Tablet).*Version/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera Tablet",tablet:!0},{regex:"(Opera)/.+Opera Mobi.+Version/(\\d+)\\.(\\d+)",family_replacement:"Opera Mobile"},{regex:"Opera Mobi",family_replacement:"Opera Mobile"},{regex:"(Opera Mini)/(\\d+)\\.(\\d+)",family_replacement:"Opera Mini"},{regex:"(Opera Mini)/att/(\\d+)\\.(\\d+)",family_replacement:"Opera Mini"},{regex:"(Opera)/9.80.*Version/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera"},{regex:"(OPR)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera"},{regex:"(webOSBrowser)/(\\d+)\\.(\\d+)",family_replacement:"webOS"},{regex:"(webOS)/(\\d+)\\.(\\d+)",family_replacement:"webOS"},{regex:"(wOSBrowser).+TouchPad/(\\d+)\\.(\\d+)",family_replacement:"webOS TouchPad"},{regex:"(luakit)",family_replacement:"LuaKit",other:!0},{regex:"(Lightning)/(\\d+)\\.(\\d+)([ab]?\\d+[a-z]*)",family_replacement:"Lightning",other:!0},{regex:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?) \\(Swiftfox\\)",family_replacement:"Swiftfox",other:!0},{regex:"(Firefox)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)? \\(Swiftfox\\)",family_replacement:"Swiftfox",other:!0},{regex:"rekonq",family_replacement:"Rekonq",other:!0},{regex:"(conkeror|Conkeror)/(\\d+)\\.(\\d+)\\.?(\\d+)?",family_replacement:"Conkeror",other:!0},{regex:"(konqueror)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Konqueror",other:!0},{regex:"(WeTab)-Browser",family_replacement:"WeTab",other:!0},{regex:"(Comodo_Dragon)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Comodo Dragon",other:!0},{regex:"(YottaaMonitor)",family_replacement:"Yottaa Monitor",other:!0},{regex:"(Kindle)/(\\d+)\\.(\\d+)",family_replacement:"Kindle"},{regex:"(Symphony) (\\d+).(\\d+)",family_replacement:"Symphony",other:!0},{regex:"Minimo",family_replacement:"Minimo",other:!0},{regex:"(Edge)/(\\d+)\\.(\\d+)",family_replacement:"Edge"},{regex:"(CrMo)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Mobile"},{regex:"(CriOS)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Mobile iOS"},{regex:"(Chrome)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+) Mobile",family_replacement:"Chrome Mobile"},{regex:"(chromeframe)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Frame"},{regex:"(UC Browser)(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"UC Browser",other:!0},{regex:"(SLP Browser)/(\\d+)\\.(\\d+)",family_replacement:"Tizen Browser",other:!0},{regex:"(Epiphany)/(\\d+)\\.(\\d+).(\\d+)",family_replacement:"Epiphany",other:!0},{regex:"(SE 2\\.X) MetaSr (\\d+)\\.(\\d+)",family_replacement:"Sogou Explorer",other:!0},{regex:"(Pingdom.com_bot_version_)(\\d+)\\.(\\d+)",family_replacement:"PingdomBot",other:!0},{regex:"(facebookexternalhit)/(\\d+)\\.(\\d+)",family_replacement:"FacebookBot"},{regex:"(Twitterbot)/(\\d+)\\.(\\d+)",family_replacement:"TwitterBot"},{regex:"(AdobeAIR|Chromium|FireWeb|Jasmine|ANTGalio|Midori|Fresco|Lobo|PaleMoon|Maxthon|Lynx|OmniWeb|Dillo|Camino|Demeter|Fluid|Fennec|Shiira|Sunrise|Chrome|Flock|Netscape|Lunascape|WebPilot|NetFront|Netfront|Konqueror|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|Opera Mini|iCab|NetNewsWire|ThunderBrowse|Iron|Iris|UP\\.Browser|Bunjaloo|Google Earth|Raven for Mac)/(\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(Bolt|Jasmine|IceCat|Skyfire|Midori|Maxthon|Lynx|Arora|IBrowse|Dillo|Camino|Shiira|Fennec|Phoenix|Chrome|Flock|Netscape|Lunascape|Epiphany|WebPilot|Opera Mini|Opera|NetFront|Netfront|Konqueror|Googlebot|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|iCab|NetNewsWire|Iron|Space Bison|Stainless|Orca|Dolfin|BOLT|Minimo|Tizen Browser|Polaris)/(\\d+)\\.(\\d+)"},{regex:"(iRider|Crazy Browser|SkipStone|iCab|Lunascape|Sleipnir|Maemo Browser) (\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(iCab|Lunascape|Opera|Android|Jasmine|Polaris|BREW) (\\d+)\\.(\\d+)\\.?(\\d+)?"},{regex:"(Android) Donut",v2_replacement:"2",v1_replacement:"1"},{regex:"(Android) Eclair",v2_replacement:"1",v1_replacement:"2"},{regex:"(Android) Froyo",v2_replacement:"2",v1_replacement:"2"},{regex:"(Android) Gingerbread",v2_replacement:"3",v1_replacement:"2"},{regex:"(Android) Honeycomb",v1_replacement:"3"},{regex:"(IEMobile)[ /](\\d+)\\.(\\d+)",family_replacement:"IE Mobile"},{regex:"(MSIE) (\\d+)\\.(\\d+).*XBLWP7",family_replacement:"IE Large Screen"},{regex:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(pre|[ab]\\d+[a-z]*)?"},{regex:"(Obigo)InternetBrowser",other:!0},{regex:"(Obigo)\\-Browser",other:!0},{regex:"(Obigo|OBIGO)[^\\d]*(\\d+)(?:.(\\d+))?",other:!0},{regex:"(MAXTHON|Maxthon) (\\d+)\\.(\\d+)",family_replacement:"Maxthon",other:!0},{regex:"(Maxthon|MyIE2|Uzbl|Shiira)",v1_replacement:"0",other:!0},{regex:"(PLAYSTATION) (\\d+)",family_replacement:"PlayStation",manufacturer:"Sony"},{regex:"(PlayStation Portable)[^\\d]+(\\d+).(\\d+)",manufacturer:"Sony"},{regex:"(BrowseX) \\((\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(POLARIS)/(\\d+)\\.(\\d+)",family_replacement:"Polaris",other:!0},{regex:"(Embider)/(\\d+)\\.(\\d+)",family_replacement:"Polaris",other:!0},{regex:"(BonEcho)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Bon Echo",other:!0},{regex:"(iPod).+Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPod).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPod)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone).*Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPad).*Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(iPad).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(iPad)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(AvantGo) (\\d+).(\\d+)",other:!0},{regex:"(Avant)",v1_replacement:"1",other:!0},{regex:"^(Nokia)",family_replacement:"Nokia Services (WAP) Browser",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+).(\\d+)\\.(\\d+)",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+).(\\d+)",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+)",manufacturer:"Nokia"},{regex:"(BrowserNG)/(\\d+)\\.(\\d+).(\\d+)",family_replacement:"NokiaBrowser",manufacturer:"Nokia"},{regex:"(Series60)/5\\.0",v2_replacement:"0",v1_replacement:"7",family_replacement:"NokiaBrowser",manufacturer:"Nokia"},{regex:"(Series60)/(\\d+)\\.(\\d+)",family_replacement:"Nokia OSS Browser",manufacturer:"Nokia"},{regex:"(S40OviBrowser)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Nokia Series 40 Ovi Browser",manufacturer:"Nokia"},{regex:"(Nokia)[EN]?(\\d+)",manufacturer:"Nokia"},{regex:"(PlayBook).+RIM Tablet OS (\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Blackberry WebKit",tablet:!0,manufacturer:"Nokia"},{regex:"(Black[bB]erry).+Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Blackberry WebKit",manufacturer:"RIM"},{regex:"(Black[bB]erry)\\s?(\\d+)",family_replacement:"Blackberry",manufacturer:"RIM"},{regex:"(OmniWeb)/v(\\d+)\\.(\\d+)",other:!0},{regex:"(Blazer)/(\\d+)\\.(\\d+)",family_replacement:"Palm Blazer",manufacturer:"Palm"},{regex:"(Pre)/(\\d+)\\.(\\d+)",family_replacement:"Palm Pre",manufacturer:"Palm"},{regex:"(Links) \\((\\d+)\\.(\\d+)",other:!0},{regex:"(QtWeb) Internet Browser/(\\d+)\\.(\\d+)",other:!0},{regex:"(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?",other:!0,tablet:!0},{regex:"(AppleWebKit)/(\\d+)\\.?(\\d+)?\\+ .* Version/\\d+\\.\\d+.\\d+ Safari/",family_replacement:"WebKit Nightly"},{regex:"(Version)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari/",family_replacement:"Safari"},{regex:"(Safari)/\\d+"},{regex:"(OLPC)/Update(\\d+)\\.(\\d+)",other:!0},{regex:"(OLPC)/Update()\\.(\\d+)",v1_replacement:"0",other:!0},{regex:"(SEMC\\-Browser)/(\\d+)\\.(\\d+)",other:!0},{regex:"(Teleca)",family_replacement:"Teleca Browser",other:!0},{regex:"Trident(.*)rv.(\\d+)\\.(\\d+)",family_replacement:"IE"},{regex:"(MSIE) (\\d+)\\.(\\d+)",family_replacement:"IE"}],os_parsers:[{regex:"(Android) (\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"},{regex:"(Android)\\-(\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"},{regex:"(Android) Donut",os_v2_replacement:"2",os_v1_replacement:"1"},{regex:"(Android) Eclair",os_v2_replacement:"1",os_v1_replacement:"2"},{regex:"(Android) Froyo",os_v2_replacement:"2",os_v1_replacement:"2"},{regex:"(Android) Gingerbread",os_v2_replacement:"3",os_v1_replacement:"2"},{regex:"(Android) Honeycomb",os_v1_replacement:"3"},{regex:"(Silk-Accelerated=[a-z]{4,5})",os_replacement:"Android"},{regex:"(Windows Phone 6\\.5)"},{regex:"(Windows (?:NT 5\\.2|NT 5\\.1))",os_replacement:"Windows XP"},{regex:"(XBLWP7)",os_replacement:"Windows Phone OS"},{regex:"(Windows NT 6\\.1)",os_replacement:"Windows 7"},{regex:"(Windows NT 6\\.0)",os_replacement:"Windows Vista"},{regex:"(Windows 98|Windows XP|Windows ME|Windows 95|Windows CE|Windows 7|Windows NT 4\\.0|Windows Vista|Windows 2000)"},{regex:"(Windows NT 6\\.4|Windows NT 10\\.0)",os_replacement:"Windows 10"},{regex:"(Windows NT 6\\.2)",os_replacement:"Windows 8"},{regex:"(Windows Phone 8)",os_replacement:"Windows Phone 8"},{regex:"(Windows NT 5\\.0)",os_replacement:"Windows 2000"},{regex:"(Windows Phone OS) (\\d+)\\.(\\d+)"},{regex:"(Windows ?Mobile)",os_replacement:"Windows Mobile"},{regex:"(WinNT4.0)",os_replacement:"Windows NT 4.0"},{regex:"(Win98)",os_replacement:"Windows 98"},{regex:"(Tizen)/(\\d+)\\.(\\d+)",other:!0},{regex:"(Mac OS X) (\\d+)[_.](\\d+)(?:[_.](\\d+))?",manufacturer:"Apple"},{regex:"(?:PPC|Intel) (Mac OS X)",manufacturer:"Apple"},{regex:"(CPU OS|iPhone OS) (\\d+)_(\\d+)(?:_(\\d+))?",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(iPhone|iPad|iPod); Opera",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(iPad); Opera",tablet:!0,manufacturer:"Apple"},{regex:"(iPhone|iPad|iPod).*Mac OS X.*Version/(\\d+)\\.(\\d+)",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(CrOS) [a-z0-9_]+ (\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"Chrome OS"},{regex:"(Debian)-(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",other:!0},{regex:"(Linux Mint)(?:/(\\d+))?",other:!0},{regex:"(Mandriva)(?: Linux)?/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",other:!0},{regex:"(Symbian[Oo][Ss])/(\\d+)\\.(\\d+)",os_replacement:"Symbian OS"},{regex:"(Symbian/3).+NokiaBrowser/7\\.3",os_replacement:"Symbian^3 Anna"},{regex:"(Symbian/3).+NokiaBrowser/7\\.4",os_replacement:"Symbian^3 Belle"},{regex:"(Symbian/3)",os_replacement:"Symbian^3"},{regex:"(Series 60|SymbOS|S60)",os_replacement:"Symbian OS"},{regex:"(MeeGo)",other:!0},{regex:"Symbian [Oo][Ss]",os_replacement:"Symbian OS"},{regex:"(Black[Bb]erry)[0-9a-z]+/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"BlackBerry OS",manufacturer:"RIM"},{regex:"(Black[Bb]erry).+Version/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"BlackBerry OS",manufacturer:"RIM"},{regex:"(RIM Tablet OS) (\\d+)\\.(\\d+)\\.(\\d+)",os_replacement:"BlackBerry Tablet OS",tablet:!0,manufacturer:"RIM"},{regex:"(Play[Bb]ook)",os_replacement:"BlackBerry Tablet OS",tablet:!0,manufacturer:"RIM"},{regex:"(Black[Bb]erry)",os_replacement:"Blackberry OS",manufacturer:"RIM"},{regex:"(webOS|hpwOS)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"webOS"},{regex:"(SUSE|Fedora|Red Hat|PCLinuxOS)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(SUSE|Fedora|Red Hat|Puppy|PCLinuxOS|CentOS)/(\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(Ubuntu|Kindle|Bada|Lubuntu|BackTrack|Red Hat|Slackware)/(\\d+)\\.(\\d+)"},{regex:"(Windows|OpenBSD|FreeBSD|NetBSD|Ubuntu|Kubuntu|Android|Arch Linux|CentOS|WeTab|Slackware)"},{regex:"(Linux|BSD)",other:!0}],mobile_os_families:["Windows Phone 6.5","Windows CE","Symbian OS"],device_parsers:[{regex:"HTC ([A-Z][a-z0-9]+) Build",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC ([A-Z][a-z0-9 ]+) \\d+\\.\\d+\\.\\d+\\.\\d+",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC_Touch_([A-Za-z0-9]+)",device_replacement:"HTC Touch ($1)",manufacturer:"HTC"},{regex:"USCCHTC(\\d+)",device_replacement:"HTC $1 (US Cellular)",manufacturer:"HTC"},{regex:"Sprint APA(9292)",device_replacement:"HTC $1 (Sprint)",manufacturer:"HTC"},{regex:"HTC ([A-Za-z0-9]+ [A-Z])",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC-([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC_([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC ([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"(ADR[A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"(HTC)",manufacturer:"HTC"},{regex:"SonyEricsson([A-Za-z0-9]+)/",device_replacement:"Ericsson $1",other:!0,manufacturer:"Sony"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; WOWMobile (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\.[\\d]+; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\-update1\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\.[\\d]+; (.+) Build"},{regex:"NokiaN([0-9]+)",device_replacement:"Nokia N$1",manufacturer:"Nokia"},{regex:"Nokia([A-Za-z0-9\\v-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"NOKIA ([A-Za-z0-9\\-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"Nokia ([A-Za-z0-9\\-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"Lumia ([A-Za-z0-9\\-]+)",device_replacement:"Lumia $1",manufacturer:"Nokia"},{regex:"Symbian",device_replacement:"Nokia",manufacturer:"Nokia"},{regex:"(PlayBook).+RIM Tablet OS",device_replacement:"Blackberry Playbook",tablet:!0,manufacturer:"RIM"},{regex:"(Black[Bb]erry [0-9]+);",manufacturer:"RIM"},{regex:"Black[Bb]erry([0-9]+)",device_replacement:"BlackBerry $1",manufacturer:"RIM"},{regex:"(Pre)/(\\d+)\\.(\\d+)",device_replacement:"Palm Pre",manufacturer:"Palm"},{regex:"(Pixi)/(\\d+)\\.(\\d+)",device_replacement:"Palm Pixi",manufacturer:"Palm"},{regex:"(Touchpad)/(\\d+)\\.(\\d+)",device_replacement:"HP Touchpad",manufacturer:"HP"},{regex:"HPiPAQ([A-Za-z0-9]+)/(\\d+).(\\d+)",device_replacement:"HP iPAQ $1",manufacturer:"HP"},{regex:"Palm([A-Za-z0-9]+)",device_replacement:"Palm $1",manufacturer:"Palm"},{regex:"Treo([A-Za-z0-9]+)",device_replacement:"Palm Treo $1",manufacturer:"Palm"},{regex:"webOS.*(P160UNA)/(\\d+).(\\d+)",device_replacement:"HP Veer",manufacturer:"HP"},{regex:"(Kindle Fire)",manufacturer:"Amazon"},{regex:"(Kindle)",manufacturer:"Amazon"},{regex:"(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?",device_replacement:"Kindle Fire",tablet:!0,manufacturer:"Amazon"},{regex:"(iPad) Simulator;",manufacturer:"Apple"},{regex:"(iPad);",manufacturer:"Apple"},{regex:"(iPod);",manufacturer:"Apple"},{regex:"(iPhone) Simulator;",manufacturer:"Apple"},{regex:"(iPhone);",manufacturer:"Apple"},{regex:"Nexus\\ ([A-Za-z0-9\\-]+)",device_replacement:"Nexus $1"},{regex:"acer_([A-Za-z0-9]+)_",device_replacement:"Acer $1",manufacturer:"Acer"},{regex:"acer_([A-Za-z0-9]+)_",device_replacement:"Acer $1",manufacturer:"Acer"},{regex:"Amoi\\-([A-Za-z0-9]+)",device_replacement:"Amoi $1",other:!0,manufacturer:"Amoi"},{regex:"AMOI\\-([A-Za-z0-9]+)",device_replacement:"Amoi $1",other:!0,manufacturer:"Amoi"},{regex:"Asus\\-([A-Za-z0-9]+)",device_replacement:"Asus $1",manufacturer:"Asus"},{regex:"ASUS\\-([A-Za-z0-9]+)",device_replacement:"Asus $1",manufacturer:"Asus"},{regex:"BIRD\\-([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"BIRD\\.([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"BIRD ([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"Dell ([A-Za-z0-9]+)",device_replacement:"Dell $1",manufacturer:"Dell"},{regex:"DoCoMo/2\\.0 ([A-Za-z0-9]+)",device_replacement:"DoCoMo $1",other:!0},{regex:"([A-Za-z0-9]+)\\_W\\;FOMA",device_replacement:"DoCoMo $1",other:!0},{regex:"([A-Za-z0-9]+)\\;FOMA",device_replacement:"DoCoMo $1",other:!0},{regex:"vodafone([A-Za-z0-9]+)",device_replacement:"Huawei Vodafone $1",other:!0},{regex:"i\\-mate ([A-Za-z0-9]+)",device_replacement:"i-mate $1",other:!0},{regex:"Kyocera\\-([A-Za-z0-9]+)",device_replacement:"Kyocera $1",other:!0},{regex:"KWC\\-([A-Za-z0-9]+)",device_replacement:"Kyocera $1",other:!0},{regex:"Lenovo\\-([A-Za-z0-9]+)",device_replacement:"Lenovo $1",manufacturer:"Lenovo"},{regex:"Lenovo\\_([A-Za-z0-9]+)",device_replacement:"Lenovo $1",manufacturer:"Levovo"},{regex:"LG/([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG-LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE-LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE VX([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG ([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE LG\\-AX([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG\\-([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE\\-([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"(KIN)\\.One (\\d+)\\.(\\d+)",device_replacement:"Microsoft $1"},{regex:"(KIN)\\.Two (\\d+)\\.(\\d+)",device_replacement:"Microsoft $1"},{regex:"(Motorola)\\-([A-Za-z0-9]+)",manufacturer:"Motorola"},{regex:"MOTO\\-([A-Za-z0-9]+)",device_replacement:"Motorola $1",manufacturer:"Motorola"},{regex:"MOT\\-([A-Za-z0-9]+)",device_replacement:"Motorola $1",manufacturer:"Motorola"},{regex:"Philips([A-Za-z0-9]+)",device_replacement:"Philips $1",manufacturer:"Philips"},{regex:"Philips ([A-Za-z0-9]+)",device_replacement:"Philips $1",manufacturer:"Philips"},{regex:"SAMSUNG-([A-Za-z0-9\\-]+)",device_replacement:"Samsung $1",manufacturer:"Samsung"},{regex:"SAMSUNG\\; ([A-Za-z0-9\\-]+)",device_replacement:"Samsung $1",manufacturer:"Samsung"},{regex:"Softbank/1\\.0/([A-Za-z0-9]+)",device_replacement:"Softbank $1",other:!0},{regex:"Softbank/2\\.0/([A-Za-z0-9]+)",device_replacement:"Softbank $1",other:!0},{regex:"(hiptop|avantgo|plucker|xiino|blazer|elaine|up.browser|up.link|mmp|smartphone|midp|wap|vodafone|o2|pocket|mobile|pda)",device_replacement:"Generic Smartphone"},{regex:"^(1207|3gso|4thp|501i|502i|503i|504i|505i|506i|6310|6590|770s|802s|a wa|acer|acs\\-|airn|alav|asus|attw|au\\-m|aur |aus |abac|acoo|aiko|alco|alca|amoi|anex|anny|anyw|aptu|arch|argo|bell|bird|bw\\-n|bw\\-u|beck|benq|bilb|blac|c55/|cdm\\-|chtm|capi|comp|cond|craw|dall|dbte|dc\\-s|dica|ds\\-d|ds12|dait|devi|dmob|doco|dopo|el49|erk0|esl8|ez40|ez60|ez70|ezos|ezze|elai|emul|eric|ezwa|fake|fly\\-|fly\\_|g\\-mo|g1 u|g560|gf\\-5|grun|gene|go.w|good|grad|hcit|hd\\-m|hd\\-p|hd\\-t|hei\\-|hp i|hpip|hs\\-c|htc |htc\\-|htca|htcg)",device_replacement:"Generic Feature Phone"},{regex:"^(htcp|htcs|htct|htc\\_|haie|hita|huaw|hutc|i\\-20|i\\-go|i\\-ma|i230|iac|iac\\-|iac/|ig01|im1k|inno|iris|jata|java|kddi|kgt|kgt/|kpt |kwc\\-|klon|lexi|lg g|lg\\-a|lg\\-b|lg\\-c|lg\\-d|lg\\-f|lg\\-g|lg\\-k|lg\\-l|lg\\-m|lg\\-o|lg\\-p|lg\\-s|lg\\-t|lg\\-u|lg\\-w|lg/k|lg/l|lg/u|lg50|lg54|lge\\-|lge/|lynx|leno|m1\\-w|m3ga|m50/|maui|mc01|mc21|mcca|medi|meri|mio8|mioa|mo01|mo02|mode|modo|mot |mot\\-|mt50|mtp1|mtv |mate|maxo|merc|mits|mobi|motv|mozz|n100|n101|n102|n202|n203|n300|n302|n500|n502|n505|n700|n701|n710|nec\\-|nem\\-|newg|neon)",device_replacement:"Generic Feature Phone"},{regex:"^(netf|noki|nzph|o2 x|o2\\-x|opwv|owg1|opti|oran|ot\\-s|p800|pand|pg\\-1|pg\\-2|pg\\-3|pg\\-6|pg\\-8|pg\\-c|pg13|phil|pn\\-2|pt\\-g|palm|pana|pire|pock|pose|psio|qa\\-a|qc\\-2|qc\\-3|qc\\-5|qc\\-7|qc07|qc12|qc21|qc32|qc60|qci\\-|qwap|qtek|r380|r600|raks|rim9|rove|s55/|sage|sams|sc01|sch\\-|scp\\-|sdk/|se47|sec\\-|sec0|sec1|semc|sgh\\-|shar|sie\\-|sk\\-0|sl45|slid|smb3|smt5|sp01|sph\\-|spv |spv\\-|sy01|samm|sany|sava|scoo|send|siem|smar|smit|soft|sony|t\\-mo|t218|t250|t600|t610|t618|tcl\\-|tdg\\-|telm|tim\\-|ts70|tsm\\-|tsm3|tsm5|tx\\-9|tagt)",device_replacement:"Generic Feature Phone"},{regex:"^(talk|teli|topl|tosh|up.b|upg1|utst|v400|v750|veri|vk\\-v|vk40|vk50|vk52|vk53|vm40|vx98|virg|vite|voda|vulc|w3c |w3c\\-|wapj|wapp|wapu|wapm|wig |wapi|wapr|wapv|wapy|wapa|waps|wapt|winc|winw|wonu|x700|xda2|xdag|yas\\-|your|zte\\-|zeto|aste|audi|avan|blaz|brew|brvw|bumb|ccwa|cell|cldc|cmd\\-|dang|eml2|fetc|hipt|http|ibro|idea|ikom|ipaq|jbro|jemu|jigs|keji|kyoc|kyok|libw|m\\-cr|midp|mmef|moto|mwbp|mywa|newt|nok6|o2im|pant|pdxg|play|pluc|port|prox|rozo|sama|seri|smal|symb|treo|upsi|vx52|vx53|vx60|vx61|vx70|vx80|vx81|vx83|vx85|wap\\-|webc|whit|wmlb|xda\\-|xda\\_)",device_replacement:"Generic Feature Phone"},{regex:"(bot|borg|google(^tv)|yahoo|slurp|msnbot|msrbot|openbot|archiver|netresearch|lycos|scooter|altavista|teoma|gigabot|baiduspider|blitzbot|oegp|charlotte|furlbot|http%20client|polybot|htdig|ichiro|mogimogi|larbin|pompos|scrubby|searchsight|seekbot|semanticdiscovery|silk|snappy|speedy|spider|voila|vortex|voyager|zao|zeal|fast\\-webcrawler|converacrawler|dataparksearch|findlinks)",device_replacement:"Spider"}],mobile_browser_families:["Firefox Mobile","Opera Mobile","Opera Mini","Mobile Safari","webOS","IE Mobile","Playstation Portable","Nokia","Blackberry","Palm","Silk","Android","Maemo","Obigo","Netfront","AvantGo","Teleca","SEMC-Browser","Bolt","Iris","UP.Browser","Symphony","Minimo","Bunjaloo","Jasmine","Dolfin","Polaris","BREW","Chrome Mobile","Chrome Mobile iOS","UC Browser","Tizen Browser"]};
t.parsers=["device_parsers","browser_parsers","os_parsers","mobile_os_families","mobile_browser_families"],t.types=["browser","os","device"],t.regexes=e||function(){var e={};return t.parsers.map(function(t){e[t]=[]}),e}(),t.families=function(){var e={};return t.types.map(function(t){e[t]=[]}),e}();var i=Array.prototype,n=(Object.prototype,Function.prototype,i.forEach),a=(i.indexOf,function(t,e){for(var i={},n=0;n<e.length&&!(i=e[n](t));n++);return i}),o=function(t,e){r(t,function(t){r(e,function(e){delete t[e]})})},r=forEach=function(t,e,i){if(null!=t)if(n&&t.forEach===n)t.forEach(e,i);else if(t.length===+t.length)for(var a=0,o=t.length;o>a;a++)e.call(i,t[a],a,t);else for(var r in t)_.has(t,r)&&e.call(i,t[r],r,t)},s=function(t){return!(!t||"undefined"==typeof t||null==t)},l=function(t){var e="";return t=t||{},s(t)&&s(t.major)&&(e+=t.major,s(t.minor)&&(e+="."+t.minor,s(t.patch)&&(e+="."+t.patch))),e},h=function(t){t=t||{};var e=l(t);return e&&(e=" "+e),t&&s(t.family)?t.family+e:""};return t.parse=function(e){var i=function(e){return t.regexes[e+"_parsers"].map(function(t){function i(e){var i=e.match(n);if(!i)return null;var r={};return r.family=(a?a.replace("$1",i[1]):i[1])||"other",r.major=parseInt(o?o:i[2])||null,r.minor=i[3]?parseInt(i[3]):null,r.patch=i[4]?parseInt(i[4]):null,r.tablet=t.tablet,r.man=t.manufacturer||null,r}var n=new RegExp(t.regex),a=t[("browser"===e?"family":e)+"_replacement"],o=t.major_version_replacement;return i})},n=function(){},r=i("browser"),c=i("os"),d=i("device"),u=new n;u.source=e,u.browser=a(e,r),s(u.browser)?(u.browser.name=h(u.browser),u.browser.version=l(u.browser)):u.browser={},u.os=a(e,c),s(u.os)?(u.os.name=h(u.os),u.os.version=l(u.os)):u.os={},u.device=a(e,d),s(u.device)?(u.device.name=h(u.device),u.device.version=l(u.device)):u.device={tablet:!1,family:"Other"};{var p={};t.regexes.mobile_browser_families.map(function(t){p[t]=!0}),t.regexes.mobile_os_families.map(function(t){p[t]=!0})}return u.device.type="Spider"===u.browser.family?"Spider":u.browser.tablet||u.os.tablet||u.device.tablet?"Tablet":p.hasOwnProperty(u.browser.family)?"Mobile":"Desktop",u.device.manufacturer=u.browser.man||u.os.man||u.device.man||null,o([u.browser,u.os,u.device],["tablet","man"]),u},t}();"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.detect=e):t.detect=e,"function"==typeof define&&define.amd&&define(function(){return e})}(window),bk.prototype={calcLoopParam:function(t,e){for(var i=0,n=3,a=6,o=a*Math.pow(2,e-n),r=o/2-1,s=-o/2;t>r;)t-=o,i-=this._loopOffset;for(;s>t;)t+=o,i+=this._loopOffset;var l=i;return i=Math.round(i/Math.pow(2,18-e)),{offsetX:i,geoOffsetX:l,col:t,T:o,maxCol:r,minCol:s}},calcLoopCenterPoint:function(t){for(var e=t.lng;e>this._mc180X;)e-=this._mcTSpan;for(;e<this._mcM180X;)e+=this._mcTSpan;return t.lng=e,t},calcLoopMapBounds:function(t,e){for(var i=e||t.getCenter(),n=t.minX,a=t.maxX;i.lng>this._mc180X;)i.lng-=this._mcTSpan,n-=this._mcTSpan,a-=this._mcTSpan;for(;i.lng<this._mcM180X;)i.lng+=this._mcTSpan,n+=this._mcTSpan,a+=this._mcTSpan;return t.minX=n,t.maxX=a,t.pointBottomLeft&&(t.pointBottomLeft=this.calcLoopCenterPoint(t.pointBottomLeft),t.pointTopLeft=this.calcLoopCenterPoint(t.pointTopLeft),t.pointTopRight=this.calcLoopCenterPoint(t.pointTopRight),t.pointBottomRight=this.calcLoopCenterPoint(t.pointBottomRight)),t},calcLoopTiles:function(t,e){for(var i=256*Math.pow(2,18-e),n=Math.floor(this._mc180X/i),a=Math.floor(this._mcM180X/i),o=Math.floor(this._loopOffset/i),r=[],s=0;s<t.length;s++){var l=t[s],h=l[0],c=l[1];if(h>=n){var d=h+o;if(this.isTileBlank(d,e)===!0)continue;var u="id_"+d+"_"+c+"_"+e;t[u]||(t[u]=!0,r.push([d,c,e,0]))}else if(a>=h){var d=h-o;if(this.isTileBlank(d,e)===!0)continue;var u="id_"+d+"_"+c+"_"+e;t[u]||(t[u]=!0,r.push([d,c,e,0]))}}for(var s=0,p=r.length;p>s;s++)t.push(r[s]);return t},isTileBlank:function(t,e){for(var i=Math.pow(2,e-3),n=this._validPixels*i,a=6*i;t>a/2-1;)t-=a;for(;-(a/2)>t;)t+=a;return t>0&&256*t>n?!0:0>t&&Math.abs(256*(t+1))>n?!0:!1},isAddWidth:function(t,e){return t<this._mcM180X||e>this._mc180X},getSpaceDistanceInPixel:function(t){var e=Math.round((this._spaceDistance+this._mSpaceDistance)/Math.pow(2,18-t));return e}};var cg=new bk;window.BMap=d5,d5.Map=bE,d5.MapType=a6,d5.Point=d8,d5.Pixel=cs,d5.Size=ck,d5.Bounds=ca,d5.TileLayer=bs,d5.Copyright=bC,d5.Projection=d5.Project=ct,d5.RenderTypeUtils=av,d5.Overlay=aB,d5.Label=ac,d5.Marker=bS,d5.Icon=d0,d5.Polyline=a,d5.PolylineMultipart=c2,d5.Polygon=ah,d5.InfoWindow=T,d5.SimpleInfoWindow=eg,d5.Circle=du,d5.Control=au,d5.NavigationControl=bT,d5.NavigationControl3D=cK,d5.CopyrightControl=b3,d5.ScaleControl=d2,d5.MapTypeControl=aL,d5.DistanceTool=dQ,d5.ContextMenu=bb,d5.MenuItem=c8,d5.OperationMask=cr,d5.Animation=m,d5.Transitions=bh,d5.Event=aw}();
;!function(e){var n=50,t=25,a={},l=[].slice,r={},o={},c=function(e,l,c,f){function i(){var e=+new Date;do{var a=s.shift();try{c&&c.call(f,a.type,a.data)}catch(l){}}while(s.length&&+new Date-e<n);s.length>0&&setTimeout(arguments.callee,t)}"string"!=typeof l&&(f=c,c=l,l="overall");var u=r[e];u||(u=r[e]={}),u[l]=u[l]||[],u[l].push({func:c,context:f||a});var h=o[e],s=[];if(h){if("overall"===l)for(var g in h)s=s.concat(h[g]);else h[l]&&h[l].length&&(s=h[l]);s.length&&i()}},f=function(e,n,t,l){var r=function(){return a.off(e,n,r),t.apply(l||a,arguments)};c(e,n,r,l)},i=function(e,a,c){if(r[e]&&r[e][a]&&r[e][a].length||r[e]&&r[e].overall){var f=r[e].overall,i=r[e][a]||[];f&&(i=f.concat(i));for(var u=[],h=i.length;h--;)u.push({handler:i[h],args:l.call(arguments,1)});!function(){var e=+new Date;do{var a=u.shift(),l=a.handler;l&&l.func&&l.func.apply(l.context,a.args)}while(u.length&&+new Date-e<n);u.length>0&&setTimeout(arguments.callee,t)}()}else{var s=o[e]||(o[e]={}),i=s[a]||(s[a]=[]);c&&i.push({type:a,data:c})}},u=function(e,n,t,l){if(l=l||a,r[e]&&r[e][n]&&r[e][n].length)for(var o,c=r[e][n],f=c.length;f--;)o=c[f],o.func===t&&o.context===l&&c.splice(f,1)};a.on=c,a.once=f,a.trigger=i,a.off=u,e.listener=e.listener||a}(window);
;!function(e){if(e){var t=document.location.search.match(/testDate\=([^\;]*)/);if(t&&t[1]){var a=t[1].split("-");e=new Date(parseInt(a[0],10),parseInt(a[1]-1,10),parseInt(a[2],10)),e/=1e3}var n={spring:{startTime:{year:2016,month:2,date:6},endTime:{year:2016,month:2,date:14}}},r="";for(var i in n){var m=n[i],s=new Date(m.startTime.year,m.startTime.month-1,m.startTime.date,0,0,0),d=new Date(m.endTime.year,m.endTime.month-1,m.endTime.date,23,59,59);if(s.getTime()<=1e3*e&&d.getTime()>=1e3*e){r=i;break}}var o=document.getElementById("left-panel");o.className=o&&r?"theme-festival-"+i:""}}(window.SYSTIME);
;!function(window){function geoToPoint(e){var t=e.split("|");if("1"===t[0]){var a=t[1].split(","),o=new BMap.Point(parseFloat(a[0]),parseFloat(a[1]));return o}var i=new BMap.Point(12957320,4825100);return i}function getParam(e){if(e.indexOf("?")>-1)var t=e.slice(e.indexOf("?")+1);else{if(!(e.indexOf("#")>-1))return;var t=e.slice(e.indexOf("#")+1)}if(""!=t){for(var a={},o=t.split("&"),i=0;i<o.length;i++){var n=o[i].split("=");if(n[1]){var r=n[1].indexOf("#");n[1]=r>-1?n[1].slice(0,r):n[1],a[n[0]]=n[1]}}return a}}function enableByRule(){var e=navigator.userAgent,t=0,a=0,o=0;if(/macintosh/gi.test(e))return!0;if(/windows nt (\d+\.\d)/gi.test(e)&&(a=parseFloat(RegExp.$1),a>=6.1)){if(/chrome\/(\d+\.\d)/i.test(e)&&(t=parseFloat(RegExp.$1),t>=31))return!0;if(/MSIE (\d+(\.\d+)?)/.test(e)&&(o=parseFloat(RegExp.$1),o>=10))return!0;if(/rv:11.0/gi.test(e))return!0;if(/edge/gi.test(e))return!0}return!1}function sendOpClickStat(e){var t="map";"B_EARTH_MAP"===map.getMapType()&&(t="earth");var a=map.getRenderType();addStat(t+"."+a+"."+e.type,"click",{da_e_name:"pcmapearth"}),e.opMethod&&addStat(t+"."+a+"."+e.type+"."+e.opMethod,"click",{da_e_name:"pcmapearth"})}function onEachTileLoad(e){var t=e.perfStat;if(4===t.length){var a={z_webglmap_tile_net:t[0],z_webglmap_tile_eval:t[1],z_webglmap_tile_parse:t[2],z_webglmap_tile_size:t[3]};alog("cus.fire","time",a)}}function addMapCtrls(e){window.stdMapCtrl=new BMap.NavigationControl({from:"MAP_INDEX",offset:new BMap.Size(1,0),type:BMAP_NAVIGATION_CONTROL_SMALL,anchor:BMAP_ANCHOR_BOTTOM_RIGHT,forceNew:!0,container:document.getElementById("map-operate")}),window.stdMapCtrl._cZIndex="10",e.addControl(window.stdMapCtrl);var t=document.getElementById("map-operate");(e.mapType===BMAP_EARTH_MAP||"webgl"===e._renderType)&&t&&(t.className="show-3d"),"webgl"!==e._renderType&&e.addEventListener("onmaptypechange",function(e){var a=e.mapType;a===BMAP_EARTH_MAP?t&&(t.className="show-3d"):t&&(t.className="")}),window.scaleCtrl=new BMap.ScaleControl({offset:new BMap.Size(112,26),printable:!0}),window.map.addControl(window.scaleCtrl)}var PanoLoading=require("pano:widget/module/PanoLoading/PanoLoading.js");window.isPrint=!1,window.BMAP_TYPE_HYBIRD="B_SATELLITE_STREET",BMap.PolylineTItem=BMap.DistanceTool,PanoLoading.createMask(getParam(location.href),location.href);var mapType=BMAP_NORMAL_MAP,param=getParam(location.href);param&&(param.tn||param.mt)&&(mapType=param.tn||param.mt);var href=location.href,forceRenderType="";enableByRule()||(forceRenderType="dom"),/force=raster/i.test(href)&&(forceRenderType="dom"),/force=vector/i.test(href)&&(forceRenderType="canvas"),/force=webgl/i.test(href)&&(forceRenderType="webgl");var userRenderMode=null;window.localStorage&&window.localStorage.getItem&&(userRenderMode=window.localStorage.getItem("user-render-mode")),forceRenderType=userRenderMode||forceRenderType,BMap.RenderTypeUtils.ifEnableEarth()&&"B_SATELLITE_MAP"===mapType&&(mapType="B_EARTH_MAP");var map=window.map=new BMap.Map("MapHolder",{mapType:mapType,forceRenderType:forceRenderType});map.enableKeyboard(),map.enableScrollWheelZoom(),map.enableInertialDragging(),map.enableContinuousZoom();var COUNTRY_LEVEL=4,point=new BMap.Point(12957320,4825100),level=COUNTRY_LEVEL,code=1,cityType=[4,11,12,15];if(null!=window._OLR&&(eval("var json ="+window._OLR.index),window._OLR.hot_city=json.hot_city,point=geoToPoint(json.content.geo),level=cityType[json.content.city_type],code=json.content.code),IPLOC&&IPLOC.ipLoc&&"success"===IPLOC.ipLoc.status&&IPLOC.ipLoc.content.radius<=2e3)var iplocSuccess=!0;var iplocOpts={};if(iplocSuccess===!0&&IPLOC.rgc&&IPLOC.rgc.result){iplocOpts.cityCode=IPLOC.rgc.result.cityCode,iplocOpts.cityName=IPLOC.rgc.result.addressComponent.city;var key="MCITY";if(new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(key)===!0){var reg=new RegExp("(^| )"+key+"=([^;]*)(;|$)"),regValue=reg.exec(document.cookie);if(regValue)var myCity=regValue[2]||null;"string"==typeof myCity&&(myCity=decodeURIComponent(myCity))}parseFloat(myCity)>0&&1!==code?(iplocOpts.cityCode===code&&(iplocOpts.status="show",iplocOpts.needCurReq=!1),iplocOpts.cityCode!==code&&(iplocOpts.status="showChageCity",iplocOpts.needCurReq=!1)):(iplocOpts.status="show",iplocOpts.needCurReq=!0)}if("show"===iplocOpts.status&&IPLOC&&IPLOC.ipLoc&&IPLOC.ipLoc.content&&IPLOC.ipLoc.content.point){var ipLocPt=IPLOC.ipLoc.content.point;"number"==typeof ipLocPt.x&&"number"==typeof ipLocPt.y&&(point=new BMap.Point(ipLocPt.x,ipLocPt.y),level=15,iplocOpts.preventZoomMap=!0)}if(param&&param.c){var p=param.c.split(",");if(2==p.length){var lng=parseFloat(p[0]),lat=parseFloat(p[1]);"number"==typeof lng&&"number"==typeof lat&&(point=new BMap.Point(lng,lat))}param.l&&"number"==typeof parseInt(param.l)&&(level=parseInt(param.l))}window.corePerfMonitor&&map.addEventListener("tilesloaded",window.corePerfMonitor.onTilesLoaded),map.addEventListener("earthload",function(e){for(var t=e.earth,a=["rotatecwclick","rotateccwclick","compassclick","zoominclick","zoomoutclick","tiltmsdown","ontiltclick"],o=0;o<a.length;o++)t.on(a[o],sendOpClickStat);t.on("fpsdata_ready",function(e){var t={};t.z_fps=e.fps,t.z_fps_higher=e.fpsH,alog("cus.fire","time",t)}),t.on("earthtilesloaded",function(e){var a={};a.z_earth_init_time=e.initTime,a.z_earth_tilesload_time=e.loadTime,alog("cus.fire","time",a),t.off("earthtilesloaded",arguments.callee)}),t.on("layertilesload",function(e){var a={};a.z_earth_layerload_time=e.layersLoadTime,alog("cus.fire","time",a),t.off("layertilesload",arguments.callee)}),t.on("earthlabelloaded",function(e){var a={};a.z_earth_labelload_time=e.loadTime,alog("cus.fire","time",a),t.off("earthlabelloaded",arguments.callee)}),t.on("webglcontextlost",function(){alog("cus.fire","count","z_webgl_context_lost")}),t.on("webglcontextrestored",function(){alog("cus.fire","count","z_webgl_context_restored")}),t.on("onsatelayerloaderror",function(){alog("cus.fire","count","z_satelayer_load_error")}),t.on("onstreetlayerloaderror",function(){alog("cus.fire","count","z_streetlayer_load_error")})});var fstStartTime=(new Date).getTime();if(map.isCanvasMap()){if(map.on("canvasmaploaded",function(){var e=(new Date).getTime(),t={z_canvasmaptime:e-fstStartTime};alog("cus.fire","time",t),map.removeEventListener("canvasmaploaded",arguments.callee)}),map.on("tilesloaded",function(){var e=(new Date).getTime(),t={z_bkgrdtime:e-fstStartTime};alog("cus.fire","time",t),map.removeEventListener("tilesloaded",arguments.callee)}),map.on("loaddatatimeout",function(e){var t={};if(t.z_timeoutVSnotimeout=1===e.noTimeoutCount?"notimeout":"timeout",alog("cus.fire","dis",t),1===e.timeoutCount){var a={z_timeoutloaded:e.timeoutLoaded,z_timeoutnoloaded:e.timeoutNoLoaded};alog("cus.fire","time",a)}}),screen&&screen.width&&screen.height){var resRet={"1366-768":1,"1920-1080":1,"1440-900":1,"1024-768":1,"1600-900":1},scrWidth=screen.width,scrHeight=screen.height,curRes=scrWidth+"-"+scrHeight;map.on("canvasmaploaded",function(e){if(e.isAllLoadedDrawing){resRet[curRes]||(curRes="other");var t="z_drawtime",a="z_drawtime",o=e.drawTime;35>o?(t+="0-35_"+curRes,a+="0-35"):70>o?(t+="35-70_"+curRes,a+="35-70"):(t+="70-100000_"+curRes,a+="70-100000"),alog("cus.fire","count",t);var i={z_detaildrawinfo:t,z_generaldrawinfo:a};alog("cus.fire","dis",i),alog("cus.fire","time",{z_totaldrawtime:o})}})}map.on("mapwhitescreen",function(){alog("cus.fire","count","z_mapwhitescreen")}),alog("cus.fire","count","z_vectormapcount")}else if("webgl"===map.getRenderType()){map.on("firsttilesloaded",function(){var e=(new Date).getTime();this._firstLoadTime=e-fstStartTime}),BMap.Utils.canUseWebAssembly?alog("cus.fire","count","z_webgl_wasm"):alog("cus.fire","count","z_webgl_asm"),map.on("tileloaded",onEachTileLoad),setTimeout(function(){map.off("tileloaded",onEachTileLoad)},5e3),map.on("tilesloaded",function(){var e=(new Date).getTime(),t={z_webglmapfirsttime:this._firstLoadTime,z_webglmaptime:e-fstStartTime};alog("cus.fire","time",t),map.removeEventListener("tilesloaded",arguments.callee)}),map.on("fpsdata_ready",function(e){var t={};t.z_webglmap_fps=e.fps,t.z_webglmap_fps_higher=e.fpsH,alog("cus.fire","time",t)}),map.on("tileloaderror",function(e){var t=e.error||"unknown";alog("cus.fire","count","z_"+t)});for(var eventNames=["rotatecwclick","rotateccwclick","compassclick","zoominclick","zoomoutclick","tiltmsdown","ontiltclick"],i=0;i<eventNames.length;i++)map.on(eventNames[i],sendOpClickStat)}else map.on("tilesloaded",function(){var e=(new Date).getTime(),t={z_tilemaptime:e-fstStartTime};alog("cus.fire","time",t),map.removeEventListener("tilesloaded",arguments.callee)}),alog("cus.fire","count","z_rastermapcount");map.centerAndZoom(point,level),addMapCtrls(map),map.on("getmodules_fail",function(){alog("cus.fire","count","z_getmodulesfail")}),map.on("mod_timeout",function(e){e&&10===e.timeout?alog("cus.fire","count","z_modtimeout_10"):e&&5===e.timeout&&alog("cus.fire","count","z_modtimeout")}),require.async(["common:widget/ui/tangram/tangram.js","common:widget/ui/stat/statCode.js","common:widget/ui/init/init.js","common:widget/ui/stat/CodeStat.js","common:widget/com/IpLocation/IpLocation.js"],function(e,t,a,o,i){var n=decodeURI(document.URL).match(/testIp\=([^\&]*)/);n&&n[1]&&(iplocOpts.ip=n[1]),i.init(map,window.IPLOC,iplocOpts),a.init()}),"function"==typeof BMap.Marker._injectMethond&&BMap.Marker._injectMethond({addStat:function(){addStat("map.overlay.marker","click")}}),"function"==typeof BMap.Marker._injectMethond&&BMap.Marker._injectMethond({addStat:function(){addStat("map.overlay.marker","click")}})}(window);
;!function(t){function e(t){this.opts=t||{}}var n={};e.prototype.render=function(){try{throw new Error("Widget must implement function render")}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"common:static/js/util/widget.js",ln:16})}},e.prototype.renderComplete=function(){try{}catch(t){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"common:static/js/util/widget.js",ln:19})}},e.prototype.setPageData=function(t){t=t||{},this._data_=t},n.extend=function(t){var n=function(t){t=t||{},e.call(this,t)};return T.inherits(n,e,"Child"),T.extend(n.prototype,t),n},t.Widget=n}(window);