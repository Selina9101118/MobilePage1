define("common:widget/ui/searchInfoWindow/searchSimpleInfoWindow.js",function(require,exports,module){function createInfoWndSugg(e,i){require.async("common:widget/ui/ui3MapSuggest/ui3MapSuggest.js",function(n){n.initialize({input:e,isAutoWidth:!1,adjustTop:3,hasHistory:!0,showMyPlace:!0,from:"infowindow",width:204,onSelect:function(e){searchSimpleInfoWindow.roundSearchByValue(e,i.uid,null,i.cityCode,null,i.x,i.y,i.isFromMPC,null)}})})}var comMgr=require("common:widget/com/componentManager.js"),util=require("common:widget/ui/util/util.js"),constant=require("common:widget/ui/constant/Constant.js"),mapUtil=require("common:widget/ui/mapUtil/mapUtil.js"),indexUtil=require("common:widget/ui/indexUtil/IndexUtil.js"),config=require("common:widget/ui/config/config.js"),modelConfig=config.modelConfig,mapConfig=config.mapConfig,urlConfig=config.urlConfig,searchParam=require("common:widget/search/SearchUrlParam.js"),filterStatus=require("common:widget/ui/FilterStatus/FilterStatus.js"),tpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div id="poi_info_window" class="poi_info_window">'),isScenic3dPoi?_template_fun_array.push('<div class="scenic3d-poi-wrapper" data-uid="',"undefined"==typeof uid?"":baidu.template._encodeHTML(uid),'"><div class="',"undefined"==typeof poi?"":baidu.template._encodeHTML(poi),'"><div class="icon"></div><div class="title">3D实景</div><div class="poi-name">',"undefined"==typeof name?"":baidu.template._encodeHTML(name),"</div></div></div>"):(_template_fun_array.push('    <div class="left name_wrap" title="',"undefined"==typeof name?"":baidu.template._encodeHTML(name),'">         '),"undefined"!=typeof pcRealtimePrice&&_template_fun_array.push('        <span class="price_wrap"><span class="price">￥',"undefined"==typeof pcRealtimePrice?"":baidu.template._encodeHTML(pcRealtimePrice),"</span></span>        "),_template_fun_array.push('        <span class="name">',"undefined"==typeof name?"":baidu.template._encodeHTML(name),"</span>    </div>")),_template_fun_array.push("</div>    "),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],style=".poi_info_window{padding:4px 0}.poi_info_window .left{padding-left:10px;padding-right:10px;height:40px;line-height:40px;display:table;table-layout:fixed;width:140px;text-align:center}.poi_info_window .name_wrap .price_wrap{float:right;font-size:14px;font-weight:700}.poi_info_window .name_wrap .name{vertical-align:middle;font-size:14px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block}.poi_info_window .name_wrap .price_wrap{padding:0 5px 0 1px}.poi_info_window .name_wrap .price{color:red}.poi_info_window .right{float:right;cursor:pointer;box-sizing:border-box;border-left:1px solid #ccc;width:48px;height:40px;vertical-align:middle}.poi_info_window .right .range_search{display:inline-block;margin:10px 16px;width:14px;height:19px;background:url(//webmap0.bdimg.com/wolfman/static/common/images/markers_new2_4ab0bc5.png) no-repeat;background-position:-124px -233px}@media only screen and (-webkit-min-device-pixel-ratio:2),(-webkit-min-device-pixel-ratio:2),(min-resolution:2dppx),(min-resolution:192dpi){.poi_info_window .right .range_search{background:url(//webmap1.bdimg.com/wolfman/static/common/images/markers_new2x_c1001de.png) no-repeat;background-position:-124px -233px;background-size:300px 300px}}.poi_info_window .range_selected{border:0}.poi_info_window .search_form{display:none;border:1px solid #ccc;margin:2px 10px 5px;line-height:26px;height:26px;color:#333;position:relative;border-radius:2px 0 0 2px;width:204px}.poi_info_window .search_form input{width:175px;height:26px;padding-left:5px;margin-right:24px;display:block;font-size:16px;border:0}.poi_info_window .search_form button{float:right;margin:6px 5px 7px 0;display:block;background:url(//webmap1.bdimg.com/wolfman/static/common/images/retina/new-route-retian_39406a2.png) no-repeat -754px -228px;width:14px;height:14px;border:0;padding:0;cursor:pointer}.poi_info_window .scenic3d-poi-wrapper{height:68px;position:relative;cursor:pointer}.poi_info_window .scenic3d-poi-wrapper .qinghuiyuan{padding-left:113px}.poi_info_window .scenic3d-poi-wrapper .qinghuiyuan .icon{background-position:0 0}.poi_info_window .scenic3d-poi-wrapper .huaguiyuan{padding-left:118px}.poi_info_window .scenic3d-poi-wrapper .huaguiyuan .icon{top:2px;left:20px;height:66px;width:78px;background-position:0 -67px}.poi_info_window .scenic3d-poi-wrapper .shijilian{padding-left:113px}.poi_info_window .scenic3d-poi-wrapper .shijilian .icon{top:3px;height:62px;background-position:0 -132px}.poi_info_window .scenic3d-poi-wrapper .shijilian .poi-name{padding-left:0;margin-left:-6px}.poi_info_window .scenic3d-poi-wrapper .icon{position:absolute;top:0;left:20px;height:67px;width:71px;background-image:url(//webmap0.bdimg.com/wolfman/static/common/images/scenic3d/poi-bubble-1x_9017b13.png);background-repeat:no-repeat;background-size:78px auto}@media only screen and (-webkit-min-device-pixel-ratio:2),(-webkit-min-device-pixel-ratio:2),(min-resolution:2dppx),(min-resolution:192dpi){.poi_info_window .scenic3d-poi-wrapper .icon{background-image:url(//webmap0.bdimg.com/wolfman/static/common/images/scenic3d/poi-bubble-2x_51138e5.png);background-repeat:no-repeat;background-size:78px auto}}.poi_info_window .scenic3d-poi-wrapper .title{padding-top:18px;font-size:16px;color:#2f87ff}.poi_info_window .scenic3d-poi-wrapper .poi-name{padding-left:7px;padding-top:5px;font-size:12px}";require.loadCss({content:style,name:"PoiInfoWindowContent"});var searchSimpleInfoWindow={content:null,opts:null,queryWd:"",$content:null,rangeFlag:!1,rangeSearchCenterMarker:null,addRangeSearchCenterPoi:function(e,i,n,o){this.rangeSearchCenterMarker&&(this.rangeSearchCenterMarker.remove(),this.rangeSearchCenterMarker=null);var a=util.getPoiPoint(e);if(a){var t=new BMap.Icon(constant.A_J_MARKER_IMG_NEW,constant.A_J_MARKER_CENTERBLUE_SIZE,{offset:constant.A_J_MARKER_CENTERBLUE_OFFSET,imageOffset:new BMap.Size(-75,-233),infoWindowOffset:constant.A_J_MARKER_INFOWND_OFFSET,imageSize:new BMap.Size(constant.A_J_MARKER_IMG_NEW_WIDTH,constant.A_J_MARKER_IMG_NEW_HEIGHT),srcSet:constant.A_J_MARKER_IMG_NEW2X_SRCSET}),r=o||25e5,d=new BMap.Marker(a,{icon:t,zIndexFixed:!0,baseZIndex:r,startAnimation:"marker-raise"});return map.addOverlay(d),d._stCode=constant.OVERLAY_STYLE.MKR_RCTR,n||(this.rangeSearchCenterMarker=d),i&&d.setTitle(i),d}},createCommonInfoWindow:function(e,i){if(this.content=e,i=i||{},this.opts=i,!e.name)return null;var n,o=i.uid;e.uid=o;var a=map.temp.scenic3dPoints||[],t=!1,r="";if(map.temp.ifSupportWebGL)for(var d=0;d<a.length;d++)if(a[d].uid===o){t=!0,r=a[d].className;break}return t?(e.isScenic3dPoi=!0,e.poi=r,n=new BMap.SimpleInfoWindow(tpl(e),{title:"title",height:0,width:210,margin:mapConfig.infowinMargin,offset:i.offset})):(e.isScenic3dPoi=!1,n=new BMap.SimpleInfoWindow(tpl(e),{title:"title",height:0,width:160,margin:mapConfig.infowinMargin,offset:i.offset})),n.uid=i.uid,window.addStat("search.info.win","show"),this.pBindPoiInfoWindow(n),n},openSearchInfoWndPOI:function(e,i,n,o){if(window.GRControll){var a=window.GRControll.ifChangeMap();0!==a.f&&window.GRControll.setGRequestFlg(2e3)}n&&n.notMove&&e.disableAutoPan(),i?i.openSimpleInfoWindow(e,n):map.openSimpleInfoWindow(e,o)},pBindPoiInfoWindow:function(e){var i=this;i.rangeFlag=!1,e.addEventListener("open",function(){function n(){var e=a.find("input"),n=e.val()||"",o=i.opts||{};n&&i.roundSearchByValue(n,o.uid,null,o.cityCode,null,o.x,o.y,o.isFromMPC,null)}var o,a=baidu("#poi_info_window");a.delegate(".scenic3d-poi-wrapper","click",function(){for(var e=$(this).data("uid"),i=map.temp.scenic3dPoints,n=0;n<i.length;n++)if(e===i[n].uid){addStat("gotoscenic3dpage.poiinfowindow","click"),listener.trigger("toScenic3DPage","click",{uid:e,from:"poiinfowindow"});break}}),a.delegate(".right","click",function(){!0===i.rangeFlag?(i.rangeFlag=!1,a.find(".search_form").hide(),a.find(".range_wrap").removeClass("range_selected")):(i.rangeFlag=!0,a.find(".search_form").show(),a.find(".range_wrap").addClass("range_selected"),a.find("input").focus()),o=a.height(),e.setHeight(o+10)}),a.delegate("input","keydown",function(e){var i=e.keyCode;13===i&&n()}),a.delegate("button","click",function(){n()}),require.async("common:widget/ui/tooltip/tooltip.js",function(e){e.initialize(a.find(".range_wrap"))})})},roundSearchByLink:function(e,i,n,o,a,t,r,d){var p=a||0,l=d?1:0,c=e.innerHTML;this.roundSearchByValue(c,i,n,o,p,t,r,l)},roundSearchByInput:function(e,i,n,o,a,t,r,d){var p=d?1:0,l=a||1;this.roundSearchByValue(util.filtQuery(document.getElementById(e).value),i,n,o,l,t,r,p),addStat("poiinfowin.rangesearch.userinput")},pValidateRadius:function(e,i){var n=1e3;return n=null!==e?1e3:window.GRControll?window.GRControll.GRCircleRadius:n,i&&document.getElementById(i)&&(n=document.getElementById(i).value),n},roundSearchByValue:function(e,i,n,o,a,t,r,d,p){if(e){var l=this.pValidateRadius(d,n),c={r:l,c:o,wd:encodeURIComponent(e),nbtp:a,nb_x:t,nb_y:r};if(d)c.spotclick=1;else for(var s in p)p.hasOwnProperty(s)&&(c[s]=encodeURIComponent(p[s]));this.roundSearch(i,c)}},roundSearch:function(e,i){var n="";i=i||{},i=statParamInterceptor(i),i.query&&(i.query=encodeURIComponent(i.query));for(var o in i)"undefined"!=typeof i[o]&&(n=n+"&"+o+"="+i[o]);var a="nb"+n+"&uid="+e,t=16;window.GRControll&&(window.GRControll.GRCircleRadius=i.r,window.GRControll.isGRCircleShow=!0,window.GRControll.setGRequestFlg(1500),window.GRControll.GRCircleRadius>1500&&(t=15),window.GRControll.GRCircleRadius>2500&&(t=14));var r;if(map.centerAndZoom(new BMap.Point(i.nb_x,i.nb_y),t,{noAnimation:!0}),a.indexOf("b=")<0){r=map.getBounds({margins:[0,0,0,mapConfig.leftMargin]});var d=Math.min(r.minX,r.maxX),p=Math.max(r.minX,r.maxX),l=Math.min(r.minY,r.maxY),c=Math.max(r.minY,r.maxY);a+="&b=("+d+","+l+";"+p+","+c+")"}a.indexOf("l=")<0&&(r=map.getBounds(),a+="&l="+Math.floor(map.getZoom())),window.GRControll&&(window.GRControll.GRCircleRadius&&(a+="&gr_radius="+window.GRControll.GRCircleRadius),window.GRControll.openedMarker=null),filterStatus.active=!1,comMgr.go(a+"&from=webmap",{cinfo:{oc:i.c,isnbSearch:!0,simpleInfoWindow:!0}})},rangeSearchByInput:function(e,i,n,o,a,t,r,d,p){var l=d?1:0,c=t||1;addStat("poiinfowin.rangesearch.userinput"),this.rangeSearchByValue(util.filtQuery(document.getElementById(e).value),i,n,o,a,c,r,l,null,p)},rangeSearchByLink:function(e,i,n,o,a,t,r,d,p){var l=d?1:0,c=e.innerHTML,s=t||0;this.rangeSearchByValue(c,i,n,o,a,s,r,l,null,p)},rangeSearchByValue:function(e,i,n,o,a,t,r,d,p,l){if(a=modelConfig.cityCode,e){var c,s=this.pValidateRadius(d,o);i=1*i,n=1*n,c=1*s;var u=i-c,m=n-c,f=i+c,g=n+c,w="("+u+","+m+";"+f+","+g+")",_={ar:w,wd:encodeURIComponent(e),c:a,bdtp:t,nb_x:i,nb_y:n,userSign:l};if(d)_.spotclick=1;else for(var h in p)p.hasOwnProperty(h)&&(_[h]=encodeURIComponent(p[h]));this.rangeSearch(_,new BMap.Point(i,n),c)}},rangeSearch:function(e,i,n){if(e){var o,a,t="";for(o in e)"undefined"!=typeof e[o]&&(t=t+"&"+o+"="+e[o]);var r=16;window.GRControll&&(window.GRControll.GRCircleRadius=n,window.GRControll.isGRCircleShow=!0,window.GRControll.setGRequestFlg(1500),window.GRControll.GRCircleRadius>1500&&(r=15),window.GRControll.GRCircleRadius>2500&&(r=14)),map.centerAndZoom(i,r,{noAnimation:!0});var d,p="nb"+t;p.indexOf("b=")<0&&(d=map.getBounds({margins:[0,0,0,mapConfig.leftMargin]}),p+="&b=("+d.minX+","+d.minY+";"+d.maxX+","+d.maxY+")"),p.indexOf("l=")<0&&(d=map.getBounds(),p+="&l="+Math.floor(map.getZoom()));var l="中心点";if(e.userSign){var c=signMgr.mapSign.pointInfo.list;for(o=0,a;a=c[o];o++)if(a.point===i.lng+"|"+i.lat){l=a.title;break}}else if(this.rangeSearchCenterMarker)l=this.rangeSearchCenterMarker.getTitle();else{var s=map.getOverlays();for(o=0,a;a=s[o];o++){var u=util.getOverlayPoint(a);if(u&&u.lat===i.lat&&u.lng===i.lng){l=a.getTitle();break}}}l||(l="中心点");var m=this.getCenterPoiNameCbk.pUid?this.getCenterPoiNameCbk.pUid:"";m&&(p+="&uid="+m),window.GRControll&&window.GRControll.GRCircleRadius&&(p+="&gr_radius="+window.GRControll.GRCircleRadius),filterStatus.active=!1,comMgr.go(p+"&r="+n+"&from=webmap",{cinfo:{searchByContextMenu:!0,centerPoint:i,ctPoiName:l,radius:n,oc:e.c,uid:m,isnbSearch:!0,simpleInfoWindow:!0}})}},getCenterPoiNameCbk:function(e){var i=this,n=map.getInfoWindow();if(n){var o=e.content;if(o&&o.address){var a=o.address;o.surround_poi&&o.surround_poi[0]&&(a=o.surround_poi[0].addr,this.getCenterPoiNameCbk.pUid=o.surround_poi[0].uid);var t=n.getPoint&&n.getPoint(),r=this.rangeSearchCenterMarker.getPoint&&this.rangeSearchCenterMarker.getPoint();if(t===r){var d="<p class='iw_poi_title' title='"+a+"'>"+a+"</p>";n.setTitle(d),this.rangeSearchCenterMarker.setTitle(a)}}}else window.setTimeout(function(){i.getCenterPoiNameCbk(e)},50)},createRangeInfoWnd:function(e){if(e){var i=this;return mapUtil.getGEORevertAddress(e,function(e){i.getCenterPoiNameCbk(e)}),this.createSearchInfoWnd({title:"未知地点",poiType:0},{x:e.lng,y:e.lat,statCode:"",tabIndex:0})}},exitRangeSearch:function(){this.rangeSearchCenterMarker&&(this.rangeSearchCenterMarker.remove(),this.rangeSearchCenterMarker=null)}};module.exports=searchSimpleInfoWindow});