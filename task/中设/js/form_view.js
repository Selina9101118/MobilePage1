!function(t){FX.ViewForm=FX.ViewForm||{},t.extend(FX.ViewForm,{init:function(t,e,i,a,o){this._initQRCode(FX.STATIC.FTOKEN),this.appId=i,this.entryId=a,this.extParam=o,t?this._showPassDialog():this.loadForm()},loadForm:function(){var t=this;FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.form.get,this.appId,this.entryId)},function(e){FX.Vip.showUpgradeTip(e.bufferState);var i=e.entry;t._createForm(i)})},_createForm:function(e){var i=this,a=t(".content",".form");FX.STATIC.ENTRYID=this.entryId,FX.Vip.showDataLimitTip({renderEl:t("<div/>").prependTo("body"),customCls:"data-limit-tip"}),new FX.Form(t.extend(e.content,{renderEl:t('<div class = "form"/>').appendTo(a),appId:i.appId,entryId:i.entryId,submitText:"提交",title:e.name,extParam:i.extParam,buttonPosition:"middle",cacheEnable:e.hasCache,updateTime:e.updateTime,onSuccess:function(t){var e=a.empty();t.flowFailureCode?i._showFlowFailInfo(e.addClass("flow-fail"),t.flowFailureCode):i._showSuccessInfo(e.addClass("form-success"),t,function(){location.reload()})}}))},_showSuccessInfo:function(e,i,a){var o,s=this;i&&i.data&&(o=i.data.submitPrompt);var n=t('<div class="success-pane"/>').appendTo(e);if(o&&"custom"===o.mode?n.addClass("custom-pane x-subhtml").html(o.content):(t("<div/>").append(t('<i class="data-create-success-icon"/>')).appendTo(n),t('<div class="msg-title"/>').text("提交成功").appendTo(n),FX.Utils.isEmpty(i.check_msg)||t("<div>"+i.check_msg+"</div>").appendTo(n)),a&&(!o||o&&("custom"===o.mode&&o.hasAddBtn||"system"===o.mode))){var d=t('<div class="button-pane"/>').appendTo(n);new FX.Button({renderEl:t("<div />").appendTo(d),text:"继续添加",width:120,style:"green",onClick:function(){FX.Utils.applyFunc(s,a,[],!1)}})}},_showFlowFailInfo:function(e,i){var a="出错原因：",o=FX.CONST.FLOW_FAIL_CODE;i===o.FORWARD_CHARGER?a+="找不到下个节点负责人。":i===o.FORWARD_COND&&(a+="不符合流转条件。"),t('<div class="fail-content"><div class="fail-icon"><i class="icon-sad-face"/></div><div class="fail-title">流程出错了，可联系链接发布者寻求帮助</div><div class="fail-detail">'+a+'</div><div class="fail-detail">您的数据已保存，请勿重复提交!</div></div>').appendTo(e)},_showPassDialog:function(){var t=this,e=new FX.Dialog({title:"请输入密码",width:410,height:240,hasCloseBtn:!1,contentWidget:{rowSize:[24,36,36],colSize:[370],padding:20,hgap:40,vgap:25,items:[[{type:"label",customCls:"password-write-tip",text:"填写该表单需输入密码，请输入密码：",widgetName:"password"}],[{type:"password",widgetName:"password",allowBlank:!1}],[{type:"button",text:"确定",style:"green",onClick:function(){this.setEnable(!1);var i=this,a=e.getWidgetByName("password");FX.Utils.ajax({url:FX.Utils.getApi(FX.API.entry.f,FX.STATIC.FTOKEN),data:{publicPwd:a.getValue()}},function(a,o){i.setEnable(!0),e.close(),t.loadForm()},function(t,e){FX.Msg.toast({type:"error",msg:"密码错误"})},function(){i.setEnable(!0)})}}]]}});e.show(),e.getWidgetByName("password").select()},_initQRCode:function(e){var i=t(".qrcode");FX.Utils.isEmpty(e)?i.remove():i.click(function(){var e=t('<div class="qrcode-dropdown"/>');t("<img/>").attr("src","/qrcode?u="+encodeURIComponent(window.location.href)).appendTo(e),t("<div/>").text('微信"扫一扫"，分享给好友').appendTo(e),FX.Msg.bubble({anchor:i,dockPosition:"right",text4Ok:null,minWidth:150,text4Cancel:null,contentHTML:e,scrollObj:t("#content"),hAdjust:15})})}})}(jQuery);