var Zepto=function(){function t(t){return null==t?String(t):z[j.call(t)]||"object"}function e(e){return"function"==t(e)}function i(t){return null!=t&&t==t.window}function a(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function n(e){return"object"==t(e)}function r(t){return n(t)&&!i(t)&&Object.getPrototypeOf(t)==Object.prototype}function s(t){return"number"==typeof t.length}function o(t){return X.call(t,function(t){return null!=t})}function l(t){return t.length>0?b.fn.concat.apply([],t):t}function c(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function h(t){return t in k?k[t]:k[t]=new RegExp("(^|\\s)"+t+"(\\s|$)")}function u(t,e){return"number"!=typeof e||L[c(t)]?e:e+"px"}function d(t){var e,i;return I[t]||(e=S.createElement(t),S.body.appendChild(e),i=getComputedStyle(e,"").getPropertyValue("display"),e.parentNode.removeChild(e),"none"==i&&(i="block"),I[t]=i),I[t]}function p(t){return"children"in t?A.call(t.children):b.map(t.childNodes,function(t){if(1==t.nodeType)return t})}function f(t,e,i){for(T in e)i&&(r(e[T])||Z(e[T]))?(r(e[T])&&!r(t[T])&&(t[T]={}),Z(e[T])&&!Z(t[T])&&(t[T]=[]),f(t[T],e[T],i)):e[T]!==_&&(t[T]=e[T])}function m(t,e){return null==e?b(t):b(t).filter(e)}function g(t,i,a,n){return e(i)?i.call(t,a,n):i}function v(t,e,i){null==i?t.removeAttribute(e):t.setAttribute(e,i)}function y(t,e){var i=t.className||"",a=i&&i.baseVal!==_;if(e===_)return a?i.baseVal:i;a?i.baseVal=e:t.className=e}function M(t){try{return t?"true"==t||"false"!=t&&("null"==t?null:+t+""==t?+t:/^[\[\{]/.test(t)?b.parseJSON(t):t):t}catch(e){return t}}function F(t,e){e(t);for(var i=0,a=t.childNodes.length;i<a;i++)F(t.childNodes[i],e)}var _,T,b,x,C,w,E=[],A=E.slice,X=E.filter,S=window.document,I={},k={},L={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},D=/^\s*<(\w+|!)[^>]*>/,O=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,P=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,U=/^(?:body|html)$/i,R=/([A-Z])/g,N=["val","css","html","text","data","width","height","offset"],B=["after","prepend","before","append"],G=S.createElement("table"),V=S.createElement("tr"),H={tr:S.createElement("tbody"),tbody:G,thead:G,tfoot:G,td:V,th:V,"*":S.createElement("div")},$=/complete|loaded|interactive/,W=/^[\w-]*$/,z={},j=z.toString,Y={},q=S.createElement("div"),K={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},Z=Array.isArray||function(t){return t instanceof Array};return Y.matches=function(t,e){if(!e||!t||1!==t.nodeType)return!1;var i=t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.matchesSelector;if(i)return i.call(t,e);var a,n=t.parentNode,r=!n;return r&&(n=q).appendChild(t),a=~Y.qsa(n,e).indexOf(t),r&&q.removeChild(t),a},C=function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},w=function(t){return X.call(t,function(e,i){return t.indexOf(e)==i})},Y.fragment=function(t,e,i){var a,n,s;return O.test(t)&&(a=b(S.createElement(RegExp.$1))),a||(t.replace&&(t=t.replace(P,"<$1></$2>")),e===_&&(e=D.test(t)&&RegExp.$1),e in H||(e="*"),(s=H[e]).innerHTML=""+t,a=b.each(A.call(s.childNodes),function(){s.removeChild(this)})),r(i)&&(n=b(a),b.each(i,function(t,e){N.indexOf(t)>-1?n[t](e):n.attr(t,e)})),a},Y.Z=function(t,e){return t=t||[],t.__proto__=b.fn,t.selector=e||"",t},Y.isZ=function(t){return t instanceof Y.Z},Y.init=function(t,i){var a;if(!t)return Y.Z();if("string"==typeof t)if("<"==(t=t.trim())[0]&&D.test(t))a=Y.fragment(t,RegExp.$1,i),t=null;else{if(i!==_)return b(i).find(t);a=Y.qsa(S,t)}else{if(e(t))return b(S).ready(t);if(Y.isZ(t))return t;if(Z(t))a=o(t);else if(n(t))a=[t],t=null;else if(D.test(t))a=Y.fragment(t.trim(),RegExp.$1,i),t=null;else{if(i!==_)return b(i).find(t);a=Y.qsa(S,t)}}return Y.Z(a,t)},b=function(t,e){return Y.init(t,e)},b.extend=function(t){var e,i=A.call(arguments,1);return"boolean"==typeof t&&(e=t,t=i.shift()),i.forEach(function(i){f(t,i,e)}),t},Y.qsa=function(t,e){var i,n="#"==e[0],r=!n&&"."==e[0],s=n||r?e.slice(1):e,o=W.test(s);return a(t)&&o&&n?(i=t.getElementById(s))?[i]:[]:1!==t.nodeType&&9!==t.nodeType?[]:A.call(o&&!n?r?t.getElementsByClassName(s):t.getElementsByTagName(e):t.querySelectorAll(e))},b.contains=S.documentElement.contains?function(t,e){return t!==e&&t.contains(e)}:function(t,e){for(;e&&(e=e.parentNode);)if(e===t)return!0;return!1},b.type=t,b.isFunction=e,b.isWindow=i,b.isArray=Z,b.isPlainObject=r,b.isEmptyObject=function(t){var e;for(e in t)return!1;return!0},b.inArray=function(t,e,i){return E.indexOf.call(e,t,i)},b.camelCase=C,b.trim=function(t){return null==t?"":String.prototype.trim.call(t)},b.uuid=0,b.support={},b.expr={},b.map=function(t,e){var i,a,n,r=[];if(s(t))for(a=0;a<t.length;a++)null!=(i=e(t[a],a))&&r.push(i);else for(n in t)null!=(i=e(t[n],n))&&r.push(i);return l(r)},b.each=function(t,e){var i,a;if(s(t)){for(i=0;i<t.length;i++)if(!1===e.call(t[i],i,t[i]))return t}else for(a in t)if(!1===e.call(t[a],a,t[a]))return t;return t},b.grep=function(t,e){return X.call(t,e)},window.JSON&&(b.parseJSON=JSON.parse),b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){z["[object "+e+"]"]=e.toLowerCase()}),b.fn={forEach:E.forEach,reduce:E.reduce,push:E.push,sort:E.sort,indexOf:E.indexOf,concat:E.concat,map:function(t){return b(b.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return b(A.apply(this,arguments))},ready:function(t){return $.test(S.readyState)&&S.body?t(b):S.addEventListener("DOMContentLoaded",function(){t(b)},!1),this},get:function(t){return t===_?A.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(t){return E.every.call(this,function(e,i){return!1!==t.call(e,i,e)}),this},filter:function(t){return e(t)?this.not(this.not(t)):b(X.call(this,function(e){return Y.matches(e,t)}))},add:function(t,e){return b(w(this.concat(b(t,e))))},is:function(t){return this.length>0&&Y.matches(this[0],t)},not:function(t){var i=[];if(e(t)&&t.call!==_)this.each(function(e){t.call(this,e)||i.push(this)});else{var a="string"==typeof t?this.filter(t):s(t)&&e(t.item)?A.call(t):b(t);this.forEach(function(t){a.indexOf(t)<0&&i.push(t)})}return b(i)},has:function(t){return this.filter(function(){return n(t)?b.contains(this,t):b(this).find(t).size()})},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){var t=this[0];return t&&!n(t)?t:b(t)},last:function(){var t=this[this.length-1];return t&&!n(t)?t:b(t)},find:function(t){var e=this;return t?"object"==typeof t?b(t).filter(function(){var t=this;return E.some.call(e,function(e){return b.contains(e,t)})}):1==this.length?b(Y.qsa(this[0],t)):this.map(function(){return Y.qsa(this,t)}):b()},closest:function(t,e){var i=this[0],n=!1;for("object"==typeof t&&(n=b(t));i&&!(n?n.indexOf(i)>=0:Y.matches(i,t));)i=i!==e&&!a(i)&&i.parentNode;return b(i)},parents:function(t){for(var e=[],i=this;i.length>0;)i=b.map(i,function(t){if((t=t.parentNode)&&!a(t)&&e.indexOf(t)<0)return e.push(t),t});return m(e,t)},parent:function(t){return m(w(this.pluck("parentNode")),t)},children:function(t){return m(this.map(function(){return p(this)}),t)},contents:function(){return this.map(function(){return A.call(this.childNodes)})},siblings:function(t){return m(this.map(function(t,e){return X.call(p(e.parentNode),function(t){return t!==e})}),t)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(t){return b.map(this,function(e){return e[t]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=d(this.nodeName))})},replaceWith:function(t){return this.before(t).remove()},wrap:function(t){var i=e(t);if(this[0]&&!i)var a=b(t).get(0),n=a.parentNode||this.length>1;return this.each(function(e){b(this).wrapAll(i?t.call(this,e):n?a.cloneNode(!0):a)})},wrapAll:function(t){if(this[0]){b(this[0]).before(t=b(t));for(var e;(e=t.children()).length;)t=e.first();b(t).append(this)}return this},wrapInner:function(t){var i=e(t);return this.each(function(e){var a=b(this),n=a.contents(),r=i?t.call(this,e):t;n.length?n.wrapAll(r):a.append(r)})},unwrap:function(){return this.parent().each(function(){b(this).replaceWith(b(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(t){return this.each(function(){var e=b(this);(t===_?"none"==e.css("display"):t)?e.show():e.hide()})},prev:function(t){return b(this.pluck("previousElementSibling")).filter(t||"*")},next:function(t){return b(this.pluck("nextElementSibling")).filter(t||"*")},html:function(t){return 0 in arguments?this.each(function(e){var i=this.innerHTML;b(this).empty().append(g(this,t,e,i))}):0 in this?this[0].innerHTML:null},text:function(t){return 0 in arguments?this.each(function(e){var i=g(this,t,e,this.textContent);this.textContent=null==i?"":""+i}):0 in this?this[0].textContent:null},attr:function(t,e){var i;return"string"!=typeof t||1 in arguments?this.each(function(i){if(1===this.nodeType)if(n(t))for(T in t)v(this,T,t[T]);else v(this,t,g(this,e,i,this.getAttribute(t)))}):this.length&&1===this[0].nodeType?!(i=this[0].getAttribute(t))&&t in this[0]?this[0][t]:i:_},removeAttr:function(t){return this.each(function(){1===this.nodeType&&t.split(" ").forEach(function(t){v(this,t)},this)})},prop:function(t,e){return t=K[t]||t,1 in arguments?this.each(function(i){this[t]=g(this,e,i,this[t])}):this[0]&&this[0][t]},data:function(t,e){var i="data-"+t.replace(R,"-$1").toLowerCase(),a=1 in arguments?this.attr(i,e):this.attr(i);return null!==a?M(a):_},val:function(t){return 0 in arguments?this.each(function(e){this.value=g(this,t,e,this.value)}):this[0]&&(this[0].multiple?b(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(t){if(t)return this.each(function(e){var i=b(this),a=g(this,t,e,i.offset()),n=i.offsetParent().offset(),r={top:a.top-n.top,left:a.left-n.left};"static"==i.css("position")&&(r.position="relative"),i.css(r)});if(!this.length)return null;var e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:Math.round(e.width),height:Math.round(e.height)}},css:function(e,i){if(arguments.length<2){var a,n=this[0];if(!n)return;if(a=getComputedStyle(n,""),"string"==typeof e)return n.style[C(e)]||a.getPropertyValue(e);if(Z(e)){var r={};return b.each(e,function(t,e){r[e]=n.style[C(e)]||a.getPropertyValue(e)}),r}}var s="";if("string"==t(e))i||0===i?s=c(e)+":"+u(e,i):this.each(function(){this.style.removeProperty(c(e))});else for(T in e)e[T]||0===e[T]?s+=c(T)+":"+u(T,e[T])+";":this.each(function(){this.style.removeProperty(c(T))});return this.each(function(){this.style.cssText+=";"+s})},index:function(t){return t?this.indexOf(b(t)[0]):this.parent().children().indexOf(this[0])},hasClass:function(t){return!!t&&E.some.call(this,function(t){return this.test(y(t))},h(t))},addClass:function(t){return t?this.each(function(e){if("className"in this){x=[];var i=y(this);g(this,t,e,i).split(/\s+/g).forEach(function(t){b(this).hasClass(t)||x.push(t)},this),x.length&&y(this,i+(i?" ":"")+x.join(" "))}}):this},removeClass:function(t){return this.each(function(e){if("className"in this){if(t===_)return y(this,"");x=y(this),g(this,t,e,x).split(/\s+/g).forEach(function(t){x=x.replace(h(t)," ")}),y(this,x.trim())}})},toggleClass:function(t,e){return t?this.each(function(i){var a=b(this);g(this,t,i,y(this)).split(/\s+/g).forEach(function(t){(e===_?!a.hasClass(t):e)?a.addClass(t):a.removeClass(t)})}):this},scrollTop:function(t){if(this.length){var e="scrollTop"in this[0];return t===_?e?this[0].scrollTop:this[0].pageYOffset:this.each(e?function(){this.scrollTop=t}:function(){this.scrollTo(this.scrollX,t)})}},scrollLeft:function(t){if(this.length){var e="scrollLeft"in this[0];return t===_?e?this[0].scrollLeft:this[0].pageXOffset:this.each(e?function(){this.scrollLeft=t}:function(){this.scrollTo(t,this.scrollY)})}},position:function(){if(this.length){var t=this[0],e=this.offsetParent(),i=this.offset(),a=U.test(e[0].nodeName)?{top:0,left:0}:e.offset();return i.top-=parseFloat(b(t).css("margin-top"))||0,i.left-=parseFloat(b(t).css("margin-left"))||0,a.top+=parseFloat(b(e[0]).css("border-top-width"))||0,a.left+=parseFloat(b(e[0]).css("border-left-width"))||0,{top:i.top-a.top,left:i.left-a.left}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||S.body;t&&!U.test(t.nodeName)&&"static"==b(t).css("position");)t=t.offsetParent;return t})}},b.fn.detach=b.fn.remove,["width","height"].forEach(function(t){var e=t.replace(/./,function(t){return t[0].toUpperCase()});b.fn[t]=function(n){var r,s=this[0];return n===_?i(s)?s["inner"+e]:a(s)?s.documentElement["scroll"+e]:(r=this.offset())&&r[t]:this.each(function(e){(s=b(this)).css(t,g(this,n,e,s[t]()))})}}),B.forEach(function(e,i){var a=i%2;b.fn[e]=function(){var e,n,r=b.map(arguments,function(i){return"object"==(e=t(i))||"array"==e||null==i?i:Y.fragment(i)}),s=this.length>1;return r.length<1?this:this.each(function(t,e){n=a?e:e.parentNode,e=0==i?e.nextSibling:1==i?e.firstChild:2==i?e:null;var o=b.contains(S.documentElement,n);r.forEach(function(t){if(s)t=t.cloneNode(!0);else if(!n)return b(t).remove();n.insertBefore(t,e),o&&F(t,function(t){null==t.nodeName||"SCRIPT"!==t.nodeName.toUpperCase()||t.type&&"text/javascript"!==t.type||t.src||window.eval.call(window,t.innerHTML)})})})},b.fn[a?e+"To":"insert"+(i?"Before":"After")]=function(t){return b(t)[e](this),this}}),Y.Z.prototype=b.fn,Y.uniq=w,Y.deserializeValue=M,b.zepto=Y,b}();window.Zepto=Zepto,void 0===window.$&&(window.$=Zepto),function(t){function e(t){return t._zid||(t._zid=d++)}function i(t,i,r,s){if((i=a(i)).ns)var o=n(i.ns);return(g[e(t)]||[]).filter(function(t){return t&&(!i.e||t.e==i.e)&&(!i.ns||o.test(t.ns))&&(!r||e(t.fn)===e(r))&&(!s||t.sel==s)})}function a(t){var e=(""+t).split(".");return{e:e[0],ns:e.slice(1).sort().join(" ")}}function n(t){return new RegExp("(?:^| )"+t.replace(" "," .* ?")+"(?: |$)")}function r(t,e){return t.del&&!y&&t.e in M||!!e}function s(t){return F[t]||y&&M[t]||t}function o(i,n,o,l,h,d,p){var f=e(i),m=g[f]||(g[f]=[]);n.split(/\s/).forEach(function(e){if("ready"==e)return t(document).ready(o);var n=a(e);n.fn=o,n.sel=h,n.e in F&&(o=function(e){var i=e.relatedTarget;if(!i||i!==this&&!t.contains(this,i))return n.fn.apply(this,arguments)}),n.del=d;var f=d||o;n.proxy=function(t){if(!(t=c(t)).isImmediatePropagationStopped()){t.data=l;var e=f.apply(i,t._args==u?[t]:[t].concat(t._args));return!1===e&&(t.preventDefault(),t.stopPropagation()),e}},n.i=m.length,m.push(n),"addEventListener"in i&&i.addEventListener(s(n.e),n.proxy,r(n,p))})}function l(t,a,n,o,l){var c=e(t);(a||"").split(/\s/).forEach(function(e){i(t,e,n,o).forEach(function(e){delete g[c][e.i],"removeEventListener"in t&&t.removeEventListener(s(e.e),e.proxy,r(e,l))})})}function c(e,i){return!i&&e.isDefaultPrevented||(i||(i=e),t.each(x,function(t,a){var n=i[t];e[t]=function(){return this[a]=_,n&&n.apply(i,arguments)},e[a]=T}),(i.defaultPrevented!==u?i.defaultPrevented:"returnValue"in i?!1===i.returnValue:i.getPreventDefault&&i.getPreventDefault())&&(e.isDefaultPrevented=_)),e}function h(t){var e,i={originalEvent:t};for(e in t)b.test(e)||t[e]===u||(i[e]=t[e]);return c(i,t)}var u,d=1,p=Array.prototype.slice,f=t.isFunction,m=function(t){return"string"==typeof t},g={},v={},y="onfocusin"in window,M={focus:"focusin",blur:"focusout"},F={mouseenter:"mouseover",mouseleave:"mouseout"};v.click=v.mousedown=v.mouseup=v.mousemove="MouseEvents",t.event={add:o,remove:l},t.proxy=function(i,a){var n=2 in arguments&&p.call(arguments,2);if(f(i)){var r=function(){return i.apply(a,n?n.concat(p.call(arguments)):arguments)};return r._zid=e(i),r}if(m(a))return n?(n.unshift(i[a],i),t.proxy.apply(null,n)):t.proxy(i[a],i);throw new TypeError("expected function")},t.fn.bind=function(t,e,i){return this.on(t,e,i)},t.fn.unbind=function(t,e){return this.off(t,e)},t.fn.one=function(t,e,i,a){return this.on(t,e,i,a,1)};var _=function(){return!0},T=function(){return!1},b=/^([A-Z]|returnValue$|layer[XY]$)/,x={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};t.fn.delegate=function(t,e,i){return this.on(e,t,i)},t.fn.undelegate=function(t,e,i){return this.off(e,t,i)},t.fn.live=function(e,i){return t(document.body).delegate(this.selector,e,i),this},t.fn.die=function(e,i){return t(document.body).undelegate(this.selector,e,i),this},t.fn.on=function(e,i,a,n,r){var s,c,d=this;return e&&!m(e)?(t.each(e,function(t,e){d.on(t,i,a,e,r)}),d):(m(i)||f(n)||!1===n||(n=a,a=i,i=u),(f(a)||!1===a)&&(n=a,a=u),!1===n&&(n=T),d.each(function(u,d){r&&(s=function(t){return l(d,t.type,n),n.apply(this,arguments)}),i&&(c=function(e){var a,r=t(e.target).closest(i,d).get(0);if(r&&r!==d)return a=t.extend(h(e),{currentTarget:r,liveFired:d}),(s||n).apply(r,[a].concat(p.call(arguments,1)))}),o(d,e,n,a,i,c||s)}))},t.fn.off=function(e,i,a){var n=this;return e&&!m(e)?(t.each(e,function(t,e){n.off(t,i,e)}),n):(m(i)||f(a)||!1===a||(a=i,i=u),!1===a&&(a=T),n.each(function(){l(this,e,a,i)}))},t.fn.trigger=function(e,i){return e=m(e)||t.isPlainObject(e)?t.Event(e):c(e),e._args=i,this.each(function(){e.type in M&&"function"==typeof this[e.type]?this[e.type]():"dispatchEvent"in this?this.dispatchEvent(e):t(this).triggerHandler(e,i)})},t.fn.triggerHandler=function(e,a){var n,r;return this.each(function(s,o){(n=h(m(e)?t.Event(e):e))._args=a,n.target=o,t.each(i(o,e.type||e),function(t,e){if(r=e.proxy(n),n.isImmediatePropagationStopped())return!1})}),r},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(e){t.fn[e]=function(t){return 0 in arguments?this.bind(e,t):this.trigger(e)}}),t.Event=function(t,e){m(t)||(e=t,t=e.type);var i=document.createEvent(v[t]||"Events"),a=!0;if(e)for(var n in e)"bubbles"==n?a=!!e[n]:i[n]=e[n];return i.initEvent(t,a,!0),c(i)}}(Zepto),function(t){function e(e,i,a){var n=t.Event(i);return t(e).trigger(n,a),!n.isDefaultPrevented()}function i(t,i,a,n){if(t.global)return e(i||y,a,n)}function a(e){e.global&&0==t.active++&&i(e,null,"ajaxStart")}function n(e){e.global&&!--t.active&&i(e,null,"ajaxStop")}function r(t,e){var a=e.context;if(!1===e.beforeSend.call(a,t,e)||!1===i(e,a,"ajaxBeforeSend",[t,e]))return!1;i(e,a,"ajaxSend",[t,e])}function s(t,e,a,n){var r=a.context;a.success.call(r,t,"success",e),n&&n.resolveWith(r,[t,"success",e]),i(a,r,"ajaxSuccess",[e,a,t]),l("success",e,a)}function o(t,e,a,n,r){var s=n.context;n.error.call(s,a,e,t),r&&r.rejectWith(s,[a,e,t]),i(n,s,"ajaxError",[a,n,t||e]),l(e,a,n)}function l(t,e,a){var r=a.context;a.complete.call(r,e,t),i(a,r,"ajaxComplete",[e,a]),n(a)}function c(){}function h(t){return t&&(t=t.split(";",2)[0]),t&&(t==b?"html":t==T?"json":F.test(t)?"script":_.test(t)&&"xml")||"text"}function u(t,e){return""==e?t:(t+"&"+e).replace(/[&?]{1,2}/,"?")}function d(e){e.processData&&e.data&&"string"!=t.type(e.data)&&(e.data=t.param(e.data,e.traditional)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=u(e.url,e.data),e.data=void 0)}function p(e,i,a,n){return t.isFunction(i)&&(n=a,a=i,i=void 0),t.isFunction(a)||(n=a,a=void 0),{url:e,data:i,success:a,dataType:n}}function f(e,i,a,n){var r,s=t.isArray(i),o=t.isPlainObject(i);t.each(i,function(i,l){r=t.type(l),n&&(i=a?n:n+"["+(o||"object"==r||"array"==r?i:"")+"]"),!n&&s?e.add(l.name,l.value):"array"==r||!a&&"object"==r?f(e,l,a,i):e.add(i,l)})}var m,g,v=0,y=window.document,M=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,F=/^(?:text|application)\/javascript/i,_=/^(?:text|application)\/xml/i,T="application/json",b="text/html",x=/^\s*$/,C=y.createElement("a");C.href=window.location.href,t.active=0,t.ajaxJSONP=function(e,i){if(!("type"in e))return t.ajax(e);var a,n,l=e.jsonpCallback,c=(t.isFunction(l)?l():l)||"jsonp"+ ++v,h=y.createElement("script"),u=window[c],d=function(e){t(h).triggerHandler("error",e||"abort")},p={abort:d};return i&&i.promise(p),t(h).on("load error",function(r,l){clearTimeout(n),t(h).off().remove(),"error"!=r.type&&a?s(a[0],p,e,i):o(null,l||"error",p,e,i),window[c]=u,a&&t.isFunction(u)&&u(a[0]),u=a=void 0}),!1===r(p,e)?(d("abort"),p):(window[c]=function(){a=arguments},h.src=e.url.replace(/\?(.+)=\?/,"?$1="+c),y.head.appendChild(h),e.timeout>0&&(n=setTimeout(function(){d("timeout")},e.timeout)),p)},t.ajaxSettings={type:"GET",beforeSend:c,success:c,error:c,complete:c,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:T,xml:"application/xml, text/xml",html:b,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},t.ajax=function(e){var i,n=t.extend({},e||{}),l=t.Deferred&&t.Deferred();for(m in t.ajaxSettings)void 0===n[m]&&(n[m]=t.ajaxSettings[m]);a(n),n.crossDomain||((i=y.createElement("a")).href=n.url,i.href=i.href,n.crossDomain=C.protocol+"//"+C.host!=i.protocol+"//"+i.host),n.url||(n.url=window.location.toString()),d(n);var p=n.dataType,f=/\?.+=\?/.test(n.url);if(f&&(p="jsonp"),!1!==n.cache&&(e&&!0===e.cache||"script"!=p&&"jsonp"!=p)||(n.url=u(n.url,"_="+Date.now())),"jsonp"==p)return f||(n.url=u(n.url,n.jsonp?n.jsonp+"=?":!1===n.jsonp?"":"callback=?")),t.ajaxJSONP(n,l);var v,M=n.accepts[p],F={},_=function(t,e){F[t.toLowerCase()]=[t,e]},T=/^([\w-]+:)\/\//.test(n.url)?RegExp.$1:window.location.protocol,b=n.xhr(),w=b.setRequestHeader;if(l&&l.promise(b),n.crossDomain||_("X-Requested-With","XMLHttpRequest"),_("Accept",M||"*/*"),(M=n.mimeType||M)&&(M.indexOf(",")>-1&&(M=M.split(",",2)[0]),b.overrideMimeType&&b.overrideMimeType(M)),(n.contentType||!1!==n.contentType&&n.data&&"GET"!=n.type.toUpperCase())&&_("Content-Type",n.contentType||"application/x-www-form-urlencoded"),n.headers)for(g in n.headers)_(g,n.headers[g]);if(b.setRequestHeader=_,b.onreadystatechange=function(){if(4==b.readyState){b.onreadystatechange=c,clearTimeout(v);var e,i=!1;if(b.status>=200&&b.status<300||304==b.status||0==b.status&&"file:"==T){p=p||h(n.mimeType||b.getResponseHeader("content-type")),e=b.responseText;try{"script"==p?(0,eval)(e):"xml"==p?e=b.responseXML:"json"==p&&(e=x.test(e)?null:t.parseJSON(e))}catch(t){i=t}i?o(i,"parsererror",b,n,l):s(e,b,n,l)}else o(b.statusText||null,b.status?"error":"abort",b,n,l)}},!1===r(b,n))return b.abort(),o(null,"abort",b,n,l),b;if(n.xhrFields)for(g in n.xhrFields)b[g]=n.xhrFields[g];var E=!("async"in n)||n.async;b.open(n.type,n.url,E,n.username,n.password);for(g in F)w.apply(b,F[g]);return n.timeout>0&&(v=setTimeout(function(){b.onreadystatechange=c,b.abort(),o(null,"timeout",b,n,l)},n.timeout)),b.send(n.data?n.data:null),b},t.get=function(){return t.ajax(p.apply(null,arguments))},t.post=function(){var e=p.apply(null,arguments);return e.type="POST",t.ajax(e)},t.getJSON=function(){var e=p.apply(null,arguments);return e.dataType="json",t.ajax(e)},t.fn.load=function(e,i,a){if(!this.length)return this;var n,r=this,s=e.split(/\s/),o=p(e,i,a),l=o.success;return s.length>1&&(o.url=s[0],n=s[1]),o.success=function(e){r.html(n?t("<div>").html(e.replace(M,"")).find(n):e),l&&l.apply(r,arguments)},t.ajax(o),this};var w=encodeURIComponent;t.param=function(e,i){var a=[];return a.add=function(e,i){t.isFunction(i)&&(i=i()),null==i&&(i=""),this.push(w(e)+"="+w(i))},f(a,e,i),a.join("&").replace(/%20/g,"+")}}(Zepto),function(t){t.fn.serializeArray=function(){var e,i,a=[],n=function(t){if(t.forEach)return t.forEach(n);a.push({name:e,value:t})};return this[0]&&t.each(this[0].elements,function(a,r){i=r.type,(e=r.name)&&"fieldset"!=r.nodeName.toLowerCase()&&!r.disabled&&"submit"!=i&&"reset"!=i&&"button"!=i&&"file"!=i&&("radio"!=i&&"checkbox"!=i||r.checked)&&n(t(r).val())}),a},t.fn.serialize=function(){var t=[];return this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),t.join("&")},t.fn.submit=function(e){if(0 in arguments)this.bind("submit",e);else if(this.length){var i=t.Event("submit");this.eq(0).trigger(i),i.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),function(t){"__proto__"in{}||t.extend(t.zepto,{Z:function(e,i){return e=e||[],t.extend(e,t.fn),e.selector=i||"",e.__Z=!0,e},isZ:function(e){return"array"===t.type(e)&&"__Z"in e}});try{getComputedStyle(void 0)}catch(t){var e=getComputedStyle;window.getComputedStyle=function(t){try{return e(t)}catch(t){return null}}}}(Zepto),function(t){"use strict";function e(t,e){function i(t){if(t.target===this)for(e.call(this,t),a=0;a<n.length;a++)r.off(n[a],i)}var a,n=t,r=this;if(e)for(a=0;a<n.length;a++)r.on(n[a],i)}["width","height"].forEach(function(e){var i=e.replace(/./,function(t){return t[0].toUpperCase()});t.fn["outer"+i]=function(t){var i=this;if(i){var a=i[e]();return{width:["left","right"],height:["top","bottom"]}[e].forEach(function(e){t&&(a+=parseInt(i.css("margin-"+e),10))}),a}return null}}),t.support={touch:!!("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)},t.touchEvents={start:t.support.touch?"touchstart":"mousedown",move:t.support.touch?"touchmove":"mousemove",end:t.support.touch?"touchend":"mouseup"},t.getTranslate=function(t,e){var i,a,n,r;return void 0===e&&(e="x"),n=window.getComputedStyle(t,null),window.WebKitCSSMatrix?r=new WebKitCSSMatrix("none"===n.webkitTransform?"":n.webkitTransform):i=(r=n.MozTransform||n.transform||n.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,")).toString().split(","),"x"===e&&(a=window.WebKitCSSMatrix?r.m41:16===i.length?parseFloat(i[12]):parseFloat(i[4])),"y"===e&&(a=window.WebKitCSSMatrix?r.m42:16===i.length?parseFloat(i[13]):parseFloat(i[5])),a||0},t.requestAnimationFrame=function(t){return window.requestAnimationFrame?window.requestAnimationFrame(t):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(t):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(t):window.setTimeout(t,1e3/60)},t.cancelAnimationFrame=function(t){return window.cancelAnimationFrame?window.cancelAnimationFrame(t):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(t):window.mozCancelAnimationFrame?window.mozCancelAnimationFrame(t):window.clearTimeout(t)},t.fn.dataset=function(){var e={},i=this[0].dataset;for(var a in i){var n=e[a]=i[a];"false"===n?e[a]=!1:"true"===n?e[a]=!0:parseFloat(n)===1*n&&(e[a]=1*n)}return t.extend({},e,this[0].__eleData)},t.fn.data=function(e,i){var a=t(this).dataset();if(!e)return a;if(void 0===i){var n=a[e],r=this[0].__eleData;return r&&e in r?r[e]:n}for(var s=0;s<this.length;s++){var o=this[s];e in a&&delete o.dataset[e],o.__eleData||(o.__eleData={}),o.__eleData[e]=i}return this},t.fn.animationEnd=function(t){return e.call(this,["webkitAnimationEnd","animationend"],t),this},t.fn.transitionEnd=function(t){return e.call(this,["webkitTransitionEnd","transitionend"],t),this},t.fn.transition=function(t){"string"!=typeof t&&(t+="ms");for(var e=0;e<this.length;e++){var i=this[e].style;i.webkitTransitionDuration=i.MozTransitionDuration=i.transitionDuration=t}return this},t.fn.transform=function(t){for(var e=0;e<this.length;e++){var i=this[e].style;i.webkitTransform=i.MozTransform=i.transform=t}return this},t.fn.prevAll=function(e){var i=[],a=this[0];if(!a)return t([]);for(;a.previousElementSibling;){var n=a.previousElementSibling;e?t(n).is(e)&&i.push(n):i.push(n),a=n}return t(i)},t.fn.nextAll=function(e){var i=[],a=this[0];if(!a)return t([]);for(;a.nextElementSibling;){var n=a.nextElementSibling;e?t(n).is(e)&&i.push(n):i.push(n),a=n}return t(i)},t.fn.show=function(){function t(t){var i,a;return e[t]||(i=document.createElement(t),document.body.appendChild(i),a=getComputedStyle(i,"").getPropertyValue("display"),i.parentNode.removeChild(i),"none"===a&&(a="block"),e[t]=a),e[t]}var e={};return this.each(function(){"none"===this.style.display&&(this.style.display=""),getComputedStyle(this,"").getPropertyValue("display"),this.style.display=t(this.nodeName)})}}(Zepto),function(){"use strict";function t(e,a){var n;if(a=a||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=a.touchBoundary||10,this.layer=e,this.tapDelay=a.tapDelay||200,this.tapTimeout=a.tapTimeout||700,!t.notNeeded(e)){for(var r=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],s=this,o=0,l=r.length;o<l;o++)s[r[o]]=function(t,e){return function(){return t.apply(e,arguments)}}(s[r[o]],s);i&&(e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0)),e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,i,a){var n=Node.prototype.removeEventListener;"click"===t?n.call(e,t,i.hijacked||i,a):n.call(e,t,i,a)},e.addEventListener=function(t,i,a){var n=Node.prototype.addEventListener;"click"===t?n.call(e,t,i.hijacked||(i.hijacked=function(t){t.propagationStopped||i(t)}),a):n.call(e,t,i,a)}),"function"==typeof e.onclick&&(n=e.onclick,e.addEventListener("click",function(t){n(t)},!1),e.onclick=null)}}var e=navigator.userAgent.indexOf("Windows Phone")>=0,i=navigator.userAgent.indexOf("Android")>0&&!e,a=/iP(ad|hone|od)/.test(navigator.userAgent)&&!e,n=a&&/OS 4_\d(_\d)?/.test(navigator.userAgent),r=a&&/OS [6-7]_\d/.test(navigator.userAgent),s=navigator.userAgent.indexOf("BB10")>0,o=!1;t.prototype.needsClick=function(t){for(var e=t;e&&"BODY"!==e.tagName.toUpperCase();){if("LABEL"===e.tagName.toUpperCase()&&(o=!0,/\bneedsclick\b/.test(e.className)))return!0;e=e.parentNode}switch(t.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(t.disabled)return!0;break;case"input":if(a&&"file"===t.type||t.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(t.className)},t.prototype.needsFocus=function(t){switch(t.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!i;case"input":switch(t.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!t.disabled&&!t.readOnly;default:return/\bneedsfocus\b/.test(t.className)}},t.prototype.sendClick=function(t,e){var i,a;document.activeElement&&document.activeElement!==t&&document.activeElement.blur(),a=e.changedTouches[0],(i=document.createEvent("MouseEvents")).initMouseEvent(this.determineEventType(t),!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,0,null),i.forwardedTouchEvent=!0,t.dispatchEvent(i)},t.prototype.determineEventType=function(t){return i&&"select"===t.tagName.toLowerCase()?"mousedown":"click"},t.prototype.focus=function(t){var e,i=["date","time","month","number","email"];a&&t.setSelectionRange&&-1===i.indexOf(t.type)?(e=t.value.length,t.setSelectionRange(e,e)):t.focus()},t.prototype.updateScrollParent=function(t){var e,i;if(!(e=t.fastClickScrollParent)||!e.contains(t)){i=t;do{if(i.scrollHeight>i.offsetHeight){e=i,t.fastClickScrollParent=i;break}i=i.parentElement}while(i)}e&&(e.fastClickLastScrollTop=e.scrollTop)},t.prototype.getTargetElementFromEventTarget=function(t){return t.nodeType===Node.TEXT_NODE?t.parentNode:t},t.prototype.onTouchStart=function(t){var e,i,r;if(t.targetTouches.length>1)return!0;if(e=this.getTargetElementFromEventTarget(t.target),i=t.targetTouches[0],e.isContentEditable)return!0;if(a){if((r=window.getSelection()).rangeCount&&!r.isCollapsed)return!0;if(!n){if(i.identifier&&i.identifier===this.lastTouchIdentifier)return t.preventDefault(),!1;this.lastTouchIdentifier=i.identifier,this.updateScrollParent(e)}}return this.trackingClick=!0,this.trackingClickStart=t.timeStamp,this.targetElement=e,this.touchStartX=i.pageX,this.touchStartY=i.pageY,t.timeStamp-this.lastClickTime<this.tapDelay&&t.preventDefault(),!0},t.prototype.touchHasMoved=function(t){var e=t.changedTouches[0],i=this.touchBoundary;return Math.abs(e.pageX-this.touchStartX)>i||Math.abs(e.pageY-this.touchStartY)>i},t.prototype.onTouchMove=function(t){return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(t.target)||this.touchHasMoved(t))&&(this.trackingClick=!1,this.targetElement=null),!0)},t.prototype.findControl=function(t){return void 0!==t.control?t.control:t.htmlFor?document.getElementById(t.htmlFor):t.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},t.prototype.onTouchEnd=function(t){var e,s,o,l,c,h=this.targetElement;if(!this.trackingClick)return!0;if(t.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(t.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(-1!==["date","time","month"].indexOf(t.target.type))return!1;if(this.cancelNextClick=!1,this.lastClickTime=t.timeStamp,s=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,r&&(c=t.changedTouches[0],(h=document.elementFromPoint(c.pageX-window.pageXOffset,c.pageY-window.pageYOffset)||h).fastClickScrollParent=this.targetElement.fastClickScrollParent),"label"===(o=h.tagName.toLowerCase())){if(e=this.findControl(h)){if(this.focus(h),i)return!1;h=e}}else if(this.needsFocus(h))return t.timeStamp-s>100||a&&window.top!==window&&"input"===o?(this.targetElement=null,!1):(this.focus(h),this.sendClick(h,t),a&&"select"===o||(this.targetElement=null,t.preventDefault()),!1);return!(!a||n||!(l=h.fastClickScrollParent)||l.fastClickLastScrollTop===l.scrollTop)||(this.needsClick(h)||(t.preventDefault(),this.sendClick(h,t)),!1)},t.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},t.prototype.onMouse=function(t){return!this.targetElement||(!!t.forwardedTouchEvent||(!t.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(t.stopImmediatePropagation?t.stopImmediatePropagation():t.propagationStopped=!0,t.stopPropagation(),o||t.preventDefault(),!1))))},t.prototype.onClick=function(t){var e;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===t.target.type&&0===t.detail||((e=this.onMouse(t))||(this.targetElement=null),e)},t.prototype.destroy=function(){var t=this.layer;i&&(t.removeEventListener("mouseover",this.onMouse,!0),t.removeEventListener("mousedown",this.onMouse,!0),t.removeEventListener("mouseup",this.onMouse,!0)),t.removeEventListener("click",this.onClick,!0),t.removeEventListener("touchstart",this.onTouchStart,!1),t.removeEventListener("touchmove",this.onTouchMove,!1),t.removeEventListener("touchend",this.onTouchEnd,!1),t.removeEventListener("touchcancel",this.onTouchCancel,!1)},t.notNeeded=function(t){var e,a,n;if(void 0===window.ontouchstart)return!0;if(a=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!i)return!0;if(e=document.querySelector("meta[name=viewport]")){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(a>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(s&&(n=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/))[1]>=10&&n[2]>=3&&(e=document.querySelector("meta[name=viewport]"))){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===t.style.msTouchAction||"manipulation"===t.style.touchAction||(!!(+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]>=27&&(e=document.querySelector("meta[name=viewport]"))&&(-1!==e.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))||"none"===t.style.touchAction||"manipulation"===t.style.touchAction)},t.attach=function(e,i){return new t(e,i)},window.FastClick=t}();var FormulaCalc=function(){function t(){this.yy={}}var e=function(t,e,i,a){for(i=i||{},a=t.length;a--;i[t[a]]=e);return i},i=[1,5],a=[1,4],n=[1,3],r=[1,6],s=[1,7],o=[1,8],l=[1,9],c=[1,10],h=[1,11],u=[1,12],d=[1,13],p=[1,15],f=[1,16],m=[1,17],g=[1,18],v=[1,19],y=[1,20],M=[1,21],F=[1,22],_=[1,23],T=[5,6,7,8,9,10,12,13,14,15,17,18,26],b=[2,25],x=[1,43],C=[17,18,26],w=[17,18],E=[5,6,7,10,12,13,14,15,17,18,26],A=[1,47],X=[1,51],S=[5,6,7,8,9,10,12,13,14,15,17,18,25,26],I={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"+":6,"-":7,"*":8,"/":9,COMPARE_OP:10,"!":11,"&&":12,"||":13,"&":14,"|":15,"(":16,")":17,",":18,args:19,NUMBER:20,STRING:21,BOOLEAN:22,EMPTY:23,NaN:24,"[":25,"]":26,index:27,FUNC:28,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"+",7:"-",8:"*",9:"/",10:"COMPARE_OP",11:"!",12:"&&",13:"||",14:"&",15:"|",16:"(",17:")",18:",",20:"NUMBER",21:"STRING",22:"BOOLEAN",23:"EMPTY",24:"NaN",25:"[",26:"]",28:"FUNC"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,2],[4,3],[4,3],[4,3],[4,3],[4,2],[4,2],[4,3],[4,5],[4,1],[4,1],[4,1],[4,1],[4,1],[4,3],[4,4],[4,4],[4,5],[19,0],[19,1],[19,2],[19,3],[27,3],[27,4]],performAction:function(t,e,i,a,n,r,s){var o=r.length-1;switch(n){case 1:return void 0===r[o-1]?null:r[o-1];case 2:this.$=FXM.FormulaCalcParser.evalExpression("+",r[o-2],r[o]);break;case 3:this.$=FXM.FormulaCalcParser.evalExpression("-",r[o-2],r[o]);break;case 4:this.$=FXM.FormulaCalcParser.evalExpression("*",r[o-2],r[o]);break;case 5:this.$=FXM.FormulaCalcParser.evalExpression("/",r[o-2],r[o]);break;case 6:this.$=FXM.FormulaCalcParser.evalExpression(r[o-1],r[o-2],r[o]);break;case 7:this.$=FXM.FormulaCalcParser.evalExpression("!",r[o]);break;case 8:this.$=FXM.FormulaCalcParser.evalExpression("&&",r[o-2],r[o]);break;case 9:this.$=FXM.FormulaCalcParser.evalExpression("||",r[o-2],r[o]);break;case 10:this.$=FXM.FormulaCalcParser.evalExpression("&",r[o-2],r[o]);break;case 11:this.$=FXM.FormulaCalcParser.evalExpression("|",r[o-2],r[o]);break;case 12:this.$=-r[o];break;case 13:this.$=+r[o];break;case 14:case 21:this.$=r[o-1];break;case 15:this.$=r[o-1].slice(-1)[0];break;case 16:this.$=Number(r[o]);break;case 17:this.$=r[o].substring(1,r[o].length-1);break;case 18:this.$="true"===r[o];break;case 19:this.$=null;break;case 20:this.$=NaN;break;case 22:l=r[o-2];FXM.Utils.forEach(r[o],function(t,e){l=l[e]}),this.$=l;break;case 23:this.$=FXM.FormulaCalcParser.applyFunc(r[o-3],r[o-1]);break;case 24:var l=FXM.FormulaCalcParser.applyFunc(r[o-4],r[o-2]);FXM.Utils.forEach(r[o],function(t,e){l=l[e]}),this.$=l;break;case 25:this.$=[];break;case 26:this.$=[r[o]];break;case 27:r[o-1].push(void 0),this.$=r[o-1];break;case 28:r[o-2].push(r[o]),this.$=r[o-2];break;case 29:this.$=[].concat(r[o-1]);break;case 30:r[o-3].push(r[o-1]),this.$=r[o-3]}},table:[{3:1,4:2,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{1:[3]},{5:[1,14],6:p,7:f,8:m,9:g,10:v,12:y,13:M,14:F,15:_},{4:24,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{4:25,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{4:26,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{4:27,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},e(T,[2,16]),e(T,[2,17]),e(T,[2,18]),e(T,[2,19]),e(T,[2,20]),e([18,26],b,{19:28,4:29,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d}),{16:[1,30]},{1:[2,1]},{4:31,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{4:32,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{4:33,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{4:34,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{4:35,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{4:36,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{4:37,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{4:38,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{4:39,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},e(T,[2,7]),e(T,[2,12]),e(T,[2,13]),{6:p,7:f,8:m,9:g,10:v,12:y,13:M,14:F,15:_,17:[1,40],18:[1,41]},{18:x,26:[1,42]},e(C,[2,26],{6:p,7:f,8:m,9:g,10:v,12:y,13:M,14:F,15:_}),e(w,b,{4:29,19:44,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d}),e(E,[2,2],{8:m,9:g}),e(E,[2,3],{8:m,9:g}),e(T,[2,4]),e(T,[2,5]),e([5,10,12,13,14,15,17,18,26],[2,6],{6:p,7:f,8:m,9:g}),e([5,12,13,17,18,26],[2,8],{6:p,7:f,8:m,9:g,10:v,14:F,15:_}),e([5,13,17,18,26],[2,9],{6:p,7:f,8:m,9:g,10:v,12:y,14:F,15:_}),e([5,12,13,14,15,17,18,26],[2,10],{6:p,7:f,8:m,9:g,10:v}),e([5,12,13,15,17,18,26],[2,11],{6:p,7:f,8:m,9:g,10:v,14:F}),e(T,[2,14]),e(w,b,{4:29,19:45,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d}),e(T,[2,21],{27:46,25:A}),e(C,[2,27],{4:48,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d}),{17:[1,49],18:x},{17:[1,50],18:x},e(T,[2,22],{25:X}),{4:52,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},e(C,[2,28],{6:p,7:f,8:m,9:g,10:v,12:y,13:M,14:F,15:_}),e(T,[2,23],{27:53,25:A}),e(T,[2,15]),{4:54,6:i,7:a,11:n,16:r,20:s,21:o,22:l,23:c,24:h,25:u,28:d},{6:p,7:f,8:m,9:g,10:v,12:y,13:M,14:F,15:_,26:[1,55]},e(T,[2,24],{25:X}),{6:p,7:f,8:m,9:g,10:v,12:y,13:M,14:F,15:_,26:[1,56]},e(S,[2,29]),e(S,[2,30])],defaultActions:{14:[2,1]},parseError:function(t,e){if(!e.recoverable){var i=new Error(t);throw i.hash=e,i}this.trace(t)},parse:function(t){var e=this,i=[0],a=[null],n=[],r=this.table,s="",o=0,l=0,c=0,h=n.slice.call(arguments,1),u=Object.create(this.lexer),d={yy:{}};for(var p in this.yy)Object.prototype.hasOwnProperty.call(this.yy,p)&&(d.yy[p]=this.yy[p]);u.setInput(t,d.yy),d.yy.lexer=u,d.yy.parser=this,void 0===u.yylloc&&(u.yylloc={});var f=u.yylloc;n.push(f);var m=u.options&&u.options.ranges;"function"==typeof d.yy.parseError?this.parseError=d.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var g,v,y,M,F,_,T,b,x,C=function(){var t;return"number"!=typeof(t=u.lex()||1)&&(t=e.symbols_[t]||t),t},w={};;){if(y=i[i.length-1],this.defaultActions[y]?M=this.defaultActions[y]:(null!==g&&void 0!==g||(g=C()),M=r[y]&&r[y][g]),void 0===M||!M.length||!M[0]){var E="";x=[];for(_ in r[y])this.terminals_[_]&&_>2&&x.push("'"+this.terminals_[_]+"'");E=u.showPosition?"Parse error on line "+(o+1)+":\n"+u.showPosition()+"\nExpecting "+x.join(", ")+", got '"+(this.terminals_[g]||g)+"'":"Parse error on line "+(o+1)+": Unexpected "+(1==g?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(E,{text:u.match,token:this.terminals_[g]||g,line:u.yylineno,loc:f,expected:x})}if(M[0]instanceof Array&&M.length>1)throw new Error("Parse Error: multiple actions possible at state: "+y+", token: "+g);switch(M[0]){case 1:i.push(g),a.push(u.yytext),n.push(u.yylloc),i.push(M[1]),g=null,v?(g=v,v=null):(l=u.yyleng,s=u.yytext,o=u.yylineno,f=u.yylloc,c>0&&c--);break;case 2:if(T=this.productions_[M[1]][1],w.$=a[a.length-T],w._$={first_line:n[n.length-(T||1)].first_line,last_line:n[n.length-1].last_line,first_column:n[n.length-(T||1)].first_column,last_column:n[n.length-1].last_column},m&&(w._$.range=[n[n.length-(T||1)].range[0],n[n.length-1].range[1]]),void 0!==(F=this.performAction.apply(w,[s,l,o,d.yy,M[1],a,n].concat(h))))return F;T&&(i=i.slice(0,-1*T*2),a=a.slice(0,-1*T),n=n.slice(0,-1*T)),i.push(this.productions_[M[1]][0]),a.push(w.$),n.push(w._$),b=r[i[i.length-2]][i[i.length-1]],i.push(b);break;case 3:return!0}}return!0}},k={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var n=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===a.length?this.yylloc.first_column:0)+a[a.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var i,a,n;if(this.options.backtrack_lexer&&(n={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(n.yylloc.range=this.yylloc.range.slice(0))),(a=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=a.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:a?a[a.length-1].length-a[a.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],i=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var r in n)this[r]=n[r];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,i,a;this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),r=0;r<n.length;r++)if((i=this._input.match(this.rules[n[r]]))&&(!e||i[0].length>e[0].length)){if(e=i,a=r,this.options.backtrack_lexer){if(!1!==(t=this.test_match(i,n[r])))return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?!1!==(t=this.test_match(e,n[a]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return(t=this.conditionStack.length-1-Math.abs(t||0))>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,i,a){switch(i){case 0:break;case 1:return 20;case 2:case 3:return 21;case 4:return 22;case 5:return 28;case 6:return 10;case 7:return 11;case 8:return 12;case 9:return 13;case 10:return 14;case 11:return 15;case 12:return 8;case 13:return 9;case 14:return 7;case 15:return 6;case 16:return 25;case 17:return 26;case 18:return 16;case 19:return 17;case 20:return 18;case 21:return 23;case 22:return 24;case 23:return 5;case 24:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:[0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?\b)/,/^(?:"(\\\\|\\"|[^"])*")/,/^(?:'(\\\\|\\'|[^'])*')/,/^(?:(true|false))/,/^(?:[A-Za-z0-9]+(?=\s*\())/,/^(?:(===|!==|>=|<=|==|!=|>|<))/,/^(?:!)/,/^(?:&&)/,/^(?:\|\|)/,/^(?:&)/,/^(?:\|)/,/^(?:\*)/,/^(?:\/)/,/^(?:-)/,/^(?:\+)/,/^(?:\[)/,/^(?:\])/,/^(?:\()/,/^(?:\))/,/^(?:,)/,/^(?:(null|undefined))/,/^(?:NaN\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],inclusive:!0}}};return I.lexer=k,t.prototype=I,I.Parser=t,new t}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=FormulaCalc,exports.Parser=FormulaCalc.Parser,exports.parse=function(){return FormulaCalc.parse.apply(FormulaCalc,arguments)},exports.main=function(t){t[1]||(console.log("Usage: "+t[0]+" FILE"),process.exit(1));var e=require("fs").readFileSync(require("path").normalize(t[1]),"utf8");return exports.parser.parse(e)},"undefined"!=typeof module&&require.main===module&&exports.main(process.argv.slice(1))),function(t){"use strict";function e(){function t(a){var n=this;if(!(n instanceof t))return a===g?e():new t(a);a instanceof t?(n.s=a.s,n.e=a.e,n.c=a.c.slice()):i(n,a),n.constructor=t}return t.prototype=m,t.DP=s,t.RM=o,t.NE=c,t.PE=h,t.version="5.0.2",t}function i(t,e){var i,a,n;if(0===e&&1/e<0)e="-0";else if(!v.test(e+=""))throw Error(d+"number");for(t.s="-"==e.charAt(0)?(e=e.slice(1),-1):1,(i=e.indexOf("."))>-1&&(e=e.replace(".","")),(a=e.search(/e/i))>0?(i<0&&(i=a),i+=+e.slice(a+1),e=e.substring(0,a)):i<0&&(i=e.length),n=e.length,a=0;a<n&&"0"==e.charAt(a);)++a;if(a==n)t.c=[t.e=0];else{for(;n>0&&"0"==e.charAt(--n););for(t.e=i-a-1,t.c=[],i=0;a<=n;)t.c[i++]=+e.charAt(a++)}return t}function a(t,e,i,a){var n=t.c,r=t.e+e+1;if(r<n.length){if(1===i)a=n[r]>=5;else if(2===i)a=n[r]>5||5==n[r]&&(a||r<0||n[r+1]!==g||1&n[r-1]);else if(3===i)a=a||n[r]!==g||r<0;else if(a=!1,0!==i)throw Error(f);if(r<1)n.length=1,a?(t.e=-e,n[0]=1):n[0]=t.e=0;else{if(n.length=r--,a)for(;++n[r]>9;)n[r]=0,r--||(++t.e,n.unshift(1));for(r=n.length;!n[--r];)n.pop()}}else if(i<0||i>3||i!==~~i)throw Error(f);return t}function n(t,e,i,n){var r,s,o=t.constructor,c=!t.c[0];if(i!==g){if(i!==~~i||i<(3==e)||i>l)throw Error(3==e?d+"precision":p);for(i=n-(t=new o(t)).e,t.c.length>++n&&a(t,i,o.RM),2==e&&(n=t.e+i+1);t.c.length<n;)t.c.push(0)}if(r=t.e,s=t.c.join(""),i=s.length,2!=e&&(1==e||3==e&&n<=r||r<=o.NE||r>=o.PE))s=s.charAt(0)+(i>1?"."+s.slice(1):"")+(r<0?"e":"e+")+r;else if(r<0){for(;++r;)s="0"+s;s="0."+s}else if(r>0)if(++r>i)for(r-=i;r--;)s+="0";else r<i&&(s=s.slice(0,r)+"."+s.slice(r));else i>1&&(s=s.charAt(0)+"."+s.slice(1));return t.s<0&&(!c||4==e)?"-"+s:s}var r,s=20,o=1,l=1e6,c=-7,h=21,u="[big.js] ",d=u+"Invalid ",p=d+"decimal places",f=d+"rounding mode",m={},g=void 0,v=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;m.abs=function(){var t=new this.constructor(this);return t.s=1,t},m.cmp=function(t){var e,i=this,a=i.c,n=(t=new i.constructor(t)).c,r=i.s,s=t.s,o=i.e,l=t.e;if(!a[0]||!n[0])return a[0]?r:n[0]?-s:0;if(r!=s)return r;if(e=r<0,o!=l)return o>l^e?1:-1;for(s=(o=a.length)<(l=n.length)?o:l,r=-1;++r<s;)if(a[r]!=n[r])return a[r]>n[r]^e?1:-1;return o==l?0:o>l^e?1:-1},m.div=function(t){var e=this,i=e.constructor,n=e.c,r=(t=new i(t)).c,s=e.s==t.s?1:-1,o=i.DP;if(o!==~~o||o<0||o>l)throw Error(p);if(!r[0])throw Error("[big.js] Division by zero");if(!n[0])return new i(0*s);var c,h,u,d,f,m=r.slice(),v=c=r.length,y=n.length,M=n.slice(0,c),F=M.length,_=t,T=_.c=[],b=0,x=o+(_.e=e.e-t.e)+1;for(_.s=s,s=x<0?0:x,m.unshift(0);F++<c;)M.push(0);do{for(u=0;u<10;u++){if(c!=(F=M.length))d=c>F?1:-1;else for(f=-1,d=0;++f<c;)if(r[f]!=M[f]){d=r[f]>M[f]?1:-1;break}if(!(d<0))break;for(h=F==c?r:m;F;){if(M[--F]<h[F]){for(f=F;f&&!M[--f];)M[f]=9;--M[f],M[F]+=10}M[F]-=h[F]}for(;!M[0];)M.shift()}T[b++]=d?u:++u,M[0]&&d?M[F]=n[v]||0:M=[n[v]]}while((v++<y||M[0]!==g)&&s--);return T[0]||1==b||(T.shift(),_.e--),b>x&&a(_,o,i.RM,M[0]!==g),_},m.eq=function(t){return!this.cmp(t)},m.gt=function(t){return this.cmp(t)>0},m.gte=function(t){return this.cmp(t)>-1},m.lt=function(t){return this.cmp(t)<0},m.lte=function(t){return this.cmp(t)<1},m.minus=m.sub=function(t){var e,i,a,n,r=this,s=r.constructor,o=r.s,l=(t=new s(t)).s;if(o!=l)return t.s=-l,r.plus(t);var c=r.c.slice(),h=r.e,u=t.c,d=t.e;if(!c[0]||!u[0])return u[0]?(t.s=-l,t):new s(c[0]?r:0);if(o=h-d){for((n=o<0)?(o=-o,a=c):(d=h,a=u),a.reverse(),l=o;l--;)a.push(0);a.reverse()}else for(i=((n=c.length<u.length)?c:u).length,o=l=0;l<i;l++)if(c[l]!=u[l]){n=c[l]<u[l];break}if(n&&(a=c,c=u,u=a,t.s=-t.s),(l=(i=u.length)-(e=c.length))>0)for(;l--;)c[e++]=0;for(l=e;i>o;){if(c[--i]<u[i]){for(e=i;e&&!c[--e];)c[e]=9;--c[e],c[i]+=10}c[i]-=u[i]}for(;0===c[--l];)c.pop();for(;0===c[0];)c.shift(),--d;return c[0]||(t.s=1,c=[d=0]),t.c=c,t.e=d,t},m.mod=function(t){var e,i=this,a=i.constructor,n=i.s,r=(t=new a(t)).s;if(!t.c[0])throw Error("[big.js] Division by zero");return i.s=t.s=1,e=1==t.cmp(i),i.s=n,t.s=r,e?new a(i):(n=a.DP,r=a.RM,a.DP=a.RM=0,i=i.div(t),a.DP=n,a.RM=r,this.minus(i.times(t)))},m.plus=m.add=function(t){var e,i=this,a=i.constructor,n=i.s,r=(t=new a(t)).s;if(n!=r)return t.s=-r,i.minus(t);var s=i.e,o=i.c,l=t.e,c=t.c;if(!o[0]||!c[0])return c[0]?t:new a(o[0]?i:0*n);if(o=o.slice(),n=s-l){for(n>0?(l=s,e=c):(n=-n,e=o),e.reverse();n--;)e.push(0);e.reverse()}for(o.length-c.length<0&&(e=c,c=o,o=e),n=c.length,r=0;n;o[n]%=10)r=(o[--n]=o[n]+c[n]+r)/10|0;for(r&&(o.unshift(r),++l),n=o.length;0===o[--n];)o.pop();return t.c=o,t.e=l,t},m.pow=function(t){var e=this,i=new e.constructor(1),a=i,n=t<0;if(t!==~~t||t<-1e6||t>1e6)throw Error(d+"exponent");for(n&&(t=-t);1&t&&(a=a.times(e)),t>>=1;)e=e.times(e);return n?i.div(a):a},m.round=function(t,e){var i=this.constructor;if(t===g)t=0;else if(t!==~~t||t<0||t>l)throw Error(p);return a(new i(this),t,e===g?i.RM:e)},m.sqrt=function(){var t,e,i,n=this,r=n.constructor,s=n.s,o=n.e,l=new r(.5);if(!n.c[0])return new r(n);if(s<0)throw Error(u+"No square root");0===(s=Math.sqrt(n.toString()))||s===1/0?((e=n.c.join("")).length+o&1||(e+="0"),(t=new r(Math.sqrt(e).toString())).e=((o+1)/2|0)-(o<0||1&o)):t=new r(s.toString()),o=t.e+(r.DP+=4);do{i=t,t=l.times(i.plus(n.div(i)))}while(i.c.slice(0,o).join("")!==t.c.slice(0,o).join(""));return a(t,r.DP-=4,r.RM)},m.times=m.mul=function(t){var e,i=this,a=i.constructor,n=i.c,r=(t=new a(t)).c,s=n.length,o=r.length,l=i.e,c=t.e;if(t.s=i.s==t.s?1:-1,!n[0]||!r[0])return new a(0*t.s);for(t.e=l+c,s<o&&(e=n,n=r,r=e,c=s,s=o,o=c),e=new Array(c=s+o);c--;)e[c]=0;for(l=o;l--;){for(o=0,c=s+l;c>l;)o=e[c]+r[l]*n[c-l-1]+o,e[c--]=o%10,o=o/10|0;e[c]=(e[c]+o)%10}for(o?++t.e:e.shift(),l=e.length;!e[--l];)e.pop();return t.c=e,t},m.toExponential=function(t){return n(this,1,t,t)},m.toFixed=function(t){return n(this,2,t,this.e+t)},m.toPrecision=function(t){return n(this,3,t,t-1)},m.toString=function(){return n(this)},m.valueOf=m.toJSON=function(){return n(this,4)},(r=e()).default=r.Big=r,"function"==typeof define&&define.amd?define(function(){return r}):"undefined"!=typeof module&&module.exports?module.exports=r:t.Big=r}(this),function(t){function e(){return""===c.hash||"#"===c.hash}function i(t,e){for(var i=0;i<t.length;i+=1)if(!1===e(t[i],i,t))return}function a(t){for(var e=[],i=0,a=t.length;i<a;i++)e=e.concat(t[i]);return e}function n(t,e,i){if(!t.length)return i();var a=0;!function n(){e(t[a],function(e){e||!1===e?(i(e),i=function(){}):(a+=1)===t.length?i():n()})}()}function r(t,e,i){i=t;for(var a in e)if(e.hasOwnProperty(a)&&(i=e[a](t))!==t)break;return i===t?"([._a-zA-Z0-9-%()]+)":i}function o(t,e){for(var i,a=0,n="";i=t.substr(a).match(/[^\w\d\- %@&]*\*[^\w\d\- %@&]*/);)a=i.index+i[0].length,i[0]=i[0].replace(/^\*/,"([_.()!\\ %@&a-zA-Z0-9-]+)"),n+=t.substr(0,i.index)+i[0];var s,o,l=(t=n+=t.substr(a)).match(/:([^\/]+)/gi);if(l){o=l.length;for(var c=0;c<o;c++)t="::"===(s=l[c]).slice(0,2)?s.slice(1):t.replace(s,r(s,e))}return t}function l(t,e,i,a){var n,r=0,s=0,o=0,i=(i||"(").toString(),a=(a||")").toString();for(n=0;n<t.length;n++){var l=t[n];l.indexOf(i,r)>l.indexOf(a,r)||~l.indexOf(i,r)&&!~l.indexOf(a,r)||!~l.indexOf(i,r)&&~l.indexOf(a,r)?(s=l.indexOf(i,r),o=l.indexOf(a,r),(~s&&!~o||!~s&&~o)&&(t=[t.slice(0,(n||1)+1).join(e)].concat(t.slice((n||1)+1))),r=(o>s?o:s)+1,n=0):r=0}return t}var c=document.location,h={hash:c.hash,init:function(t){u.listeners||(u.listeners=[]),window.addEventListener("hashchange",function(t){for(var e=0,i=u.listeners.length;e<i;e++)u.listeners[e](t)}),u.listeners.push(t)},destroy:function(t){if(u&&u.listeners)for(var e=u.listeners,i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)},setHash:function(t){return c.hash="/"===t[0]?t:"/"+t,this}},u=t.Router=function(t){if(!(this instanceof u))return new u(t);this.params={},this.routes={},this.methods=["on","once","after","before"],this.scope=[],this._methods={},this.pageLen=1,this._insert=this.insert,this.insert=this.insertEx,this.historySupport=null!=(null!=window.history?window.history.pushState:null),this.configure(),this.mount(t||{})};u.prototype.init=function(t){var i=this;return this.handler=function(t){var e=(t&&t.newURL||window.location.hash).replace(/.*#/,"");i.dispatch("on","/"===e.charAt(0)?e:"/"+e)},h.init(this.handler),e()&&t?c.hash=t:e()||i.dispatch("on","/"+c.hash.replace(/^(#\/|#|\/)/,"")),this},u.prototype.explode=function(){var t=c.hash;return"/"===t.charAt(1)&&(t=t.slice(1)),t.slice(1,t.length).split("/")},u.prototype.setRoute=function(t,e,i){var a=this.explode();return"number"==typeof t&&"string"==typeof e?a[t]=e:"string"==typeof i?a.splice(t,e,s):a=[t],this.pageLen++,h.setHash(a.join("/")),a},u.prototype.insertEx=function(t,e,i,a){return"once"===t&&(t="on",i=function(t){var e=!1;return function(){if(!e)return e=!0,t.apply(this,arguments)}}(i)),this._insert(t,e,i,a)},u.prototype.getRoute=function(t){return"number"==typeof t?this.explode()[t]:"string"==typeof t?this.explode().indexOf(t):this.explode()},u.prototype.destroy=function(){return h.destroy(this.handler),this},u.prototype.getPath=function(){var t=window.location.pathname;return"/"!==t.substr(0,1)&&(t="/"+t),t},u.prototype.back=function(t){var e=this;this.pageLen?(window.history.back(),this.pageLen--):setTimeout(function(){e.setRoute(t)})},u.prototype.reload=function(){for(var t=0,e=u.listeners.length;t<e;t++)u.listeners[t]()};var d=/\?.*/;u.prototype.configure=function(t){t=t||{};for(var e=0;e<this.methods.length;e++)this._methods[this.methods[e]]=!0;return this.recurse=t.recurse||this.recurse||!1,this.async=t.async||!1,this.delimiter=t.delimiter||"/",this.strict=void 0===t.strict||t.strict,this.notfound=t.notfound,this.resource=t.resource,this.run_in_init=!1,this.convert_hash_in_init=!1,this.every={after:t.after||null,before:t.before||null,on:t.on||null},this},u.prototype.param=function(t,e){":"!==t[0]&&(t=":"+t);var i=new RegExp(t,"g");return this.params[t]=function(t){return t.replace(i,e.source||e)},this},u.prototype.on=u.prototype.route=function(t,e,i){var a=this;return i||"function"!=typeof e||(i=e,e=t,t="on"),Array.isArray(e)?e.forEach(function(e){a.on(t,e,i)}):(e.source&&(e=e.source.replace(/\\\//gi,"/")),Array.isArray(t)?t.forEach(function(t){a.on(t.toLowerCase(),e,i)}):(e=e.split(new RegExp(this.delimiter)),e=l(e,this.delimiter),void this.insert(t,this.scope.concat(e),i)))},u.prototype.path=function(t,e){var i=this.scope.length;t.source&&(t=t.source.replace(/\\\//gi,"/")),t=l(t=t.split(new RegExp(this.delimiter)),this.delimiter),this.scope=this.scope.concat(t),e.call(this,this),this.scope.splice(i,t.length)},u.prototype.dispatch=function(t,e,i){function a(){r.last=s.after,r.invoke(r.runlist(s),r,i)}var n,r=this,s=this.traverse(t,e.replace(d,""),this.routes,""),o=this._invoked;return this._invoked=!0,s&&0!==s.length?("forward"===this.recurse&&(s=s.reverse()),(n=this.every&&this.every.after?[this.every.after].concat(this.last):[this.last])&&n.length>0&&o?(this.async?this.invoke(n,this,a):(this.invoke(n,this),a()),!0):(a(),!0)):(this.last=[],"function"==typeof this.notfound&&this.invoke([this.notfound],{method:t,path:e},i),!1)},u.prototype.invoke=function(t,e,a){var r,s=this;this.async?n(t,r=function(i,a){if(Array.isArray(i))return n(i,r,a);"function"==typeof i&&i.apply(e,(t.captures||[]).concat(a))},function(){a&&a.apply(e,arguments)}):i(t,r=function(a){return Array.isArray(a)?i(a,r):"function"==typeof a?a.apply(e,t.captures||[]):void("string"==typeof a&&s.resource&&s.resource[a].apply(e,t.captures||[]))})},u.prototype.traverse=function(t,e,i,a,n){function r(t){function e(t){for(var i=[],a=0;a<t.length;a++)i[a]=Array.isArray(t[a])?e(t[a]):t[a];return i}function i(t){for(var e=t.length-1;e>=0;e--)Array.isArray(t[e])?(i(t[e]),0===t[e].length&&t.splice(e,1)):n(t[e])||t.splice(e,1)}if(!n)return t;var a=e(t);return a.matched=t.matched,a.captures=t.captures,a.after=t.after.filter(n),i(a),a}var s,o,l,c,h=[];if(e===this.delimiter&&i[t])return c=[[i.before,i[t]].filter(Boolean)],c.after=[i.after].filter(Boolean),c.matched=!0,c.captures=[],r(c);for(var u in i)if(i.hasOwnProperty(u)&&(!this._methods[u]||this._methods[u]&&"object"==typeof i[u]&&!Array.isArray(i[u]))){if(s=o=a+this.delimiter+u,this.strict||(o+="["+this.delimiter+"]?"),!(l=e.match(new RegExp("^"+o))))continue;if(l[0]&&l[0]==e&&i[u][t])return c=[[i[u].before,i[u][t]].filter(Boolean)],c.after=[i[u].after].filter(Boolean),c.matched=!0,c.captures=l.slice(1),this.recurse&&i===this.routes&&(c.push([i.before,i.on].filter(Boolean)),c.after=c.after.concat([i.after].filter(Boolean))),r(c);if((c=this.traverse(t,e,i[u],s)).matched)return c.length>0&&(h=h.concat(c)),this.recurse&&(h.push([i[u].before,i[u].on].filter(Boolean)),c.after=c.after.concat([i[u].after].filter(Boolean)),i===this.routes&&(h.push([i.before,i.on].filter(Boolean)),c.after=c.after.concat([i.after].filter(Boolean)))),h.matched=!0,h.captures=c.captures,h.after=c.after,r(h)}return!1},u.prototype.insert=function(t,e,i,a){var n,r,s,l;if(e=e.filter(function(t){return t&&t.length>0}),a=a||this.routes,l=e.shift(),/\:|\*/.test(l)&&!/\\d|\\w/.test(l)&&(l=o(l,this.params)),e.length>0)return a[l]=a[l]||{},this.insert(t,e,i,a[l]);if(l||e.length||a!==this.routes){if(n=typeof a[l],r=Array.isArray(a[l]),a[l]&&!r&&"object"==n)switch(typeof a[l][t]){case"function":return void(a[l][t]=[a[l][t],i]);case"object":return void a[l][t].push(i);case"undefined":return void(a[l][t]=i)}else if("undefined"==n)return s={},s[t]=i,void(a[l]=s);throw new Error("Invalid route context: "+n)}switch(typeof a[t]){case"function":return void(a[t]=[a[t],i]);case"object":return void a[t].push(i);case"undefined":return void(a[t]=i)}},u.prototype.extend=function(t){var e,i=this,a=t.length;for(e=0;e<a;e++)!function(t){i._methods[t]=!0,i[t]=function(){var e=1===arguments.length?[t,""]:[t];i.on.apply(i,e.concat(Array.prototype.slice.call(arguments)))}}(t[e])},u.prototype.runlist=function(t){var e=this.every&&this.every.before?[this.every.before].concat(a(t)):a(t);return this.every&&this.every.on&&e.push(this.every.on),e.captures=t.captures,e.source=t.source,e},u.prototype.mount=function(t,e){if(t&&"object"==typeof t&&!Array.isArray(t)){var i=this;e=e||[],Array.isArray(e)||(e=e.split(i.delimiter));for(var a in t)t.hasOwnProperty(a)&&function(e,a){var n=e,r=e.split(i.delimiter),s=typeof t[e],o=""===r[0]||!i._methods[r[0]],c=o?"on":n;if(o&&(n=n.slice((n.match(new RegExp("^"+i.delimiter))||[""])[0].length),r.shift()),o&&"object"===s&&!Array.isArray(t[e]))return a=a.concat(r),void i.mount(t[e],a);o&&(a=l(a=a.concat(n.split(i.delimiter)),i.delimiter)),i.insert(c,a,t[e])}(a,e.slice(0))}}}("object"==typeof exports?exports:window),function(){var t={};window.FXM={GB:{},PG:{},STATIC:{_st:(new Date).getTime(),_ct:(new Date).getTime(),zIndex:8e3,Language:"zh",IDBase:new Date-0,CSRF:$('meta[name="csrf-token"]').attr("content")},register:function(e,i){if(e=e.toLowerCase(),null!=t[e])throw"register: ["+e+"] has been registered";t[e]=i,i.prototype.type=e},createWidget:function(e){var i=e.type.toLowerCase(),a=t[i];if(!a)throw i+" does not exist";return new a(e)},extend:function(t,e){var i=function(){t.apply(this,arguments)},a=function(){},n=t.prototype;return a.prototype=n,i.prototype=new a,i._super=n,$.extend(i.prototype,e),i}},$(function(){FastClick.attach(document.body)})}(),FXM.API={formula:{map:"/data/formula/map",aggregate:"/data/formula/aggregate",recno:"/data/formula/recno"},file:{download:"/dashboard/app/:appid/file_url",upload_token:"/dashboard/app/:appid/upload_token",upload:"/upload",upload_client_file:"/dashboard/app/:appid/upload_client_file"},data:{log_flow:"/data/log/flow_log/list",flow_creators:"/data/flow_creators",flow_change:"/data/flow_change",find:"/data/find",list:"/data/list",query:"/_/data/public_query",read:"/data/read",view:"/data/view",remove:"/data/remove",create:"/data/create",update:"/_/data/update",distinct:"/data/distinct",read_link:"/data/read_link",link:"/data/link",filter:"/data/filter",filter_link:"/data/filter_link",departments:"/data/member/departments",users:"/data/member/users",user_dept_role:"/data/member/dept_role_users",roles:"/data/member/roles",chart_group:"/data/chart_group",combined_group:"/data/combined_group",comment_create:"/data/log/coop_comment/create",comment_list:"/data/log/coop_comment/list",coop_log_list:"/data/log/coop_log/list",current_dept:"/data/member/current_departments",transfer_list:"/data/log/flow_transfer/list",flow_comment_list:"/data/log/flow_comment/list",allow_activate_nodes:"/_/data/allow_activate_nodes",allow_back_nodes:"/_/data/allow_back_nodes",allow_transfer_users:"/_/data/allow_transfer_users",flow_chargers:"/_/data/flow_chargers"},flow:{get_node_fields:"/dashboard/app/:appid/workflow/get_node_fields",stash_data_count:"/dashboard/app/:appid/workflow/stash_data_count",flow_query_data:"/dashboard/app/:appid/workflow/query_data",flow_query_data_count:"/dashboard/app/:appid/workflow/query_data_count",flow_query_menu:"/dashboard/app/:appid/workflow/query_menu",flow_query_node:"/dashboard/app/:appid/workflow/query_node",distinct:"/dashboard/app/:appid/workflow/distinct"},dashboard:{flow_start:"/dashboard/flow_start",flow_todo:"/dashboard/flow_todo",flow_todo_count:"/dashboard/flow_todo_count",apps:"/dashboard/apps",install:"/dashboard/template/install",get_vip_pack:"/dashboard/app/:appid/get_vip_pack",user_corps:"/dashboard/user_corps",switch_corp:"/dashboard/switch_corp",template_list:"/dashboard/template/list"},app:{get:"/_/app/:appId"},entry:{q_password:"/q/:formid/password",f_password:"/f/:formid/password",r_password:"/r/:reportid/password",dash_password:"/dash/:dashid/password",query_content:"/dashboard/app/:appid/form/:formid/query_content"},corp:{list_member_name:"/corp/list_member_name",dingtalk_login:"/dingtalk/corp/:corpid/login"},profile:{persona:"/profile/persona",persona_app_list:"/profile/persona/app_list"},sign:{get_phone:"/auth/phone/get"},form:{get:"/_/app/:appId/form/:formId"},report:{get:"/_/app/:appId/report/:reportId"},dash:{get:"/_/app/:appId/dash/:entryId",combined_group:"/_/data/report/combined_group",list:"/_/data/report/list",distinct:"/_/data/distinct"}},function(){var t=window._jdy_config||{};FXM.CONSTS={CONFIG:{COOKIE_DOMAIN:t.cookie_domain},INVALID_TYPE:{INVALID:1,REGEX:2,BLANK:3,REPEAT:4,OUTSIDE:5,COUNTING:6},SUBMIT_RULE:{KEEP:1,NULL:2,ALWAYS:3},VALUE_WIDGETS:{text:1,number:1,textarea:1,datetime:1,checkboxgroup:1,radiogroup:1,combo:1,combocheck:1,address:1,image:1,upload:1,subform:1,user:1,usergroup:1,dept:1,deptgroup:1,location:1,linkdata:1,signature:1},WIDGET_VALUE_OPTION:{CUSTOM:0,ASYNC:1,RELY:2,FORMULA:3},USER_ID:{CurrentUser:"100000000000000000000001",SYS_ROBOT:"100000000000000000000002"},DEPT_ID:{CURRENT:"110000000000000000000001"},FLOW_COUNT_MAX:999,DATA_PREFIX:{Aggregate:"2"},AMAP_SCRIPT:"https://webapi.amap.com/maps?v=1.3&key=c471351bf394765d2c41e58ac7540233&plugin=AMap.Geocoder,AMap.PlaceSearch,AMap.Geolocation",AMAP_CONVERT:"https://restapi.amap.com/v3/assistant/coordinate/convert&coordsys=gps&output=json&key=4b1106d8b63a712103ff2b81f28ca536",LIMIT_FIELDS:{list:["text","textarea","combo","radiogroup","checkboxgroup","combocheck","number","datetime","address","location","user","usergroup","dept","deptgroup","image","upload","signature","subform","linkdata"],filter:["text","textarea","radiogroup","checkboxgroup","combo","combocheck","number","datetime","address","location","user","usergroup","dept","deptgroup","subform","flowstate","flownode","image","upload","signature"],noCache:["location","separator"],subformTitle:["text","textarea","combo","radiogroup","checkboxgroup","combocheck","number","datetime","address","location","user","usergroup","dept","deptgroup","linkdata"],sort:["text","textarea","number","radiogroup","datetime","combo","linkdata"],disable:["text","textarea","number","address","location","radiogroup","checkboxgroup"],userDept:["user","usergroup","dept","deptgroup"]},TEXT_TYPE_REGEXP:{mobile:"^((\\(\\d{2,3}\\))|(\\d{3}\\-))?1\\d{10}$",tel:"^(0[0-9]{2,3}\\-)?([2-9][0-9]{6,7})+(\\-[0-9]{1,4})?$",zip:"^\\d{6}$",email:"^([a-zA-Z0-9_\\.\\-])+\\@(([a-zA-Z0-9\\-])+\\.)+([a-zA-Z0-9]{2,4})+$",ID:"(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)",URL:"(?:http(?:s)?:\\/\\/|www)[\\w.]+[\\w:./\\-?#=&%]+"},AUTHGROUP:{SUBMIT:-1,VIEWDATA:-2,MANAGERMEDATA:-3,MANAGERALLDATA:-4},VIP_MODULE:{USERS:"users",FORM_DATA:"form_data",DATA:"data",EXCEL_IMPORT:"excel_import",FILE_UPLOAD:"file_upload",AGGREGATE:"aggregate",DATA_BACKUP:"data_backup",LOGO:"logo",USER_SYNC:"user_sync",APP_BRIDGE:"app_bridge",LEVEL:"level",SIGNATURE:"signature"},TRACKER:{DD_AUTH_FAIL:"dd_auth_fail",APP_VIEW_FROM_MOBILE:"app_view_from_mobile",APP_INSTALL_FROM_MOBILE:"app_install_from_mobile",DASHBOARD_FLOW_LAUNCH_FROM_MOBILE:"dashboard_flow_launch_from_mobile",USER_PORTRAIT_COLLECT:"user_portrait_collect",USER_PORTRAIT_FINISH:"user_portrait_finish",FILE_PREVIEW:"file_preview",FLOW_DATA_SUBMIT_ERROR:"flow_data_submit_error"},COOKIE:{CORP:{KEY:"switch_corp",EXPIRES:new Date((new Date).getTime()+2592e7),VALUE:!0},GUIDE:{EXPIRES_DATE:new Date((new Date).getTime()+2592e7),STICK:{KEY:"dashboard_stick",VALUE:1}},PORTRAIT:{SUFFIX_KEY:"#user_portrait",EXPIRES:new Date((new Date).getTime()+2592e6),VALUE:!0},RECOMMEND:{SUFFIX_KEY:"#recommend_apps",EXPIRES:new Date((new Date).getTime()+31536e6),VALUE:!0}},WORKFLOW:{NODE_DELIMITER:"@",START_FLOW_ID:0,END_FLOW_ID:-1,APPROVAL_ALL:0,BACKRULE:{DISALLOW:0,PARENT_NODE:1,RANGE_NODE:2},FLOWSTATE:{INPROCESS:0,COMPLETE:1,CLOSE:2},FLOWTYPE:{NORMAL:"flow",CC:"cc"}},PARAMETER:{EMPTY:"fx_param_empty"},FLOW_ACTION_NAME:{forward:"",save:"",back:"",transfer:"",close:"",revoke:"",approval:"",state:""},AUTH_GROUP_NAME:{"-1":"","-4":"","-3":"","-2":""},FLOW_AUTH_GROUP_NAME:{"-1":"","-2":"","-4":""},KEYBOARD:{ENTER:13},EntryAttributes:{creator:1,createTime:1,updateTime:1,ext:1},DEFAULT_AUTH_GROUP:0,FLOW_FILTER_TYPE:{ALL:"all",TODAY:"today",THIS_WEEK:"thisWeek",CUSTOM:"custom",CCUSER:"ccUsers",TRANSACTOR:"transactors"},SEP_LINE_STYLE:{NONE:"none",DASHED:"dashed",THIN:"thin",THICK:"thick"},FILTER_METHOD:{EQ:"eq",NE:"ne",ALL:"all",IN:"in",NIN:"nin",LK:"like",ULK:"unlike",EP:"empty",NEP:"not_empty",GT:"gt",GTE:"gte",LT:"lt",LTE:"lte",RG:"range"},FILTER_RELATION:{AND:"and",OR:"or"},DATA_LIMIT_TIP:{LINK:"",ACCOUNT:""},UPLOAD_FILE_COUNT:{SINGLE:1,MULTI:10},FLOW_FAIL_CODE:{FORWARD_CHARGER:5008,BACK:5009,FORWARD_COND:5011},FLOW_FAIL_HINT:{forward:"",back:"",auto_forward:"",auto_back:""},CHINA_CODE:"+86",AREA_CODE:[{value:"+86",text:""},{value:"+886",text:""},{value:"+852",text:""},{value:"+853",text:""}],APP_CATE_NAME:{quick_start:"",rank:"",application:"",common:"",feature:"",it:"IT",manufacturing:"",trade:"",service:"",education:"",housing:"",financial:"",medicine:"",government:"",logistics:"",business_service:"",hr:"",audit:"",office:"",inventory:"",store:"",crm:"",sales:"",project:"",production:"",asset_equipment:"",formula:"",flow:"",aggregate:"",print:"",data_rely:"",data_auth:"",notify:"",association:""},APP_CATE:{QUICK_START:"quick_start",RANK:"rank",APPLICATION:"application",COMMON:"common",FEATURE:"feature",IT:"it",MANUFACTURING:"manufacturing",TRADE:"trade",SERVICE:"service",EDUCATION:"education",HOUSING:"housing",FINANCIAL:"financial",MEDICINE:"medicine",GOVERNMENT:"government",LOGISTICS:"logistics",BUSINESS_SERVICE:"business_service",HR:"hr",AUDIT:"audit",OFFICE:"office",INVENTORY:"inventory",STORE:"store",CRM:"crm",SALES:"sales",PROJECT:"project",PRODUCTION:"production",ASSET_EQUIPMENT:"asset_equipment",FORMULA:"formula",FLOW:"flow",AGGREGATE:"aggregate",PRINT:"print",DATA_RELY:"data_rely",DATA_AUTH:"data_auth",NOTIFY:"notify",ASSOCIATION:"association"},APP_CATE_MAP:{quick_start:["quick_start"],rank:["rank"],application:["hr","audit","office","inventory","store","crm","sales","project","production","asset_equipment"],common:["it","manufacturing","trade","service","education","housing","financial","medicine","government","logistics","business_service"],feature:["formula","flow","aggregate","print","data_rely","data_auth","notify","association"]},SORT:{ASC:1,DESC:-1},TEMPLATE_SURVEY_URL:"https://jiandaoyun.com/f/5add57019933837bd675c1d0",MAX_FILE_SIZE:20971520}}(),FXM.Utils={isString:function(t){return"string"==typeof t},isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},isFunction:function(t){return $.isFunction(t)},isDate:function(t){return t instanceof Date},isArray:function(t){return $.isArray(t)},isNull:function(t){return null===t||void 0===t},isEmpty:function(t){return""===t||FXM.Utils.isNull(t)},isObjectEmpty:function(t){if(null==t)return!0;if(t.length>0)return!1;if(0===t.length)return!0;for(var e in t)if(hasOwnProperty.call(t,e))return!1;return isNaN(t)},makeArray:function(t){return this.isNull(t)?[]:Array.isArray(t)?t:[t]},shuffleArray:function(t){var e=[];if(!FXM.Utils.isArray(t)||!t.length)return e;for(var i=(e=t.slice(0)).length,a=0;a<i-1;a++){var n=Math.floor(Math.random()*(i-a)),r=e[n];e[n]=e[i-a-1],e[i-a-1]=r}return e},applyFunc:function(t,e,i,a){return FXM.Utils.isFunction(e)?e.apply(t,i||[]):a},forEach:function(t,e){if(Array.isArray(t))for(var i=0,a=t.length;i<a&&!1!==e.apply(t[i],[i,t[i]]);i++);else if(t&&"object"==typeof t)for(var n in t)if(t.hasOwnProperty(n)&&!1===e.apply(t[n],[n,t[n]]))break},parseJSON:function(t){return this.isEmpty(t)?{}:$.parseJSON(t)},getServerDate:function(t){if(t&&t.getResponseHeader){var e=t.getResponseHeader("date");e&&(FXM.STATIC._st=new Date(e).getTime(),FXM.STATIC._ct=(new Date).getTime())}},ajax:function(t,e,i,a){return $.ajax({type:"POST",url:t.url,async:!1!==t.async,data:JSON.stringify(t.data),contentType:"application/json;charset=UTF-8",timeout:t.timeout,beforeSend:function(t){t.setRequestHeader("X-CSRF-Token",FXM.STATIC.CSRF),t.setRequestHeader("X-JDY-Ver",FXM.STATIC._ver)},success:function(t,i,a){FXM.Utils.getServerDate(a),e&&e(t,i)},error:function(t,e){switch(t.status){case 400:if(!1===FXM.Utils.applyFunc(this,i,[t,e],!1)){var a=FXM.Utils.parseJSON(t.responseText);a.msg?FXM.UI.toast({msg:a.msg,type:"warning"}):FXM.UI.toast({msg:a.msg,type:"error"})}break;case 401:FXM.UI.toast({msg:"",type:"warning"});break;case 402:FXM.UI.toast({msg:"",type:"warning"});break;case 403:FXM.UI.toast({msg:"",type:"warning"});break;case 404:FXM.UI.toast({msg:"",type:"warning"});break;case 0:break;default:FXM.UI.toast({msg:"",type:"warning"})}},complete:function(t,e){a&&a(t,e)}})},ajaxUpload:function(t,e,i,a){$.ajax({type:"POST",url:t.url,data:t.data,cache:!1,contentType:!1,processData:!1,beforeSend:function(t){t.setRequestHeader("X-CSRF-Token",FXM.STATIC.CSRF)},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&t.onUpload&&(e.upload.onprogress=function(e){e.lengthComputable?t.onUpload(e.loaded,e.total):t.onUpload(3,10)}),e},success:function(t,i){e&&e(t,i)},error:function(t,e){i&&i(t,e)},complete:function(t,e){a&&a(t,e)}})},dataAjax:function(t,e,i,a){t.data=t.data||{};var n=t.data;return FXM.Utils.isEmpty(FXM.STATIC.APPID)||(n.appId=FXM.STATIC.APPID),!FXM.Utils.isEmpty(FXM.STATIC.ENTRYID)&&(n.entryId=FXM.STATIC.ENTRYID),!FXM.Utils.isEmpty(FXM.STATIC.DATAID)&&(n.dataId=FXM.STATIC.DATAID),FXM.Utils.isEmpty(FXM.STATIC.FTOKEN)?FXM.Utils.isEmpty(FXM.STATIC.QTOKEN)?FXM.Utils.isEmpty(FXM.STATIC.RTOKEN)?FXM.Utils.isEmpty(FXM.STATIC.ATOKEN)?FXM.Utils.isEmpty(FXM.STATIC.DTOKEN)?FXM.Utils.isEmpty(FXM.STATIC.DASH_TOKEN)||(n.fx_access_token=FXM.STATIC.DASH_TOKEN,n.fx_access_type="dash_public"):(n.fx_access_token=FXM.STATIC.DTOKEN,n.fx_access_type="form_data"):(n.fx_access_token=FXM.STATIC.ATOKEN,n.fx_access_type="app_public"):(n.fx_access_token=FXM.STATIC.RTOKEN,n.fx_access_type="report_public"):(n.fx_access_token=FXM.STATIC.QTOKEN,n.fx_access_type="form_query"):(n.fx_access_token=FXM.STATIC.FTOKEN,n.fx_access_type="form_public"),FXM.Utils.ajax(t,function(t,i){e(t,i)},i,a)},fixDecimalPrecision:function(t,e){var i="";if(e||(e=8),!this.isEmpty(t)){var a=parseFloat(t);if(!isNaN(a)){var n=(a+"").split(".")[1];i=n&&n.length>e?parseFloat(FXM.Utils.toFixed(a,e)):a}e>6&&Math.abs(i)<1&&/e-/.test(i+"")&&(i=parseFloat(FXM.Utils.toFixed(a,6)))}return i},toFixed:function(t,e){return new Big(t).toFixed(e).toString()},leftPad:function(t,e,i){var a="";for(FXM.Utils.isNull(t)||(a=t+""),i||(i=" ");a.length<e;)a=i+a;return a},startWith:function(t,e){var i=t.length;return!(null==e||""==e||0===i||e.length>i)&&t.substr(0,e.length)==e},GCD:function(t,e){return e?this.GCD(e,t%e):t},LCM:function(t,e){return t*e/this.GCD(t,e)},str2num:function(t){if(FXM.Utils.isEmpty(t))return null;var e=parseFloat(t);return isNaN(e)?null:e},allowValueSubmit:function(t){return FXM.CONSTS.VALUE_WIDGETS[t]},getFileDownloadURL:function(t,e,i){if(!FXM.STATIC.APPID)return i();FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.file.download,FXM.STATIC.APPID),data:t},function(t){e(t.url)},function(t){!1===FXM.Utils.applyFunc(this,i,[t],!1)&&FXM.UI.alert({msg:""})})},formatFileSize:function(t){return FXM.Utils.isNumber(t)?t>=1e9?(t/1e9).toFixed(2)+" GB":t>=1e6?(t/1e6).toFixed(2)+" MB":(t/1e3).toFixed(2)+" KB":""},getSelectionText:function(){return window.getSelection?window.getSelection().toString():document.selection&&document.selection.createRange?document.selection.createRange().text:""},escapeRegexp:function(t){if("string"!=typeof t)return"";var e=/[|\\{}()[\]^$+*?.]/g;return t.replace(e,"\\$&")},flatten:function(t,e,i){if(i||(i=[]),t)for(var a=0,n=t.length;a<n;a++){var r=t[a];Array.isArray(r)?FXM.Utils.flatten(r,e,i):e&&!e(r)||i.push(r)}return i},evalFormula:function(t){var e=[];FXM.STATIC.FormulaEnv||(FXM.Utils.forEach(Object.keys(FXM.Formula),function(t,i){e.push("var "+i+"=FXM.Formula."+i)}),FXM.STATIC.FormulaEnv=e.join(";")+";");var i;try{i=new Function(FXM.STATIC.FormulaEnv+"return "+t)()}catch(t){i=null}return i},removeArray:function(t,e){var i=t.indexOf(e);i>-1&&t.splice(i,1)},setPageTitle:function(t){FXM.Utils.isEmpty(t)||(document.title=t,FXM.CORP.DD&&FXM.CORP.DD.biz.navigation.setTitle({title:t}))},getPageTitle:function(){return document.title},getUrlParameter:function(t){for(var e=window.location.search.substring(1).split("&"),i=0;i<e.length;i++){var a=e[i].split("=");if(a[0]==t)return a[1]}return null},chunkArray:function(t,e){var i=[];if(!e||!t.length)return i;for(var a=0,n=t.length;a<n;a+=e){var r=t.slice(a,a+e);i.push(r)}return i},UUID:function(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,this.UUID)},sendCorpOpLog:function(t){FXM.CORP.CONFIG&&FXM.CORP.DD&&FXM.CORP.DD.biz.util.ut({key:"open_micro_general_operat",value:{corpId:FXM.CORP.CONFIG.corpId,agentId:FXM.CORP.CONFIG.agentId,type:t}})},loadAMapScript:function(t){if($("script[src^='https://webapi.amap.com/maps']").length<=0){var e=document.createElement("script");e.type="text/javascript",e.src=FXM.CONSTS.AMAP_SCRIPT,document.body.appendChild(e),FXM.STATIC.AMAP=e}"undefined"==typeof AMap&&FXM.STATIC.AMAP?FXM.STATIC.AMAP.addEventListener&&FXM.STATIC.AMAP.addEventListener("load",t):t&&t()},getEntryAttribute:function(t,e){var i=["creator","createTime","updateTime"];return t&&i.push("ext"),e||i.push("flowState","chargers"),i},createEntryAttributeField:function(t,e){var i={id:e.id};switch(t){case"label":$.extend(i,{name:"label",type:"text",text:""});break;case"ext":$.extend(i,{name:"ext",type:"text",text:"",items:e.extParams});break;case"createTime":$.extend(i,{name:"createTime",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",text:""});break;case"updateTime":$.extend(i,{name:"updateTime",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",text:""});break;case"creator":$.extend(i,{name:"creator",type:"text",text:""});break;case"flowState":$.extend(i,{name:"flowState",type:"flowState",text:""});break;case"chargers":$.extend(i,{name:"chargers",type:"chargers",text:"/"});break;default:return null}return i},getFieldAttr:function(t,e){if(!FXM.Utils.allowValueSubmit(t.widget.type))return null;if(e&&e.indexOf(t.widget.type)<0)return null;var i={id:t.formId,text:t.label,name:t.widget.widgetName,type:t.widget.type};switch(t.widget.type){case"subform":var a=[];FXM.Utils.forEach(t.widget.items,function(i,n){$.extend(n,{formId:t.formId});var r=FXM.Utils.getFieldAttr(n,e);r&&($.extend(r,{subform:t.widget.widgetName}),a.push(r))}),$.extend(i,{items:a});break;case"linkdata":$.extend(i,{linkForm:t.widget.linkForm,linkFields:t.widget.linkFields,linkType:t.widget.linkType,linkKey:t.widget.linkKey,refAppId:t.widget.refAppId});break;case"combo":case"combocheck":case"radiogroup":case"checkboxgroup":$.extend(i,{async:t.widget.async,items:t.widget.items});break;case"datetime":$.extend(i,{format:t.widget.format});break;case"location":$.extend(i,{lnglatVisible:t.widget.lnglatVisible});break;case"text":$.extend(i,{regex:t.widget.regex})}return i},parseNumber:function(t){var e=parseFloat(t);return!isNaN(e)&&isFinite(e)?e:null},getWeekStartDate:function(t){var e=t.getDay();return 0===e&&(e=7),new Date(t.getFullYear(),t.getMonth(),t.getDate()-(e-1))},getWeekEndDate:function(t){var e=t.getDay();return 0===e&&(e=7),new Date(t.getFullYear(),t.getMonth(),t.getDate()+(7-e))},getMonthStartDate:function(t){return new Date(t.getFullYear(),t.getMonth(),1)},getMonthEndDate:function(t){return new Date(t.getFullYear(),t.getMonth()+1,0)},getFieldInfoByFormula:function(t){var e={},i=(t+"").match(/(\$[0-9a-zA-Z\._]+)(#[0-9a-f]+)?(@[0-9a-f]+)?/),a=["","field","entryId","appId"];return FXM.Utils.forEach(i,function(t,i){0!==t&&i&&(e[a[t]]=i.substr(1))}),e},isCorp:function(){return!(!FXM.CORP.DD&&!FXM.CORP.WX)},dt:function(t,e){if(t){var i=["e="+t,"t="+(new Date).getTime()];FXM.Utils.isEmpty(e)||i.push("ext="+e),FXM.GB.user&&FXM.GB.user.username&&i.push("u="+FXM.GB.user.username),(new Image).src="https://track.jiandaoyun.com/log?"+i.join("&")}},isMemberName:function(t){return!/[0-9a-f]{24}/.test(t)},getMemberName:function(t,e){var i=[];if(!FXM.Utils.isNull(t)){if(FXM.Utils.isArray(t)||(t=[t]),FXM.Utils.forEach(t,function(t,e){FXM.Utils.isMemberName(e)||i.push(e)}),FXM.Utils.isObjectEmpty(i))return e();FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.corp.list_member_name),data:{members:i}},function(t,i){var a={};FXM.Utils.forEach(t.users,function(t,e){a[e._id]=e.nickname}),FXM.Utils.forEach(t.departments,function(t,e){a[e._id]=e.name}),e(a)})}},getFlowActionText:function(t,e){e=e||{};var i="",a=FXM.CONSTS.FLOW_ACTION_NAME[t];switch(t){case"forward":i=e.submit_text||a;break;case"save":i=e.save_text||a;break;case"back":i=e.back_text||a;break;case"transfer":i=e.transfer_text||a;break;case"close":i=e.close_text||a;break;default:i=a}return i},isExternalLink:function(){return FXM.STATIC.FTOKEN||FXM.STATIC.RTOKEN||FXM.STATIC.ATOKEN||FXM.STATIC.DTOKEN},createSvgEl:function(t,e){return $(document.createElementNS("http://www.w3.org/2000/svg",t)).attr(e||{})},fixBody:function(){var t=document.body.scrollTop||document.documentElement.scrollTop;return $("body").addClass("x-scroll-fixed x-position-fixed"),t},releaseBody:function(t){$("body").removeClass("x-scroll-fixed x-position-fixed"),document.body.scrollTop=t,document.documentElement.scrollTop=t},scrollLock:function(t){var e=function(){};return t.hasClass("x-scroll-fixed")||(t.addClass("x-scroll-fixed"),e=function(){t.removeClass("x-scroll-fixed")}),{release:e}},format2ThumbDate:function(t){if(FXM.Utils.isNull(t))return null;var e,i=new Date(t),a=new Date,n=a.getTime()-i.getTime(),r=+a.setHours(0,0,0,0),s=+a.setHours(23,59,59,999);return 0<=n&&n<36e5?(e=parseInt(n/6e4,10))?e+"":"":r<+i&&+i<=s?""+FXM.Utils.leftPad(i.getHours()+"",2,"0")+":"+FXM.Utils.leftPad(i.getMinutes()+"",2,"0"):FXM.Utils.date2Str(i,"yyyy-MM-dd HH:mm:dd")},formatUserThumb:function(t){if(!FXM.Utils.isEmpty(t))return{color:t.charCodeAt(0)%6,name:t.substr(0,1).toUpperCase()}},formatTransform:function(t){var e={};return["-webkit-transform","-moz-transform","-ms-transform","-o-transform","transform"].map(function(i){e[i]=t}),e},setErrorMsg:function(t,e){var i=FXM.CONSTS.INVALID_TYPE,a="";switch(t.getInvalidType()){case i.BLANK:a="";break;case i.REPEAT:a="";break;case i.OUTSIDE:a=""}var n=e.children(".f-error-info");n.length>0?n.text(a):$('<div class="f-error-info"/>').text(a).appendTo(e)},getApi:function(t){if(!FXM.Utils.isString(t))return"";var e=arguments;if(e.length<=1)return t;var i=/\/:[a-z]+/gi,a=1;return t.replace(i,function(){return"/"+e[a++]})},replaceURL:function(t){if(FXM.Utils.isNull(t))return"";t+="";var e=FXM.CONSTS.TEXT_TYPE_REGEXP.URL,i="",a=t.split(new RegExp("("+e+")"));return FXM.Utils.forEach(a,function(t,e){if(t%2!=0){var a=e;FXM.Utils.startWith(e,"www")&&(a="http://"+e),FXM.Utils.isCorp()?i+='<a class="nest-link" data-url="'+a+'">'+e+"</a>":i+='<a class="nest-link" target="_blank" href="'+a+'">'+e+"</a>"}else i+=FXM.Utils.escapeHtmlSpecialChar(e)}),i},isWorkWechatAgent:function(){return/wxwork/i.test(window.navigator.userAgent)},isFromWorkWechat:function(t){return!(!t||!t.username)&&/^wxtmp-/.test(t.username)},isFromDingDing:function(t){return!(!t||!t.username)&&/^dingtmp-/.test(t.username)},getUA:function(){var t=navigator.userAgent;return t.indexOf("Android")>-1||t.indexOf("Linux")>-1?"android":t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?"ios":void 0},openLink:function(t,e){FXM.CORP.DD?FXM.CORP.DD.biz.util.openLink({url:t}):FXM.CORP.WX&&e?FXM.UI.confirm("",function(){window.open(t)}):window.open(t)},isRegtimeBeforeUpdate:function(t){var e=new Date(FXM.GB.user.regTime),i=!1;switch(t){case"persona":i=e<new Date(2017,11,4).getTime();break;case"referrer":i=e<new Date(2018,2,14).getTime()}return i},isPdfExt:function(t){return/^pdf$/i.test(t)},isOfficeExt:function(t){return/^(doc|docx|ppt|pptx|xls|xlsx)$/i.test(t)},isImageExt:function(t){return/^(png|jpg|jpeg|gif)$/i.test(t)},getArrayFromRange:function(t,e,i){var a=[];switch(e){case"number":a.push(FXM.Utils.isNull(t.min)?null:t.min),a.push(FXM.Utils.isNull(t.max)?null:t.max);break;case"address":a.push(t.province||null),a.push(t.city||null),a.push(t.district||null);break;case"datetime":var i=i||"yyyy-MM-dd";a.push(t.min?FXM.Utils.date2Str(new Date(t.min),i):null),a.push(t.max?FXM.Utils.date2Str(new Date(t.max),i):null)}return a},createFileThumb:function(t,e){e=e||"normal";var i=["ppt","pptx","doc","docx","xls","xlsx","zip","rar","csv","txt","pdf"].indexOf(t)>-1?t:"other";return $('<div class="x-file-thumb '+i+" size-"+e+'"/>')},getFileOnlineUrl:function(t,e){return FXM.Utils.isPdfExt(t)?"https://assets.jiandaoyun.com/shared/pdfjs/1.10/web/viewer.html?file="+encodeURIComponent(e):FXM.Utils.isOfficeExt(t)?"https://view.officeapps.live.com/op/view.aspx?src="+encodeURIComponent(e):void 0},getLinkFilter:function(t,e){var i={type:t.type};switch($.extend(i,FXM.Utils.dealFilterFieldName(t)),t.type){case"datetime":i.method=FXM.CONSTS.FILTER_METHOD.RG,i.value=e;break;case"address":case"location":i.type="address",i.method=FXM.CONSTS.FILTER_METHOD.ALL,i.value=e;break;case"user":case"id":i.type="user",i.method=FXM.CONSTS.FILTER_METHOD.IN,i.value=FXM.Utils.makeArray(e);break;case"dept":case"did":i.type="dept",i.method=FXM.CONSTS.FILTER_METHOD.IN,i.value=FXM.Utils.makeArray(e);break;case"number":i.method=FXM.CONSTS.FILTER_METHOD.EQ,i.value=FXM.Utils.makeArray(e);break;case"linkdata":"number"===t.linkType?(i.keyType="number",i.method=FXM.CONSTS.FILTER_METHOD.EQ):(i.keyType="text",i.method=FXM.CONSTS.FILTER_METHOD.IN),i.value=FXM.Utils.makeArray(e);break;default:"creator"===t.name?(i.type="user",i.method=FXM.CONSTS.FILTER_METHOD.IN,i.value=FXM.Utils.makeArray(e)):(i.type="text",i.method=FXM.CONSTS.FILTER_METHOD.IN,i.value=FXM.Utils.makeArray(e))}return i},getFieldInfoById:function(t){var e={},i=(t="#"+t).match(/(#[0-9a-f]+)(@[0-9a-f]+)?/),a=["","entryId","appId"];return FXM.Utils.forEach(i,function(t,i){0!==t&&i&&(e[a[t]]=i.substr(1))}),e},dealFilterFieldName:function(t){var e={};if(/\./.test(t.name)){var i=t.name.split(".");e.subform=i[0],e.subField=i[1]}else e.field=t.name;return e},dealFilterInfoByField:function(t){var e=FXM.Utils.getFieldInfoById(t.id),i=FXM.Utils.dealFilterFieldName(t);return $.extend({},e,i)},getDateRange:function(t){var e="yyyy-MM-dd",i=new Date,a=[];if(FXM.Utils.isNull(t.day))if(FXM.Utils.isNull(t.week))FXM.Utils.isNull(t.month)?FXM.Utils.isNull(t.quarter)?(i.setFullYear(t.year,0,1),a.push(FXM.Utils.date2Str(i,e)),i.setFullYear(t.year+1,0,1),i.setHours(0,0,0,0),a.push(FXM.Utils.date2Str(new Date(i.getTime()-1),e))):(i.setFullYear(t.year,3*(t.quarter-1),1),a.push(FXM.Utils.date2Str(i,e)),i.setFullYear(t.year,3*t.quarter,1),i.setHours(0,0,0,0),a.push(FXM.Utils.date2Str(new Date(i.getTime()-1),e))):(i.setFullYear(t.year,t.month-1,1),a.push(FXM.Utils.date2Str(i,e)),i.setFullYear(t.year,t.month,1),i.setHours(0,0,0,0),a.push(FXM.Utils.date2Str(new Date(i.getTime()-1),e)));else{i.setFullYear(t.year,0,1);var n=(7-(i.getDay()||7)+1)%7;i.setTime(i.getTime()+864e5*(n+7*(t.week-1))),a.push(FXM.Utils.date2Str(i,e)),i.setTime(i.getTime()+6048e5),i.setHours(0,0,0,0),a.push(FXM.Utils.date2Str(new Date(i.getTime()-1),e))}else{i.setFullYear(t.year,t.month-1,t.day);var r=FXM.Utils.date2Str(i,e);a=[r,r]}return a},getDateInfoFromNow:function(t){if(FXM.Utils.isNull(t))return null;var e={isLater:!0},i=new Date(t),a=(new Date).getTime()-i.getTime();a>0&&(e.isLater=!1);return(a=Math.abs(a))>=864e5?(e.day=parseInt(a/864e5,10),e.hour=parseInt(a%864e5/36e5,10),e.minute=parseInt(a%864e5%36e5/6e4,10)):a>=36e5?(e.hour=parseInt(a/36e5,10),e.minute=parseInt(a%36e5/6e4,10)):a>=6e4?e.minute=parseInt(a/6e4,10):e.isJustNow=!0,e},resolveUsername:function(t,e){return e=e||"nickname",FXM.Utils.isObjectEmpty(t)?"":FXM.Utils.isString(t)?t:t._id===FXM.CONSTS.USER_ID.SYS_ROBOT?"":t[e]||""},copyToClipboard:function(t,e){if(FXM.CORP.DD)FXM.CORP.DD.biz.clipboardData.setData({text:t,onSuccess:e});else if(t&&t.length){var i=document.createElement("textarea");i.style.background="transparent",i.style.color="transparent",i.value=t,document.body.appendChild(i),i.select();var a;try{a=document.execCommand("copy")}catch(t){a=!1}document.body.removeChild(i),a&&FXM.Utils.applyFunc(this,e,[],!1)}},isSupportClipboard:function(){return FXM.CORP.DD||document.execCommand&&document.execCommand("copy")},getShowFieldItems:function(t,e,i){var a=[],n={};return FXM.Utils.forEach(t,function(t,e){"subform"===e.type?FXM.Utils.forEach(e.items,function(t,i){n[[e.name,i.name].join(".")]=!0}):n[e.name]=!0}),FXM.Utils.forEach(e,function(t,e){if(!(i&&i.indexOf(e.type)<0)){var r={text:"chargers"===e.type?"/":e.text,value:e.name};r.selected=n[r.value],"subform"===e.type?FXM.Utils.forEach(e.items,function(t,r){if(!(i&&i.indexOf(r.type)<0)){var s={value:[e.name,r.name].join("."),text:[e.text,r.text].join(".")};s.selected=n[s.value],a.push(s)}}):a.push(r)}}),a},getShowFieldsByNames:function(t,e){var i=[];return e?FXM.Utils.forEach(t,function(t,a){if("subform"===a.type){var n=[];FXM.Utils.forEach(a.items,function(t,i){e.indexOf([a.name,i.name].join("."))>-1&&n.push(i)}),FXM.Utils.isObjectEmpty(n)||i.push($.extend({},a,{items:n}))}else e.indexOf(a.name)>-1&&i.push(a)}):i=t,i},getValidFilters:function(t){var e=[];return FXM.Utils.forEach(t.cond,function(t,i){FXM.Utils.isFilterValid(i)&&e.push(i)}),{cond:e,rel:t.rel}},isFilterValid:function(t){var e=FXM.CONSTS.FILTER_METHOD,i=!0;switch(t.method){case e.EP:case e.NEP:i=!0;break;default:i=t.hasEmpty||!FXM.Utils.isObjectEmpty(t.value)}return i},filterFieldsByLimit:function(t,e){if(!e)return t;var i=[];return FXM.Utils.forEach(t,function(t,a){if(e.indexOf(a.type)>-1)if("subform"===a.type){var n=[];FXM.Utils.forEach(a.items,function(t,i){e.indexOf(i.type)>-1&&n.push(i)}),i.push($.extend({},a,{items:n}))}else i.push(a)}),i},escapeHtmlSpecialChar:function(t){return t.replace(/[<>"&]/g,function(t,e,i){switch(t){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case'"':return"&quot;"}})},getFilterKey:function(t){return t.subField?[t.subform,t.subField].join("."):t.field},parseDate:function(t){if(FXM.Utils.isNull(t))return null;if(FXM.Utils.isNumber(t))return new Date(t);if(FXM.Utils.isString(t)){var e=t.match(/^(\d{4})-?(\d{1,2})-?(\d{0,2})(.*?(\d{1,2}):(\d{1,2}):(\d{1,2}))?.?(\d{1,3})?$/);return e?new Date(e[1],e[2]-1,e[3],e[5]||0,e[6]||0,e[7]||0,e[8]||0):null}return new Date(t)},dataURLtoBlob:function(t){for(var e=t.split(","),i=e[0].match(/:(.*?);/)[1],a=atob(e[1]),n=a.length,r=new Uint8Array(n);n--;)r[n]=a.charCodeAt(n);return new Blob([r],{type:i})},uploadFile:function(t,e,i,a,n){var r=$.extend({uploadSite:"qn",uploadUrl:"https://up.qbox.me",uploadToMedia:!1,uploadToForm:!1,appId:FXM.STATIC.APPID,entryId:FXM.STATIC.ENTRYID,uploadToken:"",signatureToken:"",signatureKey:"",widgetName:"",uploader:FXM.GB.user?FXM.GB.user._id:"",fileName:""},t),s=new FormData;s.append("file",e,r.fileName||e.name),"qn"===r.uploadSite&&(s.append("token",r.uploadToken),s.append("x:bucketType",r.uploadToMedia?"media":"file"),s.append("x:uploader",r.uploader),r.uploadToForm&&(s.append("x:appId",r.appId),s.append("x:entryId",r.entryId),s.append("x:field",r.widgetName)),r.signatureToken&&r.signatureKey&&(s.append("x:signatureToken",r.signatureToken),s.append("x:signatureKey",r.signatureKey))),FXM.Utils.ajaxUpload({url:r.uploadUrl,data:s,onUpload:i},function(t){a&&a(t)},n)},debounce:function(t,e,i){e=e||0;var a=null;return function(){a&&clearTimeout(a);var n=arguments;a=setTimeout(function(){FXM.Utils.applyFunc(i,t,n,!1)},e)}},getLnglatText:function(t){return FXM.Utils.isObjectEmpty(t)||FXM.Utils.isObjectEmpty(t.lnglatXY)?"":""+FXM.Utils.fixDecimalPrecision(t.lnglatXY[1],6)+""+FXM.Utils.fixDecimalPrecision(t.lnglatXY[0],6)}},function(t){var e={Sunday:"",Monday:"",Tuesday:"",Wednesday:"",Thursday:"",Friday:"",Saturday:"","Short-Sun":"","Short-Mon":"","Short-Tue":"","Short-Wed":"","Short-Thu":"","Short-Fri":"","Short-Sat":"",January:"",February:"",March:"",April:"",May:"",June:"",July:"",August:"",September:"",October:"",November:"",December:"","Short-Jan":"","Short-Feb":"","Short-Mar":"","Short-Apr":"","Short-May":"","Short-Jun":"","Short-Jul":"","Short-Aug":"","Short-Sep":"","Short-Oct":"","Short-Nov":"","Short-Dec":""},i=function(t){return e[t]},a=[i("Sunday"),i("Monday"),i("Tuesday"),i("Wednesday"),i("Thursday"),i("Friday"),i("Saturday")],n=[i("Short-Sun"),i("Short-Mon"),i("Short-Tue"),i("Short-Wed"),i("Short-Thu"),i("Short-Fri"),i("Short-Sat")],r=[i("January"),i("February"),i("March"),i("April"),i("May"),i("June"),i("July"),i("August"),i("September"),i("October"),i("November"),i("December")];Date._SMN=[i("Short-Jan"),i("Short-Feb"),i("Short-Mar"),i("Short-Apr"),i("Short-May"),i("Short-Jun"),i("Short-Jul"),i("Short-Aug"),i("Short-Sep"),i("Short-Oct"),i("Short-Nov"),i("Short-Dec")],t.extend(FXM.Utils,{address2Str:function(t,e,i){if(i&&t){e="";var a=!0;/p/.test(i)&&t.province&&(e+=t.province,t.province===t.city&&(a=!1)),/c/.test(i)&&t.city&&a&&(e+=t.city),/d/.test(i)&&t.district&&(e+=t.district),/a/.test(i)&&t.detail&&(e+=t.detail)}return e},num2Str:function(t,e){if(FXM.Utils.isEmpty(t))return"";var i=t+"";if(FXM.Utils.isEmpty(e))return i;var a=/\[Num0\]/;if(a.test(e))return e.replace(a,i);if((a=/\[Num1\]/).test(e))return e.replace(a,FXM.Utils._num2CN(i,!1));if((a=/\[Num2\]/).test(e))return e.replace(a,FXM.Utils._num2CN(i,!0));a=/[#0]+,?[#0]*\.?[#0]*%?/;var n=e.match(a);if(n&&n.length>0){var r=n[0];return i=FXM.Utils._numberFormat(t,r),e.replace(a,i)}return e},_numberFormat:function(t,e){var i="",a=t+"";if(/%$/.test(e)){i="%",t*=100,e=e.replace("%","");var n=a.indexOf(".");if(n>-1){var r=a.length-3-n;r=r<0?0:r>8?8:r,t=parseFloat(t.toFixed(r))}a=t+""}var s=e.split("."),o=s[0],l=s[1];if(""!==l){for(var c=l?l.length:0,h=(a=FXM.Utils.toFixed(parseFloat(t),c)).split(""),u=c;u>0&&"#"===l.charAt(u-1);u--){var d=h.pop();if("0"!==d){h.push(d);break}}var p=h.pop();"."===p&&(p=""),a=h.join("")+p}var f=a.split("."),m=f[0];if(/,/.test(o))f[0]=m.replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,");else{var g=o.match(/[0]+[0#]*$/);g&&g.length>0&&(f[0]=FXM.Utils.leftPad(m,g[0].length,"0"))}return f.join(".")+i},_num2CN:function(t,e){var i="",a="";e&&(i="",a="");var n=Math.floor(Math.abs(t)),r=Math.abs(t).toString(),s=r.replace(/\..*$/,""),o=r.split("."),l=i,c=a,h=l[0],u=new RegExp(l[0]+"*$"),d=new RegExp(l[0]+"+","g"),p="",f="";if(p=t<0?"-."[0]:"",o.length>=2){var m=o[1];if(m){f="-."[1];for(var g=0;g<m.length;g++)f+=l[+m[g]]}}if(1==s.length)return p+l[n]+f;if(s.length<=5){for(var v="",y=0,n=s.length;n--;){var M=+s[y];v+=this._num2CN(s[y],e)+(M&&n?c[n]:""),y++}return v=v.replace(d,h),v=v.replace(u,""),p+v+f}for(var F=s.length/4>>0,_=s.length%4,v="";0==_||!c[3+F];)_+=4,F--;if(+s.substr(0,_)){v=this._num2CN(s.substr(0,_),e)+c[3+F];var T=s.substr(_);"0"===T[0]&&(v+=l[0]),v+=this._num2CN(T,e)}else v=this._num2CN(s.substr(0,_),e)+this._num2CN(s.substr(_),e);return v=v.replace(d,h),v=v.replace(u,""),p+v+f},date2Str:function(t,e){if(!t)return"";var i=(e=e||"yyyy-MM-dd").length,a="";if(i>0){for(var n=e.charAt(0),r=0,s=n,o=1;o<i;o++){var l=e.charAt(o);n!==l?(a+=FXM.Utils._compileDateFormat({char:n,str:s,len:o-r},t),r=o,s=n=l):s+=l}a+=FXM.Utils._compileDateFormat({char:n,str:s,len:i-r},t)}return a},_compileDateFormat:function(t,e){var i=t.str,s=t.len;switch(t.char){case"E":i=s>2?a[e.getDay()]:s>1?n[e.getDay()]:e.getDay()+"";break;case"y":i=s<=3?(e.getFullYear()+"").slice(2,4):e.getFullYear();break;case"M":i=s>2?r[e.getMonth()]:s<2?e.getMonth()+1:FXM.Utils.leftPad(e.getMonth()+1+"",2,"0");break;case"d":i=s>1?FXM.Utils.leftPad(e.getDate()+"",2,"0"):e.getDate();break;case"h":var o=e.getHours()%12;0===o&&(o=12),i=s>1?FXM.Utils.leftPad(o+"",2,"0"):o;break;case"H":i=s>1?FXM.Utils.leftPad(e.getHours()+"",2,"0"):e.getHours();break;case"m":i=s>1?FXM.Utils.leftPad(e.getMinutes()+"",2,"0"):e.getMinutes();break;case"s":i=s>1?FXM.Utils.leftPad(e.getSeconds()+"",2,"0"):e.getSeconds();break;case"a":i=e.getHours()<12?"am":"pm";break;default:i=t.str}return i},date2GroupStr:function(t,e){var i="",a=e.split("_");return FXM.Utils.forEach(a,function(e,a){var n=0===e;i+=FXM.Utils._compileDateGroupRule(t[a],a,n)}),i},_compileDateGroupRule:function(t,e,i){var a;switch(e){case"year":a=t+"";break;case"quarter":a=""+t+"";break;case"month":a=i?FXM.Utils.leftPad(t,2,"0")+"":t+"";break;case"week":a=i?FXM.Utils.leftPad(t,2,"0")+"":t+"";break;case"day":a=i?FXM.Utils.leftPad(t,2,"0")+"":t+"";break;default:a=""}return a},getPercentFormat:function(t){return t||(t="0."),/%$/.test(t)||(t+="%"),t}})}(Zepto),function($){FXM.Formula={AND:function(){for(var t=FXM.Utils.flatten(arguments),e=0,i=t.length;e<i;e++)if(!t[e])return!1;return!0},OR:function(){for(var t=FXM.Utils.flatten(arguments),e=0,i=t.length;e<i;e++)if(t[e])return!0;return!1},FALSE:function(){return!1},TRUE:function(){return!0},IF:function(t,e,i){return t?e:i},NOT:function(t){return!t},XOR:function(){for(var t=0,e=FXM.Utils.flatten(arguments),i=0,a=e.length;i<a;i++)e[i]&&t++;return!!(1&Math.floor(Math.abs(t)))},CHAR:function(t){return 10===t||34===t||39===t||92===t?String.fromCharCode(t):""},CONCATENATE:function(){for(var t=FXM.Utils.flatten(arguments),e=0;(e=t.indexOf(!0))>-1;)t[e]="TRUE";for(var i=0;(i=t.indexOf(!1))>-1;)t[i]="FALSE";return t.join("")},EXACT:function(t,e){return t===e},LEFT:function(t,e){return e=FXM.Utils.isEmpty(e)?1:e,t?t.substring(0,e):""},LEN:function(t){return FXM.Utils.isString(t)?t?t.length:0:t&&t.length?t.length:0},LOWER:function(t){return FXM.Utils.isString(t)?t?t.toLowerCase():t:""},REPLACE:function(t,e,i,a){return FXM.Utils.isNumber(e)&&FXM.Utils.isNumber(i)?(t=t||"",a=a||"",t.substr(0,e-1)+a+t.substr(e-1+i)):t},REPT:function(t,e){return e=e||0,new Array(e+1).join(t)},RIGHT:function(t,e){return e=void 0===e?1:e,t?t.substring(t.length-e):""},SEARCH:function(t,e,i){return FXM.Utils.isString(t)&&FXM.Utils.isString(e)?(i=FXM.Utils.isNull(i)?0:i,e.toLowerCase().indexOf(t.toLowerCase(),i-1)+1):0},SPLIT:function(t,e){return FXM.Utils.isString(t)?t.split(e):[]},TRIM:function(t){return FXM.Utils.isString(t)?t.replace(/ +/g," ").trim():""},UPPER:function(t){return FXM.Utils.isString(t)?t.toUpperCase():""},MID:function(t,e,i){return t=t||"",FXM.Utils.isNumber(e)&&FXM.Utils.isNumber(i)?t.substr(e-1,i):t},AVERAGE:function(){for(var t=FXM.Utils.flatten(arguments,function(t){return FXM.Utils.isNumber(t)}),e=t.length,i=0,a=0,n=0;n<e;n++)i+=t[n],a+=1;return i/a},COUNT:function(){return FXM.Utils.flatten(arguments).length},COUNTIF:function(){var len=arguments.length,criteria=arguments[len-1];/[<>=!]/.test(criteria)||(criteria='=="'+criteria+'"');for(var args=FXM.Utils.flatten(Array.prototype.slice.call(arguments,0,len-1)),matches=0,i=0;i<args.length;i++)"string"!=typeof args[i]?eval(args[i]+criteria)&&matches++:eval('"'+args[i]+'"'+criteria)&&matches++;return matches},LARGE:function(t,e){return(t=FXM.Utils.flatten(t,function(t){return FXM.Utils.isNumber(t)})).sort(function(t,e){return e-t})[e-1]},MAX:function(){var t=FXM.Utils.flatten(arguments,function(t){return FXM.Utils.isNumber(t)});return 0===t.length?0:Math.max.apply(Math,t)},MIN:function(){var t=FXM.Utils.flatten(arguments,function(t){return FXM.Utils.isNumber(t)});return 0===t.length?0:Math.min.apply(Math,t)},SMALL:function(t,e){return(t=FXM.Utils.flatten(t,function(t){return FXM.Utils.isNumber(t)})).sort(function(t,e){return t-e})[e-1]},ABS:function(t){return FXM.Utils.isNumber(t)?Math.abs(t):0},ROUND:function(t,e){if(t=FXM.Utils.parseNumber(t),e=FXM.Utils.parseNumber(e),FXM.Utils.isNull(t)||FXM.Utils.isNull(e))return null;var i=t*Math.pow(10,e);return Number(new Big(i).round(0).toString())/Math.pow(10,e)},CEILING:function(t,e){if(t=FXM.Utils.parseNumber(t),e=FXM.Utils.parseNumber(e),FXM.Utils.isNull(t)||FXM.Utils.isNull(e))return null;if(0===e)return 0;var i=e<0?-1:0,a=(e=Math.abs(e))-Math.floor(e),n=0;return a>0&&(n=-Math.floor(Math.log(a)/Math.log(10))),t>=0?FXM.Formula.ROUND(Math.ceil(t/e)*e,n):0===i?-FXM.Formula.ROUND(Math.floor(Math.abs(t)/e)*e,n):-FXM.Formula.ROUND(Math.ceil(Math.abs(t)/e)*e,n)},FLOOR:function(t,e){if(t=FXM.Utils.parseNumber(t),e=FXM.Utils.parseNumber(e),FXM.Utils.isNull(t)||FXM.Utils.isNull(e))return null;if(0===e)return 0;if(!(t>0&&e>0||t<0&&e<0))return 0;var i=(e=Math.abs(e))-Math.floor(e),a=0;return i>0&&(a=-Math.floor(Math.log(i)/Math.log(10))),t>=0?FXM.Formula.ROUND(Math.floor(t/e)*e,a):-FXM.Formula.ROUND(Math.floor(Math.abs(t)/e)*e,a)},INT:function(t){return FXM.Utils.isNumber(t)?Math.floor(t):0},LOG:function(t,e){return e=void 0===e?10:e,FXM.Utils.isNumber(e)?Math.log(t)/Math.log(e):0},MOD:function(t,e){if(0===e)return 0;var i=Math.abs(t%e);return e>0?i:-i},POWER:function(t,e){var i=Math.pow(t,e);return isNaN(i)?0:i},PRODUCT:function(){var t=FXM.Utils.flatten(arguments,function(t){return FXM.Utils.isNumber(t)}),e=1;if(t.length)for(var i=0;i<t.length;i++)e=FXM.FormulaCalcParser.evalExpression("*",e,t[i]);else e=0;return e},SQRT:function(t){return t<0?0:Math.sqrt(t)},SUM:function(){for(var t=0,e=FXM.Utils.flatten(arguments,function(t){return FXM.Utils.isNumber(t)}),i=0,a=e.length;i<a;++i)t=FXM.FormulaCalcParser.evalExpression("+",t,e[i]);return t},SUMPRODUCT:function(){for(var t=0,e=[],i=-1,a=0;a<arguments.length;a++)arguments[a]instanceof Array&&(i=i<0?arguments[a].length:Math.min(arguments[a].length,i),e.push(arguments[a]));for(var n,r,s,o=0;o<i;o++){for(n=1,r=0;r<e.length;r++)s=parseFloat(e[r][o]),isNaN(s)&&(s=0),n=FXM.FormulaCalcParser.evalExpression("*",n,s);t=FXM.FormulaCalcParser.evalExpression("+",t,n)}return t},FIXED:function(t,e){return t=FXM.Utils.parseNumber(t),FXM.Utils.isNull(t)?null:(e=void 0===e?0:e,FXM.Utils.isNumber(e)&&e>=0?FXM.Utils.toFixed(t,e):"")},RAND:function(){return FXM.Utils.fixDecimalPrecision(Math.random(),6)},DATE:function(){return 6===arguments.length?new Date(parseInt(arguments[0],10),parseInt(arguments[1],10)-1,parseInt(arguments[2],10),parseInt(arguments[3],10),parseInt(arguments[4],10),parseInt(arguments[5],10)):3===arguments.length?new Date(parseInt(arguments[0],10),parseInt(arguments[1],10)-1,parseInt(arguments[2],10)):new Date(arguments[0])},TIME:function(t,e,i){return(3600*t+60*e+i)/86400},TIMESTAMP:function(t){return FXM.Utils.isDate(t)?t.getTime():0},TODAY:function(){return new Date},NOW:function(){return new Date},SYSTIME:function(){var t=FXM.STATIC._st,e=(new Date).getTime()-FXM.STATIC._ct;return e>0&&e<36e5&&(t+=e),new Date(t)},IP:function(){return FXM.GB.ip||""},DAY:function(t){var t=FXM.Utils.parseDate(t);if(!FXM.Utils.isNull(t))return t.getDate()},MONTH:function(t){var t=FXM.Utils.parseDate(t);if(!FXM.Utils.isNull(t))return t.getMonth()+1},YEAR:function(t){var t=FXM.Utils.parseDate(t);if(!FXM.Utils.isNull(t))return t.getFullYear()},HOUR:function(t){var t=FXM.Utils.parseDate(t);if(!FXM.Utils.isNull(t))return t.getHours()},MINUTE:function(t){var t=FXM.Utils.parseDate(t);if(!FXM.Utils.isNull(t))return t.getMinutes()},SECOND:function(t){var t=FXM.Utils.parseDate(t);if(!FXM.Utils.isNull(t))return t.getSeconds()},DAYS:function(t,e){var t=FXM.Utils.parseDate(t);if(!FXM.Utils.isNull(t)){var e=FXM.Utils.parseDate(e);if(!FXM.Utils.isNull(e))return(new Date(t.getFullYear(),t.getMonth(),t.getDate())-new Date(e.getFullYear(),e.getMonth(),e.getDate()))/864e5}},DAYS360:function(t,e,i){var t=FXM.Utils.parseDate(t);if(!FXM.Utils.isNull(t)){var e=FXM.Utils.parseDate(e);if(!FXM.Utils.isNull(e)){var a,n,r=e.getMonth(),s=t.getMonth();if(i)a=31===e.getDate()?30:e.getDate(),n=31===t.getDate()?30:t.getDate();else{var o=new Date(e.getFullYear(),r+1,0).getDate(),l=new Date(t.getFullYear(),s+1,0).getDate();a=e.getDate()===o?30:e.getDate(),t.getDate()===l?a<30?(s++,n=1):n=30:n=t.getDate()}return 360*(t.getFullYear()-e.getFullYear())+30*(s-r)+(n-a)}}},DATEDELTA:function(t,e){var t=FXM.Utils.parseDate(t);if(!FXM.Utils.isNull(t))return FXM.Utils.isNumber(e)||(e=0),new Date(t.getTime()+864e5*e)},ISOWEEKNUM:function(t){var t=FXM.Utils.parseDate(t);if(!FXM.Utils.isNull(t)){t.setHours(0,0,0),t.setDate(t.getDate()+4-(t.getDay()||7));var e=new Date(t.getFullYear(),0,1);return Math.ceil(((t-e)/864e5+1)/7)}},WEEKNUM:function(t,e){var t=FXM.Utils.parseDate(t);if(!FXM.Utils.isNull(t)){var i=2===e?1:0,a=new Date(t.getFullYear(),0,1),n=(i+7-a.getDay())%7,r=n>0?1:0,s=a.getTime()+24*n*60*60*1e3;return Math.floor((t.getTime()-s)/864e5/7+1)+r}},MAP:function(t,e,i){var a=[];if(FXM.Utils.isObjectEmpty(t))return a;var n=FXM.Utils.getFieldInfoByFormula(e),r=FXM.Utils.getFieldInfoByFormula(i);return n.entryId&&n.entryId===r.entryId&&FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.formula.map),async:!1,data:{formId:n.entryId,lookup_value:t,lookup_field:n.field,result_field:r.field,refAppId:n.appId}},function(t){FXM.Utils.forEach(t.result,function(t,e){a.push(e[r.field])})}),a},TEXT:function(t,e){return FXM.Utils.isNull(t)?"":FXM.Utils.isDate(t)&&!FXM.Utils.isEmpty(e)?FXM.Utils.date2Str(t,e):FXM.Utils.num2Str(t,e)},VALUE:function(t){return FXM.Utils.isEmpty(t)?0:isNaN(t)?0:parseFloat(t)},UUID:function(){return FXM.Utils.UUID()},RECNO:function(){return FXM.Utils.isNull(FXM.STATIC.EntryRecNo)?FXM.STATIC.APPID&&FXM.STATIC.ENTRYID?(FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.formula.recno),async:!1,data:{formId:FXM.STATIC.ENTRYID,hasIncLock:FXM.STATIC.RecnoLock}},function(t){FXM.STATIC.EntryRecNo=t.incId}),FXM.STATIC.EntryRecNo):"":FXM.STATIC.EntryRecNo},ISEMPTY:function(t){return FXM.Utils.isObjectEmpty(t)},MAPX:function(t,e,i,a){var n=null;if(FXM.Utils.isEmpty(t)||FXM.Utils.isObjectEmpty(e))return n;t=t.toLowerCase();var r=FXM.Utils.getFieldInfoByFormula(i),s=FXM.Utils.getFieldInfoByFormula(a);if(/^sum|avg|max|min|count|first|last$/.test(t)&&r.entryId&&r.entryId===s.entryId){var o=FXM.Utils.isDate(e),l=o?e.getTime():e;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.formula.aggregate),async:!1,data:{op:t,formId:r.entryId,lookup_value:l,lookup_field:r.field,result_field:s.field,date_type:o,refAppId:r.appId}},function(t){t.result&&t.result[0]&&!FXM.Utils.isNull(t.result[0].result)&&(n=t.result[0].result)})}return n},GETUSERNAME:function(){return FXM.GB.user?FXM.GB.user.nickname:""}}}(Zepto),function($){FXM.FormulaCalcParser=FXM.FormulaCalcParser||{},$.extend(FXM.FormulaCalcParser,{evalExpression:function(op,left,right){var calcOps=["+","-","*","/"];if("!"===op)return eval(op+"left");if(calcOps.indexOf(op)>-1&&FXM.FormulaCalcParser.isValidNumber(left)&&FXM.FormulaCalcParser.isValidNumber(right)){var result;switch(op){case"+":result=new Big(left).plus(right);break;case"-":result=new Big(left).minus(right);break;case"*":result=new Big(left).times(right);break;case"/":result=0===right?"":new Big(left).div(right)}return""===result?null:Number(result.toString())}return eval("left"+op+"right")},isValidNumber:function(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)},applyFunc:function(t,e){if(FXM.Formula[t])return FXM.Formula[t].apply(null,e)},parse:function(t){var e;try{e=FormulaCalc.parse(t)}catch(t){e=null,console.log(t)}return e}})}(Zepto),function(t){FXM.UI={createLoadIcon:function(){return t('<div class="x-loader-icon"/>')},showLoader:function(e){var i=this,a=t(".x-ui-loader");if(!(a.length>0)){var n={isDark:!1,noLoader:!1},r=t.extend(n,e);a=t('<div class="x-ui-loader"/>').appendTo(t("body")),!0===r.isDark&&a.addClass("dark-in"),r.noLoader||a.append(i.createLoadIcon())}},closeLoader:function(){var e=t(".x-ui-loader");e.length>0&&(e.remove(),e=null)},toast:function(e){var i=t.extend({msg:"",type:"info"},e);if(!(t(".x-msg-toast").length>0)){var a=t('<div class="x-msg-toast '+i.type+'">').append('<i class="icon-toast-type icon-'+i.type+'"/>').append(t('<span class="toast-msg"/>').text(i.msg)).appendTo("body");a.on("click",function(){a.remove()}),setTimeout(function(){a.remove()},3500)}},alert:function(t){FXM.CORP.DD?FXM.CORP.DD.device.notification.alert({message:t.msg,title:t.title,buttonName:t.buttonName||"",onSuccess:function(){}}):window.alert(t.msg)},confirm:function(t,e,i){FXM.CORP.DD?FXM.CORP.DD.device.notification.confirm({message:t,buttonLabels:["",""],onSuccess:function(t){0===t.buttonIndex?e&&e():i&&i()}}):window.confirm(t)?e&&e():i&&i()},scanQRCode:function(t){FXM.CORP.DD?FXM.CORP.DD.biz.util.scan({type:"qrCode"===t.type?"qrCode":"barCode",onSuccess:function(e){FXM.Utils.applyFunc(this,t.success,[e.text],!1)},onFail:function(t){FXM.UI.alert({msg:JSON.stringify(t)})}}):FXM.CORP.WX?FXM.CORP.WX.scanQRCode({desc:t.describe,needResult:1,scanType:["qrCode","barCode"],success:function(e){var i=e.resultStr;"barCode"===t.type&&(i=i.replace(/^\w+,/,"")),FXM.Utils.applyFunc(this,t.success,[i],!1)}}):FXM.UI.alert({msg:""})},getLocation:function(t){if(FXM.CORP.WX)FXM.CORP.WX.getLocation({type:"gcj02",success:function(e){var i=[e.longitude,e.latitude];FXM.Utils.applyFunc(t.obj,t.success,[i],!1)}});else{if(!FXM.CORP.DD)return!1;FXM.CORP.DD.device.geolocation.get({targetAccuracy:t.accuracy,coordinate:1,onSuccess:function(e){var i=[e.longitude,e.latitude];FXM.Utils.applyFunc(t.obj,t.success,[i],!1)},onFail:function(t){}})}},hideAllMenuItem:function(){FXM.CORP.DD?FXM.CORP.DD.biz.navigation.setRight({show:!1,onSuccess:function(t){},onFail:function(t){}}):FXM.CORP.WX&&FXM.CORP.WX.hideAllNonBaseMenuItem()},showAllMenuItem:function(){FXM.CORP.DD||FXM.CORP.WX&&FXM.CORP.WX.showAllNonBaseMenuItem()},chooseImage:function(e,i){var a=t.extend({maxFileCount:FXM.CONSTS.UPLOAD_FILE_COUNT.SINGLE,compressed:!1,onlyCamera:!1},e);if(FXM.CORP.WX){var n=a.compressed?["compressed"]:["original"],r=a.onlyCamera?["camera"]:["album","camera"],s=a.maxFileCount>9?9:a.maxFileCount;FXM.CORP.WX.chooseImage({count:s,sizeType:n,sourceType:r,success:function(t){var e=t.localIds;FXM.UI.uploadImage(e,i)}})}else FXM.CORP.DD&&(a.onlyCamera?FXM.CORP.DD.biz.util.uploadImageFromCamera({compression:a.compressed,onSuccess:function(t){i&&i(t)}}):FXM.CORP.DD.biz.util.uploadImage({multiple:a.maxFileCount>FXM.CONSTS.UPLOAD_FILE_COUNT.SINGLE,max:a.maxFileCount,onSuccess:function(t){i&&i(t)}}))},uploadImage:function(t,e){if(FXM.CORP.WX){var i=t.pop();FXM.CORP.WX.uploadImage({localId:i,isShowProgressTips:1,success:function(i){var a=i.serverId;e&&e([a]),t.length>0&&FXM.UI.uploadImage(t,e)}})}},disableBounce:function(){FXM.CORP.DD&&FXM.CORP.DD.ui.webViewBounce.disable()},previewImage:function(t,e){FXM.CORP.DD?FXM.CORP.DD.biz.util.previewImage({urls:t,current:e}):FXM.CORP.WX&&FXM.CORP.WX.previewImage({current:e,urls:t})},renderError:function(e){t("body").empty(),t('<div class="page-error"><div class="error-content"></div><div class="error-text">'+e||"</div></div>").appendTo("body")},indicator:function(e,i){if(!t(".x-toast-success").length){var a=e||"",n=t('<div class="x-toast-success"/>').append(t('<div class="toast-content"/>').append(t('<div class="icon-wrapper"><i class="icon-ok-circle"></i></div>')).append(t('<div class="msg"/>').text(a))).appendTo("body");setTimeout(function(){n.remove(),i&&i()},1500)}},createEmptyTip:function(e){var i=t('<div class="x-empty-info"/>'),a=t.extend({msg:""},e);return t('<div class="x-empty-image"/>').appendTo(i),t('<div class="x-empty-tip"/>').text(a.msg).appendTo(i),i}}}(Zepto),FXM.RelyProcessor=function(t){this.options={defaultVersion:0,version:0,versionMap:{},stateMap:{},asyncMap:{},defaults:[],relyMap:{},linkMap:{},defaultMap:{}},this._init(t)},$.extend(FXM.RelyProcessor.prototype,{RELY_END:-1,_init:function(t){this.options.relyMap=this._getRelyWidgetsMap(t),this.options.linkMap=this._getLinkMap(this.options.relyMap)},_getLinkMap:function(t){var e=this,i={};return FXM.Utils.forEach(t,function(t,a){FXM.Utils.forEach(a,function(a,n){e._add2LinkMap(i,n,t)})}),i},_add2LinkMap:function(t,e,i){if(t[e]||(t[e]=[]),t[e].push(i),/\./.test(e)&&!/\./.test(i)){var a=e.split(".")[0];this._add2LinkMap(t,a,i)}return t},_getRelyWidgetsMap:function(t){var e=this,i={};return FXM.Utils.forEach(t,function(t,a){var n=a.widget;if(n&&"linkdata"!==n.type){if("subform"===n.type){var r=e._getRelyWidgetsMap(n.items);FXM.Utils.forEach(r,function(t,e){var a=[n.widgetName,t].join(".");i[a]=e})}var s=n.rely;s&&s.widgets&&(i[n.widgetName]=s.widgets)}}),i},_isSubformWidget:function(t){return/\./.test(t)},_getVersion:function(t,e){var i=this.options,a=i.versionMap[t]||i.defaultVersion;return e>-1&&this._isSubformWidget(t)&&(a=Math.max(a,i.versionMap[t+e]||i.defaultVersion)),a},_getState:function(t,e){var i=this.options,a=i.stateMap[t]||i.defaultVersion;return e>-1&&this._isSubformWidget(t)&&(a=Math.max(a,i.stateMap[t+e]||i.defaultVersion)),a},_getAsync:function(t,e){var i=this.options;return e>-1&&this._isSubformWidget(t)?i.asyncMap[t]&&i.asyncMap[t][e]:i.asyncMap[t]},getRelyVersion:function(t,e,i,a,n){var r=this;return n=n||{},this._isSubformWidget(e)||(i=-1),FXM.Utils.forEach(t[e],function(e,s){n[s]||n[s+i]||(i>-1&&r._isSubformWidget(s)?n[s+i]=a:n[s]=a,r.getRelyVersion(t,s,i,a,n))}),n},checkAsyncState:function(){var t=this,e=this.options,i=!0;return FXM.Utils.forEach(e.asyncMap,function(a){var n=e.asyncMap[a];if(t._isSubformWidget(a)?FXM.Utils.forEach(n,function(t,e){if(!1===e)return i=!1,!1}):i=!1!==n,!i)return!1}),i},setStateMap:function(t,e,i){var a=this.options;i>-1?a.stateMap[t+i]=e:a.stateMap[t]=e},setAsyncMap:function(t,e,i){var a=this.options;i>-1?(a.asyncMap[t]=a.asyncMap[t]||{},a.asyncMap[t][i]=e):a.asyncMap[t]=e},addDefaultRely:function(t){FXM.Utils.isObjectEmpty(t.getOptionValue())||this.options.defaults.push(t)},getDefaultRely:function(){return this.options.defaults},_checkRely:function(t,e,i,a){var n=this,r=this.options,s=!0;return FXM.Utils.forEach(r.relyMap[i],function(r,o){if(n._isSubformWidget(o)&&!n._isSubformWidget(i)){var l=null,c=0;do{if((l=t.getWidgetByName(o,c))&&e===n._getVersion(o,c)&&n._getAsync(o,c)!==e){s=!1;break}c++}while(l)}else!1===n._getAsync(o,a)?s=!1:e===n._getVersion(o,a)&&(s=n._getAsync(o,a)===e);if(!s)return!1}),s&&(this._getState(i,a)===e?s=!1:this.setStateMap(i,e,a)),s},fireRely:function(t,e,i){var a=this.options,n=this,r=-1,s=t.getWidgetName();t.isSubformWidget()&&(s=[t.getSubformName(),s].join("."),r=$(t.element).closest(".x-subform-line").index()),e||(a.version++,e===a.defaultVersion&&(a.defaultMap[a.version]=!0),e=a.version,$.extend(a.versionMap,this.getRelyVersion(a.linkMap,s,r,e)),this.setStateMap(s,e,r)),this.setAsyncMap(s,e,r);var o=t.getLinkValue();FXM.Utils.forEach(a.linkMap[s],function(t,s){if(!(e<n._getState(s,r))||a.defaultMap[e]){var l;if(n._isSubformWidget(s)&&r<0){var c=0;do{if(!n._checkRely(i,e,s,c))return;(l=i.getWidgetByName(s,c))&&(n.setAsyncMap(s,!1,c),i.dealRely(s,l,e,o)),c++}while(l)}else{if(!n._checkRely(i,e,s,r))return;if(!(l=i.getWidgetByName(s,r)))return;n.setAsyncMap(s,!1,r),i.dealRely(s,l,e,o)}}})},checkAsyncVersion:function(t,e){var i=this.options,a=-1,n=t.getWidgetName();return t.isSubformWidget()&&(n=[t.getSubformName(),n].join("."),a=$(t.element).closest(".x-subform-line").index()),this._getState(n,a)<=e||i.defaultVersion[e]}}),FXM.AssociationProcessor=function(t){this.associationMap={},this.relyMap={},this._init(t)},$.extend(FXM.AssociationProcessor.prototype,{VISIBLE:1,INVISIBLE:0,_init:function(t){this.associationMap=this._getAssociationMap(t),this.relyMap=this._getRelyWidgetsMap(this.associationMap)},_getAssociationMap:function(t){var e=this,i={};return FXM.Utils.forEach(t,function(t,a){if(a.widget&&e._hasContactWidgets(a.widget)){var n=e._getAssociateWidgets(a.widget);FXM.Utils.isObjectEmpty(n)||(i[a.widget.widgetName]=n)}}),i},_getAssociateWidgets:function(t){var e=this,i={};return FXM.Utils.forEach(t.items,function(t,a){a.widgetsMap&&FXM.Utils.forEach(a.widgetsMap,function(t,n){a.selected?i[n]=e.VISIBLE:i[n]=i[n]||e.INVISIBLE})}),i},_hasContactWidgets:function(t){return t&&("combo"===t.type||"radiogroup"===t.type)&&!t.async},_getRelyWidgetsMap:function(t){var e={};return FXM.Utils.forEach(t,function(t,i){FXM.Utils.forEach(i,function(i,a){e[i]=e[i]||{},e[i][t]=a})}),e},getVisibleMap:function(){var t={};return FXM.Utils.forEach(this.relyMap,function(e,i){t[e]=!1,FXM.Utils.forEach(i,function(i,a){if(a)return t[e]=!0,!1})}),t},dealAssociation:function(t,e){var i=this;FXM.Utils.forEach(this.associationMap[t],function(a){i.associationMap[t][a]=e.indexOf(a)>-1?i.VISIBLE:i.INVISIBLE}),this.relyMap=this._getRelyWidgetsMap(this.associationMap);var a={};return FXM.Utils.forEach(this.associationMap[t],function(t){a[t]=!1,FXM.Utils.forEach(i.relyMap[t],function(e,i){if(i)return a[t]=!0,!1})}),a}}),function(){FXM.Store=FXM.Store||{},$.extend(FXM.Store,{expireTime:864e5,set:function(t,e){},get:function(t,e){},has:function(t){return void 0!==this.get(t)},remove:function(t){},clear:function(){},transact:function(t,e,i){null==i&&(i=e,e=null),null==e&&(e={});var a=this.get(t,e);i(a),this.set(t,a)},getAll:function(){var t={};return this.forEach(function(e,i){t[e]=i}),t},forEach:function(){},serialize:function(t){return JSON.stringify(t)},deserialize:function(t){if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t||void 0}},getKey:function(t,e){var i="";switch(t){case"paramFields":case"showFields":case"formDataShowFields":i=[t,e.appId,e.entryId,e.groupId].join(""),i=[t,e.appId,e.entryId,e.groupId].join("");break;case"authGroup":i=[t,e.appId,e.entryId].join("");break;case"formData":i=FXM.GB.user&&!FXM.STATIC.FTOKEN?[t,e.appId,e.entryId,FXM.GB.user._id].join(""):[t,e.appId,e.entryId].join("");break;case"filterValue":i=[t,e.appId,e.entryId,e.groupId,e.ext].join("")}return i}});var t="undefined"!=typeof window?window:global,e="localStorage";(function(){try{return e in t&&t[e]}catch(t){return!1}})()&&$.extend(FXM.Store,{storage:t[e],set:function(t,e,i){if(void 0===e)return this.remove(t);i&&(e={data:e,expire:+new Date+this.expireTime*i});try{this.storage.setItem(t,this.serialize(e))}catch(t){return void this.clear(!0)}return e},get:function(t,e){var i=this.deserialize(this.storage.getItem(t));return i&&i.expire&&(i=i.data),void 0===i?e:i},remove:function(t){this.storage.removeItem(t)},clear:function(t){var e=this;if(t){var i=+new Date;this.forEach(function(t,a){a.expire&&i>a.expire&&e.remove(t)})}else this.storage.clear()},forEach:function(t){for(var e=0;e<this.storage.length;e++){var i=this.storage.key(e);t(i,this.deserialize(this.storage.getItem(i)))}}})}(),FXM.Cookie=FXM.Cookie||{},$.extend(FXM.Cookie,{_encode:function(t){return this.raw?t:encodeURIComponent(t)},_decode:function(t){return this.raw?t:decodeURIComponent(t)},_stringifyCookieValue:function(t){return this._encode(this.json?JSON.stringify(t):String(t))},_parseCookieValue:function(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(/\+/g," ")),this.json?JSON.parse(t):t}catch(t){}},_read:function(t,e){var i=this.raw?t:this._parseCookieValue(t);return $.isFunction(e)?e(i):i},set:function(t,e,i){if(arguments.length>1&&!$.isFunction(e)){if("number"==typeof(i=$.extend({expires:new Date((new Date).getTime()+1728e6),domain:FXM.CONSTS.CONFIG.COOKIE_DOMAIN},i)).expires){var a=i.expires,n=i.expires=new Date;n.setMilliseconds(n.getMilliseconds()+864e5*a)}return document.cookie=[this._encode(t),"=",this._stringifyCookieValue(e),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}},get:function(t,e){for(var i=t?void 0:{},a=document.cookie?document.cookie.split("; "):[],n=0,r=a.length;n<r;n++){var s=a[n].split("="),o=this._decode(s.shift()),l=s.join("=");if(t===o){i=this._read(l,e);break}t||void 0===(l=this._read(l))||(i[o]=l)}return i},remove:function(t,e){return this.set(t,"",$.extend({},e,{expires:-1})),!this.set(t)}}),FXM.Vip={_getVip:function(){if(!FXM.GB.VIP_PACK){if(!FXM.STATIC.APPID)return{};FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.dashboard.get_vip_pack,FXM.STATIC.APPID),async:!1},function(t){FXM.GB.VIP_PACK=$.extend({},t)},function(){FXM.GB.VIP_PACK={}})}return FXM.GB.VIP_PACK},_getPack:function(){var t=this._getVip();return t&&t.vipPack||{}},clear:function(){FXM.GB.VIP_PACK=null},getExcelMFS:function(){return this._getPack()[FXM.CONSTS.VIP_MODULE.EXCEL_IMPORT]||2097152},hasAppBridge:function(){return this._getPack()[FXM.CONSTS.VIP_MODULE.APP_BRIDGE]>0},hasDataBackup:function(){return this._getPack()[FXM.CONSTS.VIP_MODULE.DATA_BACKUP]>0},hasSignature:function(){return this._getPack()[FXM.CONSTS.VIP_MODULE.SIGNATURE]>0},showUpgradeTip:function(t){if(!FXM.Utils.isObjectEmpty(t)){var e=t.message||t.msg,i=t.expireDays&&t.expireDays<8?e+t.expireDays+"":e;FXM.UI.toast({type:"warning",msg:i})}},getVipLimit:function(){var t=this._getVip();return t&&t.vipLimit||{}},isDataCreateLimit:function(){return this.getVipLimit().data_create},showDataLimitTip:function(t){this.isDataCreateLimit()&&new FXM.Tip($.extend({msg:FXM.CONSTS.DATA_LIMIT_TIP.LINK},t))}},FXM.Widget=function(t){this.options=$.extend(this._defaults(),t),this._beforeInit(),this._init(),this._afterInit()},$.extend(FXM.Widget.prototype,{_defaults:function(){return{render:$("<div/>"),widgetName:"",baseCls:null,customCls:null,enable:!0,visible:!0,value:null,onBeforeInit:null,onAfterInit:null}},_beforeInit:function(){FXM.Utils.applyFunc(this,this.options.onBeforeInit,[],!1),this.__initRootDom(),this.__initNameEffects()},_init:function(){},_afterInit:function(){this.__initVisualEffects();var t=this.options.value;FXM.Utils.isNull(t)||this._initDefaultValue(t),FXM.Utils.applyFunc(this,this.options.onAfterInit,[],!1)},__initRootDom:function(){var t=this.options;this.type&&(t.type=this.type),this.element=$(t.render),t.baseCls&&this.element.addClass(t.baseCls),t.customCls&&this.element.addClass(t.customCls)},__initNameEffects:function(){var t=this.options;t.widgetName||(t.widgetName="_widget_"+FXM.STATIC.IDBase++),this.element.attr({wn:t.widgetName})},__initVisualEffects:function(){this.setEnable(this.options.enable),this.setVisible(this.options.visible)},_initDefaultValue:function(t){},getWidgetName:function(){return this.options.widgetName},getWidgetType:function(){return this.options.type},getLinkType:function(){return this.getWidgetType()},getWidgetByName:function(t){return null},getText:function(){return this.getValue()},getValue:function(){},getLinkValue:function(){return this.getValue()},setValue:function(t){},isEnabled:function(){return this.options.enable},setEnable:function(t){this.options.enable=!!t,!0===this.options.enable?this.element.removeClass("x-ui-disable"):this.element.addClass("x-ui-disable")},isVisible:function(){return this.options.visible},setVisible:function(t){this.options.visible=!!t,!0===this.options.visible?this.element.removeClass("x-ui-hidden"):this.element.addClass("x-ui-hidden")},resize:function(t){},checkValidate:function(){return!0},getInvalidType:function(){return this.invalidType},setInvalidType:function(t,e){t?(this.invalidType=void 0,this.element.removeClass("x-ui-invalid")):(this.invalidType=e,this.element.addClass("x-ui-invalid"))},getNullValue:function(){return null}}),FXM.BaseFormWidget=FXM.extend(FXM.Widget,{supportItemLink:function(){return!1},getCacheValue:function(){return this.getValue()},setCacheValue:function(t){this.setValue(t)}}),function(t){FXM.Separator=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return t.extend(FXM.Separator._super._defaults.apply(),{baseCls:"x-separator",lineStyle:FXM.CONSTS.SEP_LINE_STYLE.THIN})},_init:function(){FXM.Separator._super._init.apply(this,arguments);var e=this.options;t('<div class="sep-line '+e.lineStyle+'"/>').appendTo(this.element),this.$description=t('<div class="x-subhtml"/>').appendTo(this.element)},_initDefaultValue:function(t){this.setValue(t)},setValue:function(t){this.$description.empty(),FXM.Utils.isEmpty(t)||this.$description.append(t)}}),FXM.register("separator",FXM.Separator)}(Zepto),function(t){FXM.Button=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.Button._super._defaults.apply(this,arguments),{baseCls:"x-btn",style:"default",content:"Button",size:"medium",enable:!0,onClick:null})},_init:function(){FXM.Button._super._init.apply(this,arguments),this._initComp(),this._bindEvent()},_initComp:function(){var e=this.options;this.element.addClass("style-"+e.style+"  size-"+e.size),this.$content=t("<div />").appendTo(this.element),this.$inner=t('<span class="btn-inner"/>').appendTo(this.$content),t('<span class="btn-text" />').appendTo(this.$content).html(this.options.content)},_bindEvent:function(){var e=this,i=this.options;t(e.element).on("click",function(t){if(t.preventDefault(),e.isEnabled())return FXM.Utils.applyFunc(this,i.onClick,[],!1),!1}),t(e.element).on("touchstart",function(i){var a=i.changedTouches[0].pageX,n=i.changedTouches[0].pageY,r=t(i.currentTarget).offset().left,s=t(i.currentTarget).offset().top,o=a-r,l=n-s,c=r+t(i.currentTarget).offset().width,h=s+t(i.currentTarget).offset().height,u=e._getRadius(a,n,r,s,c,h),d=t('<div class="btn-inner-ripple" style="left:'+-(u-o)+"px;top:"+-(u-l)+"px;width: "+2*u+"px;height: "+2*u+'px;"/>').appendTo(e.$inner);setTimeout(function(){d.addClass("active")},1),setTimeout(function(){d.remove()},2e3)})},_getRadius:function(t,e,i,a,n,r){var s=Math.sqrt((t-i)*(t-i)+(e-a)*(e-a)),o=Math.sqrt((n-t)*(n-t)+(r-e)*(r-e));return s>o?s:o},append:function(t){this.$content.append(t)}}),FXM.register("button",FXM.Button)}(Zepto),FXM.Picker=FXM.extend(FXM.Widget,{_defaults:function(){return $.extend(FXM.Picker._super._defaults.apply(this,arguments),{render:$("<div/>").appendTo("body"),baseCls:"x-picker",cols:[],onOk:null,onClose:null,onShow:null})},_init:function(){FXM.Picker._super._init.apply(this,arguments);var t=this,e=this.options;this.opened=!1,this._layout(),this.columns={},this._initToolbar(),this.$mask=$('<div class="x-window-mask"/>').click(function(){t.close()}).css("z-index",FXM.STATIC.zIndex++),this.element.css("z-index",FXM.STATIC.zIndex++),FXM.Utils.forEach(this.element.find(".picker-items-col"),function(i,a){var n=$(a),r=e.cols[i];r.divider||(r.container=n,r.wrapper=n.find(".picker-items-col-wrapper"),r.items=n.find(".picker-item"),t._initPickerCol(r),t.columns[r.key]=r)})},_initDefaultValue:function(t){this._setPickItems(t,!1,!1)},_createColumn:function(t,e){var i="",a="";if(t.divider)a+='<div class="picker-items-col picker-items-col-divider '+t.cssClass+'">'+t.content+"</div>";else{var n,r,s=1;for(t.isCircular&&(t.circularNum=t.circularNum||3,s=t.circularNum),n=0;n<s;n++)if(n===(s-1)/2)for(r=0;r<t.values.length;r++)i+='<div class="picker-item" data-picker-value="'+t.values[r]+'">'+(t.texts?t.texts[r]:t.values[r])+"</div>";else for(r=0;r<t.values.length;r++)i+='<div class="picker-item">'+(t.texts?t.texts[r]:t.values[r])+"</div>";a+='<div class="picker-items-col '+t.cssClass+'"><div class="picker-items-col-wrapper">'+i+"</div></div>"}return e?i:a},_layout:function(){var t=this,e=this.options,i="";FXM.Utils.forEach(e.cols,function(e,a){i+=t._createColumn(a)});this.element.addClass("picker-modal picker-columns");var a='<div class="picker-bar"></div><div class="picker-items">'+i+'<div class="picker-center-highlight"></div></div>';this.element.html(a)},_initToolbar:function(){var t=this,e=this.options,i=this.element.find(".picker-bar");$('<button class="x-btn bar-nav nav-ok"/>').text("").click(function(){!1===FXM.Utils.applyFunc(t,e.onOk,[],!1)&&t.close()}).appendTo(i),e.onClear&&$('<button class="x-btn bar-nav nav-clear"/>').text("").click(function(){FXM.Utils.applyFunc(t,e.onClear,[],!1)}).appendTo(i)},_initPickerCol:function(t){function e(e){m||f||(e.preventDefault(),f=!0,g=v="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY,y=(new Date).getTime(),w=!0,F=T=$.getTranslate(t.wrapper[0],"y"))}function i(e){f&&(e.preventDefault(),w=!1,v="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,m||($.cancelAnimationFrame(p),m=!0,F=T=$.getTranslate(t.wrapper[0],"y"),t.wrapper.transition(0)),e.preventDefault(),_=void 0,(T=F+(v-g))<c&&(T=c-Math.pow(c-T,.8),_="min"),T>h&&(T=h+Math.pow(T-h,.8),_="max"),t.wrapper.transform("translate3d(0,"+T+"px,0)"),x=T-b||T,C=(new Date).getTime(),b=T)}function a(e){if(f&&m){f=m=!1,t.wrapper.transition(""),_&&("min"===_?t.wrapper.transform("translate3d(0,"+c+"px,0)"):t.wrapper.transform("translate3d(0,"+h+"px,0)")),M=(new Date).getTime();var i;i=M-y>300?T:T+7*x,i=Math.max(Math.min(i,h),c);var a=-Math.floor((i-h)/s);i=-a*s+h,t.wrapper.transform("translate3d(0,"+parseInt(i,10)+"px,0)"),t.wrapper.transitionEnd(function(e){t.isCircular?setTimeout(function(){t.wrapper.transition(0);var e,n,r=t.items.length/t.circularNum,o=(t.circularNum-1)/2*r,l=t.items.length-o;a<o?(e=Math.ceil((o-a)/r)*r,n=-(a+e)*s+h,t.updateItems(a+e,n,"",!0),t.wrapper.transform("translate3d(0,"+parseInt(n,10)+"px,0)")):l<=a?(e=Math.ceil((a-l)/r)*r,n=-(a-e)*s+h,t.updateItems(a-e,n,"",!0),t.wrapper.transform("translate3d(0,"+parseInt(n,10)+"px,0)")):t.updateItems(a,i,"",!0)},0):t.updateItems(a,i,"",!0)}),setTimeout(function(){w=!0},100)}else f=m=!1}function n(e){if(w){$.cancelAnimationFrame(p);var i=$(this).attr("data-picker-value");t.setValue(i)}}this.options;var r,s,o,l,c,h,u=this;t.replaceValues=function(e,i,a){t.destroyEvents(),t.values=e,t.texts=i;var n=u._createColumn(t,!0);a=a||0,t.wrapper.html(n),t.items=t.wrapper.find(".picker-item"),t.calcSize(),t.setValue(t.values[a],0,!0),t.initEvents()},t.calcSize=function(){var e,i;e=0,i=t.container[0].offsetHeight,r=t.wrapper[0].offsetHeight,s=t.items[0].offsetHeight,o=s*t.items.length,c=i/2-o+s/2,h=i/2-s/2,t.isCircular&&(l=o/t.circularNum),t.width&&(e=t.width,parseInt(e,10)===e&&(e+="px"),t.container.css({width:e}))},t.calcSize();var d=h;t.isCircular&&(d=h-(t.circularNum-1)/2*l),t.wrapper.transform("translate3d(0,"+d+"px,0)").transition(0);var p;t.setValue=function(e,i,a){void 0===i&&(i="");var n=t.wrapper.find('.picker-item[data-picker-value="'+e+'"]').index();if(void 0!==n&&-1!==n){var r=-n*s+h;t.wrapper.transition(i),t.wrapper.transform("translate3d(0,"+r+"px,0)"),t.updateItems(n,r,i,a)}},t.getValue=function(){return t.value},t.updateItems=function(e,i,a,n){void 0===i&&(i=$.getTranslate(t.wrapper[0],"y")),void 0===e&&(e=-Math.round((i-h)/s)),e<0&&(e=0),e>=t.items.length&&(e=t.items.length-1),t.activeIndex=e;var r=t.value;t.wrapper.find(".picker-selected").removeClass("picker-selected");var o=t.items.eq(e).addClass("picker-selected").transform("");t.value=o.attr("data-picker-value"),t.text=t.texts?t.texts[e]:t.value,(n||void 0===n)&&r!==t.value&&FXM.Utils.applyFunc(u,t.onChange,[t],!1)};var f,m,g,v,y,M,F,_,T,b,x,C,w=!0;t.initEvents=function(r){var s=r?"off":"on";t.container[s]($.touchEvents.start,e),t.container[s]($.touchEvents.move,i),t.container[s]($.touchEvents.end,a),t.items[s]("click",n)},t.destroyEvents=function(){t.initEvents(!0)},t.initEvents()},_setPickItems:function(t,e,i){for(var a in this.columns){var n=t?t[a]:t;this.columns[a].setValue(n,e,i)}},getColumn:function(t){return this.columns[t]},replaceColValues:function(t,e,i,a){var n=this.getColumn(t);n&&n.replaceValues(e,i,a)},getValue:function(){var t={};for(var e in this.columns)t[e]=this.columns[e].getValue();return t},getText:function(){return this.getValue()},setValue:function(t){this._setPickItems(t,!1)},close:function(){if(this.opened){var t=this,e=this.options;this.opened=!1,t.$mask.removeClass("dark-in"),this.scrollLock&&this.scrollLock.release(),this.element.removeClass("modal-in").transitionEnd(function(i){FXM.Utils.applyFunc(t,e.onClose,[],!1),t.$mask.remove(),t.element.remove()})}},show:function(){if(!this.opened){var t=this,e=this.options;this.$mask.insertBefore(this.element).addClass("dark-in"),this.scrollLock=FXM.Utils.scrollLock($("body")),this.element.addClass("modal-in").transitionEnd(function(i){t.opened=!0,FXM.Utils.applyFunc(t,e.onShow,[],!1)})}}}),FXM.register("picker",FXM.Picker),FXM.SlidePanel=FXM.extend(FXM.Widget,{_defaults:function(){return $.extend(FXM.SlidePanel._super._defaults.apply(this,arguments),{render:$("<div/>").appendTo("body"),baseCls:"x-slide-panel",content:null,onShow:null,onClose:null,onLeftClick:null,onRightClick:null,onHeadCreate:null,text4Left:"",text4Right:"",direction:"right",mask:!0})},_init:function(){FXM.SlidePanel._super._init.apply(this,arguments);var t=this,e=this.options;"right"===e.direction?this.element.addClass("form-right"):"left"===e.direction?this.element.addClass("form-left"):"bottom"===e.direction&&this.element.addClass("form-bottom"),this.opened=!1;var i=FXM.Utils.applyFunc(this,e.onHeadCreate,[],!1),a=$('<div class="content"/>');i&&(this.element.append(i),a.addClass("has-header")),this.element.append(a),e.content&&this.element.children(".content").append(e.content),FXM.Utils.isEmpty(e.text4Left)||this._createFooterBtn(e.text4Left,"nav-left"),FXM.Utils.isEmpty(e.text4Right)||this._createFooterBtn(e.text4Right,"nav-right style-blue"),e.mask&&(this.$mask=$('<div class="x-window-mask"/>').click(function(){t.close()}).css("z-index",FXM.STATIC.zIndex++)),this.element.css("z-index",FXM.STATIC.zIndex++)},_createFooterBtn:function(t,e){var i=this,a=this.options,n=$(".footer",this.element);n&&n.length||(n=$('<div class="footer"/>').on("click",".footer-btn",function(t){var e=$(t.currentTarget);if(e.hasClass("x-ui-disable"))return t.preventDefault(),!1;e.hasClass("nav-left")?FXM.Utils.applyFunc(i,a.onLeftClick,[],!1):e.hasClass("nav-right")&&FXM.Utils.applyFunc(i,a.onRightClick,[],!1)}).appendTo(this.element),$(".content",this.element).addClass("has-footer")),$('<div class="footer-btn"/>').text(t).appendTo(n).addClass(e,!FXM.Utils.isEmpty(e))},setBtnEnable:function(t){var e=$(".footer",this.element);if(e&&e.length){var i=$(".nav-"+t.nav,e);i&&i.length&&(t.enable?i.removeClass("x-ui-disable"):i.addClass("x-ui-disable",!i.hasClass("x-ui-disable")))}},close:function(){if(this.opened){var t=this,e=this.options;this.opened=!1,this.$mask&&this.$mask.removeClass("dark-in"),this.scrollLock&&this.scrollLock.release(),this.element.removeClass("modal-in").transitionEnd(function(i){FXM.Utils.applyFunc(t,e.onClose,[],!1),t.element.remove(),t.$mask&&t.$mask.remove()})}},show:function(){if(!this.opened){var t=this,e=this.options;this.opened=!0,setTimeout(function(){t.scrollLock=FXM.Utils.scrollLock($("body")),t.$mask&&t.$mask.addClass("dark-in").insertBefore(t.element),t.element.addClass("modal-in").transitionEnd(function(i){FXM.Utils.applyFunc(t,e.onShow,[],!1)})},100)}}}),function(t){FXM.Form=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.Form._super._defaults.apply(this,arguments),{baseCls:"x-form",appId:null,entryId:null,dataId:null,authGroupId:null,title:"",submitUrl:FXM.Utils.getApi(FXM.API.data.create),submitData:null,mode:"new",extParam:null,submitRule:FXM.CONSTS.SUBMIT_RULE.KEEP,widgetOptAuth:{},navBtns:[{nav:"submit",text:"",onClick:function(){this.doVerifyAndSubmit()}}],validators:[],editValue:null,comment:null,signature:null,cacheEnable:!1,updateTime:null,flowAction:null,ignoreOptAuth:!0})},_init:function(){FXM.Form._super._init.apply(this,arguments);var e=this,i=this.options;if(FXM.STATIC.DATAID=i.dataId,FXM.Utils.setPageTitle(i.title),FXM.STATIC.EntryRecNo=null,this.childWidgets={},FXM.Utils.isObjectEmpty(i.items))this._createEmptyInfo();else{this.$widgetWrapper=t('<div class="widget-wrapper"/>').appendTo(this.element);var a=t("<ul/>").appendTo(this.$widgetWrapper);this.rely=new FXM.RelyProcessor(i.items),this.association=new FXM.AssociationProcessor(i.items),FXM.Utils.forEach(i.items,function(t,i){e._createItem(t,i,a)}),FXM.Utils.forEach(this.association.getVisibleMap(),function(t,i){e._setWidgetVisible(t,i)}),this._createBtns(),this._isEditMode()?(FXM.Utils.forEach(i.editValue,function(t,i){var a=e.getWidgetByName(t);a&&(a.setValue(i),a.effectItemLinkWidgets())}),this._setLinkQuery()):(this.loadFormData(),i.cacheEnable&&this.needCache||FXM.Utils.forEach(this.rely.getDefaultRely(),function(t,i){e._fireWidgetRelyEvent(i,e.rely.options.defaultVersion)}))}},_createEmptyInfo:function(){t('<div class="empty-info"/>').append(t('<div class="empty-img"/>')).append(t('<div class="empty-title"/>').text("")).appendTo(this.element)},_isEditMode:function(){return"edit"===this.options.mode},_createItem:function(e,i,a){var n=this,r=this.options,s={render:t('<li class="f-line"/>').appendTo(a),description:i.description,label:i.label,mode:r.mode,widget:t.extend(FXM.FormUtils.getWidgetDefaultConfig(i.widget.type),i.widget,this._getWidgetOptAuth(i)),onAssociate:function(t,e){n._dealWidgetAssociation(t,e)},onAddSubWidget:function(t){n._addLinkQuery(t)},onCalFormula:function(t){return n._calFormula(t,{})},onGetFilter:function(){return n._iterAddFilter(this)},onGetLinkFilter:function(e,i){var a=this.element,r=[];return FXM.Utils.forEach(e,function(e,s){var o=-1;n._isSubformWidget(s.rely)&&(o=t(a).closest(".x-subform-line").index());var l=n.getWidgetByName(s.rely,o);if(l){var c=l.getLinkValue();if(!FXM.Utils.isObjectEmpty(c)){var h=n._createDataFilter(l,c,s.link);h.entryId=i,r.push(h)}}}),r},onGetLinkValue:function(t){var e=n.getWidgetByName(t);if(e)return e.getLinkValue()},onStopEdit:function(){n._fireWidgetRelyEvent(this,null),n.needCache=!0},onValueChange:function(){n.needCache=!0}},o=new FXM.FormItem(s);this._addLinkQuery(o),this.rely.addDefaultRely(o),this.childWidgets[o.getWidgetName()]=o},_getWidgetOptAuth:function(e){var i=this.options,a=this;return i.ignoreOptAuth?{}:("subform"===e.widget.type&&FXM.Utils.forEach(e.widget.items,function(i,n){t.extend(n.widget,a._getWidgetOptAuth({widget:{widgetName:[e.widget.widgetName,n.widget.widgetName].join(".")}}))}),i.widgetOptAuth[e.widget.widgetName]||{visible:!1,enable:!1})},_iterAddFilter:function(e,i){var a=this;if(e){var n=e.getRely();if(n){i||(i={});var r=e.getWidgetName();if(e.isSubformWidget()&&(r=[e.getSubformName(),r].join(".")),!i[r]){i[r]=!0;var s=[];return n.data&&n.ref&&FXM.Utils.forEach(n.widgets,function(r,o){if(i[o])return!1;var l=-1;a._isSubformWidget(o)&&e.isSubformWidget()&&(l=t(e.element).closest(".x-subform-line").index());var c=a.getWidgetByName(o,l);if(!c)return!1;var h=c.getLinkValue(),u=a._createDataFilter(c,h,n.ref.field);return u.entryId=n.ref.formId,s.push(u),s=s.concat(a._iterAddFilter(c,i)||[]),!1}),s}}}},_createBtns:function(){var e=this.options;this._createFlowComment(),this._isEditMode()?new FXM.FormBtnGroup({render:t("<div/>").appendTo(this.element),btns:e.navBtns,target:this}):this._createSubmitBtns()},_createSubmitBtns:function(){var e=this.options,i=this;this.element.addClass("relative");var a=t('<div class="x-form-footer x-btn-pane"/>').appendTo(this.$widgetWrapper),n="",r={},s=0;FXM.Utils.forEach(e.navBtns,function(t,e){var i=e.style||"blue";n+='<div class="nav-item"><button class="x-btn style-'+i+'" role="'+e.nav+'">'+FXM.Utils.escapeHtmlSpecialChar(e.text)+"</button></div>",r[e.nav]=e.onClick,s++}),a.addClass("col-"+s).append(n),a.on("click","button",function(e){var a=t(e.currentTarget).attr("role");FXM.Utils.applyFunc(i,r[a],[a],!1)})},_createFlowComment:function(){var e=this.options,i=e.comment,a=e.signature,n=a&&a.enable,r=i&&i.enable,s=i&&i.required;if(r||n){var o=t('<div class="f-line has-top-border" />').appendTo(this.element),l=t('<div class="f-label"></div>').appendTo(o),c="";if(r?s?c="*":n&&(c=""):n&&(c="*"),!FXM.Utils.isEmpty(c)&&l.append(t('<span class="f-required"/>').text(c)),r){var h=t('<div class="flow-approval-textarea" />').appendTo(o);this.flowApproval=new FXM.TextArea({render:h,allowBlank:!e.comment.required})}n&&(this.flowSignature=new FXM.Signature({render:t('<div class="custom-flow-signature"/>').appendTo(o),allowBlank:!1,allowSign:FXM.Vip.hasSignature()}))}},_fireWidgetRelyEvent:function(t,e){this.rely.fireRely(t,e,this)},dealRely:function(t,e,i,a){var n=this,r=null,s=e.getRely();if(e.isSubformWidget()&&(r=e.element.closest(".x-subform-line").index()),s.formula){var o=s.formula.formula,l={};l[t]=a,FXM.Utils.forEach(s.widgets,function(t,e){var i=n.getWidgetByName(e,r);if(FXM.Utils.isArray(i)){var a=[];FXM.Utils.forEach(i,function(t,e){a.push(e.getLinkValue())}),l[e]=a}else i&&(l[e]=i.getLinkValue())});var c=n._calFormula(o,l);e.setValue(c),n._fireWidgetRelyEvent(e,i)}if(s.ref&&s.data){var h=s.data;switch(e.getWidgetType()){case"combo":case"combocheck":e.getAsync()&&(e.items=null),e.rebuild(),n._fireWidgetRelyEvent(e,i);break;case"dept":case"deptgroup":e.getValueOption()===FXM.CONSTS.WIDGET_VALUE_OPTION.CUSTOM?(e.clearLimit(),n._fireWidgetRelyEvent(e,i)):n._dealValueDataLink(h,e,i);break;default:n._dealValueDataLink(h,e,i)}}n._getLinkQueryData(e)},_dealValueDataLink:function(t,e,i){var a=this,n=this._iterAddFilter(e),r=!0;if(FXM.Utils.forEach(n,function(e,i){if(i.entryId===t.formId){if(FXM.Utils.isObjectEmpty(i.value))return r=!1,!1;var a=!0;return FXM.Utils.forEach(i.value,function(t,e){if(!FXM.Utils.isEmpty(e))return a=!1,!1}),a?(r=!1,!1):void 0}}),!r)return e.setValue(null),void this._fireWidgetRelyEvent(e,i);t.filter={cond:n,rel:FXM.CONSTS.FILTER_RELATION.AND},FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.link),data:t},function(t){a.rely.checkAsyncVersion(e,i)&&(e.setValue(t.value),a._fireWidgetRelyEvent(e,i))})},_addLinkQuery:function(t){t&&"linkquery"===t.getWidgetType()&&(this.linkQueryWidgets||(this.linkQueryWidgets=[]),this.linkQueryWidgets.push(t))},_setLinkQuery:function(){var t=this;FXM.Utils.forEach(this.linkQueryWidgets,function(e,i){t._getLinkQueryData(i)})},_getLinkQueryData:function(t){var e=this;if("linkquery"===t.getWidgetType()){var i=t.getWidgetName(),a=null;t.isSubformWidget()&&(i=[t.getSubformName(),i].join("."),a=t.element.closest(".x-subform-line").index()),this.rely.setStateMap(i,this.rely.RELY_END),this.rely.setAsyncMap(i,this.rely.RELY_END);var n=[],r=t.getLinkForm();if(r){var s=!0;FXM.Utils.forEach(t.getLinkFilter(),function(t,i){var o=e.getWidgetByName(i.rely,a);if(o){var l=o.getLinkValue();if(FXM.Utils.isObjectEmpty(l))return s=!1,!1;var c=e._createDataFilter(o,l,i.link);c.entryId=r,n.push(c)}}),s&&t.reload({cond:n,rel:FXM.CONSTS.FILTER_RELATION.AND})}}},_createDataFilter:function(t,e,i){var a={};if(t){var n=e;if("datetime"===t.getLinkType()){var r=FXM.Utils.date2Str(new Date(e),t.getFormat()||"yyyy-MM-dd HH:mm:ss");n=[r,r]}a=FXM.Utils.getLinkFilter({type:t.getLinkType(),name:i},n)}return a},_isSubformWidget:function(t){return t.indexOf(".")>-1},getValue:function(){var t={};this.checkRepeat=[];var e=this.childWidgets;for(var i in this.childWidgets){var a=e[i];if(a&&FXM.Utils.allowValueSubmit(a.getWidgetType())){var n=a.getValue();if(a.isNoRepeat()&&!FXM.Utils.isEmpty(n)){var r={};r[i]=n,this.checkRepeat.push(r)}t[i]={data:n,visible:this._isWidgetVisible(a)}}}return t},_setWidgetVisible:function(t,e){var i=this.getWidgetByName(t);if(i){this.widgetVisibleMap||(this.widgetVisibleMap={});var a=i.isVisible(),n=i.element.closest(".f-line");a&&e?(this.widgetVisibleMap[t]=!0,n.removeClass("x-ui-hidden")):(this.widgetVisibleMap[t]=!1,n.addClass("x-ui-hidden"))}},_dealWidgetAssociation:function(t,e){var i=this,a=this.association.dealAssociation(t,e);FXM.Utils.forEach(a,function(t,e){i._setWidgetVisible(t,e)})},_isWidgetVisible:function(t){return!(!t||!t.isVisible())&&!(this.widgetVisibleMap&&!1===this.widgetVisibleMap[t.getWidgetName()])},getWidgetByName:function(t,e){if(FXM.Utils.isEmpty(t)||!this.childWidgets)return null;var i;if(this._isSubformWidget(t)){var a=this.childWidgets[[t.split(".")[0]]];a&&(i=a.getWidgetByName(t.split(".")[1],e))}else i=this.childWidgets[t];return i},checkFlowComment:function(t){var e=this.options;if(this.flowApproval||this.flowSignature)if("save"===e.submitData.flowAction){var i=this.flowApproval&&this.flowApproval.getValue();if(i){var a=FXM.Utils.isSupportClipboard(),n=a?"":"";FXM.UI.confirm(n,function(){a&&FXM.Utils.copyToClipboard(i,function(){FXM.UI.toast({type:"success",msg:""})}),t&&t()})}else t&&t()}else{var r=!this.flowApproval||this.flowApproval.checkValidate(),s=!this.flowSignature||this.flowSignature.checkValidate();if(r&&s)t&&t();else{var o=r?"":"";r||s||(o=""),FXM.UI.toast({type:"warning",msg:o})}}else t&&t()},checkValidate:function(){var t=this,e=this.options,i=!0,a="",n=FXM.CONSTS.INVALID_TYPE.INVALID;for(var r in this.childWidgets){var s=this.childWidgets[r];this._isWidgetVisible(s)&&(s.checkValidate()?this.clearErrorMsg(s):(i=!1,this.setErrorMsg(s)))}return i&&FXM.Utils.forEach(e.validators,function(e,n){if(!t._calFormula(n.formula))return i=!1,a=n.remind,!1}),this.setInvalidType(i,n),i||(this.validationErrorMsg=a),i},_calFormula:function(t,e){var i=this,a=t.split(/(\$[0-9a-zA-Z\._#@]+)/g),n=[];FXM.Utils.forEach(a,function(t,a){if("$_widget_"===(a+="").substring(0,9)||"$ext"===a.substring(0,4)){var r=a.replace("$","").split("#"),s=r[0],o=r[1];if(FXM.Utils.isEmpty(o)){var l;if(e)l=e[s];else{var c=i.getWidgetByName(s);FXM.Utils.isArray(c)?(l=[],FXM.Utils.forEach(c,function(t,e){l.push(e.getLinkValue())})):c&&(l=c.getLinkValue())}var h=JSON.stringify(l)+"";h=(h=h.replace(/\\\\(?=.+)/g,'"+CHAR(92)+"')).replace(/\\\"(?=.+)/g,'"+CHAR(34)+"'),!isNaN(l)&&l<0&&(h="("+h+")"),n.push(h)}else n.push('"'+a+'"')}else n.push(a)});var r;try{r=FXM.FormulaCalcParser.parse(n.join(""))}catch(t){r=""}return r},setErrorMsg:function(t){var e=t.element.closest(".f-line");FXM.Utils.setErrorMsg(t,e)},clearErrorMsg:function(t){t.element.closest(".f-line").children(".f-error-info").remove()},getFormDataKey:function(){var t=this.options;return FXM.Store.getKey("formData",{appId:FXM.STATIC.APPID,entryId:t.entryId})},removeFormData:function(){this.options.cacheEnable&&FXM.Store.remove(this.getFormDataKey())},loadFormData:function(){var t=this.options;if(t.cacheEnable){this._bindCacheEvent();var e=FXM.Store.get(this.getFormDataKey());e&&e.time>=t.updateTime&&e.data&&(FXM.Utils.forEach(this.childWidgets,function(t,i){var a=e.data[t];!i||FXM.CONSTS.LIMIT_FIELDS.noCache.indexOf(i.getWidgetType())>-1||(i.setCacheValue(a),i.effectItemLinkWidgets())}),this._setLinkQuery(),this.needCache=!0),this.removeFormData()}},saveFormData:function(){var e=this.options;if(e.cacheEnable&&this.needCache&&t("body").find(this.element).length&&this.rely.checkAsyncState()){var i={},a=this.childWidgets;FXM.Utils.forEach(a,function(t,e){if(e&&FXM.Utils.allowValueSubmit(e.getWidgetType())&&!(FXM.CONSTS.LIMIT_FIELDS.noCache.indexOf(e.getWidgetType())>-1)){var a=e.getCacheValue();FXM.Utils.isObjectEmpty(a)||(i[t]=a)}}),FXM.Utils.isObjectEmpty(i)||(FXM.GB.user&&FXM.Store.forEach(function(t){/formData[0-9a-f]{72}/.test(t)&&!new RegExp(FXM.GB.user._id).test(t)&&FXM.Store.remove(t)}),FXM.Store.set(this.getFormDataKey(),{data:i,time:e.updateTime},1))}},_bindCacheEvent:function(){var e=this;this.options.cacheEnable&&(FXM.FORMCACHE=this,t(window).one("unload",function(){e.saveFormData()}))},doVerifyAndSubmit:function(t){var e=this;this.checkValidate()?this.checkFlowComment(function(){e.doSubmit(t)}):FXM.UI.toast({type:"warning",msg:this.validationErrorMsg})},doSubmit:function(e){var i=this,a=this.options;if(this.rely.checkAsyncState()){if(!this.ajaxLoading){this.ajaxLoading=!0,FXM.UI.showLoader(),this.flowApproval&&(a.submitData.comment=this.flowApproval.getValue()),this.flowSignature&&(a.submitData.signature=this.flowSignature.getValue());var n=t.extend({values:this.getValue(),entryId:a.entryId,formId:a.entryId,checkRepeat:this.checkRepeat,flowAction:a.flowAction,hasResult:!0},a.submitData);FXM.Utils.isNull(a.authGroupId)||t.extend(n,{authGroupId:a.authGroupId}),a.extParam&&t.extend(n.values,{ext:{data:a.extParam,widgetType:"text"}}),FXM.Utils.sendCorpOpLog(this._isEditMode()?"jdy_form_data_edit":"jdy_form_data_submit"),FXM.Utils.dataAjax({url:a.submitUrl,data:n},function(t,a){FXM.Utils.applyFunc(i,e,[t,n.flowAction],!1),i.needCache=!1,t.flowFailureCode&&i._showFlowFailHint(t.flowFailureCode)},function(t,e){var a=FXM.Utils.parseJSON(t.responseText),n=a.msg||"";4002===a.code?(FXM.UI.toast({type:"warning",msg:n}),a.meta&&FXM.Utils.forEach(a.meta.repeatFields,function(t,e){var a=i.getWidgetByName(e);a&&(a.setInvalidType(!1,FXM.CONSTS.INVALID_TYPE.REPEAT),i.setErrorMsg(a))})):FXM.UI.toast({type:"error",msg:n})},function(){FXM.UI.closeLoader(),i.ajaxLoading=!1}),FXM.STATIC.DATAID&&FXM.STATIC.DATAID!==n.dataId&&FXM.Utils.dt(FXM.CONSTS.TRACKER.FLOW_DATA_SUBMIT_ERROR,JSON.stringify({staticDataId:FXM.STATIC.DATAID,data:n}))}}else FXM.UI.alert({title:"",msg:"",buttonName:""})},_showFlowFailHint:function(t){if(!FXM.Utils.isExternalLink()){var e="",i=FXM.CONSTS.FLOW_FAIL_CODE;t===i.FORWARD_CHARGER?e="":t===i.FORWARD_COND?e="":t===i.BACK&&(e=""),e&&FXM.UI.alert({msg:e,buttonName:""})}}}),FXM.register("form",FXM.Form)}(Zepto),function(t){FXM.Address=FXM.extend(FXM.BaseFormWidget,{DATA:{"":{"":["","","","","","","","","","","","","","","",""]},"":{"":["","","","","","","","","","","","","","","","","",""]},"":{"":["","","","","","","","","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","",""],"":["","","","","","",""],"":["","","","","","","","","","","","","","","","","","","",""]},"":{"":["","","","","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","","","","","","",""],"":["","","","","",""],"":["","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","",""],"":["","","","","","","","","","","","","",""],"":["","","","",""],"":["","","","","","","","","","","","","","",""]},"":{"":["","","","","","","","",""],"":["","","","","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","","",""],"":["","",""],"":["","","","","","",""],"":["","","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","","","","","","",""],"":["","","","","",""],"":["","",""],"":["","","","","","","","","","","",""]},"":{"":["","","","","","","","","","","","","",""],"":["","","","","","","","","","",""],"":["","","","","","","","",""],"":["","","","","",""],"":["","","","","","",""],"":["","","","","",""],"":["","","","","","","",""],"":["","","","","","",""],"":["","","","","","","",""],"":["","","","","","",""],"":["","","",""],"":["","","","","","","",""],"":["","","","","",""],"":["","","","","",""]},"":{"":["","","","","","","","","","","","","",""],"":["","","","",""],"":["","","","","",""],"":["","","","","","","","",""],"":["","","",""],"":["","","","","",""],"":["","","","",""],"":["","","","","","",""],"":["","","","","","","",""]},"":{"":["","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","",""],"":["","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","",""],"":["","","","","","","","","","","","","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","","",""],"":["","","",""],"":["","","","","","","",""],"":["","","","","","","","","","","","","","","",""],"":["","","","","","",""]},"":{"":["","","","","","","","","","","","","","","","",""]},"":{"":["","","","","","","","","","","","",""],"":["","","","","","",""],"":["","","","","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","","",""],"":["","","","",""],"":["","","","","","","",""],"":["","","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","",""],"":["","","","","","",""],"":["","","","","",""],"":["","","","","","",""]},"":{"":["","","","","","","","","","","","",""],"":["","","","",""],"":["","","","","","",""],"":["","","","","","","","",""],"":["","","","","","","","",""],"":["","","","","","","","","","",""],"":["","","","","",""],"":["","","","","","","","",""],"":["","","","","","","","","","",""],"":["","","",""],"":["","","","","",""]},"":{"":["","","","","","","","","",""],"":["","","","","","","","","","",""],"":["","","","","","","","",""],"":["","","",""],"":["","","","","","","",""],"":["","","","","","","","",""],"":["","","",""],"":["","","","","","",""],"":["","","","","","",""],"":["","","","","","",""],"":["","","","",""],"":["","","",""],"":["","","","","","","","","",""],"":["","","","","","",""],"":["","","",""],"":["","","","","",""]},"":{"":["","","","","","","","","","","","",""],"":["","","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","",""],"":["","","","",""],"":["","","","","","","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","",""],"":["","","","","","","","","","",""]},"":{"":["","","","","","","","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","",""],"":["","","","","",""],"":["","","","","","","","","","","","",""],"":["","",""],"":["","","","","","","","","","",""],"":["","","",""],"":["","","",""]},"":{"":["","","","","","","","","","",""],"":["","","","","","","","",""],"":["","","","","","","","","","","","","",""],"":["","","","",""],"":["","","","","","","","",""],"":["","","","","","","","","","","",""],"":["",""],"":["","","","","","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","","","","",""],"":["","","",""],"":["","","","","",""],"":["","","","","","",""],"":["","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","","",""],"":["","","","","","","",""]},"":{"":["","","","","","","","","","","","","","",""],"":["","","","","","","","",""],"":["","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","","","","","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","",""],"":["","","","","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","","","","","",""],"":["","","","","",""],"":["","","","","","","","","","",""],"":["","","","",""],"":["","","","","",""],"":["","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","","","","","",""]},"":{"":["","","","","","","","","","","","","","","",""],"":["","","",""],"":["","","","","","","","","",""],"":["","","","","",""],"":["","","","",""],"":["","","","","","","",""],"":["","","","","","","",""],"":["","",""],"":["","","","","",""],"":["","","","","","","","",""],"":["","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","","","",""],"":["","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","","","",""]},"":{"":["","","","","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","",""],"":["","","","","","","","","","","",""],"":["","","","",""],"":["","","","","",""],"":["","","","","","","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","","","","",""],"":["","","",""],"":["","","","","","","",""]},"":{"":["","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],"":["","","",""],"":["","","","",""],"":["","","","","","","",""],"":["","","","","",""],"":["","","","","","",""],"":["","","","","","","","","",""],"":["","","","","",""],"":["","","","","","","",""],"":["","","","","","","",""],"":["","","","","","",""],"":["","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","","",""],"":["","","","",""],"":["","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","","","","","",""],"":["","",""]},"":{"":["","","","","","","","","","","",""],"":["","","","","","","","","","","",""],"":["","","",""],"":["","","","","","",""],"":["","","","","","","","","","","","","","","","",""],"":["","","","",""],"":["","","","","","","","","","",""],"":["","","","",""],"":["","","","","",""],"":["","","","","","","","","",""],"":["","","","",""],"":["","","","","","","",""],"":["","","","","","",""],"":["","","","",""]},"":{"":["","","",""],"":["","","","",""],"":["",""],"":["",""],"":["",""],"":["","",""],"":["","","","","","","",""],"":["","","","",""],"":["",""],"":["",""],"":["","","","","","","","","","",""],"":["","","","","",""],"":["","",""],"":["",""],"":["","",""],"":["","",""],"":["","","","","","","","",""],"":["",""],"":["","",""]},"":{"":["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},"":{"":["","","","","","","","","","","","","","","","","","","","",""],"":["","","","",""],"":["","","","","","",""],"":["","","","","",""],"":["","","","","",""],"":["","","","","","",""],"":["","","","","","","","","","",""],"":["","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","",""],"":["","","","",""],"":["","","","","",""],"":["","","","","","","",""],"":["","","","","","","","","",""],"":["","","",""],"":["","","","","","",""],"":["","","","","","",""],"":["","","","",""],"":["","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","",""]},"":{"":["","","","","","","","","",""],"":["","","","","","",""],"":["","","","","","","","","","","","","",""],"":["","","","",""],"":["","","","","","","","","",""],"":["","","","","","","",""],"":["","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","","",""]},"":{"":["","","","","","","","","","","","","",""],"":["","","","",""],"":["","","","",""],"":["","","","","","","","","",""],"":["","","","","","","",""],"":["","","","","","","","",""],"":["","","","","","","","",""],"":["","","","","","","","","","",""],"":["","","","","","","","","",""],"":["","",""],"":["","","","","","","","","","","",""],"":["","","","","","","",""],"":["","","",""],"":["","",""],"":["","","","",""],"":["","","","","","","","","","","","",""]},"":{"":["","","","","","","",""],"":["","","","","","",""],"":["","","","","","","","","","",""],"":["","","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","",""]},"":{"":["","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","",""],"":["","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","","","","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","","","","","","","",""]},"":{"":["","","","","","","",""],"":["","","","",""],"":["","","","","","",""],"":["","","","","","","","",""],"":["",""],"":["","","","","","",""],"":["","","","","","","",""],"":["","","","","","",""],"":["","","",""],"":["","","","","",""],"":["","","","","","",""],"":["","","","","","",""],"":["","","","","","","",""],"":["","","","","","","",""]},"":{"":["","","","","","",""],"":["","","","","",""],"":["","","","","",""],"":["","","",""],"":["","","","",""],"":["","","",""],"":["","","","","",""],"":["","","","","","","",""]},"":{"":["","","","","",""],"":["","","","",""],"":["","","","",""],"":["","",""],"":["","",""]},"":{"":["","","","","","","","",""],"":["","","","",""],"":["","","",""],"":["","",""],"":["","","","","","","",""],"":["","","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","","","",""],"":["","","","","","",""],"":["","",""],"":[""],"":["","",""],"":[""],"":[""],"":[""],"":[""],"":["","","","","","",""],"":["","","","","","","","","","",""],"":["","","","","","","","",""],"":["","","",""],"":["","","",""]},"":{"":["","","",""]},"":{"":["","",""]},"":{"":["","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],"":["","","","","","",""],"":["","",""],"":["",""],"":["","","","","","","","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],"":["","","","","","","","","","","",""],"":["","","","","","","","","","","","",""],"":["","","","","","","","","","","","","",""],"":["","","","","",""],"":["","","","","",""],"":["","","",""]},"":{"":[""]}},_defaults:function(){return t.extend(FXM.Address._super._defaults.apply(this,arguments),{baseCls:"x-address",needDetail:!0,onStopEdit:null,allowBlank:!0})},_init:function(){FXM.Address._super._init.apply(this,arguments);var e=this,i=this.options;this.address={},this.$label=t('<div class="x-picker-label nowrap">').click(function(){e.isEnabled()&&e._showPicker()}).appendTo(this.element),this.options.needDetail&&(this.element.addClass("has-detail"),this.detailInput=new FXM.TextArea({render:t("<div/>").appendTo(this.element),waterMark:"",allowBlank:i.allowBlank}))},_initDefaultValue:function(t){this.setValue(t)},_isEmptyPick:function(t){return!!FXM.Utils.isEmpty(t)||t.indexOf("-")>-1},_showPicker:function(){var t=this,e=this.options;new FXM.Picker({cols:[{key:"province",cssClass:"col-province",values:t._getProvinces(),onChange:function(e){var i=e.getValue();t._isEmptyPick(i)&&(i=null),this.replaceColValues("city",t._getCities(i))}},{key:"city",cssClass:"col-city",values:t._getCities(this.address.province),onChange:function(e){var i=this.getValue(),a=i.province,n=i.city;t._isEmptyPick(a)?(a=null,n=null):t._isEmptyPick(n)&&(n=null),this.replaceColValues("district",t._getDistricts(a,n))}},{key:"district",cssClass:"col-district",values:t._getDistricts(this.address.province,this.address.city)}],value:this.address,onOk:function(){var i=this.getValue(),a={},n="";t._isEmptyPick(i.province)||(a.province=i.province,n+=i.province,t._isEmptyPick(i.city)||(a.city=i.city,n+=" "+i.city),t._isEmptyPick(i.district)||(a.district=i.district,n+=" "+i.district)),t.address=a,t.$label.text(n),this.close(),FXM.Utils.applyFunc(t,e.onStopEdit,[],!1)}}).show()},_getProvinces:function(){var t=["--"];for(var e in this.DATA)t.push(e);return t},_getCities:function(t){var e=["--"];if(t&&this.DATA[t])for(var i in this.DATA[t])e.push(i);return e},_getDistricts:function(t,e){var i=[];return t&&e&&this.DATA[t]&&(i=this.DATA[t][e]||[]),i=["--"].concat(i)},setEnable:function(t){FXM.Address._super.setEnable.apply(this,arguments),this.detailInput&&this.detailInput.setEnable(t)},checkValidate:function(){var t=!0;if(!this.options.allowBlank){var e=this.address;t=!FXM.Utils.isEmpty(e.province)&&!FXM.Utils.isEmpty(e.city)&&!FXM.Utils.isEmpty(e.district)}return this.detailInput&&(t=this.detailInput.checkValidate()&&t),this.setInvalidType(t,FXM.CONSTS.INVALID_TYPE.BLANK),t},getValue:function(){var t=this.address,e={};if(FXM.Utils.isEmpty(t.province)||(e.province=t.province,FXM.Utils.isEmpty(t.city)||(e.city=t.city,FXM.Utils.isEmpty(t.district)||(e.district=t.district))),this.detailInput){var i=this.detailInput.getValue();FXM.Utils.isEmpty(i)||(e.detail=i)}return e},setValue:function(t){if(this.address=t||{},t){!FXM.Utils.isEmpty(t.detail)&&this.detailInput&&this.detailInput.setValue(t.detail);var e="";FXM.Utils.isEmpty(t.province)||(e+=t.province,FXM.Utils.isEmpty(t.city)||(e+=" "+t.city,FXM.Utils.isEmpty(t.district)||(e+=" "+t.district)),this.$label.text(e))}else this.$label.empty(),this.detailInput&&this.detailInput.setValue("")},getText:function(){var t=this.getValue();return[t.province,t.city,t.district,t.detail].join("")},getNullValue:function(){return{}}}),FXM.register("address",FXM.Address)}(Zepto),function(t){FXM.Location=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return t.extend(FXM.Location._super._defaults.apply(this,arguments),{baseCls:"x-location",needDetail:!0,onStopEdit:null,allowBlank:!0})},_init:function(){FXM.Location._super._init.apply(this,arguments),FXM.Utils.loadAMapScript(),this.initLocationView()},initLocationView:function(){var e=this;this.options;this.address={},t('<div class="location-btn"><i class="icon-location"/><span></span></div>').appendTo(this.element).click(function(){e.isEnabled()&&(e.needReset=!0,e._initData())})},_initData:function(){var e=this,i=this.options;this.mapId=FXM.STATIC.IDBase++,this.$content?this._getCurrentLocation():(this.$content=t('<div class="location-content"><div class="location-info">...</div></div>').prependTo(this.element),t('<div class="location-clear"></div>').appendTo(this.$content).click(function(){e.isEnabled()&&(e.address={},i.adjustable&&(e.map.destroy(),e.showMaker=null),e.$content.remove(),e.$content=null)}),i.adjustable&&(this.$content.addClass("location-edit"),t('<div class="map-container" id="'+this.mapId+'map-container"/>').appendTo(this.$content)),this._initLocation())},_showLocationPicker:function(){var e=this;t(".map-container").hide();var i=t('<div class="x-location-picker"><div class="location-bar"><button class="picker-cancel x-btn"></button><button class="picker-ok x-btn"></button><input class="location-search" id="tip-input" placeholder=""/></div><div class="location-body"><div class="location-map" id="location-map"/><ul class="location-list"/></div></div>').appendTo(t("body")),a=i.find(".location-list");i.find("input.location-search").focus(function(){t(this).addClass("search-select")}).blur(function(){t(this).removeClass("search-select");var i=t(this).val();e.searchKey!==i&&(a.empty(),e._search(i,a))});var n=new AMap.Map("location-map",{resizeEnable:!0,zooms:[15,17]});i.find(".location-bar").on("click","button",function(i){var a=t(i.currentTarget);n.destroy(),t(".x-location-picker").remove(),t(".map-container").show(),a.hasClass("picker-ok")&&e._setPosition()}),this._search("",a),a.on("click",".location-item",function(i){var a=t(i.currentTarget),r=a.data("location");t(".location-item").removeClass("select"),a.addClass("select"),e.marker.setPosition([r.lng,r.lat]),e.position=[r.lng,r.lat],e.detail=a.children(".location-address").text()+a.children(".location-name").text(),n.setFitView()}),this.marker=new AMap.Marker({map:n,position:e.position||e.lnglatXY}),n.setFitView()},_search:function(e,i){var a=this,n=this.options;this.searchKey=e,e=e||"",a.placeSearch?a.placeSearch.setPageIndex(1):a.placeSearch=new AMap.PlaceSearch({pageSize:50,pageIndex:1,type:"||||||||||||||||||"});var r=n.radius,s=FXM.UI.createLoadIcon().appendTo(i),o=function(n,l){s.remove(),l.poiList?(FXM.Utils.forEach(l.poiList.pois,function(e,a){t('<li class="location-item"><div class="location-name">'+a.name+'</div><div class="location-address">'+a.address+'</div><i class="icon-tick"/></li>').appendTo(i).data("location",{lng:a.location.lng,lat:a.location.lat})}),l.poiList.pageSize*l.poiList.pageIndex<l.poiList.count&&t('<div class="load-more"/>').text("").appendTo(i).click(function(){t(this).remove(),a.placeSearch.setPageIndex(l.poiList.pageIndex+1),a.placeSearch.searchNearBy(e,a.lnglatXY,r,o)})):FXM.UI.toast({type:"warning",msg:""})};this.placeSearch.searchNearBy(e,this.lnglatXY,r,o)},_initDefaultValue:function(t){this.setValue(t)},_getCurrentLocation:function(){var t=this;this.needReset&&(this.address={},this.location=null),this.$content.children(".location-info").text("..."),!1===FXM.UI.getLocation({accuracy:100,obj:this,success:t._onGetLocationComplete})&&this._geoLocation()},_setPosition:function(){this.showMaker.setPosition(this.position),this.map.setFitView(),this.regeocoder(this.position)},_initLocation:function(){var t=this;this.options;this.map=new AMap.Map(this.mapId+"map-container",{resizeEnable:!0,dragEnable:!1,doubleClickZoom:!1,zooms:[15,17]}),this.map.on("click",function(e){t._getLocationAndShowPicker()}),this._getCurrentLocation()},_getLocationAndShowPicker:function(){var t=this;this.isEnabled()&&(this.lnglatXY?this._showLocationPicker():!1===FXM.UI.getLocation({accuracy:100,obj:t,success:function(e){t._onGetLocationComplete(e),t.lnglatXY&&t._showLocationPicker()}})&&t._geoLocation())},_geoLocation:function(){var t=this,e=this.options;this.geolocation||(this.geolocation=new AMap.Geolocation({zoomToAccuracy:!0,showButton:!1,showCircle:!1,showMarker:!1}),this.map.addControl(this.geolocation),AMap.event.addListener(this.geolocation,"complete",function(i){var a=[i.position.getLng(),i.position.getLat()];t.lnglatXY=a;var n=a;FXM.Utils.isObjectEmpty(t.address)?t.regeocoder(a):(t._setLocationText(t.address),n=t.position),e.adjustable&&(t.showMaker?t.showMaker.setPosition(n):t.showMaker=new AMap.Marker({map:t.map,position:n}),t.map.setFitView())})),this.geolocation.getCurrentPosition()},_onGetLocationComplete:function(t){var e=this.options,i=t;this.lnglatXY=i;var a=i;FXM.Utils.isObjectEmpty(this.address)?this.regeocoder(i):(this._setLocationText(this.address),a=this.position),e.adjustable&&(this.showMaker?this.showMaker.setPosition(a):this.showMaker=new AMap.Marker({map:this.map,position:a}),this.map.setFitView())},regeocoder:function(t){var e=this;new AMap.Geocoder({radius:1e3,extensions:"all"}).getAddress(t,function(i,a){if("complete"===i&&"OK"===a.info){var n=a.regeocode.addressComponent,r=a.regeocode.formattedAddress.replace(n.province,"").replace(n.city,"").replace(n.district,"");e.address={province:n.province,city:n.city||n.province,district:n.district,detail:e.detail||r,lnglatXY:t},e.detail&&(e.detail=null),e._setLocationText(e.address)}})},_setLocationText:function(e){if(e){var i=this.options;if(i.lnglatVisible){this.$content.addClass("with-sub");var a=this.$content.children(".location-info").empty();t('<div class="sub-head"/>').text(e.province+e.city+e.district+e.detail).appendTo(a);var n=t('<div class="sub-info"/>').appendTo(a);if(e.lnglatXY&&e.lnglatXY.length)if(i.adjustable){var r=FXM.Utils.fixDecimalPrecision(e.lnglatXY[0],6),s=FXM.Utils.fixDecimalPrecision(e.lnglatXY[1],6);t('<div class="info-line">'+s+"</div>").appendTo(n),t('<div class="info-line">'+r+"</div>").appendTo(n)}else{var o=FXM.Utils.getLnglatText(e);t('<div class="info-line">'+o+"</div>").appendTo(n)}}else this.$content.children(".location-info").text(e.province+e.city+e.district+e.detail)}},checkValidate:function(){var t=this.options,e=this.options.allowBlank||!FXM.Utils.isObjectEmpty(this.address);if(this.setInvalidType(e,FXM.CONSTS.INVALID_TYPE.BLANK),t.limits&&t.limits.length>0&&!FXM.Utils.isObjectEmpty(this.address)){e=!1;var i=new AMap.LngLat(this.address.lnglatXY[0],this.address.lnglatXY[1]);FXM.Utils.forEach(t.limits,function(t,a){if(i.distance(a.position)<a.radius)return e=!0,!1}),this.setInvalidType(e,FXM.CONSTS.INVALID_TYPE.OUTSIDE)}return e},getValue:function(){return this.address||{}},setValue:function(t){var e=this;this.address=t,FXM.Utils.isObjectEmpty(t)||(this.position=t.lnglatXY,this.needReset=!1,FXM.Utils.loadAMapScript(function(){e._initData(),e._setLocationText(t)}))},getNullValue:function(){return{}},getText:function(){return FXM.Utils.address2Str(this.address,"","pcda")}}),FXM.register("location",FXM.Location)}(Zepto),function(t){FXM.Datetime=FXM.extend(FXM.BaseFormWidget,{VIEW_MODE:{DATE:1,DATE_TIME:2},UNIT:{YEAR:"",MONTH:"",DAY:""},_defaults:function(){return t.extend(FXM.Datetime._super._defaults.apply(this,arguments),{baseCls:"x-datetime",allowBlank:!0,defaultPickDate:null,format:"yyyy-MM-dd",onStopEdit:null,waterMark:""})},_init:function(){FXM.Datetime._super._init.apply(this,arguments),this.viewMode=this._initViewMode();var e=this,i=this.options.waterMark;this.$label=t('<div class="x-picker-label nowrap"/>').attr("data-watermark",i).on("click",function(t){e.isEnabled()&&e._showPicker()}).appendTo(this.element)},_initDefaultValue:function(t){this.setValue(t)},_initViewMode:function(){var t=this.options,e=this.VIEW_MODE,i=e.DATE;return t.format.match(/[YyDd]/)&&t.format.match(/[Hh]/)&&(i=e.DATE_TIME),i},_showPicker:function(){var t=this,e=this.options,i=this.VIEW_MODE,a=this._getCurrentDate(),n=t._getYearCol(),r=t._getMonthCol(),s=t._getDayCol(a.getFullYear(),a.getMonth()),o=t._getHourCol(),l=t._getMinuteCol(),c=t._getSecondCol(),h=[{key:"year",values:n.values,texts:n.texts,onChange:function(){var e=t._parsePickerValue(this.getValue());e.year&&1===e.month&&t._replaceDayCol(this,e.year,e.month)}},{key:"month",values:r.values,texts:r.texts,isCircular:!0,circularNum:7,onChange:function(){var e=t._parsePickerValue(this.getValue());t._replaceDayCol(this,e.year,e.month)}},{key:"day",values:s.values,texts:s.texts,isCircular:!0,circularNum:5}];this.viewMode===i.DATE_TIME&&(h=h.concat([{key:"hour",values:o.values,texts:o.texts,isCircular:!0,circularNum:5},{divider:!0,content:":"},{key:"minute",values:l.values,texts:l.texts,isCircular:!0},{divider:!0,content:":"},{key:"second",values:c.values,texts:c.texts,isCircular:!0}])),new FXM.Picker({cols:h,value:{year:a.getFullYear(),month:a.getMonth(),day:a.getDate(),hour:a.getHours(),minute:a.getMinutes(),second:a.getSeconds()},onOk:function(){var i=t._parsePickerValue(this.getValue());if(FXM.Utils.isNull(i.year)||FXM.Utils.isNull(i.month))t.setValue(null);else{var a=i.year,n=i.month,r=i.day||1,s=i.hour||0,o=i.minute||0,l=i.second||0;t.setValue(new Date(a,n,r,s,o,l))}this.close(),FXM.Utils.applyFunc(t,e.onStopEdit,[],!1)},onClear:function(){t.setValue(null),this.close(),FXM.Utils.applyFunc(t,e.onStopEdit,[],!1)}}).show()},_parsePickerValue:function(t){var e={};return t.year&&(e.year=parseInt(t.year,10)),t.month&&(e.month=parseInt(t.month,10)),t.day&&(e.day=parseInt(t.day,10)),t.hour&&(e.hour=parseInt(t.hour,10)),t.minute&&(e.minute=parseInt(t.minute,10)),t.second&&(e.second=parseInt(t.second,10)),e},_replaceDayCol:function(t,e,i){var a=this._getDayCol(e,i),n=t.getColumn("day").activeIndex||0;n=Math.min(n,a.values.length-1),t.replaceColValues("day",a.values,a.texts,n)},_getYearCol:function(){for(var t=[],e=[],i=1900;i<=2100;i++)t.push(i),e.push(i+this.UNIT.YEAR);return{values:t,texts:e}},_getMonthCol:function(){for(var t=[],e=[],i=0;i<=11;i++)t.push(i),e.push(i+1+this.UNIT.MONTH);return{values:t,texts:e}},_getDayCol:function(t,e){for(var i=[],a=[],n=this._getMonthDays(t,e),r=1;r<=(n||31);r++)i.push(r),a.push(r+this.UNIT.DAY);return{values:i,texts:a}},_getHourCol:function(){for(var t=[],e=[],i=0;i<=23;i++)t.push(i),e.push(FXM.Utils.leftPad(i+"",2,"0"));return{values:t,texts:e}},_getMinuteCol:function(){for(var t=[],e=[],i=0;i<=59;i++)t.push(i),e.push(FXM.Utils.leftPad(i+"",2,"0"));return{values:t,texts:e}},_getSecondCol:function(){for(var t=[],e=[],i=0;i<=59;i++)t.push(i),e.push(FXM.Utils.leftPad(i+"",2,"0"));return{values:t,texts:e}},_getMonthDays:function(t,e){var i=parseInt(t,10),a=parseInt(e,10),n=[31,28,31,30,31,30,31,31,30,31,30,31];return 0!=i%4||0==i%100&&0!=i%400||1!==a?n[a]:29},_getCurrentDate:function(){var t=this.options;return FXM.Utils.isNull(this.value)?t.defaultPickDate?new Date(t.defaultPickDate):new Date:new Date(this.value)},getValue:function(){return FXM.Utils.isNull(this.value)?null:this.value},setValue:function(t){var e=this.options;if(FXM.Utils.isNull(t))return this.value=null,void this.setText("");var i=null;i="today"===t?new Date:new Date(t),this.viewMode===this.VIEW_MODE.DATE&&i.setHours(0,0,0),i.setMilliseconds(0);var a=i.getTime();if(isNaN(a))return this.value=null,void this.setText("");this.value=a,this.setText(FXM.Utils.date2Str(new Date(this.value),e.format))},getText:function(){return this.$label.text()},setText:function(t){this.$label.text(t)},checkValidate:function(){var t=this.options.allowBlank||!FXM.Utils.isEmpty(this.getValue());return this.setInvalidType(t,FXM.CONSTS.INVALID_TYPE.BLANK),t}}),FXM.register("datetime",FXM.Datetime)}(Zepto),function(t){FXM.Text=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return t.extend(FXM.Text._super._defaults.apply(this,arguments),{baseCls:"x-text",allowBlank:!0,noRepeat:!1,waterMark:"",regex:null,onStopEdit:null})},_init:function(){FXM.Text._super._init.apply(this,arguments);var t=this.options,e=this;this.editComp=this._createEditComp().appendTo(this.element),t.waterMark&&this.editComp.attr("placeholder",t.waterMark),this.editComp.blur(function(){e.isEnabled()&&e._isScanEditable()&&e.checkValidate()&&(e.cacheValue=e.getValue(),FXM.Utils.applyFunc(e,t.onStopEdit,[],!1))}),t.scan&&this._createScanBtn()},_initDefaultValue:function(t){this.setValue(t)},_createEditComp:function(){return t('<input type="text" />')},_createScanBtn:function(){var e=this.options,i=this;this.element.addClass("scan-text"),t('<div class="scan-btn"><button class="x-btn"><i class="icon-scan"/></button></div>').appendTo(this.element).click(function(){e.enable&&e.scan&&FXM.UI.scanQRCode({type:e.scan.type,success:function(t){i.setValue(t),FXM.Utils.applyFunc(i,e.onStopEdit,[],!1)}})}),this.editComp.attr("placeholder","")},checkValidate:function(){var t=this.options,e=this.getValue(),i=FXM.CONSTS.INVALID_TYPE,a=!0,n=i.INVALID;if(FXM.Utils.isEmpty(e))n=i.BLANK,a=t.allowBlank;else if(!FXM.Utils.isEmpty(t.regex)){n=i.REGEX;try{a=new RegExp(t.regex).test(e)}catch(t){a=!1}}return this.setInvalidType(a,n),a},select:function(){this.editComp&&(this.editComp.select(),this.editComp.focus())},_isScanEditable:function(){var t=this.options;return!t.scan||t.scan.editable},setEnable:function(t){FXM.Text._super.setEnable.apply(this,arguments);this.options;t&&this._isScanEditable()?this.editComp.removeAttr("readOnly"):this.editComp.attr("readOnly","readOnly")},setValue:function(t){FXM.Utils.isEmpty(t)?(this.editComp.val(""),this.cacheValue=""):(this.editComp.val(t),this.cacheValue=t)},getValue:function(){return this.editComp.val().trim()},getCacheValue:function(){return this.cacheValue},getNullValue:function(){return""}}),FXM.register("text",FXM.Text)}(Zepto),function(t){FXM.TextArea=FXM.extend(FXM.Text,{_defaults:function(){return t.extend(FXM.TextArea._super._defaults.apply(this,arguments),{baseCls:"x-textarea",waterMark:""})},_createEditComp:function(){return t('<div class="text-area" contenteditable="true" />')},setEnable:function(t){FXM.Text._super.setEnable.apply(this,arguments),t?this.editComp.attr("contenteditable","true"):this.editComp.attr("contenteditable","false")},setValue:function(t){FXM.Utils.isEmpty(t)?(this.editComp[0].innerText="",this.cacheValue=""):(this.editComp[0].innerText=t,this.cacheValue=t)},getValue:function(){return this.editComp[0].innerText.trim()}}),FXM.register("textarea",FXM.TextArea)}(Zepto),function(t){FXM.Password=FXM.extend(FXM.Text,{_createEditComp:function(){return t('<input type="password"/>')}}),FXM.register("password",FXM.Password)}(Zepto),function(t){FXM.Number=FXM.extend(FXM.Text,{_defaults:function(){return t.extend(FXM.Number._super._defaults.apply(this,arguments),{baseCls:"x-number",waterMark:"",allowBlank:!0,allowDecimals:!1,onStopEdit:null})},_createEditComp:function(){return t('<input type="number" />')},checkValidate:function(){var t=this.options,e=this.editComp.val().trim(),i=FXM.CONSTS.INVALID_TYPE,a=!0,n=i.INVALID;if(FXM.Utils.isEmpty(e))n=i.BLANK,a=t.allowBlank;else{n=i.REGEX;var r="^[-]?[\\d]{0,}"+(t.allowDecimals?"[\\.]?[\\d]{0,}":"")+"$";try{a=new RegExp(r).test(e)}catch(t){a=!1}}return this.setInvalidType(a,n),a},setValue:function(t){t=FXM.Utils.fixDecimalPrecision(t),this.editComp.val(t),this.cacheValue=t},getValue:function(){var t=this.editComp.val().trim();return FXM.Utils.str2num(t)},getCacheValue:function(){var t=this.cacheValue;return FXM.Utils.str2num(t)},getNullValue:function(){return null}}),FXM.register("number",FXM.Number)}(Zepto),function(t){FXM.RadioGroup=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return t.extend(FXM.RadioGroup._super._defaults.apply(this,arguments),{baseCls:"x-radiogroup",allowBlank:!0,items:[],onStopEdit:null})},_init:function(){FXM.RadioGroup._super._init.apply(this,arguments);var t=this.options,e=this;this.allLinkWidgets={},this.itemLinkMap={},FXM.Utils.forEach(t.items,function(t,i){e._createItem(t,i)}),this._bindEvt()},_initDefaultValue:function(t){this.setValue(t)},_createItem:function(e,i){var a=this,n=this.options,r=t('<div class="group-item'+(i.selected?" select":"")+'"><div class="group-item-radio"></div></div>');t("<span/>").text(i.text).appendTo(r);var s=r.appendTo(this.element);i.isOther?(this.otherInput=new FXM.Text({render:t('<div class="text-other"/>').appendTo(s),enable:!!i.selected,waterMark:null,onStopEdit:function(){FXM.Utils.applyFunc(a,n.onStopEdit,[],!1)}}),s.addClass("item-other")):s.attr("option",i.value),i.widgetsMap&&(a.itemLinkMap[e]=i.widgetsMap),FXM.Utils.forEach(i.widgetsMap,function(t,e){a.allLinkWidgets[e]=!0})},_bindEvt:function(){var e=this,i=this.options;e.element.on("click",".group-item",function(a){if(e.isEnabled()){var n=t(a.currentTarget);if(!("input"===a.target.tagName.toLowerCase())||!n.hasClass("select")){n.toggleClass("select").siblings().removeClass("select");var r=n.hasClass("select");n.hasClass("item-other")?(e.otherInput.setEnable(r),r&&e.otherInput.editComp.focus()):e.otherInput&&e.otherInput.setEnable(!1),FXM.Utils.applyFunc(e,i.onAfterItemSelect,[e.otherInput&&e.otherInput.isEnabled()],!1),FXM.Utils.applyFunc(e,i.onStopEdit,[],!1)}}})},getLinkedItems:function(){var e=t(".select",this.element).index();return this.itemLinkMap[e]},checkValidate:function(){return!this.options.allowBlank&&FXM.Utils.isEmpty(this.getValue())?(this.setInvalidType(!1,FXM.CONSTS.INVALID_TYPE.BLANK),!1):(this.setInvalidType(!0),!0)},setEnable:function(t){FXM.RadioGroup._super.setEnable.apply(this,arguments);var e=this.element.find(".item-other");e.length>0&&(e.hasClass("select")&&t?this.otherInput.setEnable(!0):this.otherInput.setEnable(!1))},setValue:function(e){if(t(".select",this.element).removeClass("select"),!FXM.Utils.isEmpty(e)){var i=[];t(".group-item",this.element).each(function(a,n){t(n).attr("option")==e&&(i=t(n))}),i.length>0?i.addClass("select"):this.otherInput&&(this.element.find(".item-other").addClass("select"),this.otherInput.setValue(e),this.otherInput.setEnable(this.isEnabled()))}},getValue:function(){var e=t(".select",this.element);return e.length>0?e.hasClass("item-other")?this.otherInput.getValue():e.attr("option"):null},getNullValue:function(){return null}}),FXM.register("radiogroup",FXM.RadioGroup)}(Zepto),function(t){FXM.CheckBoxGroup=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return t.extend(FXM.CheckBoxGroup._super._defaults.apply(this,arguments),{baseCls:"x-checkboxgroup",allowBlank:!0,items:[],onStopEdit:null})},_init:function(){FXM.CheckBoxGroup._super._init.apply(this,arguments);var e=this.options,i=this;FXM.Utils.forEach(e.items,function(t,e){i._createItem(e).appendTo(i.element)}),this.element.on("click",".group-item",function(a){i.isEnabled()&&(t(a.currentTarget).toggleClass("select"),FXM.Utils.applyFunc(i,e.onStopEdit,[],!1))})},_createItem:function(e){var i=t('<div class="group-item '+(e.selected?" select":"")+'" option="'+e.value+'"><div class="group-item-checkbox "></div></div>');return t("<span/>").text(e.text).appendTo(i),i},_initDefaultValue:function(t){this.setValue(t)},checkValidate:function(){return this.options.allowBlank||0!==t(".select",this.element).length?(this.setInvalidType(!0),!0):(this.setInvalidType(!1,FXM.CONSTS.INVALID_TYPE.BLANK),!1)},setValue:function(e){t(".select",this.element).removeClass("select");var i=this;FXM.Utils.forEach(e,function(e,a){FXM.Utils.isEmpty(a)||t(".group-item",i.element).each(function(e,i){t(i).attr("option")==a&&t(i).addClass("select")})})},getValue:function(){var e=[],i=t(".select",this.element);return FXM.Utils.forEach(i,function(i,a){var n=t(a).attr("option");e.push(n)}),e},getNullValue:function(){return[]}}),FXM.register("checkboxgroup",FXM.CheckBoxGroup)}(Zepto),FXM.Combo=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return $.extend(FXM.Combo._super._defaults.apply(),{baseCls:"x-combo",waterMark:"",allowBlank:!0,async:null,asyncResultKey:"items",textField:"text",valueField:"value",items:[],onDataFilter:null,onItemCreate:null,onAfterItemSelect:null,onStopEdit:null,limitData:200,needSort:!0,emptyTip:"",key4Other:"__other__",onAfterAsync:null})},_init:function(){FXM.Combo._super._init.apply(this,arguments),this.value=null;var t=this,e=this.options;this.loadItems=null,this.isOther=!1,!1===FXM.Utils.applyFunc(this,e.onLabelCreate,[],!1)&&(this.$label=$('<div class="x-picker-label" data-watermark="'+e.waterMark+'"/>').on("click",function(e){t.isEnabled()&&t._showComboView()}).appendTo(this.element)),e.async||(this.loadItems=e.items||[],this.allLinkWidgets={},this.valueLinkMap={},FXM.Utils.forEach(this.loadItems,function(i,a){if(a.isOther&&(t.otherText=new FXM.Text({render:$("<div/>").appendTo(t.element),visible:!!a.selected,onStopEdit:function(){FXM.Utils.applyFunc(t,e.onStopEdit,[],!1)}}),t.isOther=!!a.selected),a.widgetsMap){var n=a.isOther?e.key4Other:a[e.valueField];t.valueLinkMap[n]=a.widgetsMap}FXM.Utils.forEach(a.widgetsMap,function(e,i){t.allLinkWidgets[i]=!0}),a.selected&&(t.value=a[e.valueField],t._createSelectResult(t.$label,a[e.textField]))}))},_createSelectResult:function(t,e){t&&(t.empty(),FXM.Utils.isEmpty(e)||t.append($('<span class="combo-select-result select-single"/>').text(e)))},_showComboView:function(){var t=this,e=this.options,i=new FXM.SlidePanel({customCls:"x-combo-picker",content:'<div class="combo-list"/><div class="combo-load-more x-ui-hidden"></div>',onHeadCreate:function(){var e=$('<div class="combo-search-header">');return t.search=new FXM.Search({render:$("<div />").appendTo(e),onSearch:function(){var e=i.element.find(".combo-list"),a=this.getValue();t._loadItems(e,a)}}),e},onClose:function(){t.changed&&(FXM.Utils.applyFunc(t,e.onAfterItemSelect,[t.otherText&&t.otherText.isVisible()],!1),FXM.Utils.applyFunc(t,e.onStopEdit,[],!1))},onShow:function(){var e=this.element.find(".combo-list");t._loadItems(e),t._bindEvt(i)},text4Left:"",text4Right:""});i.show(),this.changed=!1},getLinkedItems:function(){var t=this.options,e=this.getValue();return this.valueLinkMap?(this.otherText&&this.otherText.isVisible()&&(e=t.key4Other),this.valueLinkMap[e]):null},setEnable:function(t){FXM.Combo._super.setEnable.apply(this,arguments),this.otherText&&this.otherText.setEnable(t)},getValue:function(){return this.otherText&&this.otherText.isVisible()?this.otherText.getValue():this.value},getLinkValue:function(){var t=this.getValue();return t&&t.toString()},getNullValue:function(){return null},_loadItems:function(t,e){var i=this.options,a=this;t.empty(),this.startIndex=0,this.loadItems?a._createItemList(t,e):i.async&&i.async.url?(FXM.Utils.applyFunc(this,i.onBeforeAsync,[],!1),FXM.Utils.dataAjax({url:i.async.url,data:i.async.data},function(n,r){a.loadItems=[],FXM.Utils.forEach(n[i.asyncResultKey],function(t,e){if(!FXM.Utils.isEmpty(e)){var n={};n[i.textField]=e[i.textField]||e,n[i.valueField]=e[i.valueField]||e,a.loadItems.push(n)}}),i.needSort&&(a.loadItems=a._sortItems(a.loadItems)),FXM.Utils.applyFunc(a,i.onAfterAsync,[a.loadItems],!1),a._createItemList(t,e)})):i.items&&(this.loadItems=i.items||[],a._createItemList(t,e))},_sortItems:function(t){var e=this.options;return t.sort(function(t,i){var a=t[e.valueField]||t[e.textField]||t,n=i[e.valueField]||i[e.textField]||i;return+(a>n)||+(a===n)-1})},_createItemList:function(t,e){var i=this,a=this.options;if(this.loadItems){this.startIndex=this.startIndex||0;var n=this.loadItems.length;n<=0&&i._setEmptyTip(t);for(var r=!0,s=0;s<a.limitData;){if(this.startIndex>=n){r=!1;break}var o=this.loadItems[this.startIndex],l=o[a.valueField],c=o[a.textField],h="";if(this.startIndex++,FXM.Utils.isEmpty(e)||FXM.Utils.isNull(c)||new RegExp(FXM.Utils.escapeRegexp(e),"i").test(c+"")){o.isOther?(h+=" other",i.otherText.isVisible()&&(h+=" select")):i._isSelected(l)&&(h+=" select");var u=$('<div class="x-select-item"><div class="item-checkbox"/></div>').addClass(h).data("value",l);$('<div class="item-text"/>').text(c).appendTo(u),t.append(u),s++}}var d=t.next(".combo-load-more");r?d.removeClass("x-ui-hidden"):d.addClass("x-ui-hidden")}},_isSelected:function(t){return this.value==t},_bindEvt:function(t){var e=this,i=this.options,a=t.element,n=a.find(".combo-list").on("click",".x-select-item",function(a){var n=$(a.currentTarget);if(n.hasClass("select"))i.allowBlank&&(n.removeClass("select"),e.otherText&&e.otherText.setVisible(!!n.hasClass("other")),e.setValue(null),e.changed=!0);else{n.addClass("select").siblings().removeClass("select");var r=n.hasClass("other");e.value=n.data("value"),e._createSelectResult(e.$label,n.text()),e.otherText&&e.otherText.setVisible(r),e.changed=!0}t.close()});a.find(".combo-load-more").on("click",function(){e._createItemList(n,e.search&&e.search.getValue())})},_setEmptyTip:function(t){t.empty(),t.append('<div class="empty-img"/>').append('<div class="empty-info">'+this.options.emptyTip+"</div>")},getAllLinkWidgets:function(){return this.allLinkWidgets},checkValidate:function(){return!this.options.allowBlank&&FXM.Utils.isEmpty(this.getValue())?(this.setInvalidType(!1,FXM.CONSTS.INVALID_TYPE.BLANK),!1):(this.setInvalidType(!0),!0)},setValue:function(t){var e=this.options,i=this;this.value=t;var a="";if(FXM.Utils.isEmpty(t))a="",this.otherText&&this.otherText.setVisible(!1);else{a=t;var n=!1;FXM.Utils.forEach(this.loadItems,function(r,s){if(s.isOther&&i.otherText)n=!0,a=s[e.valueField];else if(s[e.valueField]===t)return a=s[e.valueField],!1}),n?(this.otherText.setVisible(!0),this.otherText.setValue(t)):this.otherText&&this.otherText.setVisible(!1)}this._createSelectResult(this.$label,a)},setText:function(t){this.text=t,this._createSelectResult(this.$label,t)},rebuild:function(){this.loadItems=null,this.setValue(null)}}),FXM.register("combo",FXM.Combo),FXM.XCombo=FXM.extend(FXM.Widget,{_defaults:function(){return $.extend(FXM.XCombo._super._defaults.apply(this,arguments),{baseCls:"x-xcombo",waterMark:"",allowBlank:!0,async:null,asyncResultKey:"items",textField:"text",valueField:"value",hasLimit:!1,searchKey:"keyword",value:null,items:[],limitData:200,onAfterAsync:null,onStopEdit:null})},_init:function(){FXM.XCombo._super._init.apply(this,arguments);var t=this,e=this.options;this.value=e.value,this.$label=$('<div class="x-picker-label"/>').attr("data-watermark",e.waterMark).on("click",function(){t.isEnabled()&&t._showComboView()}).appendTo(this.element),e.async?this.value&&this.setText(this.value):(this.items=e.items,FXM.Utils.forEach(this.items,function(i,a){var n=a[e.valueField],r=a[e.textField];n===t.value&&t._createSelectResult(t.$label,r)}))},_loadItems:function(t,e){var i=this,a=this.options;if(t.empty(),this.startIndex=0,a.async){var n={hasLimit:a.hasLimit};FXM.Utils.isEmpty(e)||(n[a.searchKey]=e),FXM.Utils.dataAjax({url:a.async.url,data:$.extend({},a.async.data,n)},function(e){i.items=[],FXM.Utils.forEach(e[a.asyncResultKey],function(t,e){var n={};n[a.textField]=e[a.textField]||e,n[a.valueField]=e[a.valueField]||e,i.items.push(n)}),FXM.Utils.applyFunc(i,a.onAfterAsync,[i.items],!1),i._createItemList(t)})}else i._createItemList(t,e)},_createItemList:function(t,e){var i=this.options;this.startIndex=this.startIndex||0;for(var a=Math.min(this.items.length,this.startIndex+i.limitData),n=this.startIndex;n<a;n++){var r=this.items[n],s=r[i.textField];if(FXM.Utils.isEmpty(e)||new RegExp(FXM.Utils.escapeRegexp(e),"i").test(s)){var o=$('<div class="x-select-item"/>').append($('<div class="item-checkbox"/>')).append($('<div class="item-text"/>').text(s)).data("value",r[i.valueField]).appendTo(t);r[i.valueField]===this.value&&o.addClass("select")}}this.startIndex=a,t.next(".combo-load-more").toggleClass("x-ui-hidden",a===this.items.length)},_createSelectResult:function(t,e){t.empty(),$('<span class="combo-select-result select-single"/>').text(e).appendTo(t)},_showComboView:function(){var t=this,e=this.options;this.changed=!1;var i=$('<div class="combo-list"/>'),a=$("<div />").append(i).append($('<div class="combo-load-more x-ui-hidden"/>').text(""));t._bindEvent(a),this.slidePanel=new FXM.SlidePanel({customCls:"x-combo-picker",content:a,onHeadCreate:function(){var e=$('<div class="combo-search-header"/>');return t.search=new FXM.Search({render:$("<div />").appendTo(e),onSearch:function(){var e=this.getValue();t._loadItems(i,e)}}),e},onClose:function(){t.changed&&FXM.Utils.applyFunc(t,e.onStopEdit,[],!1)},onShow:function(){t._loadItems(i)},text4Left:"",text4Right:""}),this.slidePanel.show()},_bindEvent:function(t){var e=this,i=this.options;t.on("click",".x-select-item",function(t){var a=$(t.currentTarget);a.hasClass("select")?(i.allowBlank&&a.removeClass("select"),e.setValue(null),e.changed=!0):(a.addClass("select").siblings().removeClass("select"),e.setValue(a.data("value")),e._createSelectResult(e.$label,a.text()),e.changed=!0),e.slidePanel.close()}),t.on("click",".combo-load-more",function(){e._createItemList(t.find(".combo-list"),e.search.getValue())})},getValue:function(){return this.value},setValue:function(t){var e=this,i=this.options;this.value=t,t?FXM.Utils.forEach(this.items,function(a,n){if(n[i.valueField]===t)return e.setText(n[i.textField]),!1}):this.setText("")},setText:function(t){this._createSelectResult(this.$label,t)}}),FXM.Combocheck=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return $.extend(FXM.Combocheck._super._defaults.apply(),{baseCls:"x-combocheck",waterMark:"",hasSelectAll:!0,hasSelectEmpty:!1,allowBlank:!0,async:null,asyncResultKey:"items",textField:"text",valueField:"value",items:[],onDataFilter:null,onItemCreate:null,onAfterItemSelect:null,onStopEdit:null,limitData:200,limitNumber:10,hasLimit:!1,needSort:!0,searchKey:"keyword",emptySelectText:""})},_init:function(){FXM.Combocheck._super._init.apply(this,arguments),this.value=[],this.text=[];var t=this,e=this.options;if(this.loadItems=null,this.valueMap={},this.$label=$('<div class="x-picker-label" data-watermark="'+e.waterMark+'"/>').on("click",function(){t.isEnabled()?t._createComboView():t.text&&t.text.length>e.limitNumber&&t._createDisabledView()}).appendTo(this.element),!e.async){this.loadItems=e.items||[],this.$label.empty();var i=0;FXM.Utils.forEach(this.loadItems,function(a,n){n.selected&&i<e.limitNumber?(t.value.push(n[e.valueField]),t.text.push(n[e.textField]),$('<span class="combo-select-result"/>').text(n[e.textField]).appendTo(t.$label),++i===e.limitNumber&&$('<div><span class="combo-select-result-more"></span></div>').appendTo(t.$label)):n.selected&&i>e.limitNumber-1&&(t.value.push(n[e.valueField]),t.text.push(n[e.textField]))})}},_createComboView:function(){var t=this,e=this.options;this.itemsMap={},e.hasLimit&&(t.oriKeywords=null,t.loadItems=null);var i=new FXM.SlidePanel({customCls:"x-combo-picker",content:'<div class="combo-list"/><div class="combo-load-more x-ui-hidden"></div>',onHeadCreate:function(){var e=$('<div class="combo-search-header">');return t.search=new FXM.Search({render:$("<div />").appendTo(e),onSearch:function(){var e=i.element.find(".combo-list"),a=this.getValue();t._doSearch(a,e)}}),e},onClose:function(){t.$label.empty(),t.hasEmpty&&$('<span class="combo-select-result">'+e.emptySelectText+"</span>").appendTo(t.$label),FXM.Utils.forEach(t.text,function(i,a){if(!(i<e.limitNumber))return $('<div><span class="combo-select-result-more"></span></div>').appendTo(t.$label),!1;$('<span class="combo-select-result"/>').text(a).appendTo(t.$label)}),t.changed&&FXM.Utils.applyFunc(t,e.onStopEdit,[],!1)},onShow:function(){var e=$(".combo-list",this.element);t._loadItems(e),t._bindViewEvts(i,e)},text4Left:"",text4Right:"",onRightClick:function(){this.close()}});i.show(),this.changed=!1},_doSearch:function(t,e){var i=this,a=this.options;i.oriKeywords=t,a.async&&a.hasLimit&&(i.loadItems=null),i.searchinterval&&clearTimeout(i.searchinterval),i.searchinterval=setTimeout(function(){e.empty(),i._loadItems(e,i.oriKeywords)},600)},_createDisabledView:function(){var t=this;this.options;new FXM.SlidePanel({customCls:"x-combo-picker",content:'<div class="combo-list"/>',onShow:function(){var e=$(".combo-list",this.element);FXM.Utils.forEach(t.text,function(t,i){var a=$('<div class="x-select-item select"><div class="item-checkbox"/></div>').appendTo(e);$('<div class="item-text"/>').text(i).appendTo(a)})},text4Left:"",text4Right:""}).show()},_loadItems:function(t,e){var i=this.options,a=this;if(this.startIndex=0,this.loadItems)a._createItemList(t,e),a._createCustomList(t,e);else if(i.async&&i.async.url){FXM.Utils.applyFunc(this,i.onBeforeAsync,[],!1),this.ajaxObj&&this.ajaxObj.abort&&this.ajaxObj.abort();var n={hasLimit:i.hasLimit};FXM.Utils.isEmpty(e)||(n[i.searchKey]=e),this.ajaxObj=FXM.Utils.dataAjax({url:i.async.url,data:$.extend(n,i.async.data)},function(n,r){a.loadItems=[],FXM.Utils.forEach(n[i.asyncResultKey],function(t,e){if(e){var n={};n[i.textField]=e[i.textField]||e,n[i.valueField]=e[i.valueField]||e,a.loadItems.push(n)}}),i.needSort&&(a.loadItems=a._sortItems(a.loadItems)),a._createItemList(t,e),a._createCustomList(t,e)},null,function(){a.ajaxObj=null})}else i.items&&(a._createItemList(t,e),a._createCustomList(t,e))},_sortItems:function(t){var e=this.options;return t.sort(function(t,i){var a=t[e.valueField]||t[e.textField]||t,n=i[e.valueField]||i[e.textField]||i;return+(a>n)||+(a===n)-1})},_getValueIndex:function(t){var e=-1;return FXM.Utils.forEach(this.value,function(i,a){if(a==t)return e=i,!1}),e},_createItemList:function(t,e){var i=this.options;if(this.loadItems){this.startIndex=this.startIndex||0;for(var a=this.loadItems.length,n=!0,r=0;r<i.limitData;){if(this.startIndex>=a){n=!1;break}var s=this.loadItems[this.startIndex],o=s[i.valueField],l=s[i.textField];if(this.valueMap[o]=l,this.itemsMap[o]=!0,this.startIndex++,FXM.Utils.isEmpty(e)||FXM.Utils.isNull(l)||new RegExp(FXM.Utils.escapeRegexp(e),"i").test(l+"")){var c=$('<div class="x-select-item"><div class="item-checkbox"/></div>');$('<div class="item-text"/>').text(l).appendTo(c),this._getValueIndex(o)>-1?c.addClass("select").data("value",o).prependTo(t):c.data("value",o).appendTo(t),r++}}var h=t.next(".combo-load-more");n?h.removeClass("x-ui-hidden"):h.addClass("x-ui-hidden")}},_createCustomList:function(t,e){var i=this,a=this.options;if(FXM.Utils.forEach(this.value,function(e,a){if(!i.itemsMap[a]){var n=i.valueMap[a]||a,r=$('<div class="x-select-item"><div class="item-checkbox"/></div>');$('<div class="item-text"/>').text(n).appendTo(r),r.addClass("select").data("value",a).prependTo(t)}}),FXM.Utils.isNull(e)&&0===$(".notComplete",t).length&&a.hasSelectEmpty){var n=this.hasEmpty?"select":"",r=$('<div class="x-select-item  notComplete  '+n+'"><div class="item-checkbox"/></div>').prependTo(t);$('<div class="item-text"/>').text(a.emptySelectText).appendTo(r)}var s=$(".selectAll",t);0===s.length&&(s=$('<div class="x-select-item selectAll"><div class="item-checkbox"/></div>').prependTo(t),$('<div class="item-text"/>').text("").appendTo(s)),t.children().not(".select").length<=1&&s.addClass("select")},_bindViewEvts:function(t,e){var i=this,a=t.element;e.on("click",".x-select-item",function(t){var a=$(t.currentTarget),n=a.hasClass("select"),r=$(".selectAll",e);if(a.hasClass("selectAll")){var s=$(".x-select-item",e);n?(FXM.Utils.isEmpty(i.oriKeywords)?(i.value=[],i.text=[]):FXM.Utils.forEach(s,function(t,e){$(e).hasClass("selectAll")||$(e).hasClass("notComplete")||(FXM.Utils.removeArray(i.value,$(e).data("value")),FXM.Utils.removeArray(i.text,$(e).text()))}),s.removeClass("select"),i.hasEmpty=!1):(FXM.Utils.forEach(s,function(t,e){if(!$(e).hasClass("selectAll")&&!$(e).hasClass("notComplete")){if(i._getValueIndex($(e).data("value"))>-1)return;i.value.push($(e).data("value")),i.text.push($(e).text())}}),s.addClass("select"),$(".notComplete",e).length>0&&(i.hasEmpty=!0))}else a.hasClass("notComplete")?(a.toggleClass("select"),a.hasClass("select")?(i.hasEmpty=!0,e.children().not(".select").length<=1&&r&&r.addClass("select")):(i.hasEmpty=!1,r&&r.removeClass("select"))):n?(a.removeClass("select"),FXM.Utils.removeArray(i.value,a.data("value")),FXM.Utils.removeArray(i.text,a.text()),r&&r.removeClass("select")):(a.addClass("select"),i.text.push(a.text()),i.value.push(a.data("value")),e.children().not(".select").length<=1&&r&&r.addClass("select"));i.changed=!0}),a.find(".combo-load-more").on("click",function(){i._createItemList(e,i.search&&i.search.getValue())})},setValue:function(t){var e=this.options,i=this,a=FXM.Utils.makeArray(t);this.value=a,this.text=a.slice(0),this.$label.empty(),FXM.Utils.forEach(a,function(t,a){if(!(t<e.limitNumber))return $('<div><span class="combo-select-result-more"></span></div>').appendTo(i.$label),!1;$('<span class="combo-select-result"/>').text(a).appendTo(i.$label)})},checkValidate:function(){return this.options.allowBlank||0!==this.value.length?(this.setInvalidType(!0),!0):(this.setInvalidType(!1,FXM.CONSTS.INVALID_TYPE.BLANK),!1)},getValue:function(){return this.value},getNullValue:function(){return[]},rebuild:function(){this.loadItems=null,this.setValue([])},setJsonValue:function(t){var e=this.options,i=FXM.Utils.makeArray(t.items);this.value=i,this.text=i.slice(0),this.hasEmpty=t.hasEmpty;var a="";t.hasEmpty&&(a+='<span class="combo-select-result">'+e.emptySelectText+"</span>"),FXM.Utils.forEach(i,function(t,i){if(!(t<e.limitNumber))return a+='<div><span class="combo-select-result-more"></span></div>',!1;a+='<span class="combo-select-result">'+i+"</span>"}),this.$label.html(a)},getJsonValue:function(){return{items:this.value,hasEmpty:this.hasEmpty}}}),FXM.register("combocheck",FXM.Combocheck),function(t){FXM.XComboCheck=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.XComboCheck._super._defaults.apply(),{baseCls:"x-xcombocheck",waterMark:"",allowBlank:!0,async:null,items:[],asyncResultKey:"items",textField:"text",valueField:"value",value:{hasEmpty:!1,items:[]},hasSelectEmpty:!1,onStopEdit:null,onAfterItemSelect:null,emptySelectText:"",limitData:200,limitNumber:10,hasLimit:!1})},_init:function(){FXM.XComboCheck._super._init.apply(this,arguments);var e=this,i=this.options;this.value=i.value&&i.value.items||[],this.hasEmpty=!(!i.value||!i.value.hasEmpty),this.text=[],this.$label=t('<div class="x-picker-label"/>').attr("data-watermark",i.waterMark).on("click",function(){e.isEnabled()?e._createComboView():e._createDisabledView()}).appendTo(this.element),this._loadText()},_loadText:function(){var t=this,e=this.options;e.async?(this.hasEmpty&&this.text.push(e.emptySelectText),this.text=this.text.concat(this.value.slice(0))):(this.items=e.items||[],FXM.Utils.forEach(this.items,function(e,i){t.value.indexOf(i.value)>-1&&t.text.push(i.text)})),this.setText(this.text)},_createSelectItem:function(e){return t('<span class="combo-select-result"/>').text(e)},_createItem:function(e){return t('<div class="x-select-item"/>').append('<div class="item-checkbox"/>').append(t('<div class="item-text"/>').text(e.text)).toggleClass("select",this.value.indexOf(e.value)>-1).data("value",e.value).data("text",e.text)},_createShowAllBtn:function(){return t('<div><span class="combo-select-result-more"></span></div>')},_createComboView:function(){var e=this,i=this.options,a=t("<div />").append('<div class="combo-list"/>').append('<div class="combo-load-more x-ui-hidden"></div>');this.changed=!1,new FXM.SlidePanel({customCls:"x-combo-picker",content:a,onHeadCreate:function(){var i=t('<div class="combo-search-header">');return e.search=new FXM.Search({render:t("<div />").appendTo(i),onSearch:function(){var t=a.find(".combo-list"),i=this.getValue();e._doSearch(i,t)}}),i},onClose:function(){e.changed&&(e.setText(e.text),FXM.Utils.applyFunc(e,i.onStopEdit,[],!1))},onShow:function(){var i=t(".combo-list",this.element);e._loadItems(i),e._bindEvent(a)},text4Left:"",text4Right:"",onRightClick:function(){this.close()}}).show()},_bindEvent:function(e){var i=this;e.on("click",".x-select-item",function(a){var n=t(a.currentTarget);n.toggleClass("select"),i.changed=!0;var r=n.hasClass("select");n.hasClass("select-all")?i._handleSelectAll(r,e):n.hasClass("select-empty")?(i._handleSelectEmpty(r),i._checkSelectAll(r,e)):(i._handleItemClick(r,n,e),i._checkSelectAll(r,e))}),e.on("click",".combo-load-more",function(){i._createItemList(e.find(".combo-list"),i.search&&i.search.getValue())})},_handleSelectAll:function(e,i){var a=this,n=this.options,r=t(".x-select-item",i);FXM.Utils.forEach(r,function(i,r){var s=t(r);if(!s.hasClass("select-all")&&!s.hasClass("select-empty")){s.toggleClass("select",e);var o=s.data("value"),l=s.data("text");e?a.value.indexOf(o)<0&&(a.value.push(o),a.text.push(l)):(FXM.Utils.removeArray(a.value,o),FXM.Utils.removeArray(a.text,l))}s.hasClass("select-empty")&&(a.hasEmpty=e,s.toggleClass("select",a.hasEmpty),e?a.text.indexOf(n.emptySelectText)<0&&a.text.push(n.emptySelectText):FXM.Utils.removeArray(a.text,n.emptySelectText))})},_handleSelectEmpty:function(t){var e=this.options;this.hasEmpty=t,t?this.value.indexOf(e.emptySelectText)<0&&this.text.push(e.emptySelectText):FXM.Utils.removeArray(this.text,e.emptySelectText)},_handleItemClick:function(t,e){var i=e.data("value"),a=e.data("text");t?(this.value.push(i),this.text.push(a)):(FXM.Utils.removeArray(this.value,i),FXM.Utils.removeArray(this.text,a))},_checkSelectAll:function(e,i){var a=t(".x-select-item.select-all",i);if(e){var n=t(".x-select-item",i).length-1,r=t(".x-select-item.select",i).length-a.hasClass("select");a.toggleClass("select",n===r)}else a.removeClass("select")},_doSearch:function(t,e){var i=this,a=this.options;a.async&&a.hasLimit&&(this.items=null),this.searchInterval&&clearTimeout(this.searchInterval),this.searchInterval=setTimeout(function(){e.empty(),i._loadItems(e,t)},600)},_createDisabledView:function(){var e=this;new FXM.SlidePanel({customCls:"x-combo-picker",content:'<div class="combo-list"/>',onShow:function(){var i=t(".combo-list",this.element);FXM.Utils.forEach(e.text,function(e,a){var n=t('<div class="x-select-item select"/>').append('<div class="item-checkbox"/>').appendTo(i);t('<div class="item-text"/>').text(a).appendTo(n)})},text4Left:"",text4Right:""}).show()},_loadItems:function(e,i){var a=this,n=this.options;if(this.startIndex=0,this.itemsMap={},n.async&&n.async.url){this.ajaxObj&&this.ajaxObj.abort();var r={hasLimit:n.hasLimit};FXM.Utils.isEmpty(i)||(r.keyword=i),this.ajaxObj=FXM.Utils.dataAjax({url:n.async.url,data:t.extend(r,n.async.data)},function(t){a.items=[],FXM.Utils.forEach(t[n.asyncResultKey],function(t,e){a.items.push({text:e[n.textField]||e,value:e[n.valueField]||e})}),a._createItemList(e,i)},null,function(){a.ajaxObj=null})}else a._createItemList(e,i)},_createItemList:function(e,i){var a=this,n=this.options;this.itemsMap=this.itemsMap||{},this.startIndex=this.startIndex||0;for(var r=Math.min(this.startIndex+n.limitData,this.items.length),s=this.startIndex;s<r;s++){var o=this.items[s];if((FXM.Utils.isEmpty(i)||new RegExp(FXM.Utils.escapeRegexp(i),"i").test(o.text+""))&&!this.itemsMap[o.value]){this.itemsMap[o.value]=!0;var l=this._createItem(o);l.hasClass("select")?l.prependTo(e):l.appendTo(e)}}if(this.startIndex=r,e.next(".combo-load-more").toggleClass("x-ui-hidden",r===this.items.length),FXM.Utils.forEach(this.value,function(t,n){if(!FXM.Utils.isEmpty(i)&&!new RegExp(FXM.Utils.escapeRegexp(i),"i").test(n+""))return!1;a.itemsMap[n]||(a.itemsMap[n]=!0,a._createItem({text:n,value:n}).prependTo(e))}),FXM.Utils.isEmpty(i)&&n.hasSelectEmpty&&0===t(".select-empty",e).length&&a._createItem({text:n.emptySelectText,value:FXM.CONSTS.PARAMETER.EMPTY}).toggleClass("select",this.hasEmpty).addClass("select-empty").prependTo(e),0===t(".select-all",e).length){var c=t(".x-select-item",e).length===t(".x-select-item.select",e).length;a._createItem({text:"",value:"select-all"}).toggleClass("select",c).addClass("select-all").prependTo(e)}},setValue:function(t){var e=this;this.value=t.items,this.hasEmpty=t.hasEmpty,this.items?(this.text=[],FXM.Utils.forEach(this.items,function(t,i){e.value.indexOf(i.value)>-1&&e.text.push(i.text)})):this.text=t.items.slice(0),this.setText(this.text)},setText:function(t){var e=this,i=this.options;this.$label.empty(),this.text=t,FXM.Utils.forEach(this.text,function(t,a){if(t+1===i.limitNumber)return e._createShowAllBtn().appendTo(e.$label),!1;e._createSelectItem(a).appendTo(e.$label)})},getEmptySelectText:function(){return this.options.emptySelectText},getValue:function(){return{items:this.value,hasEmpty:this.hasEmpty}}})}(Zepto),FXM.ComboSlider=FXM.extend(FXM.Widget,{_defaults:function(){return $.extend(FXM.ComboSlider._super._defaults.apply(),{baseCls:"x-combo-slider",allowBlank:!0,items:[],emptyTip:"",text4Right:"",async:null,asyncResultKey:null,title:"",onOk:null,onAsyncSuccess:null})},_init:function(){FXM.ComboSlider._super._init.apply(this,arguments),this.value=null;var t=this,e=this.options;this.loadItems=e.items||[],FXM.Utils.forEach(this.loadItems,function(e,i){i.selected&&(t.value=i.text)})},_showComboView:function(){var t=this,e=this.options;this.panel=new FXM.SlidePanel({customCls:"x-combo-picker has-title",content:'<div class="combo-list"></div>',onHeadCreate:function(){var i=$('<div class="combo-search-header">').append($('<div class="header-title"/>').text(e.title));return new FXM.Search({render:$("<div />").appendTo(i),onSearch:function(){var e=t.panel.element.find(".combo-list"),i=this.getValue();t._loadItems(e,i)}}),i},onShow:function(){var e=this.element.find(".combo-list");t._loadItems(e),t._bindEvt()},text4Left:"",text4Right:e.text4Right,onRightClick:function(){FXM.Utils.applyFunc(t,e.onOk,[],!1)},onLeftClick:function(){this.close()}}),this.panel.show(),this.panel.setBtnEnable({nav:"right",enable:!1})},_loadItems:function(t,e){var i=this,a=this.options;if(t.empty(),FXM.Utils.isObjectEmpty(this.loadItems)){if(a.async){var n=FXM.UI.createLoadIcon();t.append(n),FXM.Utils.dataAjax({url:a.async.url,data:a.async.data},function(n){var r=FXM.Utils.applyFunc(i,a.onAsyncSuccess,[n],!1);!1===r?FXM.Utils.forEach(n[a.asyncResultKey],function(t,e){i.loadItems.push({text:e,value:t})}):i.loadItems=i.loadItems.concat(r),i._createItemList(t,e)},function(){return n.remove(),!1},function(){n.remove()})}}else this._createItemList(t,e)},_createItemList:function(t,e){var i=this;0!==this.loadItems.length?FXM.Utils.forEach(this.loadItems,function(a,n){var r=n.value,s=n.text,o="";if(FXM.Utils.isEmpty(e)||FXM.Utils.isNull(s)||new RegExp(FXM.Utils.escapeRegexp(e),"i").test(s+"")){i.value===r&&(o+=" active");var l=$('<div class="x-select-item"><div class="item-checkbox"/></div>').addClass(o).data("value",r);$('<div class="item-text"/>').text(s).appendTo(l),t.append(l)}}):i._setEmptyTip(t)},_bindEvt:function(){var t=this;this.panel.element.find(".combo-list").on("click",".x-select-item",function(e){var i=$(e.currentTarget);i.hasClass("active")||(i.addClass("active").siblings().removeClass("active"),t.value=i.data("value"),t.panel.setBtnEnable({nav:"right",enable:!0}))})},_setEmptyTip:function(t){t.empty(),t.append('<div class="empty-info">'+this.options.emptyTip+"</div>")},setValue:function(t){this.value=t},getValue:function(){return this.value},show:function(){this._showComboView()},close:function(){this.panel&&this.panel.close()}}),FXM.UserCheck=FXM.extend(FXM.Combocheck,{setValue:function(t){var e=this.options,i=this;this.value=FXM.Utils.makeArray(t.items),this.hasEmpty=t.hasEmpty,FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.corp.list_member_name),data:{members:this.value}},function(a){var n=[];FXM.Utils.forEach(a.users,function(t,e){n.push(e.nickname),i.valueMap[e._id]=e.nickname});var r="";t.hasEmpty&&(r+='<span class="combo-select-result"></span>'),i.text=n.slice(0),FXM.Utils.forEach(n,function(t,i){if(!(t<e.limitNumber))return r+='<div><span class="combo-select-result-more"></span></div>',!1;r+='<span class="combo-select-result">'+FXM.Utils.escapeHtmlSpecialChar(i)+"</span>"}),i.$label.html(r)})}}),FXM.register("usercheck",FXM.UserCheck),function(t){FXM.LinkQuery=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return t.extend(FXM.LinkQuery._super._defaults.apply(this,arguments),{baseCls:"x-linkquery",allowBlank:!0,linkFields:[],linkFilter:[],linkForm:null})},_init:function(){FXM.LinkQuery._super._init.apply(this,arguments);var e=this,i=this.options;this.widgetsMap={},this.typeMap={},FXM.Utils.forEach(i.linkFields,function(i,a){var n=t('<div class="f-line"/>').appendTo(e.element);n.append(t('<div class="f-label" />').append(t("<span/>").text(a.text))),e._formatSubFormItems(a);var r=e._formatWidgetType(a.type),s={render:t("<div />").appendTo(n),widgetName:a.widgetName,type:r,items:a.items,format:a.format,enable:!1};t.extend(s,e._getWidgetLinkConfig(s.type)),FXM.CONSTS.LIMIT_FIELDS.disable.indexOf(s.type)>-1&&t.extend(s,{widgetType:s.type,type:"formitemdisable"});var o=FXM.createWidget(s);e.widgetsMap[a.name]=o,e.typeMap[a.name]=a.type})},_getWidgetLinkConfig:function(t){var e={};switch(t){case"datetime":e.waterMark="";break;case"image":case"upload":e.mode="preview",e.maxFileCount=FXM.CONSTS.UPLOAD_FILE_COUNT.MULTI;break;case"signature":case"subform":e.mode="preview";break;case"user":case"usergroup":case"dept":case"deptgroup":e.msg=""}return e},_formatSubFormItems:function(e){if("subform"===e.type){var i=this;FXM.Utils.forEach(e.items,function(e,a){a.widget&&(i.typeMap[a.widget.widgetName]=a.widget.type,a.widget.type=i._formatWidgetType(a.widget.type),t.extend(a.widget,i._getWidgetLinkConfig(a.widget.type)))})}},_formatWidgetType:function(t){switch(t){case"radiogroup":case"combo":case"combocheck":case"checkboxgroup":case"address":case"location":return"text";default:return t}},_formatWidgetData:function(t,e){var i=this;switch(t){case"combocheck":case"checkboxgroup":return e&&e.length>0?e.join(", "):"";case"address":case"location":return FXM.Utils.address2Str(e,"","pcda");case"subform":return FXM.Utils.forEach(e,function(t,e){FXM.Utils.forEach(e,function(t,a){e[t]=i._formatWidgetData(i.typeMap[t],a)})}),e;default:return e}},reload:function(t){var e=this.options,i=this,a=[];FXM.Utils.forEach(e.linkFields,function(t,e){a.push(e.name)}),!e.linkForm||a.length<=0||FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.filter_link),data:{formId:e.linkForm,fields:a,filter:t,refAppId:e.refAppId}},function(t){var e={};FXM.Utils.isObjectEmpty(t.dataList)?FXM.Utils.forEach(i.widgetsMap,function(t,e){e.setValue(null)}):(e=t.dataList[0],FXM.Utils.forEach(i.widgetsMap,function(t,a){var n=i._formatWidgetData(i.typeMap[t],e[t]);a.setValue(n)}))})}}),FXM.register("linkquery",FXM.LinkQuery)}(Zepto),FXM.LinkData=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return $.extend(FXM.LinkData._super._defaults.apply(),{baseCls:"x-link-data",allowBlank:!0,linkFields:[],linkKey:null,linkFilter:[],linkForm:null,itemsPerPage:20,onBeforeLinkData:null})},_init:function(){FXM.LinkData._super._init.apply(this,arguments);var t=this.options,e=this;this._createSelectBtn(),this.widgetsMap={},this.typeMap={},this.keyword="",FXM.Utils.forEach(t.linkFields,function(t,i){var a=$('<div class="f-line"/>').appendTo(e.element);a.append($('<div class="f-label"/>').text(i.text)),e._formatSubFormItems(i);var n=e._formatWidgetType(i.type),r={render:$("<div/>").appendTo(a),widgetName:i.name,type:n,items:i.items,format:i.format,enable:!1};$.extend(r,e._getWidgetLinkConfig(r.type)),FXM.CONSTS.LIMIT_FIELDS.disable.indexOf(r.type)>-1&&$.extend(r,{widgetType:r.type,type:"formitemdisable"}),e.widgetsMap[i.name]=FXM.createWidget(r),e.typeMap[i.name]=i.type})},_getWidgetLinkConfig:function(t){var e={};switch(t){case"datetime":e.waterMark="";break;case"image":case"upload":e.mode="preview",e.maxFileCount=FXM.CONSTS.UPLOAD_FILE_COUNT.MULTI;break;case"signature":case"subform":e.mode="preview";break;case"user":case"usergroup":case"dept":case"deptgroup":e.msg=""}return e},_setWidgetsValue:function(t){var e=this,i=this.options;FXM.Utils.isObjectEmpty(t)?(e.value={},FXM.Utils.forEach(this.widgetsMap,function(t,e){e.setValue(null)})):(e.value={id:t._id,key:t[i.linkKey]},FXM.Utils.forEach(this.widgetsMap,function(i,a){var n=e._formatWidgetData(e.typeMap[i],t[i]);a.setValue(n)}))},_formatSubFormItems:function(t){if("subform"===t.type){var e=this;FXM.Utils.forEach(t.items,function(t,i){i.widget&&(e.typeMap[i.widget.widgetName]=i.widget.type,i.widget.type=e._formatWidgetType(i.widget.type),$.extend(i.widget,e._getWidgetLinkConfig(i.widget.type)))})}},_formatWidgetType:function(t){switch(t){case"combo":case"combocheck":case"radiogroup":case"checkboxgroup":case"address":case"location":return"text";default:return t}},_formatWidgetData:function(t,e){var i=this;switch(t){case"address":case"location":return FXM.Utils.address2Str(e,"","pcda");case"subform":return FXM.Utils.forEach(e,function(t,e){FXM.Utils.forEach(e,function(t,a){e[t]=i._formatWidgetData(i.typeMap[t],a)})}),e;default:return e}},_createSelectBtn:function(){var t=this.options,e=this;t.enable&&$('<div class="select-btn"><span></span></div>').appendTo(this.element).click(function(){e.isEnabled()&&FXM.Utils.applyFunc(e,t.onBeforeLinkData,[t.linkFilter],!1)})},_createDataList:function(){var t=this,e=this.options,i=new FXM.SlidePanel({customCls:"x-data-picker",content:'<ul class="data-list"/>',onClose:function(){t.keyword="",FXM.Utils.applyFunc(t,e.onStopEdit,[],!1)},onShow:function(){var e=this.element.find(".data-list");new FXM.Search({render:$("<li/>").appendTo(e),onSearch:function(){t.keyword!==this.getValue()&&(t.keyword=this.getValue(),a.empty(),t.skip=0,t._loadData(a,!1))}});var a=$('<ul class="data-list-wrapper"/>').appendTo(e);t._loadData(a),t._bindListEvent(a,i)},text4Left:"",onLeftClick:function(){t._setWidgetsValue(null),this.close()},text4Right:"",onRightClick:function(){this.close()}});i.show()},_createDataItem:function(t,e){var i=this.options,a=this,n=t.label,r="";if(FXM.Utils.isEmpty(n)){var s=[];FXM.Utils.forEach(i.linkFields,function(e,i){var n=a._formatData(i.type,t[i.name],i.format);n&&s.push(n)}),n=s.join(","),"template"===a.dataLabelMode&&(r="style-blue")}var o=$('<li class="data-item"/>').text(n).appendTo(e).data("data",t).addClass(r);this.value&&this.value.id===t._id&&o.addClass("select")},_bindListEvent:function(t,e){var i=this;t.on("click",".data-item",function(t){var a=$(t.target);a.addClass("select").siblings().removeClass("select");var n=a.data("data");i._setWidgetsValue(n),e.close()}),t.on("scroll",function(){this.scrollTop+$(this).height()>this.scrollHeight-5&&i.loadMore(t)})},_formatData:function(t,e,i){if(FXM.Utils.isObjectEmpty(e))return"";var a=e.toString();switch(t){case"address":case"location":a=FXM.Utils.address2Str(e,"","pcda");break;case"datetime":a=FXM.Utils.date2Str(new Date(e),i||"yyyy-MM-dd");break;case"upload":case"image":case"signature":case"subform":a="";break;case"user":case"dept":a=e&&e.name;break;case"usergroup":case"deptgroup":a=e&&e.map(function(t){return t.name})}return a},checkValidate:function(){var t=this.options.allowBlank||!FXM.Utils.isObjectEmpty(this.value);return this.setInvalidType(t,FXM.CONSTS.INVALID_TYPE.BLANK),t},setValue:function(t){var e=this.options,i=this;this.value=t,!FXM.Utils.isObjectEmpty(t)&&t.hasOwnProperty("id")&&FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.read_link),data:{formId:t.entryId||e.linkForm,linkId:t.id,refAppId:t.appId||e.refAppId}},function(t,e){i._setWidgetsValue(t.data)},function(){})},getValue:function(){var t=this.options;return this.value&&this.value.id?$.extend({appId:t.refAppId,entryId:t.linkForm},this.value):{}},getLinkValue:function(){return this.value&&this.value.key},getLinkType:function(){return this.options.linkType},getNullValue:function(){return{}},getText:function(){return this.value&&this.value.key},_loadData:function(t){var e=this.options,i=this;this.loading=!0,FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.filter_link),data:{multi:!0,formId:e.linkForm,fields:this.fields,filter:this.filter,limit:e.itemsPerPage,skip:this.skip,refAppId:e.refAppId,keyword:this.keyword}},function(a){var n=[];FXM.Utils.isObjectEmpty(a.dataList)||(n=a.dataList),n.length<e.itemsPerPage&&(i.hasMore=!1),i.dataLabelMode=a.dataLabelMode,t&&(n.length?FXM.Utils.forEach(n,function(e,a){i._createDataItem(a,t)}):$('<li class="empty-tip"></li>').appendTo(t))},function(){},function(){i.skip+=e.itemsPerPage,i.loading=!1})},loadMore:function(t){!this.loading&&this.hasMore&&this._loadData(t)},reload:function(t){var e=this.options,i=[];FXM.Utils.forEach(e.linkFields,function(t,e){i.push(e.name)}),e.linkKey&&i.push(e.linkKey),!e.linkForm||i.length<=0||(this.filter=t,this.fields=i,this.skip=0,this.hasMore=!0,this._createDataList())}}),FXM.register("linkdata",FXM.LinkData),function(t){FXM.DateLimit=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.DateLimit._super._defaults.apply(this,arguments),{baseCls:"x-datelimit",format:"yyyy-MM-dd",wrap:!0})},_init:function(){FXM.DateLimit._super._init.apply(this,arguments);var e=this,i=this.options;this.startDate=FXM.createWidget({type:"datetime",render:t('<div class="start-date"/>').appendTo(e.element),format:i.format,defaultPickDate:(new Date).setHours(0,0,0,0),onStopEdit:function(){FXM.Utils.applyFunc(e,i.onStopEdit,[],!1)}}),i.wrap?t(this.element).addClass("datelimit-wrap"):(t('<div class="limit-to"/>').text("~").appendTo(this.element),t(this.element).addClass("datelimit-nowrap")),this.endDate=FXM.createWidget({type:"datetime",render:t('<div class="end-date"/>').appendTo(e.element),format:i.format,defaultPickDate:(new Date).setHours(0,0,0,0),onStopEdit:function(){FXM.Utils.applyFunc(e,i.onStopEdit,[],!1)}})},setValue:function(t){t?(FXM.Utils.isNull(t.max)?this.endDate.setValue(null):this.endDate.setValue(t.max),FXM.Utils.isNull(t.min)?this.startDate.setValue(null):this.startDate.setValue(t.min)):(this.startDate.setValue(null),this.endDate.setValue(null))},getValue:function(){var t=this.startDate.getValue(),e=this.endDate.getValue(),i={};return FXM.Utils.isNull(t)||(i.min=t),FXM.Utils.isNull(e)||(i.max=e),i}}),FXM.register("datelimit",FXM.DateLimit)}(Zepto),function(t){FXM.NumberLimit=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.NumberLimit._super._defaults.apply(this,arguments),{baseCls:"x-numberlimit",wrap:!0})},_init:function(){FXM.NumberLimit._super._init.apply(this,arguments);var e=this.options,i=this;this.minNumber=FXM.createWidget({render:t('<div class="start-number"/>').appendTo(this.element),type:"number",allowDecimals:!0,waterMark:"",onStopEdit:function(){FXM.Utils.applyFunc(i,e.onStopEdit,[],!1)}}),e.wrap?t(this.element).addClass("numberlimit-wrap"):(t('<div class="limit-to"/>').text("~").appendTo(this.element),t(this.element).addClass("numberlimit-nowrap")),this.maxNumber=FXM.createWidget({type:"number",render:t('<div class="end-number"/>').appendTo(this.element),allowDecimals:!0,waterMark:"",onStopEdit:function(){FXM.Utils.applyFunc(i,e.onStopEdit,[],!1)}})},checkValidate:function(){return this.minNumber.checkValidate()&&this.maxNumber.checkValidate()},setValue:function(t){t?(FXM.Utils.isNull(t.max)?this.maxNumber.setValue(null):this.maxNumber.setValue(t.max),FXM.Utils.isNull(t.min)?this.minNumber.setValue(null):this.minNumber.setValue(t.min)):(this.maxNumber.setValue(null),this.minNumber.setValue(null))},getValue:function(){var t=this.maxNumber.getValue(),e=this.minNumber.getValue(),i={};return FXM.Utils.isNull(e)||(i.min=e),FXM.Utils.isNull(t)||(i.max=t),i}}),FXM.register("numberlimit",FXM.NumberLimit)}(Zepto),function(t){FXM.Parameter=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.Parameter._super._defaults.apply(this,arguments),{baseCls:"x-parameter",fields:[],showFields:null,filter:null,authGroupId:null,changeable:!1,onBeforeConvertField:null,onStopEdit:null,onStopChange:null})},_init:function(){FXM.Parameter._super._init.apply(this,arguments);var e=this,i=this.options;this.childWidgets={},this.$wrapper=t('<div class="x-parameter-wrapper"/>').appendTo(this.element),FXM.Utils.forEach(this.options.fields,function(t,i){e._createItem(i)}),i.changeable&&this._renderChange()},_createItem:function(e){var i=this.options,a=this,n=t('<div class="x-parameter-cell"/>').appendTo(this.$wrapper),r=a._getConfigFromItem(e);if(r){t('<div class="cell-title">'+r.title+"</div>").appendTo(n);var s=FXM.createWidget(t.extend({render:t("<div />").appendTo(n),onStopEdit:function(){var t=JSON.stringify(this.getValue());this.oldValue&&this.oldValue==t||(this.oldValue=t,FXM.Utils.applyFunc(a,i.onStopEdit,[],!1))}},r)),o=this._parseDefaultValue(e);o&&this._setWidgetValue(s,o),this.childWidgets[s.getWidgetName()]={widget:s,field:e}}},_getConfigFromItem:function(e){var i=this.options,a={title:e.text};if(!1===FXM.Utils.applyFunc(this,i.onBeforeConvertField,[a,e],!1))switch(e.type){case"text":case"radiogroup":case"combo":"creator"===e.name?t.extend(a,this._getUserConfig(e)):t.extend(a,this._getComboConfig(e));break;case"number":a.type="numberlimit";break;case"datetime":a.type="datelimit";break;case"address":a.type="address",a.needDetail=!1;break;case"dept":a.type="deptselect";break;case"user":t.extend(a,this._getUserConfig(e));break;default:"creator"===e.name&&t.extend(a,this._getUserConfig(e))}return FXM.Utils.isNull(a.type)?null:a},_parseDefaultValue:function(t){if(t.defaultValue){var e;if("datetime"===t.type&&t.defaultValue){e={};var i=t.defaultValue,a=new Date,n=a.getTime();switch(i.type){case"today":e.min=n,e.max=n;break;case"yesterday":e.min=n-864e5,e.max=n-864e5;break;case"lastWeek":e.min=n-6048e5,e.max=n;break;case"thisWeek":e.min=FXM.Utils.getWeekStartDate(a).getTime(),e.max=FXM.Utils.getWeekEndDate(a).getTime();break;case"thisMonth":e.min=FXM.Utils.getMonthStartDate(a).getTime(),e.max=FXM.Utils.getMonthEndDate(a).getTime();break;case"formula":var r,s;r="before"===i.min.type?-1*i.min.value:i.min.value,s="before"===i.max.type?-1*i.max.value:i.max.value,e.min=n+r,e.max=n+s;break;default:e.min=i.min,e.max=i.max}}else if("user"!==t.type&&"creator"!==t.name||!t.defaultValue)e=t.defaultValue;else{var o=[].concat(t.defaultValue.items||[]),l=o.indexOf(FXM.CONSTS.USER_ID.CurrentUser);l>-1&&(!FXM.GB.user||!FXM.GB.user._id||o.indexOf(FXM.GB.user._id)>-1?o.splice(l,1):o[l]=FXM.GB.user._id),e={items:o,hasEmpty:t.defaultValue.hasEmpty}}return e}},_getComboConfig:function(t){var e=this.options,i=FXM.Utils.getFieldInfoById(t.id);return{type:"combocheck",hasSelectEmpty:!0,hasLimit:!0,async:{url:t.url||FXM.Utils.getApi(FXM.API.data.distinct),data:{refAppId:i.appId,formId:i.entryId,field:t.name,type:t.type,authGroupId:e.authGroupId,filter:e.filter}}}},_getUserConfig:function(e){return t.extend(this._getComboConfig(e),{type:"usercheck",textField:"nickname",valueField:"_id"})},_renderChange:function(){var e=this,i=this.options,a=t('<div class="parameter-footer"/>').appendTo(this.element);new FXM.DataCombocheck({render:t('<div class="parameter-btn-set"></div>').appendTo(a),items:i.fieldItems,onStopEdit:function(t){i.fields=i.showFields.filter(function(e){return t.indexOf(e.name)>-1}),e._reload(),FXM.Utils.applyFunc(e,i.onStopChange,[t],!1)}})},_reload:function(){var e=this,i=this.options;t(".x-parameter-cell",this.$wrapper).remove(),this.childWidgets={},FXM.Utils.forEach(i.fields,function(t,i){e._createItem(i)})},checkValidate:function(){if(!this.options.allowBlank){var t=!0;for(var e in this.childWidgets){var i=this.childWidgets[e].widget;if(i){switch(i.options.type){case"usercheck":case"combocheck":var a=i.getJsonValue();t=!!a.hasEmpty||!FXM.Utils.isObjectEmpty(a.items);break;default:var n=i.getValue();t=!FXM.Utils.isObjectEmpty(n)}if(!t)break}}return t}return!0},_checkWidgetValue:function(t,e){var i=!1;switch(t){case"combocheck":case"usercheck":case"deptselect":i=e.hasEmpty||!FXM.Utils.isObjectEmpty(e.value);break;default:e.value.length>0&&FXM.Utils.forEach(e.value,function(t,e){if(!FXM.Utils.isNull(e))return i=!0,!1})}return i},_getFilterByWidget:function(e,i){var a=FXM.Utils.getFieldInfoById(i.id),n={type:i.type,entryId:a.entryId,appId:a.appId};t.extend(n,FXM.Utils.dealFilterFieldName(i));var r=e.getValue();switch(e.options.type){case"usercheck":r=e.getJsonValue(),t.extend(n,{type:"user",method:FXM.CONSTS.FILTER_METHOD.IN,value:r.items,hasEmpty:!!r.hasEmpty});break;case"combocheck":r=e.getJsonValue(),t.extend(n,{type:"text",method:FXM.CONSTS.FILTER_METHOD.IN,value:r.items,hasEmpty:!!r.hasEmpty});break;case"deptselect":t.extend(n,{method:FXM.CONSTS.FILTER_METHOD.IN,value:r.items,hasEmpty:!!r.hasEmpty,hasCurrentDept:!!r.hasCurrentDept});break;case"datelimit":t.extend(n,{method:FXM.CONSTS.FILTER_METHOD.RG,value:FXM.Utils.getArrayFromRange(r,"datetime")});break;case"numberlimit":t.extend(n,{method:FXM.CONSTS.FILTER_METHOD.RG,value:FXM.Utils.getArrayFromRange(r,"number")});break;case"address":t.extend(n,{method:FXM.CONSTS.FILTER_METHOD.ALL,value:FXM.Utils.getArrayFromRange(r,"address")});break;default:t.extend(n,{method:FXM.CONSTS.FILTER_METHOD.EQ,value:FXM.Utils.makeArray(r)})}return n},_setWidgetValue:function(t,e){switch(t.options.type){case"combocheck":t.setJsonValue(e);break;default:t.setValue(e)}},getValue:function(){var t=[];for(var e in this.childWidgets){var i=this.childWidgets[e].widget;if(i){var a=this.childWidgets[e].field,n=this._getFilterByWidget(i,a);this._checkWidgetValue(i.options.type,n)&&t.push(n)}}return t},setValue:function(t){var e=this;FXM.Utils.forEach(t,function(t,i){var a=e.childWidgets[t];a&&e._setWidgetValue(a,i)})}}),FXM.register("parameter",FXM.Parameter)}(Zepto),function(t){FXM.Filter=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.Filter._super._defaults.apply(this,arguments),{baseCls:"x-filter",fields:[],filters:[],hasRelation:!0,hasFlowFilters:!1,flowType:"",relation:FXM.CONSTS.FILTER_RELATION.AND,authGroupId:null,onStopEdit:null})},_init:function(){FXM.Filter._super._init.apply(this,arguments);var e=this.options;this.relation=e.relation,this.filters=e.filters,this._initFieldMap(),this.$head=this._createHead().appendTo(this.element),this.$body=t('<div class="filter-body"/>').appendTo(this.element),e.hasRelation&&this._createRelation().appendTo(this.$body),e.hasFlowFilters&&this._createFlowFilters().appendTo(this.$body),this._createFilters(!0)},_initFieldMap:function(){var t=this,e=this.options;this.fieldMap={},FXM.Utils.forEach(e.fields,function(e,i){t.fieldMap[i.name]=i})},_createHead:function(){var e=this,i=this.options,a=t('<div class="filter-head"/>');t('<div class="head-title"/>').text("").appendTo(a);var n=t('<div class="btn-filter-set"/>').append(t('<i class="icon-setting"/>')).append(t("<span />").text("")).appendTo(a);t('<div class="btn-filter-clear"/>').append(t('<i class="icon-broom"/>')).append(t("<span />").text("")).on("click",function(){e._clearFilters(),FXM.Utils.applyFunc(e,i.onStopEdit,[],!1)}).appendTo(a);var r=[];FXM.Utils.forEach(i.fields,function(t,i){var a={text:i.text,value:i.name,selected:e._indexOfField(i.name)>-1};r.push(a)});var s={title:"",render:n,items:r,onStopEdit:function(t){var i=[];FXM.Utils.forEach(t,function(t,a){var n=e._indexOfField(a);n>-1?i.push(e.filters[n]):i.push({field:a})}),e.filters=i,e._createFilters(!0)}};return i.hasFlowFilters&&t.extend(s,{emptyTip:"",emptySubTip:""}),this.fieldsSelect=new FXM.DataCombocheck(s),a},_indexOfField:function(t){var e=-1;return FXM.Utils.forEach(this.filters,function(i,a){if(FXM.Utils.getFilterKey(a)===t)return e=i,!1}),e},_createRelation:function(){var e=this,i=t('<div class="filter-relation"/>');return t('<span class="rel-desc"/>').text("").appendTo(i),new FXM.Segment({render:t('<div class="rel-seg"/>').appendTo(i),width:100,value:this.relation,items:[{text:"",value:FXM.CONSTS.FILTER_RELATION.AND,selected:this.relation===FXM.CONSTS.FILTER_RELATION.AND},{text:"",value:FXM.CONSTS.FILTER_RELATION.OR,selected:this.relation===FXM.CONSTS.FILTER_RELATION.OR}],onAfterItemSelect:function(){e.relation=this.getValue()}}),t('<span class="rel-desc"/>').text("").appendTo(i),i},_createFlowFilters:function(){var e=this.options,i=this;return this.flowFilter={formId:null,nodes:[]},this.$flowFilters||(this.$flowFilters=t('<div class="flow-filters"/>')),"todo"!==e.flowType&&(this.flowState=new FXM.FilterFlowState({render:t('<div class="filter-item">').appendTo(this.$flowFilters),title:"",onStopEdit:function(){var t=this.getValue(),a=!0,n=FXM.CONSTS.WORKFLOW.FLOWSTATE;t.value&&[n.COMPLETE,n.CLOSE].indexOf(t.value[0])>-1&&(a=!1),i.flowNode.rebuild({enable:a}),e.fields=[],i._rebuildFilterList(a)}})),"create"!==e.flowType&&(this.flowCreator=new FXM.FilterFlowCreator({render:t('<div class="filter-item"/>').appendTo(this.$flowFilters),title:"",async:{url:FXM.Utils.getApi(FXM.API.data.flow_creators),data:{type:e.flowType}},hasLimit:!0})),this.flowDate=new FXM.FilterDate({render:t('<div class="filter-item"/>').appendTo(this.$flowFilters),title:""}),this.flowEntry=new FXM.FilterFlowEntry({render:t('<div class="filter-item"/>').appendTo(this.$flowFilters),title:"",flowType:e.flowType,onStopEdit:function(){var t=this.getValue();t.value?i.flowFilter.formId=t.value[0]:i.flowFilter.formId=null,i.flowFilter.nodes=[],i.flowNode.rebuild({formId:i.flowFilter.formId}),e.fields=[],i._rebuildFilterList(!0)}}),this.flowNode=new FXM.FilterFlowNode({render:t('<div class="filter-item"/>').appendTo(this.$flowFilters),title:"",onStopEdit:function(){i.flowFilter.nodes=this.getSelectedNode(),i._getSelectFields(function(a){var n=[];FXM.Utils.forEach(a,function(e,a){FXM.CONSTS.LIMIT_FIELDS.filter.indexOf(a.type)<0||("subform"===a.type?FXM.Utils.forEach(a.items,function(e,r){FXM.CONSTS.LIMIT_FIELDS.filter.indexOf(r.type)>-1&&n.push(t.extend({},r,{name:[a.name,r.name].join("."),text:[a.text,r.text].join("."),id:i.flowFilter&&i.flowFilter.formId}))}):n.push(t.extend({},a,{id:i.flowFilter&&i.flowFilter.formId})))}),e.fields=n,i._rebuildFilterList(!0)})}}),this.$flowFilters},_getSelectFields:function(t){var e=this.flowFilter;if(!e.formId||FXM.Utils.isObjectEmpty(e.nodes))return t();FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.flow.get_node_fields,FXM.STATIC.APPID),data:{formId:e.formId,nodes:e.nodes}},function(e){t(e.fields)})},_rebuildFilterList:function(t){this.$list&&this.$list.empty(),this._initFieldMap(),this.$head&&this.$head.remove(),this.$head=this._createHead().prependTo(this.element),this.filters=[],this.fieldsSelect.setEnable(t)},_createFilters:function(e){var i=this,a=this.options,n=this.filters,r=FXM.CONSTS.FILTER_METHOD;if(this.$list?this.$list.empty():this.$list=t('<div class="filter-list"/>').appendTo(this.$body),0!==n.length||a.hasFlowFilters)return FXM.Utils.forEach(n,function(a,n){var s=FXM.Utils.getFilterKey(n),o=i.fieldMap[s];if(o){var l={id:n.entryId,name:s,type:n.type,text:o.text};e?(l.value=n.value,l.hasEmpty=n.hasEmpty,l.method=n.method):n.method!==r.EP&&n.method!==r.NEP&&(l.method=n.method),i._createFilterItem(t.extend(l,o)).appendTo(i.$list)}}),this.$list;FXM.UI.createEmptyTip({msg:""}).appendTo(this.$list)},_clearFilters:function(){this.options.hasFlowFilters?(this.fields=[],this.$list.empty(),this.$flowFilters.empty(),this._createFlowFilters()):(this.filters=this.getCacheValue().cond,this._createFilters(!1))},_createFilterItem:function(e){var i=this,a=this.options,n=this._getConfigFromFilter(e);if(n){var r=t('<div class="filter-item"/>').data("field",e);t.extend(n,{render:t("<div />").appendTo(r),onStopEdit:function(){FXM.Utils.applyFunc(i,a.onStopEdit,[],!1)}});var s=FXM.createWidget(n);return r.data("widget",s),r}},_getConfigFromFilter:function(e){this.options;var i={title:e.text,method:e.method,value:e.value,hasEmpty:e.hasEmpty,name:e.name};switch(e.type){case"text":"creator"===e.name?(t.extend(i,this._getUserConfig(e)),i.type="filter_user"):(i.type="filter_text",i.hasSelectEmpty=!0,t.extend(i,this._getSelectConfig(e)));break;case"radiogroup":case"combo":i.type="filter_text",i.hasSelectEmpty=!0,t.extend(i,this._getSelectConfig(e));break;case"textarea":i.type="filter_textarea";break;case"combocheck":case"checkboxgroup":i.type="filter_check",t.extend(i,this._getSelectConfig(e));break;case"number":i.type="filter_number";break;case"datetime":i.type="filter_date",i.format=e.format;break;case"address":case"location":i.type="filter_address";break;case"user":case"usergroup":i.type="filter_"+e.type,t.extend(i,this._getUserConfig(e));break;case"dept":i.type="filter_dept";break;case"deptgroup":i.type="filter_deptgroup";break;case"linkdata":t.extend(i,this._getLinkDataConfig(e));break;case"flownode":i.type="filter_flownode";break;case"flowstate":i.type="filter_flowstate";break;case"upload":case"image":i.type="filter_file";break;case"signature":i.type="filter_signature"}return FXM.Utils.isNull(i.type)?null:i},_getLinkDataConfig:function(t){this.options;var e=FXM.Utils.getFieldInfoById(t.id),i={type:t.linkType};switch(t.linkType){case"text":case"number":case"radiogroup":case"combo":i.type="filter_text",i.hasSelectEmpty=!0,i.async={url:FXM.Utils.getApi(FXM.API.data.distinct),data:{field:t.linkKey,refAppId:t.refAppId,formId:t.linkForm,entryId:e.entryId}},i.hasLimit=!0;break;case"datatime":i.type="filter_date"}return i},_getSelectConfig:function(t){var e=this.options,i=FXM.Utils.getFieldInfoById(t.id),a={},n=FXM.Utils.getApi(FXM.API.data.distinct),r={refAppId:i.appId,formId:i.entryId,entryId:e.flowType?null:i.entryId,field:t.name,type:t.type,authGroupId:e.authGroupId};return e.hasFlowFilters&&(n=FXM.Utils.getApi(FXM.API.flow.distinct,FXM.STATIC.APPID),r.group=e.flowType,r.formId=this.flowFilter.formId),a.async={url:n,data:r},a.hasLimit=!0,a},_getUserConfig:function(e){var i=this.options,a=FXM.Utils.getFieldInfoById(e.id),n=FXM.Utils.getApi(FXM.API.data.distinct),r={refAppId:a.appId,entryId:i.flowType?null:a.entryId,formId:a.entryId,field:e.name,type:e.type,authGroupId:i.authGroupId};return i.flowType&&(n=FXM.Utils.getApi(FXM.API.flow.distinct,FXM.STATIC.APPID),t.extend(r,{group:i.flowType})),{hasSelectEmpty:!0,async:{url:n,data:r},hasLimit:!0}},getValue:function(){return this._getValue(!0)},getCacheValue:function(){return this._getValue(!1)},_getValue:function(e){var i=this.options,a=t(".filter-item",this.element),n=[];if(FXM.Utils.forEach(a,function(i,a){var r=t(a).data("widget");if(!e||r&&r.checkValidate()){var s=t(a).data("field"),o=r.getValue(),l={type:r.getFilterType(),method:o.method,hasEmpty:o.hasEmpty,value:o.value};t.extend(l,FXM.Utils.dealFilterInfoByField(s)),"linkdata"===s.type&&(l.keyType=l.type,l.type=s.type),n.push(l)}}),i.hasFlowFilters){var r=this._getFlowFilterCond();n=n.concat(r)}return{cond:n,rel:this.relation}},_getFlowFilterCond:function(){var e=[],i=[{widget:this.flowCreator,type:"user",field:"creator"},{widget:this.flowDate,type:"datetime",field:"createTime"},{widget:this.flowState,type:"flowstate",field:"flowState"},{widget:this.flowEntry,type:"flowentry",field:"entryId"},{widget:this.flowNode,type:"flownode",field:"chargers"}];return FXM.Utils.forEach(i,function(i,a){var n=a.widget;if(n&&n.checkValidate()){var r=n.getValue();e.push(t.extend(r,{type:a.type,field:a.field}))}}),e}})}(Zepto),function(t){FXM.SubForm=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return t.extend(FXM.SubForm._super._defaults.apply(this,arguments),{baseCls:"x-subform",allowBlank:!0,items:[],mode:"edit",onBeforeWidgetCreate:null,onAfterWidgetCreate:null,subform_create:!0,subform_edit:!0,subform_delete:!0})},_init:function(){FXM.SubForm._super._init.apply(this,arguments);var e=this,i=this.options;this.$content=t('<div class="x-subform-content"/>').appendTo(this.element),this.$body=t('<div class="x-subform-body"/>').appendTo(this.$content),this.rowIdx=0,i.items.length>0&&this._allowCreate()&&this._appendLine(null,!0),"edit"===i.mode&&this._allowCreate()&&(this.$addBtn=t('<button class="x-btn style-white x-subform-btn-add"/>').appendTo(this.element).html('<i class="icon icon-add"></i><span></span>').on("click",function(){e._addNewLine()}))},showActionSheet:function(){var e=this,i=(this.options,t('<div class="action-content"><div class="item" role="fold"></div><div class="item" role="expand"></div>'+(this._allowCreate()?'<div class="item style-blue" role="add"></div>':"")+"</div>").on("click",".item",function(i){var n=t(i.currentTarget).attr("role");switch(a.close(),n){case"fold":e._foldLine();break;case"expand":var r=t(".x-subform-line",e.$content);FXM.Utils.forEach(r,function(e,i){t(i).addClass("expand")});break;case"add":e._addNewLine()}})),a=new FXM.SlidePanel({customCls:"responsive x-subform-more",content:i,text4Left:"",text4Right:"",direction:"bottom",onLeftClick:function(){this.close()}});a.show()},_foldLine:function(){var e=this,i=t(".x-subform-line",this.$content);FXM.Utils.forEach(i,function(i,a){t(a).hasClass("expand")&&(t(a).removeClass("expand"),t(a).find(".x-subform-title > .x-subform-text").text(e._getLineTitle(t(a))))})},_addNewLine:function(){var e=this,i=this.options;if(this._allowCreate())if(t(".x-subform-line",this.$body).length>=200)FXM.UI.toast({type:"warning",msg:"200"});else{this._foldLine();var a=this._appendLine(null,!0);a.length&&t(".widget-wrapper").scrollTop(a[0].offsetTop),FXM.Utils.applyFunc(e,i.onStopEdit,[],!1)}},_initDefaultValue:function(t){this.setValue(t)},_appendLine:function(e,i){var a=this.options,n=this;if(0!==a.items.length){this.rowIdx++;var r=t('<div class="x-subform-line expand"/>').appendTo(this.$body);r.data("rowIdx",this.rowIdx),r.data("editable",i);var s=t('<div class="x-subform-title"></div>').prependTo(r).click(function(e){if(t(e.target).closest("a.x-subform-delete").length>0){if(!n._allowDelete()&&!i)return;FXM.UI.confirm("",function(){r.remove();var e=t(".x-subform-line",n.$content);FXM.Utils.forEach(e,function(e,i){t(i).data("rowIdx",e+1),t(i).find(".x-subform-title > .x-subform-text").text(n._getLineTitle(t(i)))}),n.rowIdx--,FXM.Utils.applyFunc(n,a.onStopEdit,[],!1)})}else r.toggleClass("expand"),r.hasClass("expand")||t(this).children(".x-subform-text").text(n._getLineTitle(r))});if(s.append('<i class="icon-arrow icon-arrow-right"/><span class="x-subform-text"/>'),"edit"===a.mode&&(this._allowDelete()||i))t('<a class="x-subform-delete"/>').append(t('<i class="icon icon-trash"/>')).prependTo(s);return FXM.Utils.forEach(a.items,function(s,o){var l=t('<div class="x-subform-cell"/>').appendTo(r),c=t('<div class="x-subform-label-text"/>').text(o.label);t('<div class="x-subform-label"/>').appendTo(l).append(c);var h=t('<span class="f-required"/>').text("*").hide().appendTo(c);!1===o.widget.allowBlank&&h.show();var u=t.extend(!0,{},o.widget);!1===o.widget.visible&&l.addClass("x-ui-hidden"),n._allowEdit()||i||(u.enable=!1);var d=new FXM.SubformItem({render:t('<div class="x-subform-cell-widget"/>').appendTo(l),subform:a.widgetName,widget:t.extend(FXM.FormUtils.getWidgetDefaultConfig(u.type),u),onBeforeWidgetCreate:function(t){FXM.Utils.applyFunc(this,a.onBeforeWidgetCreate,[t,e],!1)}});if(FXM.Utils.applyFunc(n,a.onAfterWidgetCreate,[d],!1),l.attr("namecol",d.getWidgetName()),e&&!FXM.Utils.isEmpty(e[d.getWidgetName()])){var p=e[d.getWidgetName()];p.hasOwnProperty("widgetType")?d.setValue(p.data):d.setValue(p)}l.data("widget",d)}),s.children(".x-subform-text").text(this._getLineTitle(r)),r}},_getLineTitle:function(e){var i=[],a=3;FXM.Utils.forEach(t(".x-subform-cell-widget",e),function(e,n){var r=t(n).parent().data("widget");if(r.isVisible()&&!(FXM.CONSTS.LIMIT_FIELDS.subformTitle.indexOf(r.getWidgetType())<0)){if(a<=0)return!1;a--;var s=r.getText();FXM.Utils.isObjectEmpty(s)||i.push(s)}});var n="("+e.data("rowIdx")+") ";return i.length>0&&(n+=i.join("")),n},getWidgetByName:function(e,i){var a=[];return FXM.Utils.forEach(this.$content.find('.x-subform-cell[namecol="'+e+'"]'),function(e,i){var n=t(i).data("widget");n&&a.push(n)}),FXM.Utils.isNull(i)?a:a[i]},setEnable:function(e){FXM.SubForm._super.setEnable.apply(this,arguments);var i=this.options,a=t(".x-subform-line",this.$content);FXM.Utils.forEach(a,function(a,n){var r=t(".x-subform-cell-widget",t(n));FXM.Utils.forEach(r,function(a,n){var r=i.items[a],s=e;r&&!1===r.widget.enable&&(s=!1);var o=t(n).parent().data("widget");o&&o.setEnable(s)})})},_clearContent:function(){this.$content.find(".x-subform-line").remove(),this.rowIdx=0},setValue:function(t){var e=this;this._clearContent(),FXM.Utils.forEach(t,function(t,i){e._appendLine(i)})},getValue:function(){var e=[],i=t(".x-subform-line",this.$content);return FXM.Utils.forEach(i,function(i,a){var n={},r=!0,s=t(".x-subform-cell-widget",t(a));FXM.Utils.forEach(s,function(e,i){var a=t(i).parent().data("widget");if(a&&FXM.Utils.allowValueSubmit(a.getWidgetType())){var s=a.getValue();r=FXM.Utils.isObjectEmpty(s)&&r,n[a.getWidgetName()]={data:s,widgetType:a.getWidgetType()}}}),r||e.push(n)}),e},checkValidate:function(){var e=this.options,i=this,a=[],n=!0,r=t(".x-subform-line",this.$content);return FXM.Utils.forEach(r,function(e,r){var s={},o=!0,l=!0,c=t(".x-subform-cell-widget",t(r));FXM.Utils.forEach(c,function(e,a){var n=t(a).parent().data("widget");if(n.isVisible()){var r=n.checkValidate();r?i.clearErrorMsg(n):i.setErrorMsg(n),l=r&&l;var s=n.getValue();o=FXM.Utils.isObjectEmpty(s)&&o}}),o?(l=!0,i.clearLineError(t(r))):(a.push(s),l?i.clearLineError(t(r)):i.setLineError(t(r))),n=l&&n}),!e.allowBlank&&a.length<=0?(this.setInvalidType(!1,FXM.CONSTS.INVALID_TYPE.BLANK),!1):n?(this.setInvalidType(!0),n):(this.setInvalidType(!1,FXM.CONSTS.INVALID_TYPE.REGEX),!1)},getNullValue:function(){return[]},getCacheValue:function(){var e=[],i=t(".x-subform-line",this.$content);return FXM.Utils.forEach(i,function(i,a){var n={},r=!0,s=t(".x-subform-cell-widget",t(a));FXM.Utils.forEach(s,function(e,i){var a=t(i).parent().data("widget");if(!(FXM.CONSTS.LIMIT_FIELDS.noCache.indexOf(a.getWidgetType())>-1)){var s=a.getCacheValue();r=FXM.Utils.isObjectEmpty(s)&&r,n[a.getWidgetName()]={data:s,widgetType:a.getWidgetType()}}}),n.editable=t(a).data("editable"),r||e.push(n)}),e},setCacheValue:function(t){var e=this;this._clearContent(),FXM.Utils.forEach(t,function(t,i){e._appendLine(i,i.editable)})},_allowCreate:function(){var t=this.options;return t.enable&&t.subform_create},_allowEdit:function(){var t=this.options;return t.enable&&t.subform_edit},_allowDelete:function(){var t=this.options;return t.enable&&t.subform_delete},setErrorMsg:function(t){var e=t.element.closest(".x-subform-cell");FXM.Utils.setErrorMsg(t,e)},clearErrorMsg:function(t){t.element.closest(".x-subform-cell").children(".f-error-info").remove()},setLineError:function(t){t.addClass("x-ui-invalid")},clearLineError:function(t){t.removeClass("x-ui-invalid")},setInvalidType:function(t,e){this.invalidType=t?void 0:e,t||e!==FXM.CONSTS.INVALID_TYPE.BLANK?this.element.removeClass("x-ui-invalid"):this.element.addClass("x-ui-invalid")}}),FXM.register("subform",FXM.SubForm)}(Zepto),function(t){FXM.Progress=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.Progress._super._defaults.apply(),{baseCls:"x-progress",valueMin:0,valueMax:100,value:0})},_init:function(){FXM.Progress._super._init.apply(this,arguments),this.$bar=t('<div class="progress-bar" />').appendTo(this.element),this.setValue()},setValue:function(t){var e=this.options;FXM.Utils.isNull(t)||(e.value=t);var i=parseInt((e.value-e.valueMin)/(e.valueMax-e.valueMin)*100);this.$bar.css({width:i+"%"})}}),FXM.register("progress",FXM.Progress)}(Zepto),function(t){FXM.CircleProgress=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.CircleProgress._super._defaults.apply(),{baseCls:"x-circle-progress",valueMin:0,valueMax:100,value:0})},_init:function(){FXM.CircleProgress._super._init.apply(this,arguments),this.element.append('<div class="progress-mask"/>');var e=t('<div class="progress-circle"/>').appendTo(this.element);this.$circleLeft=t('<div class="circle-left animation" ><div class="inner"/></div>').appendTo(e),this.$circleRight=t('<div class="circle-right animation" ><div class="inner"/></div>').appendTo(e),this.$circleText=t('<div class="circle-text"/>').appendTo(e),this.setValue()},setValue:function(e){var i=this.options;FXM.Utils.isNull(e)||(i.value=e);var a=Math.min(parseInt((i.value-i.valueMin)/(i.valueMax-i.valueMin)*100),100);a>0&&a<=50?this._setCircleProgress(t(".inner",this.$circleRight),a,0,-135):a>50&&a<=100&&(50!==parseInt(t(".inner",this.$circleRight).attr("progress"),10)&&(this.$circleRight.removeClass("animation"),this.setValue((i.valueMax-i.valueMin)/2)),this._setCircleProgress(t(".inner",this.$circleLeft),a,-50,45)),this.$circleText.text(a+"%")},_setCircleProgress:function(t,e,i,a){if(t&&t.length){var n=3.6*(e+i)+a;t.attr("progress",e).css(FXM.Utils.formatTransform("rotate("+n+"deg)"))}}}),FXM.register("circleprogress",FXM.CircleProgress)}(Zepto),function(t){FXM.FileUpload=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return t.extend(FXM.FileUpload._super._defaults.apply(this,arguments),{baseCls:"x-fileupload",files:[],fileType:[],maxFileSize:5242880,maxFileCount:FXM.CONSTS.UPLOAD_FILE_COUNT.SINGLE,uploadURL:FXM.Utils.getApi(FXM.API.file.upload),uploadTokenURL:"",uploadSite:"qn",uploadToMedia:!1,uploadToForm:!0,mode:"upload",thumbWidth:40,thumbHeight:40,allowBlank:!0,btnText:"",maxLimitTip:"",noSupportTip:"",uploadFailTip:"",iconCls:"icon-upload",waterMark:"",onValidateSuccess:null,onValidateFail:null,onAfterValidate:null,onUploadSuccess:null,onUploadFail:null,onAfterUpload:null})},_init:function(){FXM.FileUpload._super._init.apply(this,arguments);var t=this.options;this.files=t.files||[],"qn"===t.uploadSite&&(t.uploadURL="https://up.qbox.me/"),this._bindFileEvent(),"upload"===t.mode&&(this.tokenKey=t.uploadToMedia?"imageUploadToken":"fileUploadToken",this.tokenExpireKey=this.tokenKey+"Expires",this._createUploadBtn()),this.element.attr("data-watermark",t.waterMark)},_createUploadBtn:function(){var e=this,i=this.options;this.$uploadBtn=t('<div class="upload-btn x-btn"/>').appendTo(this.element);var a=t('<div class="btn-wrapper"/>').appendTo(this.$uploadBtn);if(t('<i class="'+i.iconCls+' upload-icon"/>').appendTo(a),t('<span class="upload-text"/>').text(i.btnText).appendTo(a),this.$uploadInput=t('<input type="file" name="file" class="upload-btn-input"/>').appendTo(this.$uploadBtn),i.maxFileCount>FXM.CONSTS.UPLOAD_FILE_COUNT.SINGLE&&this.$uploadInput.attr("multiple",!0),i.fileType.length>0){var n="."+i.fileType.join(",.");this.$uploadInput.prop("accept",n)}this.$uploadInput.off("change"),this.$uploadInput.on("change",function(){e._onFileInputChanged()})},_onFileInputChanged:function(){var e=this.options;this.upFiles=this.$uploadInput[0].files,e.maxFileCount===FXM.CONSTS.UPLOAD_FILE_COUNT.SINGLE&&(this.files=[],t(".upload-info",this.element).remove()),this._checkUploadFiles(this.upFiles)?this.doUpload():this.upFiles=null},_checkUploadFiles:function(t){var e=this,i=this.options;if(this.files.length+t.length>i.maxFileCount)return FXM.UI.toast({msg:" "+i.maxFileCount+" ",type:"warning"}),!1;var a=!0;if(t)for(var n=0,r=t.length;n<r&&(a=a&&e._checkFile(t[n]));n++);return a},_previewFiles:function(t){var e=this;if(t||(t=this.files),t)for(var i=0,a=t.length;i<a;i++)e._createFilePreview(t[i]).prependTo(e.element)},_createFilePreview:function(e){var i=this,a=this.options,n=t('<div class="upload-info"/>'),r=t('<div class="upload-preview"/>').appendTo(n),s=e.name?e.name.split(".").pop():"";FXM.Utils.isImageExt(s)?e instanceof File?i._drawLocalPreview(e).appendTo(r):e.qnKey&&i._drawRemotePreview(e,function(t){t.appendTo(r)}):FXM.Utils.createFileThumb(s).appendTo(r);var o=this._createFileInfo(e);return o&&o.appendTo(n),!a.enable||e instanceof File||this._createRemoveBtn().appendTo(r),e instanceof File||n.data("file",e),n},_createFileInfo:function(e){if(e){var i=t('<div class="upload-file-info"/>'),a=FXM.Utils.formatFileSize(e.size),n=this._trimFileName(e.name);return t('<div class="name-text"/>').text(n).appendTo(i),t('<div class="info-text"/>').text(a).appendTo(i),i}},_createRemoveBtn:function(){return t('<i class="delete-btn icon-trash"/>')},_bindFileEvent:function(){var e=this,i=this.options;this.element.off("click"),this.element.on("click",function(a){if(!e.element.hasClass("uploading")){var n=a.target,r=t(n).closest(".delete-btn"),s=t(n).closest(".upload-info");if("upload"===i.mode&&r&&r.length>0)o=s.data("file"),e.files=e.files.filter(function(t){return t._id!==o._id}),s.remove();else if(s&&s.length>0){var o=s.data("file");if(!FXM.Utils.isObjectEmpty(o)){var l=[];FXM.Utils.forEach(t(".upload-info",e.element),function(e,i){var a=t(i).data("file");l.push(a)}),e._createPreview(s.index(),l)}}}})},_createPreview:function(t,e){new FXM.FilePreview({files:e,current:t})},_trimFileName:function(t){if(FXM.Utils.isEmpty(t))return"";var e=t.split(".").pop();return t.length-e.length-1>20&&(t=(t=t.slice(0,19))+"..."+e),t},_drawLocalPreview:function(e){var i,a=this.options,n=t('<canvas class="image-thumb"/>'),r=window.URL||window.webkitURL,s=n[0].getContext("2d"),o=new Image;i=e instanceof File?r.createObjectURL(e):e,o.src=i;var l=2*a.thumbWidth,c=2*a.thumbHeight;return s.canvas.width=l,s.canvas.height=c,o.onload=function(){var t=Math.max(l/o.width,c/o.height);s.drawImage(o,0,0,o.width,o.height,0,0,o.width*t,o.height*t),r.revokeObjectURL(i)},n},_drawRemotePreview:function(e,i){var a=this.options,n=t('<img class="image-thumb"/>').hide(),r=t.extend({thumb:{mode:2,width:2*a.thumbWidth,height:2*a.thumbHeight}},e);if(e.thumbMobileUrl)return n.attr("src",e.thumbMobileUrl).show(),i(n);FXM.Utils.getFileDownloadURL(r,function(t){return n.attr("src",t).show(),i(n)})},doUpload:function(){var t=this;if(!this.upFiles){if(!this.$uploadInput[0].files.length>1)return;this.upFiles=this.$uploadInput[0].files}!this.upFiles||this.upFiles.length<=0||(this.$uploadBtn.hide(),this._checkUploadToken(function(){t._doDataUpload()}))},_isTokenValid:function(){return FXM.STATIC[this.tokenKey]&&Date.now()<FXM.STATIC[this.tokenExpireKey]},_checkUploadToken:function(t){var e=this,i=this.options;return"qn"!==i.uploadSite?t():this._isTokenValid()?t():void FXM.Utils.dataAjax({url:i.uploadTokenURL,data:{site:i.uploadSite,isMedia:i.uploadToMedia}},function(i){FXM.STATIC[e.tokenKey]=i.token,FXM.STATIC[e.tokenExpireKey]=18e5+Date.now(),t()})},_doDataUpload:function(){var t=this;if(this.successCount=0,this.failCount=0,this.upFiles){t.element.addClass("uploading");for(var e=0,i=this.upFiles.length;e<i;e++){var a=this.upFiles[e];t._uploadFile(a)}}},_uploadFile:function(t){var e=this,i=this.options,a=e._createFilePreview(t).prependTo(e.element),n=t.size,r=this._createProgress(t.size,a);r.setValue(.1*t.size),FXM.Utils.uploadFile({uploadSite:i.uploadSite,uploadUrl:i.uploadURL,uploadToMedia:i.uploadToMedia,uploadToForm:i.uploadToForm,uploadToken:FXM.STATIC[this.tokenKey],widgetName:i.widgetName},t,function(t){r.setValue(t)},function(t){a.data("file",t.file),r.setValue(n),e.files.push(t.file),e.successCount++,setTimeout(function(){r.setVisible(!1)},600),i.enable&&e._createRemoveBtn().appendTo(a),e._onUploadFinished()},function(t,a,n){r.setValue(0),e.failCount++,setTimeout(function(){r.setVisible(!1)},600),413===n?FXM.UI.toast({msg:i.maxLimitTip,type:"warning"}):FXM.UI.toast({msg:i.uploadFailTip,type:"error"}),e._onUploadFinished()})},_createProgress:function(e,i){return new FXM.Progress({render:t("<div/>").appendTo(i),valueMax:e})},_onUploadFinished:function(){var t=this.options;this.successCount+this.failCount<this.upFiles.length||(this.failCount>0?FXM.Utils.applyFunc(this,t.onUploadFail,[{failCount:this.failCount}],!1):(FXM.Utils.applyFunc(this,t.onUploadSuccess,[this.files],!1),this._resetUploadInput()),this.$uploadBtn.show(),this.element.removeClass("uploading"))},checkValidate:function(){var t=this.options,e=!0;return t.allowBlank||(e=!FXM.Utils.isObjectEmpty(this.files)),e?FXM.Utils.applyFunc(this,t.onValidateSuccess,[],!1):FXM.Utils.applyFunc(this,t.onValidateFail,[],!1),FXM.Utils.applyFunc(this,t.onAfterValidate,[],!1),this.setInvalidType(e,FXM.CONSTS.INVALID_TYPE.BLANK),e},_checkFile:function(t){var e=this.options;if(!t)return!1;var i=t.name,a=i.split(".").pop(),n=!0;n&&e.fileType.length>0&&-1===e.fileType.indexOf(a.toLowerCase())&&(FXM.UI.toast({msg:e.noSupportTip,type:"warning"}),n=!1);var r=e.maxFileSize;return n&&t.size>r&&(FXM.UI.toast({msg:e.maxLimitTip,type:"warning"}),n=!1),n&&"/"===i&&(n=!1),n},_resetUploadInput:function(){var t=this;this.$uploadInput.replaceWith(this.$uploadInput=this.$uploadInput.clone(!0)),this.$uploadInput.off("change"),this.$uploadInput.on("change",function(){t._onFileInputChanged()})},setEnable:function(e){FXM.FileUpload._super.setEnable.apply(this,arguments),this.$uploadInput&&(e?this.$uploadInput.removeAttr("disabled").removeAttr("readonly").removeClass("x-ui-disable"):this.$uploadInput.addClass("x-ui-disable").attr("disabled",!0).attr("readonly",!0)),t(".upload-info",this.element).remove(),this._previewFiles()},getValue:function(){return this.files},setValue:function(e){var i=this.options;e?FXM.Utils.isArray(e)?this.files=e:this.files=[e]:this.files=[],this.files.length>i.maxFileCount&&(this.files=this.files.slice(0,i.maxFileCount)),this.files&&(t(".upload-info",this.element).remove(),this._previewFiles())},getNullValue:function(){return[]}}),FXM.register("upload",FXM.FileUpload)}(Zepto),function(t){FXM.FilePreview=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.FilePreview._super._defaults.apply(),{render:t("<div/>").appendTo(t("body")),baseCls:"x-file-preview",files:[],current:0,maxTouch:.2})},_init:function(){FXM.FilePreview._super._init.apply(this,arguments);var e=this.options;this.$fileWrapper=t('<div class="preview-wrapper"/>').appendTo(this.element),this.perWidth=this.$fileWrapper.outerWidth(!0);var i=e.files;i&&i.length&&(this._createCloseBtn(),this._createCacheItems(e.current),this._viewFileAt(e.current),this._bindEvent())},_createCacheItems:function(t){var e=this.options.files,i=t-1,a=t+1;this._createFileItem(t),e[i]&&this._createFileItem(i),e[a]&&this._createFileItem(a)},_viewFileAt:function(t,e){this.page=t,this._createCacheItems(t);var i="translate("+-this.page*this.perWidth+"px,0)";this._translate(i,e)},_createFileItem:function(e){var i=this,a=this.options.files[e];if(a){var n;if(this.$fileWrapper.children(".file-item").each(function(i,a){t(a).attr("page")===e+""&&(n=t(a))}),!n||0===n.length){var r=t.extend({down:!0},a);n=t('<div class="file-item" page='+e+"/>").css("left",100*e+"%").appendTo(this.$fileWrapper);var s=FXM.Utils.formatFileSize(a.size),o=this._trimFileName(a.name),l=a.name.split(".").pop();if(FXM.Utils.isImageExt(l))if(a.downloadUrl?this._createImgDownloadBtn(a.downloadUrl).appendTo(n):FXM.Utils.getFileDownloadURL(r,function(t){i._createImgDownloadBtn(t).appendTo(n)}),a.previewUrl)i._appendImage(a.previewUrl,n);else{var c=FXM.UI.createLoadIcon().appendTo(n);FXM.Utils.getFileDownloadURL(t.extend({thumb:{width:1200,height:1200}},a),function(t){c.remove(),i._appendImage(t,n)})}else{var h=t('<div class="file-common"><div class="file-msg">'+o+'</div><div class="file-msg">'+s+"</div></div>").appendTo(n);switch(FXM.Utils.createFileThumb(l,"large").prependTo(h),FXM.Utils.getUA()){case"ios":a.downloadUrl?this._createPreviewBtn(a.downloadUrl).appendTo(h):FXM.Utils.getFileDownloadURL(r,function(t){i._createPreviewBtn(t).appendTo(h)});break;default:a.downloadUrl?this._renderPreviewBtn(h,a.downloadUrl,l):FXM.Utils.getFileDownloadURL(r,function(t){i._renderPreviewBtn(h,t,l)})}}}}},_appendImage:function(e,i){t("<img/>").attr("src",e).appendTo(i)},_createImgDownloadBtn:function(e){var i=t('<a class="download-btn"><i class="icon-download"></i></a>');return FXM.CORP.DD?i.on("click",function(){FXM.Utils.openLink(e)}):i.attr({target:"_blank",href:e}),i},_renderPreviewBtn:function(e,i,a){FXM.Utils.isOfficeExt(a)||FXM.Utils.isPdfExt(a)?this._createPreviewBtn(FXM.Utils.getFileOnlineUrl(a,i)).appendTo(e):t('<div class="file-msg bottom"></div>').appendTo(e),t('<a class="file-btn style-blue" target="_blank"href="'+i+'"></a>').appendTo(e)},_createPreviewBtn:function(e){var i=t('<a class="file-btn"></a>');return FXM.CORP.DD?i.on("click",function(){FXM.Utils.dt(FXM.CONSTS.TRACKER.FILE_PREVIEW),FXM.Utils.openLink(e)}):i.on("click",function(){FXM.Utils.dt(FXM.CONSTS.TRACKER.FILE_PREVIEW)}).attr({target:"_blank",href:e}),i},_trimFileName:function(t){if(FXM.Utils.isEmpty(t))return"";var e=t.split(".").pop();return t.length-e.length-1>20&&(t=(t=t.slice(0,19))+"..."+e),t},_translate:function(t,e){e&&this.$fileWrapper.addClass(e),this.$fileWrapper.css(FXM.Utils.formatTransform(t))},_bindEvent:function(){var e=this,i=this.options;this.startX=0,this.startTime=+new Date,this.element.on({touchstart:function(t){e.$fileWrapper.removeClass("transition-fast transition-slow");var i=t.touches[0];e.startX=i.pageX,e.startTime=+new Date},touchmove:function(t){var a=t.touches[0].pageX-e.startX;if(0===e.page&&a>e.perWidth*i.maxTouch)return!1;if(e.page===i.files.length-1&&a<-e.perWidth*i.maxTouch)return!1;var n="translate("+(-e.page*e.perWidth+a)+"px,0)";e._translate(n)},touchend:function(t){var a=t.changedTouches[0],n=+new Date-e.startTime,r=a.pageX-e.startX;e.startX=a.pageX;var s=n>500?"transition-slow":"transition-fast",o=Math.abs(r)>e.perWidth*i.maxTouch;if(0===e.page)r<0&&o&&i.files[e.page+1]?e._viewFileAt(e.page+1,s):e._viewFileAt(e.page,s);else if(e.page===i.files.length-1)r>0&&o?e._viewFileAt(e.page-1,s):e._viewFileAt(e.page,s);else if(o){var l=r>0?e.page-1:e.page+1;e._viewFileAt(l,s)}else e._viewFileAt(e.page,s)},click:function(i){t(i.target).closest(".download-btn, .file-btn").length||e.element.remove()}})},_createCloseBtn:function(){var e=this;t('<div class="close-btn"><i class="icon-close"/></div>').on("click",function(){e.element.remove()}).appendTo(this.element)}}),FXM.register("filepreview",FXM.FilePreview)}(Zepto),function(t){FXM.User=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return t.extend(FXM.User._super._defaults.apply(this,arguments),{baseCls:"x-user",title:"",msg:"",value:null,allowBlank:!0,noRepeat:!1,editable:!1,count:100,limit:{},dynamicFields:[{id:FXM.CONSTS.USER_ID.CurrentUser,name:"",type:"dynamic"}],dynamicKey:FXM.CONSTS.USER_ID.CurrentUser,dynamicType:"select",onStopEdit:null})},_init:function(){FXM.User._super._init.apply(this,arguments),this.selectMap={},this._initSelectPane()},_initData:function(){if(!FXM.Utils.isExternalLink()){var t=this.options;t.items&&(this.items=t.items),this._initSelectPane()}},_initSelectPane:function(){if(FXM.Utils.isExternalLink())return this.element.empty(),void t('<div class="nonsupport-msg"/>').text("").appendTo(this.element);var e=this;this.selectMap={},FXM.Utils.forEach(this.items,function(t,i){i&&(e.selectMap[i.id]=i)}),this._createSelectList(),this._bindEditEvent()},_bindEditEvent:function(){var e=this,i=this.options;this.$selectList.unbind("click"),this.$selectList.bind("click",function(){e.isEnabled()&&(FXM.Utils.applyFunc(e,i.onBeforeEdit,[],!1),e.bodyScrollTop=FXM.Utils.fixBody(),e.$selectSetPane=t('<div class="x-user-select-set-pane">').css("z-index",FXM.STATIC.zIndex++).appendTo("body"),new FXM.Search({render:t('<div class="select-search"/>').appendTo(e.$selectSetPane),onSearch:function(){e._createSearchList(this.getValue())}}),e._createSelectSettList(),e._initDepartmentList())})},_isRelyLimitEmpty:function(){var t=this.options;return FXM.Utils.isObjectEmpty(t.limit)&&!FXM.Utils.isObjectEmpty(t.limitWidget)},_initDepartmentList:function(){var t=this.options,e=this;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.departments),data:{departmentLimit:t.limit.departs}},function(t){var i={},a=[],n=t.departments;FXM.Utils.forEach(n,function(t,e){i[e.departmentId]={id:e.departmentId,name:e.name,parentId:e.parentId,child:[]}}),FXM.Utils.forEach(i,function(t,e){var n=i[e.parentId];n?n.child.push(e.id):(a.push(e.id),e.level=0,e.name="")}),i[e._getDepartmentId()]?e.departmentList=i[e.currentDepartment].child:e.departmentList=a,e.departmentMap=i,e._createSetList(),e._createSetBtn()})},_createSetList:function(){if(this.$setList?this.$setList.empty():this.$setList=t('<div class="set-list"/>').appendTo(t('<div class="set-pane"/>').appendTo(this.$selectSetPane)),!this._isRelyLimitEmpty()){if(this._createCurrentUserList(),this._hasType("organization")){var e=t('<div class="set-list-block"/>').appendTo(this.$setList);this._createDepartPath().appendTo(e),this._createDepartmentList().appendTo(e)}this._hasType("role")&&this._createRoleList(),this._hasType("member")&&this._createAllUserList()}},_createDepartSetList:function(){this.options;if(1!==this.currentDepartment){this.$setList.empty();var e=t('<div class="set-list-block"/>').appendTo(this.$setList);this._createDepartPath().appendTo(e),this._createDepartmentList().appendTo(e),this._createUserList().appendTo(e)}else this._createSetList()},_createRoleSetList:function(){this.$setList.empty();var e=t('<div class="set-list-block"/>').appendTo(this.$setList);this._createRolePath().appendTo(e),this._createRoleUserList().appendTo(e)},_createSelectList:function(){var e=this,i=this.options;if(this.$selectList?this.$selectList.empty():this.$selectList=t('<ul class="select-list"/>').appendTo(this.element),this.value){var a=e.selectMap[this.value];e._createSelectItem(a)}else i.editable||this.$selectList.append(t('<div class="select-empty"/>').text(i.msg))},_createSelectSettList:function(){var e=this;this.options;if(this.value=this.getValue(),this.$selectSetList&&this.$selectSetList.remove(),this.$selectSetList=t('<ul class="select-list"/>').appendTo(this.$selectSetPane),this.value){var i=e.selectMap[this.value];e._createSelectSetItem(i)}},_setSelectItem:function(t){this.$selectSetList.empty(),this._createSelectSetItem(t),this.value=t.id,this.selectMap[t.id]=t,this._refresh()},_clearSelectItem:function(){this.$selectSetList.empty(),this.value=null,this._refresh()},_createSelectSetItem:function(e){this.options;var i=this;if(e){var a=t('<li class="select-item"/>').append(t("<span/>").text(e.name)).appendTo(this.$selectSetList).attr("id",e.id).data("item",e);a.prepend(t('<i class="select-icon icon-member"/>')),t('<span class="remove-btn"/>').append(t('<i class="icon-close"/>')).click(function(){i._clearSelectItem()}).appendTo(a)}},_createSelectItem:function(e){this.options;e&&t('<li class="select-item"/>').append(t("<span/>").text(e.name)).appendTo(this.$selectList).attr("id",e.id).data("item",e).prepend(t('<i class="select-icon icon-member"/>'))},_createDepartPath:function(){var e=this,i=this.departmentMap[this.currentDepartment];if(!i)return t('<div class="select-path" />').data("departmentId",this.currentDepartment).text("");for(var a=[],n=this.departmentMap[i.parentId];n;)a.unshift(n),n=this.departmentMap[n.parentId];var r=t('<ul class="select-path"/>');return FXM.Utils.forEach(a,function(e,i){t('<li class="path-item"/>').append(t("<span/>").text(i.name)).append(t('<i class="icon-arrow-right"/>')).appendTo(r).data("depart",i)}),t("<li/>").append(t("<span/>").text(i.name)).appendTo(r),r.unbind("click"),r.bind("click",function(i){var a=t(i.target).closest("li.path-item");if(a.length>0){var n=a.data("depart");n&&(e.departmentList=n.child,e.currentDepartment=n.id),e._createDepartSetList()}}),r},_createRolePath:function(){var e=this,i=t('<ul class="select-path"/>');return t('<li class="path-item"/>').append(t("<span/>").text("")).append(t('<i class="icon-arrow-right"/>')).appendTo(i),t("<li />").append(t("<span />").text(this.currentRole.name)).appendTo(i),i.on("click",".path-item",function(){e._createSetList()}),i},_checkCurrentUserValidate:function(){var t=this.options;return FXM.Utils.isObjectEmpty(t.limit)||t.limit.hasCurrentUser},_createCurrentUserList:function(e){this.options;var i=this;if(this._checkCurrentUserValidate(e)&&(this.$currentUserList=t('<ul class="select-user set-list-block"/>').appendTo(this.$setList),FXM.GB.user)){var a={id:FXM.GB.user._id,name:FXM.GB.user.nickname};t('<li class="select-path"></li>').appendTo(this.$currentUserList);var n=t('<li class="user-item"/>').append(t('<i class="icon-member"/>')).append(t("<span/>").text(a.name)).append(t('<div class="select-btn"/>')).appendTo(i.$currentUserList).data("user",a).click(function(){var e=n.children(".select-btn");if(e.hasClass("select"))e.removeClass("select"),i._clearSelectItem();else{t(".select",i.$currentUserList).removeClass("select"),e.addClass("select");var a=n.data("user");i._setSelectItem(a)}});i.value===a.id&&n.children(".select-btn").addClass("select")}},_createDepartmentList:function(){var e=this;return this.$departmentList=t('<ul class="select-depart"/>'),this.departmentList&&this.departmentList.length>0&&FXM.Utils.forEach(this.departmentList,function(t,i){var a=e.departmentMap[i];a&&e._createDepartmentItem(a)}),this.$departmentList.unbind("click"),this.$departmentList.bind("click",function(i){var a=t(i.target).closest("li.depart-item");if(a.length>0){var n=a.data("item");n&&(e.departmentList=n.child,e.currentDepartment=n.id,e._createDepartSetList())}}),this.$departmentList},_createDepartmentItem:function(e){t('<li class="depart-item"/>').append(t('<i class="icon-department"/>')).append(t("<span/>").text(e.name)).append(t('<i class="icon-arrow-right"/>')).appendTo(this.$departmentList).data("item",e)},_createUserList:function(e){e=e||0;var i=this.options,a=this,n=t('ul[role="organization"]',this.$setList);n.length||(n=t('<ul class="select-user" role="organization"/>'),this._bindUserEvent(n));var r={departmentLimit:i.limit.departs,departmentId:a._getDepartmentId(),limit:i.count,skip:e};return FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.user_dept_role),data:r},function(r){var s=r.users;s&&s.length>0?(FXM.Utils.forEach(s,function(t,e){a._createUserItem(e).appendTo(n)}),s.length===i.count&&a._createLoadMoreBtn(e+s.length,a._createUserList).appendTo(n)):0===e&&t('<li class="select-empty"/>').text("").appendTo(n)}),n},_createRoleList:function(){var e=this,i=this.options;this.$roleList=t('<ul class="select-role set-list-block"/>').appendTo(this.$setList),t('<li class="select-path"></li>').appendTo(this.$roleList),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.roles),data:{roleLimit:i.limit.roles}},function(t){FXM.Utils.forEach(t.roles,function(t,i){e._createRoleItem(i)})}),this.$roleList.on("click",".role-item",function(i){var a=t(i.currentTarget);e.currentRole=a.data("role"),e._createRoleSetList()})},_createRoleUserList:function(e){e=e||0;var i=this,a=this.options,n=t('ul[role="role"]',this.$setList);return n.length||(n=t('<ul class="select-role-user" role="role"/>'),this._bindUserEvent(n)),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.user_dept_role),data:{roleId:this.currentRole.role_id,roleLimit:a.limit.roles,limit:a.count,skip:e}},function(r){var s=r.users;s.length?(FXM.Utils.forEach(r.users,function(t,e){i._createUserItem(e).appendTo(n)}),s.length===a.count&&i._createLoadMoreBtn(e+s.length,i._createRoleUserList).appendTo(n)):0===e&&t('<li class="select-empty"/>').text("").appendTo(n)}),n},_createAllUserList:function(e){e=e||0;var i=this,a=this.options,n=t('ul[role="member"]',this.$setList);n.length||(n=t('<ul class="select-user set-list-block" role="member"/>').appendTo(this.$setList),this._bindUserEvent(n)),0===e&&t('<li class="select-path"/>').text("").appendTo(n),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.users),data:{departmentLimit:a.limit.departs,roleLimit:a.limit.roles,userLimit:a.limit.users,hasCurrentUser:a.limit.hasCurrentUser,limit:a.count,skip:e}},function(r){var s=r.users;s.length?(FXM.Utils.forEach(s,function(t,e){i._createUserItem(e).appendTo(n)}),s.length===a.count&&i._createLoadMoreBtn(e+s.length,i._createAllUserList).appendTo(n)):0===e&&t('<li class="select-empty"/>').text("").appendTo(n)})},_createLoadMoreBtn:function(e,i){var a=this;return t('<li class="load-more" />').text("...").data("skip",e).click(function(n){t(n.currentTarget).remove(),FXM.Utils.applyFunc(a,i,[e],!1)})},_bindUserEvent:function(e){var i=this;e.unbind("click"),e.bind("click",function(e){var a=t(e.target).closest("li.user-item"),n=a.children(".select-btn");if(a.length>0&&n.length>0)if(n.hasClass("select"))i._clearSelectItem();else{var r=a.data("user");i._setSelectItem(r)}})},_createUserItem:function(e){var i={id:e._id,name:e.nickname},a=t('<li class="user-item"/>').append(t('<i class="icon-member"/>')).append(t("<span/>").text(i.name)).append(t('<div class="select-btn"/>')).data("user",i);return this.value===i.id&&a.children(".select-btn").addClass("select"),a},_createRoleItem:function(e){t('<li class="role-item"/>').append(t('<i class="icon-charger"/>')).append(t("<span />").text(e.name)).append(t('<i class="icon-arrow-right"/>')).appendTo(this.$roleList).data("role",e)},_createSetBtn:function(){var e=this,i=this.options;t('<div class="set-btn-pane"><div class="set-btn"><button class="x-btn style-white" role="cancel"></button></div><div class="set-btn"><button class="x-btn style-blue" role="confirm"></button></div> </div>').appendTo(this.$selectSetPane).on("click","button",function(a){switch(t(a.currentTarget).attr("role")){case"confirm":e.items=e.getItems(),e._initSelectPane(),e.$setList=null,e.$selectSetPane.remove(),FXM.Utils.releaseBody(e.bodyScrollTop),FXM.Utils.applyFunc(e,i.onStopEdit,[],!1);break;case"cancel":e.$setList=null,e.$selectSetPane.remove(),FXM.Utils.releaseBody(e.bodyScrollTop)}})},_createSearchList:function(e){if(e){var i=this,a=this.options;this.$setList.empty();var n=t('<ul class="select-user set-list-block"/>').appendTo(this.$setList);FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.users),data:{departmentLimit:a.limit.departs,roleLimit:a.limit.roles,userLimit:a.limit.users,hasCurrentUser:a.limit.hasCurrentUser,limit:a.count,keyword:e}},function(e){var a=e.users;a.length?FXM.Utils.forEach(a,function(t,e){i._createUserItem(e).appendTo(n)}):t('<li class="select-empty"/>').text("").appendTo(n)}),this._bindUserEvent(n)}else this._createSetList()},_getDynamicFields:function(){return this.options.dynamicFields},_getDepartmentId:function(){return FXM.Utils.isEmpty(this.currentDepartment)&&(this.currentDepartment=1),this.currentDepartment},getItems:function(){var e=[];return this.$selectSetList&&t(".select-item",this.$selectSetList).each(function(i,a){e.push(t(a).data("item"))}),e},_initDefaultValue:function(t){this.setValue(t)},_dealCurrentUser:function(t){var e=this.options;if(!t)return null;var i=t;return"select"===e.dynamicType&&t._id===e.dynamicKey&&(i=FXM.GB.user?{_id:FXM.GB.user._id,nickname:FXM.GB.user.nickname}:null),i},setValue:function(t){t=this._dealCurrentUser(t),this.value=t,t&&t._id&&(this.value=t._id,this.items=this._getDynamicFields().concat([{id:t._id,name:t.nickname||t.name}])),this._initData()},getValue:function(){return this.value},getText:function(){var t=this.selectMap[this.value];return t?t.name:""},getCacheValue:function(){var t=this.selectMap[this.value];return t?{_id:t.id,name:t.name}:null},checkValidate:function(){if(FXM.Utils.isExternalLink())return this.setInvalidType(!1,FXM.CONSTS.INVALID_TYPE.INVALID),!1;var t=this.options.allowBlank||!FXM.Utils.isEmpty(this.getValue());return this.setInvalidType(t,FXM.CONSTS.INVALID_TYPE.BLANK),t},_refresh:function(){var e=this;t("li.user-item",this.$setList).each(function(i,a){var n=t(a).data("user");n&&(e.value===n.id?t(a).children(".select-btn").addClass("select"):t(a).children(".select-btn").removeClass("select"))})},rebuild:function(t){this.setValue(t),this._refresh()},getOptions:function(){var e=this.options;return t.extend(FXM.User._super.getOptions.apply(this,arguments),{noRepeat:e.noRepeat,limit:e.limit})},_hasType:function(t){var e=this.options;return this.types||(this.types=[],FXM.Utils.isObjectEmpty(e.limit)?this.types=["organization","member","dynamic"]:(FXM.Utils.isObjectEmpty(e.limit.departs)||this.types.push("organization"),FXM.Utils.isObjectEmpty(e.limit.roles)||this.types.push("role"),this.types.push("member"),e.limit.hasCurrentUser&&this.types.push("dynamic"))),this.types.indexOf(t)>-1}}),FXM.register("user",FXM.User)}(Zepto),function(t){FXM.UserGroup=FXM.extend(FXM.User,{_defaults:function(){return t.extend(FXM.UserGroup._super._defaults.apply(this,arguments),{baseCls:"x-user x-user-group",title:"",msg:"",value:[],allowBlank:!0,noRepeat:!1,editable:!1,limit:{}})},_init:function(){this.value=[],FXM.UserGroup._super._init.apply(this,arguments)},_initData:function(){if(!FXM.Utils.isExternalLink()){var t=this.options;this.selectMap={},t.items&&(this.items=t.items),this._initSelectPane()}},_createSelectList:function(){var e=this,i=this.options;this.$selectList?this.$selectList.empty():this.$selectList=t('<ul class="select-list"/>').appendTo(this.element),this.value&&this.value.length>0?FXM.Utils.forEach(this.value,function(t,i){var a=e.selectMap[i];e._createSelectItem(a)}):i.editable||this.$selectList.append(t('<div class="select-empty"/>').text(i.msg))},_createUserItem:function(e){var i={id:e._id,name:e.nickname},a=t('<li class="user-item"/>').append(t('<i class="icon-member"/>')).append(t("<span/>").text(i.name)).append(t('<div class="select-btn"/>')).data("user",i);return this.value.indexOf(i.id)>-1&&a.children(".select-btn").addClass("select"),a},_bindUserEvent:function(e){var i=this;e.unbind("click"),e.bind("click",function(e){var a=t(e.target).closest("li.user-item"),n=a.children(".select-btn");if(a.length>0&&n.length>0){var r=a.data("user");n.hasClass("select")?i._removeSelectItem(r):i._addSelectItem(r)}})},_addSelectItem:function(t){this.options;this._createSelectSetItem(t),this.value=this._getSetValue(),this.selectMap[t.id]=t,this._refresh()},_removeSelectItem:function(t){this.options;this.$selectSetList.find('[id="'+t.id+'"]').remove(),this.value=this._getSetValue(),this._refresh()},_getSetValue:function(){var e=[];return this.$selectSetList&&t(".select-item",this.$selectSetList).each(function(i,a){e.push(t(a).attr("id"))}),e},_createSelectSettList:function(){var e=this;this.options;this.value=this.getValue(),this.$selectSetList&&this.$selectSetList.remove(),this.$selectSetPane.addClass("x-user-group-set-pane"),this.$selectSetList=t('<ul class="select-list"/>').appendTo(this.$selectSetPane),this.value&&this.value.length>0&&FXM.Utils.forEach(this.value,function(t,i){var a=e.selectMap[i];e._createSelectSetItem(a)})},_createSelectSetItem:function(e){this.options;var i=this;if(e){var a=t('<li class="select-item"/>').append(t("<span/>").text(e.name)).appendTo(this.$selectSetList).attr("id",e.id).data("item",e);a.prepend(t('<i class="select-icon icon-member"/>')),t('<span class="remove-btn"/>').append(t('<i class="icon-close"/>')).click(function(){i._removeSelectItem(e)}).appendTo(a)}},_createCurrentUserList:function(e){this.options;var i=this;if(this._checkCurrentUserValidate(e)&&(this.$currentUserList=t('<ul class="select-user set-list-block"/>').appendTo(this.$setList),FXM.GB.user)){var a={id:FXM.GB.user._id,name:FXM.GB.user.nickname};t('<li class="select-path"></li>').appendTo(this.$currentUserList);var n=t('<li class="user-item"/>').append(t('<i class="icon-member"/>')).append(t("<span/>").text(a.name)).append(t('<div class="select-btn"/>')).appendTo(i.$currentUserList).data("user",a).click(function(){var t=n.children(".select-btn"),e=n.data("user");t.hasClass("select")?(t.removeClass("select"),i._removeSelectItem(e)):(t.addClass("select"),i._addSelectItem(e))});i.value.indexOf(a.id)>-1&&n.children(".select-btn").addClass("select")}},checkValidate:function(){if(FXM.Utils.isExternalLink())return this.setInvalidType(!1,FXM.CONSTS.INVALID_TYPE.INVALID),!1;var t=this.options.allowBlank||this.getValue().length>0;return this.setInvalidType(t,FXM.CONSTS.INVALID_TYPE.BLANK),t},setValue:function(t){var e=this;this.value=[],this.items=[].concat(this._getDynamicFields());var i={};FXM.Utils.forEach(t,function(t,a){(a=e._dealCurrentUser(a))&&(a._id&&!i[a._id]?(i[a._id]=!0,e.value.push(a._id),e.items.push({id:a._id,name:a.nickname||a.name})):e.value.push(a))}),this._initData()},getValue:function(){this.options;var e=this.value;return this.$selectList&&(e=[],t(".select-item",this.$selectList).each(function(i,a){e.push(t(a).attr("id"))})),e},getText:function(){var t=this,e=[];return FXM.Utils.forEach(this.getValue(),function(i,a){var n=t.selectMap[a];n&&e.push(n.name)}),e.join(",")},getCacheValue:function(){var t=this,e=[];return FXM.Utils.forEach(this.getValue(),function(i,a){var n=t.selectMap[a];n&&e.push({_id:n.id,name:n.name})}),e},getNullValue:function(){return[]},_refresh:function(){var e=this;t("li.user-item",this.$setList).each(function(i,a){var n=t(a).data("user");n&&(e.value.indexOf(n.id)>-1?t(a).children(".select-btn").addClass("select"):t(a).children(".select-btn").removeClass("select"))})}}),FXM.register("usergroup",FXM.UserGroup)}(Zepto),function(t){FXM.Dept=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return t.extend(FXM.Dept._super._defaults.apply(this,arguments),{baseCls:"x-dept",title:"",msg:"",value:null,allowBlank:!0,noRepeat:!1,editable:!1,limit:{},dynamicFields:[{_id:FXM.CONSTS.DEPT_ID.CURRENT,name:"",type:"dynamic"}],dynamicKey:FXM.CONSTS.DEPT_ID.CURRENT,valueOption:FXM.CONSTS.WIDGET_VALUE_OPTION.CUSTOM,onBeforeEdit:null,onStopEdit:null,rootId:0})},_init:function(){FXM.Dept._super._init.apply(this,arguments),this.selectMap={},this._initSelectPane()},_initData:function(){if(!FXM.Utils.isExternalLink()){var t=this.options;t.items&&(this.items=t.items),this._initSelectPane()}},_initSelectPane:function(){if(FXM.Utils.isExternalLink())return this.element.empty(),void t('<div class="nonsupport-msg"/>').text("").appendTo(this.element);var e=this;this.selectMap={},FXM.Utils.forEach(this.items,function(t,i){i&&(e.selectMap[i._id]=i)}),this._createSelectList(),this._bindEditEvent()},_createSelectList:function(){var e=this,i=this.options;if(this.$selectList?this.$selectList.empty():this.$selectList=t('<ul class="select-list"/>').appendTo(this.element),this.value){var a=e.selectMap[this.value];e._createSelectItem(a)}else i.editable||this.$selectList.append(t('<div class="select-empty"/>').text(i.msg))},_createSelectItem:function(e,i){if(e){var a=t('<li class="select-item"/>').append('<i class="select-icon icon-department"/>').append(t("<span/>").text(e.name));a.attr("id",e._id).data("item",e),i?a.append(t('<span class="remove-btn"><i class="icon-close"/></span>')).appendTo(this.$selectSetList):a.appendTo(this.$selectList)}},_bindEditEvent:function(){var t=this,e=this.options;this.$selectList.unbind("click"),this.$selectList.bind("click",function(){t.isEnabled()&&!1===FXM.Utils.applyFunc(t,e.onBeforeEdit,[function(){t._showEditPane()}],!1)&&t._showEditPane()})},_showEditPane:function(){var e=this;e.bodyScrollTop=FXM.Utils.fixBody(),e.$selectSetPane=t('<div class="x-dept-select-set-pane">').css("z-index",FXM.STATIC.zIndex++).appendTo("body"),new FXM.Search({render:t('<div class="select-search"/>').appendTo(e.$selectSetPane),onSearch:function(){e._createSearchList(this.getValue())}}),e._createSelectSetList(),e._initDepartmentList()},_isRelyLimitEmpty:function(){var t=this.options;return FXM.Utils.isObjectEmpty(t.limit)&&t.valueOption!==FXM.CONSTS.WIDGET_VALUE_OPTION.RELY&&!FXM.Utils.isObjectEmpty(t.rely)},_initLimitMap:function(t){var e=this.options,i=this;FXM.Utils.isObjectEmpty(e.limit)||(this.limitMap={},FXM.Utils.forEach(e.limit.departs,function(t,e){i.limitMap[e]=!0}),FXM.Utils.forEach(t,function(t,e){i.limitMap[e._id]||FXM.Utils.forEach(e.path,function(t,a){var n=i.departmentMap[a];n&&i.limitMap[n._id]&&(i.limitMap[e._id]=!0)})}))},_initDepartmentList:function(){var t=this.options,e=this;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.departments),data:{departmentLimit:t.limit.departs,hasCurrentDept:t.limit.hasCurrentDept}},function(i){var a={},n=[],r=i.departments;FXM.Utils.forEach(r,function(t,e){a[e.departmentId]={_id:e._id,id:e.departmentId,name:e.name,parentId:e.parentId,child:[]}}),a[t.rootId]||(a[t.rootId]={id:t.rootId,name:"",child:[]}),FXM.Utils.forEach(a,function(t,e){var i=a[e.parentId];i?i.child.push(e.id):(n.push(e.id),e.level=0)}),e.currentDepartment=t.rootId,a[e.currentDepartment]?e.departmentList=a[e.currentDepartment].child:e.departmentList=n,e.departmentMap=a,e._initLimitMap(r),e._createSetList(),e._createSetBtn()})},_createSetList:function(e){var i=this.options;if(this.$setList?this.$setList.empty():this.$setList=t('<div class="set-list"/>').appendTo(t('<div class="set-pane"/>').appendTo(this.$selectSetPane)),!this._isRelyLimitEmpty()){if(this.currentDepartment===i.rootId&&this._createCurrentDepartmentList(e),FXM.Utils.isObjectEmpty(i.limit)||!FXM.Utils.isObjectEmpty(i.limit.departs)){var a=t('<div class="set-list-block"/>').appendTo(this.$setList);this._createPath().appendTo(a),this._createDepartmentList().appendTo(a)}this._bindDepartmentEvent()}},_createSelectSetList:function(){var e=this;if(this.value=this.getValue(),this.$selectSetList&&this.$selectSetList.remove(),this.$selectSetList=t('<ul class="select-list"/>').appendTo(this.$selectSetPane),this.value){var i=e.selectMap[this.value];e._createSelectItem(i,!0)}this._bindSelectEvent()},_bindSelectEvent:function(){var e=this;this.$selectSetList.unbind("click"),this.$selectSetList.bind("click",function(i){if(t(i.target).closest(".remove-btn").length>0){var a=t(i.target).closest("li.select-item").data("item");a&&e._removeSelectItem(a)}})},_addSelectItem:function(t){this.$selectSetList.empty(),this._createSelectItem(t,!0),this.value=t._id,this.selectMap[t._id]=t,this._refresh()},_removeSelectItem:function(){this.$selectSetList.empty(),this.value=null,this._refresh()},_createPath:function(){var e=this,i=(this.options,this.departmentMap[this.currentDepartment]);if(!i)return t('<div class="select-path" />').data("departmentId",this.currentDepartment).text("");for(var a=[],n=this.departmentMap[i.parentId];n;)a.unshift(n),n=this.departmentMap[n.parentId];var r=t('<ul class="select-path"/>');return FXM.Utils.forEach(a,function(e,i){t('<li class="path-item"/>').append(t("<span/>").text(i.name)).append(t('<i class="icon-arrow-right"/>')).appendTo(r).data("depart",i)}),t("<li/>").append(t("<span/>").text(i.name)).appendTo(r),r.unbind("click"),r.bind("click",function(i){var a=t(i.target).closest("li.path-item");if(a.length>0){var n=a.data("depart");n&&(e.departmentList=n.child,e.currentDepartment=n.id),e._createSetList()}}),r},_checkCurrentDepartmentValidate:function(t){var e=this.options;return!t&&(FXM.Utils.isObjectEmpty(e.limit)||e.limit.hasCurrentDept)},_createCurrentDepartmentList:function(e){var i=this;this._checkCurrentDepartmentValidate(e)&&(this.$currentDepartmentList=t('<ul class="select-depart set-list-block"/>').appendTo(this.$setList),t('<li class="select-path"></li>').appendTo(this.$currentDepartmentList),this.currentDepartments?FXM.Utils.forEach(this.currentDepartments,function(t,e){i._createDepartmentItem(e,!0).appendTo(i.$currentDepartmentList)}):FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.current_dept)},function(t){i.currentDepartments=t.departmentList,FXM.Utils.forEach(i.currentDepartments,function(t,e){i._createDepartmentItem(e,!0).appendTo(i.$currentDepartmentList)})}))},_createDepartmentList:function(){var e=this;return this.$departmentList=t('<ul class="select-depart"/>'),FXM.Utils.isObjectEmpty(this.departmentList)?(t('<li class="select-empty"/>').text("").appendTo(this.$departmentList),this.$departmentList):(FXM.Utils.forEach(this.departmentList,function(t,i){var a=e.departmentMap[i];a&&e.$departmentList.append(e._createDepartmentItem(a))}),this.$departmentList)},_createDepartmentItem:function(e,i){var a=t('<li class="depart-item"/>').append(t('<span class="depart-icon"><i class="icon-department"/></span>')).append(t("<span/>").text(e.name)).data("item",e);return FXM.Utils.isObjectEmpty(e.child)||a.append(t('<span class="depart-next"><i class="icon-arrow-right"/></span>')),(i||this._checkLimit(e))&&a.prepend(t('<div class="select-btn"/>')),this.value===e._id&&a.children(".select-btn").addClass("select"),a},_bindDepartmentEvent:function(){var e=this;this.$currentDepartmentList&&(this.$currentDepartmentList.unbind("click"),this.$currentDepartmentList.bind("click",function(i){var a=t(i.target).closest("li.depart-item");if(!(a.length<=0)){var n=a.data("item"),r=a.children(".select-btn");r.hasClass("select")?(r.removeClass("select"),e._removeSelectItem(n)):(r.addClass("select"),e._addSelectItem(n))}})),this.$departmentList&&(this.$departmentList.unbind("click"),this._bindDepartmentSelectEvent(this.$departmentList))},_bindDepartmentSelectEvent:function(e){var i=this;e.on("click",function(e){var a=t(e.target).closest("li.depart-item"),n=a.children(".select-btn");if(!(a.length<=0)){var r=t(e.target).closest(".depart-next"),s=a.data("item");r.length>0?s&&(i.departmentList=s.child,i.currentDepartment=s.id,i._createSetList()):n.length>0&&(n.hasClass("select")?(n.removeClass("select"),i._removeSelectItem(s)):(n.addClass("select"),i._addSelectItem(s)))}})},_createSetBtn:function(){var e=this,i=this.options;t('<div class="set-btn-pane"><div class="set-btn"><button class="x-btn style-white" role="cancel"></button></div><div class="set-btn"><button class="x-btn style-blue" role="confirm"></button></div></div>').appendTo(this.$selectSetPane).on("click","button",function(a){switch(t(a.currentTarget).attr("role")){case"confirm":e.items=e.getItems(),e._initSelectPane(),e.$setList=null,e.$selectSetPane.remove(),FXM.Utils.releaseBody(e.bodyScrollTop),FXM.Utils.applyFunc(e,i.onStopEdit,[],!1);break;case"cancel":e.$setList=null,e.$selectSetPane.remove(),FXM.Utils.releaseBody(e.bodyScrollTop)}})},_createSearchList:function(e){var i=this;if(e){this.$setList.empty();var a=new RegExp(FXM.Utils.escapeRegexp(e),"i"),n=[];FXM.Utils.forEach(this.departmentMap,function(t,e){a.test(e.name)&&n.push(e)});var r=t('<ul class="select-depart set-list-block"/>').appendTo(this.$setList);n.length?FXM.Utils.forEach(n,function(t,e){i._createDepartmentItem(e).appendTo(r)}):t('<li class="select-empty"/>').text("").appendTo(r),this._bindDepartmentSelectEvent(r)}else this._createSetList(e)},_checkLimit:function(t){var e=this.options;return!(!t||!t._id)&&(!!FXM.Utils.isObjectEmpty(e.limit)||this.limitMap[t._id])},_getDynamicFields:function(){return this.options.dynamicFields},getItems:function(){var e=[];return this.$selectSetList&&t(".select-item",this.$selectSetList).each(function(i,a){e.push(t(a).data("item"))}),e},_initDefaultValue:function(t){this.setValue(t)},_dealCurrentDept:function(t,e){if(!t)return e&&e(t);var i=this.options;if(t._id===i.dynamicKey){var a=FXM.UI.createLoadIcon().appendTo(this.element);FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.current_dept),async:!1},function(a){t&&t._id===i.dynamicKey&&(t=FXM.Utils.isObjectEmpty(a.departmentList)?null:a.departmentList[0]),e&&e(t)},function(){e&&e(null)},function(){a.remove()})}else e&&e(t)},clearLimit:function(){this.options.limit={}},setValue:function(t){var e=this;this._dealCurrentDept(t,function(t){e.value=t,t&&t._id&&(e.value=t._id,e.items=e._getDynamicFields().concat([t])),e._initData()})},getValue:function(){return this.value},getText:function(){var t=this.selectMap[this.value];return t?t.name:""},getCacheValue:function(){var t=this.selectMap[this.value];return t?{_id:t._id,name:t.name}:null},checkValidate:function(){if(FXM.Utils.isExternalLink())return this.setInvalidType(!1,FXM.CONSTS.INVALID_TYPE.INVALID),!1;var t=this.options.allowBlank||!FXM.Utils.isEmpty(this.getValue());return this.setInvalidType(t,FXM.CONSTS.INVALID_TYPE.BLANK),t},_refresh:function(){var e=this;t("li.depart-item",this.$setList).each(function(i,a){var n=t(a).data("item");n&&(e.value===n._id?t(a).children(".select-btn").addClass("select"):t(a).children(".select-btn").removeClass("select"))})}}),FXM.register("dept",FXM.Dept)}(Zepto),function(t){FXM.DeptGroup=FXM.extend(FXM.Dept,{_defaults:function(){return t.extend(FXM.DeptGroup._super._defaults.apply(this,arguments),{baseCls:"x-dept x-dept-group",value:[],allowBlank:!0,editable:!1,limit:[]})},_init:function(){this.value=[],FXM.DeptGroup._super._init.apply(this,arguments)},_initData:function(){if(!FXM.Utils.isExternalLink()){var t=this.options;this.selectMap={},t.items&&(this.items=t.items),this._initSelectPane()}},_createSelectList:function(){var e=this,i=this.options;this.$selectList?this.$selectList.empty():this.$selectList=t('<ul class="select-list"/>').appendTo(this.element),this.value&&this.value.length>0?FXM.Utils.forEach(this.value,function(t,i){var a=e.selectMap[i];e._createSelectItem(a)}):i.editable||this.hasEmpty||this.$selectList.append(t('<div class="select-empty"/>').text(i.msg))},_addSelectItem:function(t){this._createSelectItem(t,!0),this.value=this._getSetValue(),this.selectMap[t._id]=t,this._refresh()},_removeSelectItem:function(t){this.$selectSetList.find('[id="'+t._id+'"]').remove(),this.value=this._getSetValue(),this._refresh()},_getSetValue:function(){var e=[];return this.$selectSetList&&t(".select-item",this.$selectSetList).each(function(i,a){!FXM.Utils.isEmpty(t(a).attr("id"))&&e.push(t(a).attr("id"))}),e},_createSelectSetList:function(){var e=this;this.value=this.getValue(),this.$selectSetList&&this.$selectSetList.remove(),this.$selectSetPane.addClass("x-dept-group-set-pane"),this.$selectSetList=t('<ul class="select-list"/>').appendTo(this.$selectSetPane),this.value&&this.value.length>0&&FXM.Utils.forEach(this.value,function(t,i){var a=e.selectMap[i];e._createSelectItem(a,!0)}),this._bindSelectEvent()},_createDepartmentItem:function(e,i){var a=t('<li class="depart-item"/>').append(t('<span class="depart-icon"><i class="icon-department"/></span>')).append(t("<span/>").text(e.name)).data("item",e);return FXM.Utils.isObjectEmpty(e.child)||a.append(t('<span class="depart-next"><i class="icon-arrow-right"/></span>')),(i||this._checkLimit(e))&&a.prepend(t('<div class="select-btn"/>')),this.value.indexOf(e._id)>-1&&a.children(".select-btn").addClass("select"),a},checkValidate:function(){if(FXM.Utils.isExternalLink())return this.setInvalidType(!1,FXM.CONSTS.INVALID_TYPE.INVALID),!1;var t=this.options.allowBlank||this.getValue().length>0;return this.setInvalidType(t,FXM.CONSTS.INVALID_TYPE.BLANK),t},_dealCurrentDept:function(t,e){if(!t||!t.length)return e&&e([]);var i=this.options,a=-1;if(FXM.Utils.forEach(t,function(t,e){if(e&&e._id===i.dynamicKey)return a=t,!1}),a>-1){var n=FXM.UI.createLoadIcon().appendTo(this.element);FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.current_dept),async:!1},function(n){t[a]&&t[a]._id===i.dynamicKey&&(t.splice(a,1),t=t.concat(n.departmentList)),e&&e(t)},function(){t[a]&&t[a]._id===i.dynamicKey&&t.splice(a,1),e&&e(t)},function(){n.remove()})}else e&&e(t)},setValue:function(t){var e=this;this._dealCurrentDept(t,function(t){e.value=[],e.items=e._getDynamicFields();var i={};FXM.Utils.forEach(t,function(t,a){a&&a._id&&!i[a._id]?(i[a._id]=!0,e.value.push(a._id),e.items.push(a)):e.value.push(a)}),e._initData()})},getValue:function(){var e=this.value;return this.$selectList&&(e=[],t(".select-item",this.$selectList).each(function(i,a){e.push(t(a).attr("id"))})),e},getText:function(){var t=this,e=[];return FXM.Utils.forEach(this.getValue(),function(i,a){var n=t.selectMap[a];n&&e.push(n.name)}),e.join(",")},getCacheValue:function(){var t=this,e=[];return FXM.Utils.forEach(this.getValue(),function(i,a){var n=t.selectMap[a];n&&e.push({_id:n._id,name:n.name})}),e},getNullValue:function(){return[]},_refresh:function(){var e=this;t("li.depart-item",this.$setList).each(function(i,a){var n=t(a).data("item");n&&(e.value.indexOf(n._id)>-1?t(a).children(".select-btn").addClass("select"):t(a).children(".select-btn").removeClass("select"))})}}),FXM.register("deptgroup",FXM.DeptGroup)}(Zepto),FXM.DeptSelect=FXM.extend(FXM.Widget,{_defaults:function(){return $.extend(FXM.Dept._super._defaults.apply(this,arguments),{baseCls:"x-dept x-dept-group",title:"",msg:"",value:{},onStopEdit:null,rootDepartmentId:0})},_init:function(){FXM.DeptSelect._super._init.apply(this,arguments);var t=this,e=this.options;this.value=e.value.items||[],this.hasEmpty=!!e.value.hasEmpty,this.currentDepartment=e.rootDepartmentId,this._initData(function(){t._createValueList($('<ul class="select-list"/>').appendTo(this.element))}),this._bindEvent()},_initData:function(t){var e=this,i=this.options,a=FXM.UI.createLoadIcon().appendTo(this.element);FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.departments)},function(n){var r=n.departments;e.departmentMap={},e.selectMap={},e.departmentMap[i.rootDepartmentId]={departmentId:i.rootDepartmentId,name:"",children:[]},FXM.Utils.forEach(r,function(t,i){e.departmentMap[i.departmentId]=i,e.selectMap[i._id]=i}),FXM.Utils.forEach(e.departmentMap,function(t,i){var a=e.departmentMap[i.parentId];a&&(a.children=a.children||[],a.children.push(i.departmentId))});var s=e.departmentMap[e.currentDepartment];e.departments=s.children||[],e.hasCurrentDept?e._dealCurrentDept(function(){FXM.Utils.applyFunc(e,t,[],null),a.remove()}):(FXM.Utils.applyFunc(e,t,[],null),a.remove())})},_dealCurrentDept:function(t){var e=this;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.current_dept)},function(t){FXM.Utils.forEach(t.departmentList,function(t,i){e._getValueItemIndex(i)<0&&e.value.push(i._id)}),e.hasCurrentDept=!1},null,function(){FXM.Utils.applyFunc(e,t,[],null)})},_createValueList:function(t,e){var i=this,a=this.options,n=this.value;FXM.Utils.isObjectEmpty(n)&&!this.hasEmpty?e||$('<div class="select-empty"/>').text(a.msg).appendTo(t):(this.hasEmpty&&i._createValueItem({_id:FXM.CONSTS.PARAMETER.EMPTY,name:""},e).appendTo(t),FXM.Utils.forEach(n,function(a,n){var r=i.selectMap[n];r&&i._createValueItem(r,e).appendTo(t)}))},_createValueItem:function(t,e){var i=$('<li class="select-item"/>').append('<i class="select-icon icon-department"/>').append($("<span />").text(t.name)).data("value",t);return e&&$('<span class="remove-btn"/>').append('<i class="icon-close"/>').appendTo(i),i},_createEditPane:function(){var t=this;this.bodyScrollTop=FXM.Utils.fixBody();var e=$('<div class="x-dept-select-set-pane x-dept-group-set-pane"/>').css("z-index",FXM.STATIC.zIndex++).appendTo("body");new FXM.Search({render:$('<div class="select-search"/>').appendTo(e),onSearch:function(){t.keyword=this.getValue(),t._refreshDepartmentList()}});var i=$('<ul class="select-list"/>').appendTo(e);this._createValueList(i,!0);var a=$('<div class="set-pane"/>').appendTo(e);return this._createDepartListPane(a),this._createSetBtn().appendTo(e),this._bindEditEvent(e),e},_createDepartListPane:function(t){var e=this.options,i=$('<div class="set-list"/>').appendTo(t);if(this.currentDepartment===e.rootDepartmentId){var a=$('<ul class="select-depart set-list-block"/>').appendTo(i);this._createDepartItem({_id:FXM.CONSTS.PARAMETER.EMPTY,name:""},!0).appendTo(a)}var n=$('<div class="set-list-block"/>').appendTo(i);this._createPath().appendTo(n),this._createDepartList(this.departments).appendTo(n)},_createDepartList:function(t){var e=this,i=$('<ul class="select-depart"/>');return FXM.Utils.isObjectEmpty(t)?$('<li class="select-empty"/>').text("").appendTo(i):FXM.Utils.forEach(t,function(t,a){var n=e.departmentMap[a];n&&e._createDepartItem(n).appendTo(i)}),i},_createSearchList:function(t){var e=[],i=new RegExp(FXM.Utils.escapeRegexp(t),"i");return FXM.Utils.forEach(this.departmentMap,function(t,a){i.test(a.name)&&e.push(a.departmentId)}),this._createDepartList(e)},_createDepartItem:function(t){var e=$('<li class="depart-item"/>').append($('<span class="depart-icon"><i class="icon-department"/></span>')).append($("<span />").text(t.name)).data("depart",t);if(FXM.Utils.isObjectEmpty(t.children)||$('<span class="depart-next"/>').append('<i class="icon-arrow-right"/>').appendTo(e),!FXM.Utils.isNull(t._id)){var i=this.value.indexOf(t._id)>-1;t._id===FXM.CONSTS.PARAMETER.EMPTY&&(i=this.hasEmpty),$('<div class="select-btn" />').toggleClass("select",i).prependTo(e)}return e},_createPath:function(){var t=this.departmentMap[this.currentDepartment];if(!t)return $('<div class="select-path" />').data("departmentId",this.currentDepartment).text("");for(var e=[],i=this.departmentMap[t.parentId];i;)e.unshift(i),i=this.departmentMap[i.parentId];var a=$('<ul class="select-path"/>');return FXM.Utils.forEach(e,function(t,e){$('<li class="path-item"/>').append($("<span/>").text(e.name)).append($('<i class="icon-arrow-right"/>')).appendTo(a).data("depart",e)}),$("<li/>").append($("<span/>").text(t.name)).appendTo(a),a},_createSetBtn:function(){var t=this,e=this.options,i=$('<div class="set-btn-pane"/>');return new FXM.Button({render:$("<div />").appendTo($('<div class="set-btn"/>').appendTo(i)),style:"white",content:"",onClick:function(){t.$editPane.remove(),FXM.Utils.releaseBody(t.bodyScrollTop)}}),new FXM.Button({render:$("<div />").appendTo($('<div class="set-btn"/>').appendTo(i)),style:"blue",customCls:"set-btn",content:"",onClick:function(){t.$editPane.remove(),FXM.Utils.releaseBody(t.bodyScrollTop),t._refresh(),FXM.Utils.applyFunc(t,e.onStopEdit,[],null)}}),i},_bindEvent:function(){var t=this;this.element.on("click",".select-list",function(){t.$editPane=t._createEditPane()})},_bindEditEvent:function(t){var e=this;t.on("click","li.depart-item",function(t){var i=$(t.currentTarget),a=i.find(".select-btn"),n=$(t.target).closest(".depart-next"),r=i.data("depart");n.length>0?(e.departments=r.children,e.currentDepartment=r.departmentId,e._refreshDepartmentList()):(a.toggleClass("select"),a.hasClass("select")?e._addValueItem(r):e._removeValueItem(r))}),t.on("click",".select-item > .remove-btn",function(t){var i=$(t.currentTarget).closest(".select-item");e._removeValueItem(i.data("value")),e._refreshDepartmentList()}),t.on("click",".path-item",function(t){var i=$(t.currentTarget).data("depart");i&&(e.departments=i.children,e.currentDepartment=i.departmentId,e._refreshDepartmentList())})},_removeValueItem:function(t){if(t._id===FXM.CONSTS.PARAMETER.EMPTY)this.hasEmpty=!1;else{var e=this._getValueItemIndex(t);e>-1&&this.value.splice(e,1)}this._refreshValueList()},_getValueItemIndex:function(t){var e=-1;return FXM.Utils.forEach(this.value,function(i,a){if(a===t._id)return e=i,!1}),e},_addValueItem:function(t){t._id===FXM.CONSTS.PARAMETER.EMPTY?this.hasEmpty=!0:this.value.push(t._id),this._refreshValueList()},_refresh:function(){var t=this.element.find(".select-list").empty();this._createValueList(t)},_refreshValueList:function(){var t=this.$editPane.find(".select-list").empty();this._createValueList(t,!0)},_refreshDepartmentList:function(){var t=this.$editPane.find(".set-pane").empty();if(this.keyword){var e=$('<div class="set-list"/>').appendTo(t);this._createSearchList(this.keyword).addClass("set-list-block").appendTo(e)}else this._createDepartListPane(t)},getValue:function(){return{items:this.value,hasEmpty:this.hasEmpty,hasCurrentDept:this.hasCurrentDept}},setValue:function(t){this.value=t.items||[],this.hasEmpty=!!t.hasEmpty,this.hasCurrentDept=!!t.hasCurrentDept,this.departmentMap?this._refresh():this._initData(function(){this._refresh()})}}),FXM.register("deptselect",FXM.DeptSelect),function(t){FXM.FlowPane=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.FlowPane._super._defaults.apply(this,arguments),{baseCls:"fx-flow-list",itemsPerPage:20,listType:"todo",filterType:"all",onItemClick:null,onAsyncSuccess:null,mode:"normal",formId:null,corpId:null,filter:null,sort:null})},_init:function(){FXM.FlowPane._super._init.apply(this,arguments),this.currentPage=0,this._fetchData()},_fetchData:function(){var t=this,e=this.options,i={type:e.listType,filterType:e.filterType,skip:this.currentPage*e.itemsPerPage,limit:e.itemsPerPage,formId:e.formId,corpId:e.corpId};!FXM.Utils.isObjectEmpty(e.filter)&&(i.filter=e.filter),!FXM.Utils.isObjectEmpty(e.sort)&&(i.sort=e.sort),FXM.UI.showLoader(),FXM.Utils.dataAjax({url:e.url,data:i},function(i){FXM.Utils.applyFunc(t,e.onAsyncSuccess,[i],!1),e.items=i.data,t.nameMap=i.nameMap,t.count=i.count,i.count<=0?t._createEmptyTip():e.items.length===e.itemsPerPage?(t._createFlowList(),t._createLoadMore()):(t._createFlowList(),t._removeLoadMore())},function(t,e){},function(){FXM.UI.closeLoader()})},_createEmptyTip:function(){var t=this.options,e={todo:{all:"",today:"",thisWeek:""},create:{all:"",today:"",thisWeek:""},part:{all:"",transactors:"",ccUsers:""}},i="";i="custom"===t.filterType?"":e[t.listType]&&e[t.listType][t.filterType],FXM.UI.createEmptyTip({msg:i}).appendTo(this.element)},_createFlowList:function(){var e=this.options,i=this,a=t("ul.flow-list",this.element);a.length>0?this.$flowList=a:this.$flowList=t('<ul class="flow-list"/>').appendTo(this.element),FXM.Utils.forEach(e.items,function(t,e){i._formatItem(e),i._createFlowItem(e)});var n=function(a){var n=t(a.target).closest(".flow-item");n&&n.length>0&&FXM.Utils.applyFunc(i,e.onItemClick,[n.data("data")],!1)};this.$flowList.unbind("click",n),this.$flowList.bind("click",n)},_createFlowItem:function(e){var i=this.options,a=this,n=t('<li class="flow-item"/>').appendTo(this.$flowList).data("data",e),r=t('<div class="item-title"/>').appendTo(n),s=t('<ul class="item-content"/>').appendTo(n),o=t('<div class="data-icon"/>').append('<i class="icon-widget-user icon-flow-user"/>').appendTo(s),l="",c="";"todo"===i.listType||"stash"===i.listType?(l=e.entryName,e.hasMultiNodes?l+="-":l+="-"+e.flowName,c=e.updateTime,t('<li class="item-data"/>').append(t('<span class="data-label"/>').text("")).append(t('<span class="data-value"/>').text(e.creator)).appendTo(s)):(l=e.entryName,c=FXM.Utils.isArray(e.states)&&e.states.length>1?"":e.states.join(","),t('<li class="item-data"/>').append(t('<span class="data-label"/>').text("")).append(t('<span class="data-value"/>').text(e.chargers)).appendTo(s)),r.append(t('<div class="title-left"/>').text(l)).append(t('<div class="title-right"/>').text(c));var h=FXM.Utils.createSvgEl("svg",{width:20,height:100}).appendTo(o);if(FXM.Utils.forEach(e.data,function(e,i){h.append(FXM.Utils.createSvgEl("line",{x1:10,y1:(e>0?15:21)+25*(e+0),x2:10,y2:15+25*(e+1+0),stroke:"#D2EDFF"})).append(FXM.Utils.createSvgEl("circle",{cx:10,cy:36+25*(e+0),r:4,fill:"#248AF9"})),t('<li class="item-data"/>').append(t('<span class="data-label"/>').text(i.label)).append(t('<span class="data-value"/>').text(a._formatData(i))).appendTo(s)}),"todo"===i.listType&&e.flowFailureAction){var u=FXM.CONSTS.FLOW_FAIL_HINT[e.flowFailureAction];u&&t('<div class="flow-hint fail-hint"/>').text(u).appendTo(n)}else if("todo"===i.listType&&e.flowExpireTime){var d=FXM.Utils.getDateInfoFromNow(e.flowExpireTime),p=d.isLater?"":"overtime",f="";d.isJustNow?f="1":d.day>=30?f="30":(f+=d.day?d.day+"":"",f+=d.hour?d.hour+"":"",f+=d.minute?d.minute+"":"");var m=d.isLater?"":"";t('<div class="flow-hint expire-time '+p+'"><div class="left"><i class="time-icon icon-alarm-o"/>'+m+'</div><div class="right">'+f+"</div></div>").appendTo(n)}},_formatItem:function(t){var e=this,i=this.options;if(t.updateTime=FXM.Utils.date2Str(new Date(t.updateTime),"yyyy-MM-dd HH:mm"),"todo"===i.listType||"stash"===i.listType)t.creator=this.nameMap[t.creator]||"";else{var a=[];FXM.Utils.forEach(t.chargers,function(t,i){a.push(e.nameMap[i])}),t.chargers=a.join(",")}},_formatData:function(t){var e=this;if(FXM.Utils.isEmpty(t.value))return"";switch(t.type){case"address":case"location":return FXM.Utils.address2Str(t.value,"","pcda");case"datetime":return FXM.Utils.date2Str(new Date(t.value),t.format);case"user":case"dept":return this.nameMap[t.value];case"usergroup":case"deptgroup":var i=[];return FXM.Utils.forEach(t.value,function(t,a){i.push(e.nameMap[a])}),i.join(",");default:return t.value}},_createLoadMore:function(){var e=this;t(".flow-list-load-more",this.element).length<=0&&t(this.element).append(t('<div class="flow-list-load-more"/>').text("..").on("click",function(){e.currentPage++,e._fetchData()}))},_removeLoadMore:function(){t(".flow-list-load-more",this.element).remove()}}),FXM.register("flowpane",FXM.FlowPane)}(Zepto),function(t){FXM.FlowFilter=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.FlowFilter._super._defaults.apply(),{baseCls:"fx-flow-filter",flowType:"",filterCache:{},appId:"",onFilterSuccess:null})},_init:function(){FXM.FlowFilter._super._init.apply(this,arguments),this.filterConfig={},this._createFilterBtns(),this._bindEvents()},_createFilterBtns:function(){var e=this.options,i=this,a=FXM.CONSTS.FLOW_FILTER_TYPE;switch(this.$filterBtns&&this.$filterBtns.remove(),e.flowType){case"todo":case"create":this.$filterBtns=t('<div class="filter-btns"><div class="btn '+a.ALL+'"></div><div class="btn '+a.TODAY+'"></div><div class="btn '+a.THIS_WEEK+'"></div></div>').appendTo(this.element);break;case"part":this.$filterBtns=t('<div class="filter-btns"><div class="btn '+a.ALL+'"></div><div class="btn '+a.TRANSACTOR+'"></div><div class="btn '+a.CCUSER+'"></div></div>').appendTo(this.element)}(e.filterCache.filter||e.filterCache.formId)&&this.$filterBtns.append(t('<div class="btn result"></div>')),"part"!==e.flowType&&t('<div class="btn sort"/>').append(t('<div class="btn-inner"/>').append('<i class="icon-flow-sort"/>')).appendTo(this.$filterBtns);var n=!1;e.filterCache&&e.filterCache.filter&&(n=!FXM.Utils.isObjectEmpty(FXM.Utils.getValidFilters(e.filterCache.filter).cond)),t('<div class="btn custom"/>').append(t('<div class="btn-inner"/>').append('<i class="icon-filter"/>')).toggleClass("active",n).appendTo(this.$filterBtns);var r=e.filterCache.filterType?e.filterCache.filterType:a.ALL;r===a.CUSTOM?i._setSelectStyle(t(".result",this.$filterBtns)):i._setSelectStyle(t("."+r,this.$filterBtns))},_bindEvents:function(){var e=this.options,i=this;this.$filterBtns.on("click",".btn",function(a){var n=t(a.target).closest(".btn");if(n.hasClass("sort"))i._createSortPane();else if(n.hasClass("custom"))i._createCustomFilterPane();else{i._setSelectStyle(n);var r=n.attr("class").split(" ")[1],s=FXM.CONSTS.FLOW_FILTER_TYPE;FXM.Utils.forEach(s,function(t,e){if(e===r)return i.filterConfig.filterType=r,!1}),n.hasClass("result")&&(i.filterConfig.filterType=s.CUSTOM),i.filterConfig.filterType&&FXM.Utils.applyFunc(i,e.onFilterSuccess,[i.filterConfig],!1)}})},_setSelectStyle:function(e){if(!e.hasClass("select")){var i=FXM.CONSTS.FLOW_FILTER_TYPE;e.hasClass(i.CUSTOM)||(t(".select",this.$filterBtns).removeClass("select"),e.addClass("select"))}},_createSortPane:function(){var e=this.options,i=this;if(!this.$sortPane){this.$sortPane=t('<div class="flow-sort-pane"/>').click(function(a){var n=t(a.target).closest(".sort-item");if(n.length>0){t(".select",i.$sortPane).removeClass("select"),n.addClass("select"),i.sortSlider&&i.sortSlider.close();var r=n.data("item");i.filterConfig.sort=r.value,FXM.Utils.applyFunc(i,e.onFilterSuccess,[i.filterConfig],null)}});var a=[],n=e.filterCache.sort||{};switch(e.flowType){case"todo":a.push({text:"",value:{updateTime:-1},select:1!==n.updateTime},{text:"",value:{updateTime:1},select:1===n.updateTime});break;case"create":a.push({text:"",value:{createTime:-1},select:1!==n.createTime},{text:"",value:{createTime:1},select:1===n.createTime})}FXM.Utils.forEach(a,function(e,a){var n=a.select?"select":"";t('<div class="sort-item + '+n+'"><span class="sort-text">'+a.text+'</span><i class="sort-icon icon-success"/>').data("item",a).appendTo(i.$sortPane)})}this.sortSlider=new FXM.SlidePanel({customCls:"flow-sort-slider",content:this.$sortPane,text4Left:"",text4Right:"",direction:"bottom"}),this.sortSlider.show()},_createCustomFilterPane:function(){var e=this,i=this.options;this.$mask||(this.$mask=t('<div class="x-window-mask flow-filter-mask dark-in"/>').on("click",function(){e._closeCustomFilterPane()}).appendTo("body").hide()),this.$customFilterPane||(this.$customFilterPane=t('<div class="custom-filter-pane"/>').appendTo("body"),new FXM.FlowCustomFilter({render:this.$customFilterPane,appId:i.appId,flowType:i.flowType,onCancel:function(){e._closeCustomFilterPane()},onSave:function(a){t.extend(e.filterConfig,{filter:a}),e._closeCustomFilterPane(),e.filterConfig.filterType=FXM.CONSTS.FLOW_FILTER_TYPE.CUSTOM,FXM.Utils.applyFunc(e,i.onFilterSuccess,[e.filterConfig],null)}})),setTimeout(function(){FXM.Utils.fixBody(),e.$mask.show(),e.$customFilterPane.addClass("modal-in")},150)},_closeCustomFilterPane:function(){FXM.Utils.releaseBody(),this.$mask&&this.$mask.hide(),this.$customFilterPane&&this.$customFilterPane.removeClass("modal-in")},rebuild:function(){this._createFilterBtns(),this._bindEvents()}})}(Zepto),function(t){FXM.FlowCustomFilter=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.FlowCustomFilter._super._defaults.apply(),{baseCls:"fx-flow-custom-filter",flowType:"",onCancel:null,onSave:null})},_init:function(){FXM.FlowCustomFilter._super._init.apply(this,arguments),this._createContent(),this._createFooter()},_createContent:function(){var e=this.options;this.$content=t('<div class="content"/>').appendTo(this.element),this.flowFilter=new FXM.Filter({render:t("<div/>").appendTo(this.$content),hasRelation:!1,hasFlowFilters:!0,flowType:e.flowType})},_createFooter:function(){var e=this,i=this.options;this.$footer=t('<div class="footer"><div class="btn cancel"></div><div class="btn filter"></div></div>').appendTo(this.element),this.$footer.on("click",".btn",function(a){var n=t(a.target);if(n.hasClass("cancel"))return FXM.Utils.applyFunc(e,i.onCancel,[],!1);if(n.hasClass("filter")){var r=e.flowFilter.getValue();FXM.Utils.applyFunc(e,i.onSave,[r],!1)}})}})}(Zepto),function(t){FXM.FormData=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.FormData._super._defaults.apply(),{baseCls:"x-form-data",authGroupId:null,data:null,header:null,ignoreVisible:!0,optAuth:null,title:""})},_init:function(){FXM.FormData._super._init.apply(this,arguments);var t=this.options;this.showData=this._getShowData(t.header,t.data),this._createDataWrapper(),this._bindEvent()},getFirstFieldText:function(){var t=this,e=this.options,i="";return FXM.Utils.forEach(e.header,function(e,a){var n=a.tag||a.name;if(t.showData.hasOwnProperty(n))return i=t._showData2Text(a.type,t.showData[n]),!1}),i},_showData2Text:function(t,e){var i="";switch(t){case"location":i=(e.address||"")+(e.lngLat||"");break;case"subform":case"image":case"upload":case"signature":i="";break;case"linkdata":i=e.key||"";break;default:FXM.Utils.isNull(e)||(i=e.toString())}return i},_getShowData:function(t,e){var i=this,a={};return FXM.Utils.forEach(t,function(t,n){if(n.widget&&(n=FXM.Utils.getFieldAttr(n)),n){var r=n.tag||n.name,s=e[r];if(FXM.Utils.isNull(s))return a[r]="";var o=n.cellFmt&&n.cellFmt.data||n.format;switch(n.type){case"datetime":o=o||"yyyy-MM-dd",a[r]=FXM.Utils.date2Str(new Date(s),o);break;case"address":o=o||"pcda",a[r]=FXM.Utils.address2Str(s,"",o);break;case"location":o=o||"pcda";var l="",c="";l=FXM.Utils.address2Str(s,"",o),n.lnglatVisible&&(c=FXM.Utils.getLnglatText(s)),a[r]={address:l,lngLat:c};break;case"number":case"formula":o=o||"",a[r]=FXM.Utils.num2Str(s,o);break;case"user":case"usergroup":case"dept":case"deptgroup":a[r]=i._getMemberShowValue(s);break;case"linkdata":a[r]=FXM.Utils.isObjectEmpty(s)?"":s;break;case"subform":var h=[];FXM.Utils.forEach(e[r],function(t,e){h.push(i._getShowData(n.items,e))}),a[r]=h;break;case"flowState":var u="",d=FXM.CONSTS.WORKFLOW.FLOWSTATE;switch(e[r]){case d.INPROCESS:u="";break;case d.COMPLETE:u="";break;case d.CLOSE:u=""}a[r]=u;break;default:a[r]=s}}}),a},_getMemberShowValue:function(t){if(FXM.Utils.isNull(t))return"";var e;if(FXM.Utils.isArray(t)){var i=[];FXM.Utils.forEach(t,function(t,e){i.push(e.name||e)}),e=i}else e=t.name||t;return e},_createDataWrapper:function(){var e=this.options,i=this;this.$wrapper=t('<div class="widget-wrapper">').appendTo(this.element);var a=t("<div/>").appendTo(this.$wrapper);this.concatMap={},FXM.Utils.forEach(e.header,function(n,r){if(r.widget&&(r=FXM.Utils.getFieldAttr(r)),r&&"flowVer"!==r.name){var s=r.tag||r.name,o=i.showData[s];if(e.ignoreVisible||i._dealWidgetVisible(r,o))if(o&&"linkdata"===r.type){var l={};FXM.Utils.forEach(r.linkFields,function(e,i){l[i.name]=t('<div class="widget-data-view"/>').appendTo(a)}),i._getLinkData(r,o,function(e){t.extend(o,i._getShowData(r.linkFields,e)),FXM.Utils.forEach(r.linkFields,function(t,e){i._dealLinkField(e),i._createItem(e,e.text,o[e.name],l[e.name])})})}else{var c=t('<div class="widget-data-view"/>').appendTo(a);i._createItem(r,r.text,o,c)}}})},_dealLinkField:function(e){switch(e.type){case"subform":FXM.Utils.forEach(e.items,function(e,i){t.extend(i,FXM.Utils.getFieldAttr(i))})}},_dealWidgetVisible:function(t,e){var i=this,a=this.options;a.optAuth&&(t.visible=a.optAuth[t.name]&&a.optAuth[t.name].visible||!1,"subform"===t.type&&FXM.Utils.forEach(t.items,function(e,i){var n=[t.name,i.name].join(".");i.visible=a.optAuth[n]&&a.optAuth[n].visible||!1}));var n={};return FXM.Utils.forEach(t.items,function(t,a){a.widgetsMap&&(n[a.value]=!0,a.value===e||a.isOther&&e&&!n[e]?FXM.Utils.forEach(a.widgetsMap,function(t,e){i.concatMap[e]=!0}):FXM.Utils.forEach(a.widgetsMap,function(t,e){i.concatMap[e]||(i.concatMap[e]=!1)}))}),!!t.visible&&!1!==this.concatMap[t.name]},_getLinkData:function(t,e,i){if(t.linkForm&&e&&e.id){this.nameMap||(this.nameMap={});var a={formId:e.entryId||t.linkForm,linkId:e.id},n=e.appId||t.refAppId||t.appId;n&&n!==FXM.STATIC.APPID&&(a.refAppId=n),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.read_link),data:a},function(t){i&&i(t.data)},function(){})}},_isItemValid:function(t){switch(t.type){case"formula":case"flowState":case"chargers":return!0;default:return FXM.Utils.allowValueSubmit(t.type)||t.isJoined||/_join_/.test(t.name)}},_createItem:function(e,i,a,n){if(this._isItemValid(e)){if("chargers"===e.type&&!e.show){n.removeClass("widget-data-view");var r=t("<div/>").appendTo(n);return this._createItem(t.extend({},e,{show:"node"}),"",a,t('<div class="widget-data-view"/>').appendTo(r)),this._createItem(t.extend({},e,{show:"user"}),"",a,t('<div class="widget-data-view"/>').appendTo(r)),r}i=FXM.Utils.isEmpty(i)?" ":i;var s,o;switch(["image","upload"].some(function(t){return t===e.type})?(s=t('<div class="widget-line"/>').appendTo(n),t('<div class="line-label"/>').text(i).appendTo(s),o=t('<div class="line-content"/>').appendTo(s)):(t('<div class="widget-label"/>').append(t('<span class="label-title"/>').text(i)).appendTo(n),o=t('<div class="widget-data"/>').appendTo(n)),this.nameMap||(this.nameMap={}),e.type){case"image":new FXM.ImageUpload({mode:"preview",render:o,files:a,enable:!1});break;case"upload":new FXM.FileUpload({mode:"preview",render:o,files:a,enable:!1});break;case"signature":this._createSignatureItem(a,o);break;case"subform":this._createSubformItem(e,a,o);break;case"radiogroup":case"combo":a&&t('<ul class="select-list select-single"/>').append(t('<li class="select-item"/>').text(a)).appendTo(o);break;case"combocheck":case"checkboxgroup":var l=t('<ul class="select-list"/>').appendTo(o);FXM.Utils.forEach(a,function(e,i){i&&l.append(t('<li class="select-item"/>').text(i))});break;case"user":case"usergroup":this._createSelectItem(a,o,"member");break;case"dept":case"deptgroup":this._createSelectItem(a,o,"department");break;case"textarea":a&&o.append(t("<pre/>").append(FXM.Utils.replaceURL(a)));break;case"text":if(a=FXM.Utils.isNull(a)?"":a,e.regex&&new RegExp(e.regex).test(a)){var c=FXM.CONSTS.TEXT_TYPE_REGEXP;if(e.regex===c.email){t("<a/>").attr("href","mailto:"+a).text(a).appendTo(o);break}if(e.regex===c.mobile||e.regex===c.tel){t("<a/>").attr("href","tel:"+a).text(a).appendTo(o);break}}FXM.Utils.isString(a)?o.append(FXM.Utils.replaceURL(a)):o.text(a.name||"");break;case"chargers":var h={},u={};FXM.Utils.forEach(a,function(t,e){e.flowName&&(h[e.flowName]||(h[e.flowName]=!0),u[e.userNickname]||(u[e.userNickname]=!0))});var d=[];"node"===e.show?FXM.Utils.forEach(h,function(t){d.push(t)}):FXM.Utils.forEach(u,function(t){d.push(t)}),o.text(d);break;case"location":a.address&&o.text(a.address),a.lngLat&&t('<div class="widget-info">'+a.lngLat+"</div>").appendTo(o);break;default:a=FXM.Utils.isNull(a)?"":a,o.text(a)}return n}},_createSignatureItem:function(e,i){if(!FXM.Utils.isObjectEmpty(e)){var a=t('<div class="signature-item"/>').on("click",function(i){t(i.target).hasClass("signature-image")&&new FXM.FilePreview({files:[e]})}).appendTo(i),n=function(e){t('<img class="signature-image"/>').attr("src",e).appendTo(a)};if(e.thumbMobileUrl)n(e.thumbMobileUrl);else{var r=t.extend({thumb:{mode:2,width:300,height:180}},e);FXM.Utils.getFileDownloadURL(r,function(t){n(t)})}}},_createSelectItem:function(e,i,a){var n=[].concat(e),r=t('<ul class="select-list"/>').appendTo(i);FXM.Utils.forEach(n,function(e,i){i&&r.append(t('<li class="select-item '+a+'"/>').append('<i class="select-icon icon-'+a+'"/>').append(t("<span/>").text(i)))})},_createSubformItem:function(e,i,a){var n=this,r=this.options;a.addClass("widget-subform"),FXM.Utils.forEach(i,function(i,s){var o=t('<ul class="widget-subform-list"/>').appendTo(a);FXM.Utils.forEach(e.items,function(e,i){if(r.ignoreVisible||!1!==i.visible)if("linkdata"===i.type){var a=t("<ul/>").appendTo(o);n._getLinkData(i,s[i.name],function(e){t.extend(s,n._getShowData(i.linkFields,e)),FXM.Utils.forEach(i.linkFields,function(e,i){var r=t("<li/>").appendTo(a);n._createItem(i,i.text,s[i.name],r)})})}else{var l=t('<li class="widget-item"/>').appendTo(o);n._createItem(i,i.text,s[i.name],l)}})})},_bindEvent:function(){this.element.on("click","a.nest-link",function(e){var i=t(e.currentTarget).attr("data-url");i&&FXM.Utils.openLink(i)})}}),FXM.register("formdata",FXM.FormData)}(Zepto),FXM.MessageData=FXM.extend(FXM.Widget,{_defaults:function(){return $.extend(FXM.MessageData._super._defaults.apply(),{baseCls:"x-message-data",message:{}})},_init:function(){FXM.MessageData._super._init.apply(this,arguments),this._createData(),this._bindEvent()},_createData:function(){this.$wrapper=$('<div class="widget-wrapper">').appendTo(this.element);var t=this.options,e=this,i=t.message.form,a=t.message.data,n=i&&i.items,r=$("<ul/>").appendTo($('<div class="data-wrapper"/>').appendTo(this.$wrapper));FXM.Utils.forEach(n,function(t,i){if(i.widget){var n=$('<div class="widget-data-view"/>').appendTo(r);e._createItem(i.widget,i.label,a[i.widget.widgetName],n)}})},_createItem:function(t,e,i,a){e=FXM.Utils.isEmpty(e)?" ":e;var n,r;["image","upload"].some(function(e){return e===t.type})?(n=$('<div class="widget-line"/>').appendTo(a),$('<div class="line-label"/>').text(e).appendTo(n),r=$('<div class="line-content"/>').appendTo(n)):($('<div class="widget-label"/>').append($('<span class="label-title"/>').text(e)).appendTo(a),r=$('<div class="widget-data"/>').appendTo(a));var s=t.cellFmt&&t.cellFmt.data||t.format;switch(t.type){case"datetime":(s=s||"yyyy-MM-dd")&&i&&(i=FXM.Utils.date2Str(new Date(i),s));break;case"address":s=s||"pcda",i=FXM.Utils.address2Str(i,"",s);break;case"location":s=s||"pcda",i={address:FXM.Utils.address2Str(i,"",s),lngLat:FXM.Utils.getLnglatText(i)};break;case"number":case"formula":s&&(i=FXM.Utils.num2Str(i,s))}switch(this.nameMap||(this.nameMap={}),t.type){case"image":new FXM.ImageUpload({mode:"preview",render:r,files:i,enable:!1});break;case"upload":new FXM.FileUpload({mode:"preview",render:r,files:i,enable:!1});break;case"signature":this._createSignatureItem(i,r);break;case"subform":var o=[];FXM.Utils.forEach(t.items,function(t,e){o.push({label:e.label,name:e.widget.widgetName,type:e.widget.type})}),this._createSubformItem(o,i,r);break;case"radiogroup":case"combo":i&&$('<ul class="select-list select-single"/>').append($('<li class="select-item"/>').text(i)).appendTo(r);break;case"combocheck":case"checkboxgroup":var l=$('<ul class="select-list"/>').appendTo(r);FXM.Utils.forEach(i,function(t,e){e&&l.append($('<li class="select-item"/>').text(e))});break;case"textarea":i&&r.append($("<pre/>").append(FXM.Utils.replaceURL(i)));break;case"text":if(i=FXM.Utils.isNull(i)?"":i,t.regex&&new RegExp(t.regex).test(i)){var c=FXM.CONSTS.TEXT_TYPE_REGEXP;if(t.regex===c.email){$("<a/>").attr("href","mailto:"+i).text(i).appendTo(r);break}if(t.regex===c.mobile||t.regex===c.tel){$("<a/>").attr("href","tel:"+i).text(i).appendTo(r);break}}FXM.Utils.isString(i)?r.append(FXM.Utils.replaceURL(i)):r.text(i.name||"");break;case"user":case"dept":i&&$('<ul class="select-list select-single"/>').append($('<li class="select-item"/>').text(i.name)).appendTo(r);break;case"usergroup":case"deptgroup":var h=$('<ul class="select-list"/>').appendTo(r);FXM.Utils.forEach(i,function(t,e){e&&h.append($('<li class="select-item"/>').text(e.name))});break;case"linkdata":r.text(i&&i.key);break;case"location":i.address&&r.text(i.address),i.lngLat&&$('<div class="widget-info">'+i.lngLat+"</div>").appendTo(r);break;default:i=FXM.Utils.isNull(i)?"":i,r.text(i)}return a},_createSignatureItem:function(t,e){if(!FXM.Utils.isObjectEmpty(t)){var i=$('<div class="signature-item"/>').on("click",function(e){$(e.target).hasClass("signature-image")&&new FXM.FilePreview({files:[t]})}).appendTo(e),a=function(t){$('<img class="signature-image"/>').attr("src",t).appendTo(i)};if(t.thumbMobileUrl)a(t.thumbMobileUrl);else{var n=$.extend({thumb:{mode:2,width:300,height:180}},t);FXM.Utils.getFileDownloadURL(n,function(t){a(t)})}}},_createSubformItem:function(t,e,i){var a=this;i.addClass("widget-subform"),FXM.Utils.forEach(e,function(e,n){var r=$('<ul class="widget-subform-list"/>').appendTo(i);FXM.Utils.forEach(t,function(t,e){var i=$('<li class="widget-item"/>').appendTo(r);a._createItem(e,e.label,n[e.name],i)})})},_bindEvent:function(){this.element.on("click","a.nest-link",function(t){var e=$(t.currentTarget).attr("data-url");e&&FXM.Utils.openLink(e)})}}),function(t){FXM.FlowChartView=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.FlowChartView._super._defaults.apply(this,arguments),{baseCls:"x-flowchartview",nodeWidth:160,nodeHeight:40,nodeMargin:20,appId:null,entryId:null,currentNodes:[],passNodes:[],legend:{visible:!0,items:[{name:"",type:"doing"},{name:"",type:"done"},{name:"",type:"undone"}]},nodeType:["done","doing","undone"],onNodeClick:null,offset:40,undoneStroke:"#d9d9d9",logs:[],pathDelimiter:"_"})},_init:function(){FXM.FlowChartView._super._init.apply(this,arguments);var e=this.options;if(!FXM.Utils.isEmpty(e.flowVer)){var i="V"+e.flowVer,a=t('<div class="flow-view-legend"/>').prependTo(this.element);t('<div class="legend-text"></div>').appendTo(a),t('<div class="legend-cap">'+i+"</div>").appendTo(a);var n=t('<div class="legend-group"/>').appendTo(a);e.legend.items.map(function(e){n.append(t('<div class="group-item"><div class="item-thumb '+e.type+'"/><div class="item-text">'+e.name+"</div></div>"))})}this.$flowChart=t("<div/>").appendTo(this.element),this._initFlowChartView()},_initFlowChartView:function(){var t=this,e=this.options;this.forwardFlowStack={};var i={};FXM.Utils.forEach(e.flow.flowStack,function(t,e){i[e]=!0}),this._getFlowLogs(function(a,n){FXM.Utils.forEach(a,function(a,n){"forward"!==n.flowAction&&"auto_forward"!==n.flowAction||!i[n.flowId]||FXM.Utils.forEach(n.flowTarget,function(i,a){t.forwardFlowStack[n.flowId+e.pathDelimiter+a]=!0})}),!n||n.length<=0?t._createEmpty():t._initFlowChart(n)})},_getFlowLogs:function(t){var e=this,i=this.options;this.logs&&this.flows&&t&&t(this.logs,this.flows),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.transfer_list),data:{authGroupId:i.authGroupId}},function(i){e.logs=i.logs,e.flows=i.flows,t&&t(e.logs,e.flows)})},_setNodeAreaWidth:function(t){var e=this,i=this.options,a=0;FXM.Utils.forEach(t.children,function(t,i){var n=e.flowMap[i];e.createdMap[i]||(e.createdMap[i]=!0,e._setNodeAreaWidth(n),a+=n.areaWidth)}),a||(a=i.nodeWidth+2*i.nodeMargin),t.areaWidth=a},_initFlowChart:function(e){var i=this,a=this.options;this.flowMap={},this.createdMap={};var n={};FXM.Utils.forEach(a.flow.flowStack,function(t,e){n[e]=a.nodeType[0]}),FXM.Utils.forEach(a.flow.chargers,function(t,e){n[e.flowId]=a.nodeType[1]});var r=FXM.CONSTS.WORKFLOW.FLOWSTATE;FXM.Utils.forEach(e,function(e,s){s.flowId===FXM.CONSTS.WORKFLOW.START_FLOW_ID?s.nodeType=n[s.flowId]||a.nodeType[0]:s.flowId===FXM.CONSTS.WORKFLOW.END_FLOW_ID&&[r.COMPLETE,r.CLOSE].indexOf(a.flow.flowState)>-1?s.nodeType=a.nodeType[0]:s.nodeType=n[s.flowId]||a.nodeType[2];var o=s.flowId;i.flowMap[o]=FXM.Utils.isEmpty(i.flowMap[o])?s:t.extend(i.flowMap[o],s),FXM.Utils.forEach(s.parents,function(t,e){FXM.Utils.isNull(e)||e===o||(i.flowMap[e]=i.flowMap[e]||{},i.flowMap[e].children||(i.flowMap[e].children=[]),i.flowMap[e].children.push(o))})}),this.flowLevel=0,this._setNodeAreaWidth(i.flowMap[0]),this.createdMap={},this._dealNodeAttr(this.flowMap[0],0,0),this.flowChart=new FXM.FlowChart({render:this.$flowChart,nodes:this.flowMap,paths:this._getFlowConnector(),nodeWidth:a.nodeWidth,nodeHeight:a.nodeHeight,offset:this._getOffset(),onNodeClick:function(t){FXM.Utils.applyFunc(i,a.onNodeClick,[i.flowMap[t]],!1)}})},_getOffset:function(){var t,e,i=this.options.offset;return FXM.Utils.forEach(this.flowMap,function(i,a){(!e||a.y<e)&&(e=a.y),(!t||a.x<t)&&(t=a.x)}),{x:t>i?t-i:0,y:e>i?e-i:0}},_dealNodeAttr:function(t,e,i){var a=this,n=this.options;if(!this.createdMap[t.flowId]){this.createdMap[t.flowId]=!0,FXM.Utils.isNumber(t.x)||(t.x=e+t.areaWidth/2-n.nodeWidth/2),FXM.Utils.isNumber(t.y)||(t.y=i*(2*n.nodeMargin+n.nodeHeight)+n.nodeMargin),this.flowLevel=Math.max(this.flowLevel,i),t.customCls="node-type-"+t.nodeType,t.flowId===FXM.CONSTS.WORKFLOW.START_FLOW_ID?(t.icon="icon-flow-start",t.source=!1):t.flowId===FXM.CONSTS.WORKFLOW.END_FLOW_ID?(t.target=!1,t.icon="icon-power-off"):t.icon="icon-flow-node";var r=0;FXM.Utils.forEach(t.children,function(t,n){var s=a.flowMap[n];a._dealNodeAttr(s,e+r,i+1),r+=s.areaWidth})}},_getFlowConnector:function(){var t=this,e=this.options,i=[];return FXM.Utils.forEach(this.flowMap,function(a,n){if(n&&!FXM.Utils.isNull(n.flowId)){var r=n.lines||{};FXM.Utils.forEach(n.parents,function(s,o){var l=t.flowMap[o];if(l&&!FXM.Utils.isNull(l.flowId)){var c,h=r[o]||{},u=l.flowId+e.pathDelimiter+a;t.forwardFlowStack[u]&&n.nodeType!==e.nodeType[2]||(c=e.undoneStroke),i.push({source:{id:l.flowId,port:h.sp},target:{id:a,port:h.tp},stroke:c})}})}}),i.sort(function(t,e){return!(t.stroke&&!e.stroke)}),i},_createEmpty:function(){t('<div class="empty-box"><div class="box-content"/><div class="box-text"></div> </div>').appendTo(this.element)}}),FXM.register("flowchartview",FXM.FlowChartView)}(Zepto),function(t){FXM.FlowApproval=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.FlowApproval._super._defaults.apply(this,arguments),{baseCls:"x-flow-approval"})},_init:function(){FXM.FlowApproval._super._init.apply(this,arguments),this.$body=t('<div class="approval-body"/>').appendTo(this.element),this._fetchLogs()},_createLogs:function(t){var e=this;t&&t.length?FXM.Utils.forEach(t,function(t,i){FXM.Utils.isEmpty(i.comment)&&FXM.Utils.isEmpty(i.signature&&i.signature.previewUrl)||"save"===i.flowAction||e._createItem(i)}):this._createEmpty()},_createItem:function(e){var i=t('<div class="approval-item"/>').appendTo(this.$body);t('<div class="item-title"/>').text(e.flowName).appendTo(i);o=t('<div class="item-content"/>').appendTo(i);if(e.operator){var a=FXM.Utils.resolveUsername(e.operator),n=FXM.Utils.formatUserThumb(a);t('<div class="content-thumb x-user-cover color-'+n.color+'">'+n.name+"</div>").appendTo(o)}var r=t('<div class="content-title"/>').appendTo(o);t("<span/>").text(e.operator&&e.operator.nickname).appendTo(r);var s=t('<div class="sub">'+FXM.Utils.format2ThumbDate(e.createTime)+"</div>").appendTo(r);r.css("padding-right",s.outerWidth(!0));var o=t('<div class="content-text"/>').text(e.comment).appendTo(o);e.signature&&t('<img src="'+e.signature.previewUrl+'"/>').appendTo(o)},_createEmpty:function(){t('<div class="empty-box"><div class="box-content"></div><div class="box-text"></div></div>').appendTo(this.element)},_fetchLogs:function(){var t=this,e=this.options;FXM.UI.showLoader(),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.flow_comment_list),data:{dataId:e.dataId,authGroupId:e.authGroupId,thumb:{mode:1,height:50,width:90}}},function(e){t._createLogs(e.logs)},null,function(){FXM.UI.closeLoader()})}}),FXM.register("flowapproval",FXM.FlowApproval)}(Zepto),function(t){FXM.FlowLog=FXM.extend(FXM.Widget,{CONST:{ACTION:{back:{color:"purple",text:""},close:{color:"red",text:""},revoke:{color:"blue",text:""},forward:{color:"green",text:""},auto_forward:{color:"green",text:""},auto_back:{color:"grey",text:""},save:{color:"yellow",text:""},transfer:{color:"blue-white",text:""},activate:{color:"indigo",text:""},forward_fail:{color:"red",text:""},back_fail:{color:"red",text:""},auto_forward_fail:{color:"red",text:""},auto_back_fail:{color:"red",text:""}}},_defaults:function(){return t.extend(FXM.FlowLog._super._defaults.apply(this,arguments),{baseCls:"x-flow-log",perPage:20})},_init:function(){FXM.FlowLog._super._init.apply(this,arguments),this.page=0,this.loading=!1,this.hasMore=!0,this.$body=t('<div class="log-body"/>').appendTo(this.element),this._loadLogs(!0)},_loadLogs:function(t){var e=this;this._getFlowLogs(function(i){FXM.Utils.isObjectEmpty(i)&&t?e._createEmpty():(e._createLogs(i),e._bindEvent())})},_getFlowLogs:function(t){var e=this.options,i=this;this.loading||(this.loading=!0,FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.log_flow),data:{dataId:e.dataId,authGroupId:e.authGroupId,skip:this.page*e.perPage,limit:e.perPage}},function(a){i.page++,i.hasMore=a.logs.length===e.perPage,t&&t(a.logs)},null,function(){i.loading=!1}))},_createLogs:function(t){for(var e=this.options,i=this,a={},n=[],r=t.length-1;r>=0;r--)n.unshift(this._formatLog(t[r],a));FXM.Utils.isEmpty(e.flowId)||(n=n.filter(function(t){return t.flowId===e.flowId})),FXM.Utils.forEach(n,function(t,e){i._createItem(e)})},_bindEvent:function(){var t=this.element,e=this,i=this.$body;this.hasMore&&t.bind("scroll.loadMore",function(){t.scrollTop()+t.height()+10>=i.outerHeight()&&(t.unbind("scroll.loadMore"),e._loadLogs())})},_createItem:function(e){var i=t('<div class="log-item"/>').appendTo(this.$body);t('<div class="item-title"/>').text(e.flowName).appendTo(i);var a=t('<div class="item-content"/>').appendTo(i);if(e.operator){var n=FXM.Utils.formatUserThumb(e.operator);t('<div class="content-thumb x-user-cover color-'+n.color+'">'+n.name+"</div>").appendTo(a)}var r=t('<div class="content-title"/>').appendTo(a),s=t('<div class="text"/>').text(e.operator).appendTo(r),o=e.flowAction;e.errorCode&&FXM.CONSTS.FLOW_FAIL_HINT[o]&&(o+="_fail");var l=this.CONST.ACTION[o],c=t('<div class="sub '+l.color+'"/>').text(l.text).appendTo(r);s.css("max-width",r.outerWidth(!0)-c.outerWidth(!0));var h="",u=FXM.CONSTS.FLOW_FAIL_CODE;e.errorCode===u.FORWARD_CHARGER?h="":e.errorCode===u.FORWARD_COND?h="":e.errorCode===u.BACK&&(h=""),t('<div class="content-text"><div class="text-line fail-hint">'+h+'</div><div class="text-line">'+FXM.Utils.format2ThumbDate(e.dealTime)+'</div><div class="text-line">'+FXM.Utils.format2ThumbDate(e.startTime)+"</div></div>").appendTo(a)},_formatLog:function(t,e){var i=e[t.flowId]||t.createTime;return FXM.Utils.forEach(t.flowTarget,function(i,a){e[a]=t.createTime}),{operator:FXM.Utils.resolveUsername(t.operator)||"",flowAction:t.flowAction,startTime:i,dealTime:t.createTime,flowId:t.flowId,flowName:t.flowName||"",errorCode:t.error_code}},_createEmpty:function(){t('<div class="empty-box"><div class="box-content"></div><div class="box-text"></div></div>').appendTo(this.element)}}),FXM.register("flowlog",FXM.FlowLog)}(Zepto),function(t){FXM.Navigator=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.Navigator._super._defaults.apply(this,arguments),{baseCls:"x-navigator",items:[],onMenuClick:null,currentMenuId:null,menuKey:null})},_init:function(){FXM.Navigator._super._init.apply(this,arguments),this._createItems(),this._bindEvents()},_createItems:function(){var e=this,i=this.options;FXM.Utils.forEach(i.items,function(a,n){var r=i.currentMenuId===n[i.menuKey]?"active":"";t('<div class="menu-item '+r+'"/>').data("menuId",n[i.menuKey]).text(n.name).appendTo(e.element)})},_bindEvents:function(){var e=this,i=this.options;this.element.click(function(a){var n=t(a.target).closest(".menu-item");n.length>0&&!n.hasClass("active")&&(n.addClass("active").siblings().removeClass("active"),FXM.Utils.applyFunc(e,i.onMenuClick,[n.data("menuId")],!1))})}})}(Zepto),FXM.ImageUpload=FXM.extend(FXM.FileUpload,{_defaults:function(){return $.extend(FXM.ImageUpload._super._defaults.apply(this,arguments),{baseCls:"x-fileupload x-image-upload",fileType:["jpg","jpeg","png","gif"],compressed:!1,onlyCamera:!1,btnText:"",maxLimitTip:"",noSupportTip:"",uploadFailTip:"",iconCls:"icon-plus",thumbWidth:79,thumbHeight:79})},_init:function(){FXM.ImageUpload._super._init.apply(this,arguments);var t=this,e=this.options;if(FXM.Utils.isCorp())this.$uploadInput&&this.$uploadInput.remove(),this.$uploadInput=$('<div class="upload-btn-input"/>').on("click",function(i){return t.isEnabled()?e.maxFileCount!==FXM.CONSTS.UPLOAD_FILE_COUNT.SINGLE&&t.files.length>=e.maxFileCount?(FXM.UI.toast({msg:" "+e.maxFileCount+" ",type:"warning"}),!1):void FXM.UI.chooseImage({maxFileCount:e.maxFileCount-t.files.length||1,compressed:e.compressed,onlyCamera:e.onlyCamera},function(e){t.$uploadBtn.hide(),t.sourceIds=e,t._upload2CorpSuccess()}):(i.preventDefault(),!1)}).appendTo(this.$uploadBtn);else{e.onlyCamera&&$('<div class="upload-tip">/</div>').appendTo(this.element);var i=e.fileType.map(function(t){return"image/"+t}).join(",");this.$uploadInput&&this.$uploadInput.prop("accept",i)}},_upload2CorpSuccess:function(){var t=this,e=this.options;this.sourceIds.length>0&&(e.maxFileCount===FXM.CONSTS.UPLOAD_FILE_COUNT.SINGLE&&(this.files=[],$(".upload-info",this.element).remove()),this.element.addClass("uploading"),this._checkUploadToken(function(){FXM.Utils.forEach(t.sourceIds,function(e,i){t._uploadSourceId(i)})}))},_uploadSourceId:function(t){var e=this,i=this.options,a={fileId:t,appId:FXM.STATIC.APPID,entryId:FXM.STATIC.ENTRYID,field:this.getWidgetName(),site:"qn",bucketType:"file"};FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.file.upload_client_file,FXM.STATIC.APPID),data:a},function(t){e.files.push(t.file),e.successCount++;var a=$('<div class="upload-info"/>').data("file",t.file).prependTo(e.element),n=$('<div class="upload-preview"/>').appendTo(a);e._drawRemotePreview(t.file,function(t){t.appendTo(n),i.enable&&e._createRemoveBtn().appendTo(n)}),e._onUpload4CorpFinished()},function(t,a,n){e.failCount++,413===n?FXM.UI.toast({msg:i.maxLimitTip,type:"warning"}):FXM.UI.toast({msg:i.uploadFailTip,type:"error"}),e._onUpload4CorpFinished()})},_createFileInfo:function(){return null},_createProgress:function(t,e){return new FXM.CircleProgress({render:$("<div/>").appendTo(e),valueMax:t})},_createRemoveBtn:function(){return $('<div class="delete-btn"><i class="icon-flow-close"></i></div>')},_createPreview:function(t,e){if(FXM.Utils.isCorp()){var i=[];FXM.Utils.forEach(e,function(a,n){FXM.Utils.getFileDownloadURL($.extend({down:!0},n),function(n){i.push(n),a===e.length-1&&FXM.UI.previewImage(i,i[t])})})}else new FXM.FilePreview({files:e,current:t})},_onUpload4CorpFinished:function(){var t=this.options;this.successCount+this.failCount<this.sourceIds.length||(this.failCount>0?FXM.Utils.applyFunc(this,t.onUploadFail,[{failCount:this.failCount}],!1):FXM.Utils.applyFunc(this,t.onUploadSuccess,[this.files],!1),this.$uploadBtn.show(),this.element.removeClass("uploading"))},setEnable:function(t){FXM.ImageUpload._super.setEnable.apply(this,arguments);var e=this.options;this.$uploadInput&&(!t||!FXM.Utils.isCorp()&&e.onlyCamera?(this.$uploadInput.addClass("x-ui-disable").attr("disabled",!0).attr("readonly",!0),this.element.addClass("x-ui-disable")):(this.$uploadInput.removeAttr("disabled").removeAttr("readonly").removeClass("x-ui-disable"),this.element.removeClass("x-ui-disable")))}}),FXM.register("image",FXM.ImageUpload),function(t){FXM.Segment=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.Segment._super._defaults.apply(this,arguments),{baseCls:"x-segment",onAfterItemSelect:null,items:[],multiselect:!1})},_init:function(){FXM.Segment._super._init.apply(this,arguments);var t=this.options;this.value=t.multiselect?[]:"",this._render(),this._bintEvent()},_render:function(){var t=this,e=this.options;FXM.Utils.forEach(e.items,function(e,i){i.selected&&(FXM.Utils.isArray(t.value)?t.value.push(i.value):t.value=i.value),t._createItem(i)})},_createItem:function(e){var i=e.selected?"active":"",a=t('<div class="segment-item  '+i+'"/>').data("value",e.value).appendTo(this.element);t('<div class="item-content"/>').text(e.text).appendTo(a)},_bintEvent:function(){var e=this,i=this.options;this.element.on("click",".segment-item",function(a){var n=t(a.currentTarget),r=n.data("value");if(i.multiselect)n.hasClass("active")?e.value=e.value.filter(function(t){return t!==r}):e.value.push(r),n.toggleClass("active");else{if(n.hasClass("active"))return a.preventDefault(),!1;n.addClass("active").siblings().removeClass("active"),e.value=r}FXM.Utils.applyFunc(e,i.onAfterItemSelect,[],!1)})},setValue:function(e){this.value=e;var i=FXM.Utils.makeArray(e);t(".segment-item",this.element).each(function(e,a){var n=t(a),r=n.data("value"),s=i.indexOf(r)>-1;n.toggleClass("active",s)})},getValue:function(){return this.value}}),FXM.register("segment",FXM.Segment)}(Zepto),function(t){FXM.FormBtnGroup=FXM.extend(FXM.Widget,{CONST:{VERSION_RULE:{1:64,2:46,3:34,4:30}},_defaults:function(){return t.extend(FXM.FormBtnGroup._super._defaults.apply(this,arguments),{baseCls:"x-form-btn-group",btns:[],target:null})},_init:function(){FXM.FormBtnGroup._super._init.apply(this,arguments);var e=this.options;if(e.btns&&e.btns.length){var i=t('<div class="btn-group-wrapper"/>').appendTo(this.element);this._createBtns(i)}},_createBtns:function(e){var i=this.options,a=i.btns,n=t('<div class="left" />').appendTo(e),r=this.CONST.VERSION_RULE,s={};FXM.Utils.forEach(a,function(o,l){switch(s[l.nav]=l.onClick,l.nav){case"update":case"submit":var c=r[a.length-1]||100;n.css("width",100-c+"%"),t('<div class="right blue" />').css("width",c+"%").text(l.text).on("click",function(){FXM.Utils.applyFunc(i.target,s[l.nav],[l.nav],!1)}).appendTo(e);break;case"cancel":t('<div class="right grey" />').text(l.text).css("left",0).on("click",function(){FXM.Utils.applyFunc(i.target,s[l.nav],[l.nav],!1)}).appendTo(e),t(".right",e).css("width","50%");break;default:t('<div class="footer-item"/>').append(t('<i class="icon-flow-'+l.nav+'"/>')).append(t('<div class="text"/>').text(l.text)).on("click",function(){FXM.Utils.applyFunc(i.target,s[l.nav],[l.nav],!1)}).appendTo(n)}})}})}(Zepto),function(t){FXM.Phone=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.Phone._super._defaults.apply(this,arguments),{baseCls:"x-phone",waterMark:"",phoneDelimiter:"-",onStopEdit:null})},_init:function(){FXM.Phone._super._init.apply(this,arguments);var e=this,i=this.options;this.chinaCode=FXM.CONSTS.CHINA_CODE,this.$input=t('<input class="phone-input" placeholder="'+i.waterMark+'">').appendTo(this.element),this.$input.blur(function(t){var a=e.checkValidate();a&&FXM.Utils.applyFunc(e,i.onStopEdit,[a,t],!1)}),this.$btn=t('<div class="phone-btn"/>').appendTo(this.element),this.$selectText=t('<div class="phone-code"/>').text(this.chinaCode).appendTo(this.$btn),this.$select=t('<select name="location" class="location-select"/>').appendTo(this.$btn),FXM.Utils.forEach(FXM.CONSTS.AREA_CODE,function(i,a){t('<option value="'+a.value+'" '+(a.value===e.chinaCode?"selected":"")+">"+a.text+" "+a.value+"</option>").appendTo(e.$select)}),t('<i class="icon-arrow-down"/>').appendTo(this.$btn),this.$select.on("change",function(t){e.$selectText.text(t.target.value)})},getValue:function(){return FXM.Utils.isEmpty(this.$input.val())?"":this.$select.val()+this.options.phoneDelimiter+this.$input.val()},setValue:function(t){var e=this.options;if(!FXM.Utils.isEmpty(t)){new RegExp(e.phoneDelimiter).test(t)||(t=e.phoneDelimiter+t);var i=t.split(e.phoneDelimiter);if(i){var a=i[0];FXM.Utils.isEmpty(a)&&(a=this.chinaCode),this.$select.val(a),this.$selectText.text(a);var n=i[1];n&&this.$input.val(n)}}},checkValidate:function(){this.options;var t=this.$input.val().trim(),e=!0;try{e=new RegExp("^\\d+$").test(t)}catch(t){e=!1}return e?this.$input.removeClass("x-input-error"):this.$input.addClass("x-input-error"),e},setEnable:function(t){FXM.Phone._super.setEnable.apply(this,arguments),t?(this.$input.removeAttr("readOnly"),this.$select.removeAttr("disabled")):(this.$input.attr("readOnly","readOnly"),this.$select.attr("disabled","disabled"))}}),FXM.register("phone",FXM.Phone)}(Zepto),function(t){FXM.ValidCode=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.ValidCode._super._defaults.apply(),{baseCls:"x-valid-code",reloadTime:60,waterMark:"",regex:"",btnText:"",onClick:null})},_init:function(){FXM.ValidCode._super._init.apply(this,arguments);var e=this,i=this.options;this.input=new FXM.Text({render:t('<div class="code-input"/>').appendTo(this.element),waterMark:i.waterMark,regex:i.regex,value:i.value}),this.$btn=t('<div class="code-btn"/>').appendTo(this.element),i.btnText&&this.$btn.text(i.btnText),this.$btn.click(function(t){e.isEnabled()&&FXM.Utils.applyFunc(e,i.onClick,[t],!1)})},setReloadState:function(){var t=this,e=this.options,i=e.reloadTime;this.setEnable(!1);var a=setInterval(function(){t.setBtnText("("+i+")"),--i<=0&&(t.setBtnText(e.btnText),t.setEnable(!0),clearInterval(a))},1e3)},setBtnText:function(t){this.$btn.text(t)},getValue:function(){return this.input.getValue()},setValue:function(t){this.input.setValue(t)},checkValidate:function(){return this.input.checkValidate()},showErrorMsg:function(t){this.input.showErrorMsg(t)}}),FXM.register("validcode",FXM.ValidCode)}(Zepto),function(t){FXM.UserPortrait=FXM.UserPortrait||{},t.extend(FXM.UserPortrait,{REFERRERS:[{value:"friend",text:""},{value:"search",text:""},{value:"zhihu",text:""},{value:"toutiao",text:""},{value:"weChat",text:""},{value:"maimai",text:""},{value:"media",text:""},{value:"other",text:""}],INDUSTRIES:[{value:"internet",text:"/"},{value:"manufacturing",text:""},{value:"trade",text:"//"},{value:"estate",text:""},{value:"construction",text:""},{value:"finance",text:""},{value:"service",text:""},{value:"transportation",text:"//"},{value:"education",text:""},{value:"media",text:"//"},{value:"leasing",text:"/"},{value:"medical_medicine",text:""},{value:"government",text:"/"},{value:"social",text:""},{value:"scientific",text:""},{value:"environment",text:"/"},{value:"resident",text:""},{value:"mining",text:""},{value:"agriculture",text:"///"},{value:"electricity",text:"///"},{value:"other",text:""}],init:function(){var e=this;t("body").removeClass().addClass("x-user-portrait").empty(),this.element=t('<div class="portrait-body"/>').appendTo("body");var i=FXM.GB.user;this.dataMap={job:i.job||"",referrer:i.referrer||"",favorites:i.favorites?i.favorites.slice(0):[],company:i.company||"",corpSize:i.corpSize||"",industry:i.industry||""},FXM.Utils.isRegtimeBeforeUpdate("referrer")||(this.needReferrer=!0),this.stepsCount=3,FXM.Utils.isFromWorkWechat(i)&&(this.stepsCount=2);var a=/^other-(.*)/;if(this.favOther="",FXM.Utils.forEach(this.dataMap.favorites,function(t,i){if(/^other/.test(i)){var n=i.match(a);e.favOther=n?n[1]:"",e.dataMap.favorites[t]="other"}}),this.referrerOther="",/^other/.test(this.dataMap.referrer)){var n=this.dataMap.referrer.match(a);e.referrerOther=n?n[1]:"",e.dataMap.referrer="other"}this.forkId="",this.$passBtn=t('<div class="body-position-btn"></div>').on("click",function(){if(e._shouldRecommendApp()){var t={favorites:["other"]};FXM.Utils.isObjectEmpty(e.dataMap.favorites)||(t.favorites=e.dataMap.favorites.slice(0)),e._createTemplateSection(t)}else FXM.Router.reload()}).appendTo(this.element),this._createRoleSection().appendTo(this.element),this._createFuncSection().appendTo(this.element),this._createIndustrySection().appendTo(this.element),this._isRoleSectionFinished()?FXM.Utils.isObjectEmpty(this.dataMap.favorites)?this._switchWrapper("func"):this._switchWrapper("industry"):this._switchWrapper("role"),this._addPortraitCookie()},_createMain:function(e){var i=""+this.stepsCount+"";e=t.extend({title:i},e);var a=t('<div class="body-main-wrapper x-ui-hidden '+e.key+'" id='+e.key+"/>"),n=t('<div class="wrapper-content"/>').appendTo(a),r=t('<div class="wrapper-footer"/>').appendTo(a),s=t('<div class="footer-btn-group"/>').appendTo(r);return FXM.Utils.forEach(e.btn,function(e,i){t('<div class="footer-btn"/>').text(i.text).addClass(i.customCls).on("click",function(e){t(e.target).hasClass("x-ui-disable")||i.onClick&&i.onClick()}).appendTo(s)}),t('<pre class="content-title"/>').text(e.title).appendTo(n),a},_createRoleSection:function(){var e=this,i=this._createMain({key:"role",btn:[{text:"",customCls:"style-blue next "+(!this._isRoleSectionFinished()&&"x-ui-disable"),onClick:function(){e._submit(function(){e._switchWrapper("func")})}}]}),a=t(".wrapper-content",i),n=t('<div class="content-section"></div>').appendTo(a);t('<div class="section-label"></div>').appendTo(n);var r=[{text:"",customCls:"boss",value:"boss",select:!1},{text:"",customCls:"manager",value:"manager",select:!1},{text:"IT",customCls:"it",value:"it",select:!1},{text:"",customCls:"staff",value:"staff",select:!1}],s=t('<div class="section-role"/>').on("click",function(i){var a=t(i.target).closest(".role-item");a&&a.length&&(e.dataMap.job=a.data("val"),a.addClass("select").siblings().removeClass("select"),e._isRoleSectionFinished()&&e._setWrapperBtnEnable("role",!0))}).appendTo(n);if(FXM.Utils.forEach(r,function(i,a){a.select=a.value===e.dataMap.job,t('<div class="role-item"><div class="item-icon-ok" /><div class="item-user-thumb  '+a.customCls+'"/><div class="item-user-name">'+a.text+"</div></div>").data("val",a.value).toggleClass("select",a.select).appendTo(s)}),this.needReferrer){t('<div class="section-label"></div>').appendTo(n);var o=t("<div class='section-referrer'></div>").appendTo(n);new FXM.XCombo({render:t('<div class="referrer"/>').appendTo(o),waterMark:"",allowBlank:!1,items:this._getShuffleArr(this.REFERRERS),needSort:!1,onStopEdit:function(){e.dataMap.referrer=this.getValue(),"other"===e.dataMap.referrer?e.$otherReferrer.removeClass("x-ui-hidden"):e.$otherReferrer.addClass("x-ui-hidden"),e._isRoleSectionFinished()&&e._setWrapperBtnEnable("role",!0)}}).setValue(this.dataMap.referrer),this.$otherReferrer=t('<input class="other-input" type="text" placeholder="" maxlength="10">').addClass("x-ui-hidden").val(e.referrerOther).appendTo(o),"other"===this.dataMap.referrer&&this.$otherReferrer.removeClass("x-ui-hidden")}return i},_createFuncSection:function(){var e=this,i=[{text:"",onClick:function(){e._switchWrapper("role")}}];2===this.stepsCount?i.push({text:"",customCls:"style-blue next x-ui-disable",onClick:function(){e._submit(function(t){if(FXM.Utils.dt(FXM.CONSTS.TRACKER.USER_PORTRAIT_FINISH),e._shouldRecommendApp()){var i={favorites:t.user.favorites};e._createTemplateSection(i)}else FXM.Router.reload()})}}):i.push({text:"",customCls:"style-blue next "+(!this.dataMap.favorites.length&&"x-ui-disable"),onClick:function(){e._submit(function(){e._switchWrapper("industry")})}});var a=this._createMain({key:"func",btn:i}),n=t(".wrapper-content",a),r=t('<div class="content-section"></div>').appendTo(n);t('<div class="section-label">?</div>').appendTo(r);var s=t('<div class="section-func"/>').on("click",function(i){var a=t(i.target).closest(".func-item");if(a&&a.length){var n=a.data("val");a.hasClass("select")?(e.dataMap.favorites=e.dataMap.favorites.filter(function(t){return t!==n}),a.toggleClass("select")):e.dataMap.favorites.length<3&&(e.dataMap.favorites.push(n),a.toggleClass("select")),a.hasClass("select-other")&&(a.hasClass("select")?e.$otherNeed.removeClass("x-ui-hidden"):e.$otherNeed.addClass("x-ui-hidden")),e._setWrapperBtnEnable("func",!!e.dataMap.favorites.length)}}).appendTo(r),o=[{text:"",value:"inventory"},{text:"",value:"hr"},{text:"",value:"sign_up"},{text:"",value:"contract"},{text:"",value:"finance"},{text:"",value:"investigation"},{text:"",value:"customer"},{text:"",value:"project"},{text:"",value:"assets"},{text:"",value:"attendance"},{text:"",value:"sale"},{text:"",value:"other"}];return FXM.Utils.forEach(o,function(i,a){FXM.Utils.forEach(e.dataMap.favorites,function(t,e){if(e===a.value)return a.select=!0,!1});var n=t('<div class="func-item"/>').data("val",a.value||"").toggleClass("select",!!a.select).text(a.text).appendTo(s);"other"===a.value&&n.addClass("select-other")}),e.$otherNeed=t('<input class="other-input" type="text" placeholder="" maxlength="10">').addClass("x-ui-hidden").val(e.favOther).appendTo(s),e.dataMap.favorites.indexOf("other")>-1&&e.$otherNeed.removeClass("x-ui-hidden"),a},_createIndustrySection:function(){var e=this,i=this._createMain({key:"industry",btn:[{text:"",onClick:function(){e._switchWrapper("func")}},{text:"",customCls:"style-blue next x-ui-disable",onClick:function(){var t=e._checkValidate();e._setWrapperBtnEnable("industry",t),t&&e._submit(function(t){if(FXM.Utils.dt(FXM.CONSTS.TRACKER.USER_PORTRAIT_FINISH),e._shouldRecommendApp()){var i={favorites:t.user.favorites};e._createTemplateSection(i)}else FXM.Router.reload()})}}]}),a=t(".wrapper-content",i),n=t('<div class="content-form"></div>').appendTo(a),r=[{name:"company",type:"text",label:"/?",waterMark:"",value:this.dataMap.company,onStopEdit:function(){e.dataMap.company=this.getValue(),e._setWrapperBtnEnable("industry",e._checkValidate())},allowBlank:!1},{name:"corpSize",type:"combo",items:[{text:"1-10",value:"1-10"},{text:"11-20",value:"11-20"},{text:"21-50",value:"21-50"},{text:"51-100",value:"51-100"},{text:"101-200",value:"101-200"},{text:"201-500",value:"201-500"},{text:"501-1000",value:"501-1000"},{text:"1001-2000",value:"1001-2000"},{text:"2000",value:"2000+"}],label:"/?",allowBlank:!1,value:this.dataMap.corpSize,onStopEdit:function(){e.dataMap.corpSize=this.getValue(),e._setWrapperBtnEnable("industry",e._checkValidate())}},{name:"industry",type:"combo",items:this._getShuffleArr(this.INDUSTRIES),label:"/?",allowBlank:!1,value:this.dataMap.industry,onStopEdit:function(){e.dataMap.industry=this.getValue(),e._setWrapperBtnEnable("industry",e._checkValidate())}}];return this._needPhone()&&r.push({name:"phone",type:"phone",label:"?",value:this.dataMap.phone,onStopEdit:function(){e.dataMap.phone=this.getValue(),e._setWrapperBtnEnable("industry",e._checkValidate())}},{name:"phoneCode",type:"validcode",btnText:"",waterMark:"",onClick:function(){var t=this,i=e.widgetMap.phone;i.getValue()&&i.checkValidate()?(this.setEnable(!1),FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.sign.get_phone),data:{phone:i.getValue()}},function(){t.setReloadState()},function(){return t.setEnable(!0),!1})):FXM.UI.toast({type:"warning",msg:""})}}),this.widgetMap={},FXM.Utils.forEach(r,function(i,a){var r=t('<div class="form-line"/>').appendTo(n);t('<div class="line-label"/>').text(a.label).appendTo(r);var s=FXM.createWidget(t.extend({render:t("<div/>").appendTo(r)},a));if(e.widgetMap[a.name]=s,s.setValue(e.dataMap[a.name]),"combo"===s.getWidgetType()){var o="";FXM.Utils.forEach(a.items,function(t,i){if(i.value===e.dataMap[a.name])return o=i.text,!1}),o&&s.setText(o)}}),i},_getShuffleArr:function(t){if(!Array.isArray(t)||!t.length)return[];var e=FXM.Utils.shuffleArray(t.slice(0,-1));return e.push(t.slice(-1)[0]),e},_checkValidate:function(){var e=!0;return this._needPhone()&&t.extend(this.dataMap,{phoneCode:this.widgetMap.phoneCode.getValue()}),FXM.Utils.forEach(this.widgetMap,function(t,i){if(!i.checkValidate())return e=!1,!1}),e},_isRoleSectionFinished:function(){return(!this.needReferrer||this.dataMap.referrer)&&this.dataMap.job},_createTemplateSection:function(e){var i=this;FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.profile.persona_app_list),data:e},function(e){i._addRecommendCookie(),i.$passBtn.remove();var a=i._createMain({key:"template",title:"!",btn:[{text:"",onClick:function(){FXM.Router.reload()}},{text:"",customCls:"style-blue",onClick:function(){FXM.Utils.isEmpty(i.forkId)?FXM.UI.toast({msg:"",type:"warning"}):i._installApps()}}]}),n=t(".wrapper-content",a),r=t('<div class="content-template"/>').appendTo(n);new FXM.TemplateList({render:t("<div/>").appendTo(r),apps:e.appList,customCls:"portrait-list",onItemClick:function(t,e){i.forkId=t._id,this.setItemSelect(e)}}),t('<a class="content-link" ></a>').on("click",function(){FXM.Router.redirectTo("/template/list")}).appendTo(r),a.appendTo(i.element),i._switchWrapper("template")})},_switchWrapper:function(e){t(".body-main-wrapper").addClass("x-ui-hidden"),t("#"+e).removeClass("x-ui-hidden")},_setWrapperBtnEnable:function(e,i){var a=t(".wrapper-footer > .footer-btn-group","#"+e);i?t(".footer-btn.next",a).removeClass("x-ui-disable"):t(".footer-btn.next",a).addClass("x-ui-disable")},_installApps:function(){FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.dashboard.install),data:{forkId:this.forkId,corpId:FXM.STATIC.dashConfig.corpId,channel:"guide"}},function(){FXM.Router.reload()})},_submit:function(e){var i=this,a=t.extend(!0,{},this.dataMap);FXM.Utils.forEach(a.favorites,function(t,e){"other"===e&&(i.favOther=i.$otherNeed.val().trim(),FXM.Utils.isEmpty(i.favOther)||(a.favorites[t]="other-"+i.favOther))}),"other"===a.referrer&&(this.referrerOther=this.$otherReferrer.val().trim(),FXM.Utils.isEmpty(i.referrerOther)||(a.referrer="other-"+i.referrerOther)),FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.profile.persona),data:a},function(i){t.extend(FXM.GB.user,i.user),e&&e(i)})},_shouldRecommendApp:function(){return!FXM.GB.user.firstAppId&&!FXM.Cookie.get(FXM.GB.user._id+FXM.CONSTS.COOKIE.RECOMMEND.SUFFIX_KEY)},_needPhone:function(){var t=FXM.GB.user;return!FXM.Utils.isFromWorkWechat(t)&&!FXM.Utils.isFromDingDing(t)&&!t.phone},_addPortraitCookie:function(){FXM.Cookie.set(FXM.GB.user._id+FXM.CONSTS.COOKIE.PORTRAIT.SUFFIX_KEY,FXM.CONSTS.COOKIE.PORTRAIT.VALUE,{express:FXM.CONSTS.COOKIE.PORTRAIT.EXPIRES})},_addRecommendCookie:function(){FXM.Cookie.set(FXM.GB.user._id+FXM.CONSTS.COOKIE.RECOMMEND.SUFFIX_KEY,FXM.CONSTS.COOKIE.RECOMMEND.VALUE,{expires:FXM.CONSTS.COOKIE.RECOMMEND.EXPIRES})}})}(Zepto),function(t){FXM.Tip=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.Tip._super._defaults.apply(),{baseCls:"x-tip",msg:""})},_init:function(){FXM.Tip._super._init.apply(this,arguments);var e=this.options;t('<div class="tip-message">'+e.msg+"</div>").appendTo(this.element)}})}(Zepto),function(t){FXM.Search=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.Search._super._defaults.apply(this,arguments),{baseCls:"x-search",triggerType:"inputChange",onSearch:null})},_init:function(){FXM.Search._super._init.apply(this,arguments);var e=this,i=this.options;t('<i class="search-icon icon-flow-search"/>').appendTo(this.element),this.$input=t('<input type="search" autocomplete="off" autocorrect="off"/>').appendTo(this.element),"keydown"===i.triggerType?this.$input.on("keydown",function(t){t.keyCode===FXM.CONSTS.KEYBOARD.ENTER&&FXM.Utils.applyFunc(e,i.onSearch,[],!1)}):this.$input.on("input propertychange",FXM.Utils.debounce(i.onSearch,500,this))},getValue:function(){return this.$input.val().trim()}})}(Zepto),function(t){FXM.TemplateList=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.TemplateList._super._defaults.apply(this,arguments),{baseCls:"x-template-list",layout:"portrait",apps:[],async:null,asyncResultKey:"apps",emptyTip:"",renderEmpty:!0,perPage:20})},_init:function(){FXM.TemplateList._super._init.apply(this,arguments);var e=this.options,i=this;this.$main=t('<div class="list-wrapper"/>').on("click",function(a){var n=t(a.target).closest(".template-item");n&&n.length&&FXM.Utils.applyFunc(i,e.onItemClick,[n.data("app"),n.index()],!1)}).appendTo(this.element),this.element.addClass(e.layout),this._initApps()},_initApps:function(){var t=this.options;this.page=0,this.loading=!1,this.hasMore=!0,t.async?this._loadApps(!0):this._createApps(t.apps,!0)},_loadApps:function(e){var i=this.options,a=this,n=i.async;if(n&&!this.loading){this.loading=!0;var r=t.extend({skip:this.page*i.perPage,limit:i.perPage},n.data);FXM.Utils.ajax({url:n.url,data:r},function(t){a.page++;var n=t[i.asyncResultKey];a.hasMore=n.length===i.perPage,a._createApps(n,e)},null,function(){a.loading=!1})}},_createApps:function(e,i){if(!i||e&&0!==e.length){if(i&&"landscape"===this.options.layout)return this.$main.css("width",100*e.length+"%"),void this._renderApps(e);this._renderApps(e),this.$survey_url||(this.$survey_url=t('<a class="survey-link"/>').text("").attr("href",FXM.CONSTS.TEMPLATE_SURVEY_URL).appendTo(this.element)),this._bindScrollEvent()}else this._renderEmpty()},_renderApps:function(e){var i=this;FXM.Utils.forEach(e,function(e,a){var n=t('<div class="template-item"/>').data("app",a).appendTo(i.$main),r=t('<div class="item-wrapper"/>').appendTo(n);t('<div class="item-thumb"><i class="icon-cover-'+a.icon+" app-cover-"+a.color+'"></i></div>').appendTo(r),t('<div class="item-title"/>').text(a.name).appendTo(r),t('<div class="item-info"/>').text(a.description).appendTo(r)})},_bindScrollEvent:function(){var t=this.element,e=this,i=this.$main;this.hasMore&&t.bind("scroll.loadMore",function(){t.scrollTop()+t.height()+10>=i.outerHeight()&&(t.unbind("scroll.loadMore"),e._loadApps())})},_renderEmpty:function(){this.$main.empty();var e=this.options;e.renderEmpty&&t('<div class="empty-box"><div class="box-bg"></div><div class="box-tip">'+e.emptyTip+'</div><a class="box-btn" href="'+FXM.CONSTS.TEMPLATE_SURVEY_URL+'"></a></div>').appendTo(this.$main)},setItemSelect:function(e){t(".template-item.select").removeClass("select"),t(".template-item",this.$main).eq(e).addClass("select")},reload:function(e){this.$main.empty(),t.extend(this.options,e),this._initApps()}})}(Zepto),function(t){FXM.AppInstallBtn=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.AppInstallBtn._super._defaults.apply(this,arguments),{baseCls:"x-app-install",forkId:""})},_init:function(){FXM.AppInstallBtn._super._init.apply(this,arguments);var e=this.options;new FXM.Button({render:t("<div/>").appendTo(t("<div/>").addClass(e.baseCls).appendTo("body >.x-page")),content:"",onClick:function(){var i={forkId:e.forkId};FXM.STATIC.ATOKEN||t.extend(i,{channel:"market"}),FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.dashboard.install),data:i},function(t){FXM.Cookie.set("install_success_tip",!0,{expires:new Date((new Date).getTime()+6e4),path:"/"}),FXM.Utils.dt(FXM.CONSTS.TRACKER.APP_INSTALL_FROM_MOBILE),window.location.href="/dashboard"},function(t){var e=FXM.Utils.parseJSON(t.responseText);switch(e.code){case 1030:window.location.href="/register";break;case 2014:FXM.UI.alert({msg:""});break;default:FXM.Vip.showUpgradeTip(e,"!")}})}})}})}(Zepto),function(t){FXM.Signature=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return t.extend(FXM.Signature._super._defaults.apply(this,arguments),{baseCls:"x-signature",addText:"",thumbWidth:300,thumbHeight:160,allowBlank:!0,allowSign:!0,uploadFailTip:"",uploadTokenURL:FXM.Utils.getApi(FXM.API.file.upload_token,FXM.STATIC.APPID),file:null,waterMark:"",onStopEdit:null})},_init:function(){var t=this.options;FXM.Signature._super._init.apply(this,arguments),this.file=t.file||{},FXM.Utils.isObjectEmpty(this.file)?this._createTriggerBtn():this._createPreview(t.file),this._bindEvents()},_createTriggerBtn:function(){var e=this.options;this._removeTriggerBtn(),e.allowSign?e.enable?this.$trigger=t('<div class="signature-trigger"><i class="add-icon icon-flow-normal"/><div class="add-text">'+e.addText+"</div></div>").appendTo(this.element):this.element.attr("data-watermark",e.waterMark):this._createNotAllowSign()},_createNotAllowSign:function(){this.$notAllowSign=t('<div class="signature-not-allow"><i class="not-allow-icon icon-warning"/><span class="not-allow-text"></span></div>').appendTo(this.element)},_createPreview:function(e){this._removePreview();var i=this.options,a=this;this.$preview=t('<div class="signature-preview">').appendTo(this.element),FXM.Utils.isString(e)?a._drawLocalPreview(e).appendTo(a.$preview):a._drawRemotePreview(e,function(t){t.appendTo(a.$preview)}),i.enable&&this._createRemoveBtn().appendTo(a.$preview)},_removeTriggerBtn:function(){this.$trigger&&this.$trigger.remove(),this.$notAllowSign&&this.$notAllowSign.remove()},_removePreview:function(){this.$preview&&this.$preview.remove()},_drawLocalPreview:function(e){return t('<image class="preview-image"/>').attr("src",e)},_drawRemotePreview:function(e,i){var a=this.options,n=t('<image class="preview-image"/>'),r=t.extend({thumb:{mode:2,width:a.thumbWidth,height:a.thumbHeight}},e);FXM.Utils.getFileDownloadURL(r,function(t){n.attr("src",t),i&&i(n)})},_createRemoveBtn:function(){return t('<div class="delete-btn"><i class="icon-trash"/></div>')},_bindEvents:function(){var e=this,i=this.options;this.element.on("click",function(a){var n=t(a.target);n.closest(".signature-trigger").length?i.enable&&e._showSignaturePad():n.closest(".delete-btn").length?i.enable&&(e._removePreview(),e._createTriggerBtn(),e.file={}):n.closest(".preview-image").length&&e._doPreview()})},_showSignaturePad:function(){var e=this,i=t('<div class="signature-pane"/>');this.signaturePad=new FXM.SignaturePad({render:i,onCancel:function(){e.slider&&e.slider.close()},onOk:function(t){e.slider&&e.slider.close(),e._removeTriggerBtn(),e._createPreview(t);var i=this.getFileObj();e._doUpload(i)}}),this.slider=new FXM.SlidePanel({customCls:"signature-slider-pane",content:i,text4Left:null,text4Right:null}),this.slider.show()},_doUpload:function(t){var e=this.options,i=this;this.$preview.addClass("uploading");var a=this._createProcess(t.size);a.setValue(.1*t.size),this._getUploadToken(function(){FXM.Utils.uploadFile({widgetName:e.widgetName,uploadToken:FXM.STATIC.uploadToken,uploader:FXM.GB.user?FXM.GB.user._id:"",uploadToForm:!0,fileName:t.fileName},t.file,function(t){a.setValue(t)},function(t){i.file=t.file,setTimeout(function(){a.setVisible(!1)},600),i.$preview.removeClass("uploading"),FXM.Utils.applyFunc(i,e.onStopEdit,[],!1)},function(){i._removePreview(),i._createTriggerBtn(),FXM.UI.toast({msg:e.uploadFailTip,type:"error"})})})},_getUploadToken:function(t){var e=this.options;if(FXM.STATIC.uploadToken&&Date.now()<FXM.STATIC.uploadTokenExpires)return t();FXM.Utils.dataAjax({url:e.uploadTokenURL,data:{site:"qn",isMedia:!1}},function(e){FXM.STATIC.uploadToken=e.token,FXM.STATIC.uploadTokenExpires=18e5+Date.now(),t()})},_doPreview:function(){FXM.Utils.isObjectEmpty(this.file)||new FXM.FilePreview({files:[this.file]})},_createProcess:function(e){return new FXM.Progress({render:t('<div class="upload-process"/>').appendTo(this.$preview),valueMax:e})},checkValidate:function(){var t=!0;return this.options.allowBlank||(t=!FXM.Utils.isObjectEmpty(this.file)),this.setInvalidType(t,FXM.CONSTS.INVALID_TYPE.BLANK),t},setValue:function(t){this.file=t||{},FXM.Utils.isObjectEmpty(this.file)?(this._removePreview(),this._createTriggerBtn()):(this._removeTriggerBtn(),this._createPreview(this.file))},getValue:function(){return FXM.Utils.isObjectEmpty(this.file)?null:this.file}}),FXM.register("signature",FXM.Signature)}(Zepto),function(t){FXM.SignaturePad=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.SignaturePad._super._defaults.apply(this,arguments),{baseCls:"x-signature-pad",exportWidth:600,exportHeight:360,text4Clear:"",text4Cancel:"",text4Ok:"",onClear:null,onCancel:null,onOk:null})},_init:function(){FXM.SignaturePad._super._init.apply(this,arguments),this._createContent(),this._adjustDirection(),this._bindEvents()},_createContent:function(){var e=this.options;this.$contentWrapper=t('<div class="content-wrapper"/>').appendTo(this.element),this.$canvas=t('<canvas class="signature-canvas"/>').appendTo(this.$contentWrapper),this.signaturePad=new SignaturePad(this.$canvas[0],{velocityFilterWeight:.1,maxWidth:4}),this.$topTip=t('<div class="top-tip"></div>').appendTo(this.$contentWrapper),this.$btnGroup=t('<div class="btn-group"/>').appendTo(this.$contentWrapper),e.text4Cancel&&t('<div class="btn cancel"/>').text(e.text4Cancel).appendTo(this.$btnGroup),e.text4Clear&&t('<div class="btn clear"/>').text(e.text4Clear).appendTo(this.$btnGroup),e.text4Ok&&t('<div class="btn ok"/>').text(e.text4Ok).appendTo(this.$btnGroup)},_adjustDirection:function(){var e=t(window).width(),i=t(window).height();this.$contentWrapper.css({width:e+"px",height:i+"px"}),this.$canvas.attr("width",e+"px"),this.$canvas.attr("height",i+"px"),this.needRotate=e<i,this.$topTip.toggleClass("need-rotate",this.needRotate),this.$btnGroup.toggleClass("need-rotate",this.needRotate)},_bindEvents:function(){var e=this,i=this.options;this.$contentWrapper.on("click",function(a){var n=t(a.target).closest(".btn");if(n.hasClass("cancel"))FXM.Utils.applyFunc(e,i.onCancel,[],!1);else if(n.hasClass("clear"))e.signaturePad&&e.signaturePad.clear(),FXM.Utils.applyFunc(e,i.onClear,[],!1);else if(n.hasClass("ok")){var r=e.getDataUrl();FXM.Utils.applyFunc(e,i.onOk,[r],!1)}}),t(window).on("resize",FXM.Utils.debounce(e._adjustDirection,200,this))},getDataUrl:function(){return this._getAdjustedDataUrl(this.$canvas[0])},getFileObj:function(){var t=this.getDataUrl();return{file:FXM.Utils.dataURLtoBlob(t),fileName:this._createSignatureName()}},_createSignatureName:function(){return"signature_"+FXM.STATIC.IDBase+++".png"},_getAdjustedDataUrl:function(e){var i,a,n,r,s,o=this.options,l=t(e),c=l.width(),h=l.height(),u=t("<canvas/>").attr("width",o.exportWidth).attr("height",o.exportHeight),d=u[0].getContext("2d");return this.needRotate?(d.translate(0,o.exportHeight),d.rotate(-90*Math.PI/180),a=c*(i=Math.min(o.exportWidth/h,o.exportHeight/c)),n=h*i,r=(o.exportHeight-a)/2,s=(o.exportWidth-n)/2):(a=c*(i=Math.min(o.exportWidth/c,o.exportHeight/h)),n=h*i,r=(o.exportWidth-a)/2,s=(o.exportHeight-n)/2),d.drawImage(e,0,0,c,h,r,s,a,n),u[0].toDataURL("image/png")}}),FXM.register("signaturepad",FXM.SignaturePad)}(Zepto),FXM.FormItem=FXM.extend(FXM.Widget,{_defaults:function(){return $.extend(FXM.FormItem._super._defaults.apply(),{description:"",label:"",widget:{},mode:"new",onAddSubWidget:null,onAssociate:null,onCalFormula:null,onGetFilter:null,onGetLinkFilter:null,onGetLinkValue:null,onStopEdit:null,onValueChange:null})},_init:function(){FXM.FormItem._super._init.apply(this,arguments);var t=this.options;this.widget=t.widget,this._render()},_afterInit:function(){},_render:function(){var t=this.options,e=this,i=$('<div class="f-label"/>').appendTo(this.element).append($('<span class="f-title"/>').text(t.label));this.widget.allowBlank||$('<span class="f-required"/>').text("*").appendTo(i),FXM.Utils.isEmpty(t.description)||"<br>"===t.description||$('<div class="f-description x-subhtml"/>').append(t.description).appendTo(this.element),this._renderField(),this.isVisible()||this.element.addClass("x-ui-hidden"),"subform"===this.widget.type&&$('<div class="f-more"><i class="icon-flow-more"/></div>').on("click",function(){e.field.showActionSheet()}).appendTo(i)},_renderField:function(){var t=this.options,e=this;this.widget.enable||FXM.CONSTS.LIMIT_FIELDS.disable.indexOf(this.widget.type)<0?this.field=FXM.createWidget($.extend({label:t.label,render:$("<div/>").appendTo($('<div class="f-widget"/>').appendTo(this.element))},this._getFieldConfig(this.widget.type,this),this.widget)):this.field=new FXM.FormItemDisable($.extend({render:$("<div/>").appendTo($('<div class="f-widget"/>').appendTo(this.element)),onBeforeInit:function(){if("edit"!==t.mode){var i=this.options,a=i.rely;a&&a.formula&&FXM.Utils.isObjectEmpty(a.widgets)&&(i.value=FXM.Utils.applyFunc(e,t.onCalFormula,[a.formula.formula],null),e.widget.value=i.value)}},widgetType:this.widget.type},this.widget))},_getFieldConfig:function(t,e){var i=this.options,a=this,n={onStopEdit:function(){FXM.Utils.applyFunc(e,i.onStopEdit,[],!1)},onBeforeInit:function(){if("edit"!==i.mode){var t=this.options,n=t.rely;n&&n.formula&&FXM.Utils.isObjectEmpty(n.widgets)&&(t.value=FXM.Utils.applyFunc(e,i.onCalFormula,[n.formula.formula],null),a.widget.value=t.value)}}};switch(t){case"datetime":e.widget.enable||$.extend(n,{waterMark:""});break;case"combo":case"combocheck":$.extend(n,{onBeforeAsync:function(){var t=this.options.async.data;t&&(t.filter={cond:FXM.Utils.applyFunc(e,i.onGetFilter,[],[]),rel:FXM.CONSTS.FILTER_RELATION.AND})},onAfterItemSelect:function(t){a.effectItemLinkWidgets(t)}}),e.widget.enable||$.extend(n,{waterMark:""});break;case"linkdata":$.extend(n,{onBeforeLinkData:function(t){var a=this.options.linkForm;a&&this.reload({cond:FXM.Utils.applyFunc(e,i.onGetLinkFilter,[t,a],[]),rel:FXM.CONSTS.FILTER_RELATION.AND})}});break;case"subform":$.extend(n,{onBeforeWidgetCreate:function(t,n){$.extend(t,a._getFieldConfig(t.type,this),{onBeforeInit:function(){var t=this.options;if(FXM.Utils.isNull(n)){var a=t.rely;a&&a.formula&&FXM.Utils.isObjectEmpty(a.widgets)&&(t.value=FXM.Utils.applyFunc(e,i.onCalFormula,[a.formula.formula],null))}}})},onAfterWidgetCreate:function(t){FXM.Utils.applyFunc(e,i.onAddSubWidget,[t],!1)}});break;case"user":case"usergroup":$.extend(n,{onBeforeEdit:function(){var t=this.options;if(t.limitWidget){var a=FXM.Utils.applyFunc(e,i.onGetLinkValue,[t.limitWidget],null);FXM.Utils.isObjectEmpty(a)?t.limit={}:t.limit={departs:FXM.Utils.makeArray(a)}}}}),e.widget.enable||$.extend(n,{msg:""});break;case"dept":case"deptgroup":$.extend(n,{onBeforeEdit:function(t){var a=this.options;return!(!a.rely||!a.rely.data||a.valueOption!==FXM.CONSTS.WIDGET_VALUE_OPTION.CUSTOM)&&(!!FXM.Utils.isObjectEmpty(a.limit)&&void FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.distinct),data:$.extend({filter:{cond:FXM.Utils.applyFunc(e,i.onGetFilter,[],[]),rel:FXM.CONSTS.FILTER_RELATION.AND}},a.rely.data)},function(t){FXM.Utils.isObjectEmpty(t.items)?a.limit={}:a.limit={departs:t.items}},null,function(){t&&t()}))}}),e.widget.enable||$.extend(n,{msg:""});break;case"image":$.extend(n,{uploadTokenURL:FXM.Utils.getApi(FXM.API.file.upload_token,FXM.STATIC.APPID),maxFileSize:FXM.CONSTS.MAX_FILE_SIZE,maxLimitTip:"20M",onUploadSuccess:function(){FXM.Utils.applyFunc(e,i.onValueChange,[],!1)}}),e.widget.enable||$.extend(n,{mode:"preview"});break;case"upload":$.extend(n,{uploadTokenURL:FXM.Utils.getApi(FXM.API.file.upload_token,FXM.STATIC.APPID),maxFileSize:FXM.CONSTS.MAX_FILE_SIZE,maxLimitTip:"20M",onUploadSuccess:function(){FXM.Utils.applyFunc(e,i.onValueChange,[],!1)}}),e.widget.enable||$.extend(n,{mode:"preview"});break;case"signature":$.extend(n,{allowSign:FXM.Vip.hasSignature()});break;case"radiogroup":$.extend(n,{onAfterItemSelect:function(t){a.effectItemLinkWidgets(t)}})}return n},_hasContactWidgets:function(t){return("combo"===t.type||"radiogroup"===t.type)&&!t.async},isVisible:function(){return this.widget.visible},isNoRepeat:function(){return this.widget.noRepeat},isSubformWidget:function(){return!1},getSubformName:function(){return""},getOptionValue:function(){return this.widget.value},getLinkForm:function(){return this.widget.linkForm},getLinkFilter:function(){return this.widget.linkFilter},getRely:function(){return this.widget.rely},getFormat:function(){return this.widget.format},getAsync:function(){return this.widget.async},getValueOption:function(){return this.widget.valueOption},getWidgetName:function(){return this.widget.widgetName},getWidgetType:function(){return this.widget.type},getLinkType:function(){return"linkdata"===this.widget.type?this.widget.linkType:this.widget.type},getWidgetByName:function(t,e){return this.field.getWidgetByName(t,e)},getInvalidType:function(){return this.field.getInvalidType()},setInvalidType:function(t){this.field.setInvalidType(t)},clearLimit:function(){this.field.clearLimit()},setValue:function(t){this.field.setValue(t)},getValue:function(){return this.field.getValue()},setText:function(t){this.field.setText(t)},getText:function(){return this.field.getText()},getNullValue:function(){return this.field.getNullValue()},getLinkValue:function(){return this.field.getLinkValue?this.field.getLinkValue():this.field.getValue()},setCacheValue:function(t){this.field.setCacheValue(t)},getCacheValue:function(){return this.field.getCacheValue()},rebuild:function(){this.field.rebuild()},reload:function(t){this.field.reload(t)},supportItemLink:function(){switch(this.widget.type){case"combo":return!!this.field.getAllLinkWidgets();case"radiogroup":return!0;default:return!1}},effectItemLinkWidgets:function(t){var e=this.options,i=this.widget;if(this._hasContactWidgets(i)){var a=[],n=this.getValue();FXM.Utils.forEach(i.items,function(e,i){return i.value===n?(a=i.widgetsMap||[],!1):!i.isOther||FXM.Utils.isEmpty(n)&&!t?void 0:(a=i.widgetsMap||[],!1)}),FXM.Utils.applyFunc(this,e.onAssociate,[i.widgetName,a],!1)}},checkValidate:function(){return this.field.checkValidate()},getOptions:function(){return this.field.getOptions()}}),function(t){FXM.FormUtils=FXM.FormUtils||{},t.extend(FXM.FormUtils,{getWidgetDefaultConfig:function(e){var i={type:e,enable:!0,visible:!0,allowBlank:!0};switch(e){case"datetime":t.extend(i,{format:"yyyy-MM-dd"});break;case"checkboxgroup":case"radiogroup":case"combo":case"combocheck":t.extend(i,{items:[{value:"1",text:"1"},{value:"2",text:"2"},{value:"3",text:"3"}]});break;case"address":t.extend(i,{needDetail:!0});break;case"image":case"upload":t.extend(i,{maxFileCount:FXM.CONSTS.UPLOAD_FILE_COUNT.MULTI});break;case"number":t.extend(i,{allowDecimals:!0});break;case"subform":t.extend(i,{subform_create:!0,subform_edit:!0,subform_delete:!0,items:[]});break;case"dept":case"deptgroup":t.extend(i,{valueOption:FXM.CONSTS.WIDGET_VALUE_OPTION.CUSTOM});break;case"separator":t.extend(i,{lineStyle:"thin"})}return i}})}(Zepto),function(t){FXM.FormItemDisable=FXM.extend(FXM.BaseFormWidget,{_defaults:function(){return t.extend(FXM.FormItemDisable._super._defaults.apply(this,arguments),{baseCls:"x-form-item-disable",widgetType:null,waterMark:""})},_init:function(){FXM.FormItemDisable._super._init.apply(this,arguments);var t=this.options;switch(this.widgetType=t.widgetType,this.widgetType){case"number":t.regex="^[-]?[\\d]{0,}"+(t.allowDecimals?"[\\.]?[\\d]{0,}":"")+"$";break;case"radiogroup":e="";FXM.Utils.forEach(t.items,function(t,i){if(i.selected&&!i.isOther)return e=i.value,!1}),this.element.addClass("x-combo"),this.setValue(e);break;case"checkboxgroup":var e=[];FXM.Utils.forEach(t.items,function(t,i){i.selected&&e.push(i.value)}),this.element.addClass("x-combocheck"),this.setValue(e)}this.element.attr("data-watermark",t.waterMark),this._bindEvent()},_initDefaultValue:function(t){this.setValue(t)},_bindEvent:function(){this.element.on("click","a.nest-link",function(e){var i=t(e.currentTarget).attr("data-url");i&&FXM.Utils.openLink(i,!0)})},setValue:function(e){var i=this.options;switch(this.widgetType){case"address":if(this.value=e,FXM.Utils.isObjectEmpty(e))this.setText("");else{var a=i.needDetail?"pcda":"pcd";this.setText(FXM.Utils.address2Str(e,"",a))}break;case"location":this.value=e,FXM.Utils.isObjectEmpty(e)?this.setText(""):(this.setText(FXM.Utils.address2Str(e,"","pcda")),i.lnglatVisible&&t('<div class="disable-info"/>').text(FXM.Utils.getLnglatText(e)).appendTo(this.element));break;case"number":e=FXM.Utils.fixDecimalPrecision(e),this.value=e,this.cacheValue=e,this.setText(e);break;case"text":case"textarea":case"radiogroup":e=FXM.Utils.isEmpty(e)?"":e+"",this.value=e,this.cacheValue=e,this.setText(e);break;case"checkboxgroup":this.value=e,this.cacheValue=e,this.setText(e)}},getValue:function(){switch(this.widgetType){case"number":return FXM.Utils.str2num(this.value);default:return this.value}},setText:function(e){var i=this.options;switch(this.widgetType){case"radiogroup":(a=t(".x-picker-label",this.element)).length||(a=t('<div class="x-picker-label" data-watermark="'+i.waterMark+'"/>').appendTo(this.element)),a.empty(),FXM.Utils.isEmpty(e)||t('<span class="combo-select-result select-single"/>').text(e).appendTo(a);break;case"checkboxgroup":var a=t(".x-picker-label",this.element);a.length||(a=t('<div data-watermark="'+i.waterMark+'" class="x-picker-label"/>').appendTo(this.element)),a.empty(),FXM.Utils.forEach(e,function(e,i){t('<span class="combo-select-result"/>').text(i).appendTo(a)});break;default:this.element.html(FXM.Utils.replaceURL(e))}},getText:function(){switch(this.widgetType){case"radiogroup":var e=t(".combo-select-result",this.element);return e&&e.length?e.text():"";case"checkboxgroup":return FXM.Utils.makeArray(this.getValue()).join(",");default:return this.element.text()}},getNullValue:function(){switch(this.widgetType){case"address":case"location":return{};case"checkboxgroup":return[];default:return null}},checkValidate:function(){var t=this.options,e=FXM.CONSTS.INVALID_TYPE,i=!0,a=e.INVALID,n=this.getValue();switch(this.widgetType){case"checkboxgroup":n=FXM.Utils.makeArray(n),t.allowBlank||0!==n.length||(i=!1,a=e.BLANK);break;default:if(FXM.Utils.isObjectEmpty(n))i=t.allowBlank,a=e.BLANK;else if(!FXM.Utils.isEmpty(t.regex)){a=e.REGEX;try{i=new RegExp(t.regex).test(n)}catch(t){i=!1}}}return this.setInvalidType(i,a),i}}),FXM.register("formitemdisable",FXM.FormItemDisable)}(Zepto),FXM.SubformItem=FXM.extend(FXM.FormItem,{_defaults:function(){return $.extend(FXM.SubformItem._super._defaults.apply(),{subform:"",widget:{},onBeforeWidgetCreate:null})},_render:function(){this._renderField()},_renderField:function(){var t=this.options;if(this.widget.enable||FXM.CONSTS.LIMIT_FIELDS.disable.indexOf(this.widget.type)<0){var e=$.extend({render:this.element},this.widget,FXM.Utils.applyFunc(this,t.onBeforeWidgetCreate,[this.widget],!1));this.field=FXM.createWidget(e)}else this.field=new FXM.FormItemDisable($.extend({render:this.element,widgetType:this.widget.type},this.widget,FXM.Utils.applyFunc(this,t.onBeforeWidgetCreate,[this.widget],!1)))},isSubformWidget:function(){return!0},getSubformName:function(){return this.options.subform}}),function(t){FXM.FilterBase=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.FilterBase._super._defaults.apply(this,arguments),{method:"",methodList:[],multi:!1,title:"",value:null,hasEmpty:!1,onStopEdit:null})},_init:function(){FXM.FilterBase._super._init.apply(this,arguments);var t=this.options;this.method=t.method||t.methodList[0],this._initValue(t.value),this._createTitle(),this._createWidget()},_initValue:function(t){var e=this.options;this.value={items:t||[],hasEmpty:!!e.hasEmpty}},_createTitle:function(){var e=this,i=this.options,a=t('<div class="filter-title"/>').appendTo(this.element);t('<span class="filter-name"/>').attr("title",i.title).text(i.title).appendTo(a);var n=t('<div class="method-switch"/>').append(t('<span class="method-name"/>').text(this._getMethodInfo(this.method).name)).append(t('<i class="icon-arrow-down"/>')).on("click",function(){r.length>1&&s._showComboView()}).appendTo(a),r=[];if(FXM.Utils.forEach(i.methodList,function(t,i){var a=e._getMethodInfo(i);r.push({value:i,text:a.name,selected:i===e.method})}),r.length>1)var s=new FXM.Combo({render:n,items:r,allowBlank:!1,onLabelCreate:function(){},onStopEdit:function(){var i=this.getValue();i!==e.method&&(e.method=i,t(".method-name",n).text(e._getMethodInfo(i).name),e.updateValue(null),e._createWidget())}});else n.addClass("switch-disable")},_createWidget:function(){this.$widget?this.$widget.empty():this.$widget=t('<div class="filter-widget"/>').appendTo(this.element)},_getMethodInfo:function(t){var e={};return e[FXM.CONSTS.FILTER_METHOD.EQ]={name:""},e[FXM.CONSTS.FILTER_METHOD.NE]={name:""},e[FXM.CONSTS.FILTER_METHOD.ALL]={name:""},e[FXM.CONSTS.FILTER_METHOD.IN]={name:this.options.multi?"":""},e[FXM.CONSTS.FILTER_METHOD.NIN]={name:""},e[FXM.CONSTS.FILTER_METHOD.LK]={name:""},e[FXM.CONSTS.FILTER_METHOD.ULK]={name:""},e[FXM.CONSTS.FILTER_METHOD.EP]={name:""},e[FXM.CONSTS.FILTER_METHOD.NEP]={name:""},e[FXM.CONSTS.FILTER_METHOD.GT]={name:""},e[FXM.CONSTS.FILTER_METHOD.GTE]={name:""},e[FXM.CONSTS.FILTER_METHOD.LT]={name:""},e[FXM.CONSTS.FILTER_METHOD.LTE]={name:""},e[FXM.CONSTS.FILTER_METHOD.RG]={name:""},e[t]},updateValue:function(e){var i=this.options;t.isPlainObject(e)?this.value=e:this.value.items=FXM.Utils.makeArray(e),FXM.Utils.applyFunc(this,i.onStopEdit,[],!1)},getValue:function(){var t={method:this.method,value:this.value.items};return this.value.hasEmpty&&(t.hasEmpty=!0),t},getFilterType:function(){return""},checkValidate:function(){switch(this.method){case FXM.CONSTS.FILTER_METHOD.EP:case FXM.CONSTS.FILTER_METHOD.NEP:return!0;default:return this.value.hasEmpty||!FXM.Utils.isObjectEmpty(this.value.items)}}})}(Zepto),function(t){FXM.FilterText=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterText._super._defaults.apply(),{method:FXM.CONSTS.FILTER_METHOD.IN,methodList:[FXM.CONSTS.FILTER_METHOD.EQ,FXM.CONSTS.FILTER_METHOD.NE,FXM.CONSTS.FILTER_METHOD.IN,FXM.CONSTS.FILTER_METHOD.NIN,FXM.CONSTS.FILTER_METHOD.LK,FXM.CONSTS.FILTER_METHOD.ULK,FXM.CONSTS.FILTER_METHOD.EP,FXM.CONSTS.FILTER_METHOD.NEP]})},_createWidget:function(){FXM.FilterText._super._createWidget.apply(this,arguments);var e=this,i=this.options,a=this.value.items;switch(this.method){case FXM.CONSTS.FILTER_METHOD.EQ:case FXM.CONSTS.FILTER_METHOD.NE:new FXM.XCombo({render:t("<div />").appendTo(this.$widget),async:i.async,hasLimit:i.hasLimit,items:i.items,value:a[0],width:"100%",needSort:!1,onStopEdit:function(){e.updateValue(this.getValue())}});break;case FXM.CONSTS.FILTER_METHOD.IN:case FXM.CONSTS.FILTER_METHOD.NIN:new FXM.XComboCheck({render:t("<div />").appendTo(this.$widget),async:i.async,hasLimit:i.hasLimit,items:i.items,hasSelectEmpty:i.hasSelectEmpty&&this.method===FXM.CONSTS.FILTER_METHOD.IN,value:this.value,width:"100%",needSort:!1,onStopEdit:function(){e.updateValue(this.getValue())}});break;case FXM.CONSTS.FILTER_METHOD.LK:case FXM.CONSTS.FILTER_METHOD.ULK:new FXM.Text({render:t("<div />").appendTo(this.$widget),value:a[0],width:"100%",onStopEdit:function(){e.updateValue(this.getValue())}})}},getFilterType:function(){return"text"}}),FXM.register("filter_text",FXM.FilterText)}(Zepto),function(t){FXM.FilterTextArea=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterTextArea._super._defaults.apply(),{method:FXM.CONSTS.FILTER_METHOD.LK,methodList:[FXM.CONSTS.FILTER_METHOD.LK,FXM.CONSTS.FILTER_METHOD.ULK,FXM.CONSTS.FILTER_METHOD.EP,FXM.CONSTS.FILTER_METHOD.NEP]})},_createWidget:function(){FXM.FilterTextArea._super._createWidget.apply(this,arguments);var e=this,i=(this.options,this.value.items);switch(this.method){case FXM.CONSTS.FILTER_METHOD.LK:case FXM.CONSTS.FILTER_METHOD.ULK:new FXM.Text({render:t("<div />").appendTo(this.$widget),value:i[0],width:"100%",onStopEdit:function(){e.updateValue(this.getValue())}})}},getFilterType:function(){return"textarea"}}),FXM.register("filter_textarea",FXM.FilterTextArea)}(Zepto),function(t){FXM.FilterNumber=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterNumber._super._defaults.apply(),{method:FXM.CONSTS.FILTER_METHOD.EQ,methodList:[FXM.CONSTS.FILTER_METHOD.EQ,FXM.CONSTS.FILTER_METHOD.NE,FXM.CONSTS.FILTER_METHOD.GT,FXM.CONSTS.FILTER_METHOD.GTE,FXM.CONSTS.FILTER_METHOD.LT,FXM.CONSTS.FILTER_METHOD.LTE,FXM.CONSTS.FILTER_METHOD.RG,FXM.CONSTS.FILTER_METHOD.EP,FXM.CONSTS.FILTER_METHOD.NEP]})},_createWidget:function(){FXM.FilterNumber._super._createWidget.apply(this,arguments);var e=this,i=(this.options,this.value.items);switch(this.method){case FXM.CONSTS.FILTER_METHOD.EQ:case FXM.CONSTS.FILTER_METHOD.NE:case FXM.CONSTS.FILTER_METHOD.GT:case FXM.CONSTS.FILTER_METHOD.GTE:case FXM.CONSTS.FILTER_METHOD.LT:case FXM.CONSTS.FILTER_METHOD.LTE:new FXM.Number({render:t("<div />").appendTo(this.$widget),value:i[0],allowDecimals:!0,width:"100%",onStopEdit:function(){e.updateValue(this.getValue())}});break;case FXM.CONSTS.FILTER_METHOD.RG:new FXM.NumberLimit({render:t("<div />").appendTo(this.$widget),value:{min:i[0],max:i[1]},width:"100%",onStopEdit:function(){var t=this.getValue();e.updateValue([t.min,t.max])}})}},getFilterType:function(){return"number"}}),FXM.register("filter_number",FXM.FilterNumber)}(Zepto),function(t){FXM.FilterAddress=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterAddress._super._defaults.apply(),{method:FXM.CONSTS.FILTER_RELATION.ALL,methodList:[FXM.CONSTS.FILTER_METHOD.ALL,FXM.CONSTS.FILTER_METHOD.NIN,FXM.CONSTS.FILTER_METHOD.EP,FXM.CONSTS.FILTER_METHOD.NEP]})},_createWidget:function(){FXM.FilterAddress._super._createWidget.apply(this,arguments);var e=this,i=(this.options,this.value&&this.value.items);switch(this.method){case FXM.CONSTS.FILTER_METHOD.ALL:case FXM.CONSTS.FILTER_METHOD.NIN:new FXM.Address({render:t("<div />").appendTo(this.$widget),needDetail:!1,width:"100%",value:{province:i[0],city:i[1],district:i[2]},onStopEdit:function(){var t=this.getValue();e.updateValue([t.province,t.city,t.district])}})}},_getMethodInfo:function(t){var e={};return e[FXM.CONSTS.FILTER_METHOD.ALL]={name:""},e[FXM.CONSTS.FILTER_METHOD.NIN]={name:""},e[FXM.CONSTS.FILTER_METHOD.EP]={name:""},e[FXM.CONSTS.FILTER_METHOD.NEP]={name:""},e[t]},getFilterType:function(){return"address"}}),FXM.register("filter_address",FXM.FilterAddress)}(Zepto),function(t){FXM.FilterCheck=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterCheck._super._defaults.apply(),{method:FXM.CONSTS.FILTER_METHOD.IN,methodList:[FXM.CONSTS.FILTER_METHOD.IN,FXM.CONSTS.FILTER_METHOD.ALL,FXM.CONSTS.FILTER_METHOD.EQ,FXM.CONSTS.FILTER_METHOD.EP,FXM.CONSTS.FILTER_METHOD.NEP],multi:!0})},_createWidget:function(){FXM.FilterCheck._super._createWidget.apply(this,arguments);var e=this,i=this.options;switch(this.method){case FXM.CONSTS.FILTER_METHOD.EQ:case FXM.CONSTS.FILTER_METHOD.ALL:case FXM.CONSTS.FILTER_METHOD.IN:new FXM.XComboCheck({render:t("<div />").appendTo(this.$widget),async:i.async,items:i.items,hasSelectEmpty:!1,value:this.value,width:"100%",onStopEdit:function(){e.updateValue(this.getValue())}})}},getFilterType:function(){return"combocheck"}}),FXM.register("filter_check",FXM.FilterCheck)}(Zepto),function(t){FXM.FilterDate=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterBase._super._defaults.apply(),{method:FXM.CONSTS.FILTER_METHOD.EQ,methodList:[FXM.CONSTS.FILTER_METHOD.EQ,FXM.CONSTS.FILTER_METHOD.NE,FXM.CONSTS.FILTER_METHOD.GTE,FXM.CONSTS.FILTER_METHOD.LTE,FXM.CONSTS.FILTER_METHOD.RG,FXM.CONSTS.FILTER_METHOD.EP,FXM.CONSTS.FILTER_METHOD.NEP],format:"yyyy-MM-dd"})},_createWidget:function(){FXM.FilterDate._super._createWidget.apply(this,arguments);var e=this,i=this.options,a=this.value.items;switch(this.method){case FXM.CONSTS.FILTER_METHOD.RG:new FXM.DateLimit({render:t("<div />").appendTo(this.$widget),value:{min:a[0],max:a[1]},format:i.format,onStopEdit:function(){var t=this.getValue();FXM.Utils.isObjectEmpty(t)?e.updateValue(null):e.updateValue([t.min,t.max])}});break;case FXM.CONSTS.FILTER_METHOD.EQ:var n=a[0],r=this._getDateItems(),s=null;FXM.Utils.isEmpty(n)?n=r[0].value:/[0-9]/.test(n)&&(s=n,n=r[0].value),FXM.Utils.forEach(r,function(t,e){e.selected=e.value===n}),new FXM.Combo({render:t("<div />").appendTo(this.$widget),items:r,allowBlank:!1,value:n,width:"100%",onStopEdit:function(){var t=this.getValue();"static"===t?(o.setVisible(!0),e.updateValue(null)):(o.setVisible(!1),e.updateValue(t))}});var o=new FXM.Datetime({render:t("<div />").appendTo(this.$widget),value:FXM.Utils.parseDate(s),customCls:"sub-filter",format:i.format,visible:"static"===n,width:"100%",defaultPickDate:this._getDefaultPickDate(),onStopEdit:function(){e.updateValue(this.getValue())}});break;case FXM.CONSTS.FILTER_METHOD.NE:case FXM.CONSTS.FILTER_METHOD.GTE:case FXM.CONSTS.FILTER_METHOD.LTE:new FXM.Datetime({render:t("<div />").appendTo(this.$widget),value:FXM.Utils.parseDate(a[0]),format:i.format,width:"100%",defaultPickDate:this._getDefaultPickDate(),onStopEdit:function(){e.updateValue(this.getValue())}})}},_getDefaultPickDate:function(){return(new Date).setHours(0,0,0,0)},_getDateItems:function(){return[{text:"",value:"static"},{text:"",value:"today"},{text:"",value:"yesterday"},{text:"",value:"thisWeek"},{text:"",value:"lastWeek"},{text:"",value:"thisMonth"},{text:"",value:"lastMonth"}]},getValue:function(){var t=this.options,e=[],i=FXM.FilterDate._super.getValue.apply(this,arguments);return FXM.Utils.forEach(i.value,function(i,a){a&&!FXM.Utils.isString(a)&&(a=FXM.Utils.date2Str(new Date(a),t.format)),e.push(a)}),i.value=e,i},getFilterType:function(){return"datetime"}}),FXM.register("filter_date",FXM.FilterDate)}(Zepto),function(t){FXM.FilterDept=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterDept._super._defaults.apply(),{method:FXM.CONSTS.FILTER_METHOD.IN,methodList:[FXM.CONSTS.FILTER_METHOD.EQ,FXM.CONSTS.FILTER_METHOD.NE,FXM.CONSTS.FILTER_METHOD.IN,FXM.CONSTS.FILTER_METHOD.NIN,FXM.CONSTS.FILTER_METHOD.EP,FXM.CONSTS.FILTER_METHOD.NEP]})},_createWidget:function(){FXM.FilterDept._super._createWidget.apply(this,arguments);var t=this;this._getDeptValue(function(e){t._doCreateWidget(e)})},_doCreateWidget:function(e){var i=this;switch(this.method){case FXM.CONSTS.FILTER_METHOD.EQ:case FXM.CONSTS.FILTER_METHOD.NE:new FXM.Dept({render:t("<div />").appendTo(this.$widget),width:"100%",value:e[0],onStopEdit:function(){i.updateValue(this.getValue())}});break;case FXM.CONSTS.FILTER_METHOD.IN:new FXM.DeptSelect({render:t("<div />").appendTo(this.$widget),width:"100%",value:{items:e,hasEmpty:this.value.hasEmpty},onStopEdit:function(){i.updateValue(this.getValue())}});break;case FXM.CONSTS.FILTER_METHOD.NIN:new FXM.DeptGroup({render:t("<div />").appendTo(this.$widget),width:"100%",value:e,onStopEdit:function(){i.updateValue(this.getValue())}})}},_getDeptValue:function(t){var e=this,i=(this.options,this.value.items);FXM.Utils.isObjectEmpty(i)?FXM.Utils.applyFunc(e,t,[i],null):FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.corp.list_member_name),data:{isDepartmentOnly:name,members:i}},function(i){FXM.Utils.applyFunc(e,t,[i.departments],null)})},getFilterType:function(){return"dept"}}),FXM.register("filter_dept",FXM.FilterDept)}(Zepto),function(t){FXM.FilterDeptGroup=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterDeptGroup._super._defaults.apply(),{methodList:[FXM.CONSTS.FILTER_METHOD.IN,FXM.CONSTS.FILTER_METHOD.ALL,FXM.CONSTS.FILTER_METHOD.EQ,FXM.CONSTS.FILTER_METHOD.EP,FXM.CONSTS.FILTER_METHOD.NEP],multi:!0})},_createWidget:function(){FXM.FilterDept._super._createWidget.apply(this,arguments);var t=this;this._getDeptValue(function(e){t._doCreateWidget(e)})},_doCreateWidget:function(e){FXM.FilterDeptGroup._super._createWidget.apply(this,arguments);var i=this;this.options;switch(this.method){case FXM.CONSTS.FILTER_METHOD.EQ:case FXM.CONSTS.FILTER_METHOD.ALL:case FXM.CONSTS.FILTER_METHOD.IN:new FXM.DeptGroup({render:t("<div />").appendTo(this.$widget),value:e,width:"100%",onStopEdit:function(){i.updateValue(this.getValue())}})}},_getDeptValue:function(t){var e=this,i=(this.options,this.value.items);FXM.Utils.isObjectEmpty(i)?FXM.Utils.applyFunc(e,t,[i],null):FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.corp.list_member_name),data:{isDepartmentOnly:name,members:i}},function(i){FXM.Utils.applyFunc(e,t,[i.departments],null)})},getFilterType:function(){return"deptgroup"}}),FXM.register("filter_deptgroup",FXM.FilterDeptGroup)}(Zepto),function(t){FXM.FilterUser=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterUser._super._defaults.apply(),{method:FXM.CONSTS.FILTER_METHOD.IN,methodList:[FXM.CONSTS.FILTER_METHOD.EQ,FXM.CONSTS.FILTER_METHOD.NE,FXM.CONSTS.FILTER_METHOD.IN,FXM.CONSTS.FILTER_METHOD.NIN,FXM.CONSTS.FILTER_METHOD.EP,FXM.CONSTS.FILTER_METHOD.NEP]})},_createWidget:function(){FXM.FilterUser._super._createWidget.apply(this,arguments);var e=this,i=this.options,a=this.value.items;switch(this.method){case FXM.CONSTS.FILTER_METHOD.EQ:case FXM.CONSTS.FILTER_METHOD.NE:new FXM.XCombo({render:t("<div />").appendTo(this.$widget),async:i.async,items:i.items,value:a[0],hasLimit:i.hasLimit,width:"100%",textField:"nickname",valueField:"_id",needSort:!1,onAfterInit:function(){if(!FXM.Utils.isObjectEmpty(a)){var t=this;FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.corp.list_member_name),data:{isUserOnly:!0,members:a}},function(e){t.setText(e.users[0].nickname)})}},onStopEdit:function(){e.updateValue(this.getValue())}});break;case FXM.CONSTS.FILTER_METHOD.IN:case FXM.CONSTS.FILTER_METHOD.NIN:new FXM.XComboCheck({render:t("<div />").appendTo(this.$widget),async:i.async,hasSelectEmpty:i.hasSelectEmpty&&this.method===FXM.CONSTS.FILTER_METHOD.IN,value:this.value,width:"100%",textField:"nickname",valueField:"_id",hasLimit:i.hasLimit,onAfterInit:function(){if(!FXM.Utils.isObjectEmpty(a)){var t=this;FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.corp.list_member_name),data:{isUserOnly:!0,members:a}},function(i){var a=[];e.value.hasEmpty&&a.push(t.getEmptySelectText()),FXM.Utils.forEach(i.users,function(t,e){a.push(e.nickname)}),t.setText(a)})}},onStopEdit:function(){e.updateValue(this.getValue())}})}},getFilterType:function(){return"user"}}),FXM.register("filter_user",FXM.FilterUser)}(Zepto),function(t){FXM.FilterUserGroup=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterUserGroup._super._defaults.apply(),{method:FXM.CONSTS.FILTER_METHOD.IN,methodList:[FXM.CONSTS.FILTER_METHOD.IN,FXM.CONSTS.FILTER_METHOD.ALL,FXM.CONSTS.FILTER_METHOD.EQ,FXM.CONSTS.FILTER_METHOD.EP,FXM.CONSTS.FILTER_METHOD.NEP],multi:!0})},_createWidget:function(){FXM.FilterUserGroup._super._createWidget.apply(this,arguments);var e=this,i=this.options,a=this.value.items;switch(this.method){case FXM.CONSTS.FILTER_METHOD.EQ:case FXM.CONSTS.FILTER_METHOD.ALL:case FXM.CONSTS.FILTER_METHOD.IN:new FXM.XComboCheck({render:t("<div />").appendTo(this.$widget),async:i.async,hasLimit:i.hasLimit,items:i.items,value:this.value,textField:"nickname",valueField:"_id",width:"100%",onAfterInit:function(){if(!FXM.Utils.isObjectEmpty(a)){var t=this;FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.corp.list_member_name),data:{isUserOnly:!0,members:a}},function(i){var a=[];e.value.hasEmpty&&a.push(t.getEmptySelectText()),FXM.Utils.forEach(i.users,function(t,e){a.push(e.nickname)}),t.setText(a)})}},onStopEdit:function(){e.updateValue(this.getValue())}})}},getFilterType:function(){return"usergroup"}}),FXM.register("filter_usergroup",FXM.FilterUserGroup)}(Zepto),function(t){FXM.FilterFile=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterFile._super._defaults.apply(this,arguments),{methodList:[FXM.CONSTS.FILTER_METHOD.EP,FXM.CONSTS.FILTER_METHOD.NEP],method:FXM.CONSTS.FILTER_METHOD.NEP})},getFilterType:function(){return"file_list"}}),FXM.register("filter_file",FXM.FilterFile)}(Zepto),function(t){FXM.FilterSignature=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterSignature._super._defaults.apply(this,arguments),{methodList:[FXM.CONSTS.FILTER_METHOD.EP,FXM.CONSTS.FILTER_METHOD.NEP],method:FXM.CONSTS.FILTER_METHOD.NEP})},getFilterType:function(){return"signature"}}),FXM.register("filter_signature",FXM.FilterSignature)}(Zepto),function(t){FXM.FilterFlowState=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterFlowState._super._defaults.apply(),{methodList:[FXM.CONSTS.FILTER_METHOD.EQ]})},_createWidget:function(){FXM.FilterFlowState._super._createWidget.apply(this,arguments);var e=this;new FXM.Segment({render:t("<div/>").appendTo(this.$widget),items:[{text:"",value:"",selected:!0},{text:"",value:[FXM.CONSTS.WORKFLOW.FLOWSTATE.INPROCESS],selected:!1},{text:"",value:[FXM.CONSTS.WORKFLOW.FLOWSTATE.COMPLETE],selected:!1},{text:"",value:[FXM.CONSTS.WORKFLOW.FLOWSTATE.CLOSE],selected:!1}],multiselect:!1,onAfterItemSelect:function(){e.updateValue(this.getValue())}})},getFilterType:function(){return"flowstate"}}),FXM.register("filter_flowstate",FXM.FilterFlowState)}(Zepto),function(t){FXM.FilterFlowCreator=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterFlowCreator._super._defaults.apply(),{method:FXM.CONSTS.FILTER_METHOD.EQ,methodList:[FXM.CONSTS.FILTER_METHOD.EQ,FXM.CONSTS.FILTER_METHOD.NE,FXM.CONSTS.FILTER_METHOD.IN,FXM.CONSTS.FILTER_METHOD.NIN],asyncResultKey:"creators",textField:"nickname",valueField:"_id"})},_init:function(){FXM.FilterFlowCreator._super._init.apply(this,arguments)},_createWidget:function(){FXM.FilterFlowCreator._super._createWidget.apply(this,arguments);var e=this.options,i=this;switch(this.method){case FXM.CONSTS.FILTER_METHOD.EQ:case FXM.CONSTS.FILTER_METHOD.NE:new FXM.XCombo({render:t("<div/>").appendTo(this.$widget),async:e.async,width:"100%",textField:e.textField,valueField:e.valueField,asyncResultKey:e.asyncResultKey,hasLimit:e.hasLimit,onAfterAsync:function(t){var i={};i[e.textField]="",i[e.valueField]=FXM.CONSTS.PARAMETER.EMPTY,t.unshift(i)},onStopEdit:function(){i.updateValue(this.getValue())}});break;case FXM.CONSTS.FILTER_METHOD.IN:case FXM.CONSTS.FILTER_METHOD.NIN:new FXM.XComboCheck({render:t("<div/>").appendTo(this.$widget),async:e.async,width:"100%",emptySelectText:"",asyncResultKey:e.asyncResultKey,textField:e.textField,valueField:e.valueField,hasSelectEmpty:this.method===FXM.CONSTS.FILTER_METHOD.IN,hasLimit:e.hasLimit,onStopEdit:function(){i.updateValue(this.getValue())}})}},getValue:function(){this.options;var e=FXM.FilterFlowCreator._super.getValue.apply(this,arguments),i=e.value,a=FXM.CONSTS.FILTER_METHOD;switch(this.method){case a.EQ:case a.NE:var n=!1;FXM.Utils.forEach(i,function(t,e){if(e===FXM.CONSTS.PARAMETER.EMPTY)return n=!0,!1}),n&&t.extend(e,{method:this.method===a.EQ?a.EP:a.NEP,value:[]})}return e},getFilterType:function(){return"flowcreator"}}),FXM.register("filter_flowcreator",FXM.FilterFlowCreator)}(Zepto),function(t){FXM.FilterFlowEntry=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterFlowEntry._super._defaults.apply(),{methodList:[FXM.CONSTS.FILTER_METHOD.EQ],flowType:"todo",asyncResultKey:"data",textField:"name",valueField:"entryId"})},_createWidget:function(){FXM.FilterFlowEntry._super._createWidget.apply(this,arguments);var e=this,i=this.options;this.flowEntry=new FXM.Combo({render:t("<div/>").appendTo(this.$widget),async:{url:FXM.Utils.getApi(FXM.API.flow.flow_query_menu,FXM.STATIC.APPID),data:{type:i.flowType}},asyncResultKey:i.asyncResultKey,textField:i.textField,valueField:i.valueField,needSort:!1,onStopEdit:function(){e.updateValue(this.getValue())}})},getText:function(){return this.flowEntry.getText()},getFilterType:function(){return"flowentry"}}),FXM.register("filter_flowentry",FXM.FilterFlowEntry)}(Zepto),function(t){FXM.FilterFlowNode=FXM.extend(FXM.FilterBase,{_defaults:function(){return t.extend(FXM.FilterFlowNode._super._defaults.apply(),{methodList:[FXM.CONSTS.FILTER_METHOD.IN],formId:null})},_createWidget:function(){FXM.FilterFlowNode._super._createWidget.apply(this,arguments);var e=this,i=this.options;this.flowNode=new FXM.Combo({render:t("<div/>").appendTo(this.$widget),async:{url:FXM.Utils.getApi(FXM.API.flow.flow_query_node,FXM.STATIC.APPID),data:{formId:i.formId}},width:"100%",emptyTip:"",value:this.value,textField:"_id",asyncResultKey:"data",enable:i.enable,needSort:!1,onStopEdit:function(){var t=this.getValue(),i=[];FXM.Utils.forEach(t,function(t,e){i.push(e.flowId)}),e.updateValue(i)}})},_getMethodInfo:function(t){var e={};return e[FXM.CONSTS.FILTER_METHOD.IN]={name:""},e[t]},checkValidate:function(){return!FXM.Utils.isObjectEmpty(this.value)},getFilterType:function(){return"flownode"},rebuild:function(e){t.extend(this.options,e),this.updateValue(null),this._createWidget()},getSelectedNode:function(){return this.flowNode.getValue()}}),FXM.register("filter_flownode",FXM.FilterFlowNode)}(Zepto),function(t){FXM.Report=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.Report._super._defaults.apply(this,arguments),{baseCls:"x-report",appId:null,entryId:null,parameter:null,title:"",items:[]})},_init:function(){FXM.Report._super._init.apply(this,arguments);var e=this.options;FXM.Utils.setPageTitle(e.title),this.childWidgets={},this.widgetList=[],this.resizeState={},this.totalNum=e.items.length,this.currentIdx=-1,this.$wrapper=t('<div class="widget-wrapper"/>').appendTo(this.element),this._createWrapHeader(),e.parameter&&this._createParameter(),this._switch2Widget(0),this._bindScrollEvents(),this._bindResizeEvents()},_createWrapHeader:function(){var e=this,i=this.options;this.$header=t('<div class="report-header"/>').appendTo(this.$wrapper),i.parameter&&this.$header.addClass("has-parameter").append(t('<div class="filter-btn"/>').append(t('<i class="icon-filter"/>'))),this.$header.append(t('<div class="nav-btn prev"/>').append(t('<i class="icon-arrow-left"/>'))).append(t('<span class="title"/>')).append(t('<div class="nav-btn next"/>').append(t('<i class="icon-arrow-right"/>'))).on("click",".nav-btn",function(i){var a=t(i.currentTarget);a.hasClass("x-ui-disable")||(a.hasClass("prev")?e._switch2Widget(e.currentIdx-1):a.hasClass("next")&&e._switch2Widget(e.currentIdx+1))})},_refreshHeader:function(t,e,i){var a=t||this.options.title;this.$header.find(".title").text(a);var n=this.$header.find(".prev");e?n.removeClass("x-ui-disable"):n.addClass("x-ui-disable");var r=this.$header.find(".next");i?r.removeClass("x-ui-disable"):r.addClass("x-ui-disable")},_switch2Widget:function(t){var e=this.options;if(!(t<0||t>=this.totalNum)){var i=e.items[t];if(i){var a=this.getWidgetByIndex(t),n=this.getWidgetByIndex(this.currentIdx);if(t!==this.currentIdx&&n&&n.setVisible(!1),a){a.setVisible(!0);var r=a.getWidgetName();this.resizeState[r]&&(a.resize(),this.resizeState[r]=!1),a.reload()}else a=this._createWidget(t,i);this.currentIdx=t;var s=!0,o=!0;0===this.currentIdx&&(s=!1),this.currentIdx===this.totalNum-1&&(o=!1),this._refreshHeader(a.options.title,s,o)}}},_createWidget:function(e,i){var a=this,n=FXM.createWidget(t.extend({entryId:a.options.entryId,render:t("<div/>").prependTo(this.$wrapper),entryType:"report",onDataFilter:function(){return a.parameter?a.parameter.getValue():null},onItemClick:function(t){FXM.Utils.forEach(this.options.linkWidgets,function(e,i){var n=a.getWidgetByName(i);n&&n.setReloadState(!0,t)})}},i)),r=n.getWidgetName();return this.childWidgets[r]=n,this.widgetList[e]=r,n},getWidgetByIndex:function(t){var e=this.widgetList[t];return FXM.Utils.isEmpty(e)?null:this.getWidgetByName(e)},getWidgetByName:function(t){return this.childWidgets[t]},_createParameter:function(){var e=this,i=this.options,a=t(".report-header",this.element),n=t('<div class="parameter"/>');this.parameter=new FXM.Parameter(t.extend({render:t("<div />").appendTo(n)},i.parameter)),a.on("click",".filter-btn",function(){new FXM.SlidePanel({direction:"bottom",content:n,text4Right:"",text4Left:"",onLeftClick:function(){this.close()},onRightClick:function(){FXM.Utils.forEach(e.childWidgets,function(t,e){e.setReloadState(!0)}),e._switch2Widget(0),this.close()}}).show()})},_bindScrollEvents:function(){var e=this;t(window).scroll(function(){if(!e.$parameter||"none"===e.$parameter.css("display")){var i=e.getWidgetByName(e.widgetList[e.currentIdx]);if(-1!==["datatable","combinedtable"].indexOf(i.options.type)){var a=document.documentElement.scrollTop||document.body.scrollTop;i.$table&&a+t(this).height()>i.$table.height()-100&&i.loadMore()}}})},_bindResizeEvents:function(){var e=this;t(window).resize(function(){FXM.Utils.forEach(e.widgetList,function(t,i){var a=e.getWidgetByName(i);a&&(t===e.currentIdx?a.resize():e.resizeState[i]=!0)})})}}),FXM.register("report",FXM.Report)}(Zepto),function(t){FXM.Block=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.Block._super._defaults.apply(this,arguments),{baseCls:"x-block",title:"",forms:[],filter:null,linkWidgets:null})},_init:function(){FXM.Block._super._init.apply(this,arguments),this.$body=t('<div class="x-block-body"/>').appendTo(this.element),this.setReloadState(!0)},loadingAjax:function(t,e,i){var a=this;if(!this.isLoading){var n=FXM.UI.createLoadIcon().appendTo(this.element);this.isLoading=!0,FXM.Utils.dataAjax(t,function(t,i){return FXM.Utils.applyFunc(a,e,[t,i],!1)},function(t,e){return FXM.Utils.applyFunc(a,i,[t,e],!1)},function(){a.isLoading=!1,n.remove(),a.setReloadState(!1)})}},_makeGroups:function(e){var i=[],a=function(e,a){e.forEach(function(e){var n=t.extend({},a),r=a.tag||a.name;n.groupName=r+"_"+e,n.groupBy=e,i.push(n)})};return FXM.Utils.forEach(e,function(t,e){switch(e.type){case"datetime":var n=e.dateType||"year";a(n.split("&"),e);break;case"address":case"location":var r=e.addressType||"province";a(r.split("&"),e);break;default:i.push(e)}}),i},setReloadState:function(t,e){this.needReload=t,t&&(this._linkFilterParam=e)},reload:function(t){(t||this.needReload)&&this._reloadData()},_reloadData:function(){},_getWidgetNameByTag:function(t){var e=this.options,i=t;return FXM.Utils.forEach([].concat(e.xFields,e.yFields),function(e,a){if(a.tag&&a.tag===t)return i=a.name,!1}),i},_getLinkFilterParams:function(e){var i=this.options,a=this,n=[];return FXM.Utils.forEach(e,function(e,r){var s=a._getWidgetNameByTag(r.field);if(i.relations[s]){var o=i.relations[s];FXM.Utils.forEach(o,function(e,i){var a={type:r.type,method:r.method,value:r.value,keyType:r.keyType};t.extend(a,FXM.Utils.dealFilterInfoByField({id:e,name:i})),n.push(a)})}else{var l={type:r.type,method:r.method,value:r.value,keyType:r.keyType};n.push(t.extend(l,FXM.Utils.dealFilterInfoByField({id:i.forms[0],name:r.field})))}}),n},getFilterData:function(){var t=this,e=this.options,i=FXM.Utils.applyFunc(this,e.onDataFilter,[],!1),a=[];return i&&(a=a.concat(i)),FXM.Utils.isObjectEmpty(this._linkFilterParam)||FXM.Utils.forEach(this._linkFilterParam,function(i,n){FXM.Utils.forEach(e.forms,function(e,i){t._isSameEntry(i,n)&&a.push(n)})}),FXM.Utils.isObjectEmpty(a)?{}:{cond:a,rel:FXM.CONSTS.FILTER_RELATION.AND}},_isSameEntry:function(t,e){var i=FXM.Utils.getFieldInfoById(t),a=i.entryId,n=i.appId||e.appId;return a===e.entryId&&n===e.appId}})}(Zepto),function(t){FXM.Table=FXM.extend(FXM.Block,{_defaults:function(){return t.extend(FXM.Table._super._defaults.apply(),{tableHead:null,tableRowHead:null,tableData:[],exportable:!0,isHeadSticky:!1,onScroll:null,onAfterTableCreate:null})},_init:function(){FXM.Table._super._init.apply(this,arguments);this.$wrapper=t('<div class="table-wrapper"/>').appendTo(this.$body),this._removeTable()},createTable:function(){var e=this,i=this.options;if(this.$tableScroller=t('<div class="table-scoller"/>').scroll(function(i){t(this).scrollTop()+t(this).height()>e.$table.height()-100&&e.loadMore(),e._scrollStickyHead()}).appendTo(this.$wrapper),this.$table=t('<table class="x-table x-table-striped t-main"/>').appendTo(this.$tableScroller),this.tableHead&&this.tableHead.length>0){var a=t('<thead class="t-head"/>').appendTo(this.$table);FXM.Utils.forEach(this.tableHead,function(i,n){var r=t('<tr class="t-row th-row"/>').appendTo(a);FXM.Utils.forEach(n,function(t,i){e._createCell(i,{tag:"th",cls:"th-cell"}).appendTo(r)})})}this.$tableBody=t('<tbody class="t-body"/>').appendTo(this.$table),this._appendTableData(),this._setEvent(),this._createStickyHead(),FXM.Utils.applyFunc(this,i.onAfterTableCreate,[],!1)},_appendTableData:function(){var e=this;this.options;FXM.Utils.forEach(this.tableData,function(i,a){var n=i%2==0?"odd":"even",r=t('<tr class="t-row tb-row"/>').addClass(n).appendTo(e.$tableBody);e._bindRowData(e.$tableBody,r,i),e.tableRowHead&&e.tableRowHead.length>0&&e.tableRowHead.forEach(function(t){var a=t[i];a&&e._createCell(a,{tag:"th",cls:"rh-cell"}).appendTo(r)}),FXM.Utils.forEach(a,function(t,a){a.row=i,a.col=t,e._createCell(e._formatCell(a),{tag:"td",cls:"td-cell"}).appendTo(r)})})},_bindRowData:function(t,e,i){},_formatCell:function(e){return t.extend({},e)},_createCell:function(e,i){var a=i||{tag:"td"};a.cls&&e.cls&&(e.cls=a.cls+" "+e.cls);var n=t.extend(a,e.text||e.html||!FXM.Utils.isString(e)?e:{text:e}),r=t("<"+n.tag+' class="t-cell"/>');switch(r.attr({row:n.row,col:n.col}),n.html?r.html(n.html):r.text(n.text),n.align){case"center":r.addClass("h-center");break;case"right":r.addClass("h-right")}return n.data&&FXM.Utils.forEach(n.data,function(t,e){r.data(t,e)}),n.cls&&r.addClass(n.cls),n.colspan&&r.attr("colspan",n.colspan),n.rowspan&&r.attr("rowspan",n.rowspan),r.css({width:n.width,minWidth:n.minWidth,maxWidth:n.maxWidth,height:n.height}),r},_createStickyHead:function(){var e=this;if(!0===this.options.isHeadSticky){var i=this.$table.children(".t-head").removeClass("thead-invisible");this.$stickyHead=t('<table class="x-table x-table-striped"/>').append(this.$table.children(".t-head").clone(!0)).width(this.$table.width()),this.$stickyHead.find(".t-head .th-cell").each(function(i,a){var n=e.$table.find(".t-head .th-cell").eq(i);t(a).width(n.width()),FXM.Utils.forEach(n.data(),function(e,i){t(a).data(e,i)})}),t('<div class="table-sticky-head"/>').width(this.$tableScroller[0].clientWidth).append(this.$stickyHead).appendTo(this.$wrapper),i.addClass("thead-invisible")}},rebuildStickyHead:function(){this.$stickyHead&&this.$stickyHead.parent().remove(),this._createStickyHead()},_scrollStickyHead:function(){var t=this.options,e=this.$tableScroller.scrollTop(),i=this.$tableScroller.scrollLeft(),a=FXM.Utils.formatTransform("translate3d(-"+i+"px,0,0)");!1===FXM.Utils.applyFunc(this,t.onScroll,[i,e],!1)&&this.$stickyHead&&this.$stickyHead.css(a)},_setEvent:function(){},_removeTable:function(){this.$wrapper.children().remove()},_reloadData:function(e){FXM.Table._super._reloadData.apply(this,arguments),t(".x-empty-info",this.element).remove(),this._removeTable()},refresh:function(){this.tableRowHead=[],this._removeTable(),this.createTable()},resize:function(t){var e=this.options;FXM.Table._super.resize.apply(this,arguments),e.isHeadSticky&&this.$table&&(this.$stickyHead&&this.$stickyHead.parent().remove(),this._createStickyHead())}}),FXM.register("table",FXM.Table)}(Zepto),function(t){FXM.PlainTable=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.PlainTable._super._defaults.apply(),{baseCls:"x-plain-table",tableHead:[],tableRowHead:[],tableData:[],isHeadSticky:!1,onScrollBottom:null,onOpBtnClick:null,onRowClick:null,onHeadCellClick:null,onCellClick:null})},_init:function(){FXM.PlainTable._super._init.apply(this,arguments),this._createTable(),this._bindEvent()},_createTable:function(){var e=this,i=this.options;if(this.$tableScroller=t('<div class="table-scroller"/>').scroll(function(){e.isScrollToBottom()&&FXM.Utils.applyFunc(this,i.onScrollBottom,[],null),e._scrollStickyHead()}).appendTo(this.element),this.$table=t('<table class="x-table x-table-striped t-main"/>').appendTo(this.$tableScroller),i.tableHead.length>0){var a=t('<thead class="t-head"/>').appendTo(this.$table);FXM.Utils.forEach(i.tableHead,function(i,n){var r=t('<tr class="t-row th-row"/>').appendTo(a);FXM.Utils.forEach(n,function(t,i){e._createCell(i,{tag:"th",cls:"th-cell"}).appendTo(r)})})}this.$tableBody=t('<tbody class="t-body"/>').appendTo(this.$table),this.appendData(i.tableData,i.tableRowHead),this._createStickyHead()},isScrollToBottom:function(){return this.$tableScroller.scrollTop()+this.$tableScroller.height()>this.$table.height()-100},appendData:function(e,i){var a=this,n=this.options;FXM.Utils.forEach(e,function(e,n){var r=e%2==0?"odd":"even",s=t('<tr class="t-row tb-row"/>').addClass(r).appendTo(a.$tableBody);i.length>0&&FXM.Utils.forEach(i,function(t,i){var n=i[e];n&&a._createCell(n,{tag:"th",cls:"rh-cell"}).appendTo(s)}),FXM.Utils.forEach(n,function(t,i){i.row=e,i.col=t,a._createCell(i,{tag:"td",cls:"td-cell"}).appendTo(s)})}),n.isHeadSticky&&(this.$stickyHead&&this.$stickyHead.parent().remove(),this._createStickyHead())},_createCell:function(e,i){var a=i||{tag:"td"};a.cls&&e.cls&&(e.cls=a.cls+" "+e.cls);var n=t.extend(a,e.text||e.html||!FXM.Utils.isString(e)?e:{text:e}),r=t("<"+n.tag+' class="t-cell"/>');switch(r.attr({row:n.row,col:n.col}),n.html?r.html(n.html):r.text(n.text),n.align){case"center":r.addClass("h-center");break;case"right":r.addClass("h-right")}return n.data&&FXM.Utils.forEach(n.data,function(t,e){r.data(t,e)}),n.cls&&r.addClass(n.cls),n.colspan&&r.attr("colspan",n.colspan),n.rowspan&&r.attr("rowspan",n.rowspan),r.css({width:n.width,minWidth:n.minWidth,maxWidth:n.maxWidth,height:n.height}),r},_createStickyHead:function(){var e=this;if(this.options.isHeadSticky){var i=this.$table.children(".t-head").removeClass("thead-invisible");this.$stickyHead=t('<table class="x-table x-table-striped sticky-head"/>').append(this.$table.children(".t-head").clone(!0)).width(this.$table.width()),this.$stickyHead.find(".t-head .th-cell").each(function(i,a){var n=e.$table.find(".t-head .th-cell").eq(i);t(a).width(n.width()),FXM.Utils.forEach(n.data(),function(e,i){t(a).data(e,i)})}),t('<div class="table-sticky-head"/>').width(this.$tableScroller[0].clientWidth).append(this.$stickyHead).appendTo(this.element),i.addClass("thead-invisible")}},_scrollStickyHead:function(){var t=this.options,e=this.$tableScroller.scrollTop(),i=this.$tableScroller.scrollLeft(),a=FXM.Utils.formatTransform("translate3d(-"+i+"px,0,0)");!1===FXM.Utils.applyFunc(this,t.onScroll,[i,e],!1)&&this.$stickyHead&&this.$stickyHead.css(a)},_bindEvent:function(){var e=this,i=this.options;this.element.on("click",function(a){var n=t(a.target),r=n.closest(".table-op-btn");if(r.length>0)return FXM.Utils.applyFunc(e,i.onOpBtnClick,[r],null),!1;var s=n.closest(".t-cell");s.length>0&&FXM.Utils.applyFunc(e,i.onCellClick,[s],null);var o=n.closest(".th-cell");o.length>0&&FXM.Utils.applyFunc(e,i.onHeadCellClick,[o],null);var l=n.closest(".tb-row");l.length>0&&FXM.Utils.applyFunc(e,i.onRowClick,[l],null)})},reload:function(e){t.extend(this.options,e),this.element.empty(),this._createTable()},resize:function(t){var e=this.options;FXM.PlainTable._super.resize.apply(this,arguments),e.isHeadSticky&&(this.$stickyHead.parent().remove(),this._createStickyHead(),this._scrollStickyHead())}})}(Zepto),function(t){FXM.DataTable=FXM.extend(FXM.Table,{_defaults:function(){return t.extend(FXM.DataTable._super._defaults.apply(),{baseCls:"x-datatable",itemEditable:!1,itemRemovable:!1,isHeadSticky:!0,isFieldSortable:!0,itemsPerPage:50,fields:[],data:[],isCoopManage:!1,isExternalLink:!1,needFetchViewData:!1,authGroupId:null})},_init:function(t){FXM.DataTable._super._init.apply(this,arguments),this.sort=[],this.isHidden=!1,this._initDataTable()},_initDataTable:function(t){var e=this,i=this.options;i.itemEditable&&e._isMultiForm()&&(i.itemEditable=!1),i.itemRemovable&&e._isMultiForm()&&(i.itemRemovable=!1),this.tableRowHead=[],this.page=0,this.count=0,this.data=[],this._loadData(function(){t&&t(),e.createTable()})},_isMultiForm:function(){var t=this.options;return t.forms.length>1||!FXM.Utils.isObjectEmpty(t.relations)},_loadData:function(t){var e,i,a=this,n=this.options;n.isCoopManage?(e=FXM.Utils.getApi(FXM.API.data.find),i={fields:n.fields,forms:n.forms,relations:n.relations,sort:this.sort,skip:this.page*n.itemsPerPage,limit:n.itemsPerPage,authGroupId:n.authGroupId,filter:this.getCoopFilterData(),hasCount:!1}):n.isExternalLink?(e=FXM.Utils.getApi(FXM.API.data.query),i={widgetId:n.widgetName,sort:this.sort,skip:this.page*n.itemsPerPage,limit:n.itemsPerPage,filter:this.getFilterData(),hasCount:!1}):(e=FXM.Utils.getApi(FXM.API.data.list),i={widgetId:n.widgetName,sort:this.sort,skip:this.page*n.itemsPerPage,limit:n.itemsPerPage,filter:this.getFilterData(),hasCount:!1}),this.loadingAjax({url:e,data:i},function(e){if(a.count=e.data.length,a.header=e.header,a.data=a.data.concat(e.data),a.data.length)t&&t();else{var i=!FXM.Utils.isObjectEmpty(a.getFilterData())?"":"";FXM.UI.createEmptyTip({msg:i}).appendTo(a.$body)}},function(t){var e=FXM.Utils.parseJSON(t.responseText);FXM.Utils.isEmpty(e.msg)||FXM.UI.toast({type:"warning",msg:e.msg})})},createTable:function(){this._initHeadCount(),this._createTableHead(),this._createTableData(),FXM.DataTable._super.createTable.call(this,arguments)},appendData:function(){var t=this.options;this.tableRowHead=[],this._createTableData(),this._appendTableData(),t.isHeadSticky&&this.rebuildStickyHead()},_initHeadCount:function(){var t=this;this.headRowCount=1,FXM.Utils.forEach(t.header,function(e,i){if("subform"===i.type)return t.headRowCount=2,!1})},getSortedFieldIdx:function(t){var e=-1;return FXM.Utils.forEach(this.sort,function(i,a){if(a)return a[t]?(e=i,!1):void 0}),e},_getFieldTargetName:function(t){return t?t.tag||t.name:""},_createTableHead:function(){for(var e=this,i=(this.options,[]),a=0;a<this.headRowCount;a++)i.push([]);this.cols=[],this.fieldTypeMap={},FXM.Utils.forEach(e.header,function(a,n){if(n&&!n.detailOnly){var r,s=e._getFieldTargetName(n),o=t.extend({html:t("<pre/>").text(n.text).html(),cls:n.type+"-col",colspan:1},e._getFieldWidth(n)),l={field:s,type:n.type};n.cellFmt&&(r=n.cellFmt.data),l.format=r||n.format,n.regex&&(l.regex=n.regex);var c=e.getSortedFieldIdx(s),h=!1;if(~c)switch(e.sort[c][s]){case FXM.CONSTS.SORT.ASC:o.cls+=" sort sort-asc",h=!0,o.html+='<div class="sort-icon"><i class="icon-sort-asc"></i></div>';break;case FXM.CONSTS.SORT.DESC:o.cls+=" sort sort-desc",h=!0,o.html+='<div class="sort-icon"><i class="icon-sort-desc"></i></div>'}switch(e.fieldTypeMap[s]=n.type,n.type){case"image":case"upload":case"signature":case"address":case"location":case"user":case"usergroup":case"dept":case"deptgroup":case"id":case"did":case"combocheck":case"checkboxgroup":o.rowspan=e.headRowCount,o.data={field:s},i[0].push(o),e.cols.push(l);break;case"subform":if(!n.items)return;o.colspan=n.items.length,FXM.Utils.forEach(n.items,function(a,n){var r={field:s,type:n.type,subField:e._getFieldTargetName(n)};e.fieldTypeMap[r.field+"."+r.subField]=n.type;var o=t.extend({text:n.text,rowspan:e.headRowCount-1},e._getFieldWidth(n));o.rowspan=e.headRowCount-1;var l;n.cellFmt&&(l=n.cellFmt.data),"linkdata"===n.type&&(r.linkType=n.linkType),r.format=l||n.format,e.cols.push(r),i[1].push(o)}),n.items.length>0&&i[0].push(o);break;case"datetime":o.rowspan=e.headRowCount,o.data={field:s},o.cls+=" clickable sortable",h||(o.html+='<div class="sort-icon"><i class="icon-sort"></i></div>'),e.cols.push(l),i[0].push(o);break;case"chargers":e.cols.push({show:"node",field:l.field});var u={colspan:o.colspan,rowspan:e.headRowCount,data:{resizeCol:s},text:""};e.cols.push({show:"user",field:l.field});var d={colspan:o.colspan,rowspan:e.headRowCount,data:{resizeCol:s},text:""};i[0].push(u),i[0].push(d);break;default:"linkdata"===n.type&&(l.linkType=n.linkType),o.rowspan=e.headRowCount,o.data={field:s},"label"===n.name?o.cls+=" label-cell":o.cls+=" clickable sortable",h||"label"===s||(o.html+='<div class="sort-icon"><i class="icon-sort"></i></div>'),e.cols.push(l),i[0].push(o)}}}),this.tableHead=i},_getFieldWidth:function(t){var e={};switch(t.type){case"text":case"radiogroup":case"combo":e={minWidth:50,maxWidth:200};break;case"textarea":case"checkboxgroup":case"combocheck":e={minWidth:50,maxWidth:300};break;case"number":e={minWidth:50,maxWidth:150};break;case"datetime":var i=t.format.indexOf("HH")>-1;e.minWidth=i?120:80;break;case"address":case"location":e={minWidth:50,maxWidth:300};break;case"image":case"upload":case"signature":e={minWidth:50,maxWidth:100};break;default:e={minWidth:50,maxWidth:200}}return e},_createTableData:function(){var e=this,i=this.options;this.tableData=[],this.dataMap=[];var a=i.itemsPerPage*this.page,n=e.data.slice(a,a+i.itemsPerPage);FXM.Utils.forEach(n,function(i,n){i+=a;for(var r=[],s=e._calculateDataRowCount(n),o=0;o<s;o++)r.push([]);FXM.Utils.forEach(e.cols,function(i,a){var o=e._createCellData(n,a,!1);switch(t.extend(o,e._getFieldWidth(a)),e.fieldTypeMap[a.field]){case"subform":var l=n[a.field];FXM.Utils.isObjectEmpty(l)&&(l=[{}]);for(var c=0;c<s;c++){var h=l[c],u=e._createCellData(h,a,!0);r[c].push(u)}break;default:o.rowspan=s,r[0].push(o)}}),n&&FXM.Utils.forEach(r,function(){e.dataMap.push(i)}),e.tableData=e.tableData.concat(r)})},_calculateDataRowCount:function(t){var e=this,i=[1];for(FXM.Utils.forEach(t,function(t,a){a&&"subform"===e.fieldTypeMap[t]&&i.push(a.length||1)});i.length>=2;)i.push(Math.max(i.pop(),i.pop()));return i[0]},_createCellData:function(e,i,a){var n,r;if(FXM.Utils.isNull(e))return{text:""};switch(a?(n=e[i.subField],r=this.fieldTypeMap[i.field+"."+i.subField]):(n=e[i.field],r=this.fieldTypeMap[i.field]),r){case"checkboxgroup":case"combocheck":case"array":return{text:FXM.Utils.isNull(n)?"":n.join(", ")};case"text":if(i.regex&&new RegExp(i.regex).test(n)){var s=FXM.CONSTS.TEXT_TYPE_REGEXP;if(i.regex===s.email)return{html:'<a href="mailto:'+n+'">'+n+"</a>"};if(i.regex===s.mobile||i.regex===s.tel)return{html:'<a href="tel:'+n+'">'+n+"</a>"}}return!n||FXM.Utils.isString(n)?{html:t("<span />").append(FXM.Utils.replaceURL(n))}:{text:n.name||""};case"radiogroup":case"combo":case"string":case"id":case"did":return{text:FXM.Utils.isNull(n)?"":n};case"user":case"dept":return!n||FXM.Utils.isString(n)?{text:n||""}:{text:n.name||""};case"usergroup":case"deptgroup":var o=[];return FXM.Utils.forEach(n,function(t,e){!e||FXM.Utils.isString(e)?o.push(e||""):o.push(e.name)}),{text:o.join(",")};case"number":case"formula":var l=FXM.Utils.fixDecimalPrecision(n);return{text:FXM.Utils.num2Str(l,i.format)};case"address":case"location":var c=[];return n&&(n.province&&(c.push(n.province),n.city&&n.province!==n.city&&c.push(n.city),n.district&&c.push(n.district)),n.detail&&c.push(n.detail)),{text:FXM.Utils.address2Str(n,c.join(""),i.format)};case"textarea":return{html:n?t("<pre/>").append(FXM.Utils.replaceURL(n)):""};case"datetime":if(n)return{text:FXM.Utils.date2Str(new Date(n),i.format)};break;case"image":case"upload":case"signature":var h=t('<a class="table-op-btn table-file-btn"/>');return FXM.Utils.isObjectEmpty(n)?h.text(""):(h.text("").data("op","file"),h.data("file",n)),{html:h};case"linkdata":var u=n&&n.key;if(!u)break;return"datetime"===i.linkType&&(u=FXM.Utils.date2Str(new Date(u),"yyyy-MM-dd")),{text:u};case"flowState":var d=FXM.CONSTS.WORKFLOW.FLOWSTATE;switch(n){case d.INPROCESS:return{text:""};case d.COMPLETE:return{text:""};case d.CLOSE:return{text:""}}break;case"chargers":var p={},f={};FXM.Utils.forEach(n,function(t,e){e.flowName&&(p[e.flowName]||(p[e.flowName]=!0),f[e.userNickname]||(f[e.userNickname]=!0))});var m=[];return"node"===i.show?FXM.Utils.forEach(p,function(t){m.push(t)}):FXM.Utils.forEach(f,function(t){m.push(t)}),{text:m.join(",")}}return{text:""}},rebuildStickyHead:function(){var t=this.$stickyHead.attr("class");this.$stickyHead.remove(),this._createStickyHead(),this.$stickyHead.addClass(t)},_doShowReport:function(){this.element.closest(".x-report").show(),this.isHidden=!1},_doHideReport:function(){this.element.closest(".x-report").hide(),this.isHidden=!0},_updateTableData:function(e,i){var a=this.options;if(this.data[e]){var n={};FXM.Utils.forEach(a.fields,function(t,e){switch(e.type){case"user":case"dept":FXM.Utils.isObjectEmpty(i[e.name])?n[e.name]=i[e.name]:n[e.name]=i[e.name].name;break;case"usergroup":case"deptgroup":var a=[];FXM.Utils.forEach(i[e.name],function(t,e){a.push(e.name)}),n[e.name]=a;break;default:"creator"!==e.name||FXM.Utils.isObjectEmpty(i[e.name])?n[e.name]=i[e.name]:n[e.name]=i[e.name].name}}),t.extend(this.data[e],n)}},_doShowData:function(e){var i=this,a=this.options,n=this.data[e];if(n){var r=n._id,s=this.header,o=a.title;this.$mask=t('<div class="form-data"/>').appendTo("body"),this.needReload=this.needReload||!1,i._doHideReport(),FXM.Utils.isString(r)&&(FXM.STATIC.DATAID=r),this.formDataConfig={render:t("<div/>").appendTo(this.$mask),entryId:a.forms[0],formId:a.forms[0],authGroupId:a.authGroupId,header:s,data:n,dataId:r,title:o,hasEditBtn:a.itemEditable,hasDeleteBtn:a.itemRemovable,hasSwitchBtn:!0,dataIndex:e+1,dataCount:i.data.length,needFetchViewData:a.needFetchViewData,onClose:function(){i.$mask.remove(),i._doShowReport(),i.needReload&&(i._reloadData(),i.needReload=!1)},onSwitchData:function(t){i.data[t-1]&&i.$mask.parent().length&&(i.$mask.remove(),i._doShowData(t-1,!1))},onEditData:function(){i.$mask.remove(),i._doHideReport()},onAfterEditData:function(t){a.authGroupId?(i._updateTableData(e,t.data),i._doShowData(e),i.needReload=!0):(i._doShowReport(),i._reloadData())},onAfterCancel:function(){i._doShowData(e)},onAfterChange:function(){i.needReload=!0},onAfterDeleteData:function(){i.$mask.remove(),i._doShowReport(),i._reloadData()}},this.formData=i._createFormData()}},_createFormData:function(){var e=this.options;return e.isExternalLink?new FXM.ReportFormData(this.formDataConfig):e.isCoopManage?e.hasCoop?(t.extend(this.formDataConfig,{optAuth:e.optAuth}),new FXM.CoopFormData(this.formDataConfig)):(t.extend(this.formDataConfig,{hasLogViewBtn:e.hasLogView,flowAction:e.flowAction,optAuth:e.optAuth}),new FXM.FlowFormData(this.formDataConfig)):new FXM.ReportFormData(this.formDataConfig)},_setEvent:function(){FXM.DataTable._super._setEvent.apply(this,arguments);var e=this,i=this.options;this.$wrapper.unbind(".data-table"),this.$wrapper.bind({"click.data-table":function(a){var n=a.target,r=a.type,s=t(n).closest("tr");if(s&&s.length>0)if(i.isFieldSortable&&s.hasClass("th-row")){var o=t(n).closest(".th-cell");if(o&&o.length>0){if(!o.hasClass("sortable"))return;if("click"===r){var l=o.data("field");if(l){var c={},h=-1;o.hasClass("sort-asc")?(o.removeClass("sort-asc").addClass("sort-desc"),c[l]=-1,~(h=e.getSortedFieldIdx(l))?e.sort[h]=c:e.sort.push(c)):o.hasClass("sort-desc")?(o.removeClass("sort sort-desc"),~(h=e.getSortedFieldIdx(l))&&e.sort.splice(h,1)):(o.removeClass("sort-desc").addClass("sort sort-asc"),h=e.getSortedFieldIdx(l),c[l]=1,~h?e.sort[h]=c:e.sort.push(c)),e._reloadData()}}}}else if(s.hasClass("tb-row")){var u=t(n).closest(".table-op-btn");if("click"===r)if(u&&u.length>0){var d=u.data("op");if(!i.forms)return;if("file"===d){var p=u.data("file");new FXM.FilePreview({files:FXM.Utils.makeArray(p)})}}else{if(!FXM.Utils.isEmpty(FXM.Utils.getSelectionText()))return;var f=t(n).closest(".nest-link");if(f.length){var m=f.attr("data-url");return void(m&&FXM.Utils.openLink(m))}e._doShowData(s.data("idx"))}}}})},_bindRowData:function(t,e,i){this.dataMap&&this.dataMap.length>i&&e.data("idx",this.dataMap[i])},_reloadData:function(t){FXM.DataTable._super._reloadData.apply(this,arguments),this._initDataTable(t)},loadMore:function(t){var e=this;!this.hasMore()||this.isLoading||this.isHidden||(e.page++,this._loadData(function(){e.appendData(),t&&t()}))},hasMore:function(){return this.options.itemsPerPage<=this.count},setFields:function(t){this.options.fields=t,this._reloadData()},getCoopFilterData:function(){var t=this.options;return FXM.Utils.applyFunc(this,t.onDataFilter,[],{})||{}}}),FXM.register("datatable",FXM.DataTable)}(Zepto),function(t){FXM.CombinedTable=FXM.extend(FXM.Table,{GROUP_DICT:{year:"",month:"",day:"",province:"",city:""},GROUP_TYPE:["address","location","datetime"],_defaults:function(){return t.extend(FXM.CombinedTable._super._defaults.apply(),{baseCls:"x-combinedtable",isHeadSticky:!0,chunkSize:50,forms:[],relations:{},joinedFields:[],xFields:[],yFields:[],valueFields:[],asyncURL:FXM.Utils.getApi(FXM.API.data.combined_group),onItemClick:null})},_init:function(){FXM.DataTable._super._init.apply(this,arguments),this._initCombinedTable()},_initCombinedTable:function(){var t=this,e=this.options;this.tableHead=[],this.tableRowHead=[],this.tableData=[],this.rowCount=0,this._isFieldsValid()?(this.xGroups=this._makeGroups(e.xFields),this.yGroups=this._makeGroups(e.yFields),this.loadingAjax({url:e.asyncURL,data:{widgetId:e.widgetName,linkWidgets:e.linkWidgets,filter:this.getFilterData()}},function(e){if(t.page=1,t._isTableEmpty(e)){var i=!FXM.Utils.isObjectEmpty(t.getFilterData())?"":"";FXM.UI.createEmptyTip({msg:i}).appendTo(t.$body)}else t._dealTableInfo(e),t.rowCount=t.tableData.length,t._chunkTable();t.createTable()})):this.createTable()},_isTableEmpty:function(t){return 0===t.data.x.length&&0===t.data.val.length},_dealTableInfo:function(t){var e=this.options;this.tableHead=[],this.tableRowHead=[],this.tableData=[],this.colDataArr=[],this.rowDataArr=[],this.rowHeadTitleRows=this._hasSubGroup(e.xFields)?2:1;var i=this._hasSubGroup(e.yFields)?2:1;this.xGroupLen=this._getXGroupLength(),this.rowHeadTitleCols=Math.max(i,this.xGroupLen);for(var a=this.yGroups.length+this.rowHeadTitleRows,n=0;n<a;n++)this.tableHead.push([]);this._createColHeadTitle(),this._createRowHeadTitle(),this._createRowHead(t),this._dealDetail(t),this._createColHeadAndData(t)},_getXGroupLength:function(){var t=this.xGroups.length;return FXM.Utils.forEach(this.xGroups,function(e,i){i.detail&&(t+=i.detail.fields.length)}),t},_chunkTable:function(){var e=this,i=this.options;this.rowHeadChunks=[],FXM.Utils.forEach(this.tableRowHead,function(a,n){var r=null,s=FXM.Utils.chunkArray(n,i.chunkSize);FXM.Utils.forEach(s,function(i,a){r&&r.rowspan&&(a[0]=r);for(var n=a.length-1;n>=0;n--){var s=a[n];if(s){s.rowspan>=a.length-n&&(r=t.extend({},s),s.rowspan=a.length-n,r.rowspan-=s.rowspan);break}}e.rowHeadChunks[i]=e.rowHeadChunks[i]||[],e.rowHeadChunks[i].push(a)})}),this.dataChunks=FXM.Utils.chunkArray(this.tableData,i.chunkSize);var a=this._getPageData();this.tableHead=a.tableHead,this.tableRowHead=a.tableRowHead,this.tableData=a.tableData},_getPageData:function(){return{tableHead:this.tableHead,tableRowHead:this.rowHeadChunks[this.page-1],tableData:this.dataChunks[this.page-1]}},_hasSubGroup:function(t){var e=this,i=!1;return FXM.Utils.forEach(t,function(t,a){if(e.GROUP_TYPE.indexOf(a.type)>-1)return i=!0,!1}),i},_createColHeadTitle:function(){var t,e=this;this.options;FXM.Utils.forEach(this.yGroups,function(i,a){var n=e.tableHead[i];e.GROUP_TYPE.indexOf(a.type)>-1?(t&&t.text===a.text?t.rowspan+=1:(t={rowspan:1,colspan:e.rowHeadTitleCols-1,text:a.text,cls:"group-head"},n.push(t)),n.push({text:e.GROUP_DICT[a.groupBy],cls:"group-head"})):n.push({rowspan:1,colspan:e.rowHeadTitleCols,text:a.text,cls:"group-head"})})},_createRowHeadTitle:function(){var t,e=this,i=(this.options,this.tableHead[e.yGroups.length]),a=this.tableHead[e.yGroups.length+1],n=1;this.xGroupLen<this.rowHeadTitleCols&&(n=this.rowHeadTitleCols),this.xGroups.length||i.push({colspan:this.rowHeadTitleCols,cls:"group-head"}),FXM.Utils.forEach(this.xGroups,function(r,s){e.GROUP_TYPE.indexOf(s.type)>-1?(t&&t.text===s.text?t.colspan+=1:(t={rowspan:1,colspan:n,text:s.text,cls:"group-head"},i.push(t)),a.push({rowspan:1,colspan:n,text:e.GROUP_DICT[s.groupBy],cls:"group-head"})):(i.push({rowspan:e.rowHeadTitleRows,colspan:n,text:s.text,cls:"group-head"}),s.detail&&FXM.Utils.forEach(s.detail.fields,function(t,a){i.push({rowspan:e.rowHeadTitleCols,colspan:n,text:a.text,cls:"group-head"})}))})},_createColHeadAndData:function(t){for(var e=this,i=(this.options,t.data.val),a=i[0].data.length,n=this.tableHead,r=this.tableData,s=0;s<a;s++)r.push([]);var o=[];r.push(o);var l=null;FXM.Utils.forEach(i,function(a,s){s.is_summary_col&&e.yGroups.length&&(l?l.colspan+=1:(l={text:"",rowspan:e.yGroups.length,colspan:1},n[0].push(l)));var c=!0;FXM.Utils.forEach(s.y,function(r,o){var l=e._getLastCell(n[r]);(c=0!==a&&(c&&i[a-1].y[r]===o))?l.colspan+=1:n[r].push({colspan:1,text:e._getGroupText(o,e.yGroups[r],t),data:{id:e._getColHeadCellData(s.y,r)},cls:"clickable"})}),n[e.yGroups.length].push({rowspan:e.rowHeadTitleRows,text:s.text}),FXM.Utils.forEach(s.data,function(i,n){var o={};o=FXM.Utils.isNull(n)?{text:"-",cls:"h-center"}:{field:e._getFieldTag(s),isPercent:s.isPercent,text:n,cls:"h-right clickable",data:{id:e._getCellData(t,i,a)}},r[i].push(o)}),o.push({field:s.tag,text:s.sum,isPercent:s.isPercent,cls:"h-right clickable",data:{id:e._getColHeadCellData(s.y,s.y.length-1)}})})},_getFieldTag:function(t){var e=t.tag||t.name;return t.isPercent&&(e+="_percent"),e},_getColHeadCellData:function(t,e){for(var i={},a=0;a<=e;a++){var n=this.yGroups[a];i[n.groupName||n.tag]=t[a]}return i},_getRowHeadCellData:function(t,e,i){for(var a={},n=0;n<=i;n++){var r=this.xGroups[n];a[r.groupName||r.tag||r.name]=t[n].data[e]}return a},_getCellData:function(e,i,a){var n=this.colDataArr[a],r=this.rowDataArr[i];return n||(n=this._getColHeadCellData(e.data.val[a].y,this.yGroups.length-1),this.colDataArr[a]=n),r||(r=this._getRowHeadCellData(e.data.x,i,this.xGroups.length-1),this.rowDataArr[i]=r),t.extend({},r,n)},_createRowHead:function(t){var e=this,i=(this.options,t.data.x),a=this.tableRowHead;if(i.length)for(var n=0;n<i.length;n++)a.push([]);else a.push([]);FXM.Utils.forEach(i,function(n,r){var s=null;FXM.Utils.forEach(r.data,function(o,l){var c=!1;if(o>0&&(c=r.data[o-1]===l,n>0&&(c=c&&FXM.Utils.isNull(a[n-1][o]))),c)s.rowspan+=1,a[n].push(null);else{var h=1;e.xGroupLen<e.rowHeadTitleCols&&(h=e.rowHeadTitleCols),s={colspan:h,rowspan:1,text:e._getGroupText(l,e.xGroups[n],t),data:{id:e._getRowHeadCellData(i,o,n)},cls:"clickable"},a[n].push(s)}})}),a[0].push({text:"",colspan:this.rowHeadTitleCols})},_dealDetail:function(e){var i=this,a=(this.options,0);FXM.Utils.forEach(this.xGroups,function(n,r){var s=r.detail;if(!s)return!1;var o=n+a;FXM.Utils.forEach(s.fields,function(r,l){var c=e.details[s.entry],h=[];FXM.Utils.forEach(i.tableRowHead[o],function(e,i){var a=null;i&&c[i.text]&&(a=t.extend({},i,{text:c[i.text][l.name]})),h.push(a)}),a++,i.tableRowHead.splice(n+a,0,h)})})},_getGroupText:function(t,e,i){var a=t;switch(e.type){case"user":case"id":var n=i.user[t];a=n?n.nickname:t;break;case"dept":case"did":var r=i.department[t];a=r?r.name:t}return a},_getLastCell:function(t){return t.length?t[t.length-1]:null},loadMore:function(e){if(this.hasMore()&&!this.isLoading){this.page++,t.extend(this,this._getPageData()),this.appendData();var i=document.documentElement.scrollTop||document.body.scrollTop;this.$table&&i+t(window).height()>this.$table.height()-100?this.loadMore(e):e&&e()}},hasMore:function(){var t=this.options;return this.page*t.chunkSize<this.rowCount},appendData:function(){var t=this.options;this._appendTableData(),t.isHeadSticky&&this.rebuildStickyHead()},_isFieldsValid:function(){var t=this.options,e=!0;return e&=t.forms.length>0,e&=0!==t.valueFields.length,!!(e&=0!==t.xFields.length||0!==t.yFields.length)},_setEvent:function(){FXM.CombinedTable._super._setEvent.apply(this,arguments);var e=this,i=this.options;this.$wrapper.off(".combined-table"),this.$wrapper.on("click.combined-table",".t-cell",function(a){var n=t(a.currentTarget).data("id");if(n){var r=e._getGroupIdCondition(n),s=e._getLinkParams(r);s=e._getLinkFilterParams(s),FXM.Utils.applyFunc(e,i.onItemClick,[s],!1)}})},_getGroupIdCondition:function(t){var e={};return FXM.Utils.forEach(t,function(t,i){var a=t,n=t.match(/(createTime|updateTime|\d{13})_([a-zA-Z]+)/);if(n&&n.length>1){var r=n[n.length-1];a=t.replace("_"+r,""),e[a]||(e[a]={}),e[a][r]=i}else e[a]=i}),e},_getLinkParams:function(e){var i=this;if(e){var a=[];return FXM.Utils.forEach(e,function(n){var r=i._getFieldByName(n),s=e[n];switch(r.type){case"datetime":s=FXM.Utils.getDateRange(s);break;case"address":case"location":s=FXM.Utils.getArrayFromRange(s,"address")}a.push(t.extend(FXM.Utils.getLinkFilter(r,s),{field:r.name}))}),a}},_getFieldByName:function(t){var e=this.options,i=[].concat(e.xFields,e.yFields),a=null;return FXM.Utils.forEach(i,function(e,i){if((i.tag||i.name)===t)return a=i,!1}),a},_reloadData:function(){FXM.CombinedTable._super._reloadData.apply(this,arguments),this._initCombinedTable()},_appendTableData:function(){var t=this,e=this.options;this.formatMap={},FXM.Utils.forEach(e.valueFields,function(e,i){i.cellFmt&&!i.isPercent&&(t.formatMap[t._getFieldTag(i)]=i.cellFmt.data)}),FXM.CombinedTable._super._appendTableData.apply(this,arguments)},_formatCell:function(e){var i=t.extend({},e),a=i.field;a&&(a=a.replace("%","."));var n=this.formatMap[a];if(!e.isPercent){var r=FXM.Utils.fixDecimalPrecision(e.text);i.text=FXM.Utils.num2Str(r,n)||"-"}return i}}),FXM.register("combinedtable",FXM.CombinedTable)}(Zepto),function(t){FXM.DataCoop=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.DataCoop._super._defaults.apply(this,arguments),{baseCls:"x-datacoop",fields:[],hasCoop:!1,hasExtParams:!1,appid:null,formid:null,groupid:null,onDataFilter:null})},_init:function(){FXM.DataCoop._super._init.apply(this,arguments);var e=this,i=this.options;this._createEntryAttr(),this._createField(),t(this.element).addClass("x-report"),this.dataTable=new FXM.DataTable({render:t("<div />").appendTo(e.element),entryId:i.formid,optAuth:i.optAuth,itemEditable:!1!==i.dataPerms.update,itemRemovable:!1!==i.dataPerms.delete,flowAction:{flowActivate:!!i.dataPerms.flow_activate,flowClose:!!i.dataPerms.flow_close,flowTransfer:!!i.dataPerms.flow_transfer,flowUpdate:!!i.dataPerms.flow_update},hasLogView:i.hasLogView,width:"100%",visible4Title:!1,fields:FXM.Utils.getShowFieldsByNames(e.showFields,e.disSelectFields),forms:[i.formid],authGroupId:i.groupid,hasCoop:i.hasCoop,isCoopManage:!0,entryType:"form",needFetchViewData:!0,onDataFilter:function(){return FXM.Utils.applyFunc(e,i.onDataFilter,[],!1)||null}}),i.dataPerms.create&&t('<div class="btn-add"/>').append(t('<i class="icon-plus"/>')).on("click",function(){if(FXM.Vip.isDataCreateLimit())return FXM.UI.alert({msg:FXM.CONSTS.DATA_LIMIT_TIP.ACCOUNT,buttonName:""}),!1;FXM.Utils.applyFunc(e,i.onDataCreate,[],!1)}).appendTo(this.element),this._bindScrollEvents()},_bindScrollEvents:function(){var e=this;t(window).scroll(function(){var i=document.documentElement.scrollTop||document.body.scrollTop;e.dataTable.$table&&i+t(this).height()>e.dataTable.$table.height()-100&&e.dataTable.loadMore()})},_createEntryAttr:function(){var t=this,e=this.options,i=["creator","createTime","updateTime"];e.hasExtParams&&i.push("ext"),e.hasCoop||i.push("flowState","chargers"),this.attrFields=[],FXM.Utils.forEach(i,function(i,a){var n=e.optAuth[a];if(n&&n.visible){var r=FXM.Utils.createEntryAttributeField(a,{id:e.formid});r&&t.attrFields.push(r)}})},_createField:function(){var e=this,i=this.options,a=[],n=[];this.showFieldKey=FXM.Store.getKey("showFields",{appId:i.appid,entryId:i.formid,groupId:i.groupid}),this.disSelectFields=FXM.Store.get(this.showFieldKey)||[],FXM.Utils.forEach(i.fields,function(e,r){var s=t.extend(!0,{},r);s.formId=i.formid;var o=FXM.Utils.getFieldAttr(s,FXM.CONSTS.LIMIT_FIELDS.list);o&&(a.push(o),FXM.CONSTS.LIMIT_FIELDS.filter.indexOf(o.type)>-1&&n.push(o))}),a.unshift(FXM.Utils.createEntryAttributeField("label",{id:i.formid})),this.showFields=a.concat(this.attrFields),this.paramFields=[],FXM.Utils.forEach(n.concat(this.attrFields),function(i,a){"subform"===a.type?FXM.Utils.forEach(a.items,function(i,n){FXM.CONSTS.LIMIT_FIELDS.filter.indexOf(n.type)>-1&&e.paramFields.push(t.extend({},n,{name:[a.name,n.name].join("."),text:[a.text,n.text].join(".")}))}):FXM.CONSTS.LIMIT_FIELDS.filter.indexOf(a.type)>-1&&e.paramFields.push(a)}),i.hasCoop||(this.paramFields.push({id:i.formid,name:"flowstate",type:"flowstate",text:""}),this.paramFields.push({id:i.formid,name:"flownode",type:"flownode",text:""})),FXM.Utils.isObjectEmpty(this.disSelectFields)&&FXM.Utils.forEach(this.showFields,function(t,i){"subform"===i.type?FXM.Utils.forEach(i.items,function(t,a){e.disSelectFields.push([i.name,a.name].join("."))}):e.disSelectFields.push(i.name)});var r=[];FXM.Utils.forEach(this.showFields,function(t,i){var a={text:i.text,value:i.name};a.selected=e.disSelectFields.indexOf(a.value)>-1,"subform"===i.type?FXM.Utils.forEach(i.items,function(t,a){var n={value:[i.name,a.name].join("."),text:[i.text,a.text].join(".")};n.selected=e.disSelectFields.indexOf(n.value)>-1,r.push(n)}):r.push(a)}),this.showItems=r},setShowFields:function(t){this.disSelectFields=t,this.dataTable.setFields(FXM.Utils.getShowFieldsByNames(this.showFields,this.disSelectFields)),FXM.Store.set(this.showFieldKey,this.disSelectFields)},getShowItems:function(){return this.showItems||[]},getParamFields:function(){return this.paramFields},reload:function(t){this.dataTable.reload(t)}}),FXM.register("datacoop",FXM.DataCoop)}(Zepto),FXM.DataCombocheck=FXM.extend(FXM.Widget,{_defaults:function(){return $.extend(FXM.DataCombocheck._super._defaults.apply(),{baseCls:"x-datacombocheck",items:[],onStopEdit:null,emptyTip:"",title:""})},_init:function(){FXM.DataCombocheck._super._init.apply(this,arguments),this.value=[],this.text=[];var t=this;this.options.items.map(function(e){e.selected&&(t.value.push(e.value),t.text.push(e.vtext))}),$(this.element).on("click",function(){t.isEnabled()&&t._createComboView()})},_createComboView:function(){var t=this,e=this.options,i=$('<div class="combo-list"/>');this._createItemList(i),this._bindViewEvts(i);var a=$('<div class="combo-content"/>').append($('<div class="combo-title"/>').text(e.title)).append(i);new FXM.SlidePanel({customCls:"x-combo-picker combo-show-fields",content:a,text4Left:null,onRightClick:function(){FXM.Utils.applyFunc(t,e.onStopEdit,[t.getValue()],!1),this.close()}}).show()},_createItemList:function(t){var e=this.options,i=this;if(0!==e.items.length){var a=$('<div class="x-select-item selectAll "/>').append($('<div class="item-checkbox"/>')).append($('<div class="item-text"/>').text("")).appendTo(t);e.items.map(function(e){var a=e.value,n=e.text,r="";i.value.indexOf(a)>-1&&(r+="select"),$('<div class="x-select-item"/>').addClass(r).data("value",a).append($('<div class="item-checkbox"/>')).append($('<div class="item-text"/>').text(n)).appendTo(t)}),t.children().not(".select").length<=1&&a.addClass("select")}else this._createEmptyTip(t)},_bindViewEvts:function(t){var e=this;t.on("click",".x-select-item",function(i){var a=$(i.currentTarget),n=a.hasClass("select"),r=$(".selectAll",t);if(a.hasClass("selectAll")){var s=$(".x-select-item",t);e.text=[],e.value=[],n?s.removeClass("select"):(FXM.Utils.forEach(s,function(t,i){$(i).hasClass("selectAll")||(e.value.push($(i).data("value")),e.text.push($(i).children(".item-text").text()))}),s.addClass("select"))}else n?(a.removeClass("select"),FXM.Utils.removeArray(e.value,a.data("value")),FXM.Utils.removeArray(e.text,a.children(".item-text").text()),r&&r.removeClass("select")):(a.addClass("select"),e.text.push(a.children(".item-text").text()),e.value.push(a.data("value")),t.children().not(".select").length<=1&&r&&r.addClass("select"))})},_createEmptyTip:function(t){var e=this.options;e.emptyTip&&$('<div class="empty-info"/>').text(e.emptyTip).appendTo(t),e.emptySubTip&&$('<div class="empty-sub-info"/>').text(e.emptySubTip).appendTo(t)},setItems:function(t){FXM.Utils.isArray(t)&&(this.options.items=t.slice(0))},getValue:function(){return this.value}}),FXM.register("datacombocheck",FXM.DataCombocheck),function(t){FXM.FlowData=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.FlowData._super._defaults.apply(),{baseCls:"x-flowdata",formId:null,hasLogView:!1,flowAction:{flowActivate:!1,flowClose:!1,flowTransfer:!1},nodeType:["done","doing","undone"],onAfterCancel:null,onAfterFlowChange:null})},_init:function(){FXM.FlowData._super._init.apply(this,arguments),this.formMap={},this.viewState={doTransfer:!1,doActiveNode:!1}},getChargeNodes:function(){return this.chargeNodes},getTransactNodes:function(){return this.transactNodes},getChargersMap:function(){return this.chargersMap},_createFooter:function(e){var i=t('<div class="page-form-footer"></div>');return FXM.Utils.forEach(e,function(e,a){var n=t('<div class="footer-btn" action="'+e+'">'+a.text+"</div>").appendTo(i);a.style&&n.addClass("style-"+a.style)}),i.on("click",".footer-btn",function(i){var a=t(i.currentTarget).attr("action");e[a].onClick&&e[a].onClick()}),i},_createFlowState:function(t,e){var i=this;this.flowLogs?this._createFlowChart(e):this._getFlowLogs(function(t){i.flowLogs=t,i._createFlowChart(e)})},_createFlowChart:function(e){var i=this.options,a=this.formMap.data,n=this._getFlowNodes(a);new FXM.FlowChartView({render:t("<div />").appendTo(e),appId:a.appId,entryId:a.entryId,flow:a,passNodes:n.passNodes,currentNodes:n.currentNodes,flowState:a.flowState,flowVer:a.flowVer,authGroupId:i.authGroupId})},_getFlowNodes:function(t){if(t){var e=t.chargers,i=[];FXM.Utils.forEach(e,function(t,e){i.push(e.flowId)});var a=t.transactors,n=[];return FXM.Utils.forEach(a,function(t,e){n.push(e.flowId)}),{passNodes:n,currentNodes:i}}},_handleCloseFlow:function(){var t=this,e=this.options;FXM.UI.confirm("",function(){t._doFlowChange({flowAction:"close",dataId:e.dataId},function(i){t.formMap={},FXM.UI.indicator("",function(){FXM.Utils.applyFunc(t,e.onAfterFlowChange,[i.data],!1)})})})},closeFlow:function(t){var e=this;this.options;FXM.Utils.isObjectEmpty(this.formMap)?this._getFormData(t,function(){FXM.Utils.applyFunc(e,e._handleCloseFlow,[],!1)}):e._handleCloseFlow()},_handleActiveFlow:function(){var t=this,e=this.options;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.allow_activate_nodes),data:{dataId:this.formMap.data._id,authGroupId:this.formMap.authGroupId}},function(i){t.transactNodes=[],FXM.Utils.forEach(i.flowNodes,function(e,i){t.transactNodes.push({value:i.flowId,text:i.name})}),t._doActiveFlow(t.formMap.data,function(i){t._doFlowChange({flowAction:"activate",flowId:i},function(i){FXM.UI.indicator("",function(){FXM.Utils.applyFunc(t,e.onAfterFlowChange,[i.data],!1)}),t.viewState.doActiveNode=!1,t.formMap={}})})})},activeFlow:function(t){var e=this;this.options;FXM.Utils.isObjectEmpty(this.formMap)?this._getFormData(t,function(){FXM.Utils.applyFunc(e,e._handleActiveFlow,[],!1)}):e._handleActiveFlow()},_handleChangeCharger:function(){var t=this,e=this.options;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.flow_chargers),data:{dataId:this.formMap.data._id,authGroupId:this.formMap.authGroupId}},function(i){t.chargeNodes=[],t.chargersMap={},FXM.Utils.forEach(i.flowNodes,function(e,i){t.chargeNodes.push({value:i.flowId,text:i.name}),t.chargersMap[i.flowId]=i.chargers}),t._doChangeCharger(t.formMap.data,function(i){t._doFlowChange({flowAction:"transfer",flowId:i.currentNode,chargers:{users:i.chargers}},function(i){FXM.UI.indicator("",function(){FXM.Utils.applyFunc(t,e.onAfterFlowChange,[i.data],!1)}),t.viewState.doTransfer=!1,t.formMap={}})})})},transferFlow:function(t){var e=this;this.options;FXM.Utils.isObjectEmpty(this.formMap)?this._getFormData(t,function(){FXM.Utils.applyFunc(e,e._handleChangeCharger,[],!1)}):e._handleChangeCharger()},_doFlowChange:function(t,e){t.authGroupId=this.options.authGroupId,FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.flow_change),data:t},function(t){e&&e(t)})},_doChangeCharger:function(e,i){if(e&&!this.viewState.doTransfer){this.viewState.doTransfer=!0;var a=this.options,n=this;this.$content=t('<div class="page-form-content"/>').appendTo("body"),this.$content.append('<div class="form-tip"></div><div class="form-label"></div>');var r=this.getChargeNodes(),s=this.getChargersMap(),o=new FXM.Combo({render:t("<div />").appendTo(this.$content),allowBack:!1,items:r,onStopEdit:function(){(l=this.getValue())&&c.rebuild(s[l])}}),l=o.getValue();this.$content.append('<div class="form-label"></div>');var c=new FXM.UserGroup({render:t("<div />").appendTo(this.$content),value:s[l]});FXM.Utils.isObjectEmpty(r)||(o.setValue(r[0].value),o.setText(r[0].text),l=o.getValue(),c.rebuild(s[l]));var h={cancel:{text:"",style:"grey",onClick:function(){n.viewState.doTransfer=!1,n.$content&&n.$content.remove(),FXM.Utils.applyFunc(n,a.onAfterCancel,[],!1)}},select:{text:"",onClick:function(){var t=c.getValue();FXM.Utils.isEmpty(l)?FXM.UI.toast({msg:"",type:"warning"}):n._isUserSame(s[l],t)?FXM.UI.toast({msg:"",type:"warning"}):FXM.Utils.isObjectEmpty(t)?FXM.UI.toast({msg:"",type:"warning"}):(i&&i({currentNode:l,chargers:t}),n.$content&&n.$content.remove())}}};this.$content.append(this._createFooter(h))}},_isUserSame:function(t,e){return t.length===e.length&&t.every(function(t){return e.some(function(e){return t._id===e})})},_getFormData:function(e,i){var a=this,n=this.options;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.read),data:{formId:n.formId,dataId:e,authGroupId:n.authGroupId}},function(e){t.extend(a.formMap,e),i&&i()})},_getFlowLogs:function(t){var e=this.options;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.log_flow),data:{authGroupId:e.authGroupId}},function(e){t&&t(e.logs)})},_showApproval:function(e,i){if(e){var a=this.options,n=this.formMap.data;new FXM.FlowApproval({render:t("<div/>").appendTo(i),appId:n.appId,entryId:n.entryId,version:n.flowVer,dataId:e,authGroupId:a.authGroupId})}},_doActiveFlow:function(t,e){this.options;var i=this;t&&!this.viewState.doActiveNode&&new FXM.ComboSlider({text4Right:"",title:"",items:i.getTransactNodes(),onOk:function(){var t=this.getValue();this.close(),i.viewState.doActiveNode=!0,e&&e(t)}}).show()},approval:function(t,e){this.options;var i=this;t&&(FXM.Utils.isObjectEmpty(this.formMap)?this._getFormData(t,function(){i._showApproval(t,e)}):this._showApproval(t,e))},showFlowState:function(t,e,i){var a=this;this.options;t&&(FXM.Utils.isObjectEmpty(this.formMap)?this._getFormData(t,function(){a._createFlowState(e,i)}):this._createFlowState(e,i))}})}(Zepto),function(t){FXM.DataComment=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.DataComment._super._defaults.apply(this,arguments),{baseCls:"x-data-comment",perPage:20,dataId:null})},_init:function(){FXM.DataComment._super._init.apply(this,arguments),this.pageNow=1,this.count=0,this.$main=t('<div class="main-content"/>').appendTo(this.element),this._fetch()},_fetch:function(e){var i=this,a=this.options;FXM.UI.showLoader();var n=t.extend({skip:(this.pageNow-1)*a.perPage,limit:a.perPage,dataId:a.dataId,authGroupId:a.authGroupId},e);FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.comment_list),data:n},function(t){t.logs&&t.logs.length>0?(i.count+=t.logs.length,i._render(t)):i._renderEmpty(),i.couldLoad=!0},null,function(){FXM.UI.closeLoader()})},_render:function(t){var e=this,i=this.options;FXM.Utils.forEach(t.logs,function(t,i){e._renderItem(i)}),t.logs.length===i.perPage?this._renderLoadMore():this._removeLoadMore()},_renderEmpty:function(){0===this.count&&t('<div class="empty-box"><div class="box-content"></div><div class="box-text"></div></div>').appendTo(this.element)},_renderLoadMore:function(){var e=this,i=t(".load-more-btn",this.element);i&&i.length||(this.couldLoad=!0,t('<div class="load-more-btn"></div>').on("click",function(){e.couldLoad&&(e.couldLoad=!1,e.pageNow++,e._fetch())}).appendTo(this.element))},_removeLoadMore:function(){t(".load-more-btn",this.element).remove()},_renderItem:function(e){if(e){e.operator=e.operator||"";var i=t('<div class="comment-item"/>').appendTo(this.$main),a=FXM.Utils.formatUserThumb(e.operator);a&&t('<div class="content-thumb  color-'+a.color+'"/>').text(a.name).appendTo(i);var n=e.mentioned.users,r=e.comment,s="";FXM.Utils.forEach(n,function(t,e){var i=FXM.Utils.escapeHtmlSpecialChar(e.nickname);s+='<span class="item-style-green">@'+i+"</span>"});var o=t('<div class="item-content"><div class="content-main"></div></div>').appendTo(i);t('<div class="main-info"/>').text(r).appendTo(t(".content-main",o));var l=t('<div class="main-title"/>').append(t("<span/>").text(e.operator)).append(s).append(t('<div class="sub"/>').text(FXM.Utils.format2ThumbDate(e.createTime))).prependTo(t(".content-main",o));l.css("padding-right",t(".sub",l).outerWidth(!0))}},refresh:function(){var e=this.options;this.element.empty(),this.count=0,this.$main=t('<div class="main-content"/>').appendTo(this.element),this._fetch({skip:0,limit:this.pageNow*e.perPage})}})}(Zepto),function(t){FXM.DataDynamic=FXM.extend(FXM.Widget,{CONST:{TYPE:{create:"",update:"",remove:"",recover:""}},_defaults:function(){return t.extend(FXM.DataDynamic._super._defaults.apply(this,arguments),{baseCls:"x-data-dynamic",perPage:20,dataId:null,authGroupId:null})},_init:function(){FXM.DataDynamic._super._init.apply(this,arguments),this.pageNow=1,this.count=0,this.$main=t('<div class="main-content"/>').appendTo(this.element),this._fetch()},_fetch:function(){var t=this,e=this.options;FXM.UI.showLoader();var i={skip:(this.pageNow-1)*e.perPage,limit:e.perPage,dataId:e.dataId,authGroupId:e.authGroupId};FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.coop_log_list),data:i},function(e){e.logs&&e.logs.length>0?(t.count+=e.logs.length,t._render(e)):t._renderEmpty(),t.couldLoad=!0},null,function(){FXM.UI.closeLoader()})},_render:function(t){var e=this,i=this.options;FXM.Utils.forEach(t.logs,function(t,i){e._createItem(i)}),t.logs.length===i.perPage?this._renderLoadMore():this._removeLoadMore()},_renderEmpty:function(){0===this.count&&t('<div class="empty-box"><div class="box-content"></div><div class="box-text"></div></div>').appendTo(this.element)},_renderLoadMore:function(){var e=this,i=t(".load-more-btn",this.element);i&&i.length||(this.couldLoad=!0,t('<div class="load-more-btn"></div>').on("click",function(){e.couldLoad&&(e.couldLoad=!1,e.pageNow++,e._fetch())}).appendTo(this.element))},_removeLoadMore:function(){t(".load-more-btn",this.element).remove()},_createItem:function(e){e.operator=e.operator||"";var i=FXM.Utils.formatUserThumb(e.operator),a=t('<div class="comment-item"/>').appendTo(this.$main);i&&t('<div class="content-thumb color-'+i.color+'"/>').text(i.name).appendTo(a);var n;n="update"===e.op?this._formatFormData(e):[e.data_label||""];var r=t('<div class="item-content"/>').append(t('<div class="content-main"/>').append(t('<div class="main-title"/>').append(t('<span class="sub-info"/>').text(e.operator)).append(t('<span class="sub-info darken"/>').text(this.CONST.TYPE[e.op]||"")).append(t('<div class="sub-text"/>').text(FXM.Utils.format2ThumbDate(e.createTime))))).appendTo(a),s=t('<div class="main-info"/>').appendTo(r);return FXM.Utils.forEach(n,function(e,i){t('<div class="info-line"/>').text(i).appendTo(s)}),t(".main-title",a).css("padding-right",t(".sub-text",a).outerWidth(!0)),a},_formatFormData:function(t){var e=[];return FXM.Utils.forEach(t.diff,function(t,i){var a=i.cellFmt&&i.cellFmt.data||i.format,n=i.value,r="";switch(i.type){case"subform":break;case"datetime":(a=a||"yyyy-MM-dd")&&n&&(r=FXM.Utils.date2Str(new Date(n),a));break;case"address":a=a||"pcda",r=FXM.Utils.address2Str(n,"",a);break;case"location":a=a||"pcda",r=FXM.Utils.address2Str(n,"",a)+FXM.Utils.getLnglatText(n);break;case"number":a=a||"",r=FXM.Utils.num2Str(n,a);break;case"checkboxgroup":case"combocheck":r=n.join(",");break;case"upload":case"image":var s=[];FXM.Utils.forEach(n,function(t,e){s.push(e.name)}),r=s.join(",");break;case"signature":break;case"user":case"dept":r=n&&n.name;break;case"usergroup":case"deptgroup":var o=[];FXM.Utils.forEach(n,function(t,e){o.push(e.name)}),r=o.join(",");break;case"linkdata":r=n&&n.key;break;default:r=n}var l=[i.label];"subform"!==i.type&&"signature"!==i.type&&l.push(FXM.Utils.isEmpty(r)?"":r),e.push(l.join(""))}),e}})}(Zepto),function(t){FXM.DataSwitch=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.DataSwitch._super._defaults.apply(this,arguments),{baseCls:"x-dataswitch",dataCount:10,dataIndex:1,hasText:!1,onSwitchData:null})},_init:function(){FXM.DataSwitch._super._init.apply(this,arguments);var e=this,i=this.options;this.dataIndex=i.dataIndex;t('<div class="switch-btn next"><i class="icon-arrow-right"/></div><div class="switch-btn prev"><i class="icon-arrow-left"/></div>').appendTo(this.element);var a=t(".prev",this.element),n=t(".next",this.element);i.dataIndex<=1&&a.addClass("disabled"),i.dataIndex>=i.dataCount&&n.addClass("disabled"),i.hasText&&(this.element.children().addClass("has-text"),t('<div class="text"></div>').appendTo(a),t('<div class="text"></div>').appendTo(n)),this.element.on("click",".switch-btn",function(i){var a=t(i.currentTarget);if(a.length&&!a.hasClass("disabled")){var n=a.hasClass("prev")?e.dataIndex-1:e.dataIndex+1;e._switchData(n)}})},_showSwitchTip:function(e){this.options;var i=t('<div class="x-window-mask"/>');return e?t('<div class="switch-tip"><span></span><i class="next icon-arrow-right"/></div>').appendTo(i):t('<div class="switch-tip"><i class="prev icon-arrow-left"/><span></span></div>').appendTo(i),i},_switchData:function(t){var e=this,i=this.options;if(!(t<=0||t>i.dataCount)){var a=this._showSwitchTip(this.dataIndex<t);this.dataIndex=t,FXM.Utils.applyFunc(e,i.onSwitchData,[t,a],!1)}}}),FXM.register("dataswitch",FXM.DataSwitch)}(Zepto),function(t){FXM.DataBtnGroup=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.DataBtnGroup._super._defaults.apply(this,arguments),{baseCls:"x-data-btn-group",hasCommentBtn:!1,hasEditBtn:!1,hasDeleteBtn:!1,hasActivateBtn:!1,hasTransferBtn:!1,hasCloseBtn:!1,hasSwitchBtn:!1,dataCount:10,dataIndex:1,onSwitchData:null})},_init:function(){FXM.DataBtnGroup._super._init.apply(this,arguments);this.options;this._createBtns(),this._calcBarWidth(),this.setBarWidth(this.barWidth)},_createBtns:function(){var e=this,i=this.options;this.btnNum=0,this.$bar=t('<div class="footer-items" />').appendTo(this.element),i.hasCommentBtn&&(this.$commBtn=t('<div class="footer-item item-btn" role="comment"><i class="icon-message"/><div class="text"></div></div>').appendTo(this.$bar),this.btnNum++),i.hasEditBtn&&(this.$editBtn=t('<div class="footer-item item-btn" role="edit"><i class="icon-flow-normal"/><div class="text"></div></div>').appendTo(this.$bar),this.btnNum++),i.hasDeleteBtn&&(this.$delBtn=t('<div class="footer-item item-btn del-btn" role="delete"><i class="icon-trash"/><div class="text"></div></div>').appendTo(this.$bar),this.btnNum++),i.hasActivateBtn&&(this.$activeBtn=t('<div class="footer-item item-btn" role="active"><i class="icon-done"/><div class="text"></div></div>').appendTo(this.$bar),this.btnNum++),i.hasTransferBtn&&(this.$transferBtn=t('<div class="footer-item item-btn" role="transfer"><i class="icon-charger"/><div class="text"></div></div>').appendTo(this.$bar),this.btnNum++),i.hasCloseBtn&&(this.$closeBtn=t('<div class="footer-item item-btn over-btn" role="close"><i class="icon-flow-over"/><div class="text"></div></div>').appendTo(this.$bar),this.btnNum++),i.hasSwitchBtn&&new FXM.DataSwitch({render:t("<div />").appendTo(this.element),dataCount:i.dataCount,dataIndex:i.dataIndex,hasText:!this.btnNum,onSwitchData:function(t,a){a.appendTo(e.element),e.switchinterval&&clearTimeout(e.switchinterval),e.switchinterval=setTimeout(function(){a.addClass("fade-out"),setTimeout(function(){FXM.Utils.applyFunc(e,i.onSwitchData,[t],!1)},300)},500)}})},_calcBarWidth:function(){var t=this.options;switch(this.btnNum){case 0:this.barWidth=0;break;case 1:this.$bar&&this.$bar.addClass("one-btn"),t.hasSwitchBtn?this.barWidth=60:this.barWidth=90;break;case 2:this.barWidth=50;break;case 3:this.barWidth=60;break;default:this.barWidth=0}},setBarWidth:function(t){this.$bar&&this.$bar.css("width",t+"%")}}),FXM.register("databtngroup",FXM.DataBtnGroup)}(Zepto),function(t){FXM.CoopFormData=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.CoopFormData._super._defaults.apply(),{baseCls:"x-coop-form-data",authGroupId:null,data:null,dataCount:10,dataId:null,dataIndex:1,editable:!0,editValue:null,form:null,formId:null,hasCancelBtn:!0,hasDeleteBtn:!1,hasEditBtn:!1,hasSwitchBtn:!1,header:null,ignoreVisible:!0,optAuth:null,title:"",needFetchViewData:!1,onAfterCancel:null,onAfterDeleteData:null,onAfterEditData:null,onDeleteData:null,onEditData:null,onSwitchData:null})},_init:function(){var t=this.options,e=this;FXM.CoopFormData._super._init.apply(this,arguments),t.dataId=t.dataId||t.data._id,this._createFormDataWrapper(),this._fetchViewData(function(){e.showFieldsKey=FXM.Store.getKey("formDataShowFields",{appId:FXM.STATIC.APPID,entryId:t.formId,groupId:t.authGroupId});var i=FXM.Store.get(e.showFieldsKey);e.showFields=t.needFetchViewData?FXM.Utils.getShowFieldsByNames(t.header,i):t.header,e._createFormData(),e._createShowFieldsConfigPane()}),this._createWrapHeader(),this._createEditPane()},_fetchViewData:function(t){var e=this.options;if(!e.needFetchViewData)return t&&t();FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.view),data:{formId:e.formId,dataId:e.dataId,authGroupId:e.authGroupId}},function(i){e.data=i.data,e.header=i.fields,t&&t()})},_createFormData:function(){var e=this.options;this.$formDataWrapper||(this.$formDataWrapper=t("<div/>").appendTo(this.$wrapper)),this.formdata=new FXM.FormData({render:this.$formDataWrapper,authGroupId:e.authGroupId,data:e.data,header:this.showFields,ignoreVisible:e.ignoreVisible,optAuth:e.optAuth,title:e.title})},_createShowFieldsConfigPane:function(){var e=this.options,i=this;if(e.needFetchViewData){this.showFieldItems=FXM.Utils.getShowFieldItems(this.showFields,e.header,FXM.CONSTS.LIMIT_FIELDS.list);var a=t('<div class="show-fields-config"><div class="left">'+this._getShowFieldsCountText()+'</div><div class="right"><i class="icon-eye"/><span class="text"></span></div></div>').appendTo(this.$formDataWrapper);new FXM.DataCombocheck({title:"",render:t(".right",a),items:this.showFieldItems,onStopEdit:function(t){FXM.Store.set(i.showFieldsKey,t),i.showFields=FXM.Utils.getShowFieldsByNames(e.header,t),i.$formDataWrapper.empty(),i._createFormData(),i._createShowFieldsConfigPane()}})}},_getShowFieldsCountText:function(){var t=!0,e=0;return FXM.Utils.forEach(this.showFieldItems,function(i,a){a.selected||(t=!1,e++)}),t?"":""+e+""},_createWrapHeader:function(){var e=this,i=this.options,a=t("<div class='wrapper-header'/>").appendTo(this.element);i.hasCancelBtn&&(this.$cancelBtn=t('<div class="header-item-right"><i class="icon-close"/></div>').click(function(){FXM.Utils.applyFunc(e,i.onClose,[],!1)}).appendTo(a));var n=[{text:"",key:"form"},{text:"",key:"dynamic"},{text:"",key:"comment"}];this.$menu=t('<div class="header-item-left"/>').on("click",".menu-item",function(i){var a=t(".menu-item",e.$menu).index(this);e._changeView(n[a].key,a)}).appendTo(a),t('<div class="select-bar"/>').appendTo(this.$menu),FXM.Utils.forEach(n,function(i,a){t('<div class="menu-item">'+a.text+"</div>").toggleClass("active",0===i).appendTo(e.$menu)})},_createFormDataWrapper:function(){this.options;this.$layout=t('<div class="widget-layout-content"/>').appendTo(this.element),this.$wrapper=t('<div class="content-item has-footer"/>').appendTo(this.$layout),t('<div class="content-item has-footer"/>').css("left","100%").appendTo(this.$layout),t('<div class="content-item has-footer"/>').css("left","200%").appendTo(this.$layout)},_createEditPane:function(){var e=this,i=this.options;i.editable&&(this.$editPane=t('<div class="edit-pane"/>').appendTo(this.element),new FXM.DataBtnGroup({render:e.$editPane,hasCommentBtn:!0,hasEditBtn:i.hasEditBtn,hasDeleteBtn:i.hasDeleteBtn,hasSwitchBtn:i.hasSwitchBtn,dataCount:i.dataCount,dataIndex:i.dataIndex,onSwitchData:i.onSwitchData}),this.commentUserMap={},this.$editPane.on("click",".item-btn",function(a){switch(t(a.currentTarget).attr("role")){case"delete":FXM.Utils.applyFunc(e,i.onDeleteData,[],!1),e._doDeleteData();break;case"edit":FXM.Utils.applyFunc(e,i.onEditData,[],!1),e._doEditData();break;case"comment":var n=t('<div class="x-window-mask dark-in"/>').on("click",function(){n.remove(),r.remove(),e.tempComment=o.val(),e.scrollLock&&e.scrollLock.release()}).appendTo("body"),r=t('<div class="x-coop-form-data-editor"><div class="content"></div><div class="footer"><div class="footer-btn-right pub" role="pub"></div> </div></div>').css("z-index",FXM.STATIC.zIndex++).appendTo("body"),s=new FXM.UserGroup({render:t('<div class="footer-btn-left"/>').prependTo(t(".footer",r)),msg:"@",onStopEdit:function(){var i=this.getItems(),a="";FXM.Utils.forEach(i,function(t,i){e.commentUserMap[i.id]=i.name,a+="@"+i.name+" "});var n=o.val();o.val(a+n).focus(),a&&t(".pub",r).removeClass("x-ui-disable"),t(".select-list",this.element).html('<div class="select-empty">@</div>')}});e.pubActive=!FXM.Utils.isEmpty(e.tempComment),t(".pub",r).toggleClass("x-ui-disable",!e.pubActive),t(".select-list",s.element).addClass("border-none");var o=t("<textarea></textarea>").val(e.tempComment||"").on({keyup:function(){e.pubActive===FXM.Utils.isEmpty(t(this).val())&&(e.pubActive=!e.pubActive,t(".pub",r).toggleClass("x-ui-disable",!e.pubActive))},input:function(){e.pubActive===FXM.Utils.isEmpty(t(this).val())&&(e.pubActive=!e.pubActive,t(".pub",r).toggleClass("x-ui-disable",!e.pubActive))}}).appendTo(t(".content",r));o.focus(),r.on("click",".pub",function(){var t=o.val();t&&(n.remove(),r.remove(),e.tempComment=t,e.scrollLock.release(),e._createDataComment(e.tempComment))}),e.scrollLock=FXM.Utils.scrollLock(e.$wrapper)}}))},_changeView:function(e,i){var a=this,n=this.options,r=t(".menu-item",this.$menu).eq(i);if(r.length&&!r.hasClass("active")){r.addClass("active").siblings().removeClass("active"),t(".select-bar",this.$menu).css("left",r.offset().left-this.$menu.offset().left);var s="translate(-"+100*i+"%,0)";this.$layout.css(FXM.Utils.formatTransform(s));var o=t(".content-item",this.$layout).eq(i);switch(this.$editPane.empty(),e){case"form":new FXM.DataBtnGroup({render:a.$editPane,hasCommentBtn:!0,hasEditBtn:n.hasEditBtn,hasDeleteBtn:n.hasDeleteBtn,hasSwitchBtn:n.hasSwitchBtn,dataCount:n.dataCount,dataIndex:n.dataIndex,onSwitchData:n.onSwitchData});break;case"dynamic":new FXM.DataBtnGroup({render:a.$editPane,hasSwitchBtn:n.hasSwitchBtn,dataCount:n.dataCount,dataIndex:n.dataIndex,onSwitchData:n.onSwitchData}),this.dataDynamic||(this.dataDynamic=new FXM.DataDynamic({render:t("<div/>").appendTo(o),dataId:n.dataId,authGroupId:n.authGroupId}));break;case"comment":new FXM.DataBtnGroup({render:a.$editPane,hasCommentBtn:!0,hasSwitchBtn:n.hasSwitchBtn,dataCount:n.dataCount,dataIndex:n.dataIndex,onSwitchData:n.onSwitchData}),this.dataComment||(this.dataComment=new FXM.DataComment({render:t("<div/>").appendTo(o),dataId:n.dataId,authGroupId:n.authGroupId}))}}},_doEditData:function(){var e=this,i=this.options;i.dataId&&(e.$form=t("<div class='form-data'/>").appendTo("body"),i.formConfig={render:e.$form,entryId:i.formId,dataId:i.dataId,submitUrl:FXM.Utils.getApi(FXM.API.data.update),submitData:{dataId:i.dataId},title:i.title,editValue:i.editValue,mode:"edit",ignoreOptAuth:!1,widgetOptAuth:i.optAuth,authGroupId:i.authGroupId,navBtns:[{nav:"update",text:"",onClick:function(){this.doVerifyAndSubmit(function(t){e.$form.remove(),FXM.UI.indicator("",function(){FXM.Utils.applyFunc(e,i.onAfterEditData,[t],!1)})})}},{nav:"cancel",text:"",onClick:function(){e.$form.remove(),FXM.Utils.applyFunc(e,i.onAfterCancel,[],!1)}}]},FXM.Utils.isNull(i.form)?FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.read),data:{formId:i.formId,dataId:i.dataId,authGroupId:i.authGroupId}},function(e){i.form=e.form,t.extend(i.form,i.formConfig),new FXM.Form(t.extend(i.form,{title:e.title,editValue:e.data,widgetOptAuth:i.optAuth||e.optAuth}))}):new FXM.Form(t.extend(i.form,i.formConfig)))},_doDeleteData:function(){var t=this.options;FXM.UI.confirm("",function(){FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.remove),data:{formId:t.formId,idList:[t.dataId],authGroupId:t.authGroupId}},function(){FXM.Utils.applyFunc(self,t.onAfterDeleteData,[],!1)})})},_createDataComment:function(t){var e=this.options,i=this,a=[];FXM.Utils.forEach(this.commentUserMap,function(e,i){var n="@"+i;t.indexOf(n)>=0&&a.push(e)}),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.comment_create),data:{dataId:e.data._id,comment:t,authGroupId:e.authGroupId,mentioned:{users:a}}},function(t){i.tempComment="",i.commentUserMap={},i.dataComment&&i.dataComment.refresh(),i._changeView("comment",2)})}}),FXM.register("coopformdata",FXM.CoopFormData)}(Zepto),function(t){FXM.FlowFormData=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.FlowFormData._super._defaults.apply(),{baseCls:"x-flow-form-data",authGroupId:null,data:null,dataCount:10,dataId:null,dataIndex:1,editable:!0,flowAction:null,formId:null,hasActivateBtn:!1,hasCloseBtn:!1,hasTransferBtn:!1,hasCancelBtn:!0,hasLogViewBtn:!1,hasSwitchBtn:!1,hasEditBtn:!1,header:null,ignoreVisible:!0,optAuth:null,title:"",needFetchViewData:!1,onAfterCancel:null,onAfterEditData:null,onAfterFlowChange:null,onEditData:null,onSwitchData:null})},_init:function(){var t=this,e=this.options;FXM.FlowFormData._super._init.apply(this,arguments),e.dataId=e.dataId||e.data._id,this.hasLoadFlowLog=!1,this.hasLoadFlowChartView=!1,this._createFormDataWrapper(),this._createWrapHeader(),this.dataEdit=new FXM.FlowData({formId:e.formId,authGroupId:e.authGroupId,optAuth:e.optAuth,flowAction:e.flowAction,hasLogView:e.hasLogViewBtn,onAfterCancel:function(){t.element.removeClass("x-ui-hidden")},onAfterFlowChange:function(i){!1===FXM.Utils.applyFunc(t,e.onAfterFlowChange,[],!1)&&t._rebuild(i)}}),e.needFetchViewData?this._fetchViewData(function(){t._initShowFields(),t._createFormData(),t._createShowFieldsConfigPane(),t._initFlowState(),t._createEditPane()}):(this._initShowFields(),this._createFormData(),this._getFlowState(function(){t._initFlowState(),t._createEditPane()}))},_initShowFields:function(){var t=this.options;if(t.needFetchViewData){this.showFieldsKey=FXM.Store.getKey("formDataShowFields",{appId:FXM.STATIC.APPID,entryId:t.formId,groupId:t.authGroupId});var e=FXM.Store.get(this.showFieldsKey);this.showFields=FXM.Utils.getShowFieldsByNames(t.header,e)}else this.showFields=t.header},_initFlowState:function(){var t=this.options,e=FXM.CONSTS.WORKFLOW.FLOWSTATE;FXM.Utils.isNull(t.flowState)||([e.COMPLETE,e.CLOSE].indexOf(t.flowState)<0?(t.hasTransferBtn=t.flowAction.flowTransfer,t.hasCloseBtn=t.flowAction.flowClose,t.hasActivateBtn=!1):(t.hasActivateBtn=t.flowAction.flowActivate,t.hasTransferBtn=!1,t.hasCloseBtn=!1))},_fetchViewData:function(t){var e=this.options;if(!e.needFetchViewData)return t&&t();FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.view),data:{formId:e.formId,dataId:e.dataId,authGroupId:e.authGroupId}},function(i){e.data=i.data,e.header=i.fields,e.flowState=i.data.flowState,t&&t()})},_getFlowState:function(t){var e=this.options,i=this;FXM.UI.showLoader(),FXM.Utils.dataAjax({url:"/data/read",data:{formId:e.formId,dataId:e.dataId,authGroupId:e.authGroupId}},function(a){FXM.UI.closeLoader(),e.flowState=a.data.flowState,FXM.Utils.applyFunc(i,t,[],!1)})},_createFormDataWrapper:function(){this.options;this.$layout=t('<div class="widget-layout-content"/>').appendTo(this.element),this.$wrapper=t('<div class="content-item has-footer"/>').appendTo(this.$layout);for(var e=1;e<4;e++)t('<div class="content-item has-footer"/>').css("left",100*e+"%").appendTo(this.$layout)},_createShowFieldsConfigPane:function(){var e=this.options,i=this;if(e.needFetchViewData){var a=FXM.CONSTS.LIMIT_FIELDS.list.concat(["flowState","chargers"]);this.showFieldItems=FXM.Utils.getShowFieldItems(this.showFields,e.header,a);var n=t('<div class="show-fields-config"><div class="left">'+this._getShowFieldsCountText()+'</div><div class="right"><i class="icon-eye"/><span class="text"></span></div></div>').appendTo(this.$formDataWrapper);new FXM.DataCombocheck({title:"",render:t(".right",n),items:this.showFieldItems,onStopEdit:function(t){FXM.Store.set(i.showFieldsKey,t),i.showFields=FXM.Utils.getShowFieldsByNames(e.header,t),i.$formDataWrapper.empty(),i._createFormData(),i._createShowFieldsConfigPane()}})}},_getShowFieldsCountText:function(){var t=!0,e=0;return FXM.Utils.forEach(this.showFieldItems,function(i,a){a.selected||(t=!1,e++)}),t?"":""+e+""},_createFormData:function(){var e=this.options;this.$formDataWrapper||(this.$formDataWrapper=t("<div/>").appendTo(this.$wrapper)),this.formdata=new FXM.FormData({render:this.$formDataWrapper,authGroupId:e.authGroupId,data:e.data,header:this.showFields,ignoreVisible:e.ignoreVisible,optAuth:e.optAuth,title:e.title})},_createWrapHeader:function(){var e=this,i=this.options,a=t("<div class='wrapper-header'/>").appendTo(this.element);i.hasCancelBtn&&(this.$cancelBtn=t('<div class="header-item-right"><i class="icon-close"/></div>').click(function(){FXM.Utils.applyFunc(e,i.onClose,[],!1)}).appendTo(a));var n=[{text:"",key:"form"},{text:"",key:"approval"},{text:"",key:"log"},{text:"",key:"state"}];this.$menu=t('<div class="header-item-left"/>').on("click",".menu-item",function(i){var a=t(".menu-item",e.$menu).index(this);e._changeView(n[a].key,a)}).appendTo(a),t('<div class="select-bar"/>').appendTo(this.$menu),FXM.Utils.forEach(n,function(i,a){t('<div class="menu-item">'+a.text+"</div>").toggleClass("active",0===i).appendTo(e.$menu)})},_createEditPane:function(){var e=this,i=this.options;i.editable&&(i.hasEditBtn=i.flowAction.flowUpdate,this.$editPane=t('<div class="edit-pane"/>').appendTo(this.element),new FXM.DataBtnGroup({render:e.$editPane,hasActivateBtn:i.hasActivateBtn,hasTransferBtn:i.hasTransferBtn,hasCloseBtn:i.hasCloseBtn,hasSwitchBtn:i.hasSwitchBtn,hasEditBtn:i.hasEditBtn,dataCount:i.dataCount,dataIndex:i.dataIndex,onSwitchData:i.onSwitchData}),this.$editPane.on("click",".item-btn",function(a){switch(t(a.currentTarget).attr("role")){case"close":e.dataEdit.closeFlow(i.dataId);break;case"active":e.dataEdit.activeFlow(i.dataId);break;case"transfer":e.element.addClass("x-ui-hidden"),e.dataEdit.transferFlow(i.dataId);break;case"edit":FXM.Utils.applyFunc(e,i.onEditData,[],!1),e._doEditData()}}))},_doEditData:function(){var e=this,i=this.options;i.dataId&&(e.$form=t("<div class='form-data'/>").appendTo("body"),i.formConfig={render:e.$form,entryId:i.formId,dataId:i.dataId,authGroupId:i.authGroupId,submitUrl:FXM.Utils.getApi(FXM.API.data.update),submitData:{dataId:i.dataId},mode:"edit",ignoreOptAuth:!1,widgetOptAuth:i.optAuth,navBtns:[{nav:"update",text:"",onClick:function(){this.doVerifyAndSubmit(function(t){e.$form.remove(),FXM.UI.indicator("",function(){FXM.Utils.applyFunc(e,i.onAfterEditData,[t],!1)})})}},{nav:"cancel",text:"",onClick:function(){e.$form.remove(),FXM.Utils.applyFunc(e,i.onAfterCancel,[],!1)}}]},FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.read),data:{formId:i.formId,dataId:i.dataId,authGroupId:i.authGroupId}},function(e){var a=t.extend({},e.form,i.formConfig);new FXM.Form(t.extend(a,{editValue:e.data}))}))},_changeView:function(e,i){var a=this.options,n=t(".menu-item",this.$menu).eq(i);if(n.length&&!n.hasClass("active")){n.addClass("active").siblings().removeClass("active"),t(".select-bar",this.$menu).css({left:n.offset().left-this.$menu.offset().left,width:n.outerWidth(!1)});var r="translate(-"+100*i+"%,0)";this.$layout.css(FXM.Utils.formatTransform(r));t(".content-item",this.$layout).eq(i);var s=t(".widget-layout-content > .content-item",this.$body).eq(i);switch(e){case"form":break;case"approval":this.FlowApproval||(this.dataEdit.approval(a.dataId,s),this.FlowApproval=!0);break;case"log":this.hasLoadFlowLog||(new FXM.FlowLog({render:t("<div/>").appendTo(s),authGroupId:a.authGroupId,dataId:a.dataId}),this.hasLoadFlowLog=!0);break;case"state":this.hasLoadFlowChartView||(this.dataEdit.showFlowState(a.dataId,!1,s),this.hasLoadFlowChartView=!0)}}},_rebuild:function(t){var e=this,i=this.options;i.data.flowState=t.flowState,i.data.chargers=t.chargers,i.data.updateTime=t.updateTime,e.element.empty(),e.$formDataWrapper=null,e._init(),e.element.removeClass("x-ui-hidden")}}),FXM.register("flowformdata",FXM.FlowFormData)}(Zepto),function(t){FXM.ReportFormData=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.ReportFormData._super._defaults.apply(),{baseCls:"x-report-form-data",data:null,dataCount:10,dataId:null,dataIndex:1,editable:!0,entryId:null,form:null,formId:null,hasCancelBtn:!0,hasDeleteBtn:!1,hasEditBtn:!1,hasSwitchBtn:!1,header:null,ignoreVisible:!0,title:"",onAfterCancel:null,onAfterDeleteData:null,onAfterEditData:null,onDeleteData:null,onEditData:null,onSwitchData:null})},_init:function(){var t=this.options;FXM.ReportFormData._super._init.apply(this,arguments),t.dataId=t.dataId||t.data._id,this._createFormDataWrapper(),this._createFormData(),this._createWrapHeader(),this._createEditPane()},_createFormDataWrapper:function(){this.options;this.$layout=t('<div class="widget-layout-content"/>').appendTo(this.element),this.$wrapper=t('<div class="content-item has-footer"/>').appendTo(this.$layout)},_createFormData:function(){var e=this.options;this.formdata=new FXM.FormData({render:t("<div/>").appendTo(this.$wrapper),data:e.data,header:e.header,ignoreVisible:e.ignoreVisible,title:e.title})},_createWrapHeader:function(){var e=this,i=this.options,a=t("<div class='wrapper-header'/>").appendTo(this.element);i.hasCancelBtn&&(this.$cancelBtn=t('<div class="header-item-right"><i class="icon-close"/></div>').click(function(){FXM.Utils.applyFunc(e,i.onClose,[],!1)}).appendTo(a));var n=t('<div class="header-item-left"/>').appendTo(a);t('<div class="first-field"/>').text(this.formdata.getFirstFieldText()).appendTo(n)},_createEditPane:function(){var e=this,i=this.options;i.editable&&(this.$editPane=t('<div class="edit-pane"/>').appendTo(this.element),new FXM.DataBtnGroup({render:e.$editPane,hasEditBtn:e._isEditable()&&i.hasEditBtn,hasDeleteBtn:e._isEditable()&&i.hasDeleteBtn,hasSwitchBtn:i.hasSwitchBtn,dataCount:i.dataCount,dataIndex:i.dataIndex,onSwitchData:i.onSwitchData}),this.$editPane.on("click",".item-btn",function(a){switch(t(a.currentTarget).attr("role")){case"delete":FXM.Utils.applyFunc(e,i.onDeleteData,[],!1),e._doDeleteData();break;case"edit":FXM.Utils.applyFunc(e,i.onEditData,[],!1),e._doEditData()}}))},_isEditable:function(){var t=this.options;return!(!t.data||!t.data._id)&&t.data._id.toString().substring(0,1)!==FXM.CONSTS.DATA_PREFIX.Aggregate},_doEditData:function(){var e=this,i=this.options;i.dataId&&(e.$form=t("<div class='form-data'/>").appendTo("body"),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.read),data:{formId:i.formId,dataId:i.dataId}},function(a){new FXM.Form(t.extend(a.form,{render:e.$form,dataId:i.dataId,editValue:a.data,entryId:i.entryId,mode:"edit",submitData:{dataId:i.dataId},submitUrl:FXM.Utils.getApi(FXM.API.data.update),title:a.title,widgetOptAuth:a.optAuth,navBtns:[{nav:"update",text:"",onClick:function(){this.doVerifyAndSubmit(function(){e.$form.remove(),FXM.UI.indicator("",function(){FXM.Utils.applyFunc(e,i.onAfterEditData,[],!1)})})}},{nav:"cancel",style:"grey",text:"",onClick:function(){e.$form.remove(),FXM.Utils.applyFunc(e,i.onAfterCancel,[],!1)}}]}))}))},_doDeleteData:function(){var t=this.options;FXM.UI.confirm("",function(){FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.remove),data:{formId:t.entryId,idList:[t.dataId]}},function(){FXM.UI.indicator("",function(){FXM.Utils.applyFunc(self,t.onAfterDeleteData,[],!1)})})})}}),FXM.register("reportformdata",FXM.ReportFormData)}(Zepto),FXM.Dash=FXM.extend(FXM.Widget,{_defaults:function(){return $.extend(FXM.Dash._super._defaults.apply(this,arguments),{baseCls:"x-dash",appId:"",entryId:"",title:"",hasLazyLoad:!0})},_init:function(){FXM.Dash._super._init.apply(this,arguments);var t=this.options,e=this;this.fields=[],this.widgetsMap={};var i=[];FXM.Utils.forEach(t.components,function(t,e){i.push($.extend(e,{widgetId:t}))}),i.sort(function(t,e){return t.posY>e.posY?1:t.posY===e.posY&&t.posX>e.posX?1:-1}),FXM.Utils.forEach(i,function(i,a){var n=e._getWidgetConfig(a);if(n.chart)e.widgetsMap[a.widgetId]=new FXM.DashBlock({render:$('<div class="dash-component"/>').appendTo(e.element),widgetId:a.widgetId,block:n,component:a,hasLazyLoad:t.hasLazyLoad,onItemClick:function(t){FXM.Utils.forEach(a.triggers,function(i,a){var n=e.widgetsMap[a];n&&(n.setLinkFilter(t),n.reload())})},onFullScreen:function(t){e.scrollLock&&!t?e.scrollLock.release():e.scrollLock=FXM.Utils.scrollLock(e.element)}});else{var r=n.config;r.fields&&r.fields.length&&e.fields.push(e._dealParameterField(r))}}),this.fields&&this.fields.length&&($('<div class="dash-filter-btn"><i class="icon-filter"></i></div>').appendTo(this.element),this._createParameter(),this._doFilter()),this._bindEvent()},_getFilter:function(t,e){var i=[];return FXM.Utils.forEach(t,function(t,a){a.triggers&&a.triggers.indexOf(e)>-1&&i.push(a)}),i},_bindEvent:function(){var t=this;this.element.on("click",function(e){var i=$(e.target).closest(".dash-filter-btn");if(i&&i.length)return t._createParameter(!0),e.preventDefault(),!1}),this._bindLazyLoadEvt()},_createParameter:function(t){var e=this;this.parameter||(this.$parameter=$("<div />"),this.parameter=new FXM.DashParameter($.extend({render:this.$parameter,fields:this.fields}))),t&&new FXM.SlidePanel({direction:"bottom",content:this.$parameter,text4Right:"",text4Left:"",onLeftClick:function(){this.close()},onRightClick:function(){e._doFilter(),this.close(),e.$parameter.detach()}}).show()},_doFilter:function(){var t=this,e=this.parameter.getValue();FXM.Utils.forEach(this.widgetsMap,function(i,a){a.setFilter(t._getFilter(e,i)),a.reload()})},_getWidgetConfig:function(t){var e="",i={config:{}};switch($.extend(i.config,t),i.config.xFields=t.xFields,i.config.yFields=t.yFields,i.config.valueFields=this._dealValueFields(t.metrics),t.type){case"metric_table":e="metrictable",i.chart=!0,i.config.xFields.length&&i.config.metrics.length||(i.noTitle=!0);break;case"data_table":e="dashdatatable",i.config.fields=t.xFields.concat(t.metrics),i.chart=!0,i.customCls="component-table";break;case"pivot_table":e="dashpivottable",i.chart=!0,i.customCls="component-table";break;case"line_chart":e="dashlinechart",i.chart=!0;break;case"column_chart":e="dashbarchart",i.chart=!0;break;case"bar_chart":e="dashbarchart",i.config.isInverted=!0,i.chart=!0;break;case"area_chart":e="dashareachart",i.chart=!0;break;case"pie_chart":e="dashpiechart",i.chart=!0;break;case"radar_chart":e="dashradarchart",i.chart=!0;break;case"dept_filter":case"text_filter":e=t.fields&&t.fields.length?t.fields[0].type:"text";break;case"number_filter":e="number";break;case"address_filter":e="address";break;case"date_filter":e="datetime",i.config.format="yyyy-MM-dd";break;case"datetime_filter":e="datetime",i.config.format="yyyy-MM-dd HH:mm:ss";break;default:e=t.type}return i.config.type=e,i},_getFieldText:function(t){return t.title},_dealValueFields:function(t){var e=this,i=[];return FXM.Utils.forEach(t,function(t,a){i.push($.extend({text:e._getFieldText(a)},a))}),i},_dealParameterField:function(t){var e=t.fields[0],i=$.extend(t,{id:e.form,text:t.title,type:t.type,defaultValue:t.defaultConfig});return e.subform?$.extend(i,{name:e.subform+"."+e.subField,subform:e.subform}):$.extend(i,{name:e.field})},_bindLazyLoadEvt:function(){var t=this;this.options.hasLazyLoad&&(this._doLazyLoad(),this.element.unbind("scroll.lazy"),this.element.bind("scroll.lazy",function(){t._doLazyLoad()}))},_doLazyLoad:function(){this.options.hasLazyLoad&&FXM.Utils.forEach(this.widgetsMap,function(t,e){e&&(e.isWidgetLoaded()||$(e.element).offset().top<=document.body.clientHeight&&e.loadWidget())})}}),function(t){FXM.MetricTable=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.MetricTable._super._defaults.apply(this,arguments),{baseCls:"x-metric-table",widgetName:"",xFields:[],valueFields:[],filter:{},titleMinSize:12,valueMinSize:30,onDataFilter:null,onLoadFail:null})},_init:function(){FXM.MetricTable._super._init.apply(this,arguments);var t=this;this._fetchData(function(e){t.data=e,t._initContent()})},_fetchData:function(t){var e=this.options,i=this;if(FXM.Utils.isObjectEmpty(e.valueFields)){e.xFields=[];var a={val:[{sum:2e6}]};return t&&t(a)}var n=this._getFilter();FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.dash.combined_group),data:{widgetId:e.widgetName,filter:n}},function(e){if(i.resData=e,FXM.Utils.isObjectEmpty(e.data&&e.data.val)){var a=n.cond.length>0?"":"";FXM.UI.createEmptyTip({msg:a}).appendTo(i.element)}else t&&t(e.data)},function(t){FXM.Utils.applyFunc(i,e.onLoadFail,[t],!1)})},_getFilter:function(){var t=this.options,e=[],i=FXM.Utils.applyFunc(this,t.onDataFilter,[],!1);return i&&(e=e.concat(i)),FXM.Utils.isObjectEmpty(t.filter.cond)||(e=e.concat(t.filter.cond)),{rel:FXM.CONSTS.FILTER_RELATION.AND,cond:e}},_initContent:function(){this.element.empty(),this._hasDimension()?this._createOneDimensionTable():(this._createNoDimensionTable(),this.doResize())},_hasDimension:function(){return this.options.xFields.length>0},_createOneDimensionTable:function(){var e=this,i=this.options,a=this.data&&this.data.val,n=this.data&&this.data.x;if(this.element.addClass("one-dimension"),!FXM.Utils.isObjectEmpty(a)&&!FXM.Utils.isObjectEmpty(n)){var r=a[0].sum,s=n[0].data,o=a[0].data,l=i.xFields[0];this.$contentWrapper=t('<div class="content-wrapper one-dimension"/>').appendTo(this.element);var c=t('<div class="number-lines"><div class="line sum"><div class="left"></div><div class="right">'+this._formatData(r)+"</div></div></div>").appendTo(this.$contentWrapper);FXM.Utils.forEach(s,function(i,a){t('<div class="line number"/>').append(t('<div class="left"/>').text(e._formatLabel(a,l))).append(t('<div class="right"/>').text(e._formatData(o[i]))).appendTo(c)})}},_formatLabel:function(t,e){var i=t,a=this.resData;switch(e.type){case"user":var n=a.user[t];n&&(i=n.nickname||"");break;case"dept":var r=a.department[t];r&&(i=r.name||"");break;case"datetime":var s=e.groupRule||"year";i=FXM.Utils.date2GroupStr(t,s);break;case"location":case"address":i="";var o=e.groupRule.split("_");FXM.Utils.forEach(o,function(e,a){i+=t[a]})}return i},_createNoDimensionTable:function(){var e=this.options,i=this.data&&this.data.val;if(this.element.addClass("no-dimension"),!FXM.Utils.isObjectEmpty(i)){var a=e.title,n=this._formatData(i[0].sum);this.valFontCount=n.toString().length,this.$contentWrapper=t('<div class="content-wrapper">').append(t('<div class="inner-content"/>').append(t('<div class="title"/>').append(t('<span class="title-val"/>').text(a))).append(t('<div class="sum"/>').append(t('<span class="sum-val"/>').text(n)))).appendTo(this.element),t(".title-val",this.$contentWrapper).css({fontSize:e.titleMinSize+"px"}),t(".sum-val",this.$contentWrapper).css({fontSize:e.valueMinSize+"px"})}},_formatData:function(t){var e=this.options.valueFields[0];return e&&e.format?FXM.Utils.num2Str(t,e.format):FXM.Utils.fixDecimalPrecision(t)},doResize:function(t){if(!this._hasDimension()&&this.$contentWrapper){var e;e=t?t.height/3:this.element.height()/3,this.$contentWrapper.height(e),this._adjustFontSize()}},_adjustFontSize:function(){if(!this._hasDimension()){this.outerW=this.$contentWrapper.width(),this.outerH=this.$contentWrapper.height(),this._initFontSize();var e=this.options,i=t(".title-val",this.$contentWrapper),a=t(".sum-val",this.$contentWrapper),n=this.valBaseSize;if(this._collisionCheck(this.outerW,this.outerH))for(;this._collisionCheck(this.outerW,this.outerH)&&(n-=1,a.css({fontSize:n+"px"}),!(n<=e.valueMinSize)););else{for(;!this._collisionCheck(this.outerW,this.outerH);)n+=1,a.css({fontSize:n+"px"});a.css({fontSize:n-1+"px"})}var r=Math.min((this.outerH-a.height())/1.2,n/4);i.css({fontSize:Math.max(r,e.titleMinSize)+"px"})}},_initFontSize:function(){var e=this.options,i=t(".sum-val",this.$contentWrapper);this.valBaseSize=Math.max(e.valueMinSize,Math.min(this.outerW/this.valFontCount/.6,.8*this.outerH/1.2)),i.css({fontSize:this.valBaseSize+"px"})},_collisionCheck:function(e,i){var a=t(".sum-val",this.$contentWrapper),n=a.height(),r=a.width(),s=!1;return(n>=.8*i||r>=e)&&(s=!0),s},reload:function(){this.element.empty(),this._init()}}),FXM.register("metrictable",FXM.MetricTable)}(Zepto),FXM.DashBlock=FXM.extend(FXM.Widget,{_defaults:function(){return $.extend(FXM.Dash._super._defaults.apply(this,arguments),{baseCls:"x-dash-block",widgetId:"",block:{},component:{},hasLazyLoad:!1,onItemClick:null,onFullScreen:null})},_init:function(){FXM.DashBlock._super._init.apply(this,arguments);var t=this.options;this._renderHead(),t.hasLazyLoad||this._renderWidget(),this._bindEvent()},_renderHead:function(){var t=this.options,e=t.block,i=t.component,a=this.element.append('<i class="scale-btn icon-full-screen"/><i class="scale-btn icon-shrink"/>').addClass(e.customCls);e.noTitle?a.addClass("component-no-title"):$('<div class="component-title"/>').text(i.title).appendTo(a)},_renderWidget:function(){var t=this,e=this.options,i=$('<div class="component-content"/>').appendTo(this.element);if(this._checkFieldsValid()){var a=e.block,n=e.widgetId;this.isLoaded=!0,this.widget=FXM.createWidget($.extend({render:i,onDataFilter:function(){var e=[];return t.filter&&(e=e.concat(t.filter)),t.linkFilter&&(e=e.concat(t.linkFilter)),e},onLoadFail:function(e){var i=FXM.Utils.parseJSON(e.responseText)||{};t._renderTip(t._getInvalidTip(i.code))},onItemClick:e.onItemClick},a.config,{widgetName:n}))}else this.isLoaded=!0},_checkFieldsValid:function(){var t=this.options.component,e=!0;if(!this._isChartOrTable(t))return e;var i=null;return t.xFields.concat(t.fields).length||t.metrics.length?this._checkSubDimensionFields()?(e=!1,i=4212):this._checkSubCrossFields()&&(e=!1,i=4213):e=!1,e||this._renderTip(this._getInvalidTip(i)),e},_checkSubDimensionFields:function(){var t=this.options.component,e=[].concat(t.xFields).concat(t.yFields),i=[].concat(t.metrics),a=!1,n=!1;return FXM.Utils.forEach(e,function(t,e){if(e.subform)return a=!0,!1}),a&&FXM.Utils.forEach(i,function(t,e){if("formula"!==e.type&&!e.subform)return n=!0,!1}),a&&n},_getInvalidTip:function(t){var e="";switch(t){case 4212:e="";break;case 4213:e="";break;default:e=""}return e},_renderTip:function(t){FXM.UI.createEmptyTip({msg:t}).appendTo($(".component-content",this.element).empty())},_checkSubCrossFields:function(){var t=this.options.component,e=[].concat(t.xFields).concat(t.yFields).concat(t.metrics),i=!1,a=null;return FXM.Utils.forEach(e,function(t,e){if(e.subform)if(a){if(a!==e.subform)return i=!0,!1}else a=e.subform}),i},_isChartOrTable:function(t){return t.type.indexOf("table")>-1||t.type.indexOf("chart")>-1},setFilter:function(t){this.filter=t},setLinkFilter:function(t){this.linkFilter=t},loadWidget:function(){this._renderWidget()},isWidgetLoaded:function(){return this.isLoaded},reload:function(){this.widget&&this.widget.reload(!0)},_bindEvent:function(){var t=this,e=this.options;this.element.on("click",".scale-btn",function(i){return t.element.toggleClass("full-screen component-full-screen"),FXM.Utils.applyFunc(t,e.onFullScreen,[t.element.hasClass("full-screen")],!1),t.widget&&t.widget.resize({width:t.element.width(),height:t.element.height()}),i.preventDefault(),!1})}}),function(t){FXM.DashDataTable=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.DashDataTable._super._defaults.apply(),{baseCls:"x-dash-datatable",isFieldSortable:!0,onScroll:null,itemsPerPage:50,onDataFilter:null,onLoadFail:null})},_init:function(){FXM.DashDataTable._super._init.apply(this,arguments),this.$body=t('<div class="x-block-body"/>').appendTo(this.element),this.$wrapper=t('<div class="table-wrapper"/>').appendTo(this.$body),this.sort=[],this.setReloadState(!0),this._initDataTable()},loadingAjax:function(t,e,i){var a=this;if(!this.isLoading){var n=FXM.UI.createLoadIcon().appendTo(this.element);this.isLoading=!0,FXM.Utils.dataAjax(t,function(t,i){return FXM.Utils.applyFunc(a,e,[t,i],!1)},function(t,e){return FXM.Utils.applyFunc(a,i,[t,e],!1)},function(){a.isLoading=!1,n.remove(),a.setReloadState(!1)})}},setReloadState:function(t,e){this.needReload=t,t&&(this._linkFilterParam=e)},reload:function(t){(t||this.needReload)&&this._reloadData()},_initDataTable:function(){var t=this;this.options;this.tableRowHead=[],this.page=0,this.count=0,this.data=[],this._loadData(function(e){if(t.count=e.data.length,t.header=e.header,t.data=e.data,t.data.length)t.createTable();else{var i=!FXM.Utils.isObjectEmpty(t.getFilterData())?"":"";FXM.UI.createEmptyTip({msg:i}).appendTo(t.$body)}})},_loadData:function(t){var e,i,a=this,n=this.options;e=FXM.Utils.getApi(FXM.API.dash.list),i={widgetId:n.widgetName,sort:this.sort,skip:this.page*n.itemsPerPage,limit:n.itemsPerPage,filter:this.getFilterData(),hasCount:!1},this.loadingAjax({url:e,data:i},function(e){t&&t(e)},function(t){FXM.Utils.applyFunc(a,n.onLoadFail,[t],!1)})},createTable:function(){this.processor=new FXM.DataTableProcessor({header:this.header,data:this.data,sort:this.sort}),this.table?this.table.reload(this._getTableRenderData()):this.table=this._doCreateTable()},_doCreateTable:function(){var e=this;return new FXM.PlainTable(t.extend({render:this.$wrapper,isHeadSticky:!0,onHeadCellClick:function(t){t.hasClass("sortable")&&e._sortTable(t)},onOpBtnClick:function(t){if("file"===t.data("op")){var e=t.data("file");new FXM.FilePreview({files:FXM.Utils.makeArray(e)})}},onCellClick:function(t){var e=t.find("a.nest-link");if(e.length){var i=e.attr("data-url");i&&FXM.Utils.openLink(i)}},onScrollBottom:function(){e.loadMore()}},this._getTableRenderData()))},_sortTable:function(t){var e=t.data("field");if(e){var i={},a=-1;t.hasClass("sort-asc")?(t.removeClass("sort-asc").addClass("sort-desc"),i[e]=-1,(a=this.getSortedFieldIdx(e))>-1?this.sort[a]=i:this.sort.push(i)):t.hasClass("sort-desc")?(t.removeClass("sort sort-desc"),(a=this.getSortedFieldIdx(e))>-1&&this.sort.splice(a,1)):(t.removeClass("sort-desc").addClass("sort sort-asc"),a=this.getSortedFieldIdx(e),i[e]=1,a>-1?this.sort[a]=i:this.sort.push(i)),this._reloadData()}},_getTableRenderData:function(){return this.processor.getTable()},appendData:function(t){this.processor.processData(t);var e=this._getTableRenderData();this.table&&this.table.appendData(e.tableData,this.tableRowHead)},getSortedFieldIdx:function(t){var e=-1;return FXM.Utils.forEach(this.sort,function(i,a){if(a)return a[t]?(e=i,!1):void 0}),e},_reloadData:function(){t(".x-empty-info",this.element).remove(),this.$wrapper.empty(),this._initDataTable()},getFilterData:function(){var t=this.options,e=FXM.Utils.applyFunc(this,t.onDataFilter,[],!1),i=[];return e&&(i=i.concat(e)),FXM.Utils.isObjectEmpty(this._linkFilterParam)||(i=i.concat(this._linkFilterParam)),FXM.Utils.isObjectEmpty(i)?{}:{cond:i,rel:FXM.CONSTS.FILTER_RELATION.AND}},refresh:function(){this.tableRowHead=[],this.createTable()},resize:function(t){FXM.DashDataTable._super.resize.apply(this,arguments),this.table&&this.table.resize()},loadMore:function(){var t=this;this.hasMore()&&!this.isLoading&&(t.page++,this._loadData(function(e){t.count=e.data.length,t.data=t.data.concat(e.data),t.appendData(e.data)}))},hasMore:function(){return this.options.itemsPerPage<=this.count}}),FXM.register("dashdatatable",FXM.DashDataTable)}(Zepto),function(t){FXM.DashPivotTable=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.DashPivotTable._super._defaults.apply(),{baseCls:"x-dash-pivottable",title:"",filter:null,linkWidgets:null,chunkSize:50,form:null,xFields:[],yFields:[],valueFields:[],asyncURL:FXM.Utils.getApi(FXM.API.dash.combined_group),onItemClick:null,onLoadFail:null})},_init:function(){FXM.DashPivotTable._super._init.apply(this,arguments),this.$body=t('<div class="x-block-body"/>').appendTo(this.element),this.setReloadState(!0),this.$wrapper=t('<div class="table-wrapper"/>').appendTo(this.$body),this._initCombinedTable()},loadingAjax:function(t,e,i){var a=this;if(!this.isLoading){var n=FXM.UI.createLoadIcon().appendTo(this.element);this.isLoading=!0,FXM.Utils.dataAjax(t,function(t,i){return FXM.Utils.applyFunc(a,e,[t,i],!1)},function(t,e){return FXM.Utils.applyFunc(a,i,[t,e],!1)},function(){a.isLoading=!1,n.remove(),a.setReloadState(!1)})}},setReloadState:function(t,e){this.needReload=t,t&&(this._linkFilterParam=e)},reload:function(t){(t||this.needReload)&&this._reloadData()},_getLinkFilterParams:function(e){var i=this.options,a=[];return FXM.Utils.forEach(e,function(e,n){var r={method:n.method,type:n.type,value:n.value,keyType:n.keyType};a.push(t.extend(r,FXM.Utils.dealFilterInfoByField({id:i.form,name:n.field})))}),a},getFilterData:function(){var t=this.options,e=FXM.Utils.applyFunc(this,t.onDataFilter,[],!1),i=[];return e&&(i=i.concat(e)),FXM.Utils.isObjectEmpty(this._linkFilterParam)||(i=i.concat(this._linkFilterParam)),FXM.Utils.isObjectEmpty(i)?{}:{cond:i,rel:FXM.CONSTS.FILTER_RELATION.AND}},createTable:function(){this.table?this.table.reload(this._getTableRenderData()):this.table=this._doCreateTable()},_doCreateTable:function(){var e=this,i=this.options;return new FXM.PlainTable(t.extend({render:this.$wrapper,isHeadSticky:!0,onScrollBottom:function(){e.loadMore()},onCellClick:function(t){var a=t.data("id");if(a){var n=e._getLinkParams(a);n=e._getLinkFilterParams(n),FXM.Utils.applyFunc(e,i.onItemClick,[n],!1)}}},this._getTableRenderData()))},_getTableRenderData:function(){return{tableHead:this.tableHead,tableData:this.tableData,tableRowHead:this.tableRowHead}},_initCombinedTable:function(){var t=this,e=this.options;this.tableHead=[],this.tableRowHead=[],this.tableData=[],this.rowCount=0,this._isFieldsValid()?this.loadingAjax({url:e.asyncURL,data:{widgetId:e.widgetName,linkWidgets:e.linkWidgets,filter:this.getFilterData()}},function(e){if(t.page=1,t._isTableEmpty(e)){var i=!FXM.Utils.isObjectEmpty(t.getFilterData())?"":"";FXM.UI.createEmptyTip({msg:i}).appendTo(t.$body)}else t._dealTableInfo(e),t.rowCount=t.tableData.length,t._chunkTable();t.createTable()},function(i){FXM.Utils.applyFunc(t,e.onLoadFail,[i],!1)}):this.createTable()},_isTableEmpty:function(t){return 0===t.data.x.length&&0===t.data.val.length},_dealTableInfo:function(t){var e=this.options;this.tableHead=[],this.tableRowHead=[],this.tableData=[],this.colDataArr=[],this.rowDataArr=[],this.rowHeadTitleCols=Math.max(1,e.xFields.length);for(var i=e.yFields.length+1,a=0;a<i;a++)this.tableHead.push([]);this._createColHeadTitle(),this._createRowHeadTitle(),this._createRowHead(t),this._createColHeadAndData(t)},_chunkTable:function(){var e=this,i=this.options;this.rowHeadChunks=[],FXM.Utils.forEach(this.tableRowHead,function(a,n){var r=null,s=FXM.Utils.chunkArray(n,i.chunkSize);FXM.Utils.forEach(s,function(i,a){r&&r.rowspan&&(a[0]=r);for(var n=a.length-1;n>=0;n--){var s=a[n];if(s){s.rowspan>=a.length-n&&(r=t.extend({},s),s.rowspan=a.length-n,r.rowspan-=s.rowspan);break}}e.rowHeadChunks[i]=e.rowHeadChunks[i]||[],e.rowHeadChunks[i].push(a)})}),this.dataChunks=FXM.Utils.chunkArray(this.tableData,i.chunkSize);var a=this._getPageData();this.tableHead=a.tableHead,this.tableRowHead=a.tableRowHead,this.tableData=a.tableData},_getPageData:function(){return{tableHead:this.tableHead,tableRowHead:this.rowHeadChunks[this.page-1],tableData:this.dataChunks[this.page-1]}},_createColHeadTitle:function(){var t=this,e=this.options;FXM.Utils.forEach(e.yFields,function(e,i){t.tableHead[e].push({rowspan:1,colspan:t.rowHeadTitleCols,text:i.title,cls:"group-head"})})},_createRowHeadTitle:function(){var t=this.options,e=this.tableHead[t.yFields.length],i=1;t.xFields.length<this.rowHeadTitleCols&&(i=this.rowHeadTitleCols),t.xFields.length||e.push({colspan:this.rowHeadTitleCols,cls:"group-head"}),FXM.Utils.forEach(t.xFields,function(t,a){e.push({colspan:i,text:a.title,cls:"group-head"})})},_createColHeadAndData:function(t){for(var e=this,i=this.options,a=t.data.val,n=a[0].data.length,r=this.tableHead,s=this.tableData,o=0;o<n;o++)s.push([]);var l=[];s.push(l);var c=null;this._initValueFieldMap(),FXM.Utils.forEach(a,function(n,o){o.is_summary_col&&i.yFields.length&&(c?c.colspan+=1:(c={text:"",rowspan:i.yFields.length,colspan:1},r[0].push(c)));var h=!0;FXM.Utils.forEach(o.y,function(s,l){var c=e._getLastCell(r[s]);(h=0!==n&&(h&&e._compareCell(a[n-1].y[s],l)))?c.colspan+=1:r[s].push({colspan:1,text:e._getGroupText(l,i.yFields[s],t),data:{id:e._getColHeadCellData(o.y,s)},cls:"clickable"})}),r[i.yFields.length].push({text:e._getMetricTitle(t.metrics,o.tag)}),FXM.Utils.forEach(o.data,function(i,a){var r={};r=FXM.Utils.isNull(a)?{text:"-",cls:"h-center"}:{field:o.tag,text:e._getFormatText(a,o.tag),cls:"h-right clickable",data:{id:e._getCellData(t,i,n)}},s[i].push(r)}),l.push({field:o.tag,text:e._getFormatText(o.sum,o.tag),cls:"h-right clickable",data:{id:e._getColHeadCellData(o.y,o.y.length-1)}})})},_initValueFieldMap:function(){var t=this,e=this.options;this.valueFieldMap={},FXM.Utils.forEach(e.valueFields,function(e,i){t.valueFieldMap[i.tag]=i})},_getFormatText:function(t,e){var i=FXM.Utils.fixDecimalPrecision(t),a=this.valueFieldMap[e];return a.format&&(i=FXM.Utils.num2Str(i,a.format)||"_"),i},_compareCell:function(e,i){var a=e===i;return t.isPlainObject(e)&&t.isPlainObject(i)&&(a=!0,FXM.Utils.forEach(e,function(t,e){if(e!==i[t])return a=!1,!1})),a},_getMetricTitle:function(t,e){var i="";return FXM.Utils.forEach(t,function(t,a){if(a.tag===e)return i=a.title,!1}),i},_getColHeadCellData:function(t,e){for(var i=this.options,a={},n=0;n<=e;n++){var r=i.yFields[n];a[r.groupName||r.tag]=t[n]}return a},_getRowHeadCellData:function(t,e,i){for(var a=this.options,n={},r=0;r<=i;r++){var s=a.xFields[r];n[s.groupName||s.tag||s.name]=t[r].data[e]}return n},_getCellData:function(e,i,a){var n=this.options,r=this.colDataArr[a],s=this.rowDataArr[i];return r||(r=this._getColHeadCellData(e.data.val[a].y,n.yFields.length-1),this.colDataArr[a]=r),s||(s=this._getRowHeadCellData(e.data.x,i,n.xFields.length-1),this.rowDataArr[i]=s),t.extend({},s,r)},_createRowHead:function(t){var e=this,i=this.options,a=t.data.x,n=this.tableRowHead;if(a.length)for(var r=0;r<a.length;r++)n.push([]);else n.push([]);FXM.Utils.forEach(a,function(r,s){var o=null;FXM.Utils.forEach(s.data,function(l,c){var h=!1;if(l>0&&(h=e._compareCell(s.data[l-1],c),r>0&&(h=h&&FXM.Utils.isNull(n[r-1][l]))),h)o.rowspan+=1,n[r].push(null);else{var u=1;i.xFields.length<e.rowHeadTitleCols&&(u=e.rowHeadTitleCols),o={colspan:u,rowspan:1,text:e._getGroupText(c,i.xFields[r],t),data:{id:e._getRowHeadCellData(a,l,r)},cls:"clickable"},n[r].push(o)}})}),n[0].push({text:"",colspan:this.rowHeadTitleCols})},_getGroupText:function(t,e,i){var a=t;switch(e.type){case"user":var n=i.user[t];a=n?n.nickname:t;break;case"dept":var r=i.department[t];a=r?r.name:t;break;case"datetime":a=FXM.Utils.date2GroupStr(t,e.groupRule||"year");break;case"location":case"address":a="";var s=e.groupRule.split("_");FXM.Utils.forEach(s,function(e,i){a+=t[i]})}return a},_getLastCell:function(t){return t.length?t[t.length-1]:null},loadMore:function(e){this.hasMore()&&!this.isLoading&&(this.page++,t.extend(this,this._getPageData()),this.appendData(),this.table&&!this.table.isScrollToBottom()?this.loadMore(e):e&&e())},hasMore:function(){var t=this.options;return this.page*t.chunkSize<this.rowCount},appendData:function(){var t=this._getPageData();this.table&&this.table.appendData(t.tableData,t.tableRowHead)},_isFieldsValid:function(){var t=this.options,e=!0;return e&=!FXM.Utils.isEmpty(t.form),e&=0!==t.valueFields.length,!!(e&=0!==t.xFields.length||0!==t.yFields.length)},refresh:function(){this.tableRowHead=[],this.createTable()},resize:function(t){FXM.DashPivotTable._super.resize.apply(this,arguments),this.table&&this.table.resize()},_getLinkParams:function(e){var i=this;if(e){var a=[];return FXM.Utils.forEach(e,function(n){var r=i._getFieldByName(n),s=e[n];switch(r.type){case"datetime":s=FXM.Utils.getDateRange(s);break;case"address":case"location":s=FXM.Utils.getArrayFromRange(s,"address")}a.push(t.extend(FXM.Utils.getLinkFilter(r,s),{field:r.name}))}),a}},_getFieldByName:function(t){var e=this.options,i=[].concat(e.xFields,e.yFields),a=null;return FXM.Utils.forEach(i,function(e,i){if((i.tag||i.name)===t)return a=i,!1}),a},_reloadData:function(){t(".x-empty-info",this.element).remove(),this._initCombinedTable()}}),FXM.register("dashpivottable",FXM.DashPivotTable)}(Zepto),function(t){FXM.DashParameter=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.DashParameter._super._defaults.apply(this,arguments),{baseCls:"x-dash-parameter",fields:[],showFields:null,filter:null,authGroupId:null,changeable:!1,onBeforeConvertField:null,onStopEdit:null,onStopChange:null})},_init:function(){FXM.DashParameter._super._init.apply(this,arguments);var e=this;this.childWidgets={},this.$wrapper=t('<div class="x-parameter-wrapper"/>').appendTo(this.element),FXM.Utils.forEach(this.options.fields,function(t,i){e._createItem(i)})},_createItem:function(e){var i=this.options,a=this,n=t('<div class="x-parameter-cell"/>').appendTo(this.$wrapper),r=this._getConfigFromItem(e);if(r){t('<div class="cell-title">'+r.title+"</div>").appendTo(n);var s=FXM.createWidget(t.extend({render:t("<div />").appendTo(n),onStopEdit:function(){var t=JSON.stringify(this.getValue());this.oldValue&&this.oldValue==t||(this.oldValue=t,FXM.Utils.applyFunc(a,i.onStopEdit,[],!1))}},r)),o=this._parseDefaultValue(e);o&&this._setWidgetValue(s,o),this.childWidgets[s.getWidgetName()]={widget:s,field:e}}},_getConfigFromItem:function(e){var i=this.options,a={title:e.text};if(!1===FXM.Utils.applyFunc(this,i.onBeforeConvertField,[a,e],!1))switch(e.type){case"text":case"textarea":case"radiogroup":case"combo":t.extend(a,this._getComboConfig(e));break;case"checkboxgroup":case"combocheck":t.extend(a,this._getComboConfig(e,!1));break;case"number":a.type="numberlimit";break;case"datetime":a.type="datelimit",a.format=e.format;break;case"address":a.type="address",a.needDetail=!1;break;case"dept":case"deptgroup":a.type="deptselect";break;case"user":t.extend(a,this._getUserConfig(e));break;case"usergroup":t.extend(a,this._getUserConfig(e,!1))}return FXM.Utils.isNull(a.type)?null:a},_parseDefaultValue:function(t){if(t.defaultValue){var e;if("user"!==t.type&&"creator"!==t.name||!t.defaultValue)e=t.defaultValue;else{var i=[].concat(t.defaultValue.items||[]),a=i.indexOf(FXM.CONSTS.USER_ID.CurrentUser);a>-1&&(!FXM.GB.user._id||i.indexOf(FXM.GB.user._id)>-1?i.splice(a,1):i[a]=FXM.GB.user._id),e={items:i,hasEmpty:t.defaultValue.hasEmpty}}return e}},_getComboConfig:function(t,e){var i=this.options,a=FXM.Utils.getFieldInfoById(t.id);return e=!1!==e,{type:"combocheck",hasSelectEmpty:e,hasLimit:!0,async:{url:FXM.Utils.getApi(FXM.API.dash.distinct),data:{refAppId:a.appId,formId:a.entryId,field:t.name,type:t.type,authGroupId:i.authGroupId,filter:i.filter}}}},_getUserConfig:function(e,i){return t.extend(this._getComboConfig(e,i),{type:"usercheck",textField:"nickname",valueField:"_id"})},_reload:function(){var e=this,i=this.options;t(".x-parameter-cell",this.$wrapper).remove(),this.childWidgets={},FXM.Utils.forEach(i.fields,function(t,i){e._createItem(i)})},checkValidate:function(){if(!this.options.allowBlank){var t=!0;for(var e in this.childWidgets){var i=this.childWidgets[e].widget;if(i){switch(i.options.type){case"usercheck":case"combocheck":var a=i.getJsonValue();t=!!a.hasEmpty||!FXM.Utils.isObjectEmpty(a.items);break;default:var n=i.getValue();t=!FXM.Utils.isObjectEmpty(n)}if(!t)break}}return t}return!0},_checkWidgetValue:function(t,e){var i=!1;switch(t){case"combocheck":case"usercheck":case"deptselect":i=e.hasEmpty||!FXM.Utils.isObjectEmpty(e.value);break;default:e.value&&e.value.length>0&&FXM.Utils.forEach(e.value,function(t,e){if(!FXM.Utils.isNull(e))return i=!0,!1})}return i},_getFilterByWidget:function(e,i){var a=FXM.Utils.getFieldInfoById(i.id),n={type:i.type,entryId:a.entryId,appId:a.appId};t.extend(n,FXM.Utils.dealFilterFieldName(i)),i.triggers&&i.triggers.length&&(n.triggers=i.triggers);var r=e.getValue();switch(e.options.type){case"usercheck":r=e.getJsonValue();s="user"===i.type?FXM.CONSTS.FILTER_METHOD.IN:FXM.CONSTS.FILTER_METHOD.ALL;t.extend(n,{method:s,value:r.items,hasEmpty:!!r.hasEmpty});break;case"combocheck":r=e.getJsonValue();var s,o;"combocheck"===i.type||"checkboxgroup"===i.type?(s=FXM.CONSTS.FILTER_METHOD.ALL,o="combocheck"):(s=FXM.CONSTS.FILTER_METHOD.IN,o="text"),t.extend(n,{method:s,type:o,value:r.items,hasEmpty:!!r.hasEmpty});break;case"deptselect":t.extend(n,{method:FXM.CONSTS.FILTER_METHOD.IN,value:r.items,hasEmpty:!!r.hasEmpty,hasCurrentDept:!!r.hasCurrentDept});break;case"deptgroup":t.extend(n,{method:FXM.CONSTS.FILTER_METHOD.ALL,value:r});break;case"datelimit":t.extend(n,{method:FXM.CONSTS.FILTER_METHOD.RG,value:FXM.Utils.getArrayFromRange(r,"datetime",i.format)});break;case"numberlimit":t.extend(n,{method:FXM.CONSTS.FILTER_METHOD.RG,value:FXM.Utils.getArrayFromRange(r,"number")});break;case"address":t.extend(n,{method:FXM.CONSTS.FILTER_METHOD.ALL,value:FXM.Utils.getArrayFromRange(r,"address")})}return n},_setWidgetValue:function(t,e){switch(t.options.type){case"combocheck":t.setJsonValue(e);break;default:t.setValue(e)}},getValue:function(){var t=[];for(var e in this.childWidgets){var i=this.childWidgets[e].widget;if(i){var a=this.childWidgets[e].field,n=this._getFilterByWidget(i,a);this._checkWidgetValue(i.options.type,n)&&t.push(n)}}return t},setValue:function(t){var e=this;FXM.Utils.forEach(t,function(t,i){var a=e.childWidgets[t];a&&e._setWidgetValue(a,i)})}}),FXM.register("dashparameter",FXM.DashParameter)}(Zepto),function(t){FXM.FlowPath=FXM.extend(FXM.Widget,{CONST:{space:20,strokeWidth:"2",fill:"#fff",fillOpacity:"0",nodeWidth:160,nodeHeight:40,arrow:6,offset:5,corner:3},_defaults:function(){return t.extend(FXM.FlowPath._super._defaults.apply(),{baseCls:"x-flow-path",source:null,target:null,points:null,onDragStart:null,onDragMove:null,onDragEnd:null,onPointMove:null,onPointChange:null,stroke:"#0db3a6",editable:!0})},_init:function(){FXM.FlowPath._super._init.apply(this,arguments);var t=this.options,e=t.target,i=t.source;if(e&&i){var a=this._computeNodePoint(i),n=this._computeNodePoint(e);t.points?this.points=t.points:this.points=this._getPoints(a,n),this._createMain(a,n,this.points)}},_createMain:function(t,e,i){var a=this._createPath(t,e,i);a&&(this.$p?(this.$p.attr("d",a),this.$wrapper.attr("d",a)):(this.$wrapper=this._createLine({d:a,stroke:this.CONST.fill,"stroke-width":2*this.CONST.strokeWidth}).appendTo(this.element),this.$p=this._createLine({d:a}).appendTo(this.element)),i.length>0?this._createArrow(e,{x:i.slice(-1)[0][0],y:i.slice(-1)[0][1]}):this._createArrow(e,t))},_computeNodePoint:function(t){var e=t.x,i=t.y,a=this.CONST.nodeWidth,n=this.CONST.nodeHeight;switch(t.port){case"T":return{x:e+a/2,y:i,p:"T"};case"L":return{x:e,y:i+n/2,p:"L"};case"B":return{x:e+a/2,y:i+n,p:"B"};case"R":return{x:e+a,y:i+n/2,p:"R"};default:return}},_createPath:function(t,e,i){if(t.x===e.x&&t.y===e.y)return null;var a=this;if(i.length){var n="",r=[[t.x,t.y]].concat(i).concat([[e.x,e.y]]);return FXM.Utils.forEach(r,function(t,e){if(0===t)n+="M"+e[0]+","+e[1];else if(t===r.length-1)n+=" L"+e[0]+","+e[1];else{var i=r[t-1],s=r[t+1];n+=a._createL(i,e,s)}}),n}return"M"+t.x+","+t.y+" L"+e.x+","+e.y},_createL:function(t,e,i){var a=this.CONST.corner;return t[0]===e[0]?t[1]<e[1]?e[0]<i[0]?" L"+e[0]+","+(e[1]-a)+this._createCorner("RB",0):" L"+e[0]+","+(e[1]-a)+this._createCorner("LB",1):e[0]<i[0]?" L"+e[0]+","+(e[1]+a)+this._createCorner("RT",1):" L"+e[0]+","+(e[1]+a)+this._createCorner("LT",0):t[0]<e[0]?e[1]>i[1]?" L"+(e[0]-a)+","+e[1]+this._createCorner("RT",0):" L"+(e[0]-a)+","+e[1]+this._createCorner("RB",1):e[1]>i[1]?" L"+(e[0]+a)+","+e[1]+this._createCorner("LT",1):" L"+(e[0]+a)+","+e[1]+this._createCorner("LB",0)},_createCorner:function(t,e){var i=this.CONST.corner,a=[i,i,0,0];switch(a.push(e),t){case"RB":return"a"+a.concat([i,i]).join(" ");case"LB":return"a"+a.concat([-i,i]).join(" ");case"RT":return"a"+a.concat([i,-i]).join(" ");case"LT":return"a"+a.concat([-i,-i]).join(" ");default:return}},_createArrow:function(t,e){var i=this.CONST.arrow,a="M"+t.x+","+t.y,n=a+" L",r=a+" L";t.y===e.y&&(t.x>e.x?(n+=t.x-i+","+(t.y-i),r+=t.x-i+","+(t.y+i)):(n+=t.x+i+","+(t.y-i),r+=t.x+i+","+(t.y+i))),t.x===e.x&&(t.y>e.y?(n+=t.x-i+","+(t.y-i),r+=t.x+i+","+(t.y-i)):(n+=t.x-i+","+(t.y+i),r+=t.x+i+","+(t.y+i))),this.$arrow1?this.$arrow1.attr("d",n):this.$arrow1=this._createLine({d:n}).appendTo(this.element),this.$arrow2?this.$arrow2.attr("d",r):this.$arrow2=this._createLine({d:r}).appendTo(this.element)},_getPoints:function(t,e){if(t.x===e.x&&t.y===e.y)return[];var i=this._compute(t,e),a=this._compute(e,t);return i.length>a.length?a.reverse():i},_compute:function(t,e){var i=t.x,a=t.y,n=e.x,r=e.y,s=this._sourceRangeEnd(t),o=this._sourceRangeEnd(e),l=this._getRangePoint({sp:[i,a],ep:s},{sp:[n,r],ep:o});if(0===l.length){var c,h,u=this._getFirstPoint(t,e);u[1]===t.y?(c=e.y>u[1]?[u[0],"inf"]:[u[0],0],h=!0):u[0]===t.x&&(c=e.x>u[0]?["inf",u[1]]:[0,u[1]],h=!1);var d={sp:u,ep:c},p=this._getRangePoint(d,{sp:[n,r],ep:o});if(0===p.length)return this._computeBaseTarget(t,e,u,h,d);if(1===p.length)return[u,p[0]];if(2===p.length)return[u]}else{if(1===l.length)return[l[0]];if(2===l.length)return[]}},_computeBaseTarget:function(t,e,i,a,n){var r,s,o=this._getFirstPoint(e,t);o[1]===e.y?(r=i[1]>o[1]?[o[0],"inf"]:[o[0],0],s=!0):o[0]===e.x&&(r=i[0]>o[0]?["inf",o[1]]:[0,o[1]],s=!1);var l={sp:o,ep:r},c=this._getRangePoint(l,n);return 0===c.length?this._computeBaseSecond(i,o,a,s,l):1===c.length?[i,c[0],o]:2===c.length?[i,c[0]]:void 0},_computeBaseSecond:function(t,e,i,a,n){var r,s=this.CONST,o=s.space,l=s.nodeHeight,c=s.nodeWidth;if(i){var h;h=t[1]===e[1]?t[1]-l/2-o:(t[1]+e[1])/2,r=[t[0],h]}else{r=[t[0]===e[0]?t[0]-c/2-o:(t[0]+e[0])/2,t[1]]}var u;return u=a?e[0]>r[0]?["inf",r[1]]:[0,r[1]]:e[1]>r[1]?[r[0],"inf"]:[r[0],0],[t,r,this._getRangePoint({sp:r,ep:u},n)[0],e]},_getFirstPoint:function(t,e){var i,a,n=this.CONST,r=n.space,s=(n.nodeHeight,n.nodeWidth,t.x),o=t.y;e.x,e.y;switch(t.p){case"L":return(i=(t.x+e.x)/2)>=t.x?[t.x-r,o]:[i,o];case"R":return(i=(t.x+e.x)/2)<=t.x?[t.x+r,o]:[i,o];case"T":return(a=(t.y+e.y)/2)>=t.y?[s,o-r]:[s,a];case"B":return(a=(t.y+e.y)/2)<=t.y?[s,o+r]:[s,a];default:return}},_sourceRangeEnd:function(t){var e=t.x,i=t.y;switch(t.p){case"L":return[0,i];case"R":return["inf",i];case"T":return[e,0];case"B":return[e,"inf"]}},_getRangePoint:function(t,e){var i=this._getVert(t),a=this._getVert(e);if(i===a)return this._getParallelPoints(i,a,t,e);var n,r;return"v"===i?(r=t.sp[1],n=e.sp[0]):(n=t.sp[0],r=e.sp[1]),this._isPointInLine([n,r],t)&&this._isPointInLine([n,r],e)?[[n,r]]:[]},_getParallelPoints:function(t,e,i,a){var n="v"===t?0:1,r="v"===t?1:0;return i.sp[r]===a.sp[r]?i.ep[n]===a.ep[n]?[]:this._getMutualPoints(i,a,n):[]},_getMutualPoints:function(t,e,i){var a=0===t.ep[i];return t.sp[i]-e.sp[i]>0?a?[t.sp,e.sp]:[]:a?[]:[t.sp,e.sp]},_isPointInLine:function(t,e){var i=this._getVert(e),a="v"===i?0:1,n="v"===i?1:0;return t[n]===e.sp[n]&&(0===e.ep[a]?t[a]<e.sp[a]:t[a]>e.sp[a])},_isPointOnPath:function(t){var e=this.options,i=e.target,a=e.source,n=this.CONST.offset,r=this._computeNodePoint(a),s=this._computeNodePoint(i),o=[[r.x,r.y]].concat(this.points);o.push([s.x,s.y]),o.reverse();for(var l=!1,c=1;c<o.length;c++){var h,u,d,p,f=o[c-1],m=o[c];if(h=m[0]>=f[0]?f[0]-n:m[0]-n,u=m[1]>=f[1]?f[1]-n:m[1]-n,d=h+Math.abs(f[0]-m[0]+2*n),p=u+Math.abs(f[1]-m[1]+2*n),t[0]>=h&&t[0]<=d&&t[1]>=u&&t[1]<=p){l=!0;break}}return l},_getVert:function(t){return t.sp[1]===t.ep[1]?"v":"h"},_createLine:function(e){var i=this.options,a=FXM.Utils.createSvgEl("path");return a.attr(t.extend({stroke:i.stroke,"stroke-width":this.CONST.strokeWidth,fill:this.CONST.fill,"fill-opacity":this.CONST.fillOpacity},e)),a}})}(Zepto),function(t){FXM.FlowNode=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.FlowNode._super._defaults.apply(),{baseCls:"x-flow-node",name:"",icon:"",loc:{},menu:"",anchors:["T","R","B","L"],width:160,height:30,source:!0,target:!0,invalid:!1})},_init:function(){FXM.FlowNode._super._init.apply(this,arguments),this._createNode(),this._resize()},_createNode:function(){var e=this.options,i=this;this.setLoc(e.loc,!0),this.element.append('<i class="node-icon '+e.icon+'"/>').append(t('<div class="node-name"/>').text(e.name)).on("click",function(){FXM.Utils.applyFunc(i,e.onClick,[e.id],!1)}),e.menu&&this.element.addClass("menu").append('<i class="node-menu '+e.menu+'"/>'),e.invalid&&this.element.addClass("invalid")},setLoc:function(t,e){this.element.css({top:t.y,left:t.x}),e&&(this.loc={x:t.x,y:t.y})},_resize:function(){var t=this.options;FXM.Utils.isEmpty(t.width)||this.element.css({width:t.width}),FXM.Utils.isEmpty(t.height)||this.element.css({height:t.height})},getOffset:function(){return this.loc},getSize:function(){return{width:this.options.width,height:this.options.height}},getMove:function(){return this.move}})}(Zepto),function(t){FXM.FlowChart=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.FlowChart._super._defaults.apply(),{baseCls:"x-flow-chart",editable:!1,nodes:[],paths:[],onNodeClick:null,gap:20,offset:{x:0,y:0}})},_init:function(){FXM.FlowChart._super._init.apply(this,arguments),this._initFlowChart()},_initFlowChart:function(){var e=this.options;this.$container=t('<div class="chart-container"/>').appendTo(this.element),this._createChart(e.nodes,e.paths),this.resize()},_createChart:function(e,i){var a=this.options,n=this;this.$main?this.$main.empty():this.$main=t('<div class="chart-content"/>').appendTo(this.$container);var r={},s=a.offset;FXM.Utils.forEach(e,function(e,i){s.x&&(i.x-=s.x),s.y&&(i.y-=s.y),r[i.flowId]=new FXM.FlowNode({render:t("<div/>").appendTo(n.$main),customCls:"flow-selector  "+i.customCls,id:i.flowId,name:i.name,icon:i.icon,menu:i.menu,loc:{x:i.x,y:i.y},invalid:i.invalid,source:i.source,target:i.target,editable:i.editable,width:a.nodeWidth,height:a.nodeHeight,onClick:function(t){FXM.Utils.applyFunc(n,a.onNodeClick,[t],!1)}})});var o=FXM.Utils.createSvgEl("svg").appendTo(this.$main),l={};FXM.Utils.forEach(i,function(t,e){var i=[e.source.id,e.target.id].join(" "),s=r[e.source.id].getOffset(),c=r[e.target.id].getOffset(),h=e.source.port||"B",u=e.target.port||"T";e.source.id===e.target.id&&h===u&&(u=n._getOppositePort(h)),l[i]=new FXM.FlowPath({render:FXM.Utils.createSvgEl("g").appendTo(o),customCls:"flow-selector",id:i,editable:a.editable,stroke:e.stroke,source:{id:e.source.id,x:s.x,y:s.y,port:h,width:a.nodeWidth,height:a.nodeHeight},target:{id:e.target.id,x:c.x,y:c.y,port:u,width:a.nodeWidth,height:a.nodeHeight}})}),this.nodeMap=r,this.pathMap=l},_getOppositePort:function(t){switch(t){case"B":return"T";case"T":return"B";case"L":return"R";case"R":return"L"}},resize:function(){var t=this.options,e=0,i=0;FXM.Utils.forEach(this.nodeMap,function(t,a){var n=a.getOffset(),r=a.getSize(),s=a.getMove(),o=n.x+r.width,l=n.y+r.height;s&&(o+=s.x,l+=s.y),e=Math.max(e,o),i=Math.max(i,l)}),(!this.maxWidth||e>this.maxWidth)&&(this.maxWidth=e),(!this.maxHeight||i>this.maxHeight)&&(this.maxHeight=i),this.$main.css({width:this.maxWidth+2*t.gap,height:this.maxHeight+2*t.gap})}})}(Zepto),function(t,e){"function"==typeof define&&define.amd?define([],e):t.VanCharts=e()}(this,function(){var requirejs,require,define;!function(t){function e(t,e){return v.call(t,e)}function i(t,e){var i,a,n,r,s,o,l,c,h,u,d,p=e&&e.split("/"),f=m.map,g=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(e){for(s=(t=t.split("/")).length-1,m.nodeIdCompat&&M.test(t[s])&&(t[s]=t[s].replace(M,"")),t=p.slice(0,p.length-1).concat(t),h=0;h<t.length;h+=1)if("."===(d=t[h]))t.splice(h,1),h-=1;else if(".."===d){if(1===h&&(".."===t[2]||".."===t[0]))break;h>0&&(t.splice(h-1,2),h-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||g)&&f){for(h=(i=t.split("/")).length;h>0;h-=1){if(a=i.slice(0,h).join("/"),p)for(u=p.length;u>0;u-=1)if((n=f[p.slice(0,u).join("/")])&&(n=n[a])){r=n,o=h;break}if(r)break;!l&&g&&g[a]&&(l=g[a],c=h)}!r&&l&&(r=l,o=c),r&&(i.splice(0,o,r),t=i.join("/"))}return t}function a(e,i){return function(){var a=y.call(arguments,0);return"string"!=typeof a[0]&&1===a.length&&a.push(null),h.apply(t,a.concat([e,i]))}}function n(t){return function(e){return i(e,t)}}function r(t){return function(e){p[t]=e}}function s(i){if(e(f,i)){var a=f[i];delete f[i],g[i]=!0,c.apply(t,a)}if(!e(p,i)&&!e(g,i))throw new Error("No "+i);return p[i]}function o(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function l(t){return function(){return m&&m.config&&m.config[t]||{}}}var c,h,u,d,p={},f={},m={},g={},v=Object.prototype.hasOwnProperty,y=[].slice,M=/\.js$/;u=function(t,e){var a,r=o(t),l=r[0];return t=r[1],l&&(l=i(l,e),a=s(l)),l?t=a&&a.normalize?a.normalize(t,n(e)):i(t,e):(t=i(t,e),r=o(t),l=r[0],t=r[1],l&&(a=s(l))),{f:l?l+"!"+t:t,n:t,pr:l,p:a}},d={require:function(t){return a(t)},exports:function(t){var e=p[t];return void 0!==e?e:p[t]={}},module:function(t){return{id:t,uri:"",exports:p[t],config:l(t)}}},c=function(i,n,o,l){var c,h,m,v,y,M,F=[],_=typeof o;if(l=l||i,"undefined"===_||"function"===_){for(n=!n.length&&o.length?["require","exports","module"]:n,y=0;y<n.length;y+=1)if(v=u(n[y],l),"require"===(h=v.f))F[y]=d.require(i);else if("exports"===h)F[y]=d.exports(i),M=!0;else if("module"===h)c=F[y]=d.module(i);else if(e(p,h)||e(f,h)||e(g,h))F[y]=s(h);else{if(!v.p)throw new Error(i+" missing "+h);v.p.load(v.n,a(l,!0),r(h),{}),F[y]=p[h]}m=o?o.apply(p[i],F):void 0,i&&(c&&c.exports!==t&&c.exports!==p[i]?p[i]=c.exports:m===t&&M||(p[i]=m))}else i&&(p[i]=o)},requirejs=require=h=function(e,i,a,n,r){if("string"==typeof e)return d[e]?d[e](i):s(u(e,i).f);if(!e.splice){if((m=e).deps&&h(m.deps,m.callback),!i)return;i.splice?(e=i,i=a,a=null):e=t}return i=i||function(){},"function"==typeof a&&(a=n,n=r),n?c(t,e,i,a):setTimeout(function(){c(t,e,i,a)},4),h},h.config=function(t){return h(t)},requirejs._defined=p,(define=function(t,i,a){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");i.splice||(a=i,i=[]),e(p,t)||e(f,t)||(f[t]=[t,i,a])}).amd={jQuery:!0}}(),define("almond",function(){}),function(t,e,i,a){"use strict";function n(t,e,i){return setTimeout(c(t,i),e)}function r(t,e,i){return!!Array.isArray(t)&&(s(t,i[e],i),!0)}function s(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==a)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function o(e,i,a){var n="DEPRECATED METHOD: "+i+"\n"+a+" AT \n";return function(){var i=new Error("get-stack-trace"),a=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",r=t.console&&(t.console.warn||t.console.log);return r&&r.call(t.console,n,a),e.apply(this,arguments)}}function l(t,e,i){var a,n=e.prototype;(a=t.prototype=Object.create(n)).constructor=t,a._super=n,i&&ht(a,i)}function c(t,e){return function(){return t.apply(e,arguments)}}function h(t,e){return typeof t==pt?t.apply(e?e[0]||a:a,e):t}function u(t,e){return t===a?e:t}function d(t,e,i){return s(g(e),function(e){t.addEventListener?"wheel"===e?t.addEventListener("onwheel"in t?"wheel":"mousewheel",i,!1):t.addEventListener(e,i,!1):t.attachEvent&&("wheel"==e&&(e="mousewheel"),t.attachEvent("on"+e,i))}),this}function p(t,e,i){s(g(e),function(e){t.removeEventListener?"wheel"===e?t.removeEventListener("onwheel"in t?"wheel":"mousewheel",i,!1):t.removeEventListener(e,i,!1):t.detachEvent&&("wheel"==e&&(e="mousewheel"),t.detachEvent("on"+e,i))})}function f(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function m(t,e){return t.indexOf(e)>-1}function g(t){return t.trim().split(/\s+/g)}function v(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var a=0;a<t.length;){if(i&&t[a][i]==e||!i&&t[a]===e)return a;a++}return-1}function y(t){return Array.prototype.slice.call(t,0)}function M(t,e,i){for(var a=[],n=[],r=0;r<t.length;){var s=e?t[r][e]:t[r];v(n,s)<0&&a.push(t[r]),n[r]=s,r++}return i&&(a=e?a.sort(function(t,i){return t[e]>i[e]}):a.sort()),a}function F(t,e){for(var i,n,r=e.charAt(0).toUpperCase()+e.slice(1),s=0;s<ut.length;){if(i=ut[s],(n=i?i+r:e)in t)return n;s++}return a}function _(){return _t++}function T(e){var i=e.ownerDocument||e;return i.defaultView||i.parentWindow||t}function b(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){h(t.options.enable,[t])&&i.handler(e)},this.init()}function x(t){return new(t.options.inputClass||(xt?R:Ct?G:bt?H:U))(t,C)}function C(t,e,i){var a=i.pointers.length,n=i.changedPointers.length,r=e&Et&&a-n==0,s=e&(Xt|St)&&a-n==0;i.isFirst=!!r,i.isFinal=!!s,r&&(t.session={}),i.eventType=e,w(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function w(t,e){var i=t.session,a=e.pointers,n=a.length;i.firstInput||(i.firstInput=X(e)),n>1&&!i.firstMultiple?i.firstMultiple=X(e):1===n&&(i.firstMultiple=!1);var r=i.firstInput,s=i.firstMultiple,o=s?s.center:r.center,l=e.center=S(a);e.timeStamp=yt(),e.deltaTime=e.timeStamp-r.timeStamp,e.angle=D(o,l),e.distance=L(o,l),E(i,e),e.offsetDirection=k(e.deltaX,e.deltaY);var c=I(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=c.x,e.overallVelocityY=c.y,e.overallVelocity=vt(c.x)>vt(c.y)?c.x:c.y,e.scale=s?P(s.pointers,a):1,e.rotation=s?O(s.pointers,a):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,A(i,e);var h=t.element;f(e.srcEvent.target,h)&&(h=e.srcEvent.target),e.target=h}function E(t,e){var i=e.center,a=t.offsetDelta||{},n=t.prevDelta||{},r=t.prevInput||{};e.eventType!==Et&&r.eventType!==Xt||(n=t.prevDelta={x:r.deltaX||0,y:r.deltaY||0},a=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=n.x+(i.x-a.x),e.deltaY=n.y+(i.y-a.y)}function A(t,e){var i,n,r,s,o=t.lastInterval||e,l=e.timeStamp-o.timeStamp;if(e.eventType!=St&&(l>wt||o.velocity===a)){var c=e.deltaX-o.deltaX,h=e.deltaY-o.deltaY,u=I(l,c,h);n=u.x,r=u.y,i=vt(u.x)>vt(u.y)?u.x:u.y,s=k(c,h),t.lastInterval=e}else i=o.velocity,n=o.velocityX,r=o.velocityY,s=o.direction;e.velocity=i,e.velocityX=n,e.velocityY=r,e.direction=s}function X(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:gt(t.pointers[i].clientX),clientY:gt(t.pointers[i].clientY)},i++;return{timeStamp:yt(),pointers:e,center:S(e),deltaX:t.deltaX,deltaY:t.deltaY}}function S(t){var e=t.length;if(1===e)return{x:gt(t[0].clientX),y:gt(t[0].clientY)};for(var i=0,a=0,n=0;n<e;)i+=t[n].clientX,a+=t[n].clientY,n++;return{x:gt(i/e),y:gt(a/e)}}function I(t,e,i){return{x:e/t||0,y:i/t||0}}function k(t,e){return t===e?It:vt(t)>=vt(e)?t<0?kt:Lt:e<0?Dt:Ot}function L(t,e,i){i||(i=Nt);var a=e[i[0]]-t[i[0]],n=e[i[1]]-t[i[1]];return Math.sqrt(a*a+n*n)}function D(t,e,i){i||(i=Nt);var a=e[i[0]]-t[i[0]],n=e[i[1]]-t[i[1]];return 180*Math.atan2(n,a)/Math.PI}function O(t,e){return D(e[1],e[0],Bt)+D(t[1],t[0],Bt)}function P(t,e){return L(e[0],e[1],Bt)/L(t[0],t[1],Bt)}function U(){this.evEl=Vt,this.evWin=Ht,this.pressed=!1,b.apply(this,arguments)}function R(){this.evEl=zt,this.evWin=jt,b.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=qt,this.evWin=Kt,this.started=!1,b.apply(this,arguments)}function B(t,e){var i=y(t.touches),a=y(t.changedTouches);return e&(Xt|St)&&(i=M(i.concat(a),"identifier",!0)),[i,a]}function G(){this.evTarget=Qt,this.targetIds={},b.apply(this,arguments)}function V(t,e){var i=y(t.touches),a=this.targetIds;if(e&(Et|At)&&1===i.length)return a[i[0].identifier]=!0,[i,i];var n,r,s=y(t.changedTouches),o=[],l=this.target;if(r=i.filter(function(t){return f(t.target,l)}),e===Et)for(n=0;n<r.length;)a[r[n].identifier]=!0,n++;for(n=0;n<s.length;)a[s[n].identifier]&&o.push(s[n]),e&(Xt|St)&&delete a[s[n].identifier],n++;return o.length?[M(r.concat(o),"identifier",!0),o]:void 0}function H(){b.apply(this,arguments);var t=c(this.handler,this);this.touch=new G(this.manager,t),this.mouse=new U(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function $(t,e){t&Et?(this.primaryTouch=e.changedPointers[0].identifier,W.call(this,e)):t&(Xt|St)&&W.call(this,e)}function W(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var a=this.lastTouches;setTimeout(function(){var t=a.indexOf(i);t>-1&&a.splice(t,1)},Jt)}}function z(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,a=0;a<this.lastTouches.length;a++){var n=this.lastTouches[a],r=Math.abs(e-n.x),s=Math.abs(i-n.y);if(r<=te&&s<=te)return!0}return!1}function j(t,e){this.manager=t,this.set(e)}function Y(t){if(m(t,re))return re;var e=m(t,se),i=m(t,oe);return e&&i?ne:e||i?e?se:oe:m(t,ne)?ne:ae}function q(t){this.options=ht({},this.defaults,t||{}),this.id=_(),this.manager=null,this.options.enable=u(this.options.enable,!0),this.state=ce,this.simultaneous={},this.requireFail=[]}function K(t){return t&fe?"cancel":t&de?"end":t&ue?"move":t&he?"start":""}function Z(t){return t==Ot?"down":t==Dt?"up":t==kt?"left":t==Lt?"right":""}function Q(t,e){var i=e.manager;return i?i.get(t):t}function J(){q.apply(this,arguments)}function tt(){J.apply(this,arguments),this.pX=null,this.pY=null}function et(){J.apply(this,arguments)}function it(){q.apply(this,arguments),this._timer=null,this._input=null}function at(){J.apply(this,arguments)}function nt(){J.apply(this,arguments)}function rt(){q.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function st(t,e){return e=e||{},e.recognizers=u(e.recognizers,st.defaults.preset),new ot(t,e)}function ot(t,e){this.options=ht({},st.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=x(this),this.touchAction=new j(this,this.options.touchAction),lt(this,!0),s(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function lt(t,e){var i=t.element;if(i.style){var a;s(t.options.cssProps,function(n,r){a=F(i.style,r),e?(t.oldCssProps[a]=i.style[a],i.style[a]=n):i.style[a]=t.oldCssProps[a]||""}),e||(t.oldCssProps={})}}function ct(t,i){var a=e.createEvent("Event");a.initEvent(t,!0,!0),a.gesture=i,i.target.dispatchEvent(a)}var ht,ut=["","webkit","Moz","MS","ms","o"],dt=e.createElement("div"),pt="function",ft=function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},mt=!t.SVGSVGElement,gt=Math.round,vt=Math.abs,yt=Date.now;ht="function"!=typeof Object.assign?function(t){if(t===a||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(n!==a&&null!==n)for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}:Object.assign;var Mt=o(function(t,e,i){for(var n=Object.keys(e),r=0;r<n.length;)(!i||i&&t[n[r]]===a)&&(t[n[r]]=e[n[r]]),r++;return t},"extend","Use `assign`."),Ft=o(function(t,e){return Mt(t,e,!0)},"merge","Use `assign`."),_t=1,Tt=/mobile|tablet|ip(ad|hone|od)|android/i,bt="ontouchstart"in t,xt=F(t,"PointerEvent")!==a,Ct=bt&&Tt.test(navigator.userAgent),wt=25,Et=1,At=2,Xt=4,St=8,It=1,kt=2,Lt=4,Dt=8,Ot=16,Pt=kt|Lt,Ut=Dt|Ot,Rt=Pt|Ut,Nt=["x","y"],Bt=["clientX","clientY"];b.prototype={handler:function(){},init:function(){this.evEl&&d(this.element,this.evEl,this.domHandler),this.evTarget&&d(this.target,this.evTarget,this.domHandler),this.evWin&&d(T(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(T(this.element),this.evWin,this.domHandler)}};var Gt={mousedown:Et,mousemove:At,mouseup:Xt},Vt="mousedown mousemove mouseout mouseover wheel",Ht="mousemove mouseup";mt&&(Vt="mousedown mousemove mouseout mouseover mouseup wheel",Ht="mousemove"),l(U,b,{handler:function(t){var e={pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t},i=Gt[t.type],a=mt?1===t.button:0===t.button;if(i&Et&&a&&(this.pressed=!0),i&At&&(mt?!this.pressed:1!==t.which)&&(i=Xt),this.pressed)i&Xt&&(this.pressed=!1),this.callback(this.manager,i,e);else{-1!=(i=t.type).indexOf("wheel")&&(i="wheel");var n=this.manager.handlers[i]&&this.manager.handlers[i].slice();if(n&&n.length)for(var r=0;r<n.length;)n[r](e),r++}}});var $t={pointerdown:Et,pointermove:At,pointerup:Xt,pointercancel:St,pointerout:St},Wt={2:"touch",3:"pen",4:"mouse",5:"kinect"},zt="pointerdown wheel",jt="pointermove pointerup pointercancel mousemove mouseout mouseover";t.MSPointerEvent&&!t.PointerEvent&&(zt="MSPointerDown mousemove mouseout mouseover wheel",jt="MSPointerMove MSPointerUp MSPointerCancel"),l(R,b,{handler:function(t){var e=this.store,i=!1,a=t.type.toLowerCase().replace("ms",""),n=$t[a],r=Wt[t.pointerType]||t.pointerType,s="touch"==r,o=v(e,t.pointerId,"pointerId");n&Et&&(0===t.button||s)?o<0&&(e.push(t),o=e.length-1):n&(Xt|St)&&(i=!0);var l={pointers:e,changedPointers:[t],pointerType:r,srcEvent:t};if(o<0){if(-1!="mousemove mouseout mouseover wheel".indexOf(t.type)){var c=this.manager.handlers[t.type]&&this.manager.handlers[t.type].slice();if(c&&c.length)for(var h=0;h<c.length;)c[h](l),h++}}else e[o]=t,this.callback(this.manager,n,l),i&&e.splice(o,1)}});var Yt={touchstart:Et,touchmove:At,touchend:Xt,touchcancel:St},qt="touchstart",Kt="touchstart touchmove touchend touchcancel";l(N,b,{handler:function(t){var e=Yt[t.type];if(e===Et&&(this.started=!0),this.started){var i=B.call(this,t,e);e&(Xt|St)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}});var Zt={touchstart:Et,touchmove:At,touchend:Xt,touchcancel:St},Qt="touchstart touchmove touchend touchcancel";l(G,b,{handler:function(t){var e=Zt[t.type],i=V.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}});var Jt=2500,te=25;l(H,b,{handler:function(t,e,i){var a="touch"==i.pointerType,n="mouse"==i.pointerType;if(!(n&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(a)$.call(this,e,i);else if(n&&z.call(this,i))return;this.callback(t,e,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ee=F(dt.style,"touchAction"),ie=ee!==a,ae="auto",ne="manipulation",re="none",se="pan-x",oe="pan-y",le=function(){if(!ie)return!1;var e={},i=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(a){e[a]=!i||t.CSS.supports("touch-action",a)}),e}();j.prototype={set:function(t){"compute"==t&&(t=this.compute()),ie&&this.manager.element.style&&le[t]&&(this._shouldChangeTouchAction=t===ne,this.manager.element.style[ee]=t),this.actions=t.toLowerCase().trim()},setTouchActionNone:function(){this._shouldChangeTouchAction&&(this.manager.element.style[ee]=re)},recoverTouchAction:function(){this._shouldChangeTouchAction&&(this.manager.element.style[ee]=ne)},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return s(this.manager.recognizers,function(e){h(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),Y(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=(t.offsetDirection,this.manager.options._handler);if(i&&i.preventDefault(t)&&!i.vanchart.isForceBubble()||this.manager.session.prevented)ft(e);else{var a=this.actions,n=m(a,re)&&!le[re];m(a,oe)&&le[oe],m(a,se)&&le[se];if(n){var r=1===t.pointers.length,s=t.distance<2,o=t.deltaTime<250;if(r&&s&&o)return}}},preventSrc:function(t){this.manager.session.prevented=!0,ft(t)}};var ce=1,he=2,ue=4,de=8,pe=de,fe=16;q.prototype={defaults:{},set:function(t){return ht(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(r(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=Q(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return r(t,"dropRecognizeWith",this)?this:(t=Q(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(r(t,"requireFailure",this))return this;var e=this.requireFail;return t=Q(t,this),-1===v(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(r(t,"dropRequireFailure",this))return this;t=Q(t,this);var e=v(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){i.manager.emit(e,t)}var i=this,a=this.state;a<de&&e(i.options.event+K(a)),e(i.options.event),t.additionalEvent&&e(t.additionalEvent),a>=de&&e(i.options.event+K(a))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|ce)))return!1;t++}return!0},recognize:function(t){var e=ht({},t);if(!h(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(pe|fe|32)&&(this.state=ce),this.state=this.process(e),this.state&(he|ue|de|fe)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},l(J,q,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,a=e&(he|ue),n=this.attrTest(t);return a&&(i&St||!n)?e|fe:a||n?i&Xt?e|de:e&he?e|ue:he:32}}),l(tt,J,{defaults:{event:"pan",threshold:10,pointers:1,direction:Rt},getTouchAction:function(){var t=this.options.direction,e=[];return t&Pt&&e.push(oe),t&Ut&&e.push(se),e},directionTest:function(t){var e=this.options,i=!0,a=t.distance,n=t.direction,r=t.deltaX,s=t.deltaY,o=this.manager.options._handler,l=o&&o.preventDefault(t);return n&e.direction||(e.direction&Pt?(n=0===r?It:r<0?kt:Lt,i=r!=this.pX,a=Math.abs(t.deltaX)):(n=0===s?It:s<0?Dt:Ot,i=s!=this.pY,a=Math.abs(t.deltaY))),t.direction=n,l&&i&&a>e.threshold&&n&e.direction},attrTest:function(t){return J.prototype.attrTest.call(this,t)&&(this.state&he||!(this.state&he)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Z(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),l(et,J,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[re]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&he)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),l(it,q,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ae]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,a=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!a||!i||t.eventType&(Xt|St)&&!r)this.reset();else if(t.eventType&Et)this.reset(),this._timer=n(function(){this.state=pe,this.tryEmit()},e.time,this);else if(t.eventType&Xt)return pe;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===pe&&(t&&t.eventType&Xt?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=yt(),this.manager.emit(this.options.event,this._input)))}}),l(at,J,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[re]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&he)}}),l(nt,J,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Pt|Ut,pointers:1},getTouchAction:function(){return tt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(Pt|Ut)?e=t.overallVelocity:i&Pt?e=t.overallVelocityX:i&Ut&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&vt(e)>this.options.velocity&&t.eventType&Xt},emit:function(t){var e=Z(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),l(rt,q,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ne]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,a=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&Et&&0===this.count)return this.failTimeout();if(a&&r&&i){if(t.eventType!=Xt)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||L(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&s?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=n(function(){this.state=pe,this.tryEmit()},e.interval,this),he):pe}return 32},failTimeout:function(){return this._timer=n(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==pe&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),st.VERSION="2.0.7",st.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[at,{enable:!1}],[et,{enable:!1},["rotate"]],[nt,{direction:Pt}],[tt,{direction:Pt},["swipe"]],[rt],[rt,{event:"doubletap",taps:2},["tap"]],[it]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},ot.prototype={set:function(t){return ht(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,a=this.recognizers,n=e.curRecognizer;(!n||n&&n.state&pe)&&(n=e.curRecognizer=null);for(var r=0;r<a.length;)i=a[r],2===e.stopped||n&&i!=n&&!i.canRecognizeWith(n)?i.reset():i.recognize(t),!n&&i.state&(he|ue|de)&&(n=e.curRecognizer=i),r++}},get:function(t){if(t instanceof q)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(r(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(r(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,i=v(e,t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==a&&e!==a){var i=this.handlers;return s(g(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this}},off:function(t,e){if(t!==a){var i=this.handlers;return s(g(t),function(t){e?i[t]&&i[t].splice(v(i[t],e),1):delete i[t]}),this}},emit:function(t,e){this.options.domEvents&&ct(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){ft(e.srcEvent)};for(var a=0;a<i.length;)i[a](e),a++}},destroy:function(){this.element&&lt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ht(st,{INPUT_START:Et,INPUT_MOVE:At,INPUT_END:Xt,INPUT_CANCEL:St,STATE_POSSIBLE:ce,STATE_BEGAN:he,STATE_CHANGED:ue,STATE_ENDED:de,STATE_RECOGNIZED:pe,STATE_CANCELLED:fe,STATE_FAILED:32,DIRECTION_NONE:It,DIRECTION_LEFT:kt,DIRECTION_RIGHT:Lt,DIRECTION_UP:Dt,DIRECTION_DOWN:Ot,DIRECTION_HORIZONTAL:Pt,DIRECTION_VERTICAL:Ut,DIRECTION_ALL:Rt,Manager:ot,Input:b,TouchAction:j,TouchInput:G,MouseInput:U,PointerEventInput:R,TouchMouseInput:H,SingleTouchInput:N,Recognizer:q,AttrRecognizer:J,Tap:rt,Pan:tt,Swipe:nt,Pinch:et,Rotate:at,Press:it,on:d,off:p,each:s,merge:Ft,extend:Mt,assign:ht,inherit:l,bindFn:c,prefixed:F}),(void 0!==t?t:"undefined"!=typeof self?self:{}).Hammer=st,"function"==typeof define&&define.amd?define("hammer",[],function(){return st}):"undefined"!=typeof module&&module.exports?module.exports=st:t.Hammer=st}(window,document),define("utils/ColorUtils",[],function(){function t(t){return String(t).replace(/\s+/g,"")}function e(t,e){return t<=e[0]?t=e[0]:t>=e[1]&&(t=e[1]),t}function i(t,e){if("function"!=typeof e)throw new TypeError;for(var i=t?t.length:0,a=0;a<i;a++)t[a]=e(t[a]);return t}function a(a){if(c[a]&&(a=c[a]),h[a])return h[a].slice();if(a=t(a),/^#[\da-f]{3}$/i.test(a)){var n=(240&(a=parseInt(a.slice(1),16)))<<4,r=15&a;a="#"+((1<<24)+((d=(3840&a)<<8)<<4)+d+(n<<4)+n+(r<<4)+r).toString(16).slice(1)}var s,o,l,d=a.match(u),p=[];if(d[2])s=d[2].replace("#","").split(""),l=[s[0]+s[1],s[2]+s[3],s[4]+s[5]],p=i(l,function(t){return e(parseInt(t,16),[0,255])});else if(d[4]){var f=d[4].split(",");o=f[3],p=i(l=f.slice(0,3),function(t){return t=Math.floor(t.indexOf("%")>0?2.55*parseInt(t,0):t),e(t,[0,255])}),void 0!==o&&p.push(e(parseFloat(o),[0,1]))}return 3===p.length&&p.push(1),h[a]=p.slice(),p}function n(t,a){if(a=a||"rgb",t&&(3===t.length||4===t.length)){if(t=i(t,function(t){return t>1?Math.ceil(t):t}),a.indexOf("hex")>-1)return"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1);if(a.indexOf("hs")>-1){var n=i(t.slice(1,3),function(t){return t+"%"});t[1]=n[0],t[2]=n[1]}return a.indexOf("a")>-1?(3===t.length&&t.push(1),t[3]=e(t[3],[0,1]),a+"("+t.slice(0,4).join(", ")+")"):a+"("+t.slice(0,3).join(", ")+")"}}function r(t,e,i){e=Math.min(1,Math.max(0,e)),i=Math.min(1,Math.max(0,i));var a=0,n=0,r=0;if(0===e)a=n=r=255*i+.5;else{var s=6*(t-Math.floor(t)),o=s-Math.floor(s),l=i*(1-e),c=i*(1-e*o),h=i*(1-e*(1-o));switch(Math.floor(s)){case 0:a=255*i+.5,n=255*h+.5,r=255*l+.5;break;case 1:a=255*c+.5,n=255*i+.5,r=255*l+.5;break;case 2:a=255*l+.5,n=255*i+.5,r=255*h+.5;break;case 3:a=255*l+.5,n=255*c+.5,r=255*i+.5;break;case 4:a=255*h+.5,n=255*l+.5,r=255*i+.5;break;case 5:a=255*i+.5,n=255*l+.5,r=255*c+.5}}var u=[];return u.push(Math.floor(a)),u.push(Math.floor(n)),u.push(Math.floor(r)),u}function s(t,e,i){var a,n,r,s=[3],o=t>e?t:e;i>o&&(o=i);var l=t<e?t:e;if(i<l&&(l=i),r=o/255,0==(n=0!==o?(o-l)/o:0))a=0;else{var c=(o-t)/(o-l),h=(o-e)/(o-l),u=(o-i)/(o-l);a=t==o?u-h:e==o?2+c-u:4+h-c,(a/=6)<0&&(a+=1)}return s[0]=a,s[1]=n,s[2]=r,s}function o(t){return t&&"string"==typeof t&&-1!=t.indexOf("rgba")?a(t)[3]:1}function l(t){var e,i,r,s,o=/rgba?\((\d{1,3}),(\d{1,3}),(\d{1,3})(,([.\d]+))?\)/,l=n(a(t),"rgba").replace(/\s+/g,"").match(o);return e=(+l[1]).toString(16),e=1===e.length?"0"+e:e,i=(+l[2]).toString(16),i=1===i.length?"0"+i:i,r=(+l[3]).toString(16),r=1===r.length?"0"+r:r,s=+(l[5]?l[5]:1),{hex:"#"+e+i+r,alpha:s}}var c={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#0ff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000",blanchedalmond:"#ffebcd",blue:"#00f",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#f0f",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#0f0",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#f0f",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#f00",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#fff",whitesmoke:"#f5f5f5",yellow:"#ff0",yellowgreen:"#9acd32"},h={},u=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,d={hasColorName:function(t){return c[t]},toColor:n,hsb2rgb:r,rgb2hsb:s,createColorsWithHsb:function(t,e){t=t||"blue",e=e||1;for(var i=a(t),o=s(i[0],i[1],i[2]),l=[],c=o[0],h=o[1],u=o[2],d=0;d<e;d++){var p=h*(1-d/e),f=u+d*(1-u)/e;l.push(n(r(c,p,f)))}return l},getRGBAColorArray:a,mixColorWithHSB:function(t,e,i,o){var l=a(t),c=s(l[0],l[1],l[2]);return c[0]+=e,c[1]+=i,c[2]+=o,n(r(c[0],c[1],c[2]),"rgb")},getHighLightColor:function(t){for(var i=a(t),r=[],s=0;s<3;s++){var o=i[s];o<=128?r.push(e(o-(255-o)*(255-2*o)/(2*o),[0,255])):r.push(e(o+o*(2*o-255)/(2*(255-o)),[0,255]))}var l=[];for(s=0;s<3;s++)l.push(Math.round(.65*i[s]+.35*r[s]));return n(l,"rgb")},getColorWithDivider:function(t,e){var i=a(t);i.length=3;for(var r=0;r<3;r++)i[r]=parseInt(i[r]/e,10);return n(i,"rgb")},mixColorWithAlpha:function(t,e){var i=a(t);return i[3]=e,n(i,"rgba")},getColorOpacity:o,getColorOpacityWithoutDefault:function(t){return t&&"string"==typeof t&&-1!=t.indexOf("rgba")?o(t):void 0},colorToHex:function(t){return l(t).hex},colorToHexAlpha:l,getClickColor:function(t){var e=a(t);e.length=3;for(var i=0;i<2;i++)e[i]=parseInt(.95*e[i],10);return n(e,"rgb")},getStandardColorAndOpacity:function(t,i){if(null==t)return{hex:t,alpha:i};null==i&&(i=1),i=e(parseFloat(i),[0,1]);var a=l(t);return null!=a.alpha&&(i*=a.alpha),{hex:a.hex,alpha:i}}};return window.ColorUtils=d,d}),define("Constants",[],function(){return{BLANK_VALUE_PERCENTAGE:"",INSTANCES_KEY:"vancharts_index_",SELECT_ANIMATION:"select",CHART_HIDE:"vancharts-chart-hide",EXPORT_HIDE:"vancharts-export-hide",GEO:"geographic_co_sys",PLANE:"plane_co_sys",BUTTON:"button",CAROUSEL:"carousel",BAR_CHART:"bar",COLUMN_CHART:"column",LINE_CHART:"line",AREA_CHART:"area",PIE_CHART:"pie",MULTIPIE_CHART:"multiPie",TREEMAP_CHART:"treeMap",SCATTER_CHART:"scatter",BUBBLE_CHART:"bubble",FORCE_BUBBLE_CHART:"forceBubble",GANTT_CHART:"gantt",GAUGE_CHART:"gauge",POINTER_GAUGE:"pointer",POINTER_SEMI_GAUGE:"pointer_semi",SLOT_GAUGE:"slot",THERMOMETER_GAUGE:"thermometer",RING_GAUGE:"ring",RADAR_CHART:"radar",COLUMN_RADAR:"columnRadar",LINE_RADAR:"lineRadar",POINT_MAP:"pointMap",AREA_MAP:"areaMap",HEAT_MAP:"heatMap",LINE_MAP:"lineMap",FUNNEL_CHART:"funnel",WORD_CLOUD_CHART:"wordCloud",STRUCTURE_CHART:"structure",VANCHART:"vanchart",FULL_SCREEN_ICON:"fullScreen",EXPORT_ICON:"toImage",SORT:"sort",MENU_ICON:"vancharts-icon-menu",REFRESH_ICON:"vancharts-icon-refresh",AXIS_GROUP:"vanchart-axis-group",BOTTOM:"bottom",TOP:"top",LEFT:"left",RIGHT:"right",RIGHT_TOP:"right-top",LEFT_TO_RIGHT:"left-to-right",RIGHT_TO_LEFT:"right-to-right",BOTTOM_TO_TOP:"bottom-to-top",TOP_TO_BOTTOM:"top-to-botttom",DISORDER:"disorder",DESCENDING:"descending",ASCENDING:"ascending",CIRCLE:"circle",SQUARE:"square",DIAMOND:"diamond",TRIANGLE:"triangle",STAR:"star",CIRCLE_HOLLOW:"circle_hollow",SQUARE_HOLLOW:"square_hollow",DIAMOND_HOLLOW:"diamond_hollow",TRIANGLE_HOLLOW:"triangle_hollow",NORMAL_ICON:"normal-legend-icon",PIE_ICON:"pie-legend-icon",DONUT_ICON:"donut-legend-icon",BUBBLE_ICON:"bubble-legend-icon",SCATTER_ICON:"scatter-legend-icon",TREEMAP_ICON:"treeMap-legend-icon",DASH_TYPE:{Solid:"none",Dash:"8,6"},SAME_ARC:"sameArc",DIFFERENT_ARC:"differentArc",OUTSIDE:"outside",INSIDE:"inside",CENTER:"center",STYLE_GRADUAL:"gradual",HORIZONTAL_LAYOUT:"horizontal",VERTICAL_LAYOUT:"vertical",POLYGON_RADAR:"polygon",CIRCLE_RADAR:"circle",SIZE_BY_AREA:"area",SIZE_BY_WIDTH:"width",GRADUAL_LIGHTER:"lighter",GRADUAL_DARKER:"darker",STATE_TO_DROP:"to-drop",STATE_DROPPED:"dropped",STATE_TO_SHOW:"to-show",STATE_SHOW:"show",EXPONENTIAL:"exponential",LINEAR:"linear",LOGARITHMIC:"logarithmic",POLYNOMIAL:"polynomial"}}),define("utils/vMap",["require"],function(t){function e(t,i){if(this._=Object.create(null),t){var a=this;if(t instanceof e)t.forEach(function(t,e){a.set(t,e)});else if(Array.isArray(t)){var n,r=-1,s=t.length;if(1===arguments.length)for(;++r<s;)a.set(r,t[r]);else for(;++r<s;)a.set(i.call(t,n=t[r],r),n)}else for(var o in t)a.set(o,t[o])}}function i(t){return(t+="")===n||t[0]===r?r+t:t}function a(t){return(t+="")[0]===r?t.slice(1):t}var n="__proto__",r="\0";return e.prototype={has:function(t){return i(t)in this._},get:function(t){return this._[i(t)]},set:function(t,e){return this._[i(t)]=e},remove:function(t){return(t=i(t))in this._&&delete this._[t]},keys:function(){var t=[];for(var e in this._)t.push(a(e));return t},values:function(){var t=[];for(var e in this._)t.push(this._[e]);return t},entries:function(){var t=[];for(var e in this._)t.push({key:a(e),value:this._[e]});return t},size:function(){var t=0;for(var e in this._)++t;return t},empty:function(){for(var t in this._)return!1;return!0},forEach:function(t){for(var e in this._)t.call(this,a(e),this._[e])}},e}),define("utils/BaseUtils",["require","./ColorUtils","../Constants","./vMap"],function(require){function initConst(){if(null==utils.isMS&&(utils.isMS="Microsoft Internet Explorer"===navigator.appName||navigator.appVersion.indexOf("Trident")>-1||"Netscape"===navigator.appName&&navigator.appVersion.indexOf("Edge")>-1,utils.transPrefix="-webkit-transform"in document.body.style?"-webkit-":"-moz-transform"in document.body.style?"-moz-":"-ms-transform"in document.body.style?"-ms-":"",DIV_CONTAINER=document.createElement("div"),document.body.appendChild(DIV_CONTAINER),isSupportSVG())){var t=document.createElement("canvas");CANVAS_CTX=t.getContext("2d"),SVG_CONTAINER=document.createElementNS("http://www.w3.org/2000/svg","svg"),document.body.appendChild(SVG_CONTAINER);var e=document.createElementNS("http://www.w3.org/2000/svg","text");SVG_CONTAINER.appendChild(e),SVG_CONTAINER._textNode=e,SVG_CONTAINER.style.visibility="hidden"}}function initPaddingScale(t){SCALE=t||1}function pick(){for(var t,e=arguments.length,i=0;i<e;i++)if(void 0!==(t=arguments[i])&&null!==t)return t;return null}function isArray(t){return"[object Array]"===Object.prototype.toString.apply(t)}function toArray(t){return Array.prototype.slice.call(t)}function setTextStyle(t,e){e=cssNormalization(e);for(var i in e)t.style(i,e[i])}function getTextDimension(t,e,i){if(null==t)return{width:0,height:0};if(i)return _getHtmlTextDim(t,e);if(!isSupportSVG())return _getHtmlTextDim(t,e,!1);var a=convertREMtoPX(e.fontSize);return!e["writing-mode"]&&a>=12?{width:_getCanvasTextWidth(t,a+"px",e),height:getTextHeight(e)}:_getSvgTextDim(t,e)}function getTextWrapDimension(t,e,i){return _getHtmlTextDim(t,extend({"white-space":"normal",whiteSpace:"normal","word-wrap":"break-word",wordWrap:"break-word"},e),i)}function _getHtmlTextDim(t,e,i){DIV_CONTAINER.style.cssText="",DIV_CONTAINER.style.visibility="hidden",DIV_CONTAINER.style.whiteSpace="nowrap",DIV_CONTAINER.style.position="absolute",DIV_CONTAINER.style.display="";for(var a in e)"function"!=typeof e[a]&&"color"!=a&&(DIV_CONTAINER.style[a]=e[a]);!1===i?DIV_CONTAINER.textContent?DIV_CONTAINER.textContent=t:DIV_CONTAINER.innerText=t:DIV_CONTAINER.innerHTML=t;var n={width:DIV_CONTAINER.offsetWidth||0,height:DIV_CONTAINER.offsetHeight||0};return DIV_CONTAINER.style.display="none",n}function _getSvgTextDim(t,e){SVG_CONTAINER.style.display="";var i=SVG_CONTAINER._textNode;i.textContent=t,i.style.cssText="";for(var a in e)"function"!=typeof e[a]&&"color"!=a&&(i.style[a]=e[a]);var n=i.getBBox(),r={width:n.width,height:n.height};return SVG_CONTAINER.style.display="none",r}function _getCanvasTextWidth(t,e,i){if(!CANVAS_CTX)return 0;var a=i.fontStyle||"",n=i.fontWeight||"",r=i.fontFamily||"",s="italic"===a?5:0;return CANVAS_CTX.font=a+" "+n+" "+e+" "+r,CANVAS_CTX.measureText(t).width+s||0}function setDomBackground(t,e){var i=[];if(e.backgroundColor)if("string"==typeof e.backgroundColor)if(isSupportSVG())i.push("background-Color:"+e.backgroundColor);else{var a=ColorUtils.colorToHexAlpha(e.backgroundColor);i.push("background-Color:"+a.hex),i.push("filter:alpha(opacity="+100*a.alpha+")")}else if("object"==typeof e.backgroundColor){var n=e.backgroundColor,r=ColorUtils.colorToHex(n.startColor),s=ColorUtils.colorToHex(n.endColor),o="left",l="left top",c="right top",h=1;n.x1==n.x2&&(o="top",l="left top",c="left bottom",h=0),i.push("background: -ms-linear-gradient("+o+", "+r+", "+s+")"),i.push("background-image: -moz-linear-gradient("+o+", "+r+", "+s+")"),i.push("background-image: -webkit-gradient(linear, "+l+", "+c+", color-stop(0, "+r+"), color-stop(1, "+s+"))"),i.push("filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="+r+", endColorstr="+s+", GradientType="+h+")")}e.backgroundImage&&(i.push("background-image:url("+e.backgroundImage+")"),i.push("background-size:100% 100%")),null!=e.borderWidth&&(i.push("border-style:solid"),i.push("border-width:"+e.borderWidth+"px")),null!=e.borderColor&&i.push("border-color:"+e.borderColor),null!=e.borderRadius&&(i.push("border-radius:"+e.borderRadius+"px"),i.push("-moz-border-radius:"+e.borderRadius+"px"),i.push("-webkit-border-radius:"+e.borderRadius+"px"),i.push("-o-border-radius:"+e.borderRadius+"px")),e.shadow&&i.push("box-shadow:1px 1px 2px rgba(0,0,0,0.2)"),t.style.cssText+=i.join(";")+";"}function getTextHeight(t){return convertREMtoPX(t.fontSize||"0.75rem")}function stamp(t){return t._vanchart_id=t._vanchart_id||"vancharts"+ ++lastID,t._vanchart_id}function extend(t){var e,i,a,n;for(i=1,a=arguments.length;i<a;i++){n=arguments[i];for(e in n)t[e]=n[e]}return t}function domRotate(t,e){var i=[];i.push("transform:rotate("+e+"deg)"),i.push("-ms-transform:rotate("+e+"deg)"),i.push("-webkit-transform:rotate("+e+"deg)"),i.push("-moz-transform:rotate("+e+"deg)"),i.push("-o-transform:rotate("+e+"deg)");var a=Math.cos(toRadian(e)),n=Math.sin(toRadian(e));if(!isSupportSVG()){var r=e?["progid:DXImageTransform.Microsoft.Matrix(M11=",a,", M12=",-n,", M21=",n,", M22=",a,", sizingMethod='auto expand')"].join(""):"none";i.push("filter:"+r)}t.style.cssText+=i.join(";")+";"}function splitText(t,e,i,a){if(!t)return[];t+="",i-=2*(a=a||0);for(var n=[],r=0,s=t.length;r<s;){for(var o=r;getTextDimension(t.substring(o,r+1),e,!1).width<i&&!(++r>=s););if(o==r)return["..."];n.push(t.substring(o,r))}return n}function getTextDimensionWithRotation(t,e,i,a){return getTextDimRotated(getTextDimension(t,e,i),a)}function getTextDimRotated(t,e){var i=Math.abs(toRadian(e||0));return{width:t.width*Math.cos(i)+t.height*Math.sin(i),height:t.width*Math.sin(i)+t.height*Math.cos(i)}}function clone(t){if("object"==typeof t&&null!==t){var e=t;if(isArray(t)){e=[];for(var i=0,a=t.length;i<a;i++)e[i]=clone(t[i])}else{e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=clone(t[n]))}return e}return t}function cssNormalization(t){var e={};for(var i in t)if(styleToCss[i]&&(e[styleToCss[i]]=t[i]),"color"==i&&(e.color=t[i]),"fontSize"==i){var a=t[i];-1!=a.indexOf("pt")&&(a=4*parseFloat(a)/3,e["font-size"]=a+"px")}return e}function reformCssArray(t){if(!(t instanceof Array))return[t,t,t,t];switch(t.length+""){case"4":return t;case"3":return[t[0],t[1],t[2],t[1]];case"2":return[t[0],t[1],t[0],t[1]];case"1":return[t[0],t[0],t[0],t[0]];case"0":return[0,0,0,0]}}function lineSubPixelOpt(t,e){return e%2==0?Math.round(t):Math.round(t-.5)+.5}function rectSubPixelOpt(){var t,e,i,a,n;return 2===arguments.length?(t=arguments[0].x,e=arguments[0].y,i=arguments[0].width,a=arguments[0].height,n=arguments[1]):(t=arguments[0],e=arguments[1],i=arguments[2],a=arguments[3],n=arguments[4]),n=n||0,t=lineSubPixelOpt(t,n),e=lineSubPixelOpt(e,n),i=Math.round(i),a=Math.round(a),{x:t,y:e,width:i,height:a}}function addArray(t,e){var i=[];if(t&&t.length)for(var a=0,n=t.length;a<n;a++)i.push(t[a]);if(e&&e.length)for(var a=0,n=e.length;a<n;a++)i.push(e[a]);return i}function toFront(t){t&&t.parentNode&&t.parentNode.appendChild(t)}function toBack(t){t&&t.parentNode&&t.parentNode.insertBefore(t,t.parentNode.firstChild)}function toFrontOfAll(t){t.ownerSVGElement.appendChild(t)}function toBackOfAll(t){t.ownerSVGElement.appendChild(t,t.ownerSVGElement.firstChild)}function containsRect(t,e){return t.x<=e.x&&t.y<=e.y&&t.x+t.width>=e.x+e.width&&t.y+t.height>=e.y+e.height}function rectangleOverlapped(t,e){if(!t||!e)return!1;var i=Math.max(t.x,e.x),a=Math.max(t.y,e.y),n=Math.min(t.x+t.width,e.x+e.width),r=Math.min(t.y+t.height,e.y+e.height);return i<=n&&a<=r}function outsideRect(t,e){return!containsRect(t,e)&&!rectangleOverlapped(t,e)}function containsPoint(t,e){if(!t||!e)return!1;var i=pick(e.x||e[0]),a=pick(e.y||e[1]);return t.x<i&&t.x+t.width>i&&t.y<a&&t.y+t.height>a}function isSupportSVG(){return!!window.SVGSVGElement}function makeValueInRange(t,e,i){var a=Math.min(t,e),n=Math.max(t,e)-a;return((i-a)%n+n)%n+a}function getValueInDomain(t,e){return Math.min(Math.max(t,e[0]),e[1])}function toRadian(t){return Math.PI*(t/180)}function toDegree(t){return 180*t/Math.PI}function getFormatterFunction(formatter){if(null==formatter||""===formatter)return null;if("string"==typeof formatter){var formatterFunc=new Function("return "+formatter)();return"string"==typeof formatterFunc?(eval("var _tmpFunc = "+formatter),_tmpFunc):formatterFunc}return formatter}function format(t,e){return"function"==typeof(e=getFormatterFunction(e))?e.bind(t)(t):t}function clone(t){if(null==t||"object"!=typeof t)return t;if(t instanceof Date)return(e=new Date).setTime(t.getTime()),e;if(t instanceof Array){for(var e=[],i=0,a=t.length;i<a;++i)e[i]=clone(t[i]);return e}if(t instanceof String)return t+"";if(t instanceof Object){e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=clone(t[n]));return e}}function isEmpty(t){return""===t||null===t||void 0===t}function isNull(t){return void 0==t||null==t}function isIE(){return!!(window.ActiveXObject||"ActiveXObject"in window)}function hasNotDefined(t){return null===t||void 0===t}function hasDefined(t){return!hasNotDefined(t)}function makeBounds(){var t=0,e=0,i=0,a=0;if(2===arguments.length){var n=arguments[0],r=arguments[1];t=pick(n.x,n[0]),e=pick(n.y,n[1]),i=pick(r.width,r[0]),a=pick(r.height,r[1])}else 4===arguments.length&&(t=arguments[0],e=arguments[1],i=arguments[2],a=arguments[3]);return{x:t,y:e,width:i,height:a}}function distance(t,e){var i=pick(t.x,t[0]),a=pick(t.y,t[1]),n=i-pick(e.x,e[0]),r=a-pick(e.y,e[1]);return Math.sqrt(n*n+r*r)}function isEmptyBounds(t){return t.width<=0||t.height<=0}function log(t,e){return Math.log(e)/Math.log(t)}function getOrder(t){var e=0;if(t>0&&t<1)for(;t<1;)t=accMul(t,10),e--;else if(t>=10)for(;t>=10;)t=accDiv(t,10),e++;return e}function getPercentValue(t,e){return t?(-1!=(t+="").indexOf("%")&&(t=parseFloat(t)*e/100),parseFloat(t)):0}function getDecimalPlaces(t){var e=(t+"").match(decimalPlacesRegExp);return e?(e[1]?e[1].length:0)+(+e[2]||0):0}function accAdd(t,e){if(t%1==0&&e%1==0)return t+e;var i=getDecimalPlaces(t),a=getDecimalPlaces(e),n=Math.pow(10,Math.max(i,a));return(Math.round(t*n)+Math.round(e*n))/n}function accDiv(t,e){if(t%1==0&&e%1==0)return t/e;var i=t+"",a=e+"",n=-getDecimalPlaces(t);n+=getDecimalPlaces(e);var r=i.replace(decimalRegExp,""),s=a.replace(decimalRegExp,"");return n>0?r/s*Math.pow(10,n):r/s/Math.pow(10,-n)}function accMul(t,e){if(t%1==0&&e%1==0)return t*e;var i=t+"",a=e+"",n=getDecimalPlaces(t);return n+=getDecimalPlaces(e),i.replace(decimalRegExp,"")*a.replace(decimalRegExp,"")/Math.pow(10,n)}function objectToArray(t){if(t.length)return[].slice.call(t);var e=[];for(var i in t)e.push(t[i]);return e}function date2int(t){if(null==t)return null;"string"==typeof t&&(t=new Date(Date.parse(t.replace(/-|\./g,"/"))));var e=new Date("1970/01/01");return"number"==typeof t?t:t.getTime()-e.getTime()}function int2date(t){var e=new Date("1970/01/01");return t=t||0,new Date(t+e.getTime())}function object2date(t){var e=t;return"string"==typeof e?e=new Date(Date.parse(e.replace(/-|\./g,"/"))):"number"==typeof e&&(e=new Date(e)),e}function makeTranslate(t){return"translate("+pick(t.x,t[0])+","+pick(t.y,t[1])+")"}function makeTranslate3d(t){return"translate3d("+pick(t.x,t[0])+"px,"+pick(t.y,t[1])+"px,"+pick(t.z,t[2],0)+"px)"}function isImageMarker(t){return-1==(Constants.STAR+Constants.CIRCLE+Constants.SQUARE+Constants.DIAMOND+Constants.TRIANGLE+Constants.CIRCLE_HOLLOW+Constants.SQUARE_HOLLOW+Constants.DIAMOND_HOLLOW+Constants.TRIANGLE_HOLLOW).indexOf(t)&&hasDefined(t)}function isNullMarker(t){return hasNotDefined(t.symbol)}function getDefaultMarkerSymbol(t){var e=[Constants.CIRCLE,Constants.CIRCLE_HOLLOW,Constants.SQUARE,Constants.SQUARE_HOLLOW,Constants.DIAMOND,Constants.DIAMOND_HOLLOW,Constants.TRIANGLE,Constants.TRIANGLE_HOLLOW];return e[t%e.length]}function splitWords(t){return(t=t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")).split(/\s+/)}function trim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function removeEvent(t,e,i){t.removeEventListener?t.removeEventListener(e,i,!1):t.attachEvent&&t.detachEvent("on"+e,i)}function dealFloatPrecision(t){return Math.abs(t)<1e-6?0:t}function getDomWidth(t){var e=t.currentStyle||document.defaultView.getComputedStyle(t);return((t.clientWidth||parseInt(e.width,10))-parseInt(e.paddingLeft,10)-parseInt(e.paddingRight,10)).toFixed(0)-0}function getDomHeight(t){var e=t.currentStyle||document.defaultView.getComputedStyle(t);return((t.clientHeight||parseInt(e.height,10))-parseInt(e.paddingTop,10)-parseInt(e.paddingBottom,10)).toFixed(0)-0}function hasTouch(){var t=window.document;return t&&void 0!==t.documentElement.ontouchstart}function getArcPoint(t,e){return[t*Math.sin(e),-t*Math.cos(e)]}function getArcByPoint(t,e){return(2*Math.PI-(Math.atan2(e,t)-Math.PI/2))%(2*Math.PI)}function calculateAutoMinMaxAndGap(t,e,i){e<t&&(t=0,e=100);var a=accAdd(e,-t),n=getOrder(a),r=Math.pow(10,n);n<=0?(t=accMul(t,Math.pow(10,1-n)),t=accDiv(Math.floor(t),Math.pow(10,1-n))):t=Math.floor(t/r)*r;for(var s=accMul(accDiv(i,10),r),o=0;o<a;)o=accAdd(s,o);for(var l=accDiv(o,i);t+l*i<e;)o=accAdd(s,o),l=accDiv(o,i);return o=accDiv(o,i),e=accAdd(t,accMul(o,i)),[t,e,o]}function indexOf(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}function hasChn(t){return/[\u4E00-\u9FA5]/.test(t)}function convertREMtoPX(t){return-1!=t.indexOf("rem")?(t=parseFloat(t),t*=getDefaultFontSize()):t=-1!=t.indexOf("pt")?4*parseFloat(t)/3:parseFloat(t),t}function paddingConvertWithScale(t){return Math.round(convertREMtoPX(t)*SCALE)}function getDefaultFontSize(){if(hasNotDefined(utils.defaultFontSize)){var t=document.documentElement.currentStyle||document.defaultView.getComputedStyle(document.documentElement);utils.defaultFontSize=_getDefaultFontSizeToPX(t.fontSize)}return utils.defaultFontSize}function _getDefaultFontSizeToPX(t){return-1!=t.indexOf("px")?parseFloat(t):-1!=t.indexOf("pt")?4*parseFloat(t)/3:16}function convertToREMUseDefault16PX(t){if(t){var e=t.fontSize+"";isSupportSVG()?(-1!=(e=isNaN(parseFloat(e))?"0.75rem":e).indexOf("rem")?e=16*parseFloat(e):-1!=e.indexOf("pt")&&(e=4*parseFloat(e)/3),t.fontSize=parseFloat(e)/16+"rem"):e&&-1!=e.indexOf("rem")&&(t.fontSize=16*parseFloat(e)+"px")}return t}function toPng(t){var e=document.createElement("a"),i=document.createElement("img");e.style.display="none",e.appendChild(i),i.setAttribute("src",t),document.body.appendChild(e),e.setAttribute("target","_blank"),e.setAttribute("href",t),e.setAttribute("download","export.png"),e.click()}function getPlainText(t){return DIV_CONTAINER.style.cssText="visibility: hidden;",DIV_CONTAINER.innerHTML=t,DIV_CONTAINER.textContent?DIV_CONTAINER.textContent:DIV_CONTAINER.innerText}function computeArc(t,e,i,a,n){var r=Math.asin(n),s=Math.abs(t-i),o=Math.abs(e-a),l=Math.sqrt(s*s+o*o)/2,c=(t>i?-1:1)*l/Math.tan(r),h=Math.atan((e-a)/(i-t)),u=(t+i)/2+c*Math.sin(h),d=(e+a)/2+c*Math.cos(h),p=t-u,f=e-d,m=i-u,g=a-d,v=normalRadian(Math.atan2(f,p)),y=normalRadian(Math.atan2(g,m));return v>y&&(y+=DOUBLE_PI),[u,d,l/n,v,y]}function normalRadian(t){return(t%=DOUBLE_PI)<0&&(t+=DOUBLE_PI),t}function formatNum(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i}function wrapNum(t,e,i){var a=e[1],n=e[0],r=a-n;return t===a&&i?t:((t-n)%r+r)%r+n}function bind(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var a=i.call(arguments,2);return function(){return t.apply(e,a.length?a.concat(i.call(arguments)):arguments)}}function getParamString(t,e,i){var a=[];for(var n in t)a.push(encodeURIComponent(i?n.toUpperCase():n)+"="+encodeURIComponent(t[n]));return(e&&-1!==e.indexOf("?")?"&":"?")+a.join("&")}function template(t,e){return t.replace(templateRe,function(t,i){var a=e[i];if(void 0===a)throw new Error("No value provided for variable "+t);return"function"==typeof a&&(a=a(e)),a})}function setOptions(t,e){t.hasOwnProperty("options")||(t.options=t.options?Object.create(t.options):{});for(var i in e)t.options[i]=e[i];return t.options}function createOptions(t,e){return e.forEach(function(e){if(e)for(var i in e)hasNotDefined(t[i])&&!skipKeys[i]&&(t[i]=e[i])}),t}function getPrefixed(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}function timeoutDefer(t){var e=+new Date,i=Math.max(0,16-(e-lastTime));return lastTime=e+i,window.setTimeout(t,i)}function requestAnimFrame(t,e,i){if(!i||requestFn!==timeoutDefer)return requestFn.call(window,bind(t,e));t.call(e)}function cancelAnimFrame(t){t&&cancelFn.call(window,t)}function throttle(t,e,i){var a,n,r,s;return s=function(){a=!1,n&&(r.apply(i,n),n=!1)},r=function(){a?n=arguments:(t.apply(i,arguments),setTimeout(s,e),a=!0)}}function rebind(t,e){for(var i,a=1,n=arguments.length;++a<n;)t[i=arguments[a]]=_rebind(t,e,e[i]);return t}function _rebind(t,e,i){return function(){var a=i.apply(e,arguments);return a===e?t:a}}function bindData(t,e,i){var a,n,r,s,o=t.length,l=e.length,c=[],h=[],u=[],d={},p=[];for(a=-1;++a<o;)r=t[a],n=i?i(r.datum()):a,d[n]=r,p[a]=n;for(a=-1;++a<l;)s=e[a],n=i?i(s):a,(r=d[n])?!0!==r&&(r.datum(s),u.push(r)):c.push(s),d[n]=!0;for(a=-1;++a<o;)!0!==d[p[a]]&&h.push(t[a]);return{update:u,enter:c,exit:h}}function dispatch(){for(var t=new d3_dispatch,e=-1,i=arguments.length;++e<i;)t[arguments[e]]=d3_dispatch_event(t);return t}function d3_dispatch(){}function d3_dispatch_event(t){function e(){for(var e,a=i,n=-1,r=a.length;++n<r;)(e=a[n].on)&&e.apply(this,arguments);return t}var i=[],a=new vMap;return e.on=function(e,n){var r,s=a.get(e);return arguments.length<2?s&&s.on:(s&&(s.on=null,i=i.slice(0,r=i.indexOf(s)).concat(i.slice(r+1)),a.remove(e)),n&&i.push(a.set(e,{on:n})),t)},e}function falseFn(){return!1}function trueFn(){return!0}function emptyFn(){}var ColorUtils=require("./ColorUtils"),Constants=require("../Constants"),vMap=require("./vMap"),templateRe=/\{ *([\w_\-]+) *\}/g,DIV_CONTAINER,SVG_CONTAINER,CANVAS_CTX,lastID=0,DOUBLE_PI=2*Math.PI,decimalPlacesRegExp=/(?:\d+)(?:\.(\d+))?(?:[eE]-(\d+))?/,decimalRegExp=/\.|[eE]-\d+/g,skipKeys={minSize:!0,maxSize:!0},SCALE=1,styleToCss={color:"fill",font:"font",fontFamily:"font-family",fontSize:"font-size",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",letterSpacing:"letter-spacing",lineHeight:"line-height",quotes:"quotes",textAlign:"text-align",textDecoration:"text-decoration",textIndent:"text-indent",textShadow:"text-shadow",textTransform:"text-transform",whiteSpace:"white-space",wordSpacing:"word-spacing",padding:"padding"},lastTime=0,requestFn=window.requestAnimationFrame||getPrefixed("RequestAnimationFrame")||timeoutDefer,cancelFn=window.cancelAnimationFrame||getPrefixed("CancelAnimationFrame")||getPrefixed("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};d3_dispatch.prototype.on=function(t,e){var i=t.indexOf("."),a="";if(i>=0&&(a=t.slice(i+1),t=t.slice(0,i)),t)return arguments.length<2?this[t].on(a):this[t].on(a,e);if(2===arguments.length){if(null==e)for(t in this)this.hasOwnProperty(t)&&this[t].on(a,null);return this}};var utils={dispatch:dispatch,rebind:rebind,throttle:throttle,requestAnimFrame:requestAnimFrame,cancelAnimFrame:cancelAnimFrame,getParamString:getParamString,template:template,setOptions:setOptions,createOptions:createOptions,formatNum:formatNum,wrapNum:wrapNum,bind:bind,initConst:initConst,initPaddingScale:initPaddingScale,toPng:toPng,getDomWidth:getDomWidth,getDomHeight:getDomHeight,makeTranslate:makeTranslate,makeTranslate3d:makeTranslate3d,clone:clone,date2int:date2int,int2date:int2date,object2date:object2date,log:log,getOrder:getOrder,getPercentValue:getPercentValue,accAdd:accAdd,accDiv:accDiv,accMul:accMul,dealFloatPrecision:dealFloatPrecision,isEmpty:isEmpty,isEmptyBounds:isEmptyBounds,objectToArray:objectToArray,toArray:toArray,pick:pick,isNull:isNull,getTextDimension:getTextDimension,getTextHeight:getTextHeight,splitText:splitText,getTextDimensionWithRotation:getTextDimensionWithRotation,getTextDimRotated:getTextDimRotated,isArray:isArray,indexOf:indexOf,cssNormalization:cssNormalization,reformCssArray:reformCssArray,rectSubPixelOpt:rectSubPixelOpt,lineSubPixelOpt:lineSubPixelOpt,addArray:addArray,toFront:toFront,toBack:toBack,toFrontOfAll:toFrontOfAll,toBackOfAll:toBackOfAll,containsRect:containsRect,rectangleOverlapped:rectangleOverlapped,outsideRect:outsideRect,containsPoint:containsPoint,isSupportSVG:isSupportSVG,setTextStyle:setTextStyle,domRotate:domRotate,makeValueInRange:makeValueInRange,getValueInDomain:getValueInDomain,toRadian:toRadian,toDegree:toDegree,getFormatterFunction:getFormatterFunction,format:format,isIE:isIE,hasTouch:hasTouch,hasNotDefined:hasNotDefined,hasDefined:hasDefined,distance:distance,makeBounds:makeBounds,isImageMarker:isImageMarker,isNullMarker:isNullMarker,getDefaultMarkerSymbol:getDefaultMarkerSymbol,removeEvent:removeEvent,getArcPoint:getArcPoint,getTextWrapDimension:getTextWrapDimension,stamp:stamp,splitWords:splitWords,trim:trim,extend:extend,setDomBackground:setDomBackground,getArcByPoint:getArcByPoint,calculateAutoMinMaxAndGap:calculateAutoMinMaxAndGap,hasChn:hasChn,convertREMtoPX:convertREMtoPX,paddingConvertWithScale:paddingConvertWithScale,getDefaultFontSize:getDefaultFontSize,convertToREMUseDefault16PX:convertToREMUseDefault16PX,getPlainText:getPlainText,computeArc:computeArc,normalRadian:normalRadian,bindData:bindData,falseFn:falseFn,trueFn:trueFn,emptyFn:emptyFn};return window.VanUtils=utils,utils}),define("utils/QueryUtils",["require"],function(t){function e(t,i,a){for(var n in i)if(i.hasOwnProperty(n)){var r=t[n];"object"==typeof r?e(t[n],i[n],a):!a&&n in t&&void 0!=r||(t[n]=i[n])}return t}return{queryList:function(t,e){if(t&&t.length&&e)for(var i=0;i<t.length;i++){var a=t[i]&&t[i][e];if(void 0!=a)return a}},merge:e}}),define("utils/Class",["require","./QueryUtils","./BaseUtils"],function(t){function e(){}var i=(t("./QueryUtils"),t("./BaseUtils"));return e.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},a=e.__super__=this.prototype,n=Object.create(a);n.constructor=e,e.prototype=n;for(var r in this)this.hasOwnProperty(r)&&"prototype"!==r&&(e[r]=this[r]);return n.options&&(t.options=i.extend(Object.create(n.options),t.options)),i.extend(n,t),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){a.callInitHooks&&a.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;t<e;t++)n._initHooks[t].call(this)}},e},e.include=function(t){return i.extend(this.prototype,t),this},e.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this},e}),define("dom/Evented",["require","../utils/BaseUtils","../utils/Class"],function(t){var e=t("../utils/BaseUtils");return t("../utils/Class").extend({on:function(t,i,a){if("object"==typeof t)for(var n in t)this._on(n,t[n],i);else for(var r=0,s=(t=e.splitWords(t)).length;r<s;r++)this._on(t[r],i,a);return this},off:function(t,i,a){if(t)if("object"==typeof t)for(var n in t)this._off(n,t[n],i);else for(var r=0,s=(t=e.splitWords(t)).length;r<s;r++)this._off(t[r],i,a);else delete this._events;return this},_on:function(t,e,i){if(t&&e){this._events=this._events||{};var a=this._events[t];a||(a=[],this._events[t]=a),i===this&&(i=void 0);for(var n={fn:e,ctx:i},r=a,s=0,o=r.length;s<o;s++)if(r[s].fn===e&&r[s].ctx===i)return;r.push(n),a.count++}},_off:function(t,i,a){var n,r,s;if(this._events&&(n=this._events[t])){if(!i){for(r=0,s=n.length;r<s;r++)n[r].fn=e.falseFn;return void delete this._events[t]}if(a===this&&(a=void 0),n)for(r=0,s=n.length;r<s;r++){var o=n[r];if(o.ctx===a&&o.fn===i)return o.fn=e.falseFn,this._firingCount&&(this._events[t]=n=n.slice()),void n.splice(r,1)}}},fire:function(t,e,i){if(!this.listens(t,i))return this;var a=e;if(this._events){var n=this._events[t];if(n){this._firingCount=this._firingCount+1||1;for(var r=0,s=n.length;r<s;r++){var o=n[r];o.fn.call(o.ctx||this,a)}this._firingCount--}}return i&&this._propagateEvent(a),this},listens:function(t,e){var i=this._events&&this._events[t];if(i&&i.length)return!0;if(e)for(var a in this._eventParents)if(this._eventParents[a].listens(t,e))return!0;return!1},once:function(t,i,a){if("object"==typeof t){for(var n in t)this.once(n,t[n],i);return this}var r=e.bind(function(){this.off(t,i,a).off(t,r,a)},this);return this.on(t,i,a).on(t,r,a)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[e.stamp(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[e.stamp(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.srcEvent.type,t,!0)}})}),define("ComponentLibrary",[],function(){var t=Object.create(null);return{TOOLTIP_COMPONENT:"tooltip",TOOLBAR_COMPONENT:"tools",GEO_COMPONENT:"geo",DRILL_TOOLS:"dTools",TITLE_COMPONENT:"title",RANGE_LEGEND_COMPONENT:"rangeLegend",INTERVAL_RANGE_LEGEND:"intervalRangeLegend",GradientRangeLegend:"gradientRangeLegend",LEGEND_COMPONENT:"legend",DATA_SHEET_COMPONENT:"dataSheet",ZOOM_COMPONENT:"zoom",X_AXIS_COMPONENT:"xAxis",Y_AXIS_COMPONENT:"yAxis",POLAR_COMPONENT:"polar",RADIUS_AXIS_COMPONENT:"radiusAxis",ANGLE_AXIS_COMPONENT:"angleAxis",GAUGE_AXIS_COMPONENT:"gaugeAxis",VALUE_AXIS_COMPONENT:"value",CATEGORY_AXIS_COMPONENT:"category",DATE_AXIS_COMPONENT:"datetime",LEVELBAR:"levelBar",PROCESSES:"processes",TIMEAXIS:"timeAxis",ComponentsOrder:["tooltip","tools","title","dTools","geo","rangeLegend","legend","zoom","dataSheet","xAxis","yAxis","polar","angleAxis","radiusAxis","gaugeAxis","value","category","datetime","levelBar","processes","timeAxis"],getRegisteredComponents:function(){return t},get:function(e){return t[e]},register:function(e,i){t[e]=i}}}),define("utils/BoundsManager",["require","./BaseUtils"],function(t){function e(){this.addedBounds=[]}var i=t("./BaseUtils");return e.prototype={constructor:e,addBounds:function(t){this.addedBounds.push(t)},isOverlapped:function(t){for(var e=0,a=this.addedBounds.length;e<a;e++)if(i.rectangleOverlapped(t,this.addedBounds[e]))return!0;return!1},isEmpty:function(){return 0===this.addedBounds.length}},e}),define("utils/BezierEasing",["require","./vMap"],function(t){function e(t,e){return 1-3*e+3*t}function i(t,e){return 3*e-6*t}function a(t){return 3*t}function n(t,n,r){return((e(n,r)*t+i(n,r))*t+a(n))*t}function r(t,n,r){return 3*e(n,r)*t*t+2*i(n,r)*t+a(n)}function s(t,e,i,a,r){var s,o,l=0;do{(s=n(o=e+(i-e)/2,a,r)-t)>0?i=o:e=o}while(Math.abs(s)>F&&++l<_);return o}function o(t,e,i,a){function o(e,a){for(var s=0;s<y;++s){var o=r(a,t,i);if(0===o)return a;a-=(n(a,t,i)-e)/o}return a}function l(){for(var e=0;e<T;++e)d[e]=n(e*b,t,i)}function c(e){for(var a=0,n=1,l=T-1;n!=l&&d[n]<=e;++n)a+=b;var c=a+(e-d[--n])/(d[n+1]-d[n])*b,h=r(c,t,i);return h>=M?o(e,c):0===h?c:s(e,a,a+b,t,i)}function h(){p=!0,t==e&&i==a||l()}if(4!==arguments.length)throw new Error("BezierEasing requires 4 arguments.");for(var u=0;u<4;++u)if("number"!=typeof arguments[u]||isNaN(arguments[u])||!isFinite(arguments[u]))throw new Error("BezierEasing arguments should be integers.");if(t<0||t>1||i<0||i>1)throw new Error("BezierEasing x values must be in [0, 1] range.");var d=x?new Float32Array(T):[],p=!1,f=function(r){return p||h(),t===e&&i===a?r:0===r?0:1-r<.001?1:n(c(r),e,a)};f.getControlPoints=function(){return[{x:t,y:e},{x:i,y:a}]};var m="BezierEasing("+[t,e,i,a]+")";return f.toString=function(){return m},f}function l(t){return function(e){return e<=0?0:e>=1?1:t(e)}}function c(t){return function(e){return 1-t(1-e)}}function h(t){return function(e){return.5*(e<.5?t(2*e):2-t(2-2*e))}}function u(t){return t*t}function d(t){return t*t*t}function p(t){return 1-Math.cos(t*half)}function f(t){return Math.pow(2,10*(t-1))}function m(t){return 1-Math.sqrt(1-t*t)}function g(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}var v=t("./vMap"),y=4,M=.001,F=1e-7,_=10,T=11,b=1/(T-1),x="Float32Array"in this;o.css={ease:o(.25,.1,.25,1),linear:o(0,0,1,1),"ease-in":o(.42,0,1,1),"ease-out":o(0,0,.58,1),"ease-in-out":o(.42,0,.58,1),"ease-in-out-quad":o(.455,.03,.515,.955),swing:o(.02,.01,.47,1),"ease-in-quart":o(.895,.03,.685,.22),"ease-out-back":o(.175,.885,.32,1.275),"ease-out-quart":o(.165,.84,.44,1),"ease-in-quint":o(.755,.05,.855,.06),"ease-out-quint":o(.23,1,.32,1),"ease-in-quad":o(.55,.085,.68,.53),"ease-out-quad":o(.25,.46,.45,.94)};var C=2*Math.PI,w=function(t){return t},E=function(){return w},A=new v({linear:E,poly:function(t){return function(e){return Math.pow(e,t)}},quad:function(){return u},cubic:function(){return d},sin:function(){return p},exp:function(){return f},circle:function(){return m},elastic:function(t,e){var i;return arguments.length<2&&(e=.45),arguments.length?i=e/C*Math.asin(1/t):(t=1,i=e/4),function(a){return 1+t*Math.pow(2,-10*a)*Math.sin((a-i)*C/e)}},back:function(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}},bounce:function(){return g}}),X=new v({in:w,out:c,"in-out":h,"out-in":function(t){return h(c(t))}});return o.ease=function(t){var e=t.indexOf("-"),i=e>=0?t.slice(0,e):t,a=e>=0?t.slice(e+1):"in";return i=A.get(i)||E,a=X.get(a)||w,l(a(i.apply(null,Array.prototype.slice.call(arguments,1))))},o}),define("vans/VanChartLayout",["require","../Constants","../utils/BaseUtils","../ComponentLibrary","../utils/BoundsManager","../utils/BezierEasing"],function(t){function e(t){a(t),n(t.seriesOfType(d.WORD_CLOUD_CHART)),r(t,t.seriesOfType(d.BUBBLE_CHART),d.BUBBLE_CHART),r(t,t.seriesOfType(d.SCATTER_CHART),d.SCATTER_CHART),s(t.seriesOfType(d.BUBBLE_CHART)),s(t.seriesOfType(d.FORCE_BUBBLE_CHART))}function i(t){for(var e=new m,i=0,a=t.series.length;i<a;i++){var n=t.series[i];n.visible&&(n.doLayout(),n._calculateLabelPos(e))}}function a(t){for(var e={},i=t.series,a=0,n=i.length;a<n;a++){var r=i[a],s=r.type;if(!r.isTreeSeries()&&s!=d.WORD_CLOUD_CHART)if(r.isSeriesAccumulated())if(r._calculatePercentage)r._calculatePercentage();else{var c=r.getTargetKey();l(r.points,c),o(r.points,c)}else r.visible&&r.points.map(function(t){var i=[s,r.stack,t.category].join("-");e[i]||(e[i]=[]),e[i].push(t)})}for(var h in e){var u=e[h];l(u,c=u[0].series.getTargetKey()),o(u,c)}for(var a=0,n=i.length;a<n;a++){var p=i[a];p.points.forEach(function(t){p.calculateLabelInfo(t)})}}function n(t){if(t&&t.length){var e=[];t.forEach(function(t){e=e.concat(t.points)}),l(e,t[0].getTargetKey())}}function r(t,e,i){var a,n;if(i==d.BUBBLE_CHART)n="swing",a=function(t,e){return e.radius-t.radius};else if(i==d.SCATTER_CHART){var r=t.isInverted();n="exp-in-out",a=function(t,e){return r?t.posY-e.posY:t.posX-e.posX}}var s=[];e.forEach(function(t){s=s.concat(t.points)}),s.sort(a);var o=s.length;o>0&&s.forEach(function(t,e){t.delayTime=800*g.ease(n)(e/o)})}function s(t){t.forEach(function(t){t._calculateMinMax4Radius()}),t.forEach(function(t){t._calculateBubbleRadius()})}function o(t,e){if(t&&t.length)for(var i=t[0].series,a=i.options.stackByPercent,n=i.stack||a,r=i.getStackAxis(),s=r&&r.isLog()?1:0,o=s,l=s,c=0,h=t.length;c<h;c++){var u=t[c],d=u.options;if(n){var p=a?u.percentage:u.getTargetValue();p>=s?(d[e+"0"]=o,o+=p):(d[e+"0"]=l,l+=p)}else d[e+"0"]=s}}function l(t,e){var i=0;t.filter(function(t){return!t.isNull&&t.visible}).forEach(function(t){i+=Math.abs(t[e])}),i=i>0?i:1,t.forEach(function(t){var e=t.series,a=e.getTargetKey(),n=e[e.getBaseAxisType()],r=!e.stack&&n&&n.type!=f.CATEGORY_AXIS_COMPONENT;t.percentage=r?1:Math.abs(t[a])/i})}function c(t){t.bounds=t._getDefaultBounds(),f.ComponentsOrder.map(function(e){e in t.components&&t.components[e].doLayout()},this),t.plotBounds=t.bounds,[f.Y_AXIS_COMPONENT,f.X_AXIS_COMPONENT].forEach(function(e){t.components[e]&&t.components[e].updateAxisClip()}),u(t),[f.Y_AXIS_COMPONENT,f.DATA_SHEET_COMPONENT,f.X_AXIS_COMPONENT].forEach(function(e){t.components[e]&&t.components[e].updateAxisSizeAndBounds()});var e=!1;[f.Y_AXIS_COMPONENT,f.X_AXIS_COMPONENT].forEach(function(i){e=t.components[i]&&t.components[i].adjustDomain4Radius()||e}),[f.Y_AXIS_COMPONENT,f.X_AXIS_COMPONENT,f.DATA_SHEET_COMPONENT,f.ZOOM_COMPONENT].forEach(function(e){t.components[e]&&t.components[e].fixBoundsByPlot()}),[f.X_AXIS_COMPONENT,f.Y_AXIS_COMPONENT].forEach(function(e){t.components[e]&&t.components[e].dealOnZero()}),e&&h(t),i(t)}function h(t){t.plotBounds&&(t.bounds=p.makeBounds(t.plotBounds,t.plotBounds)),t.clipPool={},t.axisSize={left:0,right:0,bottom:0,top:0},[f.Y_AXIS_COMPONENT,f.X_AXIS_COMPONENT,f.DATA_SHEET_COMPONENT].forEach(function(e){t.components[e]&&t.components[e].reCalculateSize()}),[f.Y_AXIS_COMPONENT,f.X_AXIS_COMPONENT].forEach(function(e){t.components[e]&&t.components[e].updateAxisClip()}),u(t),[f.Y_AXIS_COMPONENT,f.DATA_SHEET_COMPONENT,f.X_AXIS_COMPONENT].forEach(function(e){t.components[e]&&t.components[e].updateAxisSizeAndBounds()}),[f.Y_AXIS_COMPONENT,f.X_AXIS_COMPONENT,f.ZOOM_COMPONENT,f.DATA_SHEET_COMPONENT].forEach(function(e){t.components[e]&&t.components[e].fixBoundsByPlot()}),[f.X_AXIS_COMPONENT,f.Y_AXIS_COMPONENT].forEach(function(e){t.components[e]&&t.components[e].dealOnZero()})}function u(t){var e=t.getChartBounds(),i=t.bounds,a=i.x,n=i.y,r=i.width,s=i.height,o=Math.max(t.clipPool[d.LEFT]||0,a),l=Math.max(t.clipPool[d.RIGHT]||0,e.width-(a+r)),c=Math.max(t.clipPool[d.TOP]||0,n),h=Math.max(t.clipPool[d.BOTTOM]||0,e.height-(n+s));i={x:o,y:c,width:e.width-o-l,height:e.height-c-h},t.setPlotBounds(i)}var d=t("../Constants"),p=t("../utils/BaseUtils"),f=t("../ComponentLibrary"),m=t("../utils/BoundsManager"),g=t("../utils/BezierEasing");return{PLANE_SYSTEM_LAYOUT:function(t){e(t),c(t)},reLayoutPlotBounds:h,calculateBubbleRadius:s,calculateSeries:e,calculateSeriesShapes:i,fixCoordinateSystem:c}}),define("ChartLibrary",["require"],function(t){var e={};return{get:function(t){return e[t]},register:function(t,i){e[t]=i}}}),define("utils/Point2D",["require","./BaseUtils"],function(t){var e=t("./BaseUtils"),i=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e};return i.prototype={clone:function(){return new i(this.x,this.y)},add:function(t){return this.clone()._add(i.create(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(i.create(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new i(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new i(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},distanceTo:function(t){var e=(t=i.create(t)).x-this.x,a=t.y-this.y;return Math.sqrt(e*e+a*a)},equals:function(t){return(t=i.create(t)).x===this.x&&t.y===this.y},contains:function(t){return t=i.create(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+e.formatNum(this.x)+", "+e.formatNum(this.y)+")"}},i.create=function(t,a,n){return t instanceof i?t:e.isArray(t)?new i(t[0],t[1]):void 0===t||null===t?t:"object"==typeof t&&"x"in t&&"y"in t?new i(t.x,t.y):new i(t,a,n)},i}),define("dom/Browser",[],function(){var t=navigator.userAgent.toLowerCase(),e=document.documentElement,i="ActiveXObject"in window,a=-1!==t.indexOf("webkit"),n=-1!==t.indexOf("phantom"),r=-1!==t.search("android [23]"),s=-1!==t.indexOf("chrome"),o=-1!==t.indexOf("gecko")&&!a&&!window.opera&&!i,l=0===navigator.platform.indexOf("Win"),c="undefined"!=typeof orientation||-1!==t.indexOf("mobile"),h=!window.PointerEvent&&window.MSPointerEvent,u=window.PointerEvent||h,d=i&&"transition"in e.style,p="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!r,f="MozPerspective"in e.style,m="OTransition"in e.style,g=!window.L_NO_TOUCH&&(u||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);return{ie:i,ielt9:i&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:a,gecko:o,android:-1!==t.indexOf("android"),android23:r,chrome:s,safari:!s&&-1!==t.indexOf("safari"),win:l,ie3d:d,webkit3d:p,gecko3d:f,opera12:m,any3d:(d||p||f)&&!m&&!n,mobile:c,mobileWebkit:c&&a,mobileWebkit3d:c&&p,mobileOpera:c&&window.opera,mobileGecko:c&&o,touch:!!g,msPointer:!!h,pointer:!!u,retina:(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1}}),define("dom/DomUtils",["require","../utils/BaseUtils","../utils/Point2D","./Browser"],function(t){var e=t("../utils/BaseUtils"),i=t("../utils/Point2D"),a=t("./Browser"),n={get:function(t){return"string"==typeof t?document.getElementById(t):t},getStyle:function(t,e){var i=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!i||"auto"===i)&&document.defaultView){var a=document.defaultView.getComputedStyle(t,null);i=a?a[e]:null}return"auto"===i?null:i},create:function(t,e,i){var a=document.createElement(t);return a.className=e||"",i&&i.appendChild(a),a},remove:function(t){var e=t.parentNode;e&&e.removeChild(t)},empty:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},toFront:function(t){t.parentNode.appendChild(t)},toBack:function(t){if(t&&t.parentNode){var e=t.parentNode;e.insertBefore(t,e.firstChild)}},hasClass:function(t,e){if(void 0!==t.classList)return t.classList.contains(e);var i=n.getClass(t);return i.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)},addClass:function(t,i){if(void 0!==t.classList)for(var a=e.splitWords(i),r=0,s=a.length;r<s;r++)t.classList.add(a[r]);else if(!n.hasClass(t,i)){var o=n.getClass(t);n.setClass(t,(o?o+" ":"")+i)}},removeClass:function(t,i){void 0!==t.classList?t.classList.remove(i):n.setClass(t,e.trim((" "+n.getClass(t)+" ").replace(" "+i+" "," ")))},setClass:function(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e},getClass:function(t){return void 0===t.className.baseVal?t.className:t.className.baseVal},setOpacity:function(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&n._setOpacityIE(t,e)},_setOpacityIE:function(t,e){var i=!1,a="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(a)}catch(t){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+a+"(opacity="+e+")"},testProp:function(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1},setTransform:function(t,e,i){var r=e||{x:0,y:0};t.style[n.TRANSFORM]=(a.ie3d?"translate("+r.x+"px,"+r.y+"px)":"translate3d("+r.x+"px,"+r.y+"px,0)")+(i?" scale("+i+")":"")},setPosition:function(t,e){t._leaflet_pos=e,a.any3d?n.setTransform(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos||i.create({x:0,y:0})},getMousePos:function(t,e){t=t.touches?t.touches.length?t.touches[0]:t.changedTouches[0]:t;var a,n,r=document.documentElement,s=e.getBoundingClientRect(),o=s.top+(window.pageYOffset||r.scrollTop)-(r.clientTop||0),l=s.left+(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0);return null==t.pageX?(a=Math.min(t.x,t.clientX-l),n=Math.min(t.y,t.clientY-o)):(a=t.pageX-l,n=t.pageY-o),i.create(a,n)},_wheelPxFactor:a.win&&a.chrome?2:a.gecko?window.devicePixelRatio:1,getWheelDelta:function(t){return a.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/n._wheelPxFactor:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this},stop:function(t){return n.preventDefault(t).stopPropagation(t)},attr:function(){if(!(arguments.length<2)){var t,i,a=arguments[0],n=arguments[1],r=arguments[2];if("string"==typeof n)e.hasDefined(r)?a.setAttribute(n,r):a&&a.getAttribute&&(i=a.getAttribute(n));else if(e.hasDefined(n)&&"object"==typeof n)for(t in n)a.setAttribute(t,n[t]);return i}}};return function(){n.TRANSFORM=n.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),n.TRANSFORM_ORIGIN=n.testProp(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]);var t=n.TRANSITION=n.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);n.TRANSITION_END="webkitTransition"===t||"OTransition"===t?t+"End":"transitionend"}(),n}),define("HammerHandler",["require","./utils/BaseUtils","./dom/DomUtils","./Constants","./dom/Evented","./ComponentLibrary"],function(t){var e,i=t("./utils/BaseUtils"),a=t("./dom/DomUtils"),n=t("./Constants"),r=t("./dom/Evented"),s=t("./ComponentLibrary"),o=i.hasTouch();return r.extend({initialize:function(t,r){function s(i){var s=i.srcEvent,l=i.type||s.type;l=-1!=l.indexOf("wheel")?"wheel":l;var u=s.target||s.srcElement;i.containerPoint=a.getMousePos(s,r);var d="panstart"==l||"panmove"==l||"panend"==l;o&&t.chartType()!==n.GANTT_CHART?"press"==l?c.pressed=!0:"panstart"!=l&&"panmove"!=l&&(c.pressed=!1):c.pressed=!0;var p;if(d&&c.panTarget)p=c.panTarget;else{for(;u&&((p=c._findTargetByBounds(i.containerPoint,l))||(p=t.findInteractiveTarget(u)),!(p&&p.listens(l,!1)||u===c._container));)u=u.parentNode;p=p&&p.listens(l,!1)?p:h}t.force&&!c.panTarget&&(c.forceTarget=t.force.dragFire(i,c._container)),p&&p.listens(l,!1)&&(p.fire(l,i,!0),"panstart"==l?(c.removeAllChosen(i),c.forceTarget||(c.panTarget=p)):"panend"==l&&(c.panTarget=null),o&&"tap"===l&&(clearTimeout(e),e=setTimeout(function(){c.removeAllChosen(i)},4e3)))}this.vanchart=t,this._container=r,this._state=null;var l=this.hammer=new Hammer.Manager(r,{_handler:this});l.add(new Hammer.Pan({threshold:0})),l.add(new Hammer.Tap),i.isSupportSVG()&&l.add(new Hammer.Press),l.on("panstart panmove panend tap press pressup",s),o||l.on("mouseover mousemove mouseout wheel",s),t.isMap()&&t._zoomEnabled()&&(l.add(new Hammer.Pinch),l.on("pinchmove",s));var c=this,h=t.isMap()?t:c;this.panTarget=null,c.on(c.getEvents())},_findTargetByBounds:function(t,e){var a=this.vanchart,r=(a.series,a.bounds),o=a.getComponent(s.LEGEND_COMPONENT),l=a.getComponent(s.RANGE_LEGEND_COMPONENT);if(o=o||l,"panstart"==e&&o&&o.bounds&&i.containsPoint(o.bounds,t))return o;if(!i.containsPoint(r,t)){var c=a.seriesOfType(n.GAUGE_CHART);if(c&&c.length)for(var h=0,u=c.length;h<u;h++){var d=c[h];if(d.bounds&&i.containsPoint(d.bounds,t))return d}}},cursor:function(t){this._container.style.cursor=t||""},onContainerMouseOver:function(t){},onContainerMouseMove:function(t){var e=this.vanchart.bounds,a=this.vanchart;if(a.renderer,a.chartType()!==n.GANTT_CHART||(a.isResizeEnabled()&&(i.containsPoint(a.resizeBounds,t.containerPoint)?(this.cursor("col-resize"),this._state=1,this.fire("resizeStart",t)):(this.cursor(),this._state=null,this.fire("resizeEnd",t))),this.fire("over",t),1!==this._state))if(i.containsPoint(e,t.containerPoint)){var r=t.srcEvent;if(r.target||r.srcElement,this.cursor(),!this._highlightShared(t)){this._removeHightlight(t);var s;if(a.isLargeMode()&&!a.hoverSeries)(s=this._getCanvasClosestPoint(t.containerPoint))&&(s._events||s.getEvents&&s.on(s.getEvents(),s),a.showTooltip(s,t),a.hoverPoint=s,s.options.click&&this.cursor("pointer"));else if(a.hoverSeries&&(s=a.hoverSeries.getClosestPoint(t.containerPoint))){if(s._events||s.getEvents&&s.on(s.getEvents(),s),s.series.defaultMarker){var o=s.series.defaultMarker;a._targets[i.stamp(o.node())]=s}s.fire("mouseover",t),s.options.click&&this.cursor("pointer")}}}else this.removeAllChosen(t)},removeAllChosen:function(t){var e=this.vanchart;this._removeHightlight(t),e.hoverPoint&&(e.hoverPoint.fire("mouseout",t),e.hoverPoint=null),e.hoverSeries&&e.hoverSeries.fire("mouseout",t);var i=e.getComponent(s.TOOLTIP_COMPONENT);i&&"vanChartMap"!==e.vanChartType&&i.immediateHide(),t&&e.cancelLegendHighlight(t.containerPoint)},_getCanvasClosestPoint:function(t){var e=this.vanchart,i=e.seriesOfType(n.BUBBLE_CHART).concat(e.seriesOfType(n.SCATTER_CHART)),a=e.isMap(),r=e.seriesOfType(n.HEAT_MAP);i=i.concat(r);for(var s=this.vanchart.bounds,o=i.length-1;o>=0;o--)for(var l=i[o],c=l.points.length-1;c>=0;c--){var h=l.points[c],u=a&&h.options.lnglat?e.latLngToContainerPoint(h.getLatLng()):{x:h.posX+s.x,y:h.posY+s.y},d=u.x-t.x,p=u.y-t.y;if(Math.sqrt(d*d+p*p)<=(h.radius||h.options.marker&&h.options.marker.radius||4.5)&&h.visible)return h}},onContainerMouseOut:function(t){},onContainerTap:function(t){this.onContainerMouseMove(t);var e=this.vanchart.hoverPoint;e&&e.fire("tap",t)},onContainerPanStart:function(t){if(!this.forceTarget){var e=this.vanchart,a=e.renderer,r=t.containerPoint,o=e.bounds;if(e.chartType()===n.GANTT_CHART)return void(i.containsPoint(e.resizeBounds,r)?(this._state=1,this.fire("resizeStart",t)):!this._state&&i.containsPoint(e.panBounds,r)&&(this._state=2,this.fire("pan",t)));!this.selectRect&&this._supportCoordinateZoom()&&i.containsPoint(o,r)&&(this.selectRect=a.rect().style({fill:"rgb(69,114,167)","fill-opacity":.25}).add(),this.downPos=r,e.hoverPoint&&e.hoverPoint.fire("mouseout"));var l=e.getComponent(s.ZOOM_COMPONENT);this._zoomAsTarget(l,r)&&l._panStart(t,l.centerRect)}},_zoomAsTarget:function(t,e){var a=this.vanchart,n=a.bounds,r=!1,o=a.getComponent(s.DATA_SHEET_COMPONENT);return o&&(r=i.containsPoint(o.bounds,e)),r=r||i.containsPoint(n,e),t&&t.zoomToolEnabled()&&r},onContainerPanMove:function(t){var e=this.vanchart,a=(e.renderer,e.hoverPoint,e.bounds),r=e.options,o=t.containerPoint,l=this.downPos,c=e.isInverted();if(e.chartType()!==n.GANTT_CHART){if(this.selectRect){var h=r.zoom.zoomType,u=Math.min(o.x,l.x),d=Math.min(o.y,l.y),p=Math.abs(o.x-l.x),f=Math.abs(o.y-l.y),m=-1!=h.indexOf("x"),g=-1!=h.indexOf("y");c&&(m=-1!=h.indexOf("y"),g=-1!=h.indexOf("x")),m&&!g?(d=a.y,f=a.height):g&&!m&&(u=a.x,p=a.width),this.selectRect.attr({x:u,y:d,width:p,height:f})}var v=e.getComponent(s.ZOOM_COMPONENT);v&&v.zoomToolEnabled()&&v._panContainerMove(t)}else i.containsPoint(this.vanchart.panBounds,o)&&(1===this._state?this.fire("resizeMove",t):2===this._state&&this.fire("pan",t))},onContainerPanEnd:function(t){var e=this.vanchart,a=(e.renderer,e.hoverPoint,e.bounds,e.options,t.containerPoint),r=this.downPos,o=e.components[s.TOOLBAR_COMPONENT];if(e.chartType()!==n.GANTT_CHART){this.selectRect&&(i.distance(r,a)>14&&(e.clearAllEffects(),e.dealAxisZoom(r,a),o&&o.showRefreshIconWhenZoom()),this.selectRect.remove(),this.selectRect=null),this.panTarget=null;var l=e.getComponent(s.ZOOM_COMPONENT);l&&l.zoomToolEnabled()&&l._panEnd()}else 1===this._state?(this._state=null,this.fire("resizeEnd",t)):2===this._state&&(this._state=null,this.fire("pan",t))},onContainerWheel:function(t){var e=this.vanchart;e.chartType()===n.GANTT_CHART&&i.containsPoint(e.panBounds,t.containerPoint)&&(t.srcEvent.preventDefault(),t.wheel=this.normalizeWheel(t.srcEvent),this.fire("wheelMove",t))},_highlightShared:function(t){var e=this.vanchart.getSharedAxis();if(e&&e.getPointsInCategory){var i=t.containerPoint,a=e.getPointsInCategory(i);if(a&&a.length)return a[0]._onPointMouseOver.call(a[0],t),e.drawHighlightBackground(a),!0}return!1},_removeHightlight:function(t){var e=this.vanchart,i=e.getSharedAxis(),a=e.hoverPoints;i&&i.removeHighlightBackground&&i.removeHighlightBackground(),a&&a.length&&a[0]._onPointMouseOut.call(a[0],t),e.hoverPoints=null},getEvents:function(){return{mouseover:this.onContainerMouseOver,mousemove:this.onContainerMouseMove,mouseout:this.onContainerMouseOut,tap:this.onContainerTap,panstart:this.onContainerPanStart,panmove:this.onContainerPanMove,panend:this.onContainerPanEnd,wheel:this.onContainerWheel}},_supportCoordinateZoom:function(){var t=this.vanchart.hoverPoint&&"vanChartForceBubble"==this.vanchart.vanChartType,e=this.vanchart.options;return i.isSupportSVG()&&e.zoom&&e.zoom.zoomType&&!t},destroy:function(){this.hammer.destroy()},_inZoomBar:function(t){var e=this.vanchart.getComponent(s.ZOOM_COMPONENT);return e&&e.bounds&&i.containsPoint(e.bounds,t)},preventDefault:function(t){var e=t.srcEvent,r=e.target||e.srcElement,o=a.getMousePos(e,this._container),l=this.pressed||this._inZoomBar(o),c=this.vanchart.getComponent(s.ZOOM_COMPONENT);return!l&&c&&(l=c.target||this._zoomAsTarget(c,o),l=l&&(Math.abs(t.angle)<45||Math.abs(t.angle)>135)),this.vanchart.isMap()&&(l=this.vanchart._zoomEnabled()&&"A"!=r.nodeName),this.vanchart.chartType()===n.GANTT_CHART&&(l=i.containsPoint(this.vanchart.panBounds,o)),l?this.hammer.touchAction.setTouchActionNone():this.hammer.touchAction.recoverTouchAction(),l},normalizeWheel:function(t){var e=0,i=0,a=0,n=0;return"detail"in t&&(i=t.detail),"wheelDelta"in t&&(i=-t.wheelDelta/120),"wheelDeltaY"in t&&(i=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=i,i=0),a=10*e,n=10*i,"deltaY"in t&&(n=t.deltaY),"deltaX"in t&&(a=t.deltaX),(a||n)&&t.deltaMode&&(1===t.deltaMode?(a*=40,n*=40):(a*=800,n*=800)),a&&!e&&(e=a<1?-1:1),n&&!i&&(i=n<1?-1:1),{spinX:e,spinY:i,pixelX:a,pixelY:n}}})}),define("vector/Layer",["require","../dom/Evented","../utils/BaseUtils"],function(t){var e=t("../dom/Evented"),i=t("../utils/BaseUtils");return e.extend({options:{pane:"overlayPane",nonBubblingEvents:[]},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},beforeAdd:function(t){this._renderer=t.getMapRenderer(this)},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",function(){e.off(i,this)},this)}this.onAdd(e)}},_reset:i.falseFn,_project:i.falseFn,_update:i.falseFn})}),define("utils/Bounds",["require","./Point2D"],function(t){var e=t("./Point2D"),i=function(t,e){if(t)for(var i=e?[t,e]:t,a=0,n=i.length;a<n;a++)this.extend(i[a])};return i.prototype={extend:function(t){return t=e.create(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new e((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new e(this.min.x,this.max.y)},getTopRight:function(){return new e(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var a,n;return(t="number"==typeof t[0]||t instanceof e?e.create(t):i.create(t))instanceof i?(a=t.min,n=t.max):a=n=t,a.x>=this.min.x&&n.x<=this.max.x&&a.y>=this.min.y&&n.y<=this.max.y},intersects:function(t){t=i.create(t);var e=this.min,a=this.max,n=t.min,r=t.max,s=r.x>=e.x&&n.x<=a.x,o=r.y>=e.y&&n.y<=a.y;return s&&o},overlaps:function(t){t=i.create(t);var e=this.min,a=this.max,n=t.min,r=t.max,s=r.x>e.x&&n.x<a.x,o=r.y>e.y&&n.y<a.y;return s&&o},isValid:function(){return!(!this.min||!this.max)}},i.create=function(t,e){return!t||t instanceof i?t:new i(t,e)},i}),define("utils/Timer",["require","./BaseUtils"],function(t){function e(){var t=i(),n=a()-t;n>24?(isFinite(n)&&(clearTimeout(o),o=setTimeout(e,n)),s=0):(s=1,c(e))}function i(){var t=Date.now();for(l=n;l;)t>=l.t&&(l.f=l.c(t-l.t)),l=l.n;return t}function a(){for(var t,e=n,i=1/0;e;)e.f?e=t?t.n=e.n:n=e.n:(e.t<i&&(i=e.t),e=(t=e).n);return r=t,i}var n,r,s,o,l,c=t("./BaseUtils").requestAnimFrame,h=function(t,i,a){var l=arguments.length;l<2&&(i=0),l<3&&(a=Date.now());var h={c:t,t:a+i,f:!1,n:null};r?r.n=h:n=h,r=h,s||(o=clearTimeout(o),s=1,c(e))};return h.flush=function(){i(),a()},h.getActiveTimer=function(){return l},h}),define("utils/Interpolator",["require","./ColorUtils"],function(t){function e(t,e){var i=typeof e;return("string"===i?p.hasColorName(e)||/^(#|rgb\(|hsl\()/.test(e)?a:n:Array.isArray(e)?o:"object"===i&&isNaN(e)?r:s)(t,e)}function i(t){return t<16?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function a(t,e){t="none"==t||""==t?e:t,t=p.getRGBAColorArray(t),e=p.getRGBAColorArray(e);var a=t[0],n=t[1],r=t[2],s=e[0]-a,o=e[1]-n,l=e[2]-r;return function(t){return"#"+i(Math.round(a+s*t))+i(Math.round(n+o*t))+i(Math.round(r+l*t))}}function n(t,e){var i,a,n,r=f.lastIndex=m.lastIndex=0,o=-1,l=[],c=[];for(t+="",e+="";(i=f.exec(t))&&(a=m.exec(e));)(n=a.index)>r&&(n=e.slice(r,n),l[o]?l[o]+=n:l[++o]=n),(i=i[0])===(a=a[0])?l[o]?l[o]+=a:l[++o]=a:(l[++o]=null,c.push({i:o,x:s(i,a)})),r=m.lastIndex;return r<e.length&&(n=e.slice(r),l[o]?l[o]+=n:l[++o]=n),l.length<2?c[0]?(e=c[0].x,function(t){return e(t)+""}):function(){return e}:(e=c.length,function(t){for(var i,a=0;a<e;++a)l[(i=c[a]).i]=i.x(t);return l.join("")})}function r(t,i){var a,n={},r={};for(a in t)a in i?n[a]=e(t[a],i[a]):r[a]=t[a];for(a in i)a in t||(r[a]=i[a]);return function(t){for(a in n)r[a]=n[a](t);return r}}function s(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}function o(t,i){var a,n=[],r=[],s=t.length,o=i.length,l=Math.min(t.length,i.length);for(a=0;a<l;++a)n.push(e(t[a],i[a]));for(;a<s;++a)r[a]=t[a];for(;a<o;++a)r[a]=i[a];return function(t){for(a=0;a<l;++a)r[a]=n[a](t);return r}}function l(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g");return(l=function(t){if(null!=t){e.setAttribute("transform",t);var i=e.transform.baseVal.consolidate()}return new c(i?i.matrix:g)})(t)}function c(t){var e=[t.a,t.b],i=[t.c,t.d],a=u(e),n=h(e,i),r=u(d(i,e,-n))||0;e[0]*i[1]<i[0]*e[1]&&(e[0]*=-1,e[1]*=-1,a*=-1,n*=-1),this.rotate=180*(a?Math.atan2(e[1],e[0]):Math.atan2(-i[0],i[1]))/Math.PI,this.translate=[t.e,t.f],this.scale=[a,r],this.skew=r?180*Math.atan2(n,r)/Math.PI:0}function h(t,e){return t[0]*e[0]+t[1]*e[1]}function u(t){var e=Math.sqrt(h(t,t));return e&&(t[0]/=e,t[1]/=e),e}function d(t,e,i){return t[0]+=i*e[0],t[1]+=i*e[1],t}var p=t("./ColorUtils"),f=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,m=new RegExp(f.source,"g");c.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var g={a:1,b:0,c:0,d:1,e:0,f:0};return e.identity=function(t){return t},e.interpolateRound=function(t,e){return e-=t,function(i){return Math.round(t+e*i)}},e.uninterpolateNumber=function(t,e){return e=(e-=t=+t)||1/e,function(i){return(i-t)/e}},e.interpolateNumber=function(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}},e.interpolate=e,e.interpolateRgb=a,e.interpolateTransform=function(t,e){var i,a=[],n=[],r=l(t),o=l(e),c=r.translate,h=o.translate,u=r.rotate,d=o.rotate,p=r.skew,f=o.skew,m=r.scale,g=o.scale;return c[0]!=h[0]||c[1]!=h[1]?(a.push("translate(",null,",",null,")"),n.push({i:1,x:s(c[0],h[0])},{i:3,x:s(c[1],h[1])})):h[0]||h[1]?a.push("translate("+h+")"):a.push(""),u!=d?(u-d>180?d+=360:d-u>180&&(u+=360),n.push({i:a.push(a.pop()+"rotate(",null,")")-2,x:s(u,d)})):d&&a.push(a.pop()+"rotate("+d+")"),p!=f?n.push({i:a.push(a.pop()+"skewX(",null,")")-2,x:s(p,f)}):f&&a.push(a.pop()+"skewX("+f+")"),m[0]!=g[0]||m[1]!=g[1]?(i=a.push(a.pop()+"scale(",null,",",null,")"),n.push({i:i-4,x:s(m[0],g[0])},{i:i-2,x:s(m[1],g[1])})):1===g[0]&&1===g[1]||a.push(a.pop()+"scale("+g+")"),i=n.length,function(t){for(var e,r=-1;++r<i;)a[(e=n[r]).i]=e.x(t);return a.join("")}},e.interpolateArray=o,e}),define("vector/Transition",["require","../utils/BaseUtils","../utils/Timer","../utils/vMap","../utils/Interpolator","../utils/BezierEasing"],function(t){function e(t,e,i,a){var n=t.id,r=t.namespace,i=a(i);return t.elW.node()[r][n].tween.set(e,i),t}function i(t,e,i,a){var n=t[e]||(t[e]={active:0,count:0}),r=n[i];if(!r){var c=a.time;r=n[i]={tween:new l,time:c,delay:a.delay,duration:a.duration,ease:a.ease},a=null,++n.count,o(function(a){function l(e){if(n.active>i)return u();var a=n[n.active];a&&(--n.count,delete n[n.active],a.event&&a.event.interrupt.call(t)),n.active=i,r.event&&r.event.start.call(t),r.tween.forEach(function(e,i){(i=i.call(t))&&g.push(i)}),p=r.ease,d=r.duration,o(function(){return m.c=h(e||1)?s.trueFn:h,1},0,c)}function h(e){if(n.active!==i)return 1;for(var a=e/d,s=p(a),o=g.length;o>0;)g[--o].call(t,s);return a>=1?(r.event&&r.event.end.call(t),u()):void 0}function u(){return--n.count?n[i]=void 0:t[e]=void 0,1}var d,p,f=r.delay,m=o.getActiveTimer(),g=[];if(m.t=f+c,f<=a)return l(a-f);m.c=l},0,c)}}function a(){return++d}function n(t){return null==t?"__transition__":"__transition_"+t+"__"}function r(t){return t&&(t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView)}var s=t("../utils/BaseUtils"),o=t("../utils/Timer"),l=t("../utils/vMap"),c=t("../utils/Interpolator"),h=t("../utils/BezierEasing"),u=s.isSupportSVG(),d=0,p=function(t,e,r,s){var o=a(),l=n(e);r=r||{time:Date.now(),ease:h.ease("linear"),delay:0,duration:250},this.noAnimation=s||!u,s&&(r.time=0),i(t.node(),l,o,r),this.elW=t,this.namespace=l,this.id=o};return s.extend(p.prototype,{setAnimation:function(t){for(var e in t)this[e]&&this[e](t[e]);return this},tween:function(t,e){var i=this.id,a=this.namespace,n=this.elW.node();return arguments.length<2?n[a][i].tween.get(t):(null==e?n[a][i].tween.remove(t):n[a][i].tween.set(t,e),this)},attr:function(t,i){function a(){this.removeAttribute(s)}function n(){this.removeAttributeNS(s.space,s.local)}if(arguments.length<2){for(i in t)this.attr(i,t[i]);return this}if(this.noAnimation)return this.elW.attr(t,i),this;var r="transform"==t?c.interpolateTransform:c,s=t;return e(this,"attr."+t,i,s.local?function(t){return null==t?n:(t+="",function(){var e,i=this.getAttributeNS(s.space,s.local);return i!==t&&(e=r(i,t),function(t){this.setAttributeNS(s.space,s.local,e(t))})})}:function(t){return null==t?a:(t+="",function(){var e,i=this.getAttribute(s);return i!==t&&(e=r(i,t),function(t){this.setAttribute(s,e(t))})})})},attrTween:function(t,e){if(arguments.length<2){for(e in t)this.attrTween(e,t[e]);return this}var i=t;if(this.noAnimation){var a=e.call(this.elW.node());return this.elW.attr(i,a(1)),this}return this.tween("attr."+t,i.local?function(t,a){var n=e.call(this,t,a,this.getAttributeNS(i.space,i.local));return n&&function(t){this.setAttributeNS(i.space,i.local,n(t))}}:function(t,a){var n=e.call(this,t,a,this.getAttribute(i));return n&&function(t){this.setAttribute(i,n(t))}})},style:function(t,i,a){function n(){this.style.removeProperty(t)}var s=arguments.length;if(s<3){if("string"!=typeof t){s<2&&(i="");for(a in t)this.style(a,t[a],i);return this}a=""}return this.noAnimation?(this.elW.style(t,i),this):e(this,"style."+t,i,function(e){return null==e?n:(e+="",function(){var i,n=r(this).getComputedStyle(this,null).getPropertyValue(t);return n!==e&&(i=c(n,e),function(e){this.style.setProperty(t,i(e),a)})})})},styleTween:function(t,e,i){if(arguments.length<3&&(i=""),this.noAnimation){var a=e.call(this.elW.node());return this.elW.style(t,a(1)),this}return this.tween("style."+t,function(a,n){var s=e.call(this,a,n,r(this).getComputedStyle(this,null).getPropertyValue(t));return s&&function(e){this.style.setProperty(t,s(e),i)}})},remove:function(){var t=this.namespace;return this.each("end.transition",function(){var e;this[t].count<2&&(e=this.parentNode)&&e.removeChild(this)})},each:function(t,e){var i=this.elW.node(),a=this.id,n=i[this.namespace][a];return(n.event||(n.event=s.dispatch("start","end","interrupt"))).on(t,e),this},ease:function(t){var e=this.id,i=this.namespace,a=this.elW.node();return arguments.length<1?a[i][e].ease:("function"!=typeof t&&(t=h.ease.apply(null,arguments)),a[i][e].ease=t,this)},delay:function(t){var e=this.id,i=this.namespace,a=this.elW.node();return arguments.length<1?a[i][e].delay:(t=+t,a[i][e].delay=t,this)},duration:function(t){var e=this.id,i=this.namespace,a=this.elW.node();return arguments.length<1?a[i][e].duration:(t=Math.max(1,t),a[i][e].duration=t,this)},transition:function(t){var e=this.id,i=this.namespace,a=this.elW.node()[i][e];return new p(this.elW,i,{time:a.time,ease:a.ease,delay:a.delay+a.duration,duration:a.duration},this.noAnimation).setAnimation(t)},animate:function(t){return this.setAnimation(t)}}),p.d3_transitionNamespace=n,p.nextTransitionID=a,p}),define("vector/ElementWrapper",["require","../utils/Class","../dom/DomUtils","./Transition","../utils/BaseUtils"],function(t){var e=t("../utils/Class"),i=t("../dom/DomUtils"),a=t("./Transition"),n=t("../utils/BaseUtils").isArray;return e.extend({initialize:function(t,e){return this.rawElement=t,this.renderer=e,this},node:function(){return this.rawElement},addTo:function(t){return(t=t||this.renderer._container).append(this),this},addToBack:function(t){return t=t||this.renderer._container,(t=t.node()).firstChild?t.insertBefore(this.node(),t.firstChild):t.appendChild(this.node()),this},add:function(){return"div"===this.type?this.addTo(this.renderer._divContainer):this.addTo(this.renderer._container)},append:function(t){return this.node().appendChild(t.node()),t},datum:function(){return arguments.length?(this._datum=arguments[0],this):this._datum},addClass:function(t){return i.addClass(this.node(),t),this},remove:function(){return i.remove(this.node()),this},removed:function(){return!(this.node().parentNode&&this.node().parentNode.tagName)},isVisible:function(){return!this.removed()&&"none"!=this.node().style.display},setType:function(t){return this.type=t,this},vRotate:function(t,e){return this.renderer.vRotate(this,t,e),this},vMiddle:function(){this.renderer.vMiddle(this)},animate:function(t){if(t){if(n(t)){for(var e=this.transition().setAnimation(t[0]),i=1,a=t.length;i<a;i++)e=e.transition(t[i]);return this.setTransitionEnd(e,t[a-1].style)}return this.setTransitionEnd(this.transition().setAnimation(t),t.style)}throw new Error("animate para empty")},setTransitionEnd:function(t,e){var i=this,a=this.renderer.vanchart;return++a.animationCount,t.each("end",function(){e&&i.style(e),a._animationStarted&&(--a.animationCount||(a.animationCount=-1,a.fire("animationEnd")))})},effectTransition:function(){return new a(this)},transition:function(t){return new a(this,t,null,!this.renderer.isAnimation)},interrupt:function(t){var e,i=this.node(),n=a.d3_transitionNamespace(t);return(e=i[n])&&e[e.active]&&(--e.count?delete e[e.active]:delete i[n],e.active+=.5),this}})}),define("vector/Renderer",["require","./Layer","../dom/DomUtils","../dom/Browser","../utils/Bounds","../utils/BaseUtils","./ElementWrapper"],function(t){var e=t("./Layer"),i=t("../dom/DomUtils"),a=t("../dom/Browser"),n=t("../utils/Bounds"),r=t("../utils/BaseUtils"),s=t("./ElementWrapper");return e.extend({initialize:function(t,e,i){this.dom=t,this.vanchart=e,this.config=i,this.isSupportSVG=r.isSupportSVG(),this.isAnimation=this.isSupportSVG&&r.pick(this.vanchart.options.plotOptions.animation,!0)},resize:function(){},remove:function(){i.remove(this._container.node()),this.off("update",this._updatePaths,this)},div:function(t){var e=new s(document.createElement("div"),this).setType("div").style({position:"absolute",left:0,top:0});return e.isHtml=t,e},vgroup:function(){var t=this.div(),e=this.group();return{divG:t,renderG:e,type:"vgroup",attr:function(){return this.divG.attr.apply(this.divG,arguments),this.renderG.attr.apply(this.renderG,arguments),this},style:function(){return this.divG.style.apply(this.divG,arguments),this.renderG.style.apply(this.renderG,arguments),this},append:function(i){return"div"===i.type&&i.isHtml?t.append(i):"vgroup"===i.type?(t.append(i.divG),e.append(i.renderG)):e.append(i),i},add:function(t){return t?this.renderG.addTo(t):this.renderG.add(),this.divG.add(),this},remove:function(){this.divG.node()&&this.divG.remove(),this.renderG.node()&&this.renderG.remove()},node:function(){return e.node()},vRotate:function(t){isNaN(t)||(this.divG.vRotate(t),this.renderG.vRotate(t))}}},vtext:function(t){return t||!this.isSupportSVG?this.div(t):this.text()},vtspan:function(t){return t||!this.isSupportSVG?this.div(t):this.tspan()},onAdd:function(){this._conatainer||(this._initContainer(),this._zoomAnimated&&i.addClass(this._container.node(),"leaflet-zoom-animated")),this.dom.appendChild(this._container.node()),this._divContainer&&this.dom.appendChild(this._divContainer.node()),this._update(),this.on("update",this._updatePaths,this)},_update:function(){var t=this.vanchart.getSize();if(this._bounds=new n([0,0],t),this._map){var e=this._map.containerPointToLayerPoint(t.multiplyBy(-0)).round();this._bounds=new n(e,e.add(t.multiplyBy(1)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);var t=this.vanchart._layers;for(var e in t)t[e]._path&&t[e]._reset()},_onZoomEnd:function(){var t=this.vanchart._layers;for(var e in t)t[e]._path&&t[e]._project()},_updatePaths:function(){var t=this.vanchart._layers;for(var e in t)t[e]._path&&t[e]._update()},_updateTransform:function(t,e){var n=this._container.node(),s=this._map.getZoomScale(e,this._zoom),o=i.getPosition(n),l=this._map.getSize().multiplyBy(.5),c=this._map.project(this._center,e),h=this._map.project(t,e).subtract(c),u=l.multiplyBy(-s).add(o).add(l).subtract(h);a.any3d?i.setTransform(n,u,s):r.isSupportSVG()?i.setPosition(n,u):(n.style.left="0px",n.style.top="0px")}})}),define("vector/SvgRenderer",["require","./Renderer","../dom/DomUtils","../utils/BaseUtils","./ElementWrapper"],function(t){function e(t){var e,i;return(e=t.match(/translate\(\s*([\d|.|e|-]+)(?:[,\s]*)([\d|.|e|-]*)\s*\)/i))&&e.shift(),i=t.match(/rotate\(\s*([\d|.|e|-]+[degratun]*)(?:[,\s]*)([\d|.|e|-]*)(?:[,\s]*)([\d|.|e|-]*)\s*\)/i),i=i&&i[1]||0,{translate:e,rotate:i}}function i(){o||(o=!0,s.include({imageContent:function(t){return this.node().setAttributeNS("http://www.w3.org/1999/xlink","href",t),this},textContent:function(t){return"div"===this.type?this.node().innerHTML=t:this.node().textContent=t,this},attr:function(){return"div"===this.type?this.style.apply(this,arguments):n.attr.apply(null,[this.node()].concat(r.objectToArray(arguments))),this},style:function(t){var i;2===arguments.length?(i={},i[arguments[0]]=arguments[1]):i=arguments[0];var a,n=this.styles,s={},o=this.node(),l="",c=!n;if(i&&i.color&&(i.fill=i.color),i&&i.fill&&"div"===this.type&&(i.color=i.fill),n)for(a in i)i[a]!==n[a]&&(s[a]=i[a],c=!0);if(c){if("div"===this.type){var h={x:"left",y:"top",dx:"margin-left"};for(var u in h){var d;null!=(d=s[u])&&(s[h[u]]=/em/gi.test(d)?d:d+"px",delete s[u])}if(s.transform){var p=e(s.transform.replace(/px/gi,""));p.translate&&(s[r.transPrefix+"transform"]="translate("+p.translate[0]+"px,"+p.translate[1]+"px)")}}n&&(i=r.extend(n,s)),this.styles=i;for(a in i)l+=a.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()})+":"+i[a]+";";o.style.cssText=l,i.fill&&(o.style.fill=i.fill)}return this}}))}var a=t("./Renderer"),n=t("../dom/DomUtils"),r=t("../utils/BaseUtils"),s=t("./ElementWrapper"),o=!1,l=a.extend({_initContainer:function(){i(),this._container=new s(this.create("svg"),this),this.defs=new s(this.create("defs"),this).addTo(this._container),this._divContainer=this.div().style({"white-space":"nowrap","pointer-events":"none"})},resize:function(){var t=this.vanchart.width,e=this.vanchart.height;this._container.style({width:t+"px",height:e+"px"})},_update:function(){if(!(this._map&&this._map._animatingZoom&&this._bounds)){a.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container.node();this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),n.setPosition(i,t.min),this._map&&i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},line:function(t){return new s(this.create("line"),this).attr(t)},rect:function(t){return new s(this.create("rect"),this).attr(t)},circle:function(t){return new s(this.create("circle"),this).attr(t)},path:function(t){return new s(this.create("path"),this).attr(t)},text:function(t){return new s(this.create("text"),this).attr(t)},tspan:function(t){return new s(this.create("tspan"),this).attr(t)},image:function(t){return new s(this.create("image"),this).attr(t)},group:function(t){return new s(this.create("g"),this).attr(t)},colorGradient:function(t,e,i){i=i||"linearGradient";var a=new s(this.create(i),this);t.id=r.stamp(a),a.attr(t),a.stops=[];for(var n=0,o=e.length;n<o;n++)a.stops[n]=new s(this.create("stop"),this).attr(e[n]).addTo(a);return a.addTo(this.defs)},updateColorGradient:function(t,e,i){t.attr(e);for(var a=0,n=i.length;a<n;a++)t.stops[a].attr(i[a])},createClip:function(t,e){e=e||"rect";var i=new s(this.create("clipPath"),this);return i.attr("id",r.stamp(i)),i.setType(e),i[e]=new s(this.create(e),this).attr(t).addTo(i),i.addTo(this.defs),i},clip:function(t,e){t.attr("clip-path","url(#"+r.stamp(e)+")")},updateClip:function(t,e){t&&t[t.type].attr(e)},imagePattern:function(t,e,i){var a=new s(this.create("pattern"),this);return t.id=r.stamp(a),a.attr(t),a.image=new s(this.create("image"),this).addTo(a),a.image.attr(e),a.image.imageContent(i),a.image._imageUrl=i,a.addTo(this.defs),a},updateImagePattern:function(t,e,i,a){t.attr(e),t.image.attr(i),t.image._imageUrl!=a&&(t.image.imageContent(a),t.image._imageUrl=a)},createDropShadowFilter:function(t,e,i,a,n,o,l){n=n||0,o=o||0,l=l||0;var c=new s(this.create("filter"),this),h=r.stamp(c);return c.attr({id:h,x:"-50%",y:"-50%",width:"200%",height:"200%"}),this.updateDropShadowFilter(c,t,e,i,a,n,o,l),c.feBlend=c.feBlend||new s(this.create("feBlend"),this).addTo(c),c.feBlend.attr({in:"SourceGraphic",in2:"blurOut",mode:"normal"}),c.addTo(this.defs),c},updateDropShadowFilter:function(t,e,i,a,n,r,o,l){r=r||0,o=o||0,l=l||0,t.feOffset=t.feOffset||new s(this.create("feOffset"),this).addTo(t),t.feOffset.attr({in:"SourceGraphic",dx:e,dy:i,result:"offOut"}),t.feColorMatrix=t.feColorMatrix||new s(this.create("feColorMatrix"),this).addTo(t),t.feColorMatrix.attr({in:"offOut",type:"matrix",values:r+" 0 0 0 0 0 "+o+" 0 0 0 0 0 "+l+" 0 0 0 0 0 "+a+" 0",result:"matrixOut"}),t.feGaussianBlur=t.feGaussianBlur||new s(this.create("feGaussianBlur"),this).addTo(t),t.feGaussianBlur.attr({in:"matrixOut",stdDeviation:n,result:"blurOut"})},createInnerShadowFilter:function(t,e,i,a){var n=new s(this.create("filter"),this),o=r.stamp(n);return n.attr({id:o,x:"-50%",y:"-50%",width:"200%",height:"200%"}),n.feComponentTransfer=n.feComponentTransfer||new s(this.create("feComponentTransfer"),this).attr({in:"SourceAlpha"}).addTo(n),n.feComponentTransfer.feFuncA=n.feComponentTransfer.feFuncA||new s(this.create("feFuncA"),this).attr({type:"table",tableValues:"1 0"}).addTo(n.feComponentTransfer),n.feGaussianBlur=n.feGaussianBlur||new s(this.create("feGaussianBlur"),this).addTo(n),n.feGaussianBlur.attr("stdDeviation",a),n.feOffset=n.feOffset||new s(this.create("feOffset"),this).addTo(n),n.feOffset.attr({dx:t,dy:e,result:"offsetblur"}),n.feFlood=n.feFlood||new s(this.create("feFlood"),this).addTo(n),n.feFlood.attr({"flood-color":"black","flood-opacity":i,result:"color"}),n.feComposite1=n.feComposite1||new s(this.create("feComposite"),this).attr({in2:"offsetblur",operator:"in"}).addTo(n),n.feComposite2=n.feComposite2||new s(this.create("feComposite"),this).attr({in2:"SourceAlpha",operator:"in"}).addTo(n),n.merge=n.merge||new s(this.create("feMerge"),this).addTo(n),n.merge.feMergeNode1=n.merge.feMergeNode1||new s(this.create("feMergeNode"),this).attr("in","SourceGraphic").addTo(n.merge),n.merge.feMergeNode2=n.merge.feMergeNode2||new s(this.create("feMergeNode"),this).addTo(n.merge),n.addTo(this.defs),n},create:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},vRotate:function(t,i,a){var n,s,o,l=t.node();if("div"===t.type){(s=t.styles[r.transPrefix+"transform"]||"")&&(n=e(s.replace(/px/gi,"")),s="",n.translate&&(s="translate("+n.translate[0]+"px,"+n.translate[1]+"px) ")),s+=o="rotate("+i+"deg)";var c=r.transPrefix+"transform";t.styles[c]=s,l.style[c]=s}else{var h=(l.scrollWidth||l.getBBox().width)/2,u=(l.scrollHeight||l.getBBox().height)/2-1;h+=+l.getAttribute("x")||0,u+=+l.getAttribute("y")||0,(s=l.getAttribute("transform")||"")&&(n=e(s),s="",n.translate&&(s="translate("+n.translate[0]+" "+n.translate[1]+") ")),s+=o="rotate("+i+" "+h+" "+u+")",a||t.attr("transform",s)}return t.rotateStr=o,this},vMiddle:function(t){if("div"===t.type){var e=t.node(),i=e.offsetWidth;e.style.marginLeft=-i/2+"px"}else t.attr("text-anchor","middle");return this}});return l.include({getEvents:function(){var t=a.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_onZoomStart:function(){this._update()}}),l}),define("utils/PathUtils",["require"],function(t){function e(t){var e=/([clmz]),?([^clmz]*)/gi,i={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},a=/[ahqstv]/gi,r=l;if(String(t).match(a)&&(r=n),a=/[clmz]/g,r==l&&!String(t).match(a)){var s=String(t).replace(e,function(t,e,a){var n=[],r="m"==e.toLowerCase(),s=i[e];return a.replace(T,function(t){r&&2===n.length&&(s+=n+i["m"==e?"l":"L"],n=[]),n.push(v(t*C))}),s+n});return s}var o,c,h=r(t);s=[];for(var u=0,d=h.length;u<d;u++){o=h[u],"z"==(c=h[u][0].toLowerCase())&&(c="x");for(var p=1,f=o.length;p<f;p++)c+=v(o[p]*C)+(p!=f-1?",":x);s.push(c)}return s.join(b)}function i(t){if(!t&&"string"!=typeof t)return null;var e={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},i=[];return String(t).replace(h,function(t,a,n){var r=[],s=a.toLowerCase();if(n.replace(u,function(t,e){e&&r.push(+e)}),"m"==s&&r.length>2&&(i.push([a][d](r.splice(0,2))),s="l",a="m"==a?"l":"L"),"r"==s)i.push([a][d](r));else for(;r.length>=e[s]&&(i.push([a][d](r.splice(0,e[s]))),e[s]););}),i.toString=a,i}function a(){return this.join(",").replace(_,"$1")}function n(t,e){for(var i=l(t),a=e&&l(e),n={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},c={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=function(t,e,i){var a,n,l={T:1,Q:1};if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in l)&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"][d](o[p](0,[e.x,e.y][d](t.slice(1))));break;case"S":"C"==i||"S"==i?(a=2*e.x-e.bx,n=2*e.y-e.by):(a=e.x,n=e.y),t=["C",a,n][d](t.slice(1));break;case"T":"Q"==i||"T"==i?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"][d](r(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"][d](r(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"][d](s(e.x,e.y,t[1],t[2]));break;case"H":t=["C"][d](s(e.x,e.y,t[1],e.y));break;case"V":t=["C"][d](s(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"][d](s(e.x,e.y,e.X,e.Y))}return t},u=function(t,e){if(t[e].length>7){t[e].shift();for(var n=t[e];n.length;)g[e]="A",a&&(v[e]="A"),t.splice(e++,0,["C"][d](n.splice(0,6)));t.splice(e,1),_=m(i.length,a&&a.length||0)}},f=function(t,e,n,r,s){t&&e&&"M"==t[s][0]&&"M"!=e[s][0]&&(e.splice(s,0,["M",r.x,r.y]),n.bx=0,n.by=0,n.x=t[s][1],n.y=t[s][2],_=m(i.length,a&&a.length||0))},g=[],v=[],y="",M="",F=0,_=Math.max(i.length,a&&a.length||0);F<_;F++){i[F]&&(y=i[F][0]),"C"!=y&&(g[F]=y,F&&(M=g[F-1])),i[F]=h(i[F],n,M),"A"!=g[F]&&"C"==y&&(g[F]="C"),u(i,F),a&&(a[F]&&(y=a[F][0]),"C"!=y&&(v[F]=y,F&&(M=v[F-1])),a[F]=h(a[F],c,M),"A"!=v[F]&&"C"==y&&(v[F]="C"),u(a,F)),f(i,a,n,c,F),f(a,i,c,n,F);var T=i[F],b=a&&a[F],x=T.length,C=a&&b.length;n.x=T[x-2],n.y=T[x-1],n.bx=parseFloat(T[x-4])||n.x,n.by=parseFloat(T[x-3])||n.y,c.bx=a&&(parseFloat(b[C-4])||c.x),c.by=a&&(parseFloat(b[C-3])||c.y),c.x=a&&b[C-2],c.y=a&&b[C-1]}return a?[i,a]:i}function r(t,e,i,a,n,r){return[1/3*t+2/3*i,1/3*e+2/3*a,1/3*n+2/3*i,1/3*r+2/3*a,n,r]}function s(t,e,i,a){return[t,e,i,a,i,a]}function o(t,e,i,a,n,r,s,l,c,h){var u,p=120*y/180,f=y/180*(+n||0),m=[],v=function(t,e,i){return{x:t*g.cos(i)-e*g.sin(i),y:t*g.sin(i)+e*g.cos(i)}};if(h)X=h[0],S=h[1],E=h[2],A=h[3];else{t=(u=v(t,e,-f)).x,e=u.y,l=(u=v(l,c,-f)).x,c=u.y;var _=(g.cos(y/180*n),g.sin(y/180*n),(t-l)/2),T=(e-c)/2,b=_*_/(i*i)+T*T/(a*a);b>1&&(b=g.sqrt(b),i*=b,a*=b);var x=i*i,C=a*a,w=(r==s?-1:1)*g.sqrt(M((x*C-x*T*T-C*_*_)/(x*T*T+C*_*_))),E=w*i*T/a+(t+l)/2,A=w*-a*_/i+(e+c)/2,X=g.asin(((e-A)/a).toFixed(9)),S=g.asin(((c-A)/a).toFixed(9));X=t<E?y-X:X,S=l<E?y-S:S,X<0&&(X=2*y+X),S<0&&(S=2*y+S),s&&X>S&&(X-=2*y),!s&&S>X&&(S-=2*y)}var I=S-X;if(M(I)>p){var k=S,L=l,D=c;S=X+p*(s&&S>X?1:-1),m=o(l=E+i*g.cos(S),c=A+a*g.sin(S),i,a,n,0,s,L,D,[S,k,E,A])}I=S-X;var O=g.cos(X),P=g.sin(X),U=g.cos(S),R=g.sin(S),N=g.tan(I/4),B=4/3*i*N,G=4/3*a*N,V=[t,e],H=[t+B*P,e-G*O],$=[l+B*R,c-G*U],W=[l,c];if(H[0]=2*V[0]-H[0],H[1]=2*V[1]-H[1],h)return[H,$,W][d](m);for(var z=[],j=0,Y=(m=[H,$,W][d](m).join()[F](",")).length;j<Y;j++)z[j]=j%2?v(m[j-1],m[j],f).y:v(m[j],m[j+1],f).x;return z}function l(t){if("string"==typeof t&&(t=i(t)),!t||!t.length)return[["M",0,0]];var e=[],n=0,r=0,s=0,o=0,l=0;"M"==t[0][0]&&(n=+t[0][1],r=+t[0][2],s=n,o=r,l++,e[0]=["M",n,r]);for(var h,u,p=3===t.length&&"M"===t[0][0]&&"R"===t[1][0].toUpperCase()&&"Z"===t[2][0].toUpperCase(),m=l,g=t.length;m<g;m++){if(e.push(h=[]),(u=t[m])[0]!=f.call(u[0]))switch(h[0]=f.call(u[0]),h[0]){case"A":h[1]=u[1],h[2]=u[2],h[3]=u[3],h[4]=u[4],h[5]=u[5],h[6]=+(u[6]+n),h[7]=+(u[7]+r);break;case"V":h[1]=+u[1]+r;break;case"H":h[1]=+u[1]+n;break;case"R":for(var v=[n,r][d](u.slice(1)),y=2,M=v.length;y<M;y++)v[y]=+v[y]+n,v[++y]=+v[y]+r;e.pop(),e=e[d](c(v,p));break;case"M":s=+u[1]+n,o=+u[2]+r;default:for(y=1,M=u.length;y<M;y++)h[y]=+u[y]+(y%2?n:r)}else if("R"==u[0])v=[n,r][d](u.slice(1)),e.pop(),e=e[d](c(v,p)),h=["R"][d](u.slice(-2));else for(var F=0,_=u.length;F<_;F++)h[F]=u[F];switch(h[0]){case"Z":n=s,r=o;break;case"H":n=h[1];break;case"V":r=h[1];break;case"M":s=h[h.length-2],o=h[h.length-1];default:n=h[h.length-2],r=h[h.length-1]}}return e.toString=a,e}function c(t,e){for(var i=[],a=0,n=t.length;n-2*!e>a;a+=2){var r=[{x:+t[a-2],y:+t[a-1]},{x:+t[a],y:+t[a+1]},{x:+t[a+2],y:+t[a+3]},{x:+t[a+4],y:+t[a+5]}];e?a?n-4==a?r[3]={x:+t[0],y:+t[1]}:n-2==a&&(r[2]={x:+t[0],y:+t[1]},r[3]={x:+t[2],y:+t[3]}):r[0]={x:+t[n-2],y:+t[n-1]}:n-4==a?r[3]=r[2]:a||(r[0]={x:+t[a],y:+t[a+1]}),i.push(["C",(-r[0].x+6*r[1].x+r[2].x)/6,(-r[0].y+6*r[1].y+r[2].y)/6,(r[1].x+6*r[2].x-r[3].x)/6,(r[1].y+6*r[2].y-r[3].y)/6,r[2].x,r[2].y])}return i}var h=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,u=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,d="concat",p="apply",f=String.prototype.toUpperCase,m=Math.max,g=Math,v=g.round,y=g.PI,M=Math.abs,F="split",_=/,?([achlmqrstvxz]),?/gi,T=/-?\d*\.?\d+(?:[eE][\-+]?\d+)?/g,b=" ",x="",C=1;return window.tmp={path2vml:e,rectPath:function(t,i,a,n,r){return r?[["M",t+r,i],["l",a-2*r,0],["a",r,r,0,0,1,r,r],["l",0,n-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-a,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-n],["a",r,r,0,0,1,r,-r],["z"]]:e([["M",t,i],["l",a,0],["l",0,n],["l",-a,0],["z"]])},linePath:function(t,i,a,n){return e([["M",t,i],["L",a,n]])},circlePath:function(t,i,a){return e([["M",t,i],["m",0,-a],["a",a,a,0,1,1,0,2*a],["a",a,a,0,1,1,0,-2*a],["z"]])}},window.tmp}),define("vector/VmlRenderer",["require","./Renderer","../utils/PathUtils","../utils/BaseUtils","../utils/ColorUtils","./ElementWrapper","../dom/DomUtils"],function(t){function e(t){var e,i;return(e=t.match(/translate\(\s*([\d|.|e|-]+)(?:[,\s]*)([\d|.|e|-]*)\s*\)/i))&&e.shift(),i=t.match(/rotate\(\s*([\d|.|e|-]+[degratun]*)(?:[,\s]*)([\d|.|e|-]*)(?:[,\s]*)([\d|.|e|-]*)\s*\)/i),i=i&&i[1]||0,{translate:e,rotate:i}}function i(){h||(h=!0,o.include({imageContent:function(t){return this.style({src:t}),this},textContent:function(t){return"div"===this.type?this.node().innerHTML=t:this.node().textContent=t,this},attr:function(){return"div"===this.type?this.style.apply(this,arguments):this.renderer.attr(this,arguments),this},style:function(){var t;return 2===arguments.length?(t={},t[arguments[0]]=arguments[1]):t=arguments[0],this.renderer.style(this,t),this}}))}var a=t("./Renderer"),n=t("../utils/PathUtils"),r=t("../utils/BaseUtils"),s=t("../utils/ColorUtils"),o=t("./ElementWrapper"),l=t("../dom/DomUtils"),c="position:absolute;behavior:url(#default#VML);display:inline-block;",h=!1;return a.extend({_initContainer:function(){i();var t=this.div().style({"white-space":"nowrap",display:"inline-block"});return l.addClass(t.node(),"van-vml"),this.dom.appendChild(t.node()),this._divContainer=t,this._container=t,t},line:function(t){return this._shapeWithPath(t,"line")},rect:function(t){return this._shapeWithPath(t,"rect")},circle:function(t){return this._shapeWithPath(t,"circle")},path:function(t){return this._shapeWithPath(t,"path")},image:function(t){var e=new o(document.createElement("image"),this).setType("image");return e.attr(t),e},group:function(t){return this.div().style({"white-space":"nowrap","pointer-events":"none"}).attr(t)},colorGradient:function(t,e,i){return i=i||"linearGradient",{type:i,attrs:t,stops:e,elements:[]}},updateColorGradient:function(t,e,i){t.attrs=e,t.stops=i},_updateGradientFill:function(t,e){var i=t.node(),a=t._fill,n=e.stops,r=e.attrs;if(a){i.removeChild(a),a.on=!0,a.method="none",a.color=n[0]["stop-color"],a.color2=n[n.length-1]["stop-color"];for(var s=[],o=0,l=n.length;o<l;o++){var c=100*n[o].offset+"%";s.push(c+" "+n[o]["stop-color"])}a.type="gradient",a.angle=r.x1==r.x2?0:270,i.appendChild(a)}},textContent:function(t,e){},text:function(){return this.vtext(!1)},tspan:function(){return this.vtspan(!1)},_shapeWithPath:function(t,e){var i=new o(this.create("shape"),this).setType(e),a=i.rawElement;return a.style.cssText="position:absolute;left:0px;top:0px;width:1px;height:1px;behavior:url(#default#VML);display:inline-block;",a.coordsize="1 1",i.attr(t)},create:function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),createClip:function(t,e){if(!e||"rect"==e)return{x:t.x,y:t.y,width:t.width,height:t.height,clipped:[]}},_getClipStr:function(t,e){var i=e.y||0,a=e.x||0,n=a+e.width,r=i+e.height;if("div"!=t.type){var s=t.isLineChart?t.node().parentNode.firstChild:t.node();i-=s.offsetTop,r-=s.offsetTop}return"rect("+i+"px "+n+"px "+r+"px "+a+"px)"},clip:function(t,e){if(e){var i;t.node&&(i=t.node())&&(i.style.clip=this._getClipStr(t,e),e.clipped.push(t))}},updateClip:function(t,e){var i=this;t&&(r.extend(t,e),t.clipped.forEach(function(e){var a=e.node();a&&(a.style.clip=i._getClipStr(e,t))}))},imagePattern:function(t,e){},createDropShadowFilter:function(){return{}},createInnerShadowFilter:function(){return{}},attr:function(t,arguments){if(arguments&&!(arguments.length<=0)&&arguments[0]){var i={},a=t.rawElement;2===arguments.length?i[arguments[0]]=arguments[1]:i=arguments[0];var s=t.attrs,o=t.type;if(i=s?r.extend(s,i):r.extend({},i),t.attrs=i,i.transform){var l=e(i.transform);try{l.translate&&(a.style.left=l.translate[0]+"px",a.style.top=l.translate[1]+"px")}catch(t){}l.rotate}if("image"==o)a.style.position="absolute",a.style.left=i.x+"px",a.style.top=i.y+"px",a.style.width=i.width+"px",a.style.height=i.height+"px";else if("group"!=o){var c="";"rect"==o?c=n.rectPath(i.x||0,i.y||0,i.width,i.height):"line"==o?c=n.linePath(i.x1,i.y1,i.x2,i.y2):"path"==o?c=n.path2vml(i.d):"circle"==o&&(c=n.circlePath(i.cx||0,i.cy||0,i.r)),a.path=c}}},style:function(t,i){var a,n=t.styles,o={},l=t.rawElement;if(i&&i.color&&(i.fill=i.color),i&&i.fill&&"div"===t.type&&(i.color=i.fill),n)for(a in i)i[a]!==n[a]&&(o[a]=i[a]);if("div"===t.type){if(o.transform){var h=e(o.transform.replace(/px/gi,""));h.translate&&(o.transform="",o.x=h.translate[0],o.y=h.translate[1])}var u={x:"left",y:"top",dx:"margin-left"};for(var d in u){var p;null!=(p=o[d])&&(o[u[d]]=/em/gi.test(p)?p:p+"px",delete o[d])}}if(n&&(i=r.extend(n,o)),t.styles=i,"div"===t.type){var f=1;if(/rgba/i.test(i.color)){var m=s.colorToHexAlpha(i.color);i.color=m.hex,f=m.alpha}r.hasDefined(i["fill-opacity"])&&(f*=i["fill-opacity"]),f<1&&(i.filter="progid:DXImageTransform.Microsoft.Alpha(Opacity="+100*f+")");var g="";for(a in i)g+=a.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()})+":"+i[a]+";";l.style.cssText=g}else if("group"!=t.type)if("image"==t.type)t.node().src=i.src;else{var v=t._stroke,y=t._fill,M=t.node();M.stroked=!0,M.filled=!!(i.fill&&"none"!=i.fill||"image"==t.type),v||(v=t._stroke=this.create("stroke"),v.style.cssText=c),M.appendChild(v),v.weight=(i["stroke-width"]||0)+"px";var F=i.stroke,_=r.hasDefined(i["stroke-opacity"])?i["stroke-opacity"]:1;if(F&&-1!=F.indexOf("rgba")&&(F=s.colorToHexAlpha(F),_*=F.alpha,F=F.hex),v.color=F,v.opacity=i["stroke-width"]?_:0,i["stroke-dasharray"]?v.dashStyle=i["stroke-dasharray"].replace(/( *, *)/g," "):v.dashStyle="","round"==i["stroke-linecap"]&&(v.endcap="round"),M.filled){y||(y=t._fill=this.create("fill"),y.style.cssText=c),M.appendChild(y);var T=i.fill,b=r.hasDefined(i["fill-opacity"])?i["fill-opacity"]:1;-1!=T.indexOf("rgba")&&(T=s.colorToHexAlpha(T),b*=T.alpha,T=T.hex),y.color=T,y.opacity=b}else y&&(M.removeChild(y),t._fill=null)}"display"in i&&(t.node().style.display=i.display),"cursor"in i&&(t.node().style.cursor=i.cursor)},vRotate:function(t,e){e%=360;var i=t.node();r.domRotate(i,0);var a=i.offsetWidth,n=i.offsetHeight;r.domRotate(i,e);var s=i.offsetWidth,o=i.offsetHeight;i.style.marginLeft=(a-s)/2+"px",i.style.marginTop=(n-o)/2+"px"},vMiddle:function(t){var e=t.node(),i=e.offsetWidth;e.style.marginLeft=-i/2+"px"}})}),define("chart/map/LatLng",["require","../../utils/BaseUtils"],function(t){var e=t("../../utils/BaseUtils"),i=function(t,e,i){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==i&&(this.alt=+i)};return i.prototype={equals:function(t,e){return!!t&&(t=i.create(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+e.formatNum(this.lat,t)+", "+e.formatNum(this.lng,t)+")"},distanceTo:function(t){return L.CRS.Earth.distance(this,i.create(t))},wrap:function(){return L.CRS.Earth.wrapLatLng(this)},clone:function(){return new i(this.lat,this.lng,this.alt)}},i.create=function(t,a,n){return t instanceof i?t:e.isArray(t)&&"object"!=typeof t[0]?3===t.length?new i(t[0],t[1],t[2]):2===t.length?new i(t[0],t[1]):null:void 0===t||null===t?t:"object"==typeof t&&"lat"in t?new i(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===a?null:new i(t,a,n)},i}),define("chart/map/Projection",["require","../../utils/Point2D","../../utils/Bounds","./LatLng"],function(t){var e=t("../../utils/Point2D"),i=t("../../utils/Bounds"),a=t("./LatLng"),n={};return n.LonLat={project:function(t){return new e(t.lng,t.lat)},unproject:function(t){return new a(t.y,t.x)},bounds:i.create([-180,-90],[180,90])},n.SphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var i=Math.PI/180,a=this.MAX_LATITUDE,n=Math.max(Math.min(a,t.lat),-a),r=Math.sin(n*i);return new e(this.R*t.lng*i,this.R*Math.log((1+r)/(1-r))/2)},unproject:function(t){var e=180/Math.PI;return new a((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=6378137*Math.PI;return i.create([-t,-t],[t,t])}()},n.Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:i.create([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var i=Math.PI/180,a=this.R,n=t.lat*i,r=this.R_MINOR/a,s=Math.sqrt(1-r*r),o=s*Math.sin(n),l=Math.tan(Math.PI/4-n/2)/Math.pow((1-o)/(1+o),s/2);return n=-a*Math.log(Math.max(l,1e-10)),new e(t.lng*i*a,n)},unproject:function(t){for(var e,i=180/Math.PI,n=this.R,r=this.R_MINOR/n,s=Math.sqrt(1-r*r),o=Math.exp(-t.y/n),l=Math.PI/2-2*Math.atan(o),c=0,h=.1;c<15&&Math.abs(h)>1e-7;c++)e=s*Math.sin(l),e=Math.pow((1-e)/(1+e),s/2),h=Math.PI/2-2*Math.atan(o*e)-l,l+=h;return new a(l*i,t.x*i/n)}},n}),define("chart/map/Transformation",["require","../../utils/Point2D"],function(t){var e=t("../../utils/Point2D"),i=function(t,e,i,a){this._a=t,this._b=e,this._c=i,this._d=a};return i.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,i){return i=i||1,new e((t.x/i-this._b)/this._a,(t.y/i-this._d)/this._c)}},i}),define("chart/map/CRS",["require","../../utils/Bounds","./LatLng","../../utils/BaseUtils","./Projection","./Transformation"],function(t){var e=t("../../utils/Bounds"),i=(t("./LatLng"),t("../../utils/BaseUtils")),a=t("./Projection"),n=t("./Transformation"),r={latLngToPoint:function(t,e){var i=this.projection.project(t),a=this.scale(e);return this.transformation._transform(i,a)},pointToLatLng:function(t,e){var i=this.scale(e),a=this.transformation.untransform(t,i);return this.projection.unproject(a)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var i=this.projection.bounds,a=this.scale(t),n=this.transformation.transform(i.min,a),r=this.transformation.transform(i.max,a);return e.create(n,r)},infinite:!1,wrapLatLng:function(t){var a=this.wrapLng?i.wrapNum(t.lng,this.wrapLng,!0):t.lng,n=this.wrapLat?i.wrapNum(t.lat,this.wrapLat,!0):t.lat,r=t.alt;return e.create(n,a,r)}};return r.Simple=i.extend({},r,{projection:a.LonLat,transformation:new n(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,a=e.lat-t.lat;return Math.sqrt(i*i+a*a)},infinite:!0}),r.Earth=i.extend({},r,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,a=t.lat*i,n=e.lat*i,r=Math.sin(a)*Math.sin(n)+Math.cos(a)*Math.cos(n)*Math.cos((e.lng-t.lng)*i);return this.R*Math.acos(Math.min(r,1))}}),r.EPSG3857=i.extend({},r.Earth,{code:"EPSG:3857",projection:a.SphericalMercator,transformation:function(){var t=.5/(Math.PI*a.SphericalMercator.R);return new n(t,.5,-t,.5)}()}),r.EPSG900913=i.extend({},r.EPSG3857,{code:"EPSG:900913"}),r.EPSG4326=i.extend({},r.Earth,{code:"EPSG:4326",projection:a.LonLat,transformation:new n(1/180,1,-1/180,.5)}),r.EPSG3395=i.extend({},r.Earth,{code:"EPSG:3395",projection:a.Mercator,transformation:function(){var t=.5/(Math.PI*a.Mercator.R);return new n(t,.5,-t,.5)}()}),r}),define("theme/config",["require","../Constants","../utils/QueryUtils","../utils/BaseUtils","../chart/map/CRS","../dom/Browser"],function(t){function e(){return{formatter:{identifier:"${CATEGORY}${SERIES}${VALUE}"},enabled:!0,animation:!0,follow:!1,backgroundColor:"rgba(0,0,0,0.5)",borderColor:null,borderWidth:0,borderRadius:2,shadow:!0,hideDelay:500,shared:!1,padding:5}}function i(){return g.merge(e(),{formatter:{enabled:!1}},!0)}function a(){return g.merge(e(),{formatter:{identifier:"${SERIES}${X}${Y}${SIZE}"}},!0)}function n(){return g.merge(e(),{formatter:{identifier:"${SERIES}${VALUE}"}},!0)}function r(){return g.merge(e(),{formatter:{identifier:"${NAME}${SERIES}${VALUE}",shared:!0}},!0)}function s(){return g.merge(e(),{formatter:{identifier:"${NAME}${SERIES}${VALUE}${SIZE}",shared:!0}},!0)}function o(){return{visible:!0,enabled:!0,borderColor:"#cccccc",borderWidth:0,hiddenColor:"#cccccc",hoverColor:"#293C55",style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,x:0,y:0,layout:"vertical",continuous:!0,margin:10}}function l(){return g.merge(o(),{enabled:!1},!0)}function c(){return{type:"category",position:"bottom",onZero:!1,reversed:!1,title:{text:null,align:"center",rotation:0,useHtml:!1,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"}},lineWidth:1,lineColor:"#cccccc",showArrow:!1,enableTick:!0,enableMinorTick:!1,minorTickColor:"#cccccc",minorTickWidth:1,minorTickLength:2,tickColor:"#cccccc",tickWidth:1,tickLength:4,tickPadding:6,gridLineWidth:0,gridLineColor:"#dddddd",showLabel:!0,labelStyle:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},labelRotation:0,useHtml:!1}}function h(){return{type:"value",position:"left",onZero:!1,reversed:!1,title:{text:null,align:"center",rotation:0,useHtml:!1,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"}},lineWidth:0,lineColor:"#cccccc",showArrow:!1,enableTick:!1,enableMinorTick:!1,minorTickColor:"#cccccc",minorTickWidth:1,minorTickLength:2,tickColor:"#cccccc",tickWidth:1,tickLength:4,tickPadding:6,gridLineWidth:1,gridLineColor:"#dddddd",showLabel:!0,labelStyle:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},labelRotation:0,useHtml:!1}}function u(){return g.merge(c(),{type:"value"},!0)}function d(){return g.merge(h(),{type:"category"},!0)}function p(){return{type:"category",lineWidth:1,lineColor:"#cccccc",gridLineWidth:1,gridLineColor:"#dddddd",showLabel:!0,labelStyle:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},labelRotation:0,useHtml:!1}}function f(){return g.merge(p(),{type:"value"},!0)}var m=t("../Constants"),g=t("../utils/QueryUtils"),v=(t("../utils/BaseUtils"),t("../chart/map/CRS")),y=t("../dom/Browser"),M=["#63b2ee","#76da91","#f8cb7f","#f89588","#7cd6cf","#9192ab","#7898e1","#efa666","#eddd86","#9987ce"],F={crs:v.EPSG3857,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:.5,zoomDelta:.5,trackResize:!0,dragging:!0,inertia:!y.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0,scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60},_="gradual";return function(){var t={pie:{plotOptions:{rotatable:!0,startAngle:0,endAngle:360,borderWidth:1,borderColor:"white",dataLabels:{formatter:{identifier:"${Y}"},enabled:!1,align:"inside"},tooltip:n()},options:{colors:M,style:_,legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10}}},multiPie:{plotOptions:{borderWidth:1,borderColor:"rgb(255,255,255)",rotatable:!0,gradual:"lighter",innerRadius:0,startAngle:0,endAngle:360,drilldown:!0,tooltip:r(),dataLabels:{formatter:{identifier:"${NAME}"},enabled:!1,align:"inside"}},options:{colors:M,legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10}}},treeMap:{plotOptions:{borderWidth:1,borderColor:"rgb(255,255,255)",zoom:!0,tooltip:r(),dataLabels:{formatter:{identifier:"${NAME}"},enabled:!1,align:"top"}},options:{colors:M,legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10}}},bar:{plotOptions:{categoryGap:"20%",gap:"20%",borderRadius:0,borderWidth:1,borderColor:"white",dataLabels:{formatter:{identifier:"${Y}"},enabled:!1,align:"inside"},tooltip:e()},options:{colors:M,style:_,zoom:{zoomType:"xy",zoomTool:{enabled:!1,resize:!0}},legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},xAxis:[u()],yAxis:[d()]}},column:{plotOptions:{categoryGap:"20%",gap:"20%",borderRadius:0,borderWidth:1,borderColor:"white",dataLabels:{formatter:{identifier:"${Y}"},enabled:!1,align:"inside"},tooltip:e()},options:{colors:M,style:_,zoom:{zoomType:"xy",zoomTool:{enabled:!1,resize:!0}},legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},xAxis:[c()],yAxis:[h()]}},line:{plotOptions:{large:!1,connectNulls:!1,lineWidth:2,step:!1,curve:!1,marker:{radius:4.5},dataLabels:{formatter:{identifier:"${Y}"},enabled:!1,align:"outside"},tooltip:e()},options:{colors:M,zoom:{zoomType:"xy",zoomTool:{enabled:!1,resize:!0}},legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},xAxis:[c()],yAxis:[h()]}},area:{plotOptions:{large:!1,connectNulls:!1,lineWidth:2,step:!1,curve:!1,marker:{radius:4.5},dataLabels:{formatter:{identifier:"${Y}"},enabled:!1,align:"outside"},tooltip:e(),fillColor:!0,fillColorOpacity:.15},options:{colors:M,zoom:{zoomType:"xy",zoomTool:{enabled:!1,resize:!0}},legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},xAxis:[c()],yAxis:[h()]}},gauge:{thermometer:{layout:"horizontal",tooltip:i(),percentageLabel:{enabled:!1,useHtml:!1,align:"left",style:{color:"#333333",fontSize:"0.75rem",fontFamily:"Verdana",fontWeight:"bold"},formatter:{identifier:"${PERCENT}"}},valueLabel:{enabled:!1,useHtml:!1,align:"left",style:{color:"#bababa",fontSize:"0.75rem",fontFamily:"Verdana"},formatter:{identifier:"${CATEGORY}${VALUE}"}},needle:"#ffffff",slotBackgroundColor:"#eeeeee",thermometerLayout:"vertical"},ring:{layout:"horizontal",tooltip:i(),percentageLabel:{enabled:!1,useHtml:!1,style:{fontSize:"1.5rem",fontFamily:"Verdana",fontWeight:"bold"},formatter:{identifier:"${PERCENT}"}},valueLabel:{enabled:!1,useHtml:!1,style:{color:"#777777",fontSize:"0.75rem",fontFamily:"Verdana"},formatter:{identifier:"${CATEGORY}${VALUE}"}},clockwise:!1,paneBackgroundColor:"#eeeeee",innerPaneBackgroundColor:"#f4f4f4"},pointer:{layout:"horizontal",tooltip:i(),seriesLabel:{enabled:!1,align:m.BOTTOM,useHtml:!1,style:{color:"#333333",fontSize:"0.875rem",fontFamily:"Verdana"},formatter:{identifier:"${CATEGORY}"}},valueLabel:{enabled:!1,useHtml:!1,backgroundColor:"#F5F5F7",style:{color:"#333333",fontSize:"0.6875rem",fontFamily:"Verdana"},formatter:{identifier:"${SERIES}${VALUE}"}},needle:"#E5715A",hinge:"#656B6D",hingeBackgroundColor:"#DCF2F9",paneBackgroundColor:"#FCFCFC"},slot:{layout:"horizontal",tooltip:i(),percentageLabel:{enabled:!1,useHtml:!1,style:{fontSize:"2.25rem",fontFamily:"Verdana",fontWeight:"bold",textShadow:"0px 2px 0px rgba(0,0,0,0.08)"},formatter:{identifier:"${PERCENT}"}},valueLabel:{enabled:!1,useHtml:!1,style:{color:"#666666",fontSize:"0.875rem",fontFamily:"Verdana"},formatter:{identifier:"${CATEGORY}${VALUE}"}},needle:"#ffffff",slotBackgroundColor:"#eeeeee"},options:{colors:M,legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},gaugeAxis:[{type:"value",showLabel:!0,step:1,enableTick:!0,tickColor:"#BBBBBB",tickWidth:1,enableMinorTick:!0,minorTickColor:"#e2e2e2",minorTickWidth:1,labelStyle:{color:"#666666",fontFamily:"Verdana",fontSize:"0.625rem"}}]}},radar:{plotOptions:{fillColorOpacity:.15,columnType:!1,marker:{radius:4.5},lineWidth:2,shape:"circle",dataLabels:{formatter:{identifier:"${Y}"},enabled:!1,align:"outside"},tooltip:e()},options:{colors:M,polar:{},legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},angleAxis:[p()],radiusAxis:[f()]}},scatter:{plotOptions:{large:!1,lineWidth:0,curve:!1,marker:{radius:4.5},opacity:1,tooltip:a(),dataLabels:{formatter:{identifier:"${X}${Y}${SIZE}"},enabled:!1,align:"outside"}},options:{colors:M,zoom:{zoomType:"xy",zoomTool:{enabled:!1,resize:!0}},legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},rangeLegend:l(),xAxis:[u()],yAxis:[h()]}},bubble:{plotOptions:{large:!1,displayNegative:!0,shadow:!0,minSize:12,maxSize:60,sizeBy:"area",opacity:.7,tooltip:a(),dataLabels:{formatter:{identifier:"${X}${Y}${SIZE}"},enabled:!1,align:"inside"}},options:{colors:M,zoom:{zoomType:"xy",zoomTool:{enabled:!1,resize:!0}},rangeLegend:l(),legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},xAxis:[u()],yAxis:[h()]}},funnel:{plotOptions:{borderColor:"rgb(255,255,255)",borderWidth:1,sort:!0,useSameSlantAngle:!0,dataLabels:{formatter:{identifier:"${VALUE}"},enabled:!1,connectorWidth:1,align:"outside"}},options:{colors:M,legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},style:_}},wordCloud:{plotOptions:{fontFamily:"Microsoft YaHei",maxRotation:0,minRotation:0,tooltip:r(),dataLabels:{enabled:!1}},options:{colors:M,legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},style:_,rangeLegend:l()}},structure:{plotOptions:{layout:"vertical",force:!0,lineColor:"rgb(156,156,156)",lineOpacity:1,borderWidth:1,borderOpacity:1,fillColorOpacity:1,tooltip:r(),dataLabels:{enabled:!1}},options:{colors:M,legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},style:_,rangeLegend:l()}},forceBubble:{plotOptions:{large:!1,displayNegative:!0,shadow:!0,minSize:12,maxSize:60,sizeBy:"area",opacity:1,tooltip:e(),dataLabels:{formatter:{identifier:"{SERIES}"},enabled:!1,align:"inside"}},options:{colors:M,legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},zoom:{zoomType:"xy",zoomTool:{enabled:!1,resize:!0}},rangeLegend:l()}},areaMap:{plotOptions:{nullColor:"#cccccc",opacity:.75,borderColor:"#ffffff",borderWidth:1,borderOpacity:1,tooltip:s(),dataLabels:{formatter:{identifier:"${NAME}"},enabled:!1,align:"inside"}},options:{geo:{zoom:!0},colors:M,title:{align:"center",backgroundColor:null,borderRadius:0,floating:!1,x:0,y:0,text:null,style:{color:"#333333",fontSize:"1.375rem",fontFamily:"Verdana"},useHtml:!1},rangeLegend:o(),legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},dTools:{style:{fontFamily:"Microsoft Yahei",color:"#b2b2b2",fontSize:"0.75rem",fontWeight:""},currentColor:"#62b2ef",backgroundColor:"white",enabled:!1}}},pointMap:{plotOptions:{opacity:1,icon:{iconUrl:"../../doc/example/marker-icon.png",iconSize:[25,41]},dataLabels:{formatter:{identifier:"${NAME}"},enabled:!1,align:"outside"},tooltip:s()},options:{geo:{zoom:!0},colors:M,title:{align:"center",backgroundColor:null,borderRadius:0,floating:!1,x:0,y:0,text:null,style:{color:"#333333",fontSize:"1.375rem",fontFamily:"Verdana"},useHtml:!1},rangeLegend:o(),legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10},dTools:{style:{fontFamily:"Microsoft Yahei",color:"#b2b2b2",fontSize:"0.75rem",fontWeight:""},currentColor:"#62b2ef",backgroundColor:"white",enabled:!1}}},heatMap:{plotOptions:{maxOpacity:1,minOpacity:0,radius:15,blur:.15},options:{geo:{zoom:!0},colors:M,title:{align:"center",backgroundColor:null,borderRadius:0,floating:!1,x:0,y:0,text:null,style:{color:"#333333",fontSize:"1.375rem",fontFamily:"Verdana"},useHtml:!1},rangeLegend:o(),legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10}}},lineMap:{plotOptions:{lineWidth:.5,curveness:.3,mouseOverColor:"rgb(253,221,49)",opacity:1},options:{geo:{zoom:!0},colors:M,title:{align:"center",backgroundColor:null,borderRadius:0,floating:!1,x:0,y:0,text:null,style:{color:"#333333",fontSize:"1.375rem",fontFamily:"Verdana"},useHtml:!1},rangeLegend:o(),legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10}}},gantt:{plotOptions:{newLine:!0,borderWidth:1,borderColor:"white",dataLabels:{formatter:{identifier:"${DURATION}${PROGRESS}"},enabled:!1},tooltip:e()},options:{processes:{resize:!0},levelBar:{enabled:!0},timeAxis:{zoom:!0,showWeekends:!0},colors:M,legend:{visible:!0,enabled:!1,hiddenColor:"#cccccc",hoverColor:"#293C55",borderRadius:0,borderColor:"#cccccc",borderWidth:0,backgroundColor:null,style:{color:"#666666",fontFamily:"Verdana",fontSize:"0.875rem"},position:"right",floating:!1,layout:"vertical",x:0,y:0,shadow:!1,margin:10}}}};return t.MAP_CONFIG=F,t}}),define("vans/VanChartLibrary",["require","../Constants"],function(t){var e=t("../Constants"),i={};return{get:function(t){return i[t]||i[e.VANCHART]},register:function(t,e){i[t]=e}}}),define("vans/VanChart",["require","./../utils/BaseUtils","./../utils/QueryUtils","../dom/Evented","./VanChartLayout","./../ComponentLibrary","./../ChartLibrary","./../Constants","./../HammerHandler","./../vector/SvgRenderer","./../vector/VmlRenderer","../utils/Point2D","./../theme/config","./VanChartLibrary"],function(t){var e=t("./../utils/BaseUtils"),i=t("./../utils/QueryUtils"),a=t("../dom/Evented"),n=t("./VanChartLayout"),r=t("./../ComponentLibrary"),s=t("./../ChartLibrary"),o=t("./../Constants"),l=t("./../HammerHandler"),c=t("./../vector/SvgRenderer"),h=t("./../vector/VmlRenderer"),u=t("../utils/Point2D"),d=[r.X_AXIS_COMPONENT,r.Y_AXIS_COMPONENT,r.ANGLE_AXIS_COMPONENT],p=a.extend({vanChartType:"vanChart",initialize:function(t,i,a){this.wrapDom=i,this.width=e.getDomWidth(i),this.height=e.getDomHeight(i),this.vancharts=a,this.series=[],this.components={},this._targets={},this.animationCount=0,this._changeDataState=!1,this.fullScreenChart=null,this.setOptions(t),this.handler=new l(this,i),this._initDomLayout(this.wrapDom),this.update()},setOptions:function(t){t.series=t.series||[],t.series.forEach(function(t){t.data=t.data||[]}),this._mergeThemeConfig(t),t.plotOptions.inverted&&t.dataSheet&&(t.dataSheet.enabled=!1),this.options=t,this.fullScreenChart&&this.fullScreenChart.setData(t)},_initDomLayout:function(t){this.dom=t,this.renderer=e.isSupportSVG()?new c(t,this):new h(t,this),this.renderer.onAdd(),this.on({animationStart:this._animationStart,animationEnd:this._animationEnd})},_animationStart:function(){this._animationStarted=!0,this.animationCount=0,this.series.forEach(function(t){t._removeDataLabels(),t.render()}),this.animationCount||this.fire("animationEnd")},_animationEnd:function(){this.renderer&&(this._animationStarted=!1,this.series.forEach(function(t){t._animateEnd()}))},_removeChangeDataState:function(t){this._changeDataState&&(this._changeDataSeries=this._changeDataSeries||[],this._changeDataSeries.push(t),this._changeDataSeries.length>=this.series.length&&(this._changeDataState=!1,this._changeDataSeries=[]))},_needShowMoreLabel:function(){return this._changeDataState&&e.hasDefined(this.options.moreLabel)&&!this.isLargeMode()},_clearMoreLabels:function(){this.series.forEach(function(t){t._clearMoreLabels()})},_initIntermediateState:function(){this.colorMap={},this.orderMap={},this.cateMap={},this.scale=1,this.timeQueue=this.clearTimeQueue(),this.clipPool={},this.axisSize={left:0,right:0,bottom:0,top:0},this.layerMap=this.layerIndex=null},refresh:function(t){this.setOptions(t),this.update()},refreshRestore:function(){var t=this,e=t.components;d.forEach(function(i){e[i]&&t._restoreCategoryAxisBasedSeries(e[i])}),this.seriesOfType(o.GAUGE_CHART).length==this.series.length&&this.series.sort(function(t,e){return t.index-e.index}),this.seriesOfType(o.PIE_CHART).forEach(function(t){var e=t.points.map(function(t){return t.graphic}),i={};t.options.data.forEach(function(t,e){i[t.x]=e}),t.points.sort(function(t,e){return i[t.x]-i[e.x]}),t.points.forEach(function(t,i){t.graphic=e[i]})});var i=this.seriesOfType(o.MULTIPIE_CHART);i.length&&i[0].orderData(null),this.update()},orderData:function(){var t=this,e=t.components;d.forEach(function(i){e[i]&&t._orderCategoryAxisBasedSeries(e[i])});var i=this.orderType==o.ASCENDING,a=i?1:-1;this.seriesOfType(o.GAUGE_CHART).length==this.series.length&&this.series.sort(function(t,e){return(t.getSeryTotalValue()-e.getSeryTotalValue())*a}),this.seriesOfType(o.PIE_CHART).forEach(function(t){var e=t.points.filter(function(t){return t.visible}).map(function(t){return t.graphic});t.points.sort(function(t,e){return i?t.y-e.y:e.y-t.y});var a=0;t.points.forEach(function(t){t.visible&&(t.graphic=e[a],++a)})});var n=this.seriesOfType(o.MULTIPIE_CHART);n&&n.length&&n[0].orderData(i),this.reRenderSeries(),d.concat([r.ZOOM_COMPONENT,r.DATA_SHEET_COMPONENT,r.POLAR_COMPONENT]).forEach(function(t){e[t]&&e[t].render()})},_restoreCategoryAxisBasedSeries:function(t){for(var i=0,a=t.getAxisCount();i<a;i++){var n=t.getAxis(i),r=n.series;if(n._isBaseAxis()&&n.isCategory()&&this.orderMap&&Object.keys(this.orderMap).length){var s={};this.orderMap[n.componentType][i].forEach(function(t,e){s[t]=e});for(var o=n._dataDomain,l=0,c=r.length;l<c;l++){var h=[],u=r[l],d=!0;u.points.forEach(function(t){h[e.indexOf(o,t.category)]=t.graphic,t.graphic||(d=!1)}),u.points.forEach(function(t){t.graphic=d?h[s[t.category]]:t.graphic,u.updatePointGraphic(t)})}}}},_orderCategoryAxisBasedSeries:function(t){for(var i=this.orderType==o.ASCENDING?1:-1,a=0,n=t.getAxisCount();a<n;a++){var r=t.getAxis(a);if(this.orderMap[r.componentType]=this.orderMap[r.componentType]||[],this.orderMap[r.componentType][a]||(this.orderMap[r.componentType][a]=r._dataDomain),r._isBaseAxis()&&r.isCategory()){for(var s=r.series,l=[],c=s[0].points,h=0,u=c.length;h<u;h++){var d=c[h],p=0;d.points.forEach(function(t){t.visible&&t.series.visible&&(p+=Math.abs(t.getTargetValue()))}),l.push({key:d.category,value:p})}l.sort(function(t,e){return(t.value-e.value)*i});var f={},m=[];l.forEach(function(t,e){f[t.key]=e,m.push(t.key)});for(var g=r.getOriginalCategories(),h=0,u=s.length;h<u;h++){var v=[],y=s[h],M=!0;y.points.forEach(function(t){v[e.indexOf(g,t.category)]=t.graphic,t.graphic||(M=!1)}),y.points.forEach(function(t){t.graphic=M?v[f[t.category]]:t.graphic,y.updatePointGraphic(t)})}r.setCategories(m)}}},update:function(){this.series=this.layerMap&&this.layerMap.length?this.layerMap[0].series:this.series,this._initIntermediateState();for(var t,i,a=this.options,n=this,l=a.series,c=a.chartType,h=r.getRegisteredComponents(),u=r.ComponentsOrder,d=0,p=u.length;d<p;d++){if(t=u[d],i=h[t],t==r.RANGE_LEGEND_COMPONENT&&a[t]){var f=a[t].continuous?r.GradientRangeLegend:r.INTERVAL_RANGE_LEGEND;this.components[t]&&this.components[t].type!=f&&(this.components[t].remove(),this.components[t]=null),i=r.get(f)}if(i){var m=a[t]&&(e.hasNotDefined(a[t].enabled)||a[t].enabled);m||t!=r.TOOLBAR_COMPONENT||(m=!0,a[t]={enabled:!0,hidden:!1}),a[t]&&m?this.components[t]?this.components[t].refresh(a[t],n):this.components[t]=new i(a[t],t,n):this.components[t]&&(this.components[t].remove(),this.components[t]=null,delete this.components[t])}}var g,v={},y=[];n.series.forEach(function(t){(g=t.type)==o.GAUGE_CHART&&(g+=t.gaugeType+(t.options.thermometerLayout||"")),g==o.RADAR_CHART&&(g=t.columnType?o.COLUMN_RADAR:o.LINE_RADAR),v[t.name+g]=t}),l.forEach(function(t,i){g=t.type||c;var r=e.pick(t.name,"Series"+i),l=s.get(g),h=r+g;if(g==o.GAUGE_CHART){var u=t.style||a.plotOptions.style,d=t.thermometerLayout||a.plotOptions.thermometerLayout||"";l=s.get(u),h=r+g+u+d}else if(g==o.RADAR_CHART){var p=t.columnType||a.plotOptions.columnType;p=p?o.COLUMN_RADAR:o.LINE_RADAR,l=s.get(p),h=r+p}var f=v[h];f=f?f.refresh(t,i):new l(t,n,i),y.push(f),v[h]=null});for(var M in v)v[M]&&v[M].remove();n.series=y;var F=this.components[r.GAUGE_AXIS_COMPONENT];F&&F.initAttributesWithSeries();var _=this.components[r.RANGE_LEGEND_COMPONENT];_&&_.initAttributesWithSeries(),y.forEach(function(t){if(t.type!==o.LINE_MAP||!t.options.large)for(var e=0,i=t.points.length;e<i;e++)t.points[e].refreshPointColor()}),n.layoutComponentsAndCharts()},layoutComponentsAndCharts:function(){this.hoverPoint=this.hoverSeries=null,n.PLANE_SYSTEM_LAYOUT(this),this.render()},_getDefaultBounds:function(){var t=this.options&&this.options.padding||5;return t=(this.options&&this.options.borderWidth||0)+t,e.makeBounds(t,t,Math.max(this.width-2*t,0),Math.max(this.height-2*t,0))},reRenderWholePlot:function(){n.reLayoutPlotBounds(this),n.calculateSeries(this),n.calculateSeriesShapes(this),this.render()},dealAxisZoom:function(t,e){var i=this.options.zoom.zoomType,a=this.components.xAxis,n=this.components.yAxis;a&&-1!==i.indexOf("x")&&a.axisZoom(t,e),n&&-1!==i.indexOf("y")&&n.axisZoom(t,e),this.reRenderWholePlot()},clearAllEffects:function(){this.series.forEach(function(t){t.points.forEach(function(t){t.clearPointEffect()})})},_calculateZoomParas:function(t,e){var i=this.bounds,a=Math.min(t.x,e.x)-i.x,n=Math.min(t.y,e.y)-i.y,r=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y),o=Math.min(i.width/r,i.height/s),l=i.width/o,c=i.height/o;return{shiftX:(i.width-l)/2-a,shiftY:(i.height-c)/2-n,scale:o}},_mergeThemeConfig:function(a){var n=t("./../theme/config")(),r={};a.series.forEach(function(t){var s=t.type||a.chartType,l=n[s].plotOptions;if(s==o.GAUGE_CHART){var c=t.style||a.plotOptions.gauge&&a.plotOptions.gauge.style||a.plotOptions.style;c="pointer_semi"==c?"pointer":c,l=n.gauge[c],["seriesLabel","valueLabel","percentageLabel"].forEach(function(a){e.hasDefined(t[a])&&i.merge(t[a],l[a],!1)})}r[s]||(r[s]=!0,i.merge(a,n[s].options,!1),a.plotOptions[s]?a.plotOptions[s]=i.merge(a.plotOptions[s],l,!1):a.plotOptions=i.merge(a.plotOptions,l,!1))}),this.isMap()&&(a.xAxis=a.yAxis=a.zoom=void 0,e.extend(a,n.MAP_CONFIG)),a.chartType==o.RADAR_CHART&&(a.polar=a.polar||{}),a.tooltip=a.tooltip||{}},getChartMinMaxValue:function(){var t=Number.MAX_VALUE,e=-t;return this.series.forEach(function(i){i.points.filter(function(t){return!t.isNull&&!isNaN(t.getTargetValue())}).forEach(function(i){var a=i.getTargetValue();e=Math.max(e,a),t=Math.min(t,a)})}),t>e&&(t=0,e=100),[t,e]},getParentDom:function(){return this.dom},getDivParentDom:function(){return this.wrapDom},isInverted:function(){return!!this.options.plotOptions.inverted},setPlotBounds:function(t){this.bounds=t},getPlotClipBounds:function(){var t=0,e=0,i=this.bounds.width,a=this.bounds.height,n={},r=[];return this.components.xAxis&&(r=r.concat(this.components.xAxis._axisList)),this.components.yAxis&&(r=r.concat(this.components.yAxis._axisList)),r.forEach(function(t){var e=t.getPosition();t.isOnZero()||n[e]||(n[e]=t.getLineWidth())}),e=n[o.TOP]?Math.ceil(n[o.TOP]/2):0,a-=e,a=n[o.BOTTOM]?a-Math.ceil(n[o.BOTTOM]/2-.5):a,t=n[o.LEFT]?Math.ceil(n[o.LEFT]/2):0,i-=t,i=n[o.RIGHT]?i-Math.ceil(n[o.RIGHT]/2):i,{x:t+this.bounds.x,y:e+this.bounds.y,width:Math.max(i+1,0),height:Math.max(a+1,0)}},getChartBounds:function(){return e.makeBounds(0,0,this.width,this.height)},xAxis:function(t){t||(t=0);var e=this.components.xAxis;return e?e.getAxis(t):null},yAxis:function(t){t||(t=0);var e=this.components.yAxis;return e?e.getAxis(t):null},polar:function(t){t||(t=0);var e=this.components.polar;return e?e.getAxis(t):null},angleAxis:function(t){t||(t=0);var e=this.components.angleAxis;return e?e.getAxis(t):null},radiusAxis:function(t){t||(t=0);var e=this.components.radiusAxis;return e?e.getAxis(t):null},gaugeAxis:function(t){t||(t=0);var e=this.components.gaugeAxis;return e?e.getAxis(t):null},getSharedAxis:function(){for(var t=[this.xAxis(),this.yAxis(),this.angleAxis()],e=0;e<t.length;e++){var i=t[e];if(i&&i.isCategory())return i}return null},getComponent:function(t){return this.components[t]},setComponent:function(t,e){this.components[e]=t},getDefaultSeriesColor:function(t){if(t+="",!this.colorMap[t]){var e=this.options.colors,i=0;for(var a in this.colorMap)++i;this.colorMap[t]=e[i%e.length]}return this.colorMap[t]},registerPointsPara:function(t){if(e.hasDefined(t.category)){var i=this.cateMap;return i[t.category]=i[t.category]||[],i[t.category].push(t),i[t.category]}},getValidPointsPara:function(t){return(this.cateMap[t]||[]).filter(function(t){return t.isVisible()&&t.options.tooltip&&t.options.tooltip.shared})},getSharedPoints:function(t){var e=this.cateMap[t]||[];return e&&e.length?e.filter(function(t){return t.options.tooltip&&t.options.tooltip.shared}):[]},showTooltip:function(t,e,i){this.handler.selectRect||this.components[r.TOOLTIP_COMPONENT].showWithPoint(t,e,i)},hideTooltip:function(){this.hoverPoint=null,this.components[r.TOOLTIP_COMPONENT].hide()},set:function(t){"enable"in t&&this.handler&&(t.enable?this.handler.hammer.set({enable:!0}):(this.handler.hammer.set({enable:!1}),this.handler.removeAllChosen()))},_updateSeriesState:function(){for(var t=this.series,e=0,i=t.length;e<i;e++)t[e].state=t[e].state==o.STATE_TO_DROP?o.STATE_DROPPED:t[e].state,t[e].state=t[e].state==o.STATE_TO_SHOW?o.STATE_SHOW:t[e].state},isMap:function(){return"vanChartMap"==this.vanChartType},chartType:function(){return this.options.chartType},isHeatMap:function(){return this.options.chartType==o.HEAT_MAP},isAreaMap:function(){return this.options.chartType==o.AREA_MAP},isForceBubble:function(){return"vanChartForceBubble"==this.vanChartType},isLargeMode:function(){return this.options.plotOptions.large},seriesOfType:function(t){return this.series.filter(function(e){return e.type==t})},pointsOfType:function(t){var e=[];return this.series.forEach(function(i){i.type==t&&(e=e.concat(i.points))}),e},setTimeout:function(t,e,i){this.timeQueue[t]&&window.clearTimeout(this.timeQueue[t]),i?this.timeQueue[t]=window.setTimeout(e,i):(e&&e(),this.timeQueue[t]=null)},clearTimeQueue:function(){var t=this.timeQueue||{};return Object.keys(t).map(function(e){window.clearTimeout(t[e])}),{}},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new u(this.width,this.height),this._sizeChanged=!1),this._size.clone()}});return p.include({render:function(){this.vancharts.endLoading();var t=this,e=this.renderer,i=this.getPlotClipBounds();this.plotClip?e.updateClip(this.plotClip,i):this.plotClip=e.createClip(i),["backGroup","clipSeriesGroup","seriesGroup","seriesTextRenderGroup","frontGroup"].forEach(function(i){t[i]||(t[i]=e.group().addClass(i).add(),t.isMap()&&t[i].addClass("map-component"))}),e.clip(t.clipSeriesGroup,t.plotClip),e.clip(t.seriesTextRenderGroup,t.plotClip),this._addDivClipGroup(i),this._renderBackground(),this.renderComponents(),this.renderSeries(),this._consoleDone()},_addDivClipGroup:function(t){var e=this;e.seriesTextDivGroup||(e.seriesTextDivGroup=this.renderer.div().add()),e.seriesTextDivGroup.style({clip:"rect("+[t.y,t.x+t.width,t.y+t.height,t.x].join("px ")+"px)"})},_renderBackground:function(){var t=e.makeBounds(0,0,this.width,this.height),i=this.bounds,a=this.options,n=this.renderer,r={backgroundColor:a.geo?"":a.backgroundColor,backgroundImage:a.geo?"":a.backgroundImage,borderColor:a.borderColor,borderWidth:a.geo?0:a.borderWidth,borderRadius:a.borderRadius,shadow:a.shadow},s={backgroundColor:a.plotBackgroundColor,backgroundImage:a.plotBackgroundImage,borderColor:a.plotBorderColor,borderWidth:a.plotBorderWidth,borderRadius:a.plotBorderRadius,shadow:a.plotShadow};r.shadow&&(t.width-=5,t.height-=5),r.backgroundColor||r.backgroundImage||r.borderColor?this.chartBackgroundGroup=this.chartBackgroundGroup||n.group().addTo(this.backGroup):this.chartBackgroundGroup&&(this.chartBackgroundGroup.remove(),this.chartBackgroundGroup=null),s.backgroundColor||s.backgroundImage||s.borderColor?this.plotBackgroundGroup=this.plotBackgroundGroup||this.renderer.group().addTo(this.backGroup):this.plotBackgroundGroup&&(this.plotBackgroundGroup.remove(),this.plotBackgroundGroup=null),this._renderRectangleBackground(this.chartBackgroundGroup,r,t),this._renderRectangleBackground(this.plotBackgroundGroup,s,i)},renderComponents:function(){for(var t in this.components)this.components[t].render()},renderSeries:function(){this.getComponent(r.TOOLTIP_COMPONENT).immediateHide(),this.fire("animationStart"),this._renderTrendLine&&this._renderTrendLine(),this._updateSeriesState()},_renderRectangleBackground:function(t,i,a){if(t){var n=i.borderWidth||0,r=this.renderer,s=n/2,o=e.rectSubPixelOpt(a.x+s,a.y+s,Math.max(a.width-n,0),Math.max(a.height-n,0),n);if(o.rx=o.ry=i.borderRadius,i.shadow){var l=e.rectSubPixelOpt(a,1),c=[5,3,1],h=[.05,.1,.15];c.forEach(function(e,a){var n="shadowRect"+a;t[n]=t[n]||r.rect().style({fill:"none",stroke:"black","stroke-width":c[a],"stroke-opacity":h[a]}).addTo(t),t[n].attr(l).attr({rx:i.borderRadius,ry:i.borderRadius,transform:"translate(1, 1)"})})}if(i.backgroundColor&&"object"==typeof i.backgroundColor)if(e.isSupportSVG()){var u=i.backgroundColor,d={x1:u.x1,y1:u.y1,x2:u.x2,y2:u.y2},p={offset:"0%","stop-color":u.startColor},f={offset:"100%","stop-color":u.endColor};t.gradientFill?r.updateColorGradient(t.gradientFill,d,[p,f]):t.gradientFill=r.colorGradient(d,[p,f])}else i.backgroundColor=i.backgroundColor.startColor;(i.backgroundColor||i.borderWidth)&&(t.backgroundColor=t.backgroundColor||r.rect().addTo(t),t.backgroundColor.attr(o).style({fill:i.backgroundColor?"string"==typeof i.backgroundColor?i.backgroundColor:"url(#"+e.stamp(t.gradientFill)+")":"none",stroke:i.borderColor,"stroke-width":e.pick(i.borderWidth,0)})),i.backgroundImage&&(t.backgroundImage=t.backgroundImage||r.image().addTo(t),t.backgroundImage.attr(a).attr("preserveAspectRatio","none").imageContent(i.backgroundImage))}},filterRender:function(){for(var t=0,e=this.series.length;t<e;t++)this.series[t].filterRender()},cancelLegendHighlight:function(t){var i=this.getComponent(r.LEGEND_COMPONENT);(i=i||this.getComponent(r.RANGE_LEGEND_COMPONENT))&&i.highlighted&&!e.containsPoint(i.bounds,t)&&(i.highlighted=!1,this.highlightTarget=null,this._updateSeriesStyle())},makeLegendHighlight:function(t){this.highlightTarget=t,this._updateSeriesStyle()},_updateSeriesStyle:function(){this.series.forEach(function(t){t.isSupportLegendHighlight()&&(t.useCanvas()?t._canvasRender():(t.drawSeries&&t.drawSeries(),t.getDataToDraw().filter(function(t){return t.isVisible()}).forEach(function(e){t._updatePointGraphicStyle(e)})))})},reRenderSeries:function(){n.calculateSeries(this),n.calculateSeriesShapes(this),this.renderSeries()},_consoleDone:function(){window.console&&console.log("done")},removePointGraphics:function(t){t&&t.remove()},registerInteractiveTarget:function(t,i){this._targets[e.stamp(i.node())]=t,t._events=null,t.getEvents&&t.on(t.getEvents(),t)},findInteractiveTarget:function(t){return this._targets[e.stamp(t)]},resize:function(){var t=this.wrapDom;this.width=e.getDomWidth(t),this.height=e.getDomHeight(t),this.renderer.resize(),this.isMap()&&(this.mapRenderer.resize(),this._onResize(),this.components.geo.resize()),this.layoutComponentsAndCharts()},remove:function(){this.force&&this.force.endTick(null).stop(),this.force=null,this.clearAllEffects(),this.clearTimeQueue(),this.renderer.remove(),this.handler&&this.handler.destroy(),this.mainRenderer&&this.mainRenderer.remove(),this.animationRenderer&&this.animationRenderer.remove(),this.mainRenderer=null,this.animationRenderer=null,this.largeSeries&&Object.keys(this.largeSeries).map(function(t){this.largeSeries[t]._canvas&&this.largeSeries[t]._canvas.remove(),this.largeSeries[t]=null},this),this.largeSeries=null,this.renderer=this.plotClip=this._leaflet=this.handler=this.chartBackgroundGroup=this.trendLineGroup=this.seriesGroup=this.clipSeriesGroup=this.seriesTextRenderGroup=this.seriesTextDivGroup=null}}),t("./VanChartLibrary").register(o.VANCHART,p),p}),define("utils/LoadingUtils",[],function(){var t={};return{startLoading:function(e,i){if(i=i||"loading-div-id",i+=" loading-div-id",!t[i]&&!document.getElementById(i)){var a=document.createElement("div"),n=document.createElement("div");a.id=i,a.style.backgroundColor="white",a.style.opacity=.75,a.style.filter="alpha(opacity=75)",a.style.position="absolute",a.style.width="100%",a.style.height="100%",a.style.left=0,a.style.top=0,a.style.zIndex=9999,void 0==n.style.animation&&void 0==n.style.webkitAnimation||(n.style.left="50%",n.style.top="50%",n.className="loader-inner ball-scale-ripple-multiple",n.innerHTML="<div></div><div></div><div></div>"),a.appendChild(n),e.appendChild(a),t[i]=a}},endLoading:function(e,i){if(i=i||"loading-div-id",i+=" loading-div-id",t[i])e.removeChild(t[i]),t[i]=null;else{var a=document.getElementById(i);a&&e.removeChild(a)}}}}),define("component/LegendIconFactory",["require","../Constants"],function(t){var e=t("../Constants"),i={},a={};return i[e.PIE_ICON]="M15.795,7.943L7.909,12.5L0.205,8.052C1.756,5.333,4.68,3.5,8.032,3.5C11.338,3.5,14.23,5.287,15.795,7.943z",a[e.PIE_ICON]={width:16,height:16},i[e.TREEMAP_ICON]="M9,12H3c-1.6,0-3-1.4-3-3l0-6c0-1.6,1.3-3,3-3l6,0c1.7,0,3,1.4,3,3v6C12,10.6,10.6,12,9,12z",a[e.TREEMAP_ICON]={width:12,height:12},i[e.DONUT_ICON]="M8.945,11.107c1.671,0,3.181,0.684,4.269,1.786l4.271-4.271c-4.686-4.686-12.284-4.686-16.971,0l4.216,4.216C5.815,11.768,7.302,11.107,8.945,11.107z",a[e.DONUT_ICON]={width:18,height:18},i[e.NORMAL_ICON]="M0,0L12,0L12,12L0,12Z",a[e.NORMAL_ICON]={width:12,height:12},i[e.BUBBLE_ICON]="M6,11.5c-1.47,0-2.851-0.572-3.889-1.611C1.072,8.851,0.5,7.47,0.5,6s0.572-2.851,1.611-3.889C3.149,1.072,4.53,0.5,6,0.5s2.851,0.572,3.889,1.611C10.928,3.149,11.5,4.53,11.5,6s-0.572,2.851-1.611,3.889C8.851,10.928,7.47,11.5,6,11.5z",a[e.BUBBLE_ICON]={width:11,height:11},i[e.NULL_MARKER]="M1,8L1,8c0-0.552,0.448-1,1-1h12c0.552,0,1,0.448,1,1v0c0,0.552-0.448,1-1,1H2C1.448,9,1,8.552,1,8z",a[e.NULL_MARKER]={width:16,height:16},i[e.CIRCLE]="M11,8c0,1.657-1.343,3-3,3S5,9.657,5,8s1.343-3,3-3S11,6.343,11,8z M14,7h-2.142C11.942,7.322,12,7.653,12,8s-0.058,0.678-0.142,1H14c0.552,0,1-0.448,1-1C15,7.448,14.552,7,14,7z M4,8c0-0.347,0.058-0.678,0.142-1H2C1.448,7,1,7.448,1,8c0,0.552,0.448,1,1,1h2.142C4.058,8.678,4,8.347,4,8z",a[e.CIRCLE]={width:16,height:16},i[e.SCATTER_ICON+e.NULL_MARKER]="M0,0L12,0L12,12L0,12Z",a[e.SCATTER_ICON+e.NULL_MARKER]={width:12,height:12},i[e.SCATTER_ICON+e.NORMAL_ICON]="M0,0L12,0L12,12L0,12Z",a[e.SCATTER_ICON+e.NORMAL_ICON]={width:12,height:12},i[e.SCATTER_ICON+e.CIRCLE]="M4,8C2.897,8,1.897,7.551,1.173,6.827S0,5.103,0,4s0.449-2.103,1.173-2.827S2.897,0,4,0s2.103,0.449,2.827,1.173S8,2.897,8,4S7.551,6.103,6.827,6.827S5.103,8,4,8",a[e.SCATTER_ICON+e.CIRCLE]={width:8,height:8},i[e.SQUARE]="M11,11H5V5h6V11z M14,7h-2v2h2c0.552,0,1-0.448,1-1C15,7.448,14.552,7,14,7z M4,7H2C1.448,7,1,7.448,1,8c0,0.552,0.448,1,1,1h2V7z",a[e.SQUARE]={width:16,height:16},i[e.SCATTER_ICON+e.SQUARE]="M0,0h8c0,0,0,3.889,0,8C4,8,0,8,0,8V0z",a[e.SCATTER_ICON+e.SQUARE]={width:8,height:8},i[e.DIAMOND]="M8,11L5,8l3-3l3,3L8,11z M14,7h-2.586l1,1l-1,1H14c0.552,0,1-0.448,1-1C15,7.448,14.552,7,14,7z M3.586,8l1-1H2C1.448,7,1,7.448,1,8c0,0.552,0.448,1,1,1h2.586L3.586,8z",a[e.DIAMOND]={width:16,height:16},i[e.SCATTER_ICON+e.DIAMOND]="M0,4.5L4.502,0l4.5,4.5c0,0,0,0-4.5,4.5C0,4.5,0,4.5,0,4.5z",a[e.SCATTER_ICON+e.DIAMOND]={width:9,height:9},i[e.TRIANGLE]="M5,10l3-5.196L11,10H5z M14,7h-3.577l1.155,2H14c0.552,0,1-0.448,1-1C15,7.448,14.552,7,14,7z M5.577,7H2C1.448,7,1,7.448,1,8c0,0.552,0.448,1,1,1h2.423L5.577,7z",a[e.TRIANGLE]={width:16,height:16},i[e.SCATTER_ICON+e.TRIANGLE]="M4.5,0L9,8c0,0-4.617,0-9,0L4.5,0z",a[e.SCATTER_ICON+e.TRIANGLE]={width:9,height:8},i[e.CIRCLE_HOLLOW]="M4.142,9H2C1.448,9,1,8.552,1,8c0-0.552,0.448-1,1-1h2.142C4.058,7.322,4,7.653,4,8S4.058,8.678,4.142,9zM14,7h-2.142C11.942,7.322,12,7.653,12,8s-0.058,0.678-0.142,1H14c0.552,0,1-0.448,1-1C15,7.448,14.552,7,14,7z M8,7C7.449,7,7,7.449,7,8s0.449,1,1,1s1-0.449,1-1S8.551,7,8,7 M8,5c1.657,0,3,1.343,3,3s-1.343,3-3,3S5,9.657,5,8S6.343,5,8,5L8,5z",a[e.CIRCLE_HOLLOW]={width:16,height:16},i[e.SCATTER_ICON+e.CIRCLE_HOLLOW]="M4,2c1.102,0,2,0.898,2,2S5.102,6,4,6S2,5.102,2,4S2.898,2,4,2 M4,0C1.791,0,0,1.791,0,4s1.791,4,4,4s4-1.791,4-4S6.209,0,4,0",a[e.SCATTER_ICON+e.CIRCLE_HOLLOW]={width:8,height:8},i[e.SQUARE_HOLLOW]="M4,9H2C1.448,9,1,8.552,1,8c0-0.552,0.448-1,1-1h2V9z M14,7h-2v2h2c0.552,0,1-0.448,1-1C15,7.448,14.552,7,14,7z M9,7H7v2h2V7 M11,5v6H5V5H11L11,5z",a[e.SQUARE_HOLLOW]={width:16,height:16},i[e.SCATTER_ICON+e.SQUARE_HOLLOW]="M6,6H2V2h4V6z M8,0H0v8h8V0z",a[e.SCATTER_ICON+e.SQUARE_HOLLOW]={width:8,height:8},i[e.DIAMOND_HOLLOW]="M4.157,9H2C1.448,9,1,8.552,1,8c0-0.552,0.448-1,1-1h2.157l-1,1L4.157,9z M14,7h-2.157l1,1l-1,1H14c0.552,0,1-0.448,1-1C15,7.448,14.552,7,14,7z M8,5.986L5.986,8L8,10.014L10.014,8L8,5.986 M8,4.571L11.429,8L8,11.429L4.571,8L8,4.571L8,4.571z",a[e.DIAMOND_HOLLOW]={width:16,height:16},i[e.SCATTER_ICON+e.DIAMOND_HOLLOW]="M2.121,4.999L5,2.121l2.878,2.878L5,7.879L2.121,4.999z M5,0L0,4.999L5,10l4.999-5.001L5,0z",a[e.SCATTER_ICON+e.DIAMOND_HOLLOW]={width:10,height:10},i[e.TRIANGLE_HOLLOW]="M4.5,9H2C1.448,9,1,8.552,1,8s0.448-1,1-1h3.655L4.5,9z M14,7h-3.655L11.5,9H14c0.552,0,1-0.448,1-1S14.552,7,14,7z M8,6.938L6.232,10h3.536L8,6.938 M8,4.938L11.5,11h-7L8,4.938L8,4.938z",a[e.TRIANGLE_HOLLOW]={width:16,height:16},i[e.SCATTER_ICON+e.TRIANGLE_HOLLOW]="M5.001,3.34L7.402,7.5H2.598L5.001,3.34z M5.001,0.34L0,9h10L5.001,0.34z",a[e.SCATTER_ICON+e.TRIANGLE_HOLLOW]={width:10,height:9},{getLegendIconPath:function(t){return i[t]},getLegendIconSize:function(t){return a[t]?a[t]:a[e.NORMAL_ICON]},hasIcon:function(t){return i[t]}}}),define("component/Base",["require","../utils/BaseUtils","../utils/ColorUtils","../Constants","../dom/Evented","../utils/QueryUtils","./LegendIconFactory","../utils/Class"],function(t){var e=t("../utils/BaseUtils"),i=t("../utils/ColorUtils"),a=t("../Constants"),n=t("../dom/Evented");return t("../utils/QueryUtils"),t("./LegendIconFactory"),t("../utils/Class"),n.extend({initialize:function(t,e,i){this.componentType=e,this.vanchart=i,this.refresh(t)},refresh:function(t){this.options=t||this.options,t=this.options,e.extend(this,{isFloat:t.floating,_floatX:this._getPercentValue(t.x,this.vanchart.width),_floatY:this._getPercentValue(t.y,this.vanchart.height)}),e.convertToREMUseDefault16PX(t.style),this._refresh&&this._refresh(t)},createComponentGroup:function(){return this.vanchart.renderer.group().addTo(this.getComponentParentGroup())},getComponentParentGroup:function(){return this.isFloat?this.vanchart.frontGroup:this.vanchart.backGroup},useHtmlLabel:function(){return this.options.useHtml||!e.isSupportSVG()},_getLegendType:function(t){var i=t.options.marker,n="";switch(t.type){case a.MULTIPIE_CHART:case a.PIE_CHART:var r=t.options.innerRadius;return r&&parseFloat(r)>0?a.DONUT_ICON:a.PIE_ICON;case a.RADAR_CHART:if(t.options.columnType)return a.NORMAL_ICON;break;case a.FORCE_BUBBLE_CHART:case a.BUBBLE_CHART:return a.BUBBLE_ICON;case a.TREEMAP_CHART:return a.TREEMAP_ICON;case a.LINE_MAP:return a.NULL_MARKER;default:n=a.NORMAL_ICON}return t.type==a.POINT_MAP&&t.options.icon?t.options.icon.iconUrl:(t.options.image&&e.isSupportSVG()?n=t.options.image:i&&(n=i.symbol,t.type!=a.SCATTER_CHART||e.isImageMarker(n)||(n=a.SCATTER_ICON+i.symbol)),n)},_getPercentValue:function(t,e){return t?(-1!=(t+="").indexOf("%")&&(t=parseFloat(t)*e/100),parseFloat(t)):0},_setComponentBounds:function(t,e){this.isFloat||this.options&&this.options.onZero?this._updateFloatBounds(t,e):this._updateComponentBounds(t,e)},isHorizontal:function(){var t=this.getPosition();return t==a.TOP||t==a.BOTTOM},isVertical:function(){return!this.isHorizontal()},getPosition:function(){return this.options.position},_updateFloatBounds:function(t,e){e=Math.ceil(e);var i=this.vanchart.bounds,n=this._floatX,r=this._floatY,s=i.x+i.width-n,o=i.y+i.height-r;switch(t){case a.TOP:case a.BOTTOM:this.bounds={x:n,y:r,width:s,height:e};break;case a.LEFT:this.bounds={x:n,y:r,width:e,height:o};break;case a.RIGHT_TOP:case a.RIGHT:this.bounds={x:n,y:r,width:e,height:o}}},_updateComponentBounds:function(t,e){e=Math.ceil(e);var i=this.vanchart.bounds,n=i.x,r=i.y,s=i.width,o=i.height;switch(t){case a.TOP:this.bounds={x:n,y:r,width:s,height:e};break;case a.BOTTOM:this.bounds={x:n,y:r+o-e,width:s,height:e};break;case a.LEFT:this.bounds={x:n,y:r,width:e,height:o};break;case a.RIGHT_TOP:case a.RIGHT:this.bounds={x:n+s-e,y:r,width:e,height:o}}this.vanchart.setPlotBounds(i),this._clipPlotBounds(t,e)},_clipPlotBounds:function(t,e){e=Math.ceil(e);var i=this.vanchart.bounds,n=i.x,r=i.y,s=i.width,o=i.height;switch(t){case a.TOP:i={x:n,y:r+e,width:s,height:o-e};break;case a.BOTTOM:i={x:n,y:r,width:s,height:o-e};break;case a.LEFT:i={x:n+e,y:r,width:s-e,height:o};break;case a.RIGHT_TOP:case a.RIGHT:i={x:n,y:r,width:s-e,height:o}}this.vanchart.setPlotBounds(i)},_recordForPlotBounds:function(t,e){e=Math.ceil(e),t===a.RIGHT_TOP&&(t=a.RIGHT),this.vanchart.clipPool[t]=Math.max(this.vanchart.clipPool[t]||0,e)},_getBackgroundColor:function(){var t=this.option,e="string"==typeof t.plotBackgroundColor,a="string"==typeof t.backgroundColor,n=e?t.plotBackgroundColor:a?t.backgroundColor:"white";return i.colorToHex(n)},_maxHeight:function(t){var e=this.vanchart.height;return t||this.options.maxHeight?this._getPercentValue(this.options.maxHeight,e):e},_maxWidth:function(t){var e=this.vanchart.width;return t||this.options.maxWidth?this._getPercentValue(this.options.maxWidth,e):e},_getTickContent:function(t,i){return i?e.format(t,i):t},getDefaultMarkerRadius:function(){return 4.5},getPlotBounds:function(){return this.vanchart.bounds},getChartBounds:function(){return this.vanchart.getChartBounds()},getParentDom:function(){return this.vanchart.getParentDom()},getDivParentDom:function(){return this.vanchart.getDivParentDom()},getTooltipComponent:function(){return this.vanchart.components.tooltip},remove:function(){},_bindData:e.bindData,invisible:function(){return e.hasDefined(this.options.visible)&&!1===this.options.visible},_innerClip:function(t){var i=this,a=i.bounds,n=i.vanchart.renderer,r=e.makeBounds(0,0,a.width,a.height);if(this._clip?n.updateClip(this._clip,r):this._clip=n.createClip(r),"vgroup"===t.type){var s=0+r.width,o=0+r.height;t.divG.style({clip:"rect(0px "+s+"px "+o+"px 0px)"}),n.clip(t.renderG,this._clip)}else n.clip(t,this._clip)}})}),define("component/FormattedText",["require","../utils/BaseUtils","../Constants","../ComponentLibrary"],function(t){function e(t){return null==t?"":(t+"").replace(r,function(t,e){return s[e]})}function i(t,e,i){var a=t.options,n=o.format(a.x,e.XFormat),r=o.format(a.y,e.YFormat),s="-"==a.size?"-":o.format(a.size,e.sizeFormat),c="";return-1==i.indexOf(f)&&-1==i.indexOf(m)||(c="(",-1!=i.indexOf(f)?(c+=n,-1!=i.indexOf(m)&&(c=c+","+r),c+=")"):(c+=r,c+=")"),c+=l.BLANK_VALUE_PERCENTAGE),-1!=i.indexOf(v)&&"-"!=s&&(c+=s),c}function a(t,e){if(t&&(t.nameLabelContent||t.valueLabelContent)&&"funnel"==e.series.type)return n(e,t);var i=0,a=0;if(t&&t.length){for(var r=0,s=t.length;r<s;r++){var o=t[r].dim;i=Math.max(i,o.width),a+=o.height}a+=(s-1)*k}return{width:i,height:a}}function n(t,e){var i=0,a=0,n=0;if(e.nameLabelContent&&(i+=(r=e.nameLabelContent.dim).width,a=Math.max(a,r.height)),e.valueLabelContent){var r=e.valueLabelContent.dim;i+=r.width,a=Math.max(a,r.height)}return e.nameLabelContent&&e.valueLabelContent&&(i+=n=t.series.vanchart.bounds.width*h),{width:i,height:a,nameValueGap:n}}var r=/([&<>"'])/g,s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},o=t("../utils/BaseUtils"),l=t("../Constants"),c=t("../ComponentLibrary"),h=.02,u=o.isSupportSVG(),d="{SERIES}",p="{CATEGORY}",f="{X}",m="{Y}",g="{NAME}",v="{SIZE}",y="{VALUE}",M="{PERCENT}",F="{FROM.NAME}",_="{TO.NAME}",T="{PROCESSES}",b="{STARTTIME}",x="{FINISHTIME}",C="{DURATION}",w="{PROGRESS}",E="{LEVEL}",A={};["name","category","value","processes","startTime","finishTime","duration","progress","level"].map(function(t){var e="{"+t.toUpperCase()+"}";A[e]=[t,t+"Format"]}),A[d]=["seriesName","seriesFormat"],A[M]=["percentage","percentFormat"];var X='<span style="font-size:'+(u?"1rem":"16px")+';font-family:Verdana;color:white;">',S='<span style="font-size:'+(u?"0.875rem":"14px")+';font-family:Verdana;color:white">',I='<span style="font-size:'+(u?"0.875rem":"14px")+';font-family:Verdana;font-weight:bold;color:white">',k=2;return{calculateSingleLineLabelContent:function(t,e){if(!t)return"";if("object"==typeof t){var i="",a=t.identifier,n=o.format(o.pick(e.category,""),t.categoryFormat),r=o.format(o.pick(e.seriesName,""),t.seriesFormat);if(-1==a.indexOf(p)&&-1==a.indexOf(d)||(-1!=a.indexOf(p)&&-1!=a.indexOf(d)?i+=n+" "+r:-1!=a.indexOf(p)?i+=n:i+=r),!e.isNull&&-1!=a.indexOf(y)||-1!=a.indexOf(M)){o.isEmpty(i)||(i+=":");var s=o.format(e[e.series.getTargetKey()],t.valueFormat),l=o.format(e.percentage,t.percentFormat);-1!=a.indexOf(y)&&-1!=a.indexOf(M)?i+=s+" "+l:-1!=a.indexOf(y)?i+=s:i+=l}return i}return o.getFormatterFunction(t).call(e)},createMultiLineLabelContent:function(t,e){if(!t)return[];if("object"==typeof t){var i=[],a=t.identifier,n=o.format(e.category,t.categoryFormat),r=o.format(e.seriesName,t.seriesFormat),s=o.format(e.value,t.valueFormat),l=o.format(e.percentage,t.percentFormat);return-1!=a.indexOf(p)&&i.push(n),-1!=a.indexOf(d)&&i.push(r),-1!=a.indexOf(y)&&i.push(s),-1!=a.indexOf(M)&&i.push(l),i}return[o.getFormatterFunction(t).call(e)]},calculateTextDim:a,dataLabelGenerator:function(){function t(t,e){return(e=e||t&&t.options&&t.options.dataLabels)&&e.enabled&&e.formatter&&t.isVisible()}function e(t,e){return(e=e||t.options.dataLabels).style||o.convertToREMUseDefault16PX({fontSize:"0.75rem",fontFamily:"Verdana",textShadow:"1px 1px 1px rgba(0,0,0,0.15)",color:t.autoLabelColor(e)})}function n(t,i){var a=(i=i||t.options.dataLabels).formatter,n="";try{n=o.getFormatterFunction(a).call(t)}catch(t){}var r=i.style||e(t),s=o.getTextDimension(n,r,i.useHtml);return i.useHtml&&(s.width=isNaN(parseFloat(i.labelWidth))?s.width:parseFloat(i.labelWidth),s.height=isNaN(parseFloat(i.labelHeight))?s.height:parseFloat(i.labelHeight)),[{text:n,style:r,dim:s}]}function r(t,e){return(e=e||t.options.dataLabels).style||o.convertToREMUseDefault16PX({color:t.autoLabelColor(e),fontSize:"0.75rem",fontFamily:"Verdana",textShadow:"1px 1px 1px rgba(0,0,0, 0.15)",fontWeight:"bold"})}function s(t,e){var i=t.series,a=i.type;return i.vanchart.isMap()?F(t,e):a==l.BUBBLE_CHART||a==l.SCATTER_CHART?c(t):a==l.FUNNEL_CHART?h(t):u(t,e)}function c(t){var a=t.options.dataLabels,n=a.formatter,s=n.identifier,l=[];if(-1!=s.indexOf(d)){var c=o.format(t.seriesName,n.seriesFormat),h=a.style||r(t),u=o.getTextDimension(c,h,a.useHtml);l.push({text:c,style:h,dim:u})}if(-1!=s.indexOf(f)||-1!=s.indexOf(m)||-1!=s.indexOf(v)){var p=i(t,n,s),g=a.style||e(t),y=o.getTextDimension(p,g,a.useHtml);l.push({text:p,style:g,dim:y})}return l}function h(t){var i=t.options.dataLabels,a=i.formatter,n=a.identifier;if(i.align==l.INSIDE)return u(t);var s=t.series,c=[];if(-1!=n.indexOf(g)){var h=o.format(t.name,a.nameFormat),d=r(t),p=o.getTextDimension(h,d,i.useHtml);c.nameLabelContent={text:h,style:d,dim:p},s.maxNameLabelWidth||(s.maxNameLabelWidth=0),s.maxNameLabelWidth=Math.max(s.maxNameLabelWidth,p.width)}if(-1!=n.indexOf(y)||-1!=n.indexOf(M)){var f="";-1!=n.indexOf(y)&&(f+=o.format(t.value,a.valueFormat),-1!=n.indexOf(M)&&(f+=l.BLANK_VALUE_PERCENTAGE)),-1!=n.indexOf(M)&&(f+=o.format(t.percentage,a.percentFormat));var m=e(t),v=o.getTextDimension(f,m,i.useHtml);c.valueLabelContent={text:f,style:m,dim:v},s.maxValueLabelWidth||(s.maxValueLabelWidth=0),s.maxValueLabelWidth=Math.max(s.maxValueLabelWidth,v.width)}return c}function u(t,i){function a(t){return t.map(n).filter(s)}function n(e){if(-1!==f.indexOf(e)){var i=A[e][0],a=A[e][1],n=h._formatValue?h._formatValue(t,i):t[i],r=u[a]||h._getLabelFormatFn&&h._getLabelFormatFn(i),s=o.format(n,r);return h._postLabel?h._postLabel(s,i):s}return null}function s(t){return null!==t}function c(e,a,n){if(a.length){var r=a.join(l.BLANK_VALUE_PERCENTAGE),s=n(t,i),c=o.getTextDimension(r,s,i.useHtml);e.push({text:r,style:s,dim:c})}}i=i||t.options.dataLabels;var h=t.series,u=i.formatter,f=u.identifier,m=[g,p,d],v=[y,M,E],F=r,_=e;h.type===l.TREEMAP_CHART?(v.unshift(m.shift()),_=F):h.type===l.GANTT_CHART&&(m=[],v=[T,d,b,x,C,w]);var X=[];return c(X,a(m),F),c(X,a(v),_),X}function F(t,i){if(!t||t.isNull||!i||!i.enabled)return{};var a=i.formatter,n=i.useHtml,s=t.series.type,c=(s==l.SCATTER_CHART||s==l.POINT_MAP?l.OUTSIDE:l.INSIDE,[]);if("object"==typeof a){var h=a.identifier;if(-1!=h.indexOf(g)){var u=o.format(t.name,a.nameFormat),p=r(t,i),f=o.getTextDimension(u,p,n);c.push({text:u,style:p,dim:f})}var m="",F=-1!=h.indexOf(d),_=-1!=h.indexOf(y)||-1!=h.indexOf(v),T=-1!=h.indexOf(M),b=o.format(t.seriesName,a.seriesFormat),x=o.format(t.getTargetValue(),a.valueFormat),C=o.format(t.percentage,a.percentFormat);if(F&&(m+=b,(_||T)&&(m+=":")),_&&(m+=x,T&&(m+=" ")),T&&(m+=C),m){var p=e(t,i),f=o.getTextDimension(m,p,n);c.push({text:m,style:p,dim:f})}}return c}return function(e,i){if(t(e,i)){var r=(i=i||e.options.dataLabels).formatter;e.labelContent="object"==typeof r?s(e,i):n(e,i),e.labelDim=a(e.labelContent,e)}else e.labelDim={width:0,height:0}}}(),tooltipGenerator:function(){function t(t){var e=t.options.tooltip;return e&&e.enabled&&t.isVisible()}function a(e){var i=e.options.tooltip;return t(e)&&i.shared}function n(t,e){var i=(t.series,e.formatter),a=e.style,n=i.identifier,o="";return o+=r(t,n,a,i),o+=s(t,n,a,i)}function r(t,e,i,a){var n="";if(-1!=e.indexOf(d)){var r=o.format(t.seriesName,a.seriesFormat);n+=(i?"<span >":S)+r+"</span>",n+="<br />"}return n}function s(t,e,a,n){var r="";if(-1!=e.indexOf(f)||-1!=e.indexOf(m)||-1!=e.indexOf(v)){var s=i(t,n,e);r+=(a?"<span>":I)+s+"</span>"}return r}function h(t,e){var i=e.style,a=e.formatter,n=a.identifier,r="";if(e.shared){if(-1!=n.indexOf(g)){for(var s,o=t,l=[t.name];(s=o.parent)&&s.depth;)o=s,l.unshift(s.name);r+=(i?"<span>":X)+l.join(" / ")+"</span><br>"}r+=O(t,n,i,a)}else r+=D(t,n,i,a),r+=O(t,n,i,a);return r}function k(t,e){function i(e){if(-1!==r.indexOf(e)){var i=A[e][0],a=A[e][1],l=s._formatValue?s._formatValue(t,i):t[i],c=n[a]||s._getTooltipFormatFn&&s._getTooltipFormatFn(i),h=o.format(l,c);return s._postTooltip?s._postTooltip(h,i):h}return null}var a=e.style,n=e.formatter,r=n.identifier,s=t.series,l="";return[T,d,b,x,C,w].map(function(t){var e=i(t);null!=e&&(l+=(a?"<span>":S)+e+"</span><br>")}),l}function L(t,e){var i=t.series.vanchart,n=t.points,r=e.formatter,s=r.identifier,o=e.style,l="";if(e.shared&&n&&n.length){var h=i.isMap(),d=i.getComponent(c.RANGE_LEGEND_COMPONENT);l+=D(t,s,o,r),n.filter(a).forEach(function(t){var e=h&&d?n[0].color:t.color,i=t.options.tooltip;l+='<span style="font-size:'+(u?"0.75rem":"12px")+";font-style:normal; color: "+e+";opacity:"+t.opacity+'">&#9679  </span>',l+=O(t,s,o,i.formatter),l+="<br />"})}else l+=D(t,s,o,r),l+=O(t,s,o,r);return l}function D(t,i,a,n){var r="",s=t.series.type;return s===l.MULTIPIE_CHART?-1!=i.indexOf(d)&&(r=o.format(e(t.seriesName),n.seriesFormat)):(-1!=i.indexOf(p)&&(r=o.format(e(t.category),n.categoryFormat)),-1!=i.indexOf(g)&&s!==l.WORD_CLOUD_CHART&&(r=o.format(e(t.name),n.nameFormat))),r&&(r=(a?"<span>":X)+r+"</span>",r+="<br />"),r}function O(t,i,a,n){var r,s="",c=t.series.type,h=o.format(t.value,n.valueFormat),u=o.format(t.percentage,n.percentFormat),p=o.format(t.level,n.levelFormat),f={};f[v]=h,f[y]=h,f[M]=u,f[E]=p,c===l.MULTIPIE_CHART||c===l.WORD_CLOUD_CHART?-1!=i.indexOf(g)&&(r=o.format(e(t.name),n.nameFormat)):-1!=i.indexOf(d)&&(r=o.format(e(t.seriesName),n.seriesFormat));var m=[y,M,E];c!=l.BUBBLE_CHART&&c!=l.SCATTER_CHART||(m=[v,M,E]);var F=m.filter(function(t){return-1!==i.indexOf(t)&&!o.isEmpty(f[t])}).map(function(t){return f[t]}).join("  ");return r&&F&&(r+=":"),r&&(s+=(a?"<span >":S)+r+"</span>"),F&&(s+=(a?"<span>":I)+F+"</span>"),s}function P(t,e){if(e&&e.enabled){var i=e.formatter,a="";if("object"==typeof i){var n=e.style,r=i.identifier;a+=U(t,r,n,i),a+=R(t,r,n,i)}else a=o.getFormatterFunction(i).call(t);return a}}function U(t,e,i,a){var n="";if(-1!=e.indexOf(d)){var r=o.format(t.seriesName,a.seriesFormat);n+=(i?"<span >":S)+r+"</span>",n+="<br />"}return n}function R(t,e,i,a){var n="",r=function(t){return-1!==e.indexOf(t)},s=[],l=t.options;r(F)&&l.from.name&&s.push(l.from.name),r(_)&&l.to.name&&s.push(l.to.name),s.length&&(n+=(i?"<span>":S)+s.join("")+"</span>&nbsp;");var c=[];if(r(y)){var h=o.format(t[t.series.getTargetKey()],a.valueFormat);h&&c.push(h)}if(r(M)){var u=o.format(t.percentage,a.percentFormat);u&&c.push(u)}return c.length&&(n+=(i?"<span>":I)+c.join("&nbsp;&nbsp;")+"</span>"),n}return function(e){var i=e.series,a=i.type,r=e.options.tooltip,s=r.formatter;if(!t(e)&&!r.shared)return"";if("object"!=typeof s)try{return o.getFormatterFunction(s).call(e)}catch(t){return""}var c;switch(a){case l.BUBBLE_CHART:case l.SCATTER_CHART:c=i.vanchart.isMap()?L:n;break;case l.TREEMAP_CHART:c=h;break;case l.GANTT_CHART:c=k;break;case l.LINE_MAP:c=P;break;default:c=L}return c(e,r)}}()}}),define("component/Tooltip",["require","./Base","../utils/BaseUtils","../Constants","../utils/ColorUtils","../ComponentLibrary","./FormattedText"],function(t){var e=t("./Base"),i=t("../utils/BaseUtils"),a=(t("../Constants"),t("../utils/ColorUtils")),n=t("../ComponentLibrary"),r=t("./FormattedText"),s=e.extend({_gCssText:"position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:2000;-webkit-user-select:none;-moz-user-select:none;-o-user-select:none;user-select:none;pointer-events:none;",_style:function(t){if(!t)return"";var e=[];if(t.animation&&!t.follow&&(e.push("transition:left 0.4s,top 0.4s"),e.push("-moz-transition:left 0.4s,top 0.4s"),e.push("-webkit-transition:left 0.4s,top 0.4s"),e.push("-o-transition:left 0.4s,top 0.4s")),t.style){var n=i.cssNormalization(t.style);for(var r in n)"color"==r?e.push(r+":"+a.colorToHex(n[r])):e.push(r+":"+n[r])}if(t.backgroundColor)if("string"==typeof t.backgroundColor)if(i.isSupportSVG())e.push("background-Color:"+t.backgroundColor);else{var s=a.colorToHexAlpha(t.backgroundColor),o="#"+("0"+(255*s.alpha|0).toString(16)).slice(-2)+s.hex.replace("#","");e.push("filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="+o+", endColorstr="+o+", GradientType=0)")}else if("object"==typeof t.backgroundColor){var l=t.backgroundColor,c=a.colorToHex(l.startColor),h=a.colorToHex(l.endColor),u="left",d="left top",p="right top",f=1;l.x1==l.x2&&(u="top",d="left top",p="left bottom",f=0),e.push("background: -ms-linear-gradient("+u+", "+c+", "+h+")"),e.push("background-image: -moz-linear-gradient("+u+", "+c+", "+h+")"),e.push("background-image: -webkit-gradient(linear, "+d+", "+p+", color-stop(0, "+c+"), color-stop(1, "+h+"))"),e.push("filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="+c+", endColorstr="+h+", GradientType="+f+")")}null!=t.borderWidth&&e.push("border-width:"+t.borderWidth+"px"),null!=t.borderColor&&e.push("border-color:"+t.borderColor),null!=t.borderRadius&&(e.push("border-radius:"+t.borderRadius+"px"),e.push("-moz-border-radius:"+t.borderRadius+"px"),e.push("-webkit-border-radius:"+t.borderRadius+"px"),e.push("-o-border-radius:"+t.borderRadius+"px")),t.shadow&&e.push("box-shadow:1px 1px 2px rgba(0,0,0,0.2)");var m=t.padding;return null!=m&&void 0!=m&&(m=i.reformCssArray(m),e.push("padding:"+m[0]+"px "+m[1]+"px "+m[2]+"px "+m[3]+"px")),e=e.join(";")+";"},doLayout:function(t){this._tDom||(t=t||this.vanchart.getDivParentDom(),this._tDom=document.createElement("div"),this._hiddenDom=document.createElement("div"),this._tDom.onselectstart=function(){return!1},this._tDom.style.position="absolute",this._hiddenDom.style.visibility="hidden",t.appendChild(this._tDom),t.appendChild(this._hiddenDom),this._tooltipHideTick=null)},remove:function(){if(this._tDom){var t=this.vanchart.getDivParentDom();t.removeChild(this._tDom),t.removeChild(this._hiddenDom)}},showWithPoint:function(t,e,a){if(t&&t.options.tooltip&&t.series.vanchart.renderer){var n=a||t,s=n.options.tooltip,o=t.series,l=r.tooltipGenerator(n),c=this.calculateTooltipDivDim(s,l),h=o.getTooltipPos(t,c,e);h&&(this._show(h,s,l),this._tooltipRect=i.makeBounds(h,c))}},_getTooltipText:function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");return t.indexOf("Trident/7.0")>0||t.indexOf("Edge/")>0||e>0&&10===parseInt(t.substring(e+5,t.indexOf(".",e)),10)?function(t){for(var e,i="",a=!0,n=-1,r=(t+="").length;++n<r;)e=t.charAt(n),a&&"-"===e?e="&#150;":"<"===e?a=!1:">"===e&&(a=!0),i+=e;return i}:function(t){return t}}(),_show:function(t,e,i){t&&e&&i&&!this.vanchart.isMouseDown&&(clearTimeout(this._tooltipHideTick),this._tDom.innerHTML=this._getTooltipText(i),this._tDom.style.cssText=this._gCssText+this._style(e)+"left:"+t[0]+"px;top:"+t[1]+"px;")},hide:function(){clearTimeout(this._tooltipHideTick),this._tooltipHideTick=setTimeout(function(){this._tDom.style.display="none"}.bind(this),400)},immediateHide:function(){this._tDom.style.display="none"},calculateTooltipDivDim:function(t,e){t=t||"";var i=this._hiddenDom;return i.innerHTML=e,i.style.cssText=this._gCssText+this._style(t)+"visibility:hidden;",{width:i.offsetWidth,height:i.offsetHeight}},render:function(){}});return n.register(n.TOOLTIP_COMPONENT,s),s}),define("Carousel",["require","./utils/BaseUtils","./utils/QueryUtils","./dom/DomUtils","./utils/ColorUtils","./utils/PathUtils","./Constants","./utils/BezierEasing","./vector/SvgRenderer","./vector/VmlRenderer","./component/Tooltip"],function(t){function e(t){var e=t.title;return e.text&&e.useHtml?u.getPlainText(e.text):e.text||""}function i(t,e){Object.keys(e).map(function(i){"string"==typeof e[i]&&(t.style[i]=e[i])})}function a(t){var e=f.getRGBAColorArray(t),i=f.rgb2hsb(e[0],e[1],e[2]);return f.toColor(f.hsb2rgb(i[0],.85*i[1],100*(i[2]+.15)/115),"hex")}function n(t){var e=f.getRGBAColorArray(t),i=f.rgb2hsb(e[0],e[1],e[2]);return f.toColor(f.hsb2rgb(i[0],.75*i[1],100*(i[2]+.25)/125),"hex")}function r(t,e){-1===t.className.split(" ").indexOf(e)&&(t.className+=" "+e)}function s(t,e){var i=t.className.split(" "),a=i.indexOf(e);-1!==a&&(i.splice(a,a),t.className=i.join(" "))}function o(t,e,i){if(u.isSupportSVG()){var a="<svg width=22 height=22><g>"+b[e]+"</g></svg>";t.innerHTML=a,t.querySelector("g").setAttribute("fill",i),e===g.RADAR_CHART&&t.querySelector("g").setAttribute("stroke",i)}else t.innerHTML='<img width="22" height="22" src="data:image/png;base64,'+x[e]+'">'}function l(t,e){if(u.isSupportSVG())t.style.background=e,t.innerHTML='<svg width=30 height=30><path fill="none" stroke="#FFFFFF" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M11.1,21.5L20.9 15 11.1 8.5 M11.1,21.5z"></path></svg>';else{var i=h("shape");i.path=m.circlePath(15,15,15),i.stroked="False",i.fillcolor=e;var a=h("fill");a.color=e,a.opacity=.5,i.appendChild(a),t.appendChild(i);var n=h("shape");n.path=/vanchart-arrow-left/.test(t.className)?"m19,22 l9,15 l19,9 e":"m11,22 l21,15 l11,9 e",n.filled="False",n.strokecolor="#ffffff",t.appendChild(n),Hammer.on(t,"mouseover",function(){a.opacity=.2}),Hammer.on(t,"mouseout",function(){a.opacity=.5})}}function c(t){var e=h("shape");e.style.width="100%",e.style.height="100%",e.coordsize="10 10",e.path=m.circlePath(5,5,5),e.stroked="False",e.fillcolor="#7f7f7f";var i=h("fill");i.color="#7f7f7f",i.opacity=.5,e.appendChild(i),t.appendChild(e)}function h(t){var e=y.prototype.create(t);return e.style.cssText=C,e.coordsize="1 1",e}var u=t("./utils/BaseUtils"),d=t("./utils/QueryUtils"),p=t("./dom/DomUtils"),f=t("./utils/ColorUtils"),m=t("./utils/PathUtils"),g=t("./Constants"),v=t("./utils/BezierEasing"),y=(t("./vector/SvgRenderer"),t("./vector/VmlRenderer")),M=t("./component/Tooltip"),F=3.4375,_={type:g.BUTTON,color:"#7f7f7f",interval:1e3,style:{fontSize:"16px",color:"#ffffff"}},T={borderWidth:1,borderColor:"#000000",borderRadius:2,backgroundColor:"rgba(255, 255, 255, 0.5)",padding:5,shadow:!0,animation:!0,style:{fontSize:"12px",fontFamily:"MicrosoftYaHei, sans-serif",color:"#515151"}},b={};b[g.PIE_CHART]='<path d="M12,0.266v10.041l9.519-1.314C20.642,4.339,17,0.742,12,0.266z"/> <path d="M21.744,10.061l-7.309,1.009L11,11.511V11v-0.545V9.651V0.208C5.04,0.208,0.208,5.04,0.208,11 c0,5.96,4.832,10.792,10.792,10.792c0,0,1.214,0,1.602-0.12l0.006-0.012c5.195-0.778,9.183-5.247,9.183-10.659 C21.792,10.683,21.771,10.371,21.744,10.061z"/>',b[g.BAR_CHART]='<rect x="0.937" y="6.794" width="8.112" height="2.704"/> <rect x="0.938" y="12.502" width="13.52" height="2.704"/> <rect x="0.938" y="18.211" width="17.125" height="2.704"/> <rect x="0.937" y="1.086" width="6.309" height="2.704"/>',b[g.COLUMN_CHART]='<rect x="0.625" y="11.943" width="2.83" height="9.432"/> <rect x="6.284" y="8.17" width="2.83" height="13.205"/> <rect x="12.886" y="4.398" width="2.83" height="16.977"/> <rect x="18.545" y="0.625" width="2.83" height="20.75"/>',b[g.LINE_CHART]='<path d="M20.527,2.742c-0.813,0-1.473,0.659-1.473,1.473c0,0.308,0.095,0.593,0.256,0.83l-4.155,7.48 c-0.005,0-0.01-0.002-0.016-0.002c-0.296,0-0.571,0.089-0.802,0.24l-5.74-3.399c0.005-0.05,0.015-0.098,0.015-0.149 c0-0.814-0.66-1.473-1.473-1.473S5.667,8.402,5.667,9.215c0,0.154,0.03,0.299,0.074,0.439L1.987,13.84 c-0.161-0.06-0.333-0.097-0.514-0.097C0.66,13.742,0,14.402,0,15.215s0.66,1.473,1.473,1.473s1.473-0.659,1.473-1.473 c0-0.265-0.076-0.511-0.198-0.726l3.614-4.028c0.227,0.142,0.492,0.227,0.778,0.227c0.399,0,0.76-0.16,1.025-0.418l5.572,3.299 c-0.042,0.136-0.07,0.277-0.07,0.427c0,0.814,0.66,1.473,1.473,1.473s1.473-0.659,1.473-1.473c0-0.445-0.202-0.84-0.514-1.11 l4.033-7.259c0.126,0.035,0.257,0.06,0.395,0.06C21.34,5.688,22,5.029,22,4.215S21.34,2.742,20.527,2.742z"/>',b[g.AREA_CHART]='<path d="M15.255,15.935c0.045,0.075,0.079,0.159,0.079,0.253c0,0.276-0.224,0.5-0.5,0.5s-0.5-0.224-0.5-0.5 c0-0.106,0.041-0.199,0.097-0.28l-7.79-8.953C6.571,6.993,6.493,7.021,6.406,7.021c-0.106,0-0.199-0.04-0.28-0.097L1,12.315V21h21 V9.832L15.255,15.935z"/> <path d="M6.642,6.955C6.797,6.87,6.906,6.711,6.906,6.521c0-0.276-0.224-0.5-0.5-0.5s-0.5,0.224-0.5,0.5 c0,0.17,0.09,0.313,0.22,0.403C6.208,6.981,6.3,7.021,6.406,7.021C6.493,7.021,6.571,6.993,6.642,6.955z"/> <path d="M14.834,16.688c0.276,0,0.5-0.224,0.5-0.5c0-0.094-0.033-0.178-0.079-0.253c-0.087-0.145-0.24-0.247-0.421-0.247 c-0.17,0-0.312,0.09-0.403,0.22c-0.057,0.081-0.097,0.174-0.097,0.28C14.334,16.464,14.558,16.688,14.834,16.688z"/> <polygon points="1,12.315 1,0 0,0 0,22 0.088,22 22,22 22,21 1,21 "/>',b[g.GAUGE_CHART]='<path d="M11,1.149c-6.042,0-10.958,4.916-10.958,10.958c0,2.103,0.597,4.146,1.729,5.908l1.845-1.184 c-0.904-1.408-1.381-3.042-1.381-4.724c0-4.834,3.933-8.766,8.766-8.766s8.766,3.933,8.766,8.766c0,1.682-0.477,3.315-1.38,4.723 l1.845,1.184c1.13-1.762,1.728-3.804,1.728-5.907C21.958,6.065,17.042,1.149,11,1.149z"/> <path d="M11.49,12.11L11,4.273l-0.49,7.837c-0.236,0.16-0.4,0.417-0.4,0.724c0,0.492,0.398,0.89,0.89,0.89s0.89-0.399,0.89-0.89 C11.89,12.527,11.726,12.27,11.49,12.11z"/>',b[g.RADAR_CHART]='<polygon fill="none" stroke-miterlimit="10" points="6.828,20.531 1.417,13.746 3.348,5.286 11.167,1.521 18.985,5.286 20.916,13.746 15.506,20.531 "/> <polyline fill="none" stroke-miterlimit="10" points="3.38,5.38 11.042,10.885 15.506,20.531 "/> <polyline fill="none" stroke-miterlimit="10" points="18.985,5.286 11.057,10.87 1.417,13.746 "/> <line fill="none" stroke-miterlimit="10" x1="11.026" y1="10.885" x2="20.916" y2="13.746"/> <line fill="none" stroke-miterlimit="10" x1="11.167" y1="1.521" x2="11.042" y2="10.901"/> <line fill="none" stroke-miterlimit="10" x1="11.042" y1="10.885" x2="6.835" y2="20.539"/>',b[g.SCATTER_CHART]='<circle cx="14.625" cy="12.158" r="0.916"/> <circle cx="14.625" cy="7.383" r="1.291"/> <circle cx="7.958" cy="12.699" r="0.916"/> <circle cx="21.293" cy="3.702" r="0.707"/> <circle cx="2.041" cy="16.965" r="2.041"/>',b[g.BUBBLE_CHART]=b[g.FORCE_BUBBLE_CHART]='<circle cx="3.521" cy="14.938" r="3.521"/> <circle cx="11.927" cy="5.5" r="1.958"/> <circle cx="20.667" cy="10.219" r="1.333"/>',b[""]='<rect x="2" y="12" width="3" height="9"/> <rect x="7" y="8" width="3" height="13"/> <rect x="12" y="9" width="3" height="12"/> <rect x="17" y="5" width="3" height="16"/> <path d="M20.172,0.911c-0.507,0-0.917,0.411-0.917,0.917c0,0.056,0.022,0.105,0.032,0.158l-4.522,3.532 c-0.156-0.121-0.342-0.205-0.554-0.205c-0.404,0-0.737,0.266-0.859,0.629L8.582,5.56C8.425,5.278,8.135,5.079,7.79,5.079 c-0.507,0-0.917,0.411-0.917,0.917c0,0.053,0.021,0.1,0.031,0.151L2.395,9.78C2.238,9.654,2.046,9.567,1.828,9.567 c-0.506,0-0.917,0.411-0.917,0.917s0.411,0.917,0.917,0.917c0.507,0,0.917-0.411,0.917-0.917c0-0.121-0.026-0.236-0.069-0.342 l4.42-3.563c0.168,0.2,0.411,0.335,0.693,0.335c0.495,0,0.893-0.394,0.91-0.884l4.627,0.372c0.082,0.422,0.437,0.747,0.883,0.747 c0.507,0,0.917-0.411,0.917-0.917c0-0.127-0.026-0.248-0.073-0.358l4.428-3.457c0.168,0.197,0.41,0.329,0.689,0.329 c0.506,0,0.917-0.411,0.917-0.917C21.089,1.322,20.678,0.911,20.172,0.911z"/>',b[g.MULTIPIE_CHART]='<path d="M5.267,10.754c0,0.009-0.002,0.018-0.002,0.028c0,2.918,2.276,5.356,5.194,5.356l0.017-0.002 C7.585,16.12,5.291,13.643,5.267,10.754z"/> <path d="M10.499,18.487l0.003,0c2.997,0,5.568-1.763,6.804-4.219C16.071,16.724,13.5,18.486,10.499,18.487z"/> <path d="M2.916,10.745c0,0.012-0.002,0.025-0.002,0.037c0,4.215,3.329,7.705,7.544,7.705 c0.008,0,0.015-0.001,0.022-0.001C6.288,18.474,2.935,14.937,2.916,10.745z"/> <path fill-opacity = "0.2" d="M18.856,10h2.233C20.546,5,16,0.396,11,0.212v2.213C15,2.604,18.326,6,18.856,10z"/> <path fill-opacity = "0.6" d="M16.104,10h2.752C18.326,6,15,2.604,11,2.424v2.724C13,5.318,15.603,8,16.104,10z"/> <path d="M11,5.149V10h5.104C15.603,8,13,5.318,11,5.149z"/> <path fill-opacity = "0.2" d="M17.752,13.176c-0.119,0.376-0.269,0.741-0.445,1.092c-1.236,2.456-3.807,4.219-6.804,4.219l-0.003,0 l-0.004,0c0,0-0.007-0.001-0.015-0.001c-0.008,0-0.015,0.001-0.022,0.001c-4.215,0-7.544-3.49-7.544-7.705 c0-0.012,0.002-0.025,0.002-0.037c0-0.012-0.002-0.024-0.002-0.036C2.914,6.708,6,3.432,10,3.109V1.2 c-5,0.329-8.994,4.454-8.994,9.509c0,5.269,4.227,9.686,9.496,9.686c5.27,0,9.497-4.395,9.497-9.395h-1.908 C18.091,11.75,17.972,12.482,17.752,13.176z"/> <path fill-opacity = "0.6" d="M2.914,10.709c0,0.012,0.002,0.024,0.002,0.036c0.019,4.192,3.372,7.729,7.564,7.741 c0.007,0,0.015,0.001,0.015,0.001l0.004,0c3-0.001,5.572-1.764,6.808-4.219c0.177-0.351,0.326-0.716,0.445-1.092 c0.22-0.694,0.339-1.426,0.339-2.176h-2.349c0,3-2.321,5.138-5.239,5.138c-0.009,0-0.019-0.001-0.028-0.002l-0.017,0.002 c-2.917,0-5.194-2.438-5.194-5.356c0-0.009,0.002-0.018,0.002-0.028c0-0.015-0.002-0.03-0.002-0.045C5.264,8.007,7,5.783,10,5.468 V3.109C6,3.432,2.914,6.708,2.914,10.709z"/> <path d="M5.264,10.709c0,0.015,0.002,0.03,0.002,0.045c0.024,2.889,2.319,5.366,5.208,5.382c0.009,0,0.019,0.002,0.028,0.002 c2.918,0,5.239-2.138,5.239-5.138H10V5.468C7,5.783,5.264,8.007,5.264,10.709z"/>',b[g.AREA_MAP]=b[g.HEAT_MAP]=b[g.POINT_MAP]='<path d="M28.12 36.6h.03-.05z"/><path d="M19.53 15.7l.04-.02v-.04c0-.08-.1-.16-.2-.13h-.1c-.05 0-.1 0-.12.1 0 0 0 .1-.02.1-.07 0-.14.1-.17.2l-.1.2-.07.1-.1.1-.1.3v.2h-.1v.1h-.1l-.1.1v.5c0 .1 0 .4.1.4l.1-.1v.1h.2v.1h.2v-.2s-.1-.3.1-.5v-.9zM13-8.66h-.05.04zm7.2 16.68L20.18 8h-.1s-.03 0-.04.02h.18zM14.77 18v-.02s-.02.02 0 .02z"/><path d="M21.9 5.6c.05-.05-.02-.12-.05-.17 0 0-.04 0-.03-.02 0 0 .02-.1 0-.1h-.04v-.2c.02-.1 0-.1 0-.1.07 0 .1-.1.1-.1.05-.1 0-.2-.05-.2h.02c.05 0 .04-.1.04-.1l-.1-.1-.2.2h-.1c-.1 0-.1.1-.2.1l-.2.1c-.1 0-.1.1-.2.1l-.1.1c-.1 0-.1.1-.1.1l-.1.2s0 .1-.1.1-.2-.1-.2 0c-.1 0-.3 0-.4-.1V5c0-.1.2-.2.1-.24l.1-.1-.1-.05v.1l-.2-.1h-.4l-.1.1h-.2c.1-.1 0-.1 0-.1V4c0-.15-.1-.24-.2-.26v-.4l-.1-.05V3c0-.1-.1-.1-.1-.1 0-.1 0-.1-.1-.1h-.1c-.1-.1-.2 0-.2 0l-.3-.1-.1-.1v.14h-.5.1c0-.04.1 0 .1-.04L17 3v-.02l-.02-.1v.07-.02V3h-.07.1v.03s-.1 0-.1.02l-.1.04c0 .1-.1.1-.1.1l-.1.1s-.2 0-.2.1h.7-.2v.1l-.1-.1c.1 0 .1.1.1.1v.1h.1v.5c-.1.1-.3.1-.3.2l-.1.1v.2s-.1-.1-.1 0l-.1-.1H16c-.03 0-.1 0-.2.3l-.06.2h-.05c-.1 0-.1.1-.1.1h.1-.1c0 .1 0 .1.1.2 0 0 0 .1.1.1h.4s0 .1.1.1l.2-.2h.1l.1.1h.1l.2.2V6h-.2c-.1 0-.2 0-.2.03-.1 0-.2 0-.2.02l-.1.04c-.1 0-.2.4-.2.5V7H16c-.2 0-.3-.2-.3-.08-.07.1-.17-.04-.2-.02-.2 0-.28-.1-.35 0 0 .06-.03.05-.03.1s-.1.1-.1.1H15s-.04 0 0 0l-.4-.1-.1-.05c-.16 0-.25.2-.27.26-.04.1-.06.2-.05.2.04.2.15.3.2.3h-.06c-.3.2-.36.3-.36.3 0 .1-.1.1-.14.1h-.24s-.03-.1-.2-.1h-.05c-.04 0-.23.2-.3.2l-.1.1h-.03l-.02.1-.43.2-.37.4-.1.3h-.1s0-.2-.02-.2c0 0-.05-.1-.1-.1v-.2.2c-.04 0-.1.2-.16.2h-.1c-.1 0-.25-.3-.3-.4v-.1h-.04c-.2 0-.24-.2-.24-.2v-.1l-.6-.1H9l.03-.1-.08-.1.03.1c-.03-.1-.04 0-.03 0h-.02l.24-.7-.35.5-.06-.1-.04-.1c-.02 0-.03 0-.04-.1 0 0-.04-.2-.07-.2v-.1h-.2L8.3 7c0-.05-.2-.2-.2-.2-.1-.07-.2-.1-.4-.1h-.1l-.1-.04h-.2l-.1-.05s0 .2-.02.2V7H7.1v-.15c0-.02 0-.12-.03-.15v-.1c.05-.05.12-.1.14-.17l.1-.1v-.68l-.1-.1v-.03.3c0-.04 0 .2-.1.2H7c-.04 0-.06-.33-.1-.33s-.06-.2-.1-.2v-.4L6.5 5H6s.2-.05.17-.1l.1-.03c.03-.05.08-.06.08-.08 0-.1-.05-.1-.1-.1l-.12-.1H5.9c-.1 0-.1.1-.1.1V5h-.2c-.1 0-.1 0-.1.04l-.1.06c0 .02-.1.04-.1.07v.36l-.1.03c-.1 0-.1.2-.1.2L5 6s0-.3-.02-.3c0 0 0 .1-.1.1-.03 0-.1.1-.14.1l-.07-.3s0-.2-.05-.2c-.08 0-.1-.1-.1-.1 0-.05-.1-.1-.14-.1s-.1 0-.12.05v.05l-.07.04-.1.13-.1.05-.1.1c-.1 0-.1.03-.1.05v.08s-.1.1-.1.15V6l-.1-.04H3c-.03 0-.1.04-.13.1v.1c.03.07.1.1.14.1v.8s-.5 0-.5.04-.5.15-.5.15v.08l.4.03.1.04c-.1 0 0 .02-.1.03l-.1.03-.1.04H2c-.05 0-.1.03-.1.06-.05 0-.1 0-.1.03h-.1c0-.1-.04-.1-.1-.1h-.3s-.03 0-.05.1c-.04 0-.08.1-.1.1V8v-.2l-.02-.1c0-.04 0-.12-.1-.12 0 0-.1 0-.1.02v.2S1 8 .93 8H.8v-.16c-.03 0-.05-.1-.06-.1-.02 0-.04-.05-.07-.04 0 0 0-.03-.03-.03L.6 7.65H.5c-.06 0-.1.06-.1.07H.3c0 .02-.02.03-.03.04-.05.04-.05.1-.04.12H.15l-.02.02c-.06.04-.06.14-.02.2v.02l.1.02c0 .02-.1.06-.1.12 0 .04 0 .12.1.15v.1c.1.1.1.1.2.1h.1l.1.1.1.1V9s-.1.1 0 .2v-.05H.1c-.02.08 0 .18.06.2l.12.07H.3l.07.03H.4v.16h.1H0h.3c-.02.1.1.1.1.1-.06.1 0 .1 0 .1 0 .1.04.1.1.1 0 .1 0 .1.02.1l.03.1H.7l.04.1s.1.1.17.1H1l.1.1.2.1v.4l.3.1.1.1-.05.1h-.1s-.05 0-.06.1c-.1 0-.1.1-.1.1l-.2.1h-.1.1v.1l-.1.1v.1c-.1.1-.1.1-.1.2-.1 0-.1.1-.1.2v.1s-.1.1 0 .2v.1c-.1 0 0 0 0 .1-.1 0-.1 0-.1.1v.2l.1.1h.2l.1.1.1.1v.1h.1l.1.1h.1s.1 0 .1-.1V13H2v.1c0 .05.06.1.1.1h.1v.1l.1.1c0 .04 0 .04.03.05h.05v.14s.04.1.12.1H3v.1s.03.1.06.1h.05l.1.1h.2c0 .1 0 .1.1.2h.3l.1-.1H4c.05 0 .07.1.1.1 0 0 .03.1.07.1h.15v.3s.2.4.3.4h.05l.1-.3c.1 0 .1-.1.2-.2v-.1l.1-.07.04-.06v.15s0 .1.1.16c0 .1.1.1.2.1h.1c.1 0 .1-.1.1-.1v-.1h.1l.1-.1H6l.1.06h.2l.1.02H6v.1c0 .05.04.1.07.1h.16c-.04 0-.07.06-.07.1v.1c.03.1.17.1.2.1l.22.04H7c.02-.02.08-.03.1-.12l.03-.03.08-.07h.4l.1-.06h.1c.1-.05.1-.1.1-.1l.1-.04h.2l.2.1h.1c.1 0 .2.1.2.1h.2c.1-.05.1-.14.1-.2 0 .04.2.06.2.06v.1H9s-.03.04 0 .1v.2s0 .03.05.05c0 .1.05.1.08.1 0 .1.05.1.05.1v.1h.03v.4H9v.1h-.03c-.03 0-.04.1-.05.1h-.1v.2h-.1l-.1.1v.1l-.02.1v.1l.07.1-.1.1v.1c.04.1.07.1.1.1h.4s.03.1.05.1c0 0 0 .1.03.1-.03.02-.03.04 0 .06V17h.02l.1.28v.06c0 .05 0 .14.04.2H9l.15.03.04.02v.4-.5h.3v.2s0-.1.1-.1v-.2.1s0 .1.1.1h.2s.1 0 .1-.1v-.3l.1-.2v-.1c0 .1.1.1.1.1h.2l.1-.1s0 .3.1.3v.3h.1v-.6l.1-.1.1-.1c.1 0 .1-.1.1-.1h.2v.4l.1.5c.1 0 .2-.4.2-.4s.1 0 .1-.1v.1-.1.1h.1s0 .1.1.1c0 0 0 .1.2.1l.1-.1v-.1h.3v-.05h.4v.1c-.1 0-.2.2-.2.2-.1 0-.1.1-.1.2l-.1.1-.1.04v.1c-.07 0-.07 0-.07.1l.1.2c-.1 0 0 .1 0 .1s0 .1.1.1h.4l.1.02v-.05h.1l.1-.08h.06s.1.03.1 0l.1-.08V18h.1l.1-.2.2-.1-.1-.1c-.1-.1-.1-.1-.2-.14l-.3-.1H13h1v.1-.1h.1v-.14h.2s.1 0 .1-.1c.1.07.1.1.2 0h.1V17s.1-.1.18-.1.1.1.1.1c.1 0 .2-.04.2-.14v.6h.2c.08 0 .1-.4.1-.4V17l.1-.1v-.1l.1-.06c.1 0 .1 0 .1-.1v.4c.1.07.1.5.2.5l.1-.4V17h.1l.04-.03.02-.02c.1 0 .2-.04.2-.12l-.1-.05-.1-.05.2-.02h.2l.3.1-.1-.1h.23s.1 0 .1-.1v-.1h.3l.1-.1V16s.1 0 .1-.05l.1-.02.03-.04v-.1c.1 0 .1-.1.1-.1h.1v-.1c.08-.1.07-.2 0-.2v-.2h.05v-.4l.04-.1h.1l-.1-.1v-.5h.2v-.25c0-.1 0-.1-.03-.1l-.53-.1h.6l.1-.1.06-.08s.08-.1 0-.1l.07-.1V13h-.3c-.1-.06-.1-.07-.2-.07l.1-.1h.1l.1-.07-.1-.1v-.27c-.06-.1-.15-.2-.3-.2l-.06-.1s-.1-.1-.2-.1v-.1c0-.1 0-.1-.1-.2l-.1-.1v-.2c0-.1 0-.1-.03-.1l-.1-.2c-.1-.2-.1-.2-.1-.1-.1 0-.1-.1-.2 0-.1-.1-.4-.1-.5-.1l.3-.1h.2l.1-.1.6-.5-.46.1c0-.1.1-.1.1-.1.07 0 .17-.1.2-.1s.05-.1.04-.1l.1-.1v.2c.03 0 .04.2.05.2l.04-.3.1-.1c.06 0 .1-.1.1-.1l-.7-.1H17h.4l.1.1h.2l.1.1h.6c.1-.08.1-.28.1-.3l.1-.17c.1 0 .1-.1.1-.1v-.1h.1s.1 0 .1-.04l.1-.1c.1 0 .1 0 .1-.1.1 0 .1-.1.1-.1h.4l-.04-.1c-.1-.1 0-.1 0-.1v-.1c.1-.1.1-.1.1-.2.1 0 .17-.1.18-.1l.04-.1.05-.1.1-.1c0-.1.1-.2.1-.2l.06-.1h.3c0-.1.2-.1.2-.1v-.1l.3-.1c.1-.1.3-.2.3-.3s-.1-.1 0-.1v-.1s.1 0 .1-.1v-.3c0-.1 0-.2-.1-.2l-.1-.2c0-.1-.1-.1-.1-.1v-.1c.1-.1.1-.1.1-.2h.5c0-.1.1-.2.1-.3 0-.1-.1-.1-.1-.2zM1.25 11.5zm12.8 6.8h.04-.1z"/><path d="M17.38 10h.04"/><path d="M16 3.5h.23H16zm2.32 6.5l-.04-.02V10h.04zM21 7.34h.05L21 7.3v.03zm-4.4 5.4s-.02-.07-.1-.07h-.02v.15l-.03.14h-.03c-.03 0-.06-.13-.07-.13l-.02-.1c-.05 0-.1.08-.14.1-.1 0-.1.1-.1.1h.3c.1 0 .1.05.1.03v-.18l-.1-.05z"/>',b[g.TREEMAP_CHART]='<polygon fill-opacity = "0.6" points="11,0 11,10 11,13 11,14 11,16 11,22 22,22 22,16 22,14 22,13 22,10 22,0 "/> <rect y="14" fill-opacity = "0.2" width="10" height="8"/> <rect width="10" height="13"/>',b[g.FUNNEL_CHART]='<polygon points="20.06,6.533 1.989,6.533 1.082,1.656 20.966,1.656 "/> <polygon points="17.949,14.412 4.005,14.412 2.051,8.409 19.888,8.409 "/> <polygon points="14.963,20.79 6.944,20.79 4.271,15.912 17.933,15.912 "/>',b[g.GANTT_CHART]='<path d="M8.38.95V4.42h-7A.48.48,0,0,1,.83,4V1.37a.47.47,0,0,1,.5-.43ZM2.67,6.48a.47.47,0,0,0-.5.43V9.53a.47.47,0,0,0,.5.43H13.12V6.48ZM20.49,12H8.58a.47.47,0,0,0-.5.43v2.62a.47.47,0,0,0,.5.43H20.49a.47.47,0,0,0,.5-.43V12.43A.48.48,0,0,0,20.49,12ZM4,17.53a.47.47,0,0,0-.5.43v2.63A.47.47,0,0,0,4,21H14.44V17.53Z"/> <path fill-opacity="0.5" d="M11.58,1.37V4a.48.48,0,0,1-.5.43H8.38V.95h2.7A.47.47,0,0,1,11.58,1.37Zm3,5.1H13.12V10h1.46a.47.47,0,0,0,.5-.43V6.9A.48.48,0,0,0,14.58,6.48Zm4.49,11.06H14.44V21h4.63c.32,0,.6-.19.6-.43V18C19.67,17.73,19.39,17.53,19.07,17.53Z"/>',b[g.STRUCTURE_CHART]='<path d="M20.4,18c-1,1-2.5,1-3.5,0.1c-0.7-0.6-0.9-1.6-0.7-2.4l-4-1.7c-0.1,0.1-0.2,0.2-0.3,0.3c-1.4,1.5-3.6,1.6-5.2,0.4l-1,1  c0.7,1,0.6,2.3-0.2,3.2c-1,1-2.5,1-3.5,0.1c-1-1-1-2.5-0.1-3.5c0.9-0.9,2.4-1,3.4-0.2l1-1c-1.3-1.5-1.3-3.8,0.1-5.3  c0,0,0.1-0.1,0.1-0.1l-1.5-3C4,6.3,2.8,6.2,2,5.4c-1-1-1-2.5-0.1-3.5c1-1,2.5-1,3.5-0.1c1,1,1,2.5,0.1,3.5c0,0,0,0,0,0l1.5,3  c1.4-0.9,3.4-0.8,4.7,0.4l2.1-2.1c-0.6-0.9-0.5-2.2,0.3-3.1c1-1,2.5-1,3.5-0.1s1,2.5,0.1,3.5c-0.9,1-2.4,1-3.4,0.1l-2,2  c0.9,1.2,1.1,2.8,0.4,4.2l3.8,1.6c0.1-0.2,0.2-0.3,0.4-0.5c1-1,2.5-1,3.5-0.1C21.3,15.4,21.4,17,20.4,18z"/>';var x={};x[g.PIE_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWBAMAAAA2mnEIAAAAMFBMVEUAAAD///////////////////////////////////////////////////////////87TQQwAAAAD3RSTlMAEM/vv4Bgr59AcFAg348jFhddAAAAjElEQVQY02MAArGSDx6JDGDAav//w//PASAmo/5/IPv/JwEgW/g/mP1fEcjWh7I/AVX/h7L/L2AQhrMvMOTD2b8Z6uHsfwz+ULZK1ByG/2B25smtLfYQ9hewLEQNRACoFwZ+AM2EgW9Au2DAkIEVzg6AuO0/xG1wRYpgv0CEBaB+/A/2I8Tv/zVAfgcA4kmspsM258YAAAAASUVORK5CYII=",x[g.BAR_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWBAMAAAA2mnEIAAAAElBMVEUAAAD///////////////////8+Uq06AAAABXRSTlMAQIAgEDB5ccoAAAA+SURBVBjTY0AGoqGhgTjZBICjoKCgCFw9SAMm20hJSUkZlwFwNWAgANELBgrobEdBMDDAZQZEPRQI4GQjAwAQhxXw9o2YjgAAAABJRU5ErkJggg==",x[g.COLUMN_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWBAMAAAA2mnEIAAAAG1BMVEUAAAD////////////////////////////////rTT7CAAAACHRSTlMAgEC/IGCPMNAZ/cwAAAAuSURBVBjTY4ADRSEEW6KRALvYDMHWaCbAtmgiwHZSgbOBiG5skJcDRRgcRYEMADB5J9shBWGXAAAAAElFTkSuQmCC",x[g.LINE_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAAAM1BMVEUAAAD///////////////////////////////////////////////////////////////+3leKCAAAAEHRSTlMA74C/IM9AEN+vYDCfcFCP7HfXwgAAAG9JREFUGNPNjzsOxDAIRA0Yf+J1du5/2siKIQ1dmlA9PQ2gSa8nHznSBIo0gOgGlAPdm+M4HQuK4Qn8jEU88QdoZw6MZ0+lQ/Li5muDFpYGrokpu9UbJjUmtqaqdQeqAN2aYln7hx41nbwzLDN9Yi4tRQMa2y+S7gAAAABJRU5ErkJggg==",x[g.AREA_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAgklEQVR42mL4DwQMtACjBg8zg4FCBhRbiMPg+f8hIIFqBiMZCgMGFBuMxVAQeE+q4UD1AnCDgVT/f9zgPlgxcYaC4uc8Ayws/xMG5wkZDjX0Pdix/0kD8/EY6gAzlByDsRqOzcfkGIySDHEFIyMFGWEClC7AJslIqyw9avAQNhggwABVPsGVrLOsUQAAAABJRU5ErkJggg==",x[g.GAUGE_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWBAMAAAA2mnEIAAAAMFBMVEUAAAD///////////////////////////////////////////////////////////87TQQwAAAAD3RSTlMAgL9A3zAQn89wII/vr2A5/8HrAAAAnUlEQVQY02NAA5kq/52mQZjZ/0FgG4jJ6v/fXbDk/5cAIDvmvzJDKIPR/6MMDGz+HxkYjBkY5L8kMLD/FwCzGf8XMKz/xABmM+j/Ytj/GUjPBGL73wz9DUBaEIg5fjAAlYPYIA0M/ydA2ZxA9gMgfQaI+f5D1NyFqOm/AHUh7w+G/b+g7PXfGeK/Q9n1XxmYtKDsRQoMbHAvJTAQAQCj4DRASabatgAAAABJRU5ErkJggg==",x[g.RADAR_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAAAM1BMVEUAAAD///////////////////////////////////////////////////////////////+3leKCAAAAEHRSTlMAEO+A32DPr7+fQFAwIHCP1A0rdQAAAMpJREFUGNOFUFlyRCEIlEXcfdz/tAHxVSr5mOmyQJu2UdI39Mob/pOjcuOK9KeQmbPJbd3CS3oqblWQVpiqnEx00tYnjlXqemlo+ISqZHhwBN25AOih0aQDGxhNuI2QbmGh16ByKSLT9w/FAw6aar0v89zItKMhqzJan3tf8i4qe3aWvHxLE81LQ5IKZU7nImu2Y3gvhcQjvBGsLHTat9srTZ0n+V8Ap4fuYd+h4rxCMkNp6YIEwhZwNfkdeWG+fxIfxQsQfdHTB/wA4h0GZUKWX6QAAAAASUVORK5CYII=",x[g.SCATTER_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAgUlEQVR42mJgGAVA8P//fwFaGFoAxP8ZaWCwAZByGHRhCPYuEKyntsH7oQb/x6WGhUyzF0LpCyMnoRtAkw+6uAMQnwdFIrlhfB5Ko6d3BSA2IDuMgS6aD8T9eDICeV6mNBzn/0eA+dQ0GB1QxeVMtExSDTQJCljBDMQKI7t6AggwAFyzgSCZYutPAAAAAElFTkSuQmCC",x[g.BUBBLE_CHART]=x[g.FORCE_BUBBLE_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAnUlEQVR42mJgGAVQwEiswv///ysAqQQodwIjI+MHqrgAaPD7/wiwn1qGOvxHA1QLM1JdzEKC2YbIYUz31AANNgFqG9oPDar3TFR2sAGUFoCnUSCeD4oUKG1AposNgHg9ECdgTUpQEEBpuNzHYfB9Sg3GBwzINZdQ5H0YlEFhgJZd/0P5BhQXm9CckgBNfyDvbwAWiw9GaxWqAIAAAwA2evfwKvysMwAAAABJRU5ErkJggg==",x[""]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAAAM1BMVEUAAAD///////////////////////////////////////////////////////////////+3leKCAAAAEHRSTlMAQL/PMBBwgCDvn49gUN+vfvzE8AAAAGJJREFUGNPdjUEOgDAIBFkordpW+f9rNdqUQ3mBeyBhMiwURBNFYQu4HsK60E1aUNAlA+7sUgpQmdXMZh/vDORyPs8cJ+l4T7dEjhsPB8DE+bh0LD4IJkRO3K7Agj/xTzjKDUJoCsaJEKt8AAAAAElFTkSuQmCC",x[g.MULTIPIE_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAAAe1BMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////NgkbwAAAAKHRSTlMAMpkDn0AnIBSz24Dmv4dKOhoQCuzKrJqMLfnyuaZ5dGZaUkIN0pRsCVisMQAAAOZJREFUGNN90dtygyAUhWHWEhA0Gg8xappz0pb3f8LKdkrTXvS/45s9DHtQL8G6TP0qcxYKS3n2gm0UVX9ugblPatFca63IsX4AfdLtB0nF2BbIhHPcNVkV6jBo8Txqj2bkfheCCmG3eA08ZfhC/RYii483GZ9BDkF4qSBLYGE8NDeJw4mUx+DGlU2ssdY9ZeWrFl7bkHcI48gicUHdCFt4+sRHTrCRHcoT33+GL3Cy+wxPVvHlh4Hcfy/fwXi9nL0ntTfo1JqDmSrGqglxxeQw57Iszwbx4lSWYy3/+2td27ad4D99Ae8gE70h03waAAAAAElFTkSuQmCC",x[g.AREA_MAP]=x[g.HEAT_MAP]=x[g.POINT_MAP]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAA5ElEQVR42mJgGHHg////AkDsAMQK1DZ4/38IeE/QcJACIDYgwlAHqIH/kQxvAOLz2BTPB0kA8X1CLoC6FtlgOEBXiA76QWGIx1cO/7GDfpCCAqjzcYH76MEC4hNQr8CAyys4QANUIzqAmbEe7kMcCkkF76HxooCeDqkB1mNLMtQAAdhyznkqGHwfawoikDKIBQ64EnwA1Ob9aLFNLFBgIDK7CpAQByDHNMD0s+AymJGR8QDUgngiyqIHQHwQiPlJLcHeIwXRe7QI+w/1mQLOMCZU7iKxQWXIfVoU7uS5blADgAADACOwXahZ5pbvAAAAAElFTkSuQmCC",x[g.TREEMAP_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAOUlEQVR42mL8DwQMRABGIAAqnclAJGBioBEYNXjU4FGDh5XBLEDMRyuD1YhUe3Y08kYNHqQGAwQYAL9YCMfrIWhGAAAAAElFTkSuQmCC",x[g.FUNNEL_CHART]="iVBORw0KGgoAAAANSUhEUgAAABcAAAAXBAMAAAASBMmTAAAAKlBMVEUAAAD///////////////////////////////////////////////////+Gu8ovAAAADXRSTlMAQMCAIGAw0FAQ8HCwS1BQUgAAAHVJREFUGNNjwA2Y78LAZQYGDjjnKgMDC5xzDahuLYxzAcjRhXEKgJxEQShIAHIcYRwHIGcvTFkAkOML40wActih7DsgJ3Aj7ETYehPsuloIRwHT3UlKYNAAZMKMuzUBzGFEGAZxKkJ/LojjAOWwGhsbW2CYCwC1z2uuESf9qgAAAABJRU5ErkJggg==",x[g.GANTT_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAAAeFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////GqOSsAAAAJ3RSTlMABOgQCPvZzN3OhMOofnrCZD03jzDs0ryWiXNsXyUjDd9TUkQqHhgfRKpZAAAAmElEQVQY043P2Q6DIBRF0SsiKMrgXKfamf//w1qxQJo0uh73y8kBmEMDYxyA9SI1WrGB310+R9o4ie7mZW1zeXU5bBuaLKhQfQ4HBB7bgKOGbOJuqL45007G8p3MahJvLmVfLcXAjtncE8BEE3NrZXOhfXv5gXxgzaEH/nu2qZQyXUiajUqNavpdQ5wxVuafXEWWJoJzwYo3Z10TfT0w3LEAAAAASUVORK5CYII=",x[g.STRUCTURE_CHART]="iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAAAhFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8g2+bRAAAAK3RSTlMAA/v3JXcSB9yNRSycF/Dsu7akmJSCTTMOC9HEwKWIWTof4taqoH1wZ1Ydf35d9gAAAO1JREFUGNNVUAlygzAMlA+wMZAQroTc6d3q///rYkHcahikWe+sdkVSitbhOQ2vOyu4/KUyZj4+0ft+gc9sNJdCnBrmSuCCNfuDkDPMHCIlbzS/k1MoUIzhG+D5s/UlKjr6wp6XHJhsHysVxh8K1b3vxJV4bTfM277LV5fSc88aywqalORZHRiGiW2UTfAFGErP9pVbnhz1wvZxT7rSnhEVS6+WqMzGiE7h8TiBzV1Z+fYTUwHcejan2mZDmCN/MPQ2NVEbu+g5oiPkNLQauaBTEvkKtR2mm/R0/3MR7/n9Nhz+xPifP0GL93SGVL8LLRIgop0Y4gAAAABJRU5ErkJggg==";var C="position:absolute;width:1px;height:1px;behavior:url(#default#VML);";return function(t){function h(t,e){(B=B||p.create("div","vanchart-chart",N)).style.width=100/z+"%",B.style.marginLeft=-100/z+"%",J&&(B.style.width=D.clientWidth+"px",B.style.marginLeft=-D.clientWidth+"px");var i=t.map(function(t,i){return m(t,i),w(t,e[i],$[i],i)});return V=V||p.create("div","vanchart-chart",N),V.style.width=100/z+"%",V.style.marginRight=-100/z+"%",J&&(V.style.width=D.clientWidth+"px",V.style.marginLeft=-D.clientWidth+"px"),i}function m(t,i){var a=e(t),n=P[i];$[i]||($[i]=p.create("div","vanchart-chart",N),P[i]=n=p.create("div","vanchart-menu-dot",O.mWrap),u.isSupportSVG()||(n.style.background="none",c(p.create("div","vanchart-menu-dot-ie",n))),i||r(n,"van-on")),n._title=a,n.i=i,Hammer.on(n,"mouseover",function(){y(n)}),Hammer.on(n,"mouseout",function(){Z.immediateHide()}),new Hammer(n).on("tap",function(t){t.preventDefault(),A(i),X(i)})}function y(t){var e=Z.calculateTooltipDivDim(T,t._title),i=[D.clientWidth/2-(z-1)/2*16+16*t.i-e.width/2,D.clientHeight-18-e.height];i[0]=Math.min(Math.max(i[0],0),D.clientWidth-e.width),Z._show(i,T,t._title)}function b(t,e,i,a){return t.map(function(t,n){return x(t,n,i,a),w(t,e[n],$[n],n)})}function x(t,i,a,n){var r=e(t),s=P[i];if($[i]||($[i]=p.create("div","vanchart-chart",N),P[i]=s=p.create("div","vanchart-menu-btn",O),s.mIcon=p.create("span","vanchart-menu-icon",s),s.mText=p.create("span","vanchart-menu-text",s),u.isSupportSVG()||s.insertAdjacentHTML("afterBegin",'<span class="vanchart-menu-btn_before"></span>'),i||(s.style.background=n)),o(s.mIcon,t.chartType,a),s.style.width=100/z+"%",!u.isSupportSVG()){var l=D.clientWidth/z;J&&(l-=2*q+1),s.style.width=l+"px",0!==s.offsetTop&&(s.style.width=l-1+"px")}s.mText.textContent?s.mText.textContent=r:s.mText.innerText=r,s._title=r,s.i=i,k(s),Hammer.on(s,"mouseover",function(){s.style.background=n,C(s)}),Hammer.on(s,"mouseout",function(){W!==i&&(s.style.background=""),Z.immediateHide()}),new Hammer(s).on("tap",function(t){t.preventDefault(),P[W].style.background="",P[i].style.background=n,X(i)})}function C(t){if((u.isSupportSVG()?t.scrollWidth>t.clientWidth:t.scrollWidth>=t.clientWidth)||""===t.mText.innerHTML){var e=Z.calculateTooltipDivDim(T,t._title),i=[D.clientWidth*(t.i+.5)/z-e.width/2,t.offsetHeight];i[0]=Math.min(Math.max(i[0],0),D.clientWidth-e.width),Z._show(i,T,t._title)}}function w(e,i,a,n){if(a.style.width=100/z+"%",!u.isSupportSVG()||a.offsetLeft<D.clientWidth*n){var r=D.clientWidth*n-a.offsetLeft;a.style.width=D.clientWidth+r+"px"}var s,o=a;return n===z-1?(G||(G=E(a)),o=G):0===n&&(H||(H=E(a)),o=H),s=t._initSingle(e,i,o),n!==W&&s.set({enable:!1}),s}function E(t){var e=p.create("div","vanchart-chart-wrap",t);return e.style.cssText="width:100%;height:100%",e}function A(t,e){e===g.RIGHT&&W===z-1&&0===t?($[0].appendChild(H),B.appendChild(G),s(N,"van-ani"),N.style.left="100%",N.clientWidth):e===g.LEFT&&0===W&&t===z-1?($[z-1].appendChild(G),V.appendChild(H),s(N,"van-ani"),N.style.left=100*-z+"%",N.clientWidth):($[0].appendChild(H),$[z-1].appendChild(G)),r(N,"van-ani")}function X(e){if(s(P[W],"van-on"),t.charts[W].set({enable:!1}),r(P[e],"van-on"),t.charts[e].set({enable:!0}),Q)N.style.left=100*-e+"%";else{var i=v.css.swing;S(N,"left",100*-e+"%",500,i)}W=e}function S(t,e,i,a,n){function r(){u>=a?(h=l,t.style[e]=h+c):(h=s+(l-s)*n(u/a),t.style[e]=h+c,u+=d,Y=window.setTimeout(r,d))}window.clearTimeout(Y);var s=parseFloat(t.style[e])||0,o=i.match(/([\d.E-]+)(.*)/i),l=+o[1],c=o[2],h=s,u=0,d=17;r()}function I(t){window.clearInterval(j),t&&(j=window.setInterval(function(){var t=(W+1)%z;A(t,g.RIGHT),X(t)},t))}function k(t){t.clientWidth<=22+3*q&&(t.mText.innerHTML="",t.mText.style.marginLeft=0,J||(t.style.padding=0))}var L=null,D=null,O=null,P=[],U=null,R=null,N=null,B=null,G=null,V=null,H=null,$=[],W=0,z=0,j=null,Y=null,q=0,K={left:null,right:null,dom:null},Z=new M({},g.TOOLBAR_COMPONENT,{}),Q="transition"in document.getElementsByTagName("body")[0].style,J=/MSIE 7/.test(navigator.userAgent);return{init:function(t,e,s){t&&t.switchStyle||I();var o=t.options,c=d.merge(_,t.switchStyle,!0);u.isSupportSVG()||c.style.color&&(c.style.color=f.colorToHex(c.style.color)),D=s,L=c.type,z=o.length,O=O||p.create("div","vanchart-menu",s),N=N||p.create("div","vanchart-cc",s),s.style.overflow="hidden",Z.doLayout(s);var m=c.color;switch(e.splice(z).map(function(t){t.remove()}),P.splice(z).map(function(t){p.remove(t)}),$.splice(z).map(function(t){p.remove(t)}),r(N,"van-ani"),W=W>=z?0:W,L){case g.CAROUSEL:O.style.bottom=0,O.style.height="18px",O.style.width="100%",O.mWrap=O.mWrap||p.create("div","vanchart-menu-wrap",O),N.style.cssText="top:0;bottom: 18px;left:"+100*-W+"%;width:"+100*z+"%",u.isSupportSVG()||(N.style.height=D.clientHeight-18+"px"),U=U||p.create("div","vanchart-arrow-wrap",s),(R=R||p.create("div","vanchart-arrow-wrap",s)).style.right=0;var v=U.arrowLeft=U.arrowLeft||p.create("div","vanchart-arrow vanchart-arrow-left",U),y=R.arrowRight=R.arrowRight||p.create("div","vanchart-arrow vanchart-arrow-right",R);l(v,m),l(y,m);var M=c.interval;return K.left&&K.left.off("tap"),K.left=K.left||new Hammer(v),K.left.on("tap",function(t){t.preventDefault(),I(M);var e=(z+W-1)%z;A(e,g.LEFT),X(e)}),K.right&&K.right.off("tap"),K.right=K.right||new Hammer(y),K.right.on("tap",function(t){t.preventDefault(),I(M);var e=(W+1)%z;A(e,g.RIGHT),X(e)}),K.dom&&K.dom.off(s,"mouseover mouseout"),K.dom=Hammer.on(s,"mouseover",function(){I()}).on(s,"mouseout",function(){I(M)}),I(M),h(o,e);case g.BUTTON:default:var T=a(m),x="width:100%;top:0;background-color:"+m+";filter:progid:DXImageTransform.Microsoft.gradient(startColorstr="+T+", endColorstr="+f.colorToHex(m)+", GradientType=0);";x+="background-image: -webkit-gradient(linear, left top, left bottom, from("+T+"), to("+m+"));",x+="background-image: -moz-linear-gradient(top"+T+", "+m+");",x+="background-image: -webkit-linear-gradient(top"+T+", "+m+");",x+="background-image: linear-gradient(to bottom"+T+", "+m+");",O.style.cssText=x,i(O,c.style);var C=(q=u.getTextHeight(c.style))*F;return N.style.cssText="left:"+100*-W+"%;top:"+C+"px;bottom: 0;width:"+100*z+"%",u.isSupportSVG()||(N.style.height=D.clientHeight-C+"px"),b(o,e,c.style.color,n(m))}},refresh:function(i,a){var n=e(i),r=P[a];return r.mText&&(r.mText.textContent?r.mText.textContent=n:r.mText.innerText=n,k(r)),r._title=n,w(i,t.charts[a],$[a],a)}}}}),define("VanCharts",["require","./vans/VanChart","./utils/BaseUtils","./Constants","./utils/LoadingUtils","./Carousel","./vans/VanChartLibrary"],function(t){function e(t){r.initConst();var e=t.getAttribute(s.INSTANCES_KEY);e||(e=s.INSTANCES_KEY+h++,t.setAttribute(s.INSTANCES_KEY,e));var a=u[e]||new i(t);return u[e]=a,a}function i(t){this.dom=t,this.charts=[],this.carousel=l&&l(this),this.dom.style.cssText+=";overflow:hidden;-ms-user-select:none;-webkit-user-select:none;-moz-user-select:none;-o-user-select:none;user-select:none;",this.dom.onselectstart=this.dom.ondrag=function(){return!1}}function a(t,i){var a,s,o=t.options;try{s=window.top.document,a=window.top}catch(t){a=window,s=a.document}var l=s.body,c=7998;if(null==i)for(var h,u=-1,d=document.body.children.length;++u<d;)"none"!==((h=document.body.children[u]).style.display||"").toLowerCase()&&(c=Math.max(c,h.style.zIndex));else c=i-1;var p=s.createElement("div");p.style.cssText="position: fixed;top:0;left:0;width:100%;height:100%;z-index:"+(c+1)+";",r.isSupportSVG()?p.style.background="rgba(0,0,0,0.3)":(p.style.background="#000000",p.style.filter="alpha(opacity=30)"),l.appendChild(p);var f=s.createElement("div");f.style.cssText="position: fixed;top:5%;left:10%;width:80%;height:90%;z-index:"+(c+2)+";background:#ffffff;box-shadow:0px 4px 50px rgba(0,0,0,0.5);";try{f.style.setExpression("top","( ignoreMe = document.body.scrollTop + this.previousSibling.clientHeight * 0.05) + 'px' "),p.style.setExpression("top","( ignoreMe = document.body.scrollTop ) + 'px' "),f.style.position="absolute",p.style.position="absolute"}catch(t){}l.appendChild(f);var m=e(f);m.fullScreenFather=t,m.setOptions(o),t.set({enable:!1}),t.fullScreenChart=m,f.boxDiv=p,p.onclick=function(){n(f,t)},f.onclick=function(t){(t=t||a.event).stopPropagation?t.stopPropagation():t.cancelBubble=!0}}function n(t,e){var i=t.parentNode;i&&(i.removeChild(t),t.boxDiv&&i.removeChild(t.boxDiv)),e.set({enable:!0}),e.fullScreenChart=null}t("./vans/VanChart");var r=t("./utils/BaseUtils"),s=t("./Constants"),o=t("./utils/LoadingUtils"),l=t("./Carousel"),c=t("./vans/VanChartLibrary");window.VAN_CANVAS=r.isSupportSVG()?"canvas":"vancanvas";var h=0,u=Object.create(null);return i.prototype={constructor:i,setOptions:function(t){this.options=t||this.options,t&&r.isArray(t.options)?this.charts=this.carousel.init(t,this.charts,this.dom):this.charts=[this._initSingle(t,this.charts[0],this.dom)]},showLightBox:function(t){a(t)},hideLightBox:function(t,e){n(t,e)},_initSingle:function(t,e,i){var a=c.get(t.chartType);return e&&e.vanChartType===a.prototype.vanChartType?(e._changeDataState=!0,e.refresh(t),e):(e&&e.remove(),new a(t,i,this))},setData:function(t,e){null!=e?this.charts[e]=this.carousel.refresh(t,e):this.setOptions(t)},eachVanChart:function(t){this.charts.forEach(function(e){t.call(null,e)})},refreshRestore:function(){this.eachVanChart(function(t){t.refreshRestore()})},resize:function(t){t?this.setOptions(t):this.charts.forEach(function(t){t.resize()})},getChart:function(t){return this.charts[t]},clear:function(){for(var t=0,e=this.charts.length;t<e;t++)this.charts[t].remove();this.charts=[]},startLoading:function(){this.dom&&o.startLoading(this.dom,this.dom.getAttribute(s.INSTANCES_KEY))},endLoading:function(){this.dom&&o.endLoading(this.dom,this.dom.getAttribute(s.INSTANCES_KEY))}},window.VanCharts={version:"8.5.0",buildTime:"2018-5-10 16:07:50 GMT+0800 (CST)",showLightBox:a,hideLightBox:n,init:e,initPaddingScale:function(t){r.initPaddingScale(t)},acceptPoint:function(t){return t&&"point"===t.vanChartType},instances:u}}),define("chart/Point",["require","../utils/QueryUtils","../utils/BaseUtils","../utils/ColorUtils","../Constants","../ComponentLibrary","../dom/Evented"],function(t){var e=(t("../utils/QueryUtils"),t("../utils/BaseUtils")),i=t("../utils/ColorUtils"),a=t("../Constants"),n=t("../ComponentLibrary"),r=t("../dom/Evented").extend({vanChartType:"point",initialize:function(t,e){this.series=e,this.refresh(t||{})},refresh:function(t){var i=this.series,r=i.vanchart;this.originalColor=t.color,this.originalMarkerFillColor=t.marker&&t.marker.fillColor,t=this.options=e.createOptions(t,[i.options]);var s=i.isSeriesAccumulated(),o=i.type==a.BAR_CHART?t.y:t.x,l=i.name;if(this.category=s?l:o,this.seriesName=s?o:l,this.value=this.getTargetValue(),this.name=e.pick(this.options.x,this.options.name),this.x=t.x,this.y=t.y,this.size=t.size,this.visible=!0,this.isNull=i.isNullValue(this),this.points=s?i.points:r.registerPointsPara(this),!i.options.large){if(t.drilldown&&t.drilldown.geo){var c=n.get(n.GEO_COMPONENT);this.geo=new c(t.drilldown.geo,n.GEO_COMPONENT,r)}e.convertToREMUseDefault16PX(t.dataLabels&&t.dataLabels.style),e.convertToREMUseDefault16PX(t.tooltip&&t.tooltip.style),this.jsonHyperlink=t.jsonHyperlink,this.drillUpLink=t.drillUpLink,this.hyperlink=t.hyperlink}},refreshPointColor:function(){var t=this,r=t.options,s=t.series,o=s.vanchart;if(!s.isTreeSeries()){var l,c=r.opacity,h=r.opacity;l=s.type==a.STRUCTURE_CHART?this.level:s.isSeriesAccumulated()?e.pick(r.x,r.name):s.name;var u=o.getDefaultSeriesColor(l),d=u;if(r.marker&&(r.marker=e.clone(r.marker),d=r.marker.fillColor||d),s.type!==a.LINE_MAP||!s.options.large){var p=o.getComponent(n.RANGE_LEGEND_COMPONENT);p&&(u=p.getColorWithSize(this.getTargetValue()),d=u,this.visible=!!u)}if(d=s.originalColor||d,d=s.originalMarkerFillColor||d,u=this.originalColor||s.originalColor||u,d=this.originalColor||d,d=this.originalMarkerFillColor||d,s.type!=a.BUBBLE_CHART&&s.type!=a.FORCE_BUBBLE_CHART||p||(t.getTargetValue()<0&&t.options.displayNegative?u="rgb(138, 138, 138)":t.getTargetValue()<0&&(u=null)),u&&(u=(f=i.getStandardColorAndOpacity(u,c)).hex,c=f.alpha),d){var f=i.getStandardColorAndOpacity(d,h);d=f.hex,h=f.alpha}var m=r.marker;m&&(m.fillColor=d,m.fillColorOpacity=h,m.radius=isNaN(m.radius)?4.5:m.radius,m.symbol=m.symbol||s.marker&&s.marker.symbol||""),u&&(this.color=u,this.opacity=c,this.mouseOverColor=this.options.mouseOverColor||i.getHighLightColor(u),this.clickColor=i.getClickColor(u),this.clickOpacity=.95*c),this.borderColor=this.options.borderColor,this.borderOpacity=this.options.borderOpacity}},getTargetValue:function(){var t=this.options[this.series.getTargetKey()];return isNaN(+t)?this.series.isNullValue(this)?0:t:+t},getLatLng:function(t){var e=this.options.lnglat;if(!e){var i=this.series.vanchart.getCurrentGeo();t||(t=i.getFeaturesByName(this.name,this.series.type),t=t&&t[0]),t&&(e=i.getDataPointLngLat(this,t))}return e?[e[1],e[0]]:null}});return r.include({_onPointMouseOver:function(t){var e=this,i=e.options,a=this.series,n=a.vanchart,r=(n.renderer,n.hoverPoint),s=n.hoverSeries,o=n.hoverPoints,l=n.getSharedAxis();if(r!==e){if(a.isTreeSeries())return a.vanchart.showTooltip(e,t),void a.fire("pointMouseOver",e);if(r&&r.fire("mouseout",t),i.tooltip&&i.tooltip.shared&&e.points&&l&&e.series.supportTooltipShared()){var c=n.getValidPointsPara(e.category),h=c.reduce(function(t,e){return e.series._onPointMouseOver.call(e,e),t?e.getTargetValue()>t.getTargetValue()?e:t:e},0);o&&o.length&&o[0]!=c[0]&&o[0]._onPointMouseOut.call(o[0],t),l&&c.length&&l.drawHighlightBackground(c),a.vanchart.showTooltip(h,t,n.getSharedPoints(e.category)[0]),n.hoverPoints=c}else a.vanchart.showTooltip(e,t),a.fire("pointMouseOver",e),s!=e.series&&(s&&s.fire("mouseout",t),e.series.fire("mouseover",t)),n.hoverSeries=e.series,n.hoverPoint=e}},_onPointMouseMove:function(t){var e=this.series.vanchart;e.showTooltip(e.hoverPoint,t)},_onPointMouseOut:function(t){var e=this,i=e.options.tooltip,a=this.series,n=a.vanchart.getSharedAxis();a.isTreeSeries()?a.fire("pointMouseOut",e):(i&&i.shared&&e.points&&e.points.length&&n?e.points.forEach(function(e){e.graphic&&e.series.fire("pointMouseOut",e),e.series.fire("mouseout",t)}):e.series.fire("pointMouseOut",e),a.vanchart.hideTooltip())},_onPointTap:function(t){var i=this,a=(i.options,this.series),n=a.vanchart;if(n.isMap()?n.isMapPointVisible(i):i.isVisible()){a.isTreeSeries()&&a.onPointTap(i),n.drillDown&&n.drillDown(i);var r=t.srcEvent;r=r.touches?r.touches.length?r.touches[0]:r.changedTouches[0]:r,i.onClick(r),e.hasTouch()&&i.fire("mouseover",t)}},hasValidDataLabel:function(){var t=this,e=t.labelPos&&!isNaN(t.labelPos.x)&&!isNaN(t.labelPos.y)&&t.options.dataLabels&&t.options.dataLabels.enabled;return t.series.visible&&!t.isNull&&t.visible&&e},clearPointEffect:function(){var t=this;clearInterval(t.effectInterval),t.effectGraphic&&t.effectGraphic.remove(),t.effectGraphic=null},isVisible:function(){var t=this;return t&&t.visible&&t.series.visible&&!t.isNull},getEffectTime:function(){var t=this;return e.isSupportSVG()&&t.isVisible()&&t.options.effect&&t.options.effect.enabled?t.series._getEffectTime(t):0},hasEffect:function(){return this.getEffectTime()>0},autoLabelColor:function(t){var e=this,i=e.options,n=e.series,r=(t=t||i.dataLabels).align,s=r==a.TOP||r==a.BOTTOM||r==a.OUTSIDE;return n.type==a.BUBBLE_CHART||n.type==a.TREEMAP_CHART||n.type==a.FORCE_BUBBLE_CHART||n.columnType?s=!1:n.type!=a.SCATTER_CHART&&n.type!=a.POINT_MAP||(s=!0),s?i.marker&&i.marker.fillColor||e.color:"#ffffff"},_onPointPress:function(t){var e=this,i=this.series;i.vanchart.hoverPoint&&i.onPointPress.call(e,t)},_onPointPressUp:function(t){var e=this,i=this.series,a=i.vanchart.hoverPoint;a&&(i.onPointPressUp.call(e,t),a._onPointTap(t))},onClick:function(t){var i=this,a=i.options,n=a.click||a.onClick;n&&e.getFormatterFunction(n).call(i,t)},getEvents:function(){return{mouseover:this._onPointMouseOver,mouseout:this._onPointMouseOut,mousemove:this._onPointMouseMove,tap:this._onPointTap,press:this._onPointPress,pressup:this._onPointPressUp}},remove:function(){this.visible=!1,this.graphic&&this.graphic.remove(),this.textGraphic&&this.textGraphic.remove(),this.leadLine&&this.leadLine.remove(),this.moreLabelG&&this.moreLabelG.remove(),this.graphic=this.textGraphic=this.moreLabelG=this.leadLine=null},clearChild:function(){var t=this;if(t.parent){var i=t.parent.children;i&&i.splice(e.indexOf(i,t),1)}t.children&&t.children.forEach(function(t){t.clearChild(t)}),t.remove()},getTooltipRect:function(){var t=this.series.vanchart.getComponent(n.TOOLTIP_COMPONENT);if(t)return t._tooltipRect}}),r}),define("utils/PathGenerator",["require","./vMap","../Constants"],function(t){function e(t){return t>1?G:t<-1?-G:Math.asin(t)}function i(t){return t[0]}function a(t){return t[1]}function n(t){return t}function r(){return!0}function s(){return 0}function o(t){return t.innerRadius}function l(t){return t.outerRadius}function c(t){return t.startAngle}function h(t){return t.endAngle}function u(t){return t&&t.padAngle}function d(t,e,i,a){return(t-i)*e-(e-a)*t>0?0:1}function p(t,e,i,a,n){var r=t[0]-e[0],s=t[1]-e[1],o=(n?a:-a)/Math.sqrt(r*r+s*s),l=o*s,c=-o*r,h=t[0]+l,u=t[1]+c,d=e[0]+l,p=e[1]+c,f=(h+d)/2,m=(u+p)/2,g=d-h,v=p-u,y=g*g+v*v,M=i-a,F=h*p-d*u,_=(v<0?-1:1)*Math.sqrt(M*M*y-F*F),T=(F*v-g*_)/y,b=(-F*g-v*_)/y,x=(F*v+g*_)/y,C=(-F*g+v*_)/y,w=T-f,E=b-m,A=x-f,X=C-m;return w*w+E*E>A*A+X*X&&(T=x,b=C),[[T-l,b-c],[T*i/M,b*i/M]]}function f(t,e,i,a){var n=t[0],r=i[0],s=e[0]-n,o=a[0]-r,l=t[1],c=i[1],h=e[1]-l,u=a[1]-c,d=(o*(l-c)-u*(n-r))/(u*s-o*h);return[n+d*s,l+d*h]}function m(t){return"function"==typeof t?t:function(){return t}}function g(t){function e(e){function i(){r.push("M",l(t(c),h))}for(var a,r=[],c=[],u=-1,d=e.length,p=m(n),f=m(s);++u<d;)o.call(this,a=e[u],u)?c.push([+p.call(this,a,u),+f.call(this,a,u)]):c.length&&(i(),c=[]);return c.length&&i(),r.length?r.join(""):null}var n=i,s=a,o=r,l=v,c=l.key,h=.7;return e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(s=t,e):s},e.defined=function(t){return arguments.length?(o=t,e):o},e.interpolate=function(t){return arguments.length?(c="function"==typeof t?l=t:(l=W.get(t)||v).key,e):c},e.tension=function(t){return arguments.length?(h=t,e):h},e}function v(t){return t.join("L")}function y(t){for(var e=0,i=t.length,a=t[0],n=[a[0],",",a[1]];++e<i;)n.push("V",(a=t[e])[1],"H",a[0]);return n.join("")}function M(t){for(var e=0,i=t.length,a=t[0],n=[a[0],",",a[1]];++e<i;)n.push("H",(a=t[e])[0],"V",a[1]);return n.join("")}function F(t,e){if(e.length<1||t.length!=e.length&&t.length!=e.length+2)return v(t);var i=t.length!=e.length,a="",n=t[0],r=t[1],s=e[0],o=s,l=1;if(i&&(a+="Q"+(r[0]-2*s[0]/3)+","+(r[1]-2*s[1]/3)+","+r[0]+","+r[1],n=t[1],l=2),e.length>1){o=e[1],r=t[l],l++,a+="C"+(n[0]+s[0])+","+(n[1]+s[1])+","+(r[0]-o[0])+","+(r[1]-o[1])+","+r[0]+","+r[1];for(var c=2;c<e.length;c++,l++)r=t[l],o=e[c],a+="S"+(r[0]-o[0])+","+(r[1]-o[1])+","+r[0]+","+r[1]}if(i){var h=t[l];a+="Q"+(r[0]+2*o[0]/3)+","+(r[1]+2*o[1]/3)+","+h[0]+","+h[1]}return a}function _(t,e){for(var i,a=[],n=(1-e)/2,r=t[0],s=t[1],o=1,l=t.length;++o<l;)i=r,r=s,s=t[o],a.push([n*(s[0]-i[0]),n*(s[1]-i[1])]);return a}function T(t){if(t.length<3)return v(t);var e=1,i=t.length,a=t[0],n=a[0],r=a[1],s=[n,n,n,(a=t[1])[0]],o=[r,r,r,a[1]],l=[n,",",r,"L",b(Y,s),",",b(Y,o)];for(t.push(t[i-1]);++e<=i;)a=t[e],s.shift(),s.push(a[0]),o.shift(),o.push(a[1]),x(l,s,o);return t.pop(),l.push("L",a),l.join("")}function b(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function x(t,e,i){t.push("C",b(z,e),",",b(z,i),",",b(j,e),",",b(j,i),",",b(Y,e),",",b(Y,i))}function C(t,e){return(e[1]-t[1])/(e[0]-t[0])}function w(t){for(var e=0,i=t.length-1,a=[],n=t[0],r=t[1],s=a[0]=C(n,r);++e<i;)a[e]=(s+(s=C(n=r,r=t[e+1])))/2;return a[e]=s,a}function E(t){for(var e,i,a,n,r=[],s=w(t),o=-1,l=t.length-1;++o<l;)e=C(t[o],t[o+1]),V(e)<R?s[o]=s[o+1]=0:(i=s[o]/e,a=s[o+1]/e,(n=i*i+a*a)>9&&(n=3*e/Math.sqrt(n),s[o]=n*i,s[o+1]=n*a));for(o=-1;++o<=l;)n=(t[Math.min(l,o+1)][0]-t[Math.max(0,o-1)][0])/(6*(1+s[o]*s[o])),r.push([n||0,s[o]*n||0]);return r}function A(t){for(var e,i,a,n=-1,r=t.length;++n<r;)e=t[n],i=e[0],a=e[1]-G,e[0]=i*Math.cos(a),e[1]=i*Math.sin(a);return t}function X(t){function e(e){function i(){g.push("M",h(t(y),f),p,d(t(v.reverse()),f),"Z")}for(var a,r,u,g=[],v=[],y=[],M=-1,F=e.length,_=m(n),T=m(o),b=n===s?function(){return r}:m(s),x=o===l?function(){return u}:m(l);++M<F;)c.call(this,a=e[M],M)?(v.push([r=+_.call(this,a,M),u=+T.call(this,a,M)]),y.push([+b.call(this,a,M),+x.call(this,a,M)])):v.length&&(i(),v=[],y=[]);return v.length&&i(),g.length?g.join(""):null}var n=i,s=i,o=0,l=a,c=r,h=v,u=h.key,d=h,p="L",f=.7;return e.x=function(t){return arguments.length?(n=s=t,e):s},e.x0=function(t){return arguments.length?(n=t,e):n},e.x1=function(t){return arguments.length?(s=t,e):s},e.y=function(t){return arguments.length?(o=l=t,e):l},e.y0=function(t){return arguments.length?(o=t,e):o},e.y1=function(t){return arguments.length?(l=t,e):l},e.defined=function(t){return arguments.length?(c=t,e):c},e.interpolate=function(t){return arguments.length?(u="function"==typeof t?h=t:(h=W.get(t)||v).key,d=h.reverse||h,p=h.closed?"M":"L",e):u},e.tension=function(t){return arguments.length?(f=t,e):f},e}function S(t){return t.source}function I(t){return t.target}function k(t){return[t.x,t.y]}function L(t){return t/180*Math.PI}function D(t){return t*Math.sin(L(18))/(Math.sin(L(36))+Math.sin(L(18))*Math.cos(L(36)))}function O(t,e,i){return[(Math.sin(t)*e).toFixed(i),(-Math.cos(t)*e).toFixed(i)]}var P=t("./vMap"),U=t("../Constants"),R=1e-6,N=Math.PI,B=2*N-R,G=N/2,V=Math.abs,H={};H.arc=function(){function t(){var t=Math.max(0,+r.apply(this,arguments)),s=Math.max(0,+g.apply(this,arguments)),o=M.apply(this,arguments)-G,l=F.apply(this,arguments)-G,c=Math.abs(l-o),h=o>l?0:1;if(s<t&&(u=s,s=t,t=u),c>=B)return i(s,h)+(t?i(t,1-h):"")+"Z";var u,m,T,b,x,C,w,E,A,X,S,I,k=0,L=0,D=[];if((b=(+_.apply(this,arguments)||0)/2)&&(T=y===$?Math.sqrt(t*t+s*s):+y.apply(this,arguments),h||(L*=-1),s&&(L=e(T/s*Math.sin(b))),t&&(k=e(T/t*Math.sin(b)))),s){x=s*Math.cos(o+L),C=s*Math.sin(o+L),w=s*Math.cos(l-L),E=s*Math.sin(l-L);var O=Math.abs(l-o-2*L)<=N?0:1;if(L&&d(x,C,w,E)===h^O){var P=(o+l)/2;x=s*Math.cos(P),C=s*Math.sin(P),w=E=null}}else x=C=0;if(t){A=t*Math.cos(l-k),X=t*Math.sin(l-k),S=t*Math.cos(o+k),I=t*Math.sin(o+k);var U=Math.abs(o-l+2*k)<=N?0:1;if(k&&d(A,X,S,I)===1-h^U){var R=(o+l)/2;A=t*Math.cos(R),X=t*Math.sin(R),S=I=null}}else A=X=0;if((u=Math.min(Math.abs(s-t)/2,+v.apply(this,arguments)))>.001){m=t<s^h?0:1;var V=null==S?[A,X]:null==w?[x,C]:f([x,C],[S,I],[w,E],[A,X]),H=x-V[0],W=C-V[1],z=w-V[0],j=E-V[1],Y=1/Math.sin(Math.acos((H*z+W*j)/(Math.sqrt(H*H+W*W)*Math.sqrt(z*z+j*j)))/2),q=Math.sqrt(V[0]*V[0]+V[1]*V[1]);if(null!=w){var K=Math.min(u,(s-q)/(Y+1)),Z=p(null==S?[A,X]:[S,I],[x,C],s,K,h),Q=p([w,E],[A,X],s,K,h);u===K?D.push("M",Z[0],"A",K,",",K," 0 0,",m," ",Z[1],"A",s,",",s," 0 ",1-h^d(Z[1][0],Z[1][1],Q[1][0],Q[1][1]),",",h," ",Q[1],"A",K,",",K," 0 0,",m," ",Q[0]):D.push("M",Z[0],"A",K,",",K," 0 1,",m," ",Q[0])}else D.push("M",x,",",C);if(null!=S){var J=Math.min(u,(t-q)/(Y-1)),tt=p([x,C],[S,I],t,-J,h),et=p([A,X],null==w?[x,C]:[w,E],t,-J,h);u===J?D.push("L",et[0],"A",J,",",J," 0 0,",m," ",et[1],"A",t,",",t," 0 ",h^d(et[1][0],et[1][1],tt[1][0],tt[1][1]),",",1-h," ",tt[1],"A",J,",",J," 0 0,",m," ",tt[0]):D.push("L",et[0],"A",J,",",J," 0 0,",m," ",tt[0])}else a&&D.push("L",A,",",X)}else D.push("M",x,",",C),null!=w&&D.push("A",s,",",s," 0 ",O,",",h," ",w,",",E),a&&D.push("L",A,",",X),null!=S&&D.push("A",t,",",t," 0 ",U,",",1-h," ",S,",",I);return n&&D.push("Z"),D.join("")}function i(t,e){return"M0,"+t+"A"+t+","+t+" 0 1,"+e+" 0,"+-t+"A"+t+","+t+" 0 1,"+e+" 0,"+t}var a=!0,n=!0,r=o,g=l,v=s,y=$,M=c,F=h,_=u;return t.toCenter=function(e){return arguments.length?(a=!!e,t):a},t.closePath=function(e){return arguments.length?(n=!!e,t):n},t.innerRadius=function(e){return arguments.length?(r=m(e),t):r},t.outerRadius=function(e){return arguments.length?(g=m(e),t):g},t.cornerRadius=function(e){return arguments.length?(v=m(e),t):v},t.padRadius=function(e){return arguments.length?(y=e==$?$:m(e),t):y},t.startAngle=function(e){return arguments.length?(M=m(e),t):M},t.endAngle=function(e){return arguments.length?(F=m(e),t):F},t.padAngle=function(e){return arguments.length?(_=m(e),t):_},t.centroid=function(){var t=(+r.apply(this,arguments)+ +g.apply(this,arguments))/2,e=(+M.apply(this,arguments)+ +F.apply(this,arguments))/2-G;return[Math.cos(e)*t,Math.sin(e)*t]},t};var $="auto";H.line=function(){return g(n)};var W=new P({linear:v,"linear-closed":function(t){return v(t)+"Z"},step:function(t){for(var e=0,i=t.length,a=t[0],n=[a[0],",",a[1]];++e<i;)n.push("H",(a[0]+(a=t[e])[0])/2,"V",a[1]);return i>1&&n.push("H",a[0]),n.join("")},"step-before":y,"step-after":M,basis:T,"basis-open":function(t){if(t.length<4)return v(t);for(var e,i=[],a=-1,n=t.length,r=[0],s=[0];++a<3;)e=t[a],r.push(e[0]),s.push(e[1]);for(i.push(b(Y,r)+","+b(Y,s)),--a;++a<n;)e=t[a],r.shift(),r.push(e[0]),s.shift(),s.push(e[1]),x(i,r,s);return i.join("")},"basis-closed":function(t){for(var e,i,a=-1,n=t.length,r=n+4,s=[],o=[];++a<4;)i=t[a%n],s.push(i[0]),o.push(i[1]);for(e=[b(Y,s),",",b(Y,o)],--a;++a<r;)i=t[a%n],s.shift(),s.push(i[0]),o.shift(),o.push(i[1]),x(e,s,o);return e.join("")},bundle:function(t,e){var i=t.length-1;if(i)for(var a,n,r=t[0][0],s=t[0][1],o=t[i][0]-r,l=t[i][1]-s,c=-1;++c<=i;)a=t[c],n=c/i,a[0]=e*a[0]+(1-e)*(r+n*o),a[1]=e*a[1]+(1-e)*(s+n*l);return T(t)},cardinal:function(t,e){return t.length<3?v(t):t[0]+F(t,_(t,e))},"cardinal-open":function(t,e){return t.length<4?v(t):t[1]+F(t.slice(1,-1),_(t,e))},"cardinal-closed":function(t,e){return t.length<3?v(t):t[0]+F((t.push(t[0]),t),_([t[t.length-2]].concat(t,[t[1]]),e))},monotone:function(t){return t.length<3?v(t):t[0]+F(t,E(t))}});W.forEach(function(t,e){e.key=t,e.closed=/-closed$/.test(t)});var z=[0,2/3,1/3,0],j=[0,1/3,2/3,0],Y=[0,1/6,2/3,1/6];return H.line.radial=function(){var t=g(A);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},y.reverse=M,M.reverse=y,H.area=function(){return X(n)},H.area.radial=function(){var t=X(A);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},H.diagonal=function(){function t(t,n){var r=e.call(this,t,n),s=i.call(this,t,n),o=(r.y+s.y)/2,l=[r,{x:r.x,y:o},{x:s.x,y:o},s];return"M"+(l=l.map(a))[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var e=S,i=I,a=k;return t.source=function(i){return arguments.length?(e=m(i),t):e},t.target=function(e){return arguments.length?(i=m(e),t):i},t.projection=function(e){return arguments.length?(a=e,t):a},t},H.getMarkerPath=function(t,e){switch(t){case U.CIRCLE:case U.CIRCLE_HOLLOW:return H.arc().outerRadius(e)({startAngle:0,endAngle:2*Math.PI});case U.SQUARE:case U.SQUARE_HOLLOW:return"M"+-e+","+-e+"L"+e+","+-e+"L"+e+","+e+"L"+-e+","+e+"Z";case U.DIAMOND:case U.DIAMOND_HOLLOW:return"M"+(a=-(e=2*e/Math.sqrt(2))+",0")+"L"+(n="0,"+-e)+"L"+(r=e+",0")+"L0,"+e+"Z";case U.TRIANGLE:case U.TRIANGLE_HOLLOW:var i=Math.sqrt(3),a=-2*e/i+","+e,n="0,"+-e,r=2*e/i+","+e;return"M"+a+"L"+n+"L"+r+"Z";case U.STAR:for(var s=D(e*=1.4),o="",l=-1;++l<5;){var c=l*L(72),h=c+L(36),u=O(c,e,3),d=O(h,s,3);o+=(l?"L":"M")+u[0]+","+u[1],o+="L"+d[0]+","+d[1]}return o+="z"}},H}),define("vector/Cut",["require","../utils/BezierEasing"],function(t){var e=t("../utils/BezierEasing"),i=function(t,e){return function(i){return+t+(+e-+t)*i}},a=function(t,e,a){var n=i(t[e],a);return function(i){t[e]=n(i)}},n=function(t){if(!t)throw'animation "targets" empty';null==t.length?this.targets=[t]:this.targets=t,this._needsRemove=!1,this._lastSectionTime=null,this._sections=[],this.onend=null};return n.prototype={step:function(t){this._lastSectionTime||(this._lastSectionTime=t);var e=t-this._lastSectionTime,i=this.targets,a=this._sections[0],n=Math.min(e/a.time,1);if(!(!n>0)){a.easing&&(n=a.easing(n));for(var r=a.tweens,s=i.length,o=0;o<s;o++)for(var l in r)r.hasOwnProperty(l)&&r[l][o](n);return 1===n&&(this._lastSectionTime=t,this._sections.shift(),0===this._sections.length)?(this._needsRemove=!0,"end"):void 0}},_fillTweens:function(t){return this.targets.map(function(e,i){return t(e,i)})},delay:function(t){return this._sections.push({time:t,tweens:{}}),this},duration:function(t){return this._sections.push({time:t,tweens:{}}),this},tween:function(t,e){var i=this._sections.length;return this._sections[i-1].tweens[t]="function"==typeof e?this._fillTweens(e):this._fillTweens(function(i,n){return a(i,t,e)}),this},attrTween:function(t,e){return this.tween("attr"+t,function(i,a){var n=+i.getAttribute(t),r=e(i,a,n);return function(e){i.setAttribute(t,r(e))}}),this},attr:function(t,e){return this.attrTween(t,function(t,a,n){return"function"==typeof e?i(n,e.call(null,t,a,n)):i(n,e)}),this},end:function(t){return this.onend=t,this},stop:function(){return this._needsRemove=!0,this},ease:function(t){var i=this._sections.length;return this._sections[i-1].easing="string"==typeof t?e.css[t]:t,this}},n}),define("vector/Animation",["require","./Cut"],function(t){var e=t("./Cut"),i=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){setTimeout(t,16)},a=function(){this._initTime=null,this._running=!1,this._cuts=[],this._callback=[],this.onframe=null,this.onend=null};return a.prototype={_update:function(){var t=(new Date).getTime(),e=this._cuts,i=e.length;if(!e.length)return!1;for(r=0;r<i;)e[r]._needsRemove?(e[r]=e[i-1],e.pop(),i--):r++;for(r=0;r<i;r++){var a=e[r].step(t);a&&e[r]["on"+a]&&this._callback.push(e[r]["on"+a])}this.onframe&&this.onframe();for(var n,r=-1;n=this._callback[++r];)n();return this._callback=[],!0},_startLoop:function(){function t(){e._running&&(e._running=e._update(),i(t))}var e=this;i(t)},frame:function(t){return this.onframe=t,this},start:function(){return this._running||(this._running=!0,this._startLoop()),this},stop:function(){return this._running=!1,this},clear:function(){return this._running=!1,this._cuts=[],this},animate:function(t){var i=new e(t);return i.animation=this,this._cuts.push(i),this.start(),i}},a}),define("vector/shape/Arc",["require","../../utils/BaseUtils","../../dom/Browser"],function(t){var e=t("../../utils/BaseUtils"),i=t("../../dom/Browser").touch?10:2,a=2*Math.PI,n=Math.max,r=Math.atan2,s=Math.abs,o=Math.sqrt,l=e.normalRadian,c=function(t){this.renderer=t,this.ctx=t.ctx,this.cut=null,this.style={ox:null,oy:null,r:null,startAngle:null,endAngle:null,lineWidth:null,color:null,fillStyle:"rgba(0, 0, 0, 0)"}};return c.prototype={setStyle:function(t){for(var e in this.style)t.hasOwnProperty(e)&&(this.style[e]=t[e]);return this},drawStyle:function(){var t=this.ctx,e=this.style;return(e.lineWidth&&e.lineWidth!==t.lineWidth||e.color&&e.color!==t.strokeStyle)&&(t.stroke(),t.beginPath(),t.lineWidth=e.lineWidth,t.strokeStyle=e.color),e.fillStyle&&e.fillStyle!==t.fillStyle&&(t.fill(),t.fillStyle=e.fillStyle),this},draw:function(){var t=this.ctx,e=this.style;return e.lineWidth?(t.moveTo(e.ox+e.r*Math.cos(e.startAngle),e.oy+e.r*Math.sin(e.startAngle)),t.arc(e.ox,e.oy,e.r,e.startAngle,e.endAngle),this):this},animate:function(){return this.cut||(this.cut=this.renderer.animation.animate(this.style)),this},delay:function(t){return this.cut.delay(t),this},duration:function(t){return this.cut.duration(t),this},tween:function(t,e){return this.cut.tween(t,e),this},end:function(t){return this.cut.end(t),this},stop:function(){return this.cut.stop(),this},ease:function(t){return this.cut.ease(t),this},remove:function(){this.cut&&this.cut.stop(),this.needToRemove=!0},contain:function(t){var e=t.x,c=t.y,h=this.style,u=n(h.lineWidth,i),d=e-h.ox,p=c-h.oy;return!(s(o(d*d+p*p)-h.r)>u)&&(l(r(p,d))+a-h.startAngle)%a<=h.endAngle-h.startAngle}},c}),define("vector/shape/Circle",["require"],function(t){var e=2*Math.PI,i=function(t){this.renderer=t,this.ctx=t.ctx,this.cut=null,this.style={ox:null,oy:null,r:null,lineWidth:null,strokeStyle:null,fillStyle:null}};return i.prototype={setStyle:function(t){for(var e in this.style)t.hasOwnProperty(e)&&(this.style[e]=t[e]);return this},drawStyle:function(){var t=this.ctx,e=this.renderer,i=this.style;return(i.lineWidth&&i.lineWidth!==t.lineWidth||i.strokeStyle&&i.strokeStyle!==t.strokeStyle)&&(t.stroke(),t.lineWidth=i.lineWidth,t.strokeStyle=i.strokeStyle),i.fillStyle&&i.fillStyle!==e.fillStyle&&(t.fill(),t.beginPath(),t.fillStyle=i.fillStyle,e.fillStyle=i.fillStyle),this},draw:function(){var t=this.ctx,i=this.style;return t.moveTo(i.r+i.ox,i.oy),t.arc(i.ox,i.oy,i.r,0,e),this}},i}),define("vector/shape/Image",["require"],function(t){var e=function(t){this.renderer=t,this.ctx=t.ctx,this.cut=null,this.style={imagedata:null,dx:null,dy:null,dirtyX:null,dirtyY:null,dirtyWidth:null,dirtyHeight:null}};return e.prototype={setStyle:function(t){for(var e in this.style)t.hasOwnProperty(e)&&(this.style[e]=t[e]);return this},drawStyle:function(){return this},draw:function(){var t=this.style;return this.ctx.putImageData(t.imagedata,t.dx,t.dy),this}},e}),define("vector/CanvasRenderer",["require","./Renderer","../Constants","./Animation","./shape/Arc","./shape/Circle","./shape/Image","./ElementWrapper"],function(t){var e=t("./Renderer"),i=t("../Constants"),a=t("./Animation"),n=t("./shape/Arc"),r=t("./shape/Circle"),s=t("./shape/Image"),o=t("./ElementWrapper"),l=["lineWidth","strokeStyle"];return e.extend({_initContainer:function(){var t=this.dom,e=this.vanchart,i=this.config,n=i||e.bounds,r=i&&i.dpr||1;this._container=new o(this._createCanvas(t,n,r),this),this.ctx=this._container.node().getContext("2d"),this.ctx.scale(r,r),this.elements=[],this.animation=(new a).frame(this.flush.bind(this))},arc:function(t){return this._create(n,t)},circle:function(t){return this._create(r,t)},image:function(t){return this._create(s,t)},_create:function(t,e){var i=new t(this);return i.rawElement=i,this.elements.push(i),e&&i.setStyle(e),i},style:function(){},_createCanvas:function(t,e,i){var a=document.createElement(window.VAN_CANVAS),n=this.left=e.x,r=this.top=e.y,s=this.width=e.width,o=this.height=e.height;return this.dpr=i,a.style.position="absolute",a.style.left=n+"px",a.style.top=r+"px",a.style.width=s+"px",a.style.height=o+"px",a.width=s*i,a.height=o*i,a.onselectstart=function(){return!1},a.style["-webkit-user-select"]="none",a.style["user-select"]="none",a.style["pointer-events"]="none",a.style["-webkit-touch-callout"]="none",a.style.transform="translateZ(0)",t.appendChild(a),window.VanCanvasManager&&VanCanvasManager.initElement(a),a},flush:function(){this.clearAll(),this.ctx.beginPath();for(var t=this.elements,e=t.length,i=[],a=0;a<e;a++)t[a].needToRemove||(i.push(t[a]),t[a].drawStyle().draw());this.elements=i,this.ctx.stroke(),this.ctx.fill()},_updateCtxStatus:function(){for(var t,e,i=-1;t=l[++i];)this[t]!==this.ctx[t]&&(this[t]=this.ctx[t],e=!0);e&&this.ctx.stroke(),this.fillStyle!==this.ctx.fillStyle&&(this.fillStyle=this.ctx.fillStyle,this.ctx.fill())},clearAll:function(){this.ctx.clearRect(0,0,this.width,this.height)},remove:function(){this.animation.clear(),this.ctx=null,this._container.remove()},addBubbleSeries:function(t){var e=this.ctx;e.save();for(var i=0,a=t.points.length;i<a;i++){var n=t.points[i];n.visible&&!n.isNull&&(e.fillStyle=n.color,e.globalAlpha=this.getPointOpacity(n),e.beginPath(),e.arc(n.posX,n.posY,n.radius,0,2*Math.PI),e.fill())}e.restore()},getPointOpacity:function(t){var e=t.series,i=e.vanchart.highlightTarget;return i?e.name==i||t._rangeItem==i?1:.3:t.opacity},addScatterSeries:function(t){var e=this.ctx;e.save();for(var i=0,a=t.points.length;i<a;i++){var n=t.points[i];if(n.visible&&!n.isNull){var r=n.options.marker,s=r.symbol,o=isNaN(r.radius)?4.5:r.radius,l=r.fillColor||n.color;e.translate(n.posX,n.posY),e.fillStyle=l,e.strokeStyle=l,e.globalAlpha=this.getPointOpacity(n),this._drawMarker(e,s,o),e.translate(-n.posX,-n.posY)}}e.restore()},addSeries:function(t){t.visible&&(t.type==i.SCATTER_CHART?this.addScatterSeries(t):this.addBubbleSeries(t))},_drawMarker:function(t,e,a){-1!=e.indexOf(i.CIRCLE)?(t.beginPath(),t.arc(0,0,a,0,2*Math.PI)):-1!=e.indexOf(i.SQUARE)?(t.beginPath(),t.moveTo(-a,-a),t.lineTo(a,-a),t.lineTo(a,a),t.lineTo(-a,a),t.closePath()):-1!=e.indexOf(i.DIAMOND)?(a=2*a/Math.sqrt(2),t.beginPath(),t.moveTo(-a,0),t.lineTo(0,-a),t.lineTo(a,0),t.lineTo(0,a),t.closePath()):-1!=e.indexOf(i.TRIANGLE)?(t.beginPath(),t.moveTo(-a,a/Math.sqrt(3)),t.lineTo(0,-2*Math.sqrt(3)/3*a),t.lineTo(a,a/Math.sqrt(3)),t.closePath()):(t.beginPath(),t.arc(0,0,a,0,2*Math.PI)),-1==e.indexOf("hollow")?t.fill():(t.fillStyle="white",t.lineWidth=2,t.fill(),t.stroke())}})}),define("chart/Series",["require","../utils/BaseUtils","../utils/QueryUtils","../utils/ColorUtils","../Constants","./Point","../dom/Evented","../utils/BezierEasing","../utils/PathGenerator","../ComponentLibrary","../vector/CanvasRenderer","../component/FormattedText","../utils/Timer"],function(t){var e=t("../utils/BaseUtils"),i=t("../utils/QueryUtils"),a=t("../utils/ColorUtils"),n=t("../Constants"),r=t("./Point"),s=t("../dom/Evented"),o=t("../utils/BezierEasing"),l=t("../utils/PathGenerator"),c=(t("../ComponentLibrary"),t("../vector/CanvasRenderer")),h=t("../component/FormattedText"),u=(t("../utils/Timer"),s.extend({initialize:function(t,e,i){this.vanchart=e,this.points=[],this.refresh(t,i)},refresh:function(t,r){var s=this.vanchart,o=t.type||s.options.chartType,l=s.options.plotOptions,c=[t,l[o],l];this.minSize=i.queryList(c,"minSize"),this.maxSize=i.queryList(c,"maxSize"),this.originalColor=t.color,this.originalMarkerFillColor=t.marker&&t.marker.fillColor,this.interpolate=this._getSeriesInterpolate(c),t=this.options=e.createOptions(t,[l[o],l]),this.type=o,this.stack=t.stack,this.index=r,this.className="vancharts-series-"+r,this.name=e.pick(t.name,"Series"+r),this.visible=e.pick(t.visible,!0),this.state=this.visible?n.STATE_SHOW:n.STATE_DROPPED;var h;if(!this.isSeriesAccumulated()&&this.type!=n.STRUCTURE_CHART){var u=this.options.color||s.getDefaultSeriesColor(this.name),d=t.opacity;u=(h=a.getStandardColorAndOpacity(u,d)).hex,d=h.alpha;var p=this.options.fillColor;p=!0===p?u:p;var f=+t.fillColorOpacity;f=isNaN(f)?this._getDefaultFillColorOpacity():f,p=(h=a.getStandardColorAndOpacity(p,f)).hex,f=h.alpha;var m=t.marker=e.clone(t.marker);if(e.hasDefined(m)){var g=this._getMarkerColorAlpha();m.fillColor=g.markerColor,m.fillColorOpacity=g.markerOpacity,this.type==n.SCATTER_CHART&&e.isNullMarker(m)&&(t.marker.symbol=e.getDefaultMarkerSymbol(r))}this.color=u,this.opacity=d,this.fillColor=p,this.fillColorOpacity=f,this.marker=m}if(e.hasDefined(this.options.startAngle)){var v=this.options.startAngle,y=this.options.endAngle;v>y?v-=360:v===y&&(y=v+360),this.startAngle=e.toRadian(v),this.endAngle=e.toRadian(y)}if(this._bindAxis(),this._loadData)M=this._loadData(t.data);else var M=t.data||[];return this.isTreeSeries()||this._dealData(M),this},_dealData:function(t){var e=[],i=this,a={},n=this.vanchart,s=this.type;this.points.forEach(function(t){var e=i._getPointKey(t);a[e]=a[e]||[],a[e].push(t)});for(var o=0,l=t.length;o<l;o++){var c=i._getPointKey(t[o]),h=a[c],u=null;if(h){for(var d=0,p=h.length;d<p;d++)if(u=h[d]){h[d]=null;break}u&&(u._lastValue=u.options[i.getTargetKey()],u.drillSeries=null,u.geo=null,u.moreLabelG&&u.moreLabelG.remove(),u.moreLabelG=null,u.refresh(t[o]))}u||(u=new r(t[o],this)),e.push(u)}for(var c in a)a[c]&&a[c].forEach(function(t){n.removePointGraphics(t,s)});this.options.sort&&(e=e.filter(function(t){return!t.isNull}).sort(function(t,e){return Math.abs(e.getTargetValue())-Math.abs(t.getTargetValue())})),this.points=e},_getPointKey:function(t){return t.x},_getDefaultFillColorOpacity:function(){return 1},getStackAxis:function(){return this[this.getTargetKey()+"Axis"]},isNullValue:function(t){var i=t.options[t.series.getTargetKey()];return"-"==i||e.hasNotDefined(i)},_getMarkerColorAlpha:function(){var t=this.vanchart,i=this.options,n=t.options.plotOptions,r=n[this.type],s=r&&r.marker||n.marker,o=i.opacity,l=i.marker,c=l&&l.fillColor||this.options.color||s&&s.fillColor||t.getDefaultSeriesColor(this.name),h=o;if(e.hasDefined(c)){var u=a.getStandardColorAndOpacity(c,o);c=u.hex,h=u.alpha}return{markerColor:c,markerOpacity:h}},_bindAxis:function(){var t=this,e=t.options,i=t.vanchart;t._getAxisTypes().forEach(function(a){if(i[a]){var n=i[a](e[a]);n&&(n.series.push(t),t[a]=n)}})},supportTooltipShared:function(){return this.xAxis||this.yAxis||this.angleAxis},_getAxisTypes:function(){return["xAxis","yAxis"]},getTargetKey:function(){return"y"},getBaseAxisType:function(){return"xAxis"},_calculateAutoLabelPos:function(t,i,a,n){function r(t,a,r,s){for(var o=t;r<0?o>a:o<a;o+=r){var l={x:i.x,y:o};if(!n.isOverlapped(e.makeBounds(l,s)))return l}}function s(t,a,r,s){for(var o=t;r<0?o>a:o<a;o+=r){var l={x:o,y:i.y};if(!n.isOverlapped(e.makeBounds(l,s)))return l}}var o,l=t.labelDim,c=this.vanchart.bounds;if(a){var h,u;(o=r(h=Math.max(0,i.y),u=c.height-l.height,3,l))||(u=0,h=Math.min(i.y,c.height-l.height),o=r(h,u,-3,l))}else{var d,p;(o=s(d=Math.max(0,i.x),p=c.width-l.width,3,l))||(p=0,d=Math.min(i.x,c.width-l.width),o=s(d,p,-3,l))}return o||i},_getArcPoint:function(t,e){return[this._dealWithFloat(t*Math.sin(e)),this._dealWithFloat(-t*Math.cos(e))]},_getNormalTrendLineXYValues:function(t){var e=[],i=[],a=this.vanchart.isInverted()?"posY":"posX",r=this.vanchart.isInverted()?n.LEFT:n.BOTTOM;return t.points.sort(function(t,e){return t[a]-e[a]}),t.points.forEach(function(t){t.isNull||(e.push(t.posX),i.push(t.posY))}),[e,i,r]},_getSeriesInterpolate:function(t){var e=i.queryList(t,"step"),a=i.queryList(t,"curve"),n=t[0],r="linear";return n.step||e&&!n.curve?r="step-after":(n.curve||a&&!n.step)&&(r="cardinal"),r},_getAngle:function(t,e){return e=e||{x:0,y:0},Math.atan2(t.y-e.y,t.x-e.x)/(Math.PI/180)},_getBackgroundColor:function(){var t=this.vanchart.options,e="string"==typeof t.plotBackgroundColor,i="string"==typeof t.backgroundColor,n=e?t.plotBackgroundColor:i?t.backgroundColor:"white";return a.colorToHex(n)},getSeryTotalValue:function(){var t=0;return this.points.forEach(function(e){t+=e.getTargetValue()}),t},getLegendKey:function(t){return this.isSeriesAccumulated()?t.name:this.name},calculateLabelInfo:function(t){h.dataLabelGenerator(t)},_getPercentValue:function(t,e){return t?(-1!=(t+="").indexOf("%")&&(t=parseFloat(t)*e/100),parseFloat(t)):0},isSupportLegendHighlight:function(){return!0},isSeriesAccumulated:function(){return!1},isTreeSeries:function(){return!1}}));return u.include({getClosestPoint:function(){return null},getTooltipPos:function(t,e,i){var a;if(t.options.tooltip.follow){var n=i.containerPoint;a=[n.x+10,n.y+10]}else a=this._getFixedPos(t,e);if(a){var r=this.vanchart.getChartBounds(),s=r.y,o=r.x,l=r.y+r.height,c=r.x+r.width,h=a[0],u=a[1];return h<o?h+=o-h:h+e.width>c&&(h-=h+e.width-c),u<s?u+=s-u:u+e.height>l&&(u-=u+e.height-l),[h,u]}},getFillFilter:function(t){return t},filterRender:function(){this.useCanvas()?this._canvasRender():this._svgFilterRender()},render:function(){this.useCanvas()?this._canvasRender():this._svgRender()},useCanvas:e.falseFn,_createGroup:function(t,e){return t.group().addTo(e.clipSeriesGroup)},_svgRender:function(){this.initialAnimationMoving=!this.group;var t=this.vanchart,i=t.renderer;this.group||(this.group=this._createGroup(i,t).style("cursor",this._pointerStyle()).attr("transform",e.makeTranslate(this._getTranslate())).attr("class",this.className+" "+this.type)),this.type==n.GAUGE_CHART?this.group.animate({duration:600,ease:"quad-out",attr:{transform:e.makeTranslate(this._getTranslate())}}):this.group.attr("transform",e.makeTranslate(this._getTranslate())),this.drawSeries&&this.drawSeries(),this.drawPoints()},_svgFilterRender:function(){var t=this;t.getDataToDraw().forEach(function(e){e.isVisible()?(e.graphic&&e.graphic.style({display:"inline"}),e.textGraphic||t._createTextGraphic(e),e.effectGraphic||t.drawPointEffect(e)):(e.graphic&&e.graphic.style({display:"none"}),e.textGraphic&&e.textGraphic.remove(),e.textGraphic=null,e.clearPointEffect())})},_canvasRender:function(){this._canvas||(this._canvas=new c(this.vanchart.dom,this.vanchart),this._canvas.onAdd()),this._canvas.clearAll(),this._canvas.addSeries(this)},_pointerStyle:function(){return this.points[0]&&this.points[0].options.click?"pointer":""},getDataToDraw:function(){return this.points},getTextDataToDraw:function(){return this.getDataToDraw()},updatePointGraphic:function(t){},_updateMarkerPointGraphic:function(t){var i=t.graphic,a=t.options.marker,n=a.symbol;i&&(e.isImageMarker(n)&&!i.image?(i.strokePath&&i.strokePath.remove(),i.fillPath&&i.fillPath.remove(),i.markerPath&&i.markerPath.remove(),i.strokePath=i.fillPath=i.markerPath=null,this._createMarker(a,i)):!e.isImageMarker(n)&&i.image&&(i.image&&i.image.remove(),i.image=null,this._createMarker(a,i)))},drawPoints:function(){var t=this,e=t.vanchart,i=this._getPointGraphicGroup();e.registerInteractiveTarget(this,i),this.initialAnimationMoving&&this.initialAnimation&&this.initialAnimation();for(var a=this._calculateAnimationDelay(),n=t.getDataToDraw(),r=0,s=n.length;r<s;r++)t.drawPoint(n[r],a)},_drawEffectPoints:function(){var t=this;t.getTextDataToDraw().forEach(function(e){t.drawPointEffect(e)})},drawPointEffect:function(t){var e=t.series;t.clearPointEffect();var i=t.getEffectTime();i&&(e.effectAnimation(t),t.effectInterval=setInterval(function(){e.effectAnimation(t)},i))},effectAnimation:function(){},_drawUpdatePoints:function(t,e){this._updatePointGraphicStyle(t),t.graphic.animate(this.getPointUpdateAnimationAttr(t,e)),this.vanchart.registerInteractiveTarget(t,t.graphic)},_drawEnterPoints:function(t){var e=this,i=e._getPointGraphicGroup(),a=t.graphic=this._createPointGraphic(t);e._updatePointGraphicStyle(t);var n=e.getPointInitAttr&&e.getPointInitAttr(t),r=e.getPointInitStyle&&e.getPointInitStyle(t);t.hasEffect()?a.addTo(i):a.addToBack(i),a.attr(n||{}).style(r||{}).animate(e.getPointInitAnimationAttr(t)),e.vanchart.registerInteractiveTarget(t,a)},_drawExitPoints:function(t){var e=t.series;e.getPointDropAnimationAttr?t.graphic.animate(e.getPointDropAnimationAttr(t)).remove():t.graphic.remove()},drawPoint:function(t,e){e=e||0;var i=t.isVisible(),a=t.graphic&&t.graphic.isVisible();i===a?t.graphic&&this._drawUpdatePoints(t,e):i&&!a?t.graphic&&!t.graphic.removed()?(t.graphic.style("display","inline"),this._drawUpdatePoints(t,e)):this._drawEnterPoints(t):!i&&a&&this._drawExitPoints(t)},_getEffectTime:function(t){return isNaN(t.options.effect.period)?t.series.getDefaultEffectTime():t.options.effect.period},_getPointEffectGroup:function(t){var e=t.series,i=e.vanchart.renderer;return t.effectGraphic=t.effectGraphic||i.group().addTo(e._getPointGraphicGroup()).style("pointer-events","none")},_createPointGraphic:function(t){var e=this.getPointGraphicKey(t);return this.vanchart.renderer[e]()},getStyle:function(t){var e=t.options;return{fill:t.series.getFillFilter(t.color,t),"fill-opacity":e.image?1:t.opacity,stroke:t.borderColor,"stroke-opacity":t.borderOpacity,"stroke-width":e.borderWidth,filter:"none"}},_getDynamicStyle:function(t){var e=this.getStyle(t),i=this.vanchart.highlightTarget;if(null!=i&&this.isSupportLegendHighlight()){var a=this.getLegendKey(t)==i||t._rangeItem==i?1:.3;e["fill-opacity"]=e["stroke-opacity"]=a}return e},_updatePointGraphicStyle:function(t,e){e=e||t.series._getDynamicStyle(t),t.graphic&&t.graphic.style(e)},_createMarker:function(t,i){var a=t.symbol,r=t.radius,s=this.vanchart.renderer,i=i||s.group();if(e.isImageMarker(a)){var o=t.width,c=t.height;i.image=s.image({preserveAspectRatio:"none",x:-o/2,y:-c/2,width:o,height:c}).imageContent(a).addTo(i)}else{var h=this._isHollowMarker(a),u=this.type==n.LINE_CHART;h&&u?(i.strokePath=s.path({d:l.getMarkerPath(a,r+2)}).addTo(i),i.fillPath=s.path({d:l.getMarkerPath(a,r-1)}).addTo(i)):i.markerPath=s.path({d:l.getMarkerPath(a,r)}).addTo(i)}return i},_updateMarker:function(t,i,a){i=i||t.graphic;var r=(a=a||t.options.marker).fillColorOpacity,s=this.vanchart.highlightTarget;s&&(r=this.getLegendKey(t)==s||t._rangeItem==s?1:.3);var o=a.symbol,l=this._getBackgroundColor();if(e.isImageMarker(o));else{var c=this._isHollowMarker(o),h=this.type==n.LINE_CHART;c&&h?(i.strokePath.style({fill:a.fillColor,"fill-opacity":r,stroke:l,"stroke-width":2}),i.fillPath.style({fill:l})):c?i.markerPath.style({stroke:a.fillColor,"stroke-opacity":r,"stroke-width":2,fill:l}):h?i.markerPath.style({fill:a.fillColor,"fill-opacity":r,"stroke-width":2,stroke:l}):i.markerPath.style({fill:a.fillColor,"fill-opacity":r})}},_onMarkerPressed:function(t){if(t.graphic){var i=t.options.marker.symbol,a=(t.series,{fill:t.clickColor,"fill-opacity":t.clickOpacity});if(!e.isImageMarker(i)){var r=this._isHollowMarker(i),s=this.type==n.LINE_CHART;r&&s?t.graphic.strokePath.style(a):t.graphic.markerPath.style(a)}}},_onMarkerMouseOver:function(t){if(t.graphic){var i=(h=t.options.marker).symbol,a=(t.series.animation,h.radius+2);if(e.isImageMarker(i)){var r=h.width+4,s=h.height+4;t.graphic.image.attr({x:-r/2,y:-s/2,width:r,height:s})}else{var o=this._isHollowMarker(i),c=this.type==n.LINE_CHART;o&&c?(t.graphic.strokePath.attr({d:l.getMarkerPath(i,a+2)}),t.graphic.fillPath.attr({d:l.getMarkerPath(i,a-1)})):t.graphic.markerPath.attr({d:l.getMarkerPath(i,a)})}}else{var h=this._getDefaultMarker(t);t.series.vanchart.renderer,t.series.defaultMarker=t.series.defaultMarker||this._createMarker(h).addTo(this.group),t.series.defaultMarker.attr("transform",e.makeTranslate([t.posX,t.posY])),this._updateMarker(t,t.series.defaultMarker,h)}},_onMarkerMouseOut:function(t){var i=t.options.marker,a=i.symbol,r=(t.series.animation,i.radius);if(t.graphic)if(e.isImageMarker(a)){var s=i.width,o=i.height;t.graphic.image.attr({x:-s/2,y:-o/2,width:s,height:o})}else{var c=this._isHollowMarker(a),h=this.type==n.LINE_CHART;c&&h?(t.graphic.strokePath.attr({d:l.getMarkerPath(a,r+2)}),t.graphic.fillPath.attr({d:l.getMarkerPath(a,r-1)})):t.graphic.markerPath.attr({d:l.getMarkerPath(a,r)})}},_getDefaultMarker:function(t){return{symbol:n.CIRCLE,fillColor:t.options.marker.fillColor,fillColorOpacity:t.options.marker.fillColorOpacity,radius:4.5,enabled:!0}},_calculateAnimationDelay:function(){return 0},_isHollowMarker:function(t){return t&&-1!=t.indexOf("hollow")},_animateEnd:function(){this._showLabels(),this._drawEffectPoints()},_showLabels:function(){var t=this,e=t.vanchart,i=0;e._needShowMoreLabel()&&(t.getTextDataToDraw().forEach(function(e){e.visible&&t._showAndExitMoreLabel(e)}),i=1e3),e.setTimeout(t.className+"more_label_animate",function(){e._removeChangeDataState(t),t._clearMoreLabels(),t._removeDataLabels(),t._updateDataLabels(),t._getPointTextLabelGroup().renderG.style({opacity:0}).transition().animate({transition:"linear",duration:400,style:{opacity:1}})},i)},_clearMoreLabels:function(){this.getTextDataToDraw().forEach(function(t){t.moreLabelG&&t.moreLabelG.remove(),t.moreLabelG=null})},_getMoreLabelStyle:function(){return this.vanchart.options.moreLabel.style||{fontFamily:"verdana",fontSize:"9pt"}},_showAndExitMoreLabel:function(t,i,n,r,s,l){if(0!==t.depth){var c=this,h=c.vanchart,u=h.renderer,d=t._lastValue||0,p=e.accAdd(t.options[c.getTargetKey()],-d),f=h.options.moreLabel,m=p<0?f.minusColor||"#f4b145":f.plusColor||"#52d1b8";if(p>0)p="+"+p;else if(!(p<0))return;var g=c._getMoreLabelStyle(),v=e.getTextDimension(p,g);if(e.hasNotDefined(i)||e.hasNotDefined(n)){var y=c._getMoreLabelDefaultCenter(t,v);i=y.centerX,n=y.centerY,e.hasDefined(t.labelPos)&&e.hasDefined(t.labelDim)&&(i=t.labelPos.x+t.labelDim.width/2,n=t.labelPos.y+t.labelDim.height/2)}r&&(i=r(i,v.width)),s&&(n=s(n,v.height)),t.moreLabelG=l||u.text().addTo(c.group),g["white-space"]="nowrap";var M=n-v.height/2;t.moreLabelG.textContent(p).attr({x:i-v.width/2,y:M+5,opacity:0}).style(g).style({color:a.colorToHex(m)}).animate({duration:250,ease:"back-out",attr:{y:M},attrTween:{opacity:function(){return function(t){return o.css.swing(t)}}},transition:{delay:500,duration:250,ease:"back-in",attr:{y:M+5},attrTween:{opacity:function(){return function(t){return 1-o.css.swing(t)}}}}})}},_getMoreLabelDefaultCenter:function(t,e){return{centerX:t.x+t.width/2,centerY:t.y-e.height/2}},_updateDataLabels:function(){var t=this;t.getTextDataToDraw().forEach(function(e){t._createTextGraphic(e)})},_removeDataLabels:function(){this.getTextDataToDraw().forEach(function(t){t.textGraphic&&(t.textGraphic.remove(),t.textGraphic=null),t.leadLine&&(t.leadLine.remove(),t.leadLine=null)})},_createTextGraphic:function(t){var i=this;if(t.hasValidDataLabel()){var a=i.vanchart.renderer,r=t.labelContent,s=t.labelPos.x,o=t.labelPos.y,l=t.options.dataLabels,c=l.useHtml,h=this._getPointTextLabelGroup(),u=a.vtext(c).attr("transform",e.makeTranslate([s,o])).style({"pointer-events":"none"});o=0;for(var d=0,p=r.length;d<p;d++){var f,m=r[d],g=m.dim,v=m.text,y=m.style;switch(t.options.dataLabels._align){case n.LEFT:f=0;break;case n.RIGHT:f=t.labelDim.width-g.width;break;case n.CENTER:default:f=(t.labelDim.width-g.width)/2}a.vtspan(c).style({width:l.labelWidth+"px",height:l.labelHeight+"px"}).attr("y",o).attr("x",0).attr("dy",.85*g.height).attr("dx",f).textContent(v).style(y).addTo(u),o+=g.height+2}t.textGraphic=h.append(u),t.labelPos.startPos&&(t.leadLine=h.append(this._getLeadLine(t)))}},_getLeadLine:function(t){return this.vanchart.renderer.path().attr("d",this._getLeadLinePath(t)).style({fill:"none",stroke:t.options.dataLabels.connectorColor||t.color,"stroke-width":t.options.dataLabels.connectorWidth||0})},_getLeadLinePath:function(t){var e=t.labelPos.startPos,i=t.labelPos.midPos,a=t.labelPos.endPos,n=this._dealWithFloat;return"M"+n(e.x)+","+n(e.y)+"L"+n(i.x)+","+n(i.y)+"L"+n(a.x)+","+n(a.y)},_dealWithFloat:function(t){return Math.abs(t)<1e-6?0:t},_getPointGraphicGroup:function(){return this.group},_getPointTextLabelGroup:function(){if(this.textGraphicGroup)this.textGraphicGroup.attr("transform",e.makeTranslate(this._getTranslate()));else{var t=this.vanchart,i=t.seriesTextRenderGroup,a=t.seriesTextDivGroup;this.textGraphicGroup=t.renderer.vgroup(),i.append(this.textGraphicGroup.renderG),a.append(this.textGraphicGroup.divG),this.textGraphicGroup.attr("transform",e.makeTranslate(this._getTranslate()))}return this.textGraphicGroup},_getTranslate:function(){return this.vanchart.bounds},getEvents:function(){return{mouseover:this._onSeriesMouseOver,mouseout:this._onSeriesMouseOut,pointMouseOver:this._onPointMouseOver,pointMouseOut:this._onPointMouseOut,tap:this._onSeriesTap}},_onSeriesMouseOver:function(t){var e=this,i=e.vanchart,a=i.hoverSeries,n=i.hoverPoint;a!=e&&(a&&a.fire("mouseout",t),i.hoverSeries=e);var r=e.getClosestPoint(t.containerPoint);r&&r!=n&&(n&&n.fire("mouseout",t),r._events||r.getEvents&&r.on(r.getEvents(),r),r.fire("mouseover",t))},_onSeriesTap:function(t){e.hasTouch()&&this.fire("mouseover",t)},getPressedStyle:function(){return null},onPointPress:function(){var t=this,e=t.series.getPressedStyle(t);e&&t.graphic.style(e)},onPointPressUp:function(){var t=this,e=t.series.getHighLightStyle(t);e&&t.graphic.style(e)},remove:function(){var t=this.vanchart;this.points.forEach(function(e){t.removePointGraphics(e,this.type)}),this._canvas&&this._canvas.remove(),this.textGraphicGroup&&this.textGraphicGroup.remove(),this.group&&this.group.remove(),this.textGraphicGroup=this._canvas=this.group=null}}),u}),define("chart/Bar",["require","../utils/BaseUtils","../utils/ColorUtils","../Constants","../utils/BezierEasing","./Series","../ComponentLibrary","../dom/Browser","../ChartLibrary","../ChartLibrary"],function(t){var e=t("../utils/BaseUtils"),i=t("../utils/ColorUtils"),a=t("../Constants"),n=t("../utils/BezierEasing"),r=t("./Series"),s=(t("../ComponentLibrary"),t("../dom/Browser"),r.extend({doLayout:function(){var t=this.getSeriesOffsetAndWidth(),i=this,n=i.vanchart,r=i.type==a.COLUMN_CHART,s=n.isInverted(),o="x",l="y";r||(o="y",l="x");var c=r&&!s||!r&&s,h=i[o+"Axis"],u=i[l+"Axis"],d=u.getZeroPos(),p=0;h.isOnZero()&&(p=h.options.lineWidth),this.points.forEach(function(a){var n=a.options,f=h.scale(h.getAxisValue(n[o],a)),m=u.scale(n[l+"0"]),g=u.getAxisValue(n[l],a)+n[l+"0"],v=u.scale(g-u.getStartPosValue());m===1/0&&(m=u.scale.range()[0]);var y,M,F,_;y=f+t.offset-t.width/2,M=Math.min(m,v),F=t.width,_=Math.abs(m-v),M===d?(M+=p/2,_-=p/2):M+_===d&&(_-=p/2),_=Math.max(_,0);var T={};c?(T.x=y,T.y=M,T.width=F,T.height=_):(T.x=M,T.y=y,T.width=_,T.height=F),a.rect=e.rectSubPixelOpt(T,n.borderWidth),a.rect.rx=a.rect.ry=a.options.borderRadius,a.isNull||i._calculateAnimationInitRect(a,r,s)})},getSeriesOffsetAndWidth:function(){var t=this,i=t.options,a=0,n={},r=0,s=0,o=this.vanchart.seriesOfType(this.type),l=this.getBaseAxisType();o.forEach(function(e){e[l]==t[l]&&e.visible&&(e.stack&&!n[e.stack]?(a++,n[e.stack]=!0,t.stack&&t.stack==e.stack&&(r=a-1)):e.stack||(a++,t==e&&(r=a-1))),e[l]==t[l]&&(s+=e.points.length)});var c=t[l],h=0,u=0;if(c.isCategory()){var d=i.categoryGap,p=i.gap,f=c.getTickLength();u=(d=e.getPercentValue(d,f))/2+(h=(f-d)/a)*(r+.5),h-=p=e.getPercentValue(p,h)}else{var m=c._getRange();h=(m=Math.abs(m[1]-m[0]))/s/3,u=0}return{width:e.hasDefined(i.width)?i.width:Math.max(h,2),offset:u}},_getPointKey:function(t){return this.type==a.BAR_CHART?t.y:t.x},getTargetKey:function(){return this.type==a.BAR_CHART?"x":"y"},getBaseAxisType:function(){return this.type==a.COLUMN_CHART?"xAxis":"yAxis"},getTrendLineXYValues:function(t){for(var e=[],i=[],n=t.points,r=t.type==a.COLUMN_CHART?t.yAxis:t.xAxis,s=t.type==a.COLUMN_CHART?t.xAxis:t.yAxis,o=s.isHorizontal(),l=r.isAxisReversed(),c=[],h=0,u=n.length;h<u;h++){var d=n[h];!d.isNull&&d.rect&&c.push(d.rect)}return c.sort(function(t,e){return o?t.x-e.x:t.y-e.y}),c.forEach(function(t){var a,n;o?(a=t.x+t.width/2,n=l?t.y+t.height:t.y):(a=l?t.x:t.x+t.width,n=t.y+t.height/2),e.push(a),i.push(n)}),[e,i,s.getPosition()]},_calculateAnimationInitRect:function(t,e,i){var n,r,s=e?"y":"x",o=t.options,l=t.series[s+"Axis"],c=l.getAxisValue(o[s],t),h=l.getStartPos(),u=c>=0;e&&!i||!e&&i?u^l.isAxisReversed()?(n=a.BOTTOM_TO_TOP,r={x:t.rect.x,y:h,width:t.rect.width,height:0}):(n=a.TOP_TO_BOTTOM,r={x:t.rect.x,y:t.rect.y,width:t.rect.width,height:0}):u^l.isAxisReversed()?(n=a.LEFT_TO_RIGHT,r={x:t.rect.x,y:t.rect.y,width:0,height:t.rect.height}):(n=a.RIGHT_TO_LEFT,r={x:t.rect.x+t.rect.width,y:t.rect.y,width:0,height:t.rect.height}),t.location=n,t.initRect=r},_calculateLabelPos:function(t){var i=this;i.points.filter(function(t){return t.visible}).forEach(function(n){var r=n.options.dataLabels;if(r&&r.enabled){var s;r.align&&(s=i._calculateAlignLabelPos(n,r.align));var o=n.location==a.TOP_TO_BOTTOM||n.location==a.BOTTOM_TO_TOP;r.autoAdjust&&(s=i._calculateAutoLabelPos(n,s,o,t)),s&&(n.labelPos=s,t.addBounds(e.makeBounds(n.labelPos,n.labelDim)))}})},_calculateAlignLabelPos:function(t,e){var i=t.labelDim,n=t.rect,r=this.vanchart.bounds,s=(r.width,r.height,t.location==a.TOP_TO_BOTTOM||t.location==a.BOTTOM_TO_TOP),o=t.location==a.BOTTOM_TO_TOP||t.location==a.LEFT_TO_RIGHT,l=n.x+n.width/2,c=n.y+n.height/2;if(i){var h,u;switch(e){case a.CENTER:h=l-i.width/2,u=c-i.height/2;break;case a.INSIDE:s?(h=l-i.width/2,u=o?n.y+3:n.y+n.height-3-i.height):(u=c-i.height/2,h=o?n.x+n.width-3-i.width:n.x+3);break;case a.OUTSIDE:s?(h=l-i.width/2,u=o?n.y-3-i.height:n.y+n.height+3):(u=c-i.height/2,h=o?n.x+n.width+3:n.x-3-i.width)}return{x:h,y:u}}},_getMoreLabelDefaultCenter:function(t,e){var i=this.type==a.COLUMN_CHART,n=this.vanchart.isInverted();return i&&!n||!i&&n?{centerX:t.rect.x+t.rect.width/2,centerY:t.rect.y-e.height/2}:{centerX:t.rect.x+t.rect.width+e.width/2,centerY:t.rect.y+t.rect.height/2}}}));return s.include({_getFixedPos:function(t,e){var i,n,r=this.vanchart.bounds,s=t.rect;return 0===t.initRect.height?(i=r.x+s.x+s.width+1,n=t.location==a.BOTTOM_TO_TOP?r.y+s.y:r.y+s.y+s.height):(n=r.y+s.y+s.height+1,i=t.location==a.LEFT_TO_RIGHT?r.x+s.x+s.width-e.width:r.x+s.x-e.width),[i,n]},getPointGraphicKey:function(){return"rect"},getFillFilter:function(t,n){if(e.isSupportSVG()){var r=this,s=n.options,o=r.vanchart,l=o.renderer;if(s.image){var c,h,u=n.rect;switch(n.location){case a.BOTTOM_TO_TOP:c=u.x,h=u.y+u.height%s.imageHeight;break;case a.TOP_TO_BOTTOM:case a.LEFT_TO_RIGHT:c=u.x,h=u.y;break;case a.RIGHT_TO_LEFT:c=u.x+u.width%s.imageWidth,h=u.y}var d={x:c,y:h,width:s.imageWidth,height:s.imageHeight,patternUnits:"userSpaceOnUse"},p={x:0,y:0,width:s.imageWidth,height:s.imageHeight};return n.imagePattern?l.updateImagePattern(n.imagePattern,d,p,n.options.image):n.imagePattern=l.imagePattern(d,p,n.options.image),"url(#"+e.stamp(n.imagePattern)+")"}if(o.options.style==a.STYLE_GRADUAL){var f,m,g,v;switch(f=m=g=v="0%",n.location){case a.BOTTOM_TO_TOP:m="100%";break;case a.TOP_TO_BOTTOM:v="100%";break;case a.LEFT_TO_RIGHT:g="100%";break;case a.RIGHT_TO_LEFT:f="100%"}var y={x1:f,y1:m,x2:g,y2:v},M={offset:"0%","stop-color":t},F={offset:"100%","stop-color":i.getColorWithDivider(t,.9)};return n.colorGradient?l.updateColorGradient(n.colorGradient,y,[M,F]):n.colorGradient=l.colorGradient(y,[M,F]),"url(#"+e.stamp(n.colorGradient)+")"}}return t},_calculateAnimationDelay:function(){if(this.stack)return 0;if(this.state==a.STATE_SHOW){for(var t=this.vanchart.seriesOfType(this.type),e=0,i=t.length;e<i;e++)if(t[e].state==a.STATE_TO_DROP)return 150}else if(this.state==a.STATE_TO_SHOW)return 250;return 0},getPointInitAttr:function(t){return t.initRect},getPointInitAnimationAttr:function(t){return{ease:n.css.swing,duration:400,attr:t.rect}},getPointUpdateAnimationAttr:function(t){return{ease:n.css.swing,duration:250,attr:t.rect}},getPointDropAnimationAttr:function(t){return{ease:n.css.swing,duration:150,attr:t.initRect}},_onPointMouseOver:function(t){var e=t.series.getHighLightStyle(t);t.graphic.interrupt(a.SELECT_ANIMATION).transition(a.SELECT_ANIMATION).animate({duration:100,ease:"ease-out-in",style:e})},_onPointMouseOut:function(t){var e=t.series.getStyle(t);t.graphic.interrupt(a.SELECT_ANIMATION).transition(a.SELECT_ANIMATION).animate({duration:100,ease:"ease-out-in",style:e})},effectAnimation:function(t){function e(){return l.rect().addTo(c).attr(h).style(u)}function i(t){return.5*d*t}function n(t){return t<0?0:t}function r(t,e,a){t.style(u).effectTransition().delay(e).ease("linear").duration(a).styleTween("stroke-opacity",function(){return function(t){return.8*(1-t)}}).styleTween("stroke-width",function(){return i}).attrTween("x",function(){return function(t){return h.x-i(t)/2+1}}).attrTween("y",function(){return function(t){return h.y-i(t)/2+1}}).attrTween("width",function(){return function(t){return n(h.width+i(t)-2)}}).attrTween("height",function(){return function(t){return n(h.height+i(t)-2)}})}var s=t.options,o=t.series,l=o.vanchart.renderer;if(!s.image){var c=o._getPointEffectGroup(t),h=t.rect,u={fill:"none",stroke:t.color,"stroke-opacity":0,"stroke-width":0},d=t.location===a.BOTTOM_TO_TOP||t.location===a.TOP_TO_BOTTOM?h.width:h.height,p=c.firstG=c.firstG||e(),f=c.secondG=c.secondG||e(),m=c.thirdG=c.thirdG||e(),g=o._getEffectTime(t)/o.getDefaultEffectTime();r(p,0,1600*g),r(f,600*g,1600*g),r(m,1200*g,1600*g)}},getDefaultEffectTime:function(){return 2800},getHighLightStyle:function(t){return{stroke:t.mouseOverColor,fill:t.series.getFillFilter(t.mouseOverColor,t),"fill-opacity":t.opacity,"stroke-width":6,"stroke-opacity":0===t.opacity?0:.35}},getPressedStyle:function(t){return{stroke:t.clickColor,fill:t.series.getFillFilter(t.clickColor,t),"fill-opacity":t.clickOpacity,"stroke-width":6,"stroke-opacity":0===t.opacity?0:.35}}}),t("../ChartLibrary").register(a.BAR_CHART,s),t("../ChartLibrary").register(a.COLUMN_CHART,s),s}),define("chart/PieSeries",["require","../utils/BaseUtils","./Series"],function(t){var e=t("../utils/BaseUtils"),i=t("./Series"),a=[.9,.85,.8,.75,.7,.65,.6,.55,.5],n=Math.PI/180;return{calcOutsideLabel:function(t,e,i,n){var r=this,s={};if(t.map(function(t){var e=r.getLocByArc(r.getCenterAngle(t));s[e]=s[e]||[],s[e].push(t)}),n)return s=r.ignoreMin(s,n),r.placeOutSideLabels(s,n),n;n=Math.min(i[0]-e.x,e.x+e.width-i[0],i[1]-e.y,e.y+e.height-i[1]);for(var o=0,l=a.length;o<l;o++){var c=n*a[o],h=r.ignoreMin(s,c);if(r.placeOutSideLabels(h,c),r.testWithinBounds(h,i,e))break}return c},calculateInsideLabelBounds:function(t){var e=this;t.map(function(i,a){var n=t[a],r=e.getCenterAngle(n),s=e._getInnerRadius(n),o=s+(e._getOuterRadius(n)-s)/2,l=e._getArcPoint(o,r),c=l[0]-n.labelDim.width/2,h=l[1]-n.labelDim.height/2;n.labelPos={x:c,y:h}})},calculateLeadLineStartPos:function(t){var e=this;t.map(function(t){var i=e._getOuterRadius(t),a=e.getCenterAngle(t);t.labelPos&&(t.labelPos.startPos={x:(i+1)*Math.sin(a),y:(i+1)*Math.cos(a+Math.PI)})})},getCenterAngle:function(t){var i=(this.chartInfo.rotate||0)+(this._getStartAngle(t)+this._getEndAngle(t))/2;return e.makeValueInRange(0,2*Math.PI,i)},getLocByArc:function(t){return(t%=2*Math.PI)<Math.PI/2?"right-top":t<Math.PI?"right-bottom":t<3*Math.PI/2?"left-bottom":"left-top"},ignoreMin:function(t,e){var i={};for(var a in t)t[a].map(function(t){t.labelPos=null}),i[a]=this._ignoreMinArcLabel(e,t[a]);return i},_ignoreMinArcLabel:function(t,e){for(var i=0,a=0,n=e.length;a<n;a++)i+=e[a].labelDim.height;if(1.2*t<i){var r=i-1.2*t;e.sort(function(t,e){return t.value-e.value});for(var a=0,n=e.length;a<n&&!(r<0);a++)r-=e[a].labelDim.height;e=e.slice(a,e.length)}var s=this;return e.sort(function(t,e){return s.getCenterAngle(t)-s.getCenterAngle(e)}),e},placeOutSideLabels:function(t,e){var i=this;Object.keys(t).map(function(a){i.findNiceBounds(!0,t[a],e,a)||i.findNiceBounds(!1,t[a],e,a)})},findNiceBounds:function(t,e,i,a){var r,s,o=1.2*i,l=.1*i,c=this._getStartAndEndAngle(a),h=t?c.endAngle:c.startAngle,u=t?n:-n;e.map(function(t){t.labelPos=null});for(var d=0,p=e.length;d<p;d++){for(var f=t?d:p-d-1,m=t?Math.max:Math.min,g=e[f],v=g.labelDim,y=this.getCenterAngle(g),M=!1,F=y=s?m(y,s):y;t?F<h:F>h;F+=u){var _=o*Math.sin(F),T=o*Math.cos(F+Math.PI),b=this._getLabelBounds(a,_,T,l,v);if(!r||!this._isOverlapOrShadow(r,b)){M=!0,s=F;break}}if(!M)return!1;var x,C={x:_,y:T};x="right-top"==a||"right-bottom"==a?{x:_+l,y:T}:{x:_-l,y:T},r=b,g.labelPos={x:b.x,y:b.y,midPos:C,endPos:x}}return!0},_getStartAndEndAngle:function(t){switch(t){case"right-top":return{startAngle:0,endAngle:Math.PI/2};case"right-bottom":return{startAngle:Math.PI/2,endAngle:Math.PI};case"left-bottom":return{startAngle:Math.PI,endAngle:3*Math.PI/2};case"left-top":return{startAngle:3*Math.PI/2,endAngle:2*Math.PI}}},_getLabelBounds:function(t,e,i,a,n){var r,s;return r="right-top"==t||"right-bottom"==t?e+a+2:e-a-2-n.width,s=i-n.height/2,{x:r,y:s,width:n.width,height:n.height}},_isOverlapOrShadow:function(t,i){var a=Math.max(t.y,i.y),n=Math.min(t.y+t.height/2,i.y+i.height/2),r=Math.max(t.y+t.height/2,i.y+i.height/2),s=Math.min(t.y+t.height,i.y+i.height);return e.rectangleOverlapped(t,i)||a<=n||r<=s},testWithinBounds:function(t,i,a){for(var n in t){var r,s,o,l,c;switch(s=o=0,n){case"right-top":case"right-bottom":o=a.y-i[1],l=a.width+a.x-i[0],c=a.height;break;case"left-bottom":case"left-top":s=a.x-i[0],o=a.y-i[1],l=-s,c=a.height}r={x:s,y:o,width:l,height:c};for(var h=0;h<t[n].length;h++){var u=t[n][h];if(u.labelPos){var d={x:u.labelPos.x,y:u.labelPos.y,width:u.labelDim.width,height:u.labelDim.height};if(!e.containsRect(r,d))return!1}}}return!0},_getInnerRadius:function(t){return t.innerRadius},_getOuterRadius:function(t){return t.outerRadius},_getStartAngle:function(t){return t.startAngle},_getEndAngle:function(t){return t.endAngle},_getPositionInPie:function(t){return{x:t.x-this.chartInfo.centerX,y:t.y-this.chartInfo.centerY}},_isRotatable:function(){return e.isSupportSVG()&&this.options.rotatable},onPanStart:function(t){this._isRotatable()&&(this.initPos=t.containerPoint,this.initRotate=e.toDegree(this.chartInfo.rotate))},onPanMove:function(t){if(this._isRotatable()){var i=this._getAngle(this._getPositionInPie(this.initPos)),a=this._getAngle(this._getPositionInPie(t.containerPoint))-i+this.initRotate;this.pathGroup.attr("transform","rotate("+a+")"),this.chartInfo.rotate=e.toRadian(a),this._calculateLabelPosWhenRadiusFixed(),this._rotateLabels()}},onPanEnd:function(t){this.vanchart.handler.panTarget=null},getEvents:function(){return e.extend(i.prototype.getEvents.call(this),{panstart:this.onPanStart,panmove:this.onPanMove,panend:this.onPanEnd})},_rotateLabels:function(){var t=this;t.vanchart.renderer,this.textLabelGroup,t.getDataToDraw().forEach(function(i){i.textGraphic&&!i.labelPos?(i.textGraphic.remove(),i.leadLine&&i.leadLine.remove(),i.textGraphic=null,i.leadLine=null):i.textGraphic&&i.labelPos?(i.textGraphic.attr("transform",e.makeTranslate(i.labelPos)),i.labelPos.startPos&&(i.leadLine?i.leadLine.attr("d",t._getLeadLinePath(i)):i.leadLine=t._getLeadLine(i))):!i.textGraphic&&i.labelPos&&t._createTextGraphic(i)})}}}),define("vector/shape/Path",["require","./../Layer","../../dom/Browser","../../utils/BaseUtils"],function(t){var e=t("./../Layer"),i=t("../../dom/Browser");return t("../../utils/BaseUtils"),e.extend({onAdd:function(){this._path=this._renderer.path().style(this.options),this._reset(),this._path.add()},onRemove:function(){this._path.remove()},redraw:function(){return this._map&&this._reset(),this},setStyle:function(t){return this.options=t||this.options,this._renderer&&this._path.style(this.options),this},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options["stroke-width"]?this.options["stroke-width"]/2:0)+(i.touch?10:0)},node:function(){return this._path.node()}})}),define("vector/shape/LayerGroup",["require","./../Layer","../../utils/BaseUtils"],function(t){var e=t("./../Layer"),i=t("../../utils/BaseUtils");return e.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;e<i;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){for(var t in this._layers)this.removeLayer(this._layers[t]);return this},invoke:function(t){var e,i,a=Array.prototype.slice.call(arguments,1);for(e in this._layers)(i=this._layers[e])[t]&&i[t].apply(i,a);return this},onAdd:function(t){for(var e in this._layers)t.addLayer(this._layers[e])},onRemove:function(t){for(var e in this._layers)t.removeLayer(this._layers[e])},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return i.stamp(t)}})}),define("EffectHelper",["require","./utils/BaseUtils","./utils/PathGenerator","./utils/BezierEasing","./vector/Transition","./vector/shape/Path","./vector/shape/LayerGroup"],function(t){function e(t,e,i){var a=t.series,n=a.vanchart.renderer;t.effectShadowFilter=t.effectShadowFilter||n.createDropShadowFilter(3,3,.75,5,91/255,91/255,91/255);var s="url(#"+r.stamp(t.effectShadowFilter)+")";return{period:a._getEffectTime(t),translate:isNaN(e)||isNaN(i)?"":r.makeTranslate({x:e,y:i}),firstTweenFun:function(){return function(e){return n.updateDropShadowFilter&&n.updateDropShadowFilter(t.effectShadowFilter,3*e,3*e,.75*e,5*e,91/255,91/255,91/255),s}},secondTweenFun:function(){return function(e){return n.updateDropShadowFilter&&n.updateDropShadowFilter(t.effectShadowFilter,3*(1-e),3*(1-e),.75*(1-e),5*(1-e),91/255,91/255,91/255),s}}}}function i(t,e,i){var a={"fill-opacity":0,stroke:"none",fill:t.color},r=s.arc().innerRadius(t.radius).startAngle(0).endAngle(360);n(t,{isMap:i,initStyle:a,pathFun:function(e){return r({outerRadius:t.radius+e*t.radius*1.5})},trans:e})}function a(t,e){var i=t.options.marker,a=i.radius,r={"fill-opacity":0,stroke:"none",fill:i.fillColor},o=s.arc().innerRadius(0).startAngle(0).endAngle(360);n(t,{isMap:e,initStyle:r,pathFun:function(t){return o({outerRadius:t*a*3.5})}})}function n(t,e){function i(t,i,a){t.style(u).effectTransition().delay(i).ease("linear").duration(a).styleTween("stroke-width",function(){return e.borderFun}).styleTween(e.opacityKey||"fill-opacity",function(){return function(t){return.3*(1-t)}}).attrTween("d",function(){return e.pathFun})}var a,n,s=t.series,o=s.vanchart,l=o.renderer,u=e.initStyle,d=e.trans||{x:t.posX,y:t.posY};if(e.isMap){var p=t.getLatLng(),f=o.latLngToLayerPoint(p);d=f,a=t.effectGraphic=t.effectGraphic||(new h).addTo(o.getEffectLayer()),n=function(){return(new c).addTo(a)._path.style(u).attr("transform",r.makeTranslate(d))}}else a=s._getPointEffectGroup(t).attr("transform",r.makeTranslate(d)),n=function(){return l.path().addTo(a).style(u)};var m=a.firstG=a.firstG||n(),g=a.secondG=a.secondG||n(),v=a.thirdG=a.thirdG||n(),y=s._getEffectTime(t)/s.getDefaultEffectTime();i(m,0,1600*y),i(g,440*y,1600*y),i(v,880*y,1600*y)}var r=t("./utils/BaseUtils"),s=t("./utils/PathGenerator"),o=t("./utils/BezierEasing"),l=t("./vector/Transition"),c=t("./vector/shape/Path"),h=t("./vector/shape/LayerGroup"),u="M-56,0a56,16 0 1,0 112,0a56,16 0 1,0 -112,0";return{MARKER_EFFECT_TIME:2560,markerEffectAnimation:function(t,e){function i(t){return t*c*2.5}var o=t.options.marker;if(o&&o.symbol){var l=o.symbol,c=o.radius;if(r.isImageMarker(l))return;n(t,{isMap:e,initStyle:{fill:"none",stroke:o.fillColor,"stroke-width":0,"stroke-opacity":0},opacityKey:"stroke-opacity",pathFun:function(t){return s.getMarkerPath(l,c+i(t)/2-1)},borderFun:i})}else a(t,e)},bubbleEffectAnimation:function(t,e){i(t,null,e)},AREA_STYLE_EFFECT_TIME:2e3,areaStyleEffectAnimation:function(t,i,a){var n=e(t,i,a);t.graphic.attr("transform-origin","center").effectTransition().ease(o.css["ease-out-quad"]).duration(.5*n.period).attrTween("filter",n.firstTweenFun).attr("transform",n.translate+"scale(1.05)").transition().ease(o.css["ease-in-quad"]).duration(.5*n.period).attrTween("filter",n.secondTweenFun).attr("transform",n.translate+"scale(1)")},areaMapEffectAnimation:function(t,i){var a=e(i);t._path.style("transform",a.translate+"scale(1)").style("transform-origin","center").effectTransition().ease(o.css["ease-out-quad"]).duration(.5*a.period).attrTween("filter",a.firstTweenFun).style("transform",a.translate+"scale(1.05)").transition().ease(o.css["ease-in-quad"]).duration(.5*a.period).attrTween("filter",a.secondTweenFun).style("transform",a.translate+"scale(1)")},POINT_MAP_EFFECT_TIME:3200,pointMapEffectAnimation:function(t,e){function i(){return function(t){return r.makeTranslate3d({x:m.x,y:m.y-25*t})}}function a(){return function(t){return r.makeTranslate3d({x:m.x,y:m.y-25*(1-t)})}}function n(){return(new c).addTo(y)._path.style(v).attr("d",u)}function s(t,e,i){t.style(v).attr("transform",_),t.effectTransition().delay(e).ease("linear").duration(i).attrTween("transform",function(){return function(t){return F+"scale("+(M+1.4*M*t)+")"}}).styleTween("fill-opacity",function(){return function(t){return.6*(1-t)}})}var d=e.series,p=d.vanchart,f=e.getLatLng(),m=p.latLngToLayerPoint(f),g=d._getEffectTime(e);new l({node:function(){return t._icon}},"point-map-effect").ease(o.css["ease-out-quint"]).duration(.25*g).styleTween("transform",i).transition().ease(o.css["ease-in-quint"]).duration(.25*g).styleTween("transform",a).transition().ease(o.css["ease-out-quint"]).duration(.25*g).styleTween("transform",i).transition().ease(o.css["ease-in-quint"]).duration(.25*g).styleTween("transform",a);var v={"fill-opacity":0,fill:e.color},y=e.effectGraphic=e.effectGraphic||(new h).addTo(p.getEffectLayer()),M=e.options.icon.iconSize[0]/90,F=r.makeTranslate({x:m.x,y:m.y}),_=F+" scale("+M+")",T=y.firstG=y.firstG||n(),b=y.secondG=y.secondG||n(),x=y.thirdG=y.thirdG||n(),C=g/d.getDefaultEffectTime();s(T,0,2e3*C),s(b,600*C,2e3*C),s(x,1200*C,2e3*C)},forceBubbleEffectAnimation:i}}),define("chart/Pie",["require","../Constants","../utils/BaseUtils","../utils/ColorUtils","./Series","./PieSeries","../utils/BoundsManager","../utils/BezierEasing","../EffectHelper","../utils/PathGenerator","../utils/Interpolator","../ChartLibrary"],function(t){function e(){function t(r){var s=r.map(function(i,a){var r=+e.call(t,i,a);return n+=r,r}),o=i,l=(a-o)/n;r.forEach(function(t,e){t.startAngle=isNaN(o)?0:o,t.endAngle=o+=isNaN(s[e]*l)?0:s[e]*l})}var e=Number,i=0,a=2*Math.PI,n=0;return t.value=function(i){return arguments.length?(e=i,t):e},t.startAngle=function(e){return arguments.length?(i=e,t):i},t.endAngle=function(e){return arguments.length?(a=e,t):a},t}var i=t("../Constants"),a=t("../utils/BaseUtils"),n=t("../utils/ColorUtils"),r=t("./Series"),s=t("./PieSeries"),o=(t("../utils/BoundsManager"),t("../utils/BezierEasing")),l=t("../EffectHelper"),c=t("../utils/PathGenerator"),h=t("../utils/Interpolator"),u=2*Math.PI,d=o.css.swing,p=r.extend({_getAxisTypes:function(){return[]},doLayout:function(){var t=this._calculateSeriesBounds(),a=this;if(!t&&!this.options.radius&&!this.options.center)throw new Error("pie has no bounds");var n,r,s;t?(s=this.options.radius||Math.min(t.width/2,t.height/2),n=t.x+t.width/2,r=t.y+t.height/2,this.bounds=t):(s=this.options.radius,n=this._getPercentValue(this.options.center[0],this.vanchart.width),r=this._getPercentValue(this.options.center[1],this.vanchart.height));var o=this.chartInfo&&this.chartInfo.rotate||0;this.chartInfo={radius:s,centerX:n,centerY:r,rotate:o};var l=e().value(function(t){return a.options.roseType==i.SAME_ARC?1:Math.abs(t.getTargetValue())}).startAngle(a.startAngle).endAngle(a.endAngle),c=this.points.filter(function(t){return t.isVisible()}),h=this;c.forEach(function(t){t.lastShape=h._getArcData(t)}),l(c)},_getFixedPos:function(t,e){var i=(this.vanchart.bounds,t.series.chartInfo),a=i.centerX,n=i.centerY,r=this.getCenterAngle(t),s=1.1*t.outerRadius,o=s*Math.sin(r)+a,l=s*Math.cos(r+Math.PI)+n;return r<Math.PI/2?l-=e.height:r>=Math.PI&&r<3*Math.PI/2?o-=e.width:r>=3*Math.PI/2&&r<u&&(l-=e.height,o-=e.width),[o,l]},_calculateLabelPos:function(){for(var t=this.options.roseType,e=this.points.filter(function(t){return t.visible}),a=[],n=[],r=0,s=e.length;r<s;r++){var o=e[r],l=o.options.dataLabels;o.visible&&l&&l.enabled&&(l.align==i.OUTSIDE?a.push(o):n.push(o))}this._calculateOutsideLabelBounds(a),this.options.radius||(n.length&&!a.length||!n.length&&!a.length)&&(this.chartInfo.radius=this.chartInfo.radius/1.1-3);var c=this.options.innerRadius,h=this.chartInfo.radius;if(c&&(c="string"==typeof c&&-1!=c.indexOf("%")?parseFloat(c)*h/100:parseFloat(c)),this.chartInfo.innerRadius=c,this.points.forEach(function(t){t.innerRadius=c}),t){var u=h-c,d=0;e.forEach(function(t){d=Math.max(d,Math.abs(t.getTargetValue()))});var p=u/d;!isNaN(p)&&isFinite(p)||(p=0),e.forEach(function(t){t.outerRadius=c+p*Math.abs(t.getTargetValue())})}else e.forEach(function(t){t.outerRadius=h});this.calculateLeadLineStartPos(a),this.calculateInsideLabelBounds(n)},_calculateLabelPosWhenRadiusFixed:function(){for(var t=this.points.filter(function(t){return t.visible}),e=[],a=[],n=0,r=t.length;n<r;n++){var s=t[n],o=s.options.dataLabels;o&&o.enabled&&(o.align==i.OUTSIDE?e.push(s):a.push(s))}this._calculateLabelBoundsForFixed([this.chartInfo.centerX,this.chartInfo.centerY],this.chartInfo.radius,e),this.calculateLeadLineStartPos(e),this.calculateInsideLabelBounds(a)},_calculateOutsideLabelBounds:function(t){if(t.length){t.forEach(function(t){t.labelPos=null});var e=this.chartInfo,i=e.radius,a=[e.centerX,e.centerY];this.options.radius?this.calcOutsideLabel(t,this.bounds,a,i):this.chartInfo.radius=this.calcOutsideLabel(t,this.bounds,a)}},_calculateLabelBoundsForFixed:function(t,e,i){var a=this.chartInfo,e=a.radius,t=[a.centerX,a.centerY];this.calcOutsideLabel(i,this.bounds,t,e)},_calculateSeriesBounds:function(){for(var t=this.vanchart.seriesOfType(i.PIE_CHART),e=this.vanchart.bounds,a=0,n=0,r=t.length;n<r;n++)t[n].options.center&&t[n].options.radius&&a++;for(var s=e.width/Math.max(1,t.length-a),n=0,r=t.length;n<r;n++)if(t[n]==this&&!this.options.center)return{x:e.x+n*s,y:e.y,width:s,height:e.height}},_getTranslate:function(){return[this.chartInfo.centerX,this.chartInfo.centerY]},_getArcData:function(t){if(a.hasDefined(t.startAngle))return{startAngle:t.startAngle,endAngle:t.endAngle,outerRadius:t.outerRadius}},_getMoreLabelDefaultCenter:function(t,e){var i=this.getCenterAngle(t),a=t.series.chartInfo.innerRadius+(t.outerRadius-t.series.chartInfo.innerRadius)/2,n=this._getArcPoint(a,i);return{centerX:n[0],centerY:n[1]}},effectAnimation:function(t){l.areaStyleEffectAnimation(t)},getDefaultEffectTime:function(){return l.AREA_STYLE_EFFECT_TIME},getHighLightStyle:function(t){return{fill:t.series.getFillFilter(t.mouseOverColor||t.color,t),"fill-opacity":t.opacity,stroke:t.borderColor||t.mouseOverColor||t.color,"stroke-width":t.options.borderWidth,"stroke-opacity":t.borderOpacity}},getPressedStyle:function(t){return{fill:t.series.getFillFilter(t.clickColor,t),"fill-opacity":t.clickOpacity,stroke:t.borderColor||t.mouseOverColor||t.color,"stroke-width":t.options.borderWidth,"stroke-opacity":t.borderOpacity}},getAttrs:function(t){return{d:c.arc().innerRadius(t.innerRadius)(this._getArcData(t))}},getPointGraphicKey:function(){return"path"},_calculateAnimationDelay:function(){for(var t=0,e=0,i=0,a=this.points.length;i<a;i++){var n=this.points[i];n.visible&&n.series.visible&&t++,n.graphic&&e++}return e==t?0:1},_createGroup:function(t,e){return t.group().addTo(e.seriesGroup)},getPointInitAnimationAttr:function(t){var e=t.series,i=c.arc().innerRadius(e.chartInfo.innerRadius);return{ease:"bounce",duration:1e3,attrTween:{d:function(){var a={startAngle:e.startAngle,endAngle:e.startAngle,outerRadius:t.outerRadius};if(!e.initialAnimationMoving){var n=e.getPreVisiblePoint(t);if("first"!=n&&n.lastShape){var r=Math.abs(n.lastShape.endAngle-n.endAngle),s=t.startAngle+r;a={startAngle:s,endAngle:s,outerRadius:t.outerRadius}}}var o=h(a,e._getArcData(t));return this._current_=o(1),function(t){return i(o(t))}}}}},getPointUpdateAnimationAttr:function(t,e){var i=t.series,a=c.arc().innerRadius(i.chartInfo.innerRadius),n="bounce",r=1e3;return e||(n=d,r=400),{ease:n,duration:r,attrTween:{d:function(){var e=i._getArcData(t),n=this._current_||e,r=h(n,e);return this._current_=r(1),function(t){return a(r(t))}}}}},getPointDropAnimationAttr:function(t){var e=t.series,i=(e.options,e.startAngle),a=c.arc().innerRadius(e.chartInfo.innerRadius);return{ease:"bounce",duration:1e3,attrTween:{d:function(){var n=this._current_,r=e.getPreVisiblePoint(t),s=i;if("first"!=r&&r.lastShape){var o=Math.abs(r.lastShape.endAngle-r.endAngle);s=t.startAngle+o}var l={startAngle:s,endAngle:s,outerRadius:n.outerRadius},c=h(n,l);return this._current_=c(1),function(t){return a(c(t))}}}}},getPreVisiblePoint:function(t){for(var e=t.series.points,i="first",a=0,n=e.length;a<n;a++){if(e[a]==t)return i;e[a].visible&&(i=e[a])}return i},getFillFilter:function(t,e){var r=this;if(r.vanchart.options.style==i.STYLE_GRADUAL&&a.isSupportSVG()){var s=(r=this).vanchart.renderer,o={cx:"0%",cy:"0%",r:Math.max(e.outerRadius,0)+"px",gradientUnits:"userSpaceOnUse"},l={offset:e.innerRadius/Math.max(e.outerRadius,1)*100+"%","stop-color":n.getColorWithDivider(t,.8)},c={offset:"100%","stop-color":t};return e.colorGradient?s.updateColorGradient(e.colorGradient,o,[l,c]):e.colorGradient=s.colorGradient(o,[l,c],"radialGradient"),"url(#"+a.stamp(e.colorGradient)+")"}return t},_onPointMouseOver:function(t){this._onState(t,!0)},_onPointMouseOut:function(t){this._onState(t,!1)},_onState:function(t,e){var a=this,n=c.arc().innerRadius(t.innerRadius),r=e?a.getHighLightStyle(t):a.getStyle(t),s=1.1*t.outerRadius,o=t.outerRadius;e&&(s=t.outerRadius,o=1.1*t.outerRadius);var l=h(s,o),u={startAngle:t.startAngle,endAngle:t.endAngle};t.graphic.style(r).interrupt(i.SELECT_ANIMATION).transition(i.SELECT_ANIMATION).animate({ease:"elastic",duration:800,attrTween:{d:function(){return function(t){return n.outerRadius(l(t))(u)}}}})},_getPointGraphicGroup:function(){return this.pathGroup||(this.pathGroup=this.vanchart.renderer.group().addTo(this.group)),this.pathGroup},_getPointTextLabelGroup:function(){return this.textLabelGroup||(this.textLabelGroup=this.vanchart.renderer.vgroup().add(),this.group.append(this.textLabelGroup.renderG),this.textLabelGroup.divG.attr("transform",a.makeTranslate(this._getTranslate()))),this.textLabelGroup},isSeriesAccumulated:function(){return!0}});return p.include(s),t("../ChartLibrary").register(i.PIE_CHART,p),p}),define("chart/Line",["require","../Constants","../utils/BaseUtils","../utils/QueryUtils","./Series","../utils/Class","../utils/BezierEasing","../utils/ColorUtils","../dom/DomUtils","../EffectHelper","../utils/PathGenerator","../ChartLibrary","../ChartLibrary"],function(t){var e=t("../Constants"),i=t("../utils/BaseUtils"),a=(t("../utils/QueryUtils"),t("./Series")),n=t("../utils/Class"),r=t("../utils/BezierEasing"),s=t("../utils/ColorUtils"),o=t("../dom/DomUtils"),l=t("../EffectHelper"),c=t("../utils/PathGenerator"),h=r.css.swing,u=function(t){var e=t.indexFromLeft/t.series.points.length;return 800*(e<.5?Math.sqrt(e/2):1-Math.sqrt(2-2*e)/2)},d=a.extend({doLayout:function(){var t,e=this,i=e.vanchart,a=e.xAxis,n=e.yAxis,r=e.options.connectNulls,s=a.scale.rangeBand?a.scale.rangeBand()/2:0,o=i.isInverted(),l=o?"posY":"posX",h=n.getStartPosValue(),u=[];if(this.options.large){var d={},p={};e.points.forEach(function(e){t=e.options;var i=a.scale(a.getAxisValue(t.x,e))+s,r=n.scale(n.getAxisValue(t.y,e)+t.y0-h),l=n.scale(t.y0);isFinite(r)||(e.isNull=!0),o?(e.posX=r,e.posY=i,e.posX0=l):(e.posX=i,e.posY=r,e.posY0=l),d[e.posX]&&p[e.posY]||(d[e.posX]=!0,p[e.posY]=!0,u.push(e))},this)}else u=e.points;var f=!0,m=[];e.y0=Number.MAX_VALUE,e.y=-Number.MAX_VALUE,u.forEach(function(i,c){if(t=i.options,this.options.large)u=i.posX,d=i.posY;else{var u=a.scale(a.getAxisValue(t.x,i))+s,d=n.scale(n.getAxisValue(t.y,i)+t.y0-h),p=n.scale(t.y0);o?(i.posX=d,i.posY=u,i.posX0=p):(i.posX=u,i.posY=d,i.posY0=p)}i.indexFromLeft=c,(!r||r&&!i.isNull)&&(m.length>0&&(f=f&&m[m.length-1][l]<=(o?d:u)),m.push(i)),Math.abs(t.y0)<Math.abs(e.y0)&&(e.y0=Math.abs(t.y0)),Math.abs(t.y+t.y0)>e.y&&(e.y=Math.abs(t.y+t.y0))},this),f||(m.sort(function(t,e){return t[l]-e[l]}),m.forEach(function(t,e){t.indexFromLeft=e}));var g=c.line().interpolate(e.interpolate).x(function(t){return t.posX}).y(function(t){return t.posY}).defined(function(t){return!t.isNull}),v=c.area().interpolate(e.interpolate);v=(v=o?v.y(function(t){return t.posY}).x0(function(t){var i=e._getPreviousStackingPoint(t);return i?i.posX:t.posX0}).x1(function(t){return t.posX}):v.x(function(t){return t.posX}).y0(function(t){var i=e._getPreviousStackingPoint(t);return i?i.posY:t.posY0}).y1(function(t){return t.posY})).defined(function(t){return!t.isNull}),this.linePath=g(m),this.areaPath=v(m),this.dataBands=this._calculateDataBands()},_getPreviousStackingPoint:function(t){if(i.hasDefined(t.series.stack))for(var e=t.points,a=0,n=e.length;a<n;a++){var r=e[a].series;if(r.stack==t.series.stack&&r.visible&&e[a+1]==t)return e[a]}},_calculateDataBands:function(){var t=this.vanchart.bounds,e=this,i=this.options.bands||[],a=e.color,n=e.opacity,r=e.fillColor,s=e.fillColorOpacity,o=e.yAxis,l=o.scale.domain(),c=o.isHorizontal(),h=t.width,u=t.height,d=[];if(d.push({clipBounds:{x:0,y:0,width:h,height:u},color:a,fillColor:r,fillColorOpacity:s}),!i||!i.length)return d;for(var p=0,f=i.length;p<f;p++){var m=Math.max(l[0],i[p].from),g=Math.min(l[1],i[p].to);m=o.scale(m),g=o.scale(g);var v={x:0,y:Math.min(m,g),width:h,height:Math.abs(m-g)};c&&(v={x:Math.min(m,g),y:0,width:Math.abs(m-g),height:u}),d.push({clipBounds:v,color:i[p].color||a,opacity:i[p].opacity||n,fillColor:i[p].fillColor||r,fillColorOpacity:i[p].fillColorOpacity||s})}return d},_getFixedPos:function(t){var e=t.options.marker.radius||4.5,i=this.vanchart.bounds;return[i.x+t.posX+e,i.y+t.posY+e]},_calculateLabelPos:function(t){var a=this,n=this.vanchart.isInverted(),r=(a.points.length,this.vanchart.bounds);a.points.forEach(function(s,o){var l=s.options.dataLabels;if(l&&l.enabled){var c,h,u,d=l.align==e.TOP,p=s.labelDim,f=2;if(!p)return;var m=s.options.marker;m&&m.symbol&&(f+=m.radius||4.5),n?(h=d?s.posX+f:s.posX-f-p.width,(u=s.posY-p.height/2)<=0?u=s.posY:u+p.height>=r.height&&(u=s.posY-p.height)):(h=s.posX-p.width/2,u=d?s.posY-f-p.height:s.posY+f,h<=0?h=s.posX:h+p.width>=r.width&&(h=s.posX-p.width)),c={x:h,y:u},l.autoAdjust&&(c=a._calculateAutoLabelPos(s,c,!n,t)),c&&(s.labelPos=c,t.addBounds(i.makeBounds(s.labelPos,s.labelDim)))}})},getTrendLineXYValues:function(t){return this._getNormalTrendLineXYValues(t)},getAttrs:function(t){return{transform:i.makeTranslate([t.posX,t.posY])}},_getMoreLabelDefaultCenter:function(t,e){return{centerX:t.posX+t.options.marker.radius/2,centerY:t.posY-e.height/2-t.options.marker.radius/2}},effectAnimation:function(t){l.markerEffectAnimation(t)},getDefaultEffectTime:function(){return l.MARKER_EFFECT_TIME},getHighLightStyle:function(){},getDataToDraw:function(){return this.points.filter(function(t){return t.options.marker&&t.options.marker.symbol})},getTextDataToDraw:function(){return this.points},_updatePointGraphicStyle:function(t){this._updateMarker(t)},updatePointGraphic:function(t){this._updateMarkerPointGraphic(t)},_createPointGraphic:function(t){return t.graphic=this._createMarker(t.options.marker)},onPointPress:function(){var t=this;t.series._onMarkerPressed(t)},onPointPressUp:function(){var t=this;t.series._updateMarker(t)},_onPointMouseOver:function(t){t.series._onMarkerMouseOver(t)},_onPointMouseOut:function(t){t.series._onMarkerMouseOut(t)},getPointInitAttr:function(t){return{transform:"translate("+t.posX+","+t.posY+") scale(0.01)"}},getPointInitAnimationAttr:function(t){return[{delay:u(t),ease:"ease-out-in",duration:150,attr:{transform:"translate("+t.posX+","+t.posY+") scale(1.5)"}},{duration:150,ease:"ease-out-in",attr:{transform:"translate("+t.posX+","+t.posY+") scale(1)"}}]},getPointUpdateAnimationAttr:function(t){return{ease:h,duration:250,attr:{transform:"translate("+t.posX+","+t.posY+")"}}},getClosestPoint:function(t){var e,i=this.vanchart.isInverted(),a=i?"y":"x",n=i?"posY":"posX",r=Number.MAX_VALUE,s=this.vanchart.hoverSeries,o=this.vanchart.bounds[a]-(i?t.y:t.x);return s.points.forEach(function(t){var i=Math.abs(t[n]+o);i<r&&!t.isNull&&(e=t,r=i)}),e},_onSeriesMouseOver:function(t){a.prototype._onSeriesMouseOver.call(this,t),this.dataBandsGraphic.forEach(function(t){t._onSeriesMouseOver()}),i.toFront(this.group.node())},_onSeriesMouseOut:function(t){this.dataBandsGraphic.forEach(function(t){t._onSeriesMouseOut()}),this.defaultMarker&&this.defaultMarker.remove(),this.defaultMarker=null},drawPoints:function(){a.prototype.drawPoints.call(this);for(var t=this.dataBandsGraphic.length-1;t>=0;t--)this.dataBandsGraphic[t].toBack()},drawSeries:function(){var t,e,i=this,a=(this.vanchart.renderer,this.dataBands);for(this.defaultMarker&&this.defaultMarker.remove(),this.defaultMarker=null,this.dataBandsGraphic=this.dataBandsGraphic||[],t=a.length,e=this.dataBandsGraphic.length;t<e;t++)this.dataBandsGraphic[t].remove(),this.dataBandsGraphic[t]=null;for(t=0,e=a.length;t<e;t++)this.dataBandsGraphic[t]?this.dataBandsGraphic[t].refresh(a[t]):this.dataBandsGraphic[t]=new p(a[t],i);this.dataBandsGraphic.length=a.length}}),p=n.extend({initialize:function(t,e){this.series=e,this.refresh(t)},refresh:function(t){this.options=t,this.render()},render:function(){var t=this.options,a=this.series,n=a.group,r=a.vanchart,s=r.renderer,o=this._getLineStyle(a,t),l=this._getAreaStyle(a,t),c=i.isSupportSVG(),u=t.clipBounds,d=a.type==e.AREA_CHART,p=!this.linePath||this.linePath.removed();if(this.clipRect?s.updateClip(this.clipRect,u):this.clipRect=s.createClip({x:u.x,y:u.y,width:u.width,height:u.height}),!a.visible)return this.linePath&&this.linePath.remove(),this.areaPath&&this.areaPath.remove(),void(this.linePath=this.areaPath=null);this.linePath=this.linePath||s.path().attr("d",a.linePath).addTo(n),this.linePath.style(o),this.linePath.isLineChart=!0,c&&s.clip(this.linePath,this.clipRect),d&&(this.areaPath=this.areaPath||s.path().attr("d",a.areaPath),this.areaPath.style(l).addTo(n),this.areaPath.isLineChart=!0,c&&s.clip(this.areaPath,this.clipRect)),p?(this.linePath.attr("d",a.linePath),this.areaPath&&this.areaPath.attr("d",a.areaPath),c&&this.clipRect.rect.attr(r.isInverted()?"height":"width",0).animate({ease:"quad-in-out",duration:800,attr:u})):(this.linePath.animate({ease:h,duration:250,attr:{d:a.linePath}}),this.areaPath&&this.areaPath.animate({ease:h,duration:250,attr:{d:a.areaPath}}),c&&this.clipRect.rect.animate({ease:h,duration:250,attr:u}))},toBack:function(){o.toBack(this.linePath&&this.linePath.node()),o.toBack(this.areaPath&&this.areaPath.node())},_getAreaStyle:function(t,i){var a,n,r=t.vanchart.highlightTarget;return r?(a=i.fillColor,n=r==t.name?1:.3):(a=this._getFillFilter(i.fillColor,t),n=t.vanchart.options.style==e.STYLE_GRADUAL?1:i.fillColorOpacity),{fill:a,"fill-opacity":n}},_getLineStyle:function(t,e){var i=e.opacity,a=t.vanchart.highlightTarget;return a&&(i=a==t.name?1:.3),{fill:"none",stroke:e.color,"stroke-width":t.options.lineWidth,"stroke-opacity":i}},_getFillFilter:function(t,a){if(i.isSupportSVG()){var n=a.vanchart,r=n.renderer;if(a.vanchart.options.style==e.STYLE_GRADUAL){var s,o,l;s=o=l="0%";var c=Math.abs(a.y)/Math.abs(a.y-a.y0)||0;!0===n.isInverted()?(s=100*(1-c)+"%",l="100%"):o=100*c+"%";var h={x1:s,y1:o,x2:l,y2:"0%"},u={offset:"0%","stop-color":t,"stop-opacity":0},d={offset:"100%","stop-color":t,"stop-opacity":.8};return this.colorGradient?r.updateColorGradient(this.colorGradient,h,[u,d]):this.colorGradient=r.colorGradient(h,[u,d]),"url(#"+i.stamp(this.colorGradient)+")"}}return t},_onSeriesMouseOver:function(){this.linePath.style({stroke:s.getHighLightColor(this.options.color),"stroke-width":this.series.options.lineWidth+1}),this.series.type==e.AREA_CHART&&this.areaPath.style({fill:s.getHighLightColor(this.options.fillColor),"fill-opacity":0===this.options.fillColorOpacity?0:.65})},_onSeriesMouseOut:function(){this.linePath&&this.linePath.style(this._getLineStyle(this.series,this.options)),this.areaPath&&this.areaPath.style(this._getAreaStyle(this.series,this.options))},remove:function(){this.linePath&&this.linePath.remove(),this.areaPath&&this.areaPath.remove(),this.clipRect&&this.clipRect.remove(),this.linePath=this.areaPath=this.clipRect=null}});return t("../ChartLibrary").register(e.LINE_CHART,d),t("../ChartLibrary").register(e.AREA_CHART,d),d}),define("chart/Radar",["require","./Series","../utils/BaseUtils","../utils/QueryUtils","../utils/BoundsManager"],function(t){var e=t("./Series"),i=t("../utils/BaseUtils");return t("../utils/QueryUtils"),t("../utils/BoundsManager"),e.extend({refresh:function(t,i){return e.prototype.refresh.call(this,t,i),this.columnType=this.options.columnType,this.stack=this.columnType?"radar-column"+this.options.stack:this.options.stack,this},_getAxisTypes:function(){return["angleAxis","radiusAxis","polar"]},getBaseAxisType:function(){return"angleAxis"},_bindAxis:function(){var t=this,e=t.options,i=t.vanchart;t._getAxisTypes().forEach(function(a){if(i[a]){var n=i[a](e.polar);n&&(n.series.push(t),t[a]=n)}})},_getDefaultFillColorOpacity:function(){return this.options.columnType?1:.15},_getTranslate:function(){return this.getCenter()},getCenter:function(){return this.polar&&this.polar.center},getRadius:function(){return this.polar&&this.polar.radius},doLayout:function(){var t=this,e=t.polar,i=e.radiusAxis,a=e.angleAxis,n=(this.getCenter(),this.getRadius(),a.piece),r=i.scale,s=a.scale,o=i.indicator,l=function(t){return isNaN(r(t))?0:r(t)};t.points.sort(function(t,e){return s(t.category)-s(e.category)});var c;t.points.forEach(function(e){c=e.options;var a=e.category,r=c.y0,h=e.value+c.y0;e.innerRadius=o?t._cateValueScale(a,r):l(r),e.outerRadius=o?t._cateValueScale(a,h):l(h),e.animateInitRadius=i.getStartPos(),e.radian=s(e.category)*n;var u=t._getArcPoint(e.outerRadius,e.radian);e.posX=u[0],e.posY=u[1],this._calcLabelPos(e)},this),t.pathSegment=t._getPathSegment(t.points,t.options.connectNulls)},_calculateLabelPos:function(){},getTargetKey:function(){return"y"},_createGroup:function(t,e){return t.group().addTo(e.seriesGroup)},_getPathSegment:function(t,e){var i=this.polar.angleAxis.scale;(t=[].concat(t)).sort(function(t,e){return i(t.category)-i(e.category)});var a=[],n=[];if(e)a.push(n),t.forEach(function(t){t.isNull||n.push([t.posX,t.posY])});else{for(var r=0,s=t.length,o=s-1;o>0;o--){var l=t[o],c=t[o-1];!l.isNull&&c.isNull&&(r=o)}for(o=0;o<s;o++){var h=t[(o+r)%s];h.isNull&&n.length?(n.length>1&&a.push(n),n=[]):h.isNull||n.push([h.posX,h.posY])}n.length&&a.push(n)}return a},_getRadarSeriesPath:function(t,e,a){var n="",r=[];if(1===t.length){var s=(r=t[0]).length==this.angleAxis.getCategoryCount()||e;n=(a=!s&&a)?"M0,0":"";for(var o=0,l=r.length;o<l;o++)n+=(o||a?"L":"M")+i.dealFloatPrecision(r[o][0])+","+i.dealFloatPrecision(r[o][1]);n+=s||a?"Z":""}else t.forEach(function(t){n+=a?"M0,0":"",t.forEach(function(t,e){n+=(e||a?"L":"M")+i.dealFloatPrecision(t[0])+","+i.dealFloatPrecision(t[1])}),n+=a?"Z":""});return n},_getInitPathSegment:function(t){var e=[];return t.forEach(function(t){var i=[];e.push(i),t.forEach(function(){i.push([0,0])})}),e},_cateValueScale:function(t,e){var i,a=this.radiusAxis,n=a._cateScale;return a._cateDomain.forEach(function(e){e.name===t&&(i=e.domain)}),n.domain(i),isNaN(n(e))?0:n(e)}})}),define("chart/LineRadar",["require","../utils/BaseUtils","../dom/DomUtils","../EffectHelper","../utils/Interpolator","../Constants","./Radar","../ChartLibrary"],function(t){var e=t("../utils/BaseUtils"),i=t("../dom/DomUtils"),a=t("../EffectHelper"),n=t("../utils/Interpolator"),r=t("../Constants"),s=t("./Radar"),o="back-out",l=s.extend({columnType:!1,_calcLabelPos:function(t){if(t.labelDim){var e=this.polar.angleAxis._getPolarPosition(t.category),i=this._getArcPoint(t.outerRadius+8,t.radian),a=t.labelDim;switch(e){case"radar-top":t.labelPos={x:-a.width/2,y:i[1]-a.height};break;case"radar-right":t.labelPos={x:i[0],y:i[1]-a.height/2};break;case"radar-bottom":t.labelPos={x:-a.width/2,y:i[1]};break;case"radar-left":t.labelPos={x:i[0]-a.width,y:i[1]-a.height/2}}}},_getMoreLabelDefaultCenter:function(t,e){return{centerX:t.posX+t.options.marker.radius/2,centerY:t.posY-e.height/2-t.options.marker.radius/2}},drawPoints:function(){s.prototype.drawPoints.call(this),i.toBack(this.radarPath&&this.radarPath.node())},drawSeries:function(){this.defaultMarker&&this.defaultMarker.remove(),this.defaultMarker=null;var t=this,e=t.vanchart.renderer,i=t.fillColor&&t.fillColorOpacity,a=this._getRadarPathStyle();t.visible?(this.radarPath=this.radarPath||e.path().addTo(t.group),this.radarPath.style(a),this.radarPath.animate({duration:500,ease:o,attrTween:{d:function(){var e=!!this._pathSegment_;if(e&&this._pathSegment_.length==t.pathSegment.length)for(var a=this._pathSegment_,r=0,s=a.length;r<s&&e;r++)a[r].length!=t.pathSegment[r].length&&(e=!1);var o=e?this._pathSegment_:t._getInitPathSegment(t.pathSegment),l=n.interpolateArray(o,t.pathSegment);return this._pathSegment_=t.pathSegment,function(e){return t._getRadarSeriesPath(l(e),t.options.connectNulls,i)}}}})):(this.radarPath&&this.radarPath.animate({duration:500,ease:"exp-out",attrTween:{d:function(){var e=t._getInitPathSegment(t.pathSegment),a=n.interpolateArray(t.pathSegment,e);return function(e){return t._getRadarSeriesPath(a(e),t.options.connectNulls,i)}}}}).remove(),this.radarPath=null)},_getRadarPathStyle:function(){var t=this,e=t.fillColor&&t.fillColorOpacity,i=t.fillColorOpacity,a=t.opacity,n=t.vanchart.highlightTarget;return n&&(i=n==t.name?1:.3,a=n==t.name?1:.3),{fill:e?t.fillColor:"none","fill-opacity":i,stroke:t.color,"stroke-width":t.options.lineWidth,"stroke-opacity":a}},getStyle:function(){return{}},effectAnimation:function(t){a.markerEffectAnimation(t)},getDefaultEffectTime:function(){return a.MARKER_EFFECT_TIME},_createPointGraphic:function(t){return t.graphic=this._createMarker(t.options.marker)},_updatePointGraphicStyle:function(t){this._updateMarker(t)},getDataToDraw:function(){return this.points.filter(function(t){return t.options.marker&&t.options.marker.symbol})},getTextDataToDraw:function(){return this.points},onPointPress:function(){var t=this;t.series._onMarkerPressed(t)},onPointPressUp:function(){var t=this;t.series._updateMarker(t)},_calculateLabelPos:function(){},_getFixedPos:function(t){var e,i,a=isNaN(t.options.marker.radius)?4.5:t.options.marker.radius,n=this.getCenter();return e=n[0]+t.posX+a,i=n[1]+t.posY+a,[e,i]},_onSeriesMouseOver:function(t){s.prototype._onSeriesMouseOver.call(this,t);var i=this;i.radarPath&&i.radarPath.style({"stroke-width":i.options.lineWidth+1}),e.toFront(i.group.node())},_onSeriesMouseOut:function(){var t=this;this.defaultMarker&&this.defaultMarker.remove(),this.defaultMarker=null,t.radarPath&&t.radarPath.style(t._getRadarPathStyle())},_onPointMouseOver:function(t){t.series._onMarkerMouseOver(t)},_onPointMouseOut:function(t){t.series._onMarkerMouseOut(t)},getPointInitAttr:function(){return{transform:"translate(0, 0) scale(0.01)"}},getPointInitAnimationAttr:function(t){return{duration:500,ease:o,attr:{transform:"translate("+t.posX+","+t.posY+") scale(1)"}}},getPointUpdateAnimationAttr:function(t){return{ease:o,duration:500,attr:{transform:"translate("+t.posX+","+t.posY+") scale(1)"}}},updatePointGraphic:function(t){this._updateMarkerPointGraphic(t)},getClosestPoint:function(t){var e,i=this.getCenter(),a=Number.MAX_VALUE;return this.points.forEach(function(n){var r=n.posX+i[0]-t.x,s=n.posY+i[1]-t.y,o=Math.sqrt(r*r+s*s);o<a&&!n.isNull&&(e=n,a=o)}),e}});return t("../ChartLibrary").register(r.LINE_RADAR,l),l}),define("chart/ColumnRadar",["require","../EffectHelper","../utils/Interpolator","../utils/PathGenerator","../Constants","./Radar","../ChartLibrary"],function(t){var e=t("../EffectHelper"),i=t("../utils/Interpolator"),a=t("../utils/PathGenerator"),n=t("../Constants"),r=t("./Radar").extend({columnType:!0,_calcLabelPos:function(t){if(t.labelDim){var e=this.polar.angleAxis._getPolarPosition(t.category),i=this._getArcPoint(t.outerRadius-8,t.radian),a=t.labelDim;switch(e){case"radar-top":t.labelPos={x:-a.width/2,y:i[1]};break;case"radar-right":t.labelPos={x:i[0]-a.width,y:i[1]-a.height/2};break;case"radar-bottom":t.labelPos={x:-a.width/2,y:i[1]-a.height};break;case"radar-left":t.labelPos={x:i[0],y:i[1]-a.height/2}}}},_getMoreLabelDefaultCenter:function(t){var e=this._getArcPoint(t.outerRadius/2,t.radian);return{centerX:e[0],centerY:e[1]}},effectAnimation:function(t){e.areaStyleEffectAnimation(t)},getDefaultEffectTime:function(){return e.AREA_STYLE_EFFECT_TIME},getStyle:function(t){return{fill:t.color,"fill-opacity":t.opacity,stroke:t.borderColor,"stroke-width":t.options.borderWidth,"stroke-opacity":1}},getHighLightStyle:function(t){return{stroke:t.mouseOverColor||t.color,fill:t.color,"fill-opacity":1,"stroke-width":6,"stroke-opacity":.35}},getPressedStyle:function(t){return{fill:t.clickColor,"fill-opacity":t.clickOpacity}},getPointGraphicKey:function(){return"path"},_getRadarColumnPath:function(t,e,i){var n=.375*this.polar.angleAxis.piece,r=i-n,s=i+n;return a.arc().innerRadius(t).outerRadius(e).startAngle(r).endAngle(s)()},getPointInitAnimationAttr:function(t){var e=this;return{ease:"back-out",duration:500,attrTween:{d:function(){this._innerRadius_=t.innerRadius,this._outerRadius_=t.outerRadius;var a=i(t.animateInitRadius,t.innerRadius),n=i(t.animateInitRadius,t.outerRadius);return function(i){return e._getRadarColumnPath(a(i),n(i),t.radian)}}}}},getPointUpdateAnimationAttr:function(t){var e=this;return{ease:"exp-out",duration:500,attrTween:{d:function(){var a=i(this._innerRadius_,t.innerRadius),n=i(this._outerRadius_,t.outerRadius);return this._innerRadius_=t.innerRadius,this._outerRadius_=t.outerRadius,function(i){return e._getRadarColumnPath(a(i),n(i),t.radian)}}}}},getPointDropAnimationAttr:function(t){var e=this;return{ease:"exp-out",duration:500,attrTween:{d:function(){var a=i(t.outerRadius,t.innerRadius);return function(i){return e._getRadarColumnPath(t.innerRadius,a(i),t.radian)}}}}},_onPointMouseOver:function(t){var e=t.series.getHighLightStyle(t);t.graphic.animate({duration:100,ease:"ease-out-in",style:e})},_onPointMouseOut:function(t){var e=t.series.getStyle(t);t.graphic.animate({duration:100,ease:"ease-out-in",style:e})},_getFixedPos:function(t,e){var i=t.radian,a=this.getCenter(),n=t.posX+a[0],r=t.posY+a[1];return i<Math.PI/2?r-=e.height:i>=Math.PI&&i<3*Math.PI/2?n-=e.width:i>=3*Math.PI/2&&i<2*Math.PI&&(r-=e.height,n-=e.width),[n,r]}});return t("../ChartLibrary").register(n.COLUMN_RADAR,r),r}),define("utils/Scale",["require","./BaseUtils","./Interpolator","./vMap"],function(t){function e(t){var e=t[0],i=t[t.length-1];return e<i?[e,i]:[i,e]}function i(t,e,i,a){var n=i(t[0],t[1]),r=a(e[0],e[1]);return function(t){return r(n(t))}}function a(t,e,i,a){var r=[],s=[],o=0,l=Math.min(t.length,e.length)-1;for(t[l]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<=l;)r.push(i(t[o-1],t[o])),s.push(a(e[o-1],e[o]));return function(e){var i=n(t,e,1,l)-1;return s[i](r[i](e))}}function n(t,e,i,a){for(arguments.length<3&&(i=0),arguments.length<4&&(a=t.length);i<a;){var n=i+a>>>1;r(t[n],e)>0?a=n:i=n+1}return i}function r(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function s(t,e){return p.rebind(t,e,"range","rangeRound","interpolate")}function o(t,e,n,r){function s(){var s=Math.min(t.length,e.length)>2?a:i;return c=s(t,e,r,n),h=s(e,t,r,n),l}function l(t){return c(t)}var c,h;return l.invert=function(t){return h(t)},l.domain=function(e){return arguments.length?(t=e.map(Number),s()):t},l.range=function(t){return arguments.length?(e=t,s()):e},l.rangeRound=function(t){return l.range(t).interpolate(f.interpolateRound)},l.interpolate=function(t){return arguments.length?(n=t,s()):n},l.uninterpolate=function(t){return arguments.length?(r=t,s()):r},l.copy=function(){return o(t,e,n,r)},s()}function l(t,e,i,a){function n(t){return(i?Math.log(t<0?0:t):-Math.log(t>0?0:-t))/Math.log(e)}function r(t){return i?Math.pow(e,t):-Math.pow(e,-t)}function o(e){return t(n(e))}return o.invert=function(e){return r(t.invert(e))},o.domain=function(e){return arguments.length?(i=e[0]>=0,t.domain((a=e.map(Number)).map(n)),o):a},o.base=function(i){return arguments.length?(e=+i,t.domain(a.map(n)),o):e},o.copy=function(){return l(t.copy(),e,i,a)},s(o,t)}function c(t,i){function a(e){return s[((r.get(e)||("range"===i.t?r.set(e,t.push(e)):NaN))-1)%s.length]}function n(e,i){for(var a=[],n=t.length,r=0;r<n;r++)a.push(e+i*r);return a}var r,s,o;return a.domain=function(e){if(!arguments.length)return t;t=[],r=new m;for(var n,s=-1,o=e.length;++s<o;)r.has(n=e[s])||r.set(n,t.push(n));return a[i.t].apply(a,i.a)},a.range=function(t){return arguments.length?(s=t,o=0,i={t:"range",a:arguments},a):s},a.rangePoints=function(e,r){arguments.length<2&&(r=0);var l=e[0],c=e[1],h=t.length<2?(l=(l+c)/2,0):(c-l)/(t.length-1+r);return s=n(l+h*r/2,h),o=0,i={t:"rangePoints",a:arguments},a},a.rangeRoundPoints=function(e,r){arguments.length<2&&(r=0);var l=e[0],c=e[1],h=t.length<2?(l=c=Math.round((l+c)/2),0):(c-l)/(t.length-1+r)|0;return s=n(l+Math.round(h*r/2+(c-l-(t.length-1+r)*h)/2),h),o=0,i={t:"rangeRoundPoints",a:arguments},a},a.rangeBands=function(e,r,l){arguments.length<2&&(r=0),arguments.length<3&&(l=r);var c=e[1]<e[0],h=e[c-0],u=(e[1-c]-h)/(t.length-r+2*l);return s=n(h+u*l,u),c&&s.reverse(),o=u*(1-r),i={t:"rangeBands",a:arguments},a},a.rangeRoundBands=function(e,r,l){arguments.length<2&&(r=0),arguments.length<3&&(l=r);var c=e[1]<e[0],h=e[c-0],u=e[1-c],d=Math.floor((u-h)/(t.length-r+2*l));return s=n(h+Math.round((u-h-(t.length-r)*d)/2),d),c&&s.reverse(),o=Math.round(d*(1-r)),i={t:"rangeRoundBands",a:arguments},a},a.rangeBand=function(){return o},a.rangeExtent=function(){return e(i.a[0])},a.copy=function(){return c(t,i)},a.domain(t)}function h(t,e,i){function a(e){return i[Math.max(0,Math.min(s,Math.floor(r*(e-t))))]}function n(){return r=i.length/(e-t),s=i.length-1,a}var r,s;return a.domain=function(i){return arguments.length?(t=+i[0],e=+i[i.length-1],n()):[t,e]},a.range=function(t){return arguments.length?(i=t,n()):i},a.invertExtent=function(e){return e=i.indexOf(e),e=e<0?NaN:e/r+t,[e,e+1/r]},a.copy=function(){return h(t,e,i)},n()}function u(){return o([0,1],[0,1],f.interpolateNumber,f.uninterpolateNumber)}function d(){return h(0,1,[0,1])}var p=t("./BaseUtils"),f=t("./Interpolator"),m=t("./vMap");return{linear:u,quantize:d,log:function(){return l(u().domain([0,1]),10,!0,[1,10])},quantize:d,ordinal:function(){return c([],{t:"range",a:[[]]})}}}),define("chart/Gauge",["require","../Constants","../utils/BaseUtils","./Series","../utils/QueryUtils","../utils/BoundsManager","../utils/ColorUtils","../component/FormattedText"],function(t){var e=t("../Constants"),i=t("../utils/BaseUtils"),a=t("./Series"),n=(t("../utils/QueryUtils"),t("../utils/BoundsManager"),t("../utils/ColorUtils")),r=t("../component/FormattedText");return a.extend({DEFAULT_PADDING:5,LINE_GAP:.3,VERTICAL_GAP:.3,HORIZONTAL_GAP:.8,ANIMATION_TIME:1e3,EASE_TYPE:"quad-out",refresh:function(t,e){return a.prototype.refresh.call(this,t,e),t=this.options,this.gaugeType=t.style,this.center=null,t.center&&(this.center=[this._getPercentValue(t.center[0],this.vanchart.width),this._getPercentValue(t.center[1],this.vanchart.height)]),i.convertToREMUseDefault16PX(t.seriesLabel&&t.seriesLabel.style),i.convertToREMUseDefault16PX(t.valueLabel&&t.valueLabel.style),i.convertToREMUseDefault16PX(t.percentageLabel&&t.percentageLabel.style),this},doLayout:function(){var t=this._calculateGaugeBounds(),e=this,i=e.options;if(!t&&!i.radius&&!e.center)throw new Error("gauge has no bounds");this.bounds=t,this._calculatePercentage(),e.defaultBands=(i.bands||[]).concat(e._getDefaultBands(e.gaugeAxis.scale.domain())),e.points.forEach(function(t){var i=e._getColorFromBands(t.getTargetValue(),e.defaultBands);i&&(i=n.getStandardColorAndOpacity(i),t.color=i.hex,t.opacity=i.alpha),t.mouseOverColor=n.getHighLightColor(t.color),t.clickColor=n.getClickColor(t.color)}),this._doLayout()},_doLayout:function(){this._dealPercentLabel(),this._dealValueLabel(),this._fixCenterAndRadius()},calculateLabelInfo:function(t){},_createGroup:function(t,e){return t.group().addTo(e.seriesGroup)},_getAxisTypes:function(){return["gaugeAxis"]},getDataToDraw:function(){return[]},_calculatePercentage:function(){if(this.points.length){var t=this.gaugeAxis.scale.domain(),e=this.points;e.forEach(function(i){i.points=e,i.percentage=(i.value-t[0])/(t[1]-t[0])})}},_calculateLabelPos:function(){},_getTranslate:function(){return[Math.round(this.centerX),Math.round(this.centerY)]},_validPoint:function(){return this.points.filter(function(t){return!t.isNull})[0]||this.points[0]},_dealSeriesLabel:function(){var t=this,e=t.options;if(t.seriesLabelContent="",t.seriesLabelDim={width:0,height:0},e.seriesLabel&&e.seriesLabel.enabled){var i=e.seriesLabel.style,a=t._validPoint();r.dataLabelGenerator(a,e.seriesLabel);var n=a.labelContent,s=a.labelDim;t.seriesLabelContent=n&&n[0]?n[0].text:"",t.seriesLabelStyle=i,t.seriesLabelDim=s}},_dealPercentLabel:function(){var t=this,e=t.options.percentageLabel;t.percentageLabelContent="",t.percentageLabelDim={width:0,height:0};var a=t.points[0];if(a&&!a.isNull&&e&&e.enabled){var n=i.clone(e.style);n.color||(n.color=a.color),r.dataLabelGenerator(a,e);var s=a.labelContent,o=a.labelDim;t.percentageLabelContent=s&&s[0]?s[0].text:"",t.percentageLabelStyle=n,t.percentageLabelDim=o}},_dealValueLabel:function(){var t=this,e=t.options.valueLabel,a=e.style,n=e.useHtml,s=e.formatter;if(t.valueLabelContent="",t.valueLabelDim={width:0,height:0},e&&e.enabled){for(var o=[],l=0,c=t.points.length;l<c;l++){var h=t.points[l];if(!h.isNull){var u=r.calculateSingleLineLabelContent(s,h),d=i.getTextDimension(u,a,n);o.push({labelContent:u,labelDim:d,labelStyle:a})}}t.valueLabelContent=o}},_getDefaultBands:function(t){var e=this.options.color,a=[];if(e)a.push({from:t[0],to:t[1],color:e});else{var n=t[0],r=t[1],s=i.accDiv(r-n,3),o=i.accAdd(n,s),l=i.accAdd(o,s),c=this.vanchart.options.colors;a=[{from:n,to:o,color:c[0]},{from:o,to:l,color:c[1]},{from:l,to:r,color:c[2]}]}return a},_getColorFromBands:function(t,e){if(e&&e.length)for(var i=0,a=e.length;i<a;i++){var n=e[i],r=Math.min(n.from,n.to),s=Math.max(n.from,n.to);if(t>=r&&t<=s)return n.color}},_calculateGaugeBounds:function(){for(var t=this.vanchart.seriesOfType(e.GAUGE_CHART),i=this.vanchart.bounds,a=0,n=0,r=t.length;n<r;n++)t[n].center&&t[n].options.radius&&a++;for(var s=this.options.layout==e.HORIZONTAL_LAYOUT,o=i[s?"width":"height"]/Math.max(1,t.length-a),n=0,r=t.length;n<r;n++)if(t[n]==this&&!this.center)return s?{x:i.x+n*o,y:i.y,width:o,height:i.height}:{x:i.x,y:i.y+n*o,width:i.width,height:o};return{x:0,y:0,width:0,height:0}},_getFixedPos:function(t,e){var i,a,n=t.series;return"pointer_semi"==n.style?(i=n.centerX-e.width/2,a=n.centerY+.14*n.radius+10):(i=n.centerX+n.radius+10,a=n.centerY-e.height/2),[i,a]},_animateEnd:function(){},_getPointTextLabelGroup:function(){if(!this.textGraphicGroup){var t=this.vanchart,e=(t.seriesTextRenderGroup,t.seriesTextDivGroup);this.textGraphicGroup=t.renderer.vgroup(),this.textGraphicGroup.renderG.addTo(this.group),e.append(this.textGraphicGroup.divG)}return this.textGraphicGroup.divG.attr("transform",i.makeTranslate(this._getTranslate())),this.textGraphicGroup},_drawGaugeLabels:function(t){var e=this,i=e.vanchart;e._removeNormalLabels(t);var a=0;i._needShowMoreLabel()&&e.visible&&(e._drawDiffMoreLabels(),a=1e3),i.setTimeout(e.className+"more_label_animate",function(){i._removeChangeDataState(e),e._clearMoreLabels(),e._drawNormalLabels(t)},a)},_drawDiffMoreLabels:function(){var t=this.points[0];t&&!t.isNull&&this._showAndExitMoreLabel(t,0,0)},_removeNormalLabels:function(t){for(var e=t.labels||[],i=0,a=e.length;i<a;i++)e[i]&&e[i].remove(),e[i]=null},_drawNormalLabels:function(t){var e=this,a=e.options,r=e.vanchart.renderer;if(t.labels=[],e.seriesLabelContent&&e._drawLabel(t,e.seriesLabelContent,e.seriesLabelPos,e.seriesLabelDim,e.seriesLabelStyle,a.seriesLabel.useHtml),e.percentageLabelContent&&e._drawLabel(t,e.percentageLabelContent,e.percentageLabelPos,e.percentageLabelDim,e.percentageLabelStyle,a.percentageLabel.useHtml),e.valueLabelContent&&e.valueLabelContent.length){if(e.valueLabelBackground){var s=i.rectSubPixelOpt(e.valueLabelBackground,0);s.rx=s.rx=.02*e.radius;c=e.options.valueLabel;t.labels.push(t.append(r.rect(s).style({fill:c.backgroundColor,"fill-opacity":n.getColorOpacity(c.backgroundColor),filter:"url(#"+i.stamp(e.innerFilter)+")"})))}for(var o=0,l=e.valueLabelContent.length;o<l;o++){var c=e.valueLabelContent[o];e._drawLabel(t,c.labelContent,c.labelPos,c.labelDim,c.labelStyle,a.valueLabel.useHtml)}}},_drawLabel:function(t,e,a,n,r,s){if(a){var o=this.vanchart.renderer,l=i.getTextHeight(r);t.labels.push(t.append(o.vtext(s).attr({x:a.x,y:a.y,dy:.85*l}).textContent(e).style(r)))}},_onSinglePointerTap:function(t){this.points&&1===this.points.length&&this.points[0].onClick(t.srcEvent)},_onSeriesMouseOver:function(t){this.points&&1===this.points.length&&this.vanchart.showTooltip(this.points[0],t)},_onSeriesMouseOut:function(){this.vanchart.hideTooltip()},getClosestPoint:function(){return 1===this.points.length?this.points[0]:null},_getStroke:function(t){return i.isSupportSVG()?"url(#"+i.stamp(t)+")":t},getEvents:function(){return{mousemove:this._onSeriesMouseOver,mouseout:this._onSeriesMouseOut,tap:this._onSinglePointerTap,press:this.onSeriesPress,pressup:this.onSeriesPressUp}},isSupportLegendHighlight:function(){return!1},isSeriesAccumulated:function(){return!0}})}),define("chart/PointerGauge",["require","../Constants","../utils/BaseUtils","../utils/ColorUtils","../utils/BoundsManager","../utils/PathGenerator","../utils/Interpolator","../utils/Scale","./Gauge","../ChartLibrary","../ChartLibrary"],function(t){var e=t("../Constants"),i=t("../utils/BaseUtils"),a=t("../utils/ColorUtils"),n=t("../utils/BoundsManager"),r=t("../utils/PathGenerator"),s=t("../utils/Interpolator"),o=t("../utils/Scale"),l=t("./Gauge").extend({gaugeType:e.POINTER_GAUGE,_doLayout:function(){this._dealSeriesLabel(),this._dealValueLabel(),"pointer"==this.options.style?this._fixPointerCenter():this._fixPointerSemiCenter()},_drawDiffMoreLabels:function(){var t=this,e=t.points,a=i.getTextHeight(t._getMoreLabelStyle()),n=a*e.length+a/2*(e.length-1),r=Math.max(0,(t.radius-n)/2),s="pointer"==t.options.style?r:-t.radius+r;e.forEach(function(e){t._showAndExitMoreLabel(e,0,s+a/2),s+=a+a/2})},getDataToDraw:function(){return this.points},_fixPointerCenter:function(){var t=this,i=t.options,a=i.radius,n=t.center,r=i.seriesLabel.align||e.BOTTOM;if(n)t.centerX=n[0],t.centerY=n[1],t.radius=a;else{var s=t.bounds,o=20+t.seriesLabelDim.height,l=s.height-o,c=s.x+s.width/2,h=s.y+s.height/2;if(a=a||Math.min(s.width,l)/2-t.DEFAULT_PADDING,r==e.BOTTOM)h+a+o>s.y+s.height&&(u=s.height-(2*a+o))>=0&&(h=s.y+a+u/2);else if(h-a-o<s.y){var u=s.height-(2*a+o);u>=0&&(h=s.y+a+o+u/2)}t.centerX=c,t.centerY=h,t.radius=a}if(t.seriesLabelContent){var d=t.seriesLabelDim;t.seriesLabelPos={x:-d.width/2,y:r==e.BOTTOM?a+20:-a-20-d.height}}t.valueLabelContent&&this._dealValueLabelContent(t,a)},_fixPointerSemiCenter:function(){var t=this,i=t.options,a=i.radius,n=i.seriesLabel.align;if(t.center)t.centerX=t.center[0],t.centerY=t.center[1],t.radius=a;else{var r=t.bounds,s=20+t.seriesLabelDim.height,o=r.height-s;a=a||Math.min(r.width/2,o/1.14)-t.DEFAULT_PADDING;var l=r.x+r.width/2,c=r.y+r.height/2+a/2;if(n==e.BOTTOM)c+.14*a+s>r.y+r.height&&(h=r.height-(1.14*a+s))>=0&&(c=r.y+a+h/2);else if(c-a-s<r.y){var h=r.height-(1.14*a+s);h>=0&&(c=r.y+a+s+h/2)}t.centerX=l,t.centerY=c,t.radius=a}if(t.seriesLabelContent){var u=t.seriesLabelDim;t.seriesLabelPos={x:-u.width/2,y:n==e.BOTTOM?.14*a+20:-a-20-u.height}}t.valueLabelContent&&this._dealSemiValueLabelContent(t,a)},_dealValueLabelContent:function(t,e){for(var a=t.options,n=t.gaugeAxis,r=n.options,s=n.scale.domain(),l=o.linear().domain(s).range([i.toRadian(-150),i.toRadian(150)]),c=i.getTextHeight(r.labelStyle),h=.16*e+c/2,u=a.valueLabel.style,d=a.valueLabel.useHtml,p=i.getTextHeight(u),f=this._getPointerTickBoundsManager(n,e,l,c),m=f.heightBoundsManager,g=f.widthBoundsManager,v=0,y=h,M=Number.MAX_VALUE,F=0,_=t.valueLabelContent.length;F<_;F++){var T=t.valueLabelContent[F],b=Math.min(-T.labelDim.width/2-p/4,M),x={x:b,y:y,width:2*Math.abs(b),height:h+p*(1+this.LINE_GAP)-y},C=T.labelContent,w=!1;if(!t._boundsInCircle(x))break;if(m.isOverlapped(x))break;for(;g.isOverlapped(x)&&C.length;){C=C.substr(0,Math.floor(.9*C.length));var E=i.getTextDimension(C+"...",u,d);x={x:b=Math.min(-E.width/2-p/4,M),y:y,width:2*Math.abs(b),height:h+p*(1+this.LINE_GAP)-y},w=!0}w&&(T.labelContent=C+"...",T.labelDim=i.getTextDimension(T.labelContent,u,d),b=Math.min(-T.labelDim.width/2-p/4,M)),T.labelPos={x:-T.labelDim.width/2,y:h+p/2},h+=p*(1+this.LINE_GAP),M=b,v++}t.valueLabelContent.length=v,t.valueLabelBackground={x:M,y:y,width:2*Math.abs(M),height:p*(1+this.LINE_GAP)*v+p}},_dealSemiValueLabelContent:function(t,e){for(var a=t.options,n=t.gaugeAxis,r=n.options,s=n.scale.domain(),l=o.linear().domain(s).range([i.toRadian(-90),i.toRadian(90)]),c=a.valueLabel.style,h=a.valueLabel.useHtml,u=i.getTextHeight(c),d=i.getTextHeight(r.labelStyle),p=-(.11*e+d/2)-u,f=this._getPointerTickBoundsManager(n,e,l,d),m=f.heightBoundsManager,g=f.widthBoundsManager,v=0,y=p,M=Number.MAX_VALUE,F=0,_=t.valueLabelContent.length;F<_;F++){var T=t.valueLabelContent[F];y-=u*(1+this.LINE_GAP);var b=Math.min(-T.labelDim.width/2-u/4,M),x={x:b,y:y,width:2*Math.abs(b),height:p-y},C=T.labelContent,w=!1;if(!t._boundsInCircle(x)){y+=u*(1+this.LINE_GAP);break}if(m.isOverlapped(x)){y+=u*(1+this.LINE_GAP);break}for(;g.isOverlapped(x)&&C.length;){C=C.substr(0,Math.floor(.9*C.length));var E=i.getTextDimension(C+"...",c,h);x={x:b=Math.min(-E.width/2-u/4,M),y:y,width:2*Math.abs(b),height:p-y},w=!0}w&&(T.labelContent=C+"...",T.labelDim=i.getTextDimension(T.labelContent,c,h),b=Math.min(-T.labelDim.width/2-u/4,M)),M=b,v++}t.valueLabelContent.length=v;for(F=0;F<v;F++)(T=t.valueLabelContent[F]).labelPos={x:-T.labelDim.width/2,y:y+u/2+F*u*(1+this.LINE_GAP)};t.valueLabelBackground={x:M,y:y,width:2*Math.abs(M),height:u*(1+this.LINE_GAP)*v+u}},_boundsInCircle:function(t){for(var e=this.radius,i=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x,y:t.y+t.height},{x:t.x+t.width,y:t.y+t.height}],a=0;a<4;a++){var n=i[a],r=Math.abs(n.x),s=Math.abs(n.y);if(Math.pow(r*r+s*s,.5)>e)return!1}return!0},_getPointerTickBoundsManager:function(t,e,i,a){var r=new n,s=new n,o=.84*e,l=this,c=.5*a;t.tickData.forEach(function(t){var e=i(t.tickValue),a=l._getPointerTickCenter(t,o,i);l._addToBoundsManager(e,{x:a.x-t.tickDim.width/2-c,y:a.y-t.tickDim.height/2-c,width:t.tickDim.width+c,height:t.tickDim.height+c},r,s)});var h=.85*e,u=.1*e;return(t.getMinorTickData()||[]).forEach(function(t){var e,a,n=i(t),o=l._getArcPoint(h,n);n<Math.PI?(e=o[0],a=o[1]):(e=o[0]-u,a=o[1]),l._addToBoundsManager(n,{x:e,y:a,width:u,height:u},r,s)}),{widthBoundsManager:r,heightBoundsManager:s}},_addToBoundsManager:function(t,e,i,a){t>-Math.PI/4&&t<Math.PI/4&&a.addBounds(e),(t<3*-Math.PI/4||t>3*-Math.PI/4)&&a.addBounds(e),i.addBounds(e)},_getPointerTickCenter:function(t,e,i){var a,n,r=i(t.tickValue),s=this._getArcPoint(e,r),o=s[0],l=s[1],c=t.tickDim,h=Math.atan(c.width/c.height);if(Math.abs(r)<h)a=o+(u=c.height/2)*o/l,n=l+u;else if(r>=h&&r<=Math.PI-h)a=o-(u=c.width/2),n=l-u*l/o;else if(r>=h-Math.PI&&r<=-h)a=o+(u=c.width/2),n=l+u*l/o;else{var u=c.height/2;a=o-u*o/l,n=l-u}return{x:a,y:n}},drawSeries:function(){var t=this,e=t.vanchart,i=e.renderer,a=t.group;this.backgruondPath||(this.backgruondPath=i.path().addTo(a),this.hingePath=i.path().addTo(a),this.labelGroup=this._getPointTextLabelGroup(),this.axisGroup=this.labelGroup,this.needleGroup=i.group().addTo(a),this.pointerHingePath=i.path().addTo(a)),e.registerInteractiveTarget(this,a),this.labelGroup=this._getPointTextLabelGroup(),this.dropFilter||(this.dropFilter=i.createDropShadowFilter(0,2,.1,2),this.innerFilter=i.createInnerShadowFilter(0,2,.1,2)),"pointer"==this.options.style?this._drawPointer(180,.16,.07):this._drawPointer(98,.11,.055)},onSeriesPress:function(){var t=r.arc().startAngle(0).endAngle(2*Math.PI).innerRadius(0),e="pointer"==this.options.style?.16:.11,i="pointer"==this.options.style?.07:.055;t.outerRadius(e*this.radius*1.25),this.hingePath.attr("d",t()),t.outerRadius(i*this.radius*1.25),this.pointerHingePath.attr("d",t())},onSeriesPressUp:function(){var t=r.arc().startAngle(0).endAngle(2*Math.PI).innerRadius(0),e="pointer"==this.options.style?.16:.11,i="pointer"==this.options.style?.07:.055;t.outerRadius(e*this.radius),this.hingePath.attr("d",t()),t.outerRadius(i*this.radius),this.pointerHingePath.attr("d",t())},_getScale:function(){var t=this,e="pointer"==t.options.style?150:90,a=t.gaugeAxis.scale.domain();return o.linear().domain(a).range([i.toRadian(-e),i.toRadian(e)])},getStyle:function(t){var e=t.options;return{fill:e.needle,"fill-opacity":a.getColorOpacity(e.needle)}},getPointGraphicKey:function(){return"path"},_getPointGraphicGroup:function(){return this.needleGroup},getPointInitAnimationAttr:function(t){var e=t.series,a=e._getScale();return{duration:e.ANIMATION_TIME,ease:e.EASE_TYPE,attrTween:{d:function(){var n=this._current_||a.domain()[0];this._current_=i.getValueInDomain(t.value,a.domain());var r=s(n,this._current_);return function(t){return e._getArrowPath(r(t))}}}}},getPointUpdateAnimationAttr:function(t){return this.getPointInitAnimationAttr(t)},_getArrowPath:function(t){var e=this._getScale()(t),i=this.radius,a=this._getArcPoint(.9*i,e),n=this._getArcPoint(.02*i,e+Math.PI/2),r=this._getArcPoint(.02*i,e-Math.PI/2);return"M"+a[0]+","+a[1]+"L"+n[0]+","+n[1]+"L"+r[0]+","+r[1]+"Z"},_drawPointer:function(t,e,n){var s=this,o=s.options,l=s.radius,c=r.arc().startAngle(0).endAngle(2*Math.PI).innerRadius(0),h=r.arc().startAngle(i.toRadian(-t)).endAngle(i.toRadian(t)).innerRadius(0).outerRadius(l).toCenter(!1);s.backgruondPath.attr("d",h()).style({fill:o.paneBackgroundColor,"fill-opacity":a.getColorOpacity(o.paneBackgroundColor),filter:"url(#"+i.stamp(s.dropFilter)+")"}),c.outerRadius(e*l),s.hingePath.attr("d",c()).style({fill:o.hingeBackgroundColor,"fill-opacity":a.getColorOpacity(o.hingeBackgroundColor),filter:"url(#"+i.stamp(s.innerFilter)+")"}),this._drawPointerTicks(),this._drawGaugeLabels(s.labelGroup),c.outerRadius(n*l),s.pointerHingePath.attr("d",c()).style({fill:o.hinge,"fill-opacity":a.getColorOpacity(o.hinge),filter:"url(#"+i.stamp(s.dropFilter)+")"})},_drawPointerTicks:function(){var t=this,e=t.defaultBands,a=t.vanchart,n=t.gaugeAxis,r=a.renderer,s=this.axisGroup,o=n.getTickData(),l=n.getMinorTickData(),c=n.options,h=c.labelStyle,u=c.useHtml,d=.95*t.radius,p=.84*t.radius,f=this._getScale();this.ticks=this.ticks||[];var m=n._bindData(this.ticks,o,function(t){return f(t.tickValue)}),g=[];for(m.exit.map(function(t){t.text&&t.text.remove(),t.remove()}),g=m.enter.map(function(t){var e=s.append(r.line().datum(t));return i.hasDefined(t.tickContent)&&(e.text=s.append(r.vtext(u))),e}),this.ticks=g=g.concat(m.update),x=0,C=g.length;x<C;x++){var v=g[x],y=v.datum(),M=f(y.tickValue),F=t._getArcPoint(d,M),_=t._getArcPoint(d-.1*t.radius,M),T=t._getColorFromBands(y.tickValue,e);v.attr("x1",F[0]).attr("y1",F[1]).attr("x2",_[0]).attr("y2",_[1]).style({stroke:T,"stroke-width":1});var b=t._getPointerTickCenter(y,p,f);v.text&&v.text.textContent(y.tickContent).style(h).attr({x:b.x-y.tickDim.width/2,y:b.y-y.tickDim.height/2,dy:".85em"})}this.minorTics=this.minorTics||[];var x,C,g=[];for(x=0,C=(m=n._bindData(this.minorTics,l)).exit.length;x<C;x++)m.exit[x].remove();for(x=0,C=m.enter.length;x<C;x++)g.push(s.append(r.line().datum(m.enter[x])));for(this.minorTics=g=g.concat(m.update),x=0,C=g.length;x<C;x++){var w=g[x],E=w.datum(),M=f(E),F=t._getArcPoint(d,M),_=t._getArcPoint(d-.05*t.radius,M),T=t._getColorFromBands(E,e);w.attr("x1",F[0]).attr("y1",F[1]).attr("x2",_[0]).attr("y2",_[1]).style({stroke:T,"stroke-width":1})}}});return t("../ChartLibrary").register(e.POINTER_GAUGE,l),t("../ChartLibrary").register(e.POINTER_SEMI_GAUGE,l),l}),define("chart/SlotGauge",["require","../Constants","../utils/ColorUtils","../utils/BaseUtils","../utils/PathGenerator","../utils/Scale","./Gauge","../utils/Interpolator","../component/FormattedText","../ChartLibrary"],function(t){var e=t("../Constants"),i=t("../utils/ColorUtils"),a=t("../utils/BaseUtils"),n=t("../utils/PathGenerator"),r=t("../utils/Scale"),s=t("./Gauge"),o=t("../utils/Interpolator"),l=t("../component/FormattedText"),c=s.extend({gaugeType:e.SLOT_GAUGE,_getFixedPos:function(t,e){var i=t.series;return[i.centerX+1.08*i.radius+10,i.centerY-e.height/2]},_dealValueLabel:function(){var t=this,e=t.options,i=t.points[0];if(i&&!i.isNull){for(var n=e.valueLabel,r=n.useHtml,s=n.formatter,o=l.createMultiLineLabelContent(s,i),c=n.style,h=[],u=0,d=o.length;u<d;u++)h.push({labelContent:o[u],labelStyle:c,labelDim:a.getTextDimension(o[u],c,r)});t.valueLabelContent=h}},_fixCenterAndRadius:function(){var t=this,e=t.options,i=e.radius;if(t.center)t.centerX=t.center[0],t.centerY=t.center[1],t.radius=i;else{var n=t.bounds;i||(i=Math.min(n.width/2,n.height/2),i=i/1.08-t.DEFAULT_PADDING);var r=n.x+n.width/2,s=n.y+n.height/2;t.centerX=r,t.centerY=s,t.radius=i}if(t.percentageLabelContent&&t.valueLabelContent&&t.valueLabelContent.length>0){t.percentageLabelPos={x:-t.percentageLabelDim.width/2,y:-t.percentageLabelDim.height*(1+t.LINE_GAP)};for(var o=0,l=0,c=t.valueLabelContent.length;l<c;l++)(p=t.valueLabelContent[l]).labelPos={x:-p.labelDim.width/2,y:o},o+=p.labelDim.height*(1+t.LINE_GAP)}else if(t.percentageLabelContent)t.percentageLabelPos={x:-t.percentageLabelDim.width/2,y:-t.percentageLabelDim.height/2};else if(t.valueLabelContent&&t.valueLabelContent.length>0)for(var h=a.getTextHeight(e.valueLabel.style),u=t.valueLabelContent.length,d=h*u+h*(u-1)/2,o=-d/2,l=0;l<u;l++){var p=t.valueLabelContent[l];p.labelPos={x:-p.labelDim.width/2,y:o},o+=h*(1+t.LINE_GAP)}},drawSeries:function(){var t=this,e=t.options,s=t.points[0],l=t.vanchart.renderer,c=t.group;this.backgruondPath||(this.backgruondPath=l.path().addTo(c),this.slotBackground=l.path().addTo(c),this.needlePath=l.circle().addTo(c)),this.labelGroup=this._getPointTextLabelGroup(),this.innderShadow||(this.innderShadow=l.createInnerShadowFilter(0,2,.05,0),this.dropShadow=l.createDropShadowFilter(0,2,.05,0));var h=n.arc().startAngle(a.toRadian(-135)).endAngle(a.toRadian(135)).innerRadius(0).outerRadius(t.radius).toCenter(!1).closePath(!1),u=n.arc().startAngle(a.toRadian(-135)).endAngle(a.toRadian(135)).innerRadius(0).outerRadius(t.radius).toCenter(!1).closePath(!1),d=t.gaugeAxis.scale.domain(),p=r.linear().domain(d).range([a.toRadian(-135),a.toRadian(135)]);if(t.backgruondPath.attr("d",u()).style({fill:"none",stroke:e.slotBackgroundColor,"stroke-linecap":"round","stroke-width":.16*t.radius,filter:"url(#"+a.stamp(this.innderShadow)+")"}),s&&!s.isNull){var f=p(d[0]),m=p(a.getValueInDomain(s.value,d)),g=a.toDegree(m-f),v=(t._getColorFromBands(d[0],t.defaultBands),s.color);t.slotBackground.style({fill:"none",stroke:i.colorToHex(v),"stroke-linecap":"round","stroke-width":.16*t.radius});var y=this._getArcPoint(t.radius,f);if(t.needlePath.attr("cx",y[0]).attr("cy",y[1]).attr("r",.048*t.radius).style({fill:e.needle,"fill-opacity":i.getColorOpacity(e.needle),filter:"url(#"+a.stamp(this.dropShadow)+")"}),t.vanchart.renderer.isAnimation)t.slotBackground.animate({duration:t.ANIMATION_TIME,ease:t.EASE_TYPE,attrTween:{d:function(){this._lastRadian_=this._lastRadian_||f;var t=o(this._lastRadian_,m);return this._lastRadian_=m,function(e){return h.endAngle(t(e))()}}}}),t.needlePath.animate({duration:t.ANIMATION_TIME,ease:t.EASE_TYPE,attrTween:{transform:function(){this._lastRotate_=this._lastRotate_||0;var t=o(this._lastRotate_,g);return this._lastRotate_=g,function(e){return"rotate("+t(e)+")"}}}});else{var M=h.endAngle(m)(),F=t._getArcPoint(t.radius,m),_=F[0],T=F[1],b=.008*t.radius;Math.abs(m-f)<1e-6&&(M="M"+(_-b)+","+T+(h="a"+b+","+b+" 0 1,0 ")+2*b+",0 "+h+2*-b+",0 "),t.slotBackground.attr("d",M),t.needlePath.attr({cx:F[0],cy:F[1]})}this._drawGaugeLabels(this.labelGroup)}},_onSeriesMouseOver:function(t){s.prototype._onSeriesMouseOver.call(this,t);var e=this.points[0];if(e){var a=i.getHighLightColor(e.color),n=i.getHighLightColor(this.options.needle);this.slotBackground.style({stroke:i.colorToHex(a)}),this.needlePath.style({fill:n})}},_onSeriesMouseOut:function(t){s.prototype._onSeriesMouseOut.call(this,t);var e=this.points[0];e&&(this.slotBackground.style({stroke:e.color}),this.needlePath.style({fill:e.options.needle}))},onSeriesPress:function(){var t=this.points[0];if(t){var e=i.getColorWithDivider(t.color,1/.95),a=i.getColorWithDivider(this.options.needle,1/.95);this.slotBackground.style({stroke:i.colorToHex(e)}),this.needlePath.style({fill:a})}},onSeriesPressUp:function(){this._onSeriesMouseOver()}});return t("../ChartLibrary").register(e.SLOT_GAUGE,c),c}),define("chart/RingGauge",["require","../Constants","../utils/ColorUtils","../utils/BaseUtils","./Gauge","../utils/PathGenerator","../utils/Interpolator","../ChartLibrary"],function(t){var e=t("../Constants"),i=t("../utils/ColorUtils"),a=t("../utils/BaseUtils"),n=t("./Gauge"),r=t("../utils/PathGenerator"),s=t("../utils/Interpolator"),o=n.extend({gaugeType:e.RING_GAUGE,_fixCenterAndRadius:function(){var t,e,i=this,a=i.options.radius;if(i.center)t=i.center[0],e=i.center[1];else{var n=i.bounds;a=a||Math.min(n.width/2,n.height/2)-i.DEFAULT_PADDING,t=n.x+n.width/2,e=n.y+n.height/2}i.centerX=t,i.centerY=e,i.radius=a;var r=0,s=i.valueLabelContent?i.valueLabelContent[0]:null;i.percentageLabelContent&&s?r=i.percentageLabelDim.height*(1+i.LINE_GAP)+s.labelDim.height:i.percentageLabelContent?r=i.percentageLabelDim.height:s&&(r=s.labelDim.height);var o=-r/2;i.percentageLabelContent&&(i.percentageLabelPos={x:-i.percentageLabelDim.width/2,y:o},o+=i.percentageLabelDim.height*(1+i.LINE_GAP)),s&&(s.labelPos={x:-s.labelDim.width/2,y:o})},drawSeries:function(){var t=this,e=t.options,n=t.vanchart.renderer,o=t.group;if(this.backgruondPath||(this.backgruondPath=n.path().addTo(o),this.ringPath=n.path().addTo(o),this.innerBackgroundPath=n.path().addTo(o),this.innerStroke=n.path().addTo(o),this.outerStroke=n.path().addTo(o)),this.labelGroup=this._getPointTextLabelGroup(),!this.colorGradient){var l={x1:"0%",y1:"0%",x2:"0%",y2:"100%"},c={offset:"0%","stop-color":"#ffffff"},h={offset:"100%","stop-color":"#dddddd"};this.colorGradient=n.colorGradient(l,[c,h]),c["stop-color"]="#dddddd",h["stop-color"]="#ffffff",this.clickedGradient=n.colorGradient(l,[c,h]),a.isSupportSVG()||(this.colorGradient="#ffffff",this.clickedGradient="#dddddd")}var u=r.arc().startAngle(0).endAngle(2*Math.PI).innerRadius(0).outerRadius(t.radius),d=t.gaugeAxis.scale.domain(),p=(t._getColorFromBands(d[0],t.defaultBands),.8*t.radius),f=p+2,m=p-1.5;this.backgruondPath.attr("d",u()).style({fill:e.paneBackgroundColor,"fill-opacity":i.getColorOpacity(e.paneBackgroundColor)});var g=t.points[0];if(g){var v=r.arc().startAngle(0).innerRadius(0).outerRadius(t.radius),y=g.color,M=Math.max(g.percentage,0),F=2*Math.PI*M*(e.clockwise?1:-1);this.ringPath.style({fill:i.colorToHex(y),"fill-opacity":i.getColorOpacity(y)}),this.ringPath.animate({duration:t.ANIMATION_TIME,ease:t.EASE_TYPE,attrTween:{d:function(){this._lastRadian_=this._lastRadian_||0;var t=s(this._lastRadian_,F);return this._lastRadian_=F,function(e){return v.endAngle(t(e))()}}}})}this.innerBackgroundPath.attr("d",u.outerRadius(p)()).style({fill:e.innerPaneBackgroundColor,"fill-opacity":i.getColorOpacity(e.innerPaneBackgroundColor)}),this.outerStroke.attr("d",u.outerRadius(f)()).style({fill:"none",stroke:"#000000","stroke-opacity":.05,"stroke-width":4}),this.innerStroke.attr("d",u.outerRadius(m)()).style({fill:"none",stroke:this._getStroke(this.colorGradient),"stroke-width":3}),this._drawGaugeLabels(this.labelGroup)},_onSeriesMouseOver:function(t){n.prototype._onSeriesMouseOver.call(this,t);var e=this.points[0];e&&(this.innerStroke.style({stroke:this._getStroke(this.colorGradient)}),this.ringPath.style({fill:e.mouseOverColor}))},_onSeriesMouseOut:function(t){n.prototype._onSeriesMouseOut.call(this,t);var e=this.points[0];e&&(this.innerStroke.style({stroke:this._getStroke(this.colorGradient)}),this.ringPath.style({fill:e.color}))},onSeriesPress:function(){var t=this.points[0];t&&(this.innerStroke.style({stroke:this._getStroke(this.clickedGradient)}),this.ringPath.style({fill:t.clickColor}))},onSeriesPressUp:function(){this._onSeriesMouseOver()}});return t("../ChartLibrary").register(e.RING_GAUGE,o),o}),define("chart/ThermometerGauge",["require","../Constants","../utils/ColorUtils","../utils/BaseUtils","../utils/Scale","./Gauge","../ChartLibrary"],function(t){var e=t("../Constants"),i=t("../utils/ColorUtils"),a=t("../utils/BaseUtils"),n=t("../utils/Scale"),r=t("./Gauge"),s=r.extend({gaugeType:e.THERMOMETER_GAUGE,_drawDiffMoreLabels:function(){function t(t,e){return t-e/2}var i=this.points[0];if(i&&!i.isNull){var a=this.gaugeAxis.scale.domain(),r=this.options.thermometerLayout==e.VERTICAL_LAYOUT,s=n.linear().domain(a).range(r?[this.radius,-this.radius]:[-this.radius,this.radius])(i.y),o=r?-10:s,l=r?s:-10;this._showAndExitMoreLabel(i,o,l,t,t)}},_fixCenterAndRadius:function(){var t=(this.points[0],this),i=t.options.thermometerLayout==e.HORIZONTAL_LAYOUT?this._fixHorizontalThermometerCenter():this._fixVerticalThermometerCenter(),a=i.centerX,n=i.centerY,r=i.radius,s=t.valueLabelContent?t.valueLabelContent[0]:null;if(t.percentageLabelContent&&(t.percentageLabelPos.x-=a,t.percentageLabelPos.y-=n,t.percentageLabelPos.y=Math.min(t.percentageLabelPos.y,r-t.percentageLabelDim.height)),s){s.labelPos.x-=a,s.labelPos.y-=n;var o=r-s.labelDim.height-s.labelPos.y;o<0&&(s.labelPos.y+=o,t.percentageLabelContent&&(t.percentageLabelPos.y+=o))}t.centerX=a,t.centerY=n,t.radius=r},_fixHorizontalThermometerCenter:function(){var t,i,a,n=this,r=n.options,s=n.gaugeAxis,o=r.percentageLabel,l=r.valueLabel,c=n.valueLabelContent?n.valueLabelContent[0]:null,h=n.options.radius,u=this._getThermometerSize();if(n.center)t=n.center[0],i=n.center[1],a=i;else{var d=n.bounds;a=d.y+(d.height-u)/2,t=d.x+d.width/2,h=h||d.width/2-s.getMaxTickWidth()-n.DEFAULT_PADDING}return(n.percentageLabelContent||c)&&(n.percentageLabelContent&&c&&o.align==e.TOP&&l.align==e.TOP?(n.center&&(a-=n.percentageLabelDim.height*(1+n.LINE_GAP),a-=c.labelDim.height*(1+n.HORIZONTAL_GAP),a-=s.getTickHeight()+4+6+4+5),n.percentageLabelPos={x:-n.percentageLabelDim.width/2+t,y:a},a+=n.percentageLabelDim.height*(1+n.LINE_GAP),c.labelPos={x:-c.labelDim.width/2+t,y:a},a+=c.labelDim.height*(1+n.HORIZONTAL_GAP)):(n.percentageLabelContent&&o.align==e.TOP&&(n.center&&(a-=n.percentageLabelDim.height*(1+n.HORIZONTAL_GAP),a-=s.getTickHeight()+4+6+4+5),n.percentageLabelPos={x:-n.percentageLabelDim.width/2+t,y:a},a+=n.percentageLabelDim.height*(1+n.HORIZONTAL_GAP)),c&&l.align==e.TOP&&(n.center&&(a-=c.labelDim.height*(1+n.HORIZONTAL_GAP),a-=s.getTickHeight()+4+6+4+5),c.labelPos={x:-c.labelDim.width/2+t,y:a},a+=c.labelDim.height*(1+n.HORIZONTAL_GAP)))),n.center?a=i+5:(a+=s.getTickHeight()+4+6+4+10,i=a-5),(n.percentageLabelContent||c)&&(n.percentageLabelContent&&c&&o.align==e.BOTTOM&&l.align==e.BOTTOM?(a+=n.percentageLabelDim.height*n.HORIZONTAL_GAP,n.percentageLabelPos={x:-n.percentageLabelDim.width/2+t,y:a},a+=n.percentageLabelDim.height*(1+n.LINE_GAP),c.labelPos={x:-c.labelDim.width/2+t,y:a}):(n.percentageLabelContent&&o.align==e.BOTTOM&&(a+=n.percentageLabelDim.height*n.HORIZONTAL_GAP,n.percentageLabelPos={x:-n.percentageLabelDim.width/2+t,y:a}),c&&l.align==e.BOTTOM&&(a+=c.labelDim.height*n.HORIZONTAL_GAP,c.labelPos={x:-c.labelDim.width/2+t,y:a}))),{centerX:t,centerY:i,radius:h}},_fixVerticalThermometerCenter:function(){var t,i,r,s=this,o=s.options,l=s.gaugeAxis,c=o.percentageLabel,h=o.valueLabel,u=o.radius,d=s.points[0],p=l.scale.domain(),f=s.valueLabelContent?s.valueLabelContent[0]:null,m=this._getThermometerSize();if(s.center)t=s.center[0],i=s.center[1],r=t-10;else{var g=s.bounds;r=g.x+(g.width-m)/2,i=g.y+g.height/2,u=u||g.height/2-l.getTickHeight()-s.DEFAULT_PADDING}var v=i+n.linear().domain(p).range([u,-u])(a.getValueInDomain(d.value,p));return s.percentageLabelDim&&(v-=s.percentageLabelDim.height/3),(s.percentageLabelContent||f)&&(s.percentageLabelContent&&f&&c.align==e.LEFT&&h.align==e.LEFT?(s.center||(r+=Math.max(s.percentageLabelDim.width,f.labelDim.width),t=r+5),s.percentageLabelPos={x:r-s.percentageLabelDim.width,y:v},f.labelPos={x:r-f.labelDim.width,y:v+s.percentageLabelDim.height*(1+s.LINE_GAP)},r+=s.LINE_GAP*Math.max(s.percentageLabelDim.height,f.labelDim.height)):(s.percentageLabelContent&&c.align==e.LEFT&&(s.center&&(r-=s.percentageLabelDim.width+s.LINE_GAP*s.percentageLabelDim.height),s.percentageLabelPos={x:r,y:v},r+=s.percentageLabelDim.width+s.LINE_GAP*s.percentageLabelDim.height),f&&h.align==e.LEFT&&(s.center&&(r-=f.labelDim.width+s.LINE_GAP*f.labelDim.height),f.labelPos={x:r,y:v},r+=f.labelDim.width+s.LINE_GAP*f.labelDim.height))),s.center?r=t-5:t=r+5,r+=24+l.getMaxTickWidth(),(s.percentageLabelContent||f)&&(s.percentageLabelContent&&f&&c.align==e.RIGHT&&h.align==e.RIGHT?(r+=s.LINE_GAP*Math.max(s.percentageLabelDim.height,f.labelDim.height),s.percentageLabelPos={x:r,y:v},f.labelPos={x:r,y:v+s.percentageLabelDim.height*(1+s.LINE_GAP)}):(s.percentageLabelContent&&c.align==e.RIGHT&&(s.percentageLabelPos={x:r+s.LINE_GAP*s.percentageLabelDim.height,y:v}),f&&h.align==e.RIGHT&&(f.labelPos={x:r+s.LINE_GAP*f.labelDim.height,y:v}))),{centerX:t,centerY:i,radius:u}},_getThermometerSize:function(){var t=this,i=t.options,a=i.valueLabel,n=t.gaugeAxis,r=t.valueLabelContent?t.valueLabelContent[0]:null,s=i.percentageLabel;if(t.options.thermometerLayout==e.HORIZONTAL_LAYOUT){var o=0;return t.percentageLabelContent&&r?s.align==a.align&&(o+=t.percentageLabelDim.height+r.labelDim.height,o+=t.LINE_GAP*t.percentageLabelDim.height,o+=t.HORIZONTAL_GAP*(a.align==e.TOP?r.labelDim.height:t.percentageLabelDim.height)):t.percentageLabelContent?o+=(1+t.HORIZONTAL_GAP)*t.percentageLabelDim.height:r&&(o+=(1+t.HORIZONTAL_GAP)*r.labelDim.height),o+=24+n.getTickHeight()}var l=0;return t.percentageLabelContent&&r?s.align==a.align?(l+=Math.max(t.percentageLabelDim.width,r.labelDim.width),l+=t.VERTICAL_GAP*Math.max(t.percentageLabelDim.height,r.labelDim.height)):(l+=t.percentageLabelDim.width+r.labelDim.width,l+=t.VERTICAL_GAP*(t.percentageLabelDim.height+r.labelDim.height)):t.percentageLabelContent?l+=t.percentageLabelDim.width+t.VERTICAL_GAP*t.percentageLabelDim.height:r&&(l+=r.labelDim.width+t.VERTICAL_GAP*r.labelDim.height),l+=n.getMaxTickWidth(),l+=24},drawSeries:function(){var t=this,r=t.options,s=t.points[0],o=t.vanchart.renderer,l=t.group,c=t.gaugeAxis.scale.domain(),h=t.options.thermometerLayout==e.VERTICAL_LAYOUT,u=a.getValueInDomain(s.value,c),d=s.color,p=t.radius;if(!this.backgruondLine){this.backgruondLine=o.line().addTo(l),this.thermometerLine=o.line().addTo(l),this.needlePath=o.circle().addTo(l),this.axisGroup=o.group().addTo(l);var f=d,m=i.mixColorWithHSB(f,0,-.1,.1),g=i.getStandardColorAndOpacity(f).alpha;g<1&&(m=i.mixColorWithAlpha(m,g));var v="0%",y="0%";h?y="100%":v="100%";var M={offset:"0%","stop-color":h?f:m},F={offset:"100%","stop-color":h?m:f};this.colorGradient=o.colorGradient({x1:"0%",y1:"0%",x2:v,y2:y},[M,F]);var _=i.getColorWithDivider(f,1/.95),T=i.mixColorWithHSB(f,0,-.1,.1);M={offset:"0%","stop-color":h?_:T},F={offset:"100%","stop-color":h?T:_},this.clickedColorGradient=o.colorGradient({x1:"0%",y1:"0%",x2:v,y2:y},[M,F]);var b=i.getColorWithDivider(s.mouseOverColor,1/.95),x=i.mixColorWithHSB(s.mouseOverColor,0,-.1,.1);M={offset:"0%","stop-color":h?b:x},F={offset:"100%","stop-color":h?x:b},this.mouseOverColorGradient=o.colorGradient({x1:"0%",y1:"0%",x2:v,y2:y},[M,F]),a.isSupportSVG()||(this.colorGradient=f,this.clickedColorGradient=_,this.mouseOverColorGradient=b)}this.labelGroup=this._getPointTextLabelGroup();var C=n.linear().domain(c).range([-p,p]),w="x1",E="y1",v="x2",y="y2",A="cx",X="cy",S=C(u),I=-p;h&&(w="y1",E="x1",v="y2",y="x2",A="cy",X="cx",I=p,S=C.range([p,-p])(u));var k=a.pick(t.thermometerLine.node()._lastX_,I);if(t.thermometerLine.node()._lastX_=S,t.backgruondLine.attr(w,-p).attr(E,0).attr(v,p).attr(y,.001).style({fill:"none",stroke:r.slotBackgroundColor,"stroke-width":10,"stroke-linecap":"round"}),!s.isNull){t.thermometerLine.attr(w,I).attr(E,0).attr(y,.001).attr(v,k).style({stroke:t._getStroke(t.colorGradient),"stroke-width":10,"stroke-linecap":"round"}),t.needlePath.attr("r",4.5).attr(A,k).attr(X,0).style({fill:r.needle,"fill-opacity":i.getColorOpacity(r.needle),"stroke-width":3,stroke:t._needleStrokeColor(s)});var L={};L[v]=S,t.thermometerLine.animate({duration:t.ANIMATION_TIME,ease:t.EASE_TYPE,attr:L}),(L={})[A]=S,t.needlePath.animate({duration:t.ANIMATION_TIME,ease:t.EASE_TYPE,attr:L})}this._drawGaugeLabels(this.labelGroup),this._drawThermometerTicks(C)},_needleStrokeColor:function(t){return i.mixColorWithHSB(t.color,0,.1,-.1)},_drawThermometerTicks:function(t){var i=this,n=(i.options.bands,i.vanchart),r=i.gaugeAxis,s=n.renderer,o=this.labelGroup,l=r.getTickData(),c=r.getMinorTickData(),h=r.options,u=h.labelStyle,d=h.useHtml,p="x1",f="y1",m="x2",g="y2",v=-9,y=-15,M=-13,F=-19,_=function(t,e){return{x:e-t.tickDim.width/2,y:F-.85*t.tickDim.height,dy:"0.85em"}};i.options.thermometerLayout==e.VERTICAL_LAYOUT&&(p="y1",f="x1",m="y2",g="x2",v=9,y=15,M=13,F=19,_=function(t,e){return{x:F,y:e-t.tickDim.height/2,dy:".85em"}}),this.ticks=this.ticks||[];var T=r._bindData(this.ticks,l,function(e){return t(e.tickValue)}),b=[];for(T.exit.map(function(t){t.text&&t.text.remove(),t.remove()}),b=T.enter.map(function(t){var e=o.append(s.line().datum(t));return a.hasDefined(t.tickContent)&&(e.text=o.append(s.vtext(d))),e}),this.ticks=b=b.concat(T.update),E=0,A=b.length;E<A;E++){var x=b[E],C=x.datum(),w=a.lineSubPixelOpt(t(C.tickValue),1);x.attr(p,w).attr(f,v).attr(m,w).attr(g,y).style({stroke:h.tickColor,"stroke-width":h.tickWidth}),x.text&&x.text.textContent(C.tickContent).style(u).attr(_(C,w))}this.minorTics=this.minorTics||[];var E,A,b=[];for(E=0,A=(T=r._bindData(this.minorTics,c)).exit.length;E<A;E++)T.exit[E].remove();for(E=0,A=T.enter.length;E<A;E++)b.push(o.append(s.line().datum(T.enter[E])));for(this.minorTics=b=b.concat(T.update),E=0,A=b.length;E<A;E++){var X=b[E],S=X.datum(),w=a.lineSubPixelOpt(t(S),1);X.attr(p,w).attr(f,v).attr(m,w).attr(g,M).style({stroke:h.minorTickColor,"stroke-width":h.minorTickWidth})}},_getFixedPos:function(t,i){var a,n,r=t.series,s=r.options,o=r.options.thermometerLayout,l=r.percentageLabelContent,c=r.valueLabelContent;if(o==e.HORIZONTAL_LAYOUT){a=r.centerX-i.width/2;var h=r.centerY;n=h+5+10,l&&l.length&&s.percentageLabel.align==e.BOTTOM&&(n=h+r.percentageLabelPos.y+r.percentageLabelDim.height+10),c&&c.length&&s.valueLabel.align==e.BOTTOM&&(n=h+(p=r.valueLabelContent[0]).labelPos.y+p.labelDim.height+10)}else{n=r.centerY-i.height/2;var u=r.gaugeAxis.getMaxTickWidth(),d=r.centerX;if(a=d+5+4+6+4+u+10,l&&l.length&&s.percentageLabel.align==e.RIGHT&&(a=d+r.percentageLabelPos.x+r.percentageLabelDim.width+10),c&&c.length&&s.valueLabel.align==e.RIGHT){var p=r.valueLabelContent[0];a=Math.max(a,d+p.labelPos.x+p.labelDim.width+10)}}return[a,n]},_onSeriesMouseOver:function(t){r.prototype._onSeriesMouseOver.call(this,t);var e=this.points[0];e&&(this.thermometerLine.style("stroke",this._getStroke(this.mouseOverColorGradient)),this.needlePath.style({stroke:i.getHighLightColor(i.mixColorWithHSB(e.color,0,.1,-.1)),fill:i.getHighLightColor(this.options.needle)}))},_onSeriesMouseOut:function(t){r.prototype._onSeriesMouseOut.call(this,t);var e=this.points[0];e&&(this.thermometerLine.style("stroke",this._getStroke(this.colorGradient)),this.needlePath.style({stroke:this._needleStrokeColor(e),fill:this.options.needle}))},onSeriesPress:function(){var t=this.points[0];t&&(this.thermometerLine.style("stroke",this._getStroke(this.clickedColorGradient)),this.needlePath.style({stroke:i.getClickColor(t.color),fill:i.getClickColor(this.options.needle)}))},onSeriesPressUp:function(){this._onSeriesMouseOver()}});return t("../ChartLibrary").register(e.THERMOMETER_GAUGE,s),s}),define("component/BaseAxis",["require","../Constants","../utils/BaseUtils","../utils/QueryUtils","../ComponentLibrary","../utils/BoundsManager","./Base","../utils/BezierEasing"],function(t){var e,i,a=t("../Constants"),n=t("../utils/BaseUtils"),r=(t("../utils/QueryUtils"),t("../ComponentLibrary")),s=(t("../utils/BoundsManager"),t("./Base")),o=t("../utils/BezierEasing").css.swing,l=function(){return null==e&&(e=n.paddingConvertWithScale("0.1875rem")),e},c=function(){return null==i&&(i=n.paddingConvertWithScale("0.3125rem")),i};return s.extend({labelRotation:0,_refresh:function(){this.series=[],this.isRangePoints=!0,this.piece=null,this.forecast=[0,0],this._zoomDomain=this._dataDomain=this._domain=this._tickStart=this._step=0,this.initScale();var t=this.options,e=t.title;n.convertToREMUseDefault16PX(t.labelStyle),n.convertToREMUseDefault16PX(e&&e.style),t.tickPadding=isNaN(t.tickPadding)?6:t.tickPadding,t.tickLength=t.enableTick?isNaN(t.tickLength)?4:t.tickLength:0,t.minorTickLength=t.enableMinorTick?isNaN(t.minorTickLength)?2:t.minorTickLength:0},_calculateSize:function(t){var e=this.options;this.tickLabelLength=this._getTickLabelLength(t);var i=this._getAxisTitleLength();i+=i>0?c():0;var a=this.tickLabelLength+i,n=this.isHorizontal(),r=this.vanchart.isInverted();if(n)a=(s=r?e.maxWidth:e.maxHeight)?Math.min(this._maxHeight(s),a):a;else{var s=r?e.maxHeight:e.maxWidth;a=s?Math.min(this._maxWidth(s),a):a}this._size=Math.round(a)},_recordAxisSize:function(){this.isOnZero()||(this.vanchart.axisSize[this.getPosition()]+=this._size)},calculateDomainFromData:function(t){if(!t){var e=this.series;if(this.byPercent=!1,!this._isBaseAxis())for(var i=0,a=e.length;i<a&&!this.byPercent;i++)this.byPercent=e[i].options.stackByPercent;t=this._getDomainFromData()}this.indicator&&this._calculateCateDomainData(),this._dataDomain=t;var n=this.vanchart.getComponent(r.ZOOM_COMPONENT),s=this._zoomDomain||n&&n.getZoomInitDomain(this);if(this._isBaseAxis()&&s){var o=parseFloat(s[0]),l=parseFloat(s[1]);if(!isNaN(o)&&!isNaN(l)){var c=o;o=Math.min(o,l),l=Math.max(c,l)}this._calculateNiceDomain(this._dataDomain[0],this._dataDomain[1],isNaN(o)?null:o,isNaN(l)?null:l)}else{var h=this.options;this._calculateNiceDomain(this._dataDomain[0],this._dataDomain[1],h.min,h.max)}this._calculateDateFormat&&this._calculateDateFormat()},_calculateNiceDomain:function(t,e,i,a){return this.options.log?this._calculateLogNiceDomain(t,e,i,a):this.byPercent?this._calculatePercentValueDomain(t,e,i,a):this._calculateValueNiceDomain(t,e,i,a)},calculateDomainFromZoom:function(){var t=this._zoomDomain,e=this.options;if(this._isBaseAxis())this._calculateNiceDomain(this._dataDomain[0],this._dataDomain[1],t[0],t[1]);else{var i=n.hasDefined(e.min)?Math.max(e.min,t[0]):t[0],a=n.hasDefined(e.max)?Math.min(e.max,t[1]):t[1];if(i>a)return;var s=this.type==r.VALUE_AXIS_COMPONENT&&n.hasNotDefined(e.min),o=this.isLog()?1:0;i=s?Math.min(o,i):i,this._calculateNiceDomain(t[0],t[1],i,a)}},isCategory:function(){return this.type==r.CATEGORY_AXIS_COMPONENT},zoomRefresh:function(t){this._zoomDomain=t,this.calculateDomainFromZoom()},axisZoom:function(t,e){var i,a,s=this.type==r.DATE_AXIS_COMPONENT,o=s?1e3:1e-11,l=this.vanchart.bounds;this.isHorizontal()?(i=Math.min(t.x,e.x)-l.x,a=Math.max(t.x,e.x)-l.x,i=Math.max(i,0),a=Math.min(a,l.width)):(i=Math.min(t.y,e.y)-l.y,a=Math.max(t.y,e.y)-l.y,i=Math.max(i,0),a=Math.min(a,l.height));var c=this.scale.invert(i),h=this.scale.invert(a);s&&(c=n.date2int(c),h=n.date2int(h)),Math.abs(c-h)<o||this.zoomRefresh([Math.min(c,h),Math.max(c,h)])},getAxisValue:function(t){return t},getTrendLineForecast:function(t){var e=t.options.trendLine;if(e&&e.period&&2===e.period.length){var i=e.period;this.forecast[0]=Math.min(0,i[0]),this.forecast[1]=Math.max(0,i[1])}},_getStartAndEndTick:function(){return this._domain},updateClipBounds:function(t){var e,i,n,r,s=this.isHorizontal(),o=this.isAxisReversed(),l=this.options;if(this.options.showLabel){var c=this._getStartAndEndTick(),h=this._getTickDim(this._getTickContent(c[0],l.formatter)),u=this._getTickDim(this._getTickContent(c[1],l.formatter));o?(n=u,r=h):(n=h,r=u),e=s?n.width:n.height,i=s?r.width:r.height,e=Math.round(e/2)+5,i=Math.round(i/2)+5,this.showArrow()&&(i=Math.max(i,15))}else e=0,i=this.showArrow()?15:0;var d=this.vanchart.bounds;if(s){var p=this.vanchart.axisSize,f=d.x+p.left+5,m=p.right+5;if(this.isCategory()&&!this.isRangePoints){var g=this._zoomDomain||this._dataDomain,v=(d.width-p.left-p.right)/g.length;f+=Math.round(v/2),m+=Math.round(v/2)}this.options.labelRotation<=-15?e=Math.round(2*(e-5)):this.options.labelRotation>=15&&(i=Math.round(2*(i-5))),e=Math.max(e-f,0)+5,i=Math.max(i-m,0)+5,t[a.LEFT]=Math.max(t[a.LEFT]||0,e),t[a.RIGHT]=Math.max(t[a.RIGHT]||0,i)}else t[a.TOP]=Math.max(t[a.TOP]||0,i),t[a.BOTTOM]=Math.max(t[a.BOTTOM]||0,e)},updateAxisSizeAndBounds:function(){this._setComponentBounds(this.getPosition(),this._size)},fixScaleAndTickData:function(){this.scale.domain(this._domain).rangeRound(this._getRange()),this._updateOriginTickData(),this._calculateTickPosAndStep()},dealOnZero:function(){var t=this.options;if(t.onZero){var e,i,n,s,o=!0===t.onZero?0:t.onZero,l=this.componentType==r.X_AXIS_COMPONENT?r.Y_AXIS_COMPONENT:r.X_AXIS_COMPONENT,c=(l=this.vanchart.getComponent(l).getAxis(o)).getZeroPos(),h=this.vanchart.bounds;this.isHorizontal()?(e=h.x,i=c+h.y-(this.getPosition()==a.TOP?this.bounds.height:0),n=h.width,s=this.bounds.height):(e=c+h.x-(this.getPosition()==a.LEFT?this.bounds.width:0),i=h.y,n=this.bounds.width,s=h.height),this.bounds={x:e,y:i,width:n,height:s}}},_getTickLabelLength:function(t){var e=this.options,i=0,a=0,n=this.isHorizontal();if(e.showLabel&&(i=isNaN(+e.tickPadding)?l():e.tickPadding),e.enableTick&&(i+=isNaN(+e.tickLength)?5:e.tickLength),t)t.forEach(function(t){var e=t.tickDim;a=Math.max(a,n?e.height:e.width)});else for(var r=this._getTickValues(),s=0,o=r.length;s<o;s++){var c=this._getTickDim(this._getTickContent(r[s],e.formatter));a=Math.max(n?c.height:c.width,a)}return i+(e.showLabel?a:0)},_getTickDim:function(t){var e=this.options,i=e.useHtml,a=e.labelRotation||0,r=e.labelStyle||{};return n.getTextDimensionWithRotation(t,r,i,a)},_updateOriginTickData:function(){var t=this._getTickValues(),e=this.options,i=e.formatter,a=e.useHtml;isNaN(e.labelRotation)?e.autoRotate?this.labelRotation=this.getLabelAutoRotation(t,e,i):this.labelRotation=0:this.labelRotation=e.labelRotation,this.tickData=[];for(var s=e.labelStyle||{},o=n.extend({writingMode:"tb-rl","writing-mode":"tb-rl","-webkit-writing-mode":"vertical-rl"},s),l=0,c=t.length;l<c;l++){var h=t[l],u=this._getTickContent(h,i);this.type===r.CATEGORY_AXIS_COMPONENT&&u&&(u=(u+"").trim());var d,p,f=s,m=this.labelRotation;90===Math.abs(m)&&n.hasChn(u)&&(m=360,f=o),d=n.getTextDimension(u,f,a),p=n.getTextDimRotated(d,m),a&&(p.width=isNaN(parseFloat(e.labelWidth))?p.width:parseFloat(e.labelWidth),p.height=isNaN(parseFloat(e.labelHeight))?p.height:parseFloat(e.labelHeight)),this.tickData.push({tickValue:h,tickContent:u,tickDim:p,tickRectDim:d,labelRotation:m})}},_isBaseAxis:function(){return!!this.series.length&&this.componentType==this.series[0].getBaseAxisType()},getLabelAutoRotation:function(){return 0},_getAxisTitleLength:function(){var t=this.options.title,e=0;if(t){var i,a;this.titleRotation=t.rotation,n.hasChn(t.text)&&90===Math.abs(t.rotation)&&(this.titleRotation=360,t.style=n.extend({writingMode:"tb-rl","writing-mode":"tb-rl","-webkit-writing-mode":"vertical-rl"},t.style)),i=n.getTextDimension(t.text,t.style,t.useHtml),a=n.getTextDimRotated(i,this.titleRotation),this.titleRectDim=i,this.titleDim=a,e=this.isHorizontal()?a.height:a.width}return e},getAxisTitleBounds:function(){var t=this.bounds,e=this.tickLabelLength+c(),i=this.getPosition(),n=t.x,r=t.y,s=t.width,o=t.height;switch(i){case a.LEFT:s-=e;break;case a.BOTTOM:r+=e,o-=e;break;case a.RIGHT:n+=e,s-=e;break;case a.TOP:o-=e}return{x:n,y:r,width:Math.max(s,0),height:Math.max(o,0)}},getTickLength:function(){var t=this.scale.range();return Math.abs(t[0]-t[1])/Math.max(this.tickData.length,1)},adjustDomain4Radius:function(){if(this.type===r.VALUE_AXIS_COMPONENT||this.type===r.DATE_AXIS_COMPONENT){var t=this._domain,e=this.type==r.DATE_AXIS_COMPONENT,i=this._getRange(),s=this._dataDomain,o=Math.max((t[0]+"").length,(t[1]+"").length);e&&(t=[n.int2date(t[0]),n.int2date(t[1])]);var l=this.scale.domain(t).range(i),c=this,h=this._isBaseAxis(),u=this.componentType===r.X_AXIS_COMPONENT?"x":"y",d=Number.MAX_VALUE,p=-Number.MAX_VALUE;if(this.series.map(function(t){if(t.visible&&(t.type!==a.BUBBLE_CHART&&t.type!==a.SCATTER_CHART||t.points.map(function(t){var e=l(c.getAxisValue(t[u],t));if(t.visible&&!t.isNull&&!isNaN(e)){var i=n.pick(t.radius,t.options.marker&&t.options.marker.radius);d=Math.min(d,e-i),p=Math.max(p,e+i)}}),h&&(t.type===a.COLUMN_CHART||t.type===a.BAR_CHART||t.type===a.LINE_CHART||t.type===a.AREA_CHART))){var e=t.points;if(!e.length)return;var i,r=l(s[0]),o=l(s[1]),f=Math.min(r,o),m=Math.max(r,o);i=t.type===a.COLUMN_CHART||t.type===a.BAR_CHART?t.getSeriesOffsetAndWidth().width/2:e[0].options.marker&&e[0].options.marker.radius||1,isNaN(f)||(d=Math.min(d,f-i)),isNaN(m)||(p=Math.max(p,m+i))}}),d===Number.MAX_VALUE||p===-Number.MAX_VALUE)return;var f=l.invert(d),m=l.invert(p);if(e&&(f=n.date2int(f),m=n.date2int(m)),this.calculateDomainFromData([Math.min(Math.min(f,m),s[0]),Math.max(Math.max(f,m),s[1])]),Math.max((this._domain[0]+"").length,(this._domain[1]+"").length)>o)return!0}},_getRange:function(){return this._getPlotRange()},_getPlotRange:function(){var t=this.vanchart.bounds;return this.isHorizontal()?this.isAxisReversed()?[t.width,0]:[0,t.width]:this.isAxisReversed()?[0,t.height]:[t.height,0]},_getPlotBands:function(){var t=this.options.plotBands,e=this.scale,i=!(!e.rangeBand||!e.rangeBand());if("string"==typeof t){var a=t;t=[];for(var r=this._getTickValuesWithEndValue(),s=i?-1:0,o=r.length-1;o>s;o-=2)t.push({color:a,from:i?r[o]:r[o-1],to:r[o]})}else{for(var l=[],c=0,h=(t=t||[]).length;c<h;c++){var u=t[c];n.hasDefined(u.from)&&n.hasDefined(u.to)&&l.push(u)}t=l}return t},_getTickValuesWithEndValue:function(){var t=this._getTickValues(),e=this._domain[1],i=this.type==r.DATE_AXIS_COMPONENT;if(t.length){var a=t[t.length-1];i?n.date2int(a)<e&&t.push(n.int2date(e)):a<e&&t.push(e)}return t},getTickData:function(){return this.tickData},getMinorTickData:function(){var t=[],e=this.options,i=this._step;if(this.options.enableMinorTick&&this.tickData.length)if(this.type==r.CATEGORY_AXIS_COMPONENT){var a=Math.round(this.getTickLength()/5),s=this.tickData.length;s=this.isRangePoints?s-1:s;for(h=0;h<s;h++)for(var o=this.tickData[h].tickPos,l=1;l<5;l++)t.push(o+a*l)}else{for(var c=e.minorTickInterval?e.minorTickInterval:i/5,h=0,u=this.tickData.length;h<u-1;h++){var d=this.tickData[h].tickValue,p=this.tickData[h+1].tickValue;d=(g=d instanceof Date&&p instanceof Date)?n.date2int(d):d,p=g?n.date2int(p):p;for(v=n.accAdd(d,c);v<p;v=n.accAdd(v,c))t.push(g?n.int2date(v):v)}var f=this.tickData[this.tickData.length-1].tickValue,m=this.scale.domain()[1],g=f instanceof Date&&m instanceof Date;if(f=g?n.date2int(f):f,m=g?n.date2int(m):m,f<m)for(var v=f+c;v<=m;v+=c)t.push(g?n.int2date(v):v);var y=this.tickData[0].tickValue,M=this.scale.domain()[0];if(g=y instanceof Date&&M instanceof Date,y=g?n.date2int(y):y,M=g?n.date2int(M):M,y>M)for(v=y-c;v>=M;v-=c)t.push(g?n.int2date(v):v)}return t},getMaxTickWidth:function(){var t=0;return this.tickData.forEach(function(e){t=Math.max(t,e.tickDim.width)}),t},getTickHeight:function(){return this.options.labelStyle&&this.options.showLabel?n.getTextHeight(this.options.labelStyle):0},_calculateTickPosAndStep:function(){var t=this.options,e=this.scale,i=this.getTickLength(),a=e.rangeBand?e.rangeBand()/2:0;if(this.tickData.forEach(function(t){t.tickPos=e(t.tickValue),t.tickLabelPos=t.tickPos+a}),t.showLabel)if(t.step){v=0;this.tickData.forEach(function(e){v++%t.step&&(e.tickContent="")})}else{var r,s=this.isHorizontal(),o=1,l=1,c=Math.abs(Math.abs(this.labelRotation)-(s?0:90)),h=c>=15&&90!==c;r=n.toRadian(c);var u,d,p,f,m=-1,g=Math.sin(r);this.tickData.forEach(function(t){if(""!==t.tickContent)if(h)f=t.tickRectDim.height,d=Math.abs(t.tickPos-u),(p=(f+m)/2)<d*g||-1===m?(o=1,u=t.tickPos,m=f):(o++,l=Math.max(l,o));else{var e=s?t.tickDim.width:t.tickDim.height;i&&(l=Math.max(l,Math.ceil(e/i)))}});var v=0;this.tickData.forEach(function(t){v++%l&&(t.tickContent="")})}else this.tickData.forEach(function(t){t.tickContent=""})},_getAxisOriginPoint:function(){var t,e,i=this.bounds;switch(this.getPosition()){case a.TOP:t=i.x,e=i.y+i.height;break;case a.BOTTOM:t=i.x,e=i.y;break;case a.LEFT:t=i.x+i.width,e=i.y;break;case a.RIGHT:t=i.x,e=i.y}return{x:t,y:e}},getPosition:function(){var t=this.componentType==r.X_AXIS_COMPONENT?"bottom":"left",e=this.options.position||t;if(!this.vanchart.isInverted())return e;switch(e){case a.TOP:return a.RIGHT;case a.RIGHT:return a.BOTTOM;case a.BOTTOM:return a.LEFT;case a.LEFT:return a.TOP}},isAxisReversed:function(){return this.componentType===r.X_AXIS_COMPONENT&&this.vanchart.isInverted()?!this.options.reversed:this.options.reversed},isOnZero:function(){return this.options.onZero},getLineWidth:function(){return this.options.lineWidth},showArrow:function(){return this.options.showArrow},getTitleAlign:function(){var t=this.options.title;if(!t)return null;var e=t.align||"center";if(this.vanchart.isInverted())switch(e){case a.TOP:return a.RIGHT;case a.RIGHT:return a.BOTTOM;case a.BOTTOM:return a.LEFT;case a.LEFT:return a.TOP}return e},_calculateLogNiceDomain:function(t,e,i,a){var r=this.options,s=r.log,o=parseInt(n.pick(r.tickInterval,1));t=(t=t>=1?1:t)<=0?1:t,t=n.pick(i,t),e=n.pick(a,e),t=Math.pow(s,Math.floor(n.log(s,t))),e=Math.pow(s,Math.ceil(n.log(s,e))),this._domain=[t,e],this._tickStart=t,this._step=o},_calculatePercentValueDomain:function(t,e,i,a){var r=this.options,s=n.pick(i,0),o=n.pick(a,1),l=n.pick(r.tickInterval,.25);this._domain=[s,o],this._tickStart=s,this._step=l},_calculateValueNiceDomain:function(t,e,i,a){var s=this.type==r.VALUE_AXIS_COMPONENT&&!this._isBaseAxis(),o=this.options;s&&(t>0?t=0:e<0&&(e=0)),(t=n.hasDefined(i)?i:t)>=(e=n.hasDefined(a)?a:e)&&(e=t+100*(this.type===r.DATE_AXIS_COMPONENT?1e3:1));var l=o.tickInterval||this._linearTickInterval(t,e),c=this._linearNiceDomain(t,e,l);(t=n.hasDefined(i)?i:c[0])>=(e=n.hasDefined(a)?a:c[1])&&(e=t+100*(this.type===r.DATE_AXIS_COMPONENT?1e3:1));var h=c[0];if(n.hasDefined(i)){var u=n.accMul(Math.ceil(n.accDiv(n.accAdd(i,-h),l)),l);h=n.accAdd(h,u)}this._domain=[t,e],this._tickStart=h,this._step=l},_linearTickInterval:function(t,e,i){i=i||this._getDefaultTickCount();var a=e-t,n=Math.pow(10,Math.floor(Math.log(a/i)/Math.LN10)),s=i/a*n;return s<=.15?n*=10:s<=.35?n*=5:s<=.75&&(n*=2),this.type===r.DATE_AXIS_COMPONENT&&(n=Math.max(n,1e3)),n},_linearNiceDomain:function(t,e,i){return t=n.accMul(Math.floor(t/i),i),e=n.accMul(Math.ceil(e/i),i),[t,e]},_getDefaultTickCount:function(){return this.vanchart.options.chartType==a.RADAR_CHART?4:5},getIndexByPosition:function(t){var e,i=this.getPlotBounds(),a=this.scale,s=a(this.isAxisReversed()?a.domain()[a.domain().length-1]:a.domain()[0]);e=this.isHorizontal()?t[0]-i.x-s:t[1]-i.y-s;var o;switch(this.type){case r.DATE_AXIS_COMPONENT:o=n.date2int(a.invert(e));break;default:o=a.invert(e)}return o=Math.round(o)},_valueInDomain:function(){return!0},render:function(){this.lastScale=this.scale&&this.scale.copy();var t=this.vanchart,e=t.renderer;this.axisGroup||(this.axisGroup=this.createComponentGroup(),e.clip(this.clipAxisGroup=this.createComponentGroup(),t.plotClip));var i=this.bounds,a={x:i.x,y:i.y,width:i.width,height:i.height};this.isHorizontal()?(a.x=0,a.width=t.width):(a.y=0,a.height=t.height),this.axisGroupClip?e.updateClip(this.axisGroupClip,a):(this.axisGroupClip=e.createClip(a),e.clip(this.axisGroup,this.axisGroupClip)),this.axisLineGroup||(this.axisLineGroup=e.group().addTo(t.seriesGroup)),0!==this.series.length&&(this._drawPlotBands(),this._drawGridLine(),this._drawTickLine(),this._drawTickLabel(),this._drawPlotLines(),this._drawAxisTitle(),this._drawAxisLine())},isLog:function(){return this.options.log},getZeroPos:function(){switch(this.type){case r.VALUE_AXIS_COMPONENT:return this.isLog()?this.scale(1):this.scale(0);case r.DATE_AXIS_COMPONENT:return this.scale(n.int2date(0));case r.CATEGORY_AXIS_COMPONENT:return 0}},_drawPlotBands:function(){var t,e,i,a,r,s=this._getPlotBands(),l=this.scale,c=l.rangeBand?l.rangeBand():0,h=this.vanchart.renderer,u=this.vanchart.bounds,d=this.isHorizontal(),p=u.width,f=u.height;for(this.plotBandsGroup||(this.plotBandsGroup=h.group().addTo(this.clipAxisGroup),this.plotBands=[]),this.plotBandsGroup.attr({transform:n.makeTranslate(u)}),t=s.length;t<this.plotBands.length;t++)this.plotBands[t]&&this.plotBands[t].remove(),this.plotBands[t]=null;for(this.plotBands.length=s.length,t=0,e=s.length;t<e;t++){var m=s[t],g=l(m.from),v=l(m.to);i=Math.min(g,v),a=Math.max(g+c,v+c),i=Math.max(0,i),a=Math.min(d?p:f,a),r=d?{x:i,y:0,width:Math.max(a-i,0),height:f}:{x:0,y:i,width:p,height:Math.max(a-i,0)},this.plotBands[t]=this.plotBands[t]||h.rect(r).addTo(this.plotBandsGroup),this.plotBands[t].style({fill:m.color}).animate({duration:400,ease:o,attr:r})}},_drawAxisLine:function(){var t=this.options,e=t.lineWidth,i=t.lineColor,a=this.getPlotBounds(),r=this._getAxisOriginPoint(),s="x1",o="y1",l="x2",c="y2",h=a.width,u=this.vanchart.renderer;this.isHorizontal()||(s="y1",o="x1",l="y2",c="x2",h=a.height);var d=n.lineSubPixelOpt(0,e);this.axisLine||(this.axisLine=u.line().addTo(this.axisLineGroup));var p={};if(p[s]=0,p[l]=h,p[o]=p[c]=d,p.transform=n.makeTranslate(r),this.axisLine.attr(p).style({stroke:i,"stroke-width":e}),this.showArrow()){this.arrowGroup||(this.arrowGroup=u.group().addTo(this.axisLineGroup));var f=this.arrowGroup.line||u.line().addTo(this.arrowGroup),m=this.arrowGroup.path||u.path().addTo(this.arrowGroup);this.arrowGroup.line=f,this.arrowGroup.path=m,this.isHorizontal()?(this.arrowGroup.attr("transform",n.makeTranslate([r.x+a.width,r.y])),f.attr({x1:0,y1:d,x2:6,y2:d}).style({stroke:i,"stroke-width":e}),m.attr({d:"M2,-4 L10,0 L2,4 L6,0 L2,-4"}).style({fill:i})):(this.arrowGroup.attr("transform",n.makeTranslate(r)),f.attr({x1:d,y1:0,x2:d,y2:-6}).style({stroke:i,"stroke-width":e}),m.attr({d:"M-4,-2 L0,-10 L4,-2 L0,-6 L-4,-2"}).style({fill:i}))}else this.arrowGroup&&this.arrowGroup.remove()},_drawGridLine:function(){var t=this.options,e=this.getPlotBounds(),i=this.getTickData(),s=this.scale,l=this.lastScale||s,c=t.gridLineColor,h=t.gridLineWidth;0===h&&(c="");var u=n.lineSubPixelOpt(0,h),d=this.vanchart.renderer,p="x1",f="y1",m="x2",g="y2",v=e.height;this.isHorizontal()||(p="y1",f="x1",m="y2",g="x2",v=e.width),this.gridLinesGroup||(this.gridLinesGroup=d.group().addTo(this.clipAxisGroup),this.gridLines=[]),this.gridLinesGroup.attr("transform",n.makeTranslate(e));for(var y=this.type==r.CATEGORY_AXIS_COMPONENT?[{tickPos:this.getPosition()==a.BOTTOM?e.width:e.height-1}]:[],M=this._bindData(this.gridLines,i.concat(y),function(t){return t.tickValue}),F=[],_=0,T=M.exit.length;_<T;_++){w=s((b=M.exit[_].datum()).tickValue);(E={})[p]=w,E[m]=w,M.exit[_].animate({duration:400,ease:o,attr:E,style:{opacity:0}}).remove()}for(var _=0,T=M.enter.length;_<T;_++){var b=M.enter[_],x=d.line().style({stroke:c,"stroke-width":h}).addTo(this.gridLinesGroup),C=l(b.tickValue)+u,w=b.tickPos+u;C=isNaN(C)?w:C,x.attr(p,C).attr(m,C).attr(f,0).attr(g,v),(E={})[p]=w,E[m]=w,E[f]=0,E[g]=v,x.animate({attr:E,duration:400,ease:o}),x.datum(b),F.push(x)}for(var _=0,T=(F=F.concat(M.update)).length;_<T;_++){var w=(b=(x=F[_].style({stroke:c,"stroke-width":h})).datum()).tickPos+u,E={};E[p]=w,E[m]=w,E[f]=0,E[g]=v,x.animate({attr:E,duration:400,ease:o})}this.gridLines=F},_drawTickLine:function(){function t(t,e,a){var s,o,l=g._bindData(t,e),c=[];for(s=0,o=l.exit.length;s<o;s++)l.exit[s].remove();for(s=0,o=l.enter.length;s<o;s++)c.push(m.line().datum(l.enter[s]).addTo(g.tickLinesGroup));for(s=0,o=(c=c.concat(l.update)).length;s<o;s++){var h,u=c[s].datum(),d={};h=n.hasDefined(u.tickPos)?u.tickPos:g.type==r.CATEGORY_AXIS_COMPONENT?u:g.scale(u);var p=i.x,f=i.y;g.isHorizontal()||(p=i.y,f=i.x),d[v]=h+a.det+p,d[M]=d[v],d[y]=f,d[F]=(_*a.tickLength||0)+f,c[s].attr(d).style({stroke:a.tickColor,"stroke-width":a.tickWidth})}return c}var e=this.options,i=this._getAxisOriginPoint(),s=this.getPosition(),o=this.getTickData(),l=e.enableTick?e.tickLength||0:0,c=e.tickWidth||1,h=e.tickColor,u=this.getMinorTickData(),d=e.enableMinorTick?e.minorTickLength||0:0,p=e.minorTickColor,f=e.minorTickWidth||1,m=this.vanchart.renderer,g=this,v="x1",y="y1",M="x2",F="y2";this.isHorizontal()||(v="y1",y="x1",M="y2",F="x2");var _=s==a.TOP||s==a.LEFT?-1:1,T=n.lineSubPixelOpt(0,c),b=n.lineSubPixelOpt(0,f);this.tickLinesGroup||(this.tickLinesGroup=m.group().addTo(this.axisGroup),this.tickLines={},this.tickLines.main=[],this.tickLines.minor=[]),this.tickLines.main=t(this.tickLines.main,o,{det:T,tickWidth:c,tickLength:l,tickColor:h}),this.tickLines.minor=t(this.tickLines.minor,u,{det:b,tickWidth:f,tickLength:d,tickColor:p})},_drawPlotLines:function(){function t(t){return{stroke:t.color,"stroke-width":t.width,"stroke-dasharray":t.dataArray}}function e(t){return p.text().textContent(t.text).style(t.style).attr({x:t.textX,y:t.textY,"text-anchor":"left",dy:.85*t.textDim.height})}function i(t,i){i._textG&&(i._textG.remove(),i._textG=null),t.text&&t.textDim&&(i._textG=e(t).addTo(i))}var s=this.options.plotLines||[],o=(this.getPosition(),this.vanchart.bounds),c=this.scale,h=this.type==r.DATE_AXIS_COMPONENT,u=[],d=this,p=this.vanchart.renderer;s.forEach(function(t){if(!n.isEmpty(t.value)){var e,i,r,s,p=c(h?n.object2date(t.value):t.value)+(c.rangeBand?c.rangeBand()/2:0),f=n.lineSubPixelOpt(p,t.width);if(d.isHorizontal()){if(p<0||p>o.width)return;e=i=f,r=0,s=o.height}else{if(p<0||p>o.height)return;e=0,i=o.width,r=s=f}var m,g,v,y;if(t.label&&t.label.text&&t.label.style){y=t.label.style,v=t.label.text;var M=t.label.align,F=n.getTextDimension(v,y,t.label.useHtml);switch(M){case a.TOP:m=e-F.width,g=r;break;case a.BOTTOM:m=e-F.width,g=s-F.height;break;case a.LEFT:m=e,g=r-F.height-l();break;case a.RIGHT:m=i-F.width,g=s-F.height-l()}}u.push({color:t.color,line:{x1:e,y1:r,x2:i,y2:s},width:t.width,dataArray:a.DASH_TYPE[t.dashStyle],text:v,textDim:F,style:y,textX:m,textY:g})}}),this.plotLinesGroup||(this.plotLinesGroup=p.group().addTo(this.vanchart.backGroup),this.plotLines=[]),this.plotLinesGroup.attr("transform",n.makeTranslate(o));var f,m,g=this._bindData(this.plotLines,u);for(this.plotLines=[],f=0,m=g.exit.length;f<m;f++)g.exit[f].remove();for(f=0,m=g.enter.length;f<m;f++){var v=g.enter[f],y=p.group();this.plotLines.push(y),y._lineG=y.append(p.line(v.line).style(t(v))),i(v,y),y.addTo(this.plotLinesGroup)}for(f=0,m=g.update.length;f<m;f++){v=(y=g.update[f]).datum();y._lineG.attr(v.line).style(t(v)),i(v,y),this.plotLines.push(y)}},_drawTickLabel:function(){this._drawSvgTickLabel()},_drawSvgTickLabel:function(){var t=this,e=this.vanchart.renderer,i=this.scale,a=this.lastScale||i,r=this.options,s=r.labelStyle,l=r.useHtml,c=this.getTickData().filter(function(t){return""!==t.tickContent});this.tickLabelsGroup||(this.tickLabelsGroup=e.vgroup().add(),this.axisGroup.append(this.tickLabelsGroup.renderG),this.tickLabels=[]);var h,u,d=this._bindData(this.tickLabels,c,function(t){return t.tickValue}),p=[],f={duration:400,ease:o,style:{opacity:0}};for(h=0,u=d.exit.length;h<u;h++){var m=i((g=d.exit[h].datum()).tickValue);d.exit[h].animate(n.extend({},f,t.isHorizontal()?{x:m}:{y:m}))}for(h=0,u=d.enter.length;h<u;h++){var g=d.enter[h],v=this._getLabelAttr(a,g),y=this.tickLabelsGroup.append(e.vtext(l).textContent(g.tickContent).style({opacity:0})),M=g.labelRotation%360?y.vRotate(g.labelRotation,!0).rotateStr:"";v.transform+=M,y.attr(v),y.datum(g),p.push(y)}for(h=0,u=(p=p.concat(d.update)).length;h<u;h++){g=(y=p[h]).datum();y.textContent(g.tickContent).style(s);var v=this._getLabelAttr(i,g),F=this._valueInDomain(g.tickValue)?1:0;if(this.useHtmlLabel())y.attr(v).style({opacity:F}),y.vRotate(g.labelRotation);else{M=g.labelRotation%360?y.vRotate(g.labelRotation,!0).rotateStr:"";v.transform+=M,y.animate({ease:o,duration:400,attr:v,style:{opacity:F}})}}this.tickLabels=p},_getLabelAttr:function(t,e){var i,r,s=this._getAxisOriginPoint(),o=t.rangeBand?t.rangeBand()/2:0,l=t(e.tickValue)+o,c=this.options,h=this.isHorizontal(),u=c.enableTick?c.tickLength:0,d=c.tickPadding+u||0,p=e.labelRotation||0,f=(c.labelStyle,c.useHtml),m=this.getPosition(),g=m==a.TOP||m==a.LEFT?-1:1,v=e.tickRectDim,y=e.tickDim,M=0,F=0,_=0,T=.85*v.height,b=n.toRadian(p);360===p&&(_=f||n.isMS?0:.85*v.width/2,T=0,r="tb-rl"),h?(i=Math.abs(p%90)<15?0:p>0?1:-1,F+=g*(y.height-v.height)/2,M+=g*i*(y.width-Math.abs(v.height*Math.sin(b)))/2,m===a.TOP&&(F-=v.height),F+=g*d,M+=s.x+l-v.width/2,F+=s.y):(i=Math.abs(p%90)>85?0:p>0?1:-1,M+=g*(y.width-v.width)/2,F+=g*i*(y.height-v.height*Math.cos(b))/2,m===a.LEFT&&(M-=v.width),M+=g*d,M+=s.x,F+=s.y+l-v.height/2);var x=f?"px":"",C={transform:"translate("+M+x+" "+F+x+")",dy:T,dx:_,writingMode:r,"writing-mode":r};return f&&r&&(C["-webkit-writing-mode"]="vertical-rl"),C},_drawAxisTitle:function(){var t=this.options.title;if(!t||!t.text)return this.titleGroup&&this.titleGroup.remove(),void(this.titleGroup=null);var e=this.vanchart.renderer,i=this.axisGroup,r=t.useHtml,s=this.titleRotation,o=this.getTitleAlign(),l=t.text,c=t.style,h=this.titleDim,u=this.titleRectDim,d=this.getAxisTitleBounds();this.titleGroup||(this.titleGroup=e.vgroup().add(),i.append(this.titleGroup.renderG)),this.titleGroup.attr({transform:n.makeTranslate(d)});var p=this.titleGroup;p.text||(p.text=p.append(e.vtext(r)));var f=0,m=0,g=0,v=.85*u.height;switch(o){case a.TOP:m=0;break;case a.BOTTOM:m=d.height-h.height;break;case a.LEFT:f=0;break;case a.RIGHT:f=d.width-h.width;break;case a.CENTER:default:this.isHorizontal()?f=(d.width-h.width)/2:m=(d.height-h.height)/2}360===this.titleRotation?(g=r||n.isMS?0:.85*u.width/2,v=0):(f+=(h.width-u.width)/2,m+=(h.height-u.height)/2),p.text.textContent(l).attr({x:f,y:m,dy:v,dx:g}).style(c),s%360&&p.text.vRotate(s)},remove:function(){this.axisGroup&&this.axisGroup.remove(),this.clipAxisGroup&&this.clipAxisGroup.remove(),this.axisGroup=this.clipAxisGroup=null,this.axisLineGroup&&this.axisLineGroup.remove(),this.axisLineGroup=null,this.tickLabelsGroup&&this.tickLabelsGroup.remove(),this.tickLabelsGroup=null}})}),define("component/CategoryAxis",["require","./Base","./BaseAxis","../utils/BaseUtils","../Constants","../ComponentLibrary","../utils/Scale"],function(t){var e,i=(t("./Base"),t("./BaseAxis")),a=t("../utils/BaseUtils"),n=t("../Constants"),r=t("../ComponentLibrary"),s=t("../utils/Scale"),o=function(){return null==e&&(e=a.paddingConvertWithScale("0.1875rem")),e},l=i.extend({type:r.CATEGORY_AXIS_COMPONENT,initScale:function(){this.lastScale=this.scale,this.scale=s.ordinal()},calculateDomainFromData:function(){this._dataDomain=this._getDomainFromData();var t=this.vanchart.getComponent(r.ZOOM_COMPONENT);this._zoomDomain=this._zoomDomain||t&&t.getZoomDomain(this),this._domain=this._zoomDomain||this._dataDomain},calculateDomainFromZoom:function(){this._domain=this._zoomDomain},_getStartAndEndTick:function(){return[this._domain[0],this._domain[this._domain.length-1]]},_getDomainFromData:function(){var t=this.options,e=this.series,i=this,a={},r=t.categories||[];return r.forEach(function(t){a[t]=!0}),e.forEach(function(t){this.getTrendLineForecast(t);for(var e=0,s=t.points.length;e<s;e++){var o=t.points[e].category;a[o]||(a[o]=!0,r.push(o))}t.type!==n.AREA_CHART&&(i.isRangePoints=!1)},this),this.addTrendLineCategories(r)},setCategories:function(t){var e=this._dataDomain;this._dataDomain=this.addTrendLineCategories(t);var i=this.vanchart.getComponent(r.ZOOM_COMPONENT);if(this._isBaseAxis()&&i&&i.zoomToolEnabled()){i.updateRangeLeftAndRight(this,e,t);var a=i&&i.getZoomDomain(this);this._zoomDomain=a,this.calculateDomainFromZoom()}else this._domain=this._dataDomain,this._zoomDomain=null;this.fixScaleAndTickData()},addTrendLineCategories:function(t){function e(t,e){return Array.apply(null,Array(t)).map(e)}if(this.forecast&&(this.forecast[0]||this.forecast[1])){var i=0;t=e(-this.forecast[0],function(){return Array(2+i++).join(" ")}).concat(t).concat(e(this.forecast[1],function(){return Array(2+i++).join(" ")}))}return t},getOriginalCategories:function(){return this.forecast&&(this.forecast[0]||this.forecast[1])?this._dataDomain.slice(-this.forecast[0],this._dataDomain.length-this.forecast[1]):this._dataDomain},updateAxisSizeAndBounds:function(){this._updateOriginTickData(),this._calculateSize(this.tickData),this._setComponentBounds(this.getPosition(),this._size)},_getTickValuesWithEndValue:function(){return this._getTickValues()},fixScaleAndTickData:function(){this.scale.domain(this._dataDomain),this.isRangePoints?this.scale.rangePoints(this._getRange()):this.scale.rangeBands(this._getRange()),this._updateOriginTickData(),this._calculateTickPosAndStep()},_getRange:function(){var t=this._getPlotRange();if(this._dataDomain.length==this._domain.length)return t;var e,i=Math.abs(t[1]-t[0]);e=this.isRangePoints?i/Math.max(this._domain.length-1,1):i/this._domain.length;var n=a.indexOf(this._dataDomain,this._domain[0]),r=this._dataDomain.length-a.indexOf(this._dataDomain,this._domain[this._domain.length-1])-1;if(!(this.isAxisReversed()^this.isHorizontal())){var s=n;n=r,r=s}var o=-n*e,l=i+r*e;return this.isHorizontal()?this.isAxisReversed()?[l,o]:[o,l]:this.isAxisReversed()?[o,l]:[l,o]},getLabelAutoRotation:function(t,e,i){if(e.autoRotate&&!e.labelRotation){var n,r,s=this.vanchart.isInverted(),l=t.reduce(function(t,e){return a.getTextDimension(t).width>a.getTextDimension(e).width?t:e}),c=this._getTickContent(l,i),h=a.getTextDimensionWithRotation(c,e.labelStyle,e.useHtml,e.labelRotation),u=Math.max.apply(null,this._getPlotRange())/this._domain.length-o();s?(n=h.height,r=h.width):(n=h.width,r=h.height);var d=Math.sqrt(n*n+r*r);if(r>u)return-90;if(n>u){var p=Math.acos(u/d)+Math.atan(r/n);return-a.toDegree(p)}}},getCategoryCount:function(){return this._dataDomain.length},indexOfLabel:function(t){return a.indexOf(this._dataDomain,t)},getTickLength:function(){var t=this.scale.domain(),e=this.scale.rangeExtent(),i=Math.abs(e[1]-e[0]);return this.isRangePoints&&t.length<=1?i:this.isRangePoints?i/(t.length-1):this.scale.rangeBand()},_getTickValues:function(){return this._domain},getCategories:function(){return this._dataDomain},axisZoom:function(t,e){var i,n,r=this.vanchart.bounds;this.isHorizontal()?(i=Math.min(t.x,e.x)-r.x,n=Math.max(t.x,e.x)-r.x):(i=Math.min(t.y,e.y)-r.y,n=Math.max(t.y,e.y)-r.y);var o=this.scale.domain(),l=this._getRange(),c=s.quantize().domain(l).range(o),h=a.indexOf(this._dataDomain,c(i)),u=a.indexOf(this._dataDomain,c(n));this.zoomRefresh(this._dataDomain.slice(Math.min(h,u),Math.max(h,u)+1))},getIndexByPosition:function(t){return this._getIndexByXYCoordinate(t)},_getIndexByXYCoordinate:function(t){var e,i=this.getPlotBounds(),a=this.scale,n=this.isHorizontal(),r=this.isAxisReversed()^!n,s=a(r?a.domain()[a.domain().length-1]:a.domain()[0]);e=n?t[0]-i.x-s:t[1]-i.y-s;var o,l=this.getCategories();if(l.length>1){var c=Math.abs(a(a.domain()[1])-a(a.domain()[0]));o=r?l.length-1-e/c:e/c}else o=0;return o=this.isRangePoints?Math.round(o):r?Math.ceil(o):Math.floor(o)},getPointsInCategory:function(t){var e=this.vanchart.bounds,i=this.scale.domain(),a=this._getRange(),n=s.quantize().domain(a).range(i)(this.isHorizontal()?t.x-e.x:t.y-e.y);return this.vanchart.getValidPointsPara(n)},drawHighlightBackground:function(t){var e=t[0].category,i="line";t.map(function(t){var e=t.series;e.type!==n.BAR_CHART&&e.type!==n.COLUMN_CHART||(i="band")});var r=this.getPlotBounds(),s=this.isHorizontal(),o=this.scale,l=o.rangeBand?o.rangeBand():0,c=o(e),h=c+l,u=this.vanchart.renderer,d="x",p="y",f="width",m="height",g=r.height,v="x1",y="x2",M="y1",F="y2";switch(s||(d="y",p="x",f="height",m="width",g=r.width,v="y1",y="y2",M="x1",F="x2"),i){case"band":this.highlightBand||(this.highlightBand=u.rect().style({fill:"rgb(98,179,240)","fill-opacity":.2}).addTo(this.clipAxisGroup)),this.highlightBand.attr("transform",a.makeTranslate(r)).attr(d,c).attr(p,0).attr(f,Math.abs(c-h)).attr(m,g),this.highlightLine&&this.highlightLine.remove(),this.highlightLine=null;break;case"line":default:l&&(c=(c+h)/2),this.highlightLine||(this.highlightLine=u.line().style({stroke:"rgb(140,140,140)","stroke-width":1}).addTo(this.clipAxisGroup)),this.highlightLine.attr("transform",a.makeTranslate(r)).attr(v,c).attr(M,0).attr(y,c).attr(F,g),this.highlightBand&&this.highlightBand.remove(),this.highlightBand=null}},removeHighlightBackground:function(){this.highlightBand&&this.highlightBand.remove(),this.highlightLine&&this.highlightLine.remove(),this.highlightBand=null,this.highlightLine=null}});return r.register(r.CATEGORY_AXIS_COMPONENT,l),l}),define("component/ValueAxis",["require","./Base","./BaseAxis","../utils/BaseUtils","../utils/QueryUtils","../Constants","../ComponentLibrary","../utils/Scale"],function(t){var e=(t("./Base"),t("./BaseAxis")),i=t("../utils/BaseUtils"),a=(t("../utils/QueryUtils"),t("../Constants"),t("../ComponentLibrary")),n=t("../utils/Scale"),r=e.extend({type:a.VALUE_AXIS_COMPONENT,initScale:function(){this.lastScale=this.scale,this.scale=this.options.log?n.log().base(this.options.log):n.linear()},getAxisValue:function(t,e){return this.byPercent?e.percentage:+t},_valueInDomain:function(t){var e=this.scale.domain();return t>=Math.min(e[0],e[1])&&t<=Math.max(e[0],e[1])},_getDomainFromData:function(){for(var t=Number.MAX_VALUE,e=-t,i=!0,a=this.series,n={},r=!1,s=0,o=a.length;s<o&&!r;s++)r=a[s].visible;for(var s=0,o=a.length;s<o;s++)!a[s].visible&&r||(this._getSeriesValue(n,a[s]),this.getTrendLineForecast(a[s]));var l=0;for(var c in n){var h=n[c];l=h[1]-h[0]||0;for(var u=0,d=h.length;u<d;u++)isNaN(h[u])||this.options.log&&h[u]<=0||(t=Math.min(t,h[u]),e=Math.max(e,h[u]),i=!1)}return this._isBaseAxis()&&l&&this.forecast&&(t+=l*this.forecast[0],e+=l*this.forecast[1]),i&&(t=0,e=100),[t,e]},_getSeriesValue:function(t,e){var n=e.name||"",r=this.componentType==a.X_AXIS_COMPONENT?"x":"y";if(i.hasNotDefined(e.stack)||this._isBaseAxis())t[n]=t[n]||[],e.points.forEach(function(e){!e.isNull&&e.visible&&t[n].push(e.options[r])});else{var s=e.stack+e.type+"STACK_POSITIVE",o=e.stack+e.type+"STACK_NEGATIVE";t[s]=t[s]||[],t[o]=t[o]||[],e.points.forEach(function(e,i){if(!e.isNull&&e.visible){var a=+e.options[r];a>0?null!=t[s][i]&&void 0!=t[s][i]?t[s][i]+=a:t[s][i]=a:null!=t[o][i]&&void 0!=t[o][i]?t[o][i]+=a:t[o][i]=a}})}},getStartPos:function(){return this.scale(this.getStartPosValue())},getStartPosValue:function(){var t=this.options;return t.log&&1!==t.log?1:0},_getTickValues:function(){var t=[];if(this.options.log)for(var e,a=0;(e=this._tickStart*Math.pow(this.options.log,a))<=this._domain[1];)t.push(e),a+=this._step;else for(var n=this._tickStart;n<=this._domain[1];n=i.accAdd(n,this._step))t.push(n);return t}});return a.register(a.VALUE_AXIS_COMPONENT,r),r}),define("component/DateAxis",["require","./Base","./BaseAxis","../utils/BaseUtils","../Constants","../ComponentLibrary","../utils/Scale"],function(t){var e=(t("./Base"),t("./BaseAxis")),i=t("../utils/BaseUtils"),a=(t("../Constants"),t("../ComponentLibrary")),n=t("../utils/Scale"),r=e.extend({type:a.DATE_AXIS_COMPONENT,getAxisValue:function(t){return i.object2date(t)},fixScaleAndTickData:function(){var t=[i.int2date(this._domain[0]),i.int2date(this._domain[1])];this.scale.domain(t).rangeRound(this._getRange()),this._calculateDateFormat(),this._updateOriginTickData(),this._calculateTickPosAndStep()},_calculateDateFormat:function(){var t=this._step,e="Dyyyy";t<=1e3?e="Dss":t<=6e4?e="Dmm:ss":t<=36e5?e="Dhh:mm":t<=864e5?e="Ddd-hh":t<=26784e5?e="DMM-dd":t<=321408e5&&(e="Dyyyy-MM"),this.dateFormat=e},_getTickContent:function(t,e){var a=this.dateFormat;return e=e||function(t){return window.FR&&window.FR.contentFormat(t,a)||t},i.format(t,e)},initScale:function(){this.lastScale=this.scale,this.scale=n.linear()},_getStartAndEndTick:function(){return[i.int2date(this._domain[0]),i.int2date(this._domain[1])]},_getTickValues:function(){for(var t=[],e=this._tickStart;e<=this._domain[1];e=i.accAdd(e,this._step))t.push(i.int2date(e));return t},_valueInDomain:function(t){var e=this.scale.domain();return t>=Math.min(e[0],e[1])&&t<=Math.max(e[0],e[1])},_getDomainFromData:function(){for(var t=Math.ceil(Number.MAX_VALUE),e=-t,a=this.series,n=!1,r=0,s=0,o=a.length;s<o;s++){var l=a[s];if(l[this.componentType]==this&&l.visible){this.getTrendLineForecast(a[s]);var c=l.points;c.length>1&&(r=this.getValueFromData(c[1])-this.getValueFromData(c[0])||0);for(var s=0,o=c.length;s<o;s++){var h=this.getValueFromData(c[s]);h.getTime&&(n=!0,h=i.date2int(h),t=Math.min(t,h),e=Math.max(e,h))}}}return this._isBaseAxis()&&r&&this.forecast&&(t+=r*this.forecast[0],e+=r*this.forecast[1]),n||(t=e=(new Date).getTime()),e=t>=e?t+1e3:e,[t,e]},getValueFromData:function(t){var e=this.componentType==a.X_AXIS_COMPONENT?0:1,n=this.componentType==a.X_AXIS_COMPONENT?"x":"y",r=i.isArray(t)?t[e]:t[n];return i.object2date(r)}});return a.register(a.DATE_AXIS_COMPONENT,r),r}),define("component/Axis",["require","./Base","../utils/BaseUtils","../Constants","../ComponentLibrary","./CategoryAxis","./ValueAxis","./DateAxis"],function(t){var e=t("./Base"),i=t("../utils/BaseUtils"),a=t("../Constants"),n=t("../ComponentLibrary"),r=t("./CategoryAxis"),s=t("./ValueAxis"),o=t("./DateAxis"),l=e.extend({_refresh:function(){this._axisList=this._axisList||[];for(var t=this.options,e=(t=i.isArray(t)?t:[t]).length,a=e;a<this._axisList.length;a++)this._axisList[a].remove(),this._axisList[a]=null;this._axisList.length=e;for(a=e-1;a>=0;a--)if(t[a].axisIndex=a,this._axisList[a]&&this._axisList[a].type!=t[a].type&&(this._axisList[a].remove(),this._axisList[a]=null),this._axisList[a])this._axisList[a].refresh(t[a]);else{var l,c=t[a].type||n.VALUE_AXIS_COMPONENT;c==n.VALUE_AXIS_COMPONENT?l=s:c==n.CATEGORY_AXIS_COMPONENT?l=r:c==n.DATE_AXIS_COMPONENT&&(l=o),this._axisList[a]=new l(t[a],this.componentType,this.vanchart)}},doLayout:function(){for(var t=this._axisList.length-1;t>=0;t--)this._axisList[t].calculateDomainFromData(),this._axisList[t]._calculateSize(),this._axisList[t]._recordAxisSize()},reCalculateSize:function(){for(var t=this._axisList.length-1;t>=0;t--)this._axisList[t]._calculateSize(),this._axisList[t]._recordAxisSize()},updateAxisClip:function(){for(var t={},e=this._axisList.length-1;e>=0;e--)this._axisList[e].updateClipBounds(t);this._recordForPlotBounds(a.LEFT,t[a.LEFT]||0),this._recordForPlotBounds(a.RIGHT,t[a.RIGHT]||0),this._recordForPlotBounds(a.TOP,t[a.TOP]||0),this._recordForPlotBounds(a.BOTTOM,t[a.BOTTOM]||0)},updateAxisSizeAndBounds:function(){for(var t=this._axisList.length-1;t>=0;t--)this._axisList[t].updateAxisSizeAndBounds()},adjustDomain4Radius:function(){for(var t=!1,e=this._axisList.length-1;e>=0;e--)t=this._axisList[e].adjustDomain4Radius()||t;return t},fixBoundsByPlot:function(){for(var t=this.vanchart.bounds,e={},n=0,r=this._axisList.length;n<r;n++){s=(h=this._axisList[n]).getPosition();h.isOnZero()?(l?h.bounds.width=t.width:h.bounds.height=t.height,h.fixScaleAndTickData()):(e[s]=e[s]||[],e[s].push(h))}for(var s in e)for(var o=e[s],l=s==a.TOP||s==a.BOTTOM,n=0,c=o.length;n<c;n++){var h=o[n],u=h.bounds,d=o[n-1]&&o[n-1].bounds||t;if(l){var p=s==a.TOP?d.y-u.height:d.y+d.height;h.bounds=i.makeBounds(d.x,p,d.width,u.height)}else{var f=s==a.LEFT?d.x-u.width:d.x+d.width;h.bounds=i.makeBounds(f,d.y,u.width,d.height)}h.fixScaleAndTickData()}},getAxis:function(t){return t>=this._axisList.length&&(t=0),this._axisList[t]},getAxisCount:function(){return this._axisList.length},axisZoom:function(t,e){this._axisList.forEach(function(i){i.axisZoom(t,e)})},dealOnZero:function(){this._axisList.forEach(function(t){t.dealOnZero()})},render:function(){for(var t=0,e=this._axisList.length;t<e;t++)this._axisList[t].render()}});return n.register(n.X_AXIS_COMPONENT,l),n.register(n.Y_AXIS_COMPONENT,l),l}),define("component/GaugeAxis",["require","../Constants","./Axis","../ComponentLibrary"],function(t){var e=(t("../Constants"),t("./Axis")),i=t("../ComponentLibrary"),a=e.extend({initAttributesWithSeries:function(){for(var t=this._axisList.length-1;t>=0;t--){var e=this._axisList[t];e.calculateDomainFromData(),e.scale.domain(e._domain),e._updateOriginTickData(),e.options.showLabel||e.tickData.forEach(function(t){t.tickContent=""})}},doLayout:function(){},render:function(){}});return i.register(i.GAUGE_AXIS_COMPONENT,a),a}),define("component/LegendItem",["require","../dom/Evented","../Constants","../utils/BaseUtils","./LegendIconFactory","../ComponentLibrary"],function(t){var e,i=t("../dom/Evented"),a=t("../Constants"),n=t("../utils/BaseUtils"),r=t("./LegendIconFactory"),s=t("../ComponentLibrary"),o=function(){return null==e&&(e=n.paddingConvertWithScale("0.5rem")),e};return i.extend({initialize:function(t,e){this.legendX=0,this.legendY=0,this.legend=t,this.refresh(e)},refresh:function(t){this.options=t,t.renderItem=this},render:function(){var t=this.legend,e=t.vanchart,i=e.renderer,s=t.options.style;this.graphic||(this.graphic=t.legendItemsGroup.append(i.group()),this.options.isTrendLine||this.graphic.style({cursor:"pointer"})),e.registerInteractiveTarget(this,this.graphic);var l=this.graphic,c=this.options,h=c.visible?c.color:c.hiddenColor,u=r.getLegendIconSize(c.legendIconType),d=n.getTextDimension(c.itemName,s,t.options.useHtml),p=Math.max(u.height,d.height);this.graphic.attr({transform:n.makeTranslate([this.legendX,Math.round(this.legendY+p/2)])}),r.hasIcon(c.legendIconType)?(l.image&&l.image.remove(),l.image=null,l.path=l.path||i.path().addTo(l),l.path.attr("d",r.getLegendIconPath(c.legendIconType)).attr("transform",n.makeTranslate([0,-u.height/2])).style({fill:h,"fill-opacity":c.opacity}),c.series.type==a.BUBBLE_CHART&&l.path.style("stroke",h).style("stroke-width",1)):(l.path&&l.path.remove(),l.path=null,l.image=l.image||i.image().addTo(l),l.image.attr({x:0,y:-u.height/2,width:12,height:12,preserveAspectRatio:"none"}).imageContent(c.legendIconType));var f=n.isSupportSVG()?{dy:"0.32em"}:{};l.text=l.text||l.append(i.vtext()),l.text.textContent(c.itemName||"").style("margin-top","-0.7em").attr(f).attr("x",u.width+o()).style({cursor:this.options.isTrendLine?"default":"pointer","white-space":"nowrap"}).style(s).style({fill:c.visible?s.color:c.hiddenColor})},getEvents:function(){return this.options.isTrendLine?{}:{mouseover:this.onMouseOver,mouseout:this.onMouseOut,tap:this.onTap}},onMouseOver:function(){this.legend.options.hover?n.getFormatterFunction(this.legend.options.hover)():(this.graphic&&this.graphic.text&&this.graphic.text.style({fill:this.options.hoverColor}),this.legend.options.highlight&&(this.legend.highlighted=!0,this.legend.vanchart.makeLegendHighlight(this.options.itemName)))},onMouseOut:function(t){var e=this,i=e.legend,a=e.options,n=a.visible?i.options.style.color:a.hiddenColor;this.graphic&&this.graphic.text&&this.graphic.text.style({fill:n})},onTap:function(){if(this.legend.options.click)n.getFormatterFunction(this.legend.options.click)();else{for(var t=this.options.bindName,e=this.legend.vanchart,i=e.series,r={},o=0,l=i.length;o<l;o++){var c=i[o];c.isSeriesAccumulated()?c.points.map(function(e){e.name==t&&(e.visible=!e.visible)}):c.name===t&&(c.visible=!c.visible,c.state=c.visible?a.STATE_TO_SHOW:a.STATE_TO_DROP,c._getAxisTypes().forEach(function(t){var e=c[t];!e||e._isBaseAxis()||r[n.stamp(e)]||(r[n.stamp(e)]=!0,e.calculateDomainFromData(),e.componentType===s.X_AXIS_COMPONENT||e.componentType===s.Y_AXIS_COMPONENT?e.adjustDomain4Radius():e.fixScaleAndTickData())}))}this.options.visible=!this.options.visible,this.options.pairLegendOpt&&(this.options.pairLegendOpt.visible=this.options.visible,this.options.pairLegendOpt.renderItem.render(),this.options.pairLegendOpt.renderItem.onMouseOut()),e.reRenderWholePlot()}},remove:function(){this.graphic&&this.graphic.remove(),this.graphic=null}})}),define("component/Legend",["require","./Base","../utils/BaseUtils","../Constants","./LegendIconFactory","./LegendItem","../dom/Evented","../utils/BezierEasing","../ComponentLibrary"],function(t){var e,i,a,n,r=t("./Base"),s=t("../utils/BaseUtils"),o=t("../Constants"),l=t("./LegendIconFactory"),c=t("./LegendItem"),h=t("../dom/Evented"),u=t("../utils/BezierEasing"),d=t("../ComponentLibrary"),p=function(){return null==e&&(e=s.paddingConvertWithScale("0.312rem")),e},f=function(){return null==i&&(i=s.paddingConvertWithScale("0.5rem")),i},m=function(){return null==a&&(a=s.paddingConvertWithScale("0.25rem")),a},g=function(){return null==n&&(n=s.paddingConvertWithScale("1rem")),n},v=r.extend({doLayout:function(){this.invisible()?this.remove():(this.items=this.items||[],this.yPanEnabled=!1,this.xPanEnabled=!1,this.hasPages=!1,this._updateLegendItems(),this._layoutLegendItemBounds())},_updateLegendItems:function(){var t,e,i=this.vanchart.series,a={},n={},r=this,s=this.vanchart,l=[];for(t=0,e=i.length;t<e;t++){var h=i[t];if(h.type!=o.GAUGE_CHART)if(h.isSeriesAccumulated()){var u="name";h.points.map(function(t){if(!a[t[u]]){var e={color:s.getDefaultSeriesColor(t[u]),opacity:t.opacity,bindName:t[u],itemName:t[u],visible:t.visible};r._mergeCommonLegendAttr(h,e),a[t[u]]=!0,l.push(e)}})}else{if(!a[h.name]){d={color:h.color,opacity:h.opacity,bindName:h.name,itemName:h.name,visible:h.visible};r._mergeCommonLegendAttr(h,d),a[h.name]=d,l.push(d)}if(h.options.trendLine&&!n[h.name]){var d={isTrendLine:!0,color:h.options.trendLine.color,opacity:h.opacity,bindName:h.name,itemName:h.options.trendLine.name,visible:h.visible};r._mergeCommonLegendAttr(h,d),d.legendIconType=void 0,a[h.name].pairLegendOpt=d,d.pairLegendOpt=a[h.name],n[h.name]=d,l.push(d)}}}for(t=l.length,e=this.items.length;t<e;t++)this.items[t].remove(),this.items[t]=null;for(t=0,e=l.length;t<e;t++)this.items[t]?this.items[t].refresh(l[t]):this.items[t]=new c(r,l[t]);this.items.length=l.length},_mergeCommonLegendAttr:function(t,e){var i=this.options,a=i.hiddenColor,n=i.hoverColor||i.style.color;s.extend(e,{series:t,hiddenColor:a,hoverColor:n,legendIconType:this._getLegendType(t),lineIndex:0})},_layoutLegendItemBounds:function(){var t=this.options,e=t.position||o.RIGHT;if(this.items.length)if(e==o.TOP||e==o.BOTTOM){var i=(g=this._layoutHorizontalLegendItemBounds()).height,a=this._maxHeight();this.yPanEnabled=t.maxHeight&&i>a,this.maxYPan=20-g.height;var n=(this.yPanEnabled?a:i)+2*p();this._setComponentBounds(e,n);var r=this.bounds.x+p(),s=this.bounds.y+p(),l=this.bounds.height-2*p()+2*(this.options.borderWidth||0),c=this.bounds.width-2*p(),h=g.width-2*p();r+=(c-h)/2,this.bounds={x:r,y:s,width:h,height:l}}else{var u=0;if((e==o.RIGHT||e==o.RIGHT_TOP)&&!this.isFloat){this.vanchart.getComponent(d.TOOLBAR_COMPONENT)&&(u=37);var f=this.vanchart.getComponent(d.TITLE_COMPONENT);f&&f.bounds&&!f.isFloat&&(u-=f.bounds.height)}var g=this._layoutVerticalLegendItemBounds(),i=g.width,v=this._maxWidth(),l=this.vanchart.bounds.height-(this.isFloat?0:2*p())-u;if(this.hasPages=g.height-m()>l,this.hasPages){l-=12+p(),this.pageIndex=this.pageIndex||0,this.translateMap=[0];for(var y=0,M=0,F=this.items.length;M<F;M++){var _=this.items[M].legendY;_-y>l&&(y=_-m(),this.translateMap.push(-_))}this.pageCount=this.translateMap.length,i=Math.max(i,this._getPageButtonWidth(this.pageCount))}this.yPanEnabled=this.hasPages,this.xPanEnabled=t.maxWidth&&i>v,this.maxYPan=20-g.height,this.maxXPan=v-i;var T=(this.xPanEnabled?v:i)+(this.isFloat?0:2*p());this._setComponentBounds(e,T);var r=this.bounds.x+(this.isFloat?0:p()),s=this.bounds.y+(this.isFloat?0:p()),c=this.bounds.width-(this.isFloat?0:2*p()),l=this.bounds.height-(this.isFloat?0:2*p())-u,b=Math.min(g.height,l);s=Math.max(u,s),this.isFloat||e==o.RIGHT_TOP||(s+=Math.round((l-b)/2)),this.bounds={x:r,y:s,width:c,height:b}}},_getPageButtonWidth:function(t){var e={fontFamily:this.options.style.fontFamily||"Verdana",fontSize:"14px"},i=t+"/"+t;return p(),24+s.getTextDimension(i,e,!1).width},_layoutVerticalLegendItemBounds:function(){for(var t=0,e=p(),i=this.options.borderWidth||0,a=0,n=this.items.length;a<n;a++){var r=this.items[a],o=r.options,c=s.getTextDimension(o.itemName,this.options.style,this.options.useHtml),h=l.getLegendIconSize(this.items[a].legendIconType);t=Math.max(c.width+f()+h.width,t),r.legendX=p()+i/2,r.legendY=e,e+=Math.max(c.height,h.height)+m()}return{width:2*p()+t,height:e+p()}},_layoutHorizontalLegendItemBounds:function(){for(var t=this.vanchart.bounds.width-4*p(),e=p(),i=p(),a=e,n=[],r=[],o=0,c=0,h=this.items.length;c<h;c++){var u=this.items[c],d=u.options,m=l.getLegendIconSize(d.legendIconType),v=s.getTextDimension(d.itemName,this.options.style,this.options.useHtml),y=Math.min(m.width+f()+v.width,t-1);e+y<t?(u.legendX=e,u.legendY=i):(n.push({items:r,usedWidth:e}),o=0,e=p(),i+=Math.max(v.height,m.height),u.legendX=e,u.legendY=i,r=[]),r.push(u),o=Math.max(o,v.height),e+=y+g(),a=Math.max(e,a)}return n.push({items:r,usedWidth:e}),n.forEach(function(t){var e=t.usedWidth,i=t.items,n=Math.max((a-e)/2,0);i.forEach(function(t){t.legendX+=n})}),i+=o,{width:Math.round(a)+p(),height:Math.round(i)+p()}},render:function(){if(!this.invisible()&&this.items.length){var t=this.bounds,e=this,i=e.vanchart,a=i.renderer;this.legendGroup||(this.legendGroup=this.createComponentGroup(),this.backgroundGroup=a.group().addTo(this.legendGroup),this.clipGroup=a.group().addTo(this.legendGroup),this.legendItemsGroup=a.group().addTo(this.clipGroup),i.registerInteractiveTarget(this,this.legendGroup)),this.legendGroup.attr("transform",s.makeTranslate(t)),i._renderRectangleBackground(this.backgroundGroup,this.options,s.makeBounds(0,0,t.width,t.height));for(var n=0,r=this.items.length;n<r;n++)this.items[n].render();var o={x:0,y:0,width:t.width,height:t.height};this.hasPages?(o.height-=12,this.pageButton=this.pageButton||new y(e),this.pageButton.refresh()):this.pageButton&&(this.pageButton.remove(),this.pageButton=null),this.verticalClip?a.updateClip(this.verticalClip,o):(this.verticalClip=a.createClip(o),a.clip(this.clipGroup,this.verticalClip))}},getEvents:function(){return{mouseout:this.mouseOut,panstart:this.onPanStart,panmove:this.onPanMove,panend:this.onPanEnd}},mouseOut:function(){this.highlighted&&this.vanchart.cancelLegendHighlight()},onWheel:function(t){var e=t.srcEvent;e.preventDefault(),this.getLegendPos(),this.moveLegend(-e.deltaX,-e.deltaY)},onPanStart:function(t){this.initPos=t.containerPoint,this.getLegendPos()},onPanMove:function(t){var e=t.containerPoint.x-this.initPos.x,i=t.containerPoint.y-this.initPos.y;this.moveLegend(e,i)},onPanEnd:function(){this.vanchart.handler.panTarget=null},getLegendPos:function(){var t=this.legendItemsGroup.trans||[0,0];this.initTranslateX=t[0],this.initTranslateY=t[1]},moveLegend:function(t,e){var i=0,a=0;if(this.xPanEnabled&&(i=t+this.initTranslateX,i=Math.max(this.maxXPan,Math.min(0,i))),this.yPanEnabled&&(a=e+this.initTranslateY,a=Math.max(this.maxYPan,Math.min(0,a))),this.hasPages&&this.pageButton){for(var n=this.translateMap.length-1,r=0,o=this.translateMap.length-1;r<o;r++){var l=this.translateMap[r],c=this.translateMap[r+1];l>=a&&c<a&&(n=r)}this.pageIndex!=n&&(this.pageIndex=n,this.pageButton.updatePage())}this.legendItemsGroup.attr("transform",s.makeTranslate([i,a])),this.legendItemsGroup.trans=[i,a]},remove:function(){this.legendGroup&&this.legendGroup.remove(),this.legendGroup=null,this.items&&(this.items.length=0)}}),y=h.extend({initialize:function(t){this.legend=t},refresh:function(){var t=this.legend,e=t.vanchart,i=e.renderer,a=t.bounds,n=t._getPageButtonWidth(t.pageCount),r=a.height-12,o=(a.width-n)/2;this.pageGroup||(this.pageGroup=i.group().addTo(t.legendGroup),e.registerInteractiveTarget(this,this.pageGroup),this.leftButton=i.path().style({cursor:"pointer"}).addTo(this.pageGroup),this.rightButton=i.path().style({cursor:"pointer"}).addTo(this.pageGroup),this.pageText=i.text().style({fontFamily:t.options.style.fontFamily||"Verdana",fontSize:"14px"}).addTo(this.pageGroup));var l=n-12,c=o+(n-l)/2,h=o+(n+l)/2,u=o+n/2;this.pageGroup.attr("transform",s.makeTranslate([0,r])),this.leftButton.attr("d",this._prePageButtonPath(c)),this.rightButton.attr("d",this._nextPageButtonPath(h)),this.pageText.attr({x:u,y:"-.14em",dy:".85em"}).attr("text-anchor","middle"),this.updatePage()},remove:function(){this.pageGroup&&(this.pageGroup.remove(),this.pageGroup=null)},updatePage:function(){var t=this.legend,e=t.pageIndex,i=t.pageCount;this.leftButton.style({fill:e<=0?"rgb(204,204,204)":"rgb(67,67,72)"}),this.rightButton.style({fill:e<i-1?"rgb(67,67,72)":"rgb(204,204,204)"});var a=e+1+"/"+i;this.pageText.textContent(a),this.pageText.vMiddle()},_prePageButtonPath:function(t){var e=t-6,i=6*Math.sqrt(3);return"M"+t+",0L"+e+","+i+"L"+(t+6)+","+i+"Z"},_nextPageButtonPath:function(t){return"M"+(t-6)+",0L"+(t+6)+",0L"+t+","+6*Math.sqrt(3)+"Z"},onTap:function(t){var e=t.srcEvent,i=e.target||e.srcElement,a=this.legend;if(this.leftButton.node()==i){if(a.pageIndex<=0)return;a.pageIndex--}else if(this.rightButton.node()==i){if(a.pageIndex==a.pageCount-1)return;a.pageIndex++}a.legendItemsGroup.animate({duration:500,ease:u.css.swing,attr:{transform:"translate(0,"+a.translateMap[a.pageIndex]+")"}}),a.legendItemsGroup.trans=[0,a.translateMap[a.pageIndex]],this.updatePage()},getEvents:function(){return{tap:this.onTap}}});return d.register(d.LEGEND_COMPONENT,v),v}),define("component/ToolbarIcon",["require","./Base","../utils/BaseUtils","../Constants","../dom/Evented"],function(t){var e=(t("./Base"),t("../utils/BaseUtils")),i=t("../Constants");return t("../dom/Evented").extend({initialize:function(t,e,i,a){this.iconType=t,this.toolbar=e,this.visible=a,this.pos=i,this.currentPos={x:i.x,y:i.y}},render:function(){var t=this.toolbar,e=t.vanchart,i=e.renderer,a=this;this.iconG||(this.iconG=i.group().style({cursor:"pointer"}).addTo(t.toolbarGroup)),e.registerInteractiveTarget(this,this.iconG),this.iconG.attr("transform","translate("+a.pos.x+","+a.pos.y+")").style({display:this.visible?"":"none"}),this.iconG.rect=this.iconG.rect||i.rect().attr("width",32).attr("height",32).attr("rx",2).attr("ry",2).addTo(this.iconG),this.iconG.rect.style(t.hidden?{fill:"black","fill-opacity":0}:{fill:"black","fill-opacity":.05}),this.iconG.path=this.iconG.path||this._getIconPathGraphic(e,i,a)},_getIconPathGraphic:function(t,e,a){switch(this.iconType){case i.REFRESH_ICON:return e.path().attr("d",a.getRefreshIconPath()).style({fill:"#FF9933"}).addTo(this.iconG);case i.SORT:return t.orderType==i.ASCENDING?e.path().attr("d",a.getDecreaseIconPath()).style({fill:"#33CCFF"}).addTo(this.iconG):e.path().attr("d",a.getIncreaseIconPath()).style({fill:"#33CCFF"}).addTo(this.iconG);case i.EXPORT_ICON:return e.path().attr("d",a.getExportIconPath()).style({fill:"#6666CC"}).addTo(this.iconG);case i.FULL_SCREEN_ICON:return t.vancharts.fullScreenFather?e.path().attr("d",a.getMinIconPath()).style({fill:"#33CC66"}).addTo(this.iconG):e.path().attr("d",a.getMaxIconPath()).style({fill:"#33CC66"}).addTo(this.iconG);case i.MENU_ICON:return e.path().attr("d",a.getMenuIconPath()).style({"stroke-width":2,stroke:"#AAAAAA"}).addTo(this.iconG)}},refreshMove:function(t,e){var i=this.pos,a=this.currentPos.x-t,n=a+e;this.iconG.animate({ease:"circle-out",duration:220,attr:{transform:"translate("+a+","+i.y+")"}}).transition({ease:"circle-in",duration:220,attr:{transform:"translate("+n+","+i.y+")"}}),this.currentPos.x=n},refreshMoveWithoutAnimation:function(t,e){var i=this.currentPos.x-t+e;this.iconG.attr("transform","translate("+i+","+this.pos.y+")"),this.currentPos.x=i},showIcon:function(){this.visible=!0,arguments.length?this._iconAnimation(arguments[0],arguments[1]):this.iconG.style({display:""})},hideIcon:function(){this.visible=!1,arguments.length?this._iconAnimation(arguments[0],arguments[1]):(this.iconG.style({display:"none"}),this.iconG.attr("transform","translate("+this.pos.x+","+this.pos.y+")"),this.currentPos.x=this.pos.x)},_iconAnimation:function(t,i){var a=this.iconG,n=this.pos,r=this.visible;e.isSupportSVG()?setTimeout(function(){a.style({display:r?"":"none"});var e=4*t,i=n.x-e;a.animate([{ease:"circle-out",duration:100,attr:{transform:"translate("+i+","+n.y+")"}},{ease:"circle-in",duration:100,attr:{transform:"translate("+n.x+","+n.y+")"}}]),a.rect.style(r?{fill:"black","fill-opacity":0}:{fill:"black","fill-opacity":.05}).animate({ease:"linear",duration:200,style:r?{fill:"black","fill-opacity":.05}:{fill:"black","fill-opacity":0}})},i):(a.attr("transform","translate("+n.x+","+n.y+")").style({display:r?"":"none"}),a.rect.style(r?{fill:"black","fill-opacity":.05}:{fill:"black","fill-opacity":0})),this.currentPos.x=this.pos.x},onMouseOver:function(){this.iconG.rect.style(this.toolbar.hidden?{fill:"black","fill-opacity":.05}:{fill:"black","fill-opacity":.1})},onMouseOut:function(){this.iconG.rect.style(this.toolbar.hidden?{fill:"black","fill-opacity":0}:{fill:"black","fill-opacity":.05})},onTap:function(){var t=this.toolbar,a=t.vanchart,n=(a.renderer,this),r=a.getDivParentDom();switch(n.iconType){case i.REFRESH_ICON:a.clearAllEffects(),a.refreshRestore(),n.hideIcon();break;case i.SORT:a.orderType==i.ASCENDING?(a.orderType=i.DESCENDING,n.iconG.path.attr({d:n.getIncreaseIconPath()})):(a.orderType=i.ASCENDING,n.iconG.path.attr({d:n.getDecreaseIconPath()})),t.refreshEnabled()&&t.refreshIcon.showIcon(),a.orderData();break;case i.EXPORT_ICON:var s=this.toolbar.options.toImage;s&&s.imageUrl&&e.toPng(s.imageUrl);break;case i.FULL_SCREEN_ICON:a.vancharts.fullScreenFather?a.vancharts.hideLightBox(r,a.vancharts.fullScreenFather):a.vancharts.showLightBox(a);break;case i.MENU_ICON:t.showOrHide()}},getEvents:function(){return{mouseover:this.onMouseOver,mouseout:this.onMouseOut,tap:this.onTap}},getMaxIconPath:function(){return"M24,8v6.5L21.5,12l-3,3L17,13.5l3-3L17.5,8H24z M15,18.5l-3,3l2.5,2.5H8v-6.5l2.5,2.5l3-3L15,18.5z"},getMinIconPath:function(){return"M15,17v6.5L12.5,21l-3,3L8,22.5l3-3L8.5,17H15z M24,9.5l-3,3l2.5,2.5H17V8.5l2.5,2.5l3-3L24,9.5z"},getIncreaseIconPath:function(){return"M8,20h16v2H8V20z M10,16h2v3h-2V16z M13,14h2v5h-2V14z M16,12h2v7h-2V12z M19,9h2v10h-2V9z"},getDecreaseIconPath:function(){return"M8,20h16v2H8V20z M10,9h2v10h-2V9z M13,12h2v7h-2V12z M16,15h2v4h-2V15z M19,16h2v3h-2V16z"},getExportIconPath:function(){return"M22,8H8v16h16V10L22,8z M16,10h2v4h-2V10z M22,22H10V10h1v5h9v-5h1.171L22,10.829V22z"},getRefreshIconPath:function(){return"M21.656,10.344C20.209,8.896,18.209,8,16,8c-3.43,0-6.354,2.158-7.492,5.19l1.873,0.703C11.234,11.619,13.428,10,16,10c1.657,0,3.156,0.672,4.243,1.757L18,14h6V8L21.656,10.344z M16,22c-1.657,0-3.156-0.671-4.243-1.757L14,18H8v6l2.344-2.344C11.791,23.104,13.791,24,16,24c3.43,0,6.354-2.158,7.492-5.19l-1.873-0.703C20.766,20.381,18.572,22,16,22z"},getMenuIconPath:function(){return"M8,10L24,10 M8,15L24,15 M8,20L24,20"}})}),define("component/ToolBar",["require","./Base","../utils/BaseUtils","../Constants","./ToolbarIcon","../ComponentLibrary"],function(t){var e=t("./Base"),i=t("../utils/BaseUtils"),a=t("../Constants"),n=t("./ToolbarIcon"),r=t("../ComponentLibrary"),s=[a.GANTT_CHART,a.TREEMAP_CHART,a.WORD_CLOUD_CHART,a.FUNNEL_CHART,a.STRUCTURE_CHART,a.SCATTER_CHART,a.BUBBLE_CHART,a.FORCE_BUBBLE_CHART,a.AREA_MAP,a.POINT_MAP,a.LINE_MAP,a.HEAT_MAP],o=e.extend({doLayout:function(){var t=this.options,e=t.hidden,i=this.sortEnable()?["sort","toImage","fullScreen"]:["toImage","fullScreen"],r=[a.REFRESH_ICON];i.forEach(function(e){t[e]&&t[e].enabled&&r.push(e)}),e&&r.push(a.MENU_ICON);var s=33*r.length+5;if(this.startX=this.vanchart.width-s,!this.toolbarGroup){this.toolbarIcons=[],this.hidden=e;for(var o=0,l=r.length;o<l;o++){var c={x:33*o,y:5},h=r[o],u=!e;h==a.MENU_ICON?this.menuIcon=new n(h,this,c,!0):h==a.REFRESH_ICON?this.refreshIcon=new n(h,this,c,!1):this.toolbarIcons.push(new n(h,this,c,u))}this.isFloat=!0}},sortEnable:function(){var t,e=!0,i=this.vanchart.options,a=i.series;return i.chartType&&(t=i.chartType),a&&a.forEach(function(i){if(i.type){if(t&&t!=i.type)return void(e=!1);t=i.type}}),e&&-1==s.indexOf(t)},render:function(){this.vanchart.renderer,this.toolbarGroup?this.toolbarGroup.attr("transform",i.makeTranslate([this.startX,0])):(this.toolbarGroup=this.createComponentGroup().attr("transform",i.makeTranslate([this.startX,0])),this.toolbarIcons.forEach(function(t){t.render()}),this.menuIcon&&this.menuIcon.render(),this.refreshIcon&&this.refreshIcon.render())},showOrHide:function(){this.hidden?this.show():this.hide(),this.hidden=!this.hidden},hide:function(){for(var t=this.toolbarIcons,e=t.length,i=[],a=0;a<e;a++)i.push(100+80*a);for(a=0;a<e;a++){var n=e-a;t[a].hideIcon(n,i[a])}var r=4*(e+1),s=4*(e+1)+33*e;this.refreshIcon.visible&&this.refreshIcon.refreshMove(r,s)},show:function(){for(var t=[0],e=this.toolbarIcons,i=e.length,a=0;a<i-1;a++)t.push(100+80*a);for(a=0;a<i;a++){var n=i-a;e[a].showIcon(n,t[a])}var r=4*(i+1)+33*i,s=4*(i+1);this.refreshIcon.visible&&this.refreshIcon.refreshMove(r,s)},showRefreshIconWhenZoom:function(){if(!this.refreshIcon.visible&&this.refreshEnabled())if(this.menuIcon)if(this.hidden){var t=this.toolbarIcons.length,e=4*(t+1),i=4*(t+1)+33*t;this.refreshIcon.refreshMoveWithoutAnimation(e,i),this.refreshIcon.showIcon()}else this.refreshIcon.showIcon();else this.refreshIcon.showIcon()},refreshEnabled:function(){return!(this.options.refresh&&!1===this.options.refresh.enabled)},getToolBarInitWidth:function(){return this.options.enabled?this.options.hidden?37:33*this.toolbarIcons.length-1+5:0},remove:function(){this.toolbarGroup&&this.toolbarGroup.remove(),this.toolbarGroup=null}});return r.register(r.TOOLBAR_COMPONENT,o),o}),define("component/Polar",["require","../Constants","../utils/BaseUtils","./Base","../ComponentLibrary"],function(t){var e=(t("../Constants"),t("../utils/BaseUtils")),i=t("./Base");return t("../ComponentLibrary"),i.extend({_refresh:function(){this.series=[]},_isBaseAxis:function(){return!0},doLayout:function(){var t=this.options,i=t.radius,a=t.center;if(!a||0===a.length){var n=this.vanchart.bounds;a=[n.width/2+n.x,n.height/2+n.y]}this.setCenter(a),e.hasDefined(i)?this.setRadius(i):this.radius=null;var r=this.vanchart.options.plotOptions,s=r.radar&&r.radar.shape||r.shape;this.shape=s||this.shape},setRadius:function(t){t&&(this.radius=this._getPercentValue(t,Math.min(this.vanchart.width,this.vanchart.height)/2))},setCenter:function(t){t&&(this.center=[],this.center[0]=this._getPercentValue(t[0],this.vanchart.width),this.center[1]=this._getPercentValue(t[1],this.vanchart.height))},render:function(){var t=this.vanchart.renderer,e=this.radiusAxis,i={d:e._getRadiusGridPath(e.scale.domain()[1])};this.clip?t.updateClip(this.clip,i):this.clip=t.createClip(i,"path"),this.radiusAxis.render(),this.angleAxis.render()}})}),define("component/AngleAxis",["require","./Base","./CategoryAxis","../utils/BaseUtils","../Constants","../ComponentLibrary","../utils/Scale","../utils/PathGenerator"],function(t){var e,i=(t("./Base"),t("./CategoryAxis")),a=t("../utils/BaseUtils"),n=(t("../Constants"),t("../ComponentLibrary"),t("../utils/Scale")),r=t("../utils/PathGenerator"),s=function(){return null==e&&(e=a.paddingConvertWithScale("0.625rem")),e},o="radar-top",l="radar-bottom",c="radar-left",h="radar-right";return i.extend({_refresh:function(t){this.series=[],this.piece=null,this.initScale(),this.refreshPolar(t)},refreshPolar:function(t){this.polar=this.vanchart.polar(t.axisIndex),this.polar.angleAxis=this},doLayout:function(){this.calculateDomainFromData(),this.scale.domain(this._dataDomain).rangePoints([0,this._dataDomain.length-1]),this.piece=2*Math.PI/Math.max(this._dataDomain.length,1),this._updateOriginTickData(),this._updatePolarBounds(),this._calculateTickData()},fixScaleAndTickData:function(){this.scale.domain(this._dataDomain).rangePoints([0,this._dataDomain.length-1]),this._updateOriginTickData(),this._calculateTickData()},_calculateTickData:function(){var t,e=this.polar.radius;this.isBreakLabels&&(t=this._getTestBoundsAndRadius().testBounds),this.tickData.map(function(i){this._getCateLabelBounds(e,i,t)},this)},_getTestBoundsAndRadius:function(){var t=this.vanchart.bounds,e=this.polar.center,i=[e[1]-t.y,t.x+t.width-e[0],t.y+t.height-e[1],e[0]-t.x],a=Math.min.apply(null,i);return a-=s(),{testBounds:{x:-i[3],y:-i[0],width:t.width,height:t.height},radius:a}},_updatePolarBounds:function(){if(!this.polar.radius){var t=this._getTestBoundsAndRadius(),e=t.radius,i=t.testBounds;this.options.showLabel&&(this._testRadius(e,i)||(e=this._findNiceRadius(i),this._testRadius(e,i))),this.polar.setRadius(e)}},getIndexByPosition:function(t){return this._getIndexByPolarCoordinate(t)},_getIndexByPolarCoordinate:function(t){var e=this.polar.center,i=this.polar.radius,n=this.isAxisReversed(),r=t[0]-e[0],s=e[1]-t[1];if(r*r+s*s>i*i)return-1;var o,l=a.getArcByPoint(r,s),c=this.getCategories();if(c.length>1){var h=2*Math.PI/c.length;o=n?c.length-1-l/h:l/h}else o=0;return o=Math.round(o),o%=c.length},getAngleGridLineData:function(){var t=[],e=this.polar.angleAxis,i=this;return e.scale.domain().forEach(function(n){var r=e.scale(n)*e.piece,s=i.polar.radius;t.push(a.getArcPoint(s,r))}),t=t.length?t:[a.getArcPoint(this.polar.radius,0)]},getCateAngleGridLineData:function(){var t=this.getAngleGridLineData(),e=this.polar.angleAxis.scale.domain();return t.map(function(t,i){return{name:e[i],pos:t}})},_testRadius:function(t,e){for(var i=0,n=this.tickData.length;i<n;i++){var r=this.tickData[i],s=this._getCateLabelBounds(t,r);if(!a.containsRect(e,s))return!1}return!0},_getCateLabelBounds:function(t,e,i){var n,r=e.tickValue,u=e.tickRectDim,d=this.scale.domain().indexOf(r),p=a.getArcPoint(t+s(),d*this.piece),f=this.options,m=this._getPolarPosition(r),g=a.extend({width:"","white-space":"","text-align":""},f.labelStyle);switch(m){case o:n={style:g,x:-u.width/2,y:-t-.65*u.height-s()};break;case h:if(n={style:g,x:p[0],y:p[1]-u.height/2},i&&this.isBreakLabels&&n.x+u.width>i.x+i.width){var v=i.x+i.width-p[0],y=a.extend({width:v+"px","white-space":"normal","text-align":"left"},f.labelStyle);u=a.getTextWrapDimension(e.tickContent,y),n={style:y,x:p[0],y:p[1]-u.height/2}}break;case l:n={style:g,x:-u.width/2,y:t+s()};break;case c:if(n={style:g,x:p[0]-u.width,y:p[1]-u.height/2},i&&this.isBreakLabels&&n.x<i.x){var v=p[0]-i.x,y=a.extend({width:v+"px","white-space":"normal","text-align":"right"},f.labelStyle);u=a.getTextWrapDimension(e.tickContent,y),n={style:y,x:p[0]-u.width,y:p[1]-u.height/2}}}return e.tickPos=n,a.makeBounds(n,u)},_getPolarPosition:function(t){var e=this.scale.domain(),i=e.indexOf(t),a=e.length/2;return 0===i?o:i>0&&i<a?h:i==a?l:i>a?c:void 0},_findNiceRadius:function(t){var e=[-t.y,t.width+t.x,t.height+t.y,-t.x],i=Math.min.apply(null,e),a=i,n=this.scale.domain(),r=this;return this.tickData.forEach(function(t){if(t.tickContent){var i,s=t.tickValue,u=t.tickDim,d=n.indexOf(s);switch(r._getPolarPosition(s)){case o:i=e[0]-u.height;break;case h:i=(e[1]-u.width)/Math.abs(Math.sin(d*r.piece));break;case l:i=e[2]-u.height;break;case c:i=(e[3]-u.width)/Math.abs(Math.sin(d*r.piece))}a=Math.min(a,i)}}),a<2*i/3&&(a=2*i/3,this.options.labelRotation||this.options.useHtml||(this.isBreakLabels=!0)),a-s()},getPointsInCategory:function(t){var e=this.polar.center,i=this.polar.radius,r=t.x-e[0],s=e[1]-t.y;if(r*r+s*s>i*i)return null;var o=a.getArcByPoint(r,s),l=this.scale.domain(),c=this.scale.rangeExtent(),h=n.quantize().domain(c).range(l),u=l.length,d=h(Math.round(o/(2*Math.PI)*u)%u);return this.vanchart.getValidPointsPara(d)},render:function(){var t=this.vanchart,e=t.renderer;this.axisGroup||(this.axisGroup=e.vgroup().add(t.backGroup)),this.axisGroup.attr("transform",a.makeTranslate(this.polar.center)),this._drawAxisLine(this.axisGroup),this._drawGridLine(this.axisGroup),this._drawTickLabel(this.axisGroup)},_drawAxisLine:function(t){var e=this.vanchart.renderer,i=this.polar.radiusAxis,a=this,n=a.options.lineWidth,r=a.options.lineColor,s=i.scale.domain()[1];this.axisLine||(this.axisLine=t.append(e.path())),this.axisLine.attr({d:i._getRadiusGridPath(s)}).style({fill:"none",stroke:r,"stroke-width":n})},_drawGridLine:function(t){var e=this.vanchart.renderer,i=this.polar.radiusAxis.options,a=i.lineWidth,n=i.lineColor;this.gridLinesGroup||(this.gridLinesGroup=t.append(e.group()),this.gridLines=[]);var r=this.gridLinesGroup,s=this.getAngleGridLineData(),o=this._bindData(this.gridLines,s);o.exit.map(function(t){t.remove()});var l=o.enter.map(function(t){return r.append(e.line()).datum(t)});this.gridLines=l.concat(o.update).map(function(t){var e=t.datum();return t.style({stroke:n,"stroke-width":a}).attr({x1:0,y1:0,x2:e[0],y2:e[1]})})},_drawTickLabel:function(t){this._drawSvgTickLabel(t)},_drawSvgTickLabel:function(t){var e=this.vanchart.renderer,i=this,a=i.options,n=this.isBreakLabels,r=a.useHtml||n,s=i.tickData;this.tickLabelsGroup||(this.tickLabelsGroup=t.append(e.vgroup()),this.tickLabels=[]),r&&this.tickLabels.length&&"div"!==this.tickLabels[0].type&&(this.tickLabels.map(function(t){t.remove()}),this.tickLabels=[]);var o=this.tickLabelsGroup,l=this._bindData(this.tickLabels,s,function(t){return t.tickValue});if(l.exit.map(function(t){t.remove()}),a.showLabel){var c=l.enter.map(function(t){return o.append(e.vtext(r).datum(t))});this.tickLabels=c.concat(l.update).filter(function(t){return t.datum().tickPos}).map(function(t){var e=t.datum(),i=e.tickPos.x,a=e.tickPos.y,n="div"===t.type?"px":"",r={transform:"translate("+i+n+" "+a+n+")",dy:"0.85em"};return t.textContent(e.tickContent).style(e.tickPos.style).attr(r),t.vRotate(e.labelRotation),t})}},drawHighlightBackground:function(t){var e=t[0].category,i=this.scale,n=this.series[0]&&this.series[0].options.columnType||!1,s=this.vanchart.renderer,o=i.domain(),l=this.polar.radius,c=i(e)/o.length*2*Math.PI;if(n){var h=1/o.length*2*Math.PI*.5,u=c-h,d=c+h,p=r.arc().innerRadius(0).outerRadius(l).startAngle(u).endAngle(d);this.highlightBand||(this.highlightBand=this.axisGroup.append(s.path().style({fill:"rgba(98,179,240,0.2)"}))),this.highlightBand.attr("d",p())}else{var f=a.getArcPoint(l,c);this.highlightLine||(this.highlightLine=this.axisGroup.append(s.line({stroke:"rgb(140,140,140)","stroke-width":"1"}))),this.highlightLine.attr("x2",f[0]).attr("y2",f[1])}},remove:function(){this.axisGroup&&this.axisGroup.remove(),this.axisGroup=null}})}),define("component/RadiusAxis",["require","./Base","./ValueAxis","../utils/BaseUtils","../Constants","../ComponentLibrary","../utils/PathGenerator","../utils/Interpolator","../utils/Scale"],function(t){var e,i=(t("./Base"),t("./ValueAxis")),a=t("../utils/BaseUtils"),n=t("../Constants"),r=t("../ComponentLibrary"),s=t("../utils/PathGenerator"),o=t("../utils/Interpolator"),l=t("../utils/Scale"),c=function(){return null==e&&(e=a.paddingConvertWithScale("0.125rem")),e};return i.extend({_refresh:function(t){this.series=[],this.initScale(),this.refreshPolar(t)},refreshPolar:function(t){this.polar=this.vanchart.polar(t.axisIndex),this.polar.radiusAxis=this},doLayout:function(){var t=this.series;this.indicator=t.length&&t[0].options.indicator&&t[0].options.indicator.enabled,this.calculateDomainFromData(),this.scale.domain(this._domain).range([0,this.polar.radius]),this._initCateScale(this._domain,[0,this.polar.radius]),this._updateOriginTickData()},_initCateScale:function(t,e){var i=l.linear().domain(t).range(e);this._cateScale=i},_calculateCateDomainData:function(){var t,e=this,i=e.series,n=(i.vanchart,i.length&&i[0].options).indicator,s=this.type==r.VALUE_AXIS_COMPONENT&&!this._isBaseAxis(),o=Number.MAX_VALUE,l=-o,c={};this._cateDataDomain=[],n.data&&n.data.length&&(t=n.data.map(function(t){return{name:t.name,domain:[t.min,t.max]}}));for(var h=!1,u=0,d=i.length;u<d&&!h;u++)h=i[u].visible;i.forEach(function(t){if(t.visible||!h){var i=!(a.hasNotDefined(t.stack)||e._isBaseAxis());t.points.forEach(function(t){var e=t.category,a=t.value;!t.isNull&&t.visible&&(i?(c[e]=c[e]||[0,0],a>=0?c[e][1]+=a:c[e][0]+=a):(c[e]=c[e]||[o,l],c[e][0]=Math.min(c[e][0],a),c[e][1]=Math.max(c[e][1],a)))})}});for(key in c)this._cateDataDomain.push({useIndicator:!1,name:key,domain:c[key]});var p=function(t){s&&(t[0]>0?t[0]=0:t[1]<0&&(t[1]=0))};t&&t.forEach(function(t){var i=t.name,a=t.domain[0],n=t.domain[1];e._cateDataDomain.forEach(function(t){if(i===t.name){if(null==a&&null==n)return;if(null!=a&&null!=n&&a>=n)return;var e=t.domain[0],r=t.domain[1],o=a||(s&&e>0?0:e),l=n||(s&&r<0?0:r),c=!1,h=!1;a&&(c=!0),n&&(h=!0),c&&!h?l=l<=o?o+100:l:h&&!c&&(o=o>l?l-100:o),t.useIndicator=!0,t.domain=[o,l]}})}),this._cateDataDomain.forEach(function(t){t.useIndicator||p(t.domain)}),this._calculateCateNiceDomain(),this._updateCategoryTickData()},_calculateCateNiceDomain:function(){var t=this;t.series.vanchart,this._cateTickStart=[],this._cateStep=[],this._cateDomain=[];var e=!1,i=this._getDefaultTickCount();if(this._cateDataDomain.forEach(function(a){var n,r,s,o=a.name,l=a.domain,c=a.useIndicator;a.useIndicator?(e=!0,s=l[0],r=[l[0],l[1]],n=parseFloat((l[1]-l[0])/i)):(n=t._linearTickInterval(l[0],l[1]),r=t._linearNiceDomain(l[0],l[1],n),s=r[0]),t._cateTickStart.push(s),t._cateDomain.push({useIndicator:c,name:o,domain:r}),t._cateStep.push(n)}),!e){var a=this._getCateTickValues().map(function(t){return t.labels.length});i=Math.max.apply(Math,a)}this._cateDomain.forEach(function(e,a){var n=e.domain[0],r=e.domain[1];e.useIndicator||(_step=Math.ceil((r-n)/i),e.domain[1]=n+_step*i,t._cateStep[a]=_step)})},_updateCategoryTickData:function(){var t=this,e=this._getCateTickValues();this.cateTickData=[];for(var i=0,a=e.length;i<a;i++){for(var n=e[i].name,r=e[i].labels,s=[],o=0,l=r.length;o<l;o++)s.push(t._labelInfoFormatter(r[o]));t.cateTickData.push({name:n,tickData:s})}},_labelInfoFormatter:function(t){var e=this,i=this.options,n=i.formatter,s=i.useHtml,o=i.labelStyle||{},l=a.extend({writingMode:"tb-rl","writing-mode":"tb-rl","-webkit-writing-mode":"vertical-rl"},o),c=e._getTickContent(t,n);e.type===r.CATEGORY_AXIS_COMPONENT&&(c=c.trim());var h,u,d=o,p=e.labelRotation;return 90===Math.abs(p)&&a.hasChn(c)&&(p=360,d=l),h=a.getTextDimension(c,d,s),u=a.getTextDimRotated(h,p),s&&(u.width=isNaN(parseFloat(i.labelWidth))?u.width:parseFloat(i.labelWidth),u.height=isNaN(parseFloat(i.labelHeight))?u.height:parseFloat(i.labelHeight)),{tickValue:t,tickContent:c,tickDim:u,tickRectDim:h,labelRotation:p}},_getCateTickValues:function(){if(!this._cateDataDomain)return[];var t=[],e=this;return this._cateDomain.forEach(function(i,n){for(var r=[],s=e._cateTickStart[n],o=e._cateStep[n],l=i.domain[1];s<=l;s=a.accAdd(s,o))r.push(s);t.push({name:i.name,labels:r})}),t},fixScaleAndTickData:function(){this.scale.domain(this._domain).range([0,this.polar.radius]),this._updateOriginTickData()},getRadiusPlotBands:function(){var t=[],e=this;return this._getPlotBands().forEach(function(i){t.push({path:e._getRadiusPlotBandsPath(i.from,i.to),color:i.color})}),t},_getRadiusPlotBandsPath:function(t,e){return this.polar.shape===n.POLYGON_RADAR?this._getRadiusGridPath(Math.min(t,e))+this._getRadiusGridPath(Math.max(t,e),!0):s.arc().startAngle(0).endAngle(2*Math.PI).innerRadius(this.scale(Math.min(t,e))).outerRadius(this.scale(Math.max(t,e)))()},getPlotLines:function(){var t=this,e=[];return(this.options.plotLines||[]).forEach(function(i){var a,r,s;i.label&&i.label.text&&i.label.style&&(a=i.label.text,r=i.label.style,s=i.label.align),e.push({color:i.color,value:i.value,width:i.width,dataArray:n.DASH_TYPE[i.dashStyle],text:a,baseY:-t.scale(i.value),textAnchor:s==n.LEFT?"end":"start",style:r})}),e},_getRadiusGridPath:function(t,e){var i=this._getRadiusGridData(t,e);return this._getRadiusGridPathByData(i)},_getRadiusGridData:function(t,e,i){var r=i||this.scale,s=this.polar.angleAxis;if(this.polar.shape===n.POLYGON_RADAR){var o=[],l=s.scale;return l.domain().forEach(function(e){var i=l(e)*s.piece,n=r(t);o.push(a.getArcPoint(n,i))}),e&&o.reverse(),o}return r(t)},_getRadiusGridPathByData:function(t){if(a.isArray(t)){var e="";if(t.length){for(var i=0,n=t.length;i<n;i++)e+=(i?"L":"M")+a.dealFloatPrecision(t[i][0])+","+a.dealFloatPrecision(t[i][1]);e+="Z"}return e}return s.arc().startAngle(0).endAngle(2*Math.PI).innerRadius(0).outerRadius(t)()},render:function(){var t=this.vanchart,e=t.renderer;this.axisGroup||(this.axisGroup=e.vgroup().add(t.backGroup),e.clip(this.axisGroup.renderG,this.polar.clip)),this.axisGroup.attr("transform",a.makeTranslate(this.polar.center)),this._drawPlotBands(this.axisGroup),this.indicator?this._drawCateGridLine(this.axisGroup):this._drawGridLine(this.axisGroup),this._drawPlotLines(this.axisGroup),this._drawTickLabel(this.axisGroup)},_drawGridLine:function(t){var e=this.vanchart.renderer,i=this,a=i.lastScale||i.scale,n=i.options,r=i.getTickData(),s=n.gridLineColor,l=n.gridLineWidth;this.gridLinesGroup||(this.gridLinesGroup=t.append(e.group()),this.gridLines=[]);var c=this.gridLinesGroup,h=this._bindData(this.gridLines,r);h.exit.map(function(t){var e=t.datum(),n=i._getRadiusGridData(e.tickValue,!1,a),r=i._getRadiusGridData(e.tickValue);t.animate({attrTween:{d:function(){var t=o(n,r);return function(e){return i._getRadiusGridPathByData(t(e))}}}}).remove()});var u=h.enter.map(function(t){return c.append(e.path()).datum(t)});this.gridLines=u.concat(h.update).map(function(t){var e=t.datum(),n=i._getRadiusGridData(e.tickValue);t.style({fill:"none",stroke:s,"stroke-width":l,opacity:1});var r=i._getRadiusGridData(e.tickValue,!1,a);return t.animate({attrTween:{d:function(){var t=o(r,n);return function(e){return i._getRadiusGridPathByData(t(e))}}}}),t})},_drawCateGridLine:function(t){var e=this.vanchart.renderer,i=this,a=i.lastScale||i._cateScale,n=i.options,r=i.cateTickData[0].tickData,s=n.gridLineColor,l=n.gridLineWidth,c=i._cateDomain[0].domain;this.gridLinesGroup||(this.gridLinesGroup=t.append(e.group()),this.gridLines=[]);var h=this.gridLinesGroup,u=this._bindData(this.gridLines,r);u.exit.map(function(t){var e=t.datum(),n=i._getRadiusGridData(e.tickValue,!1,a),r=i._getRadiusGridData(e.tickValue,!1,a);t.animate({attrTween:{d:function(){var t=o(n,r);return function(e){return i._getRadiusGridPathByData(t(e))}}}}).remove()});var d=u.enter.map(function(t){return h.append(e.path()).datum(t)});this.gridLines=d.concat(u.update).map(function(t){var e=t.datum();a.domain(c);var n=i._getRadiusGridData(e.tickValue,!1,a);t.style({fill:"none",stroke:s,"stroke-width":l,opacity:1});var r=i._getRadiusGridData(e.tickValue,!1,a);return t.animate({attrTween:{d:function(){var t=o(r,n);return function(e){return i._getRadiusGridPathByData(t(e))}}}}),t})},_drawPlotLines:function(t){var e=this.vanchart.renderer,i=this.getPlotLines();this.plotLinesGroup||(this.plotLinesGroup=t.append(e.vgroup()),this.plotLines=[]);var a=this.plotLinesGroup,n=this._bindData(this.plotLines,i);n.exit.map(function(t){t.text&&t.text.remove(),t.remove()});var r=n.enter.map(function(t){var i=a.append(e.path().datum(t));return t.text&&(i.text=a.append(e.vtext())),i});this.plotLines=r.concat(n.update).map(function(t){var e=t.datum(),i=this._getRadiusGridPath(e.value);return t.style({fill:"none",stroke:e.color,"stroke-width":e.width,"stroke-dasharray":e.dataArray}).animate({attr:{d:i}}),t.text&&t.text.textContent(e.text).style(e.style).attr({y:e.baseY}),t},this)},_drawPlotBands:function(t){var e=this.vanchart.renderer,i=this.getRadiusPlotBands();this.plotBandsGroup||(this.plotBandsGroup=t.append(e.group()),this.plotBands=[]);var a=this.plotBandsGroup,n=this._bindData(this.plotBands,i);n.exit.map(function(t){t.remove()});var r=n.enter.map(function(t){return a.append(e.path()).datum(t)});this.plotBands=r.concat(n.update).map(function(t){var e=t.datum();return t.style("fill",e.color).animate({attr:{d:e.path}}),t},this)},_drawTickLabel:function(t){this.indicator?this._drawCateSvgTickLabel(t):this._drawSvgTickLabel(t)},_drawSvgTickLabel:function(t){var e=this.vanchart.renderer,i=this,a=i.scale,n=i.lastScale||i.scale,r=i.options,s=i.getTickData().slice(0,-1),o=r.labelStyle,l=r.useHtml;this.tickLabelsGroup||(this.tickLabelsGroup=t.append(e.vgroup()),this.tickLabels=[]);var h=this.tickLabelsGroup,u=this._bindData(this.tickLabels,s,function(t){return t.tickValue});if(u.exit.map(function(t){t.remove()}),r.showLabel){var d=u.enter.map(function(t){return h.append(e.vtext(l).datum(t))});this.tickLabels=d.concat(u.update).map(function(t){var e=t.datum();t.textContent(e.tickContent).style(o);var i={transform:"translate("+(-(e.tickRectDim.width+e.tickDim.width)/2-c())+" "+(-a(e.tickValue)-(e.tickRectDim.height+e.tickDim.height)/2)+")",dy:"0.85em"};if(l)t.attr(i),t.vRotate(e.labelRotation);else{var r=e.labelRotation%360?t.vRotate(e.labelRotation).rotateStr:"";i.transform+=r;var s={transform:"translate("+(-(e.tickRectDim.width+e.tickDim.width)/2-c())+" "+(-n(e.tickValue)-(e.tickRectDim.height+e.tickDim.height)/2)+")",dy:"0.85em"};s.transform+=r,t.attr(s).animate({attr:i})}return t})}},_drawCateSvgTickLabel:function(t){var e=this.vanchart.renderer,i=this,a=i.lastScale||i._cateScale,n=i.options,r=(i.getTickData().slice(0,-1),n.labelStyle),s=n.useHtml;this.cateTickLabelsGroup||(this.cateTickLabelsGroup=t.append(e.vgroup()),this.cateTickLabels=[],this._cateDataDomain.forEach(function(){i.cateTickLabels.push([])}));var o=this.cateTickLabelsGroup,l=function(t,e){return(t>=0?"RIGHT":"LEFT")+"_"+(e>=0?"BOTTOM":"TOP")},h=function(t,e,i,a,n,r,s){var o=c(),l=(a+r)/2,h=(n+s)/2;switch(t){case"LEFT_TOP":_x=e+o,_y=i+o;break;case"RIGHT_TOP":_x=e-l-o,_y=i+o;break;case"RIGHT_BOTTOM":_x=e+-l-o,_y=i-h-o;break;case"LEFT_BOTTOM":_x=e+o,_y=i-h-o}return{x:_x,y:_y}},u=this.series[0].angleAxis.getCateAngleGridLineData(),d=(this.cateTickData.map(function(t){return t.tickData.length}),a.domain()),p=a.range();this.cateTickData.forEach(function(t,c){var d,p=t.name,f=i._bindData(i.cateTickLabels[c],t.tickData,function(t){return t.tickValue});u.forEach(function(t){t.name==p&&(d=t.pos)}),f.exit.map(function(t){t.remove()});var m=d[0],g=d[1],v=l(m,g);if(n.showLabel){var y=f.enter.map(function(t){return o.append(e.vtext(s).datum(t))});i.cateTickLabels[c]=y.concat(f.update).map(function(t,e,n){var o=t.datum();t.textContent(o.tickContent).style(r),a.domain(i._cateDomain[c].domain),a.range([0,m]);var l=a(o.tickValue);a.range([0,g]);var u=a(o.tickValue),d=h(v,l,u,o.tickRectDim.width,o.tickRectDim.height,o.tickDim.width,o.tickDim.height),p=d.x,f=d.y,y={transform:"translate("+p+" "+f+")",dy:"0.85em"};if(s)t.attr(y),t.vRotate(o.labelRotation);else{var M=o.labelRotation%360?t.vRotate(o.labelRotation).rotateStr:"";y.transform+=M;var F={transform:"translate("+p+" "+f+")",dy:"0.85em"};F.transform+=M,t.attr(F).animate({attr:y})}return t})}}),a.range(p).domain(d)}})}),define("component/PolarAxis",["require","./Base","../utils/BaseUtils","../Constants","./Axis","./Polar","./AngleAxis","./RadiusAxis","../ComponentLibrary"],function(t){var e=(t("./Base"),t("../utils/BaseUtils")),i=(t("../Constants"),t("./Axis")),a=t("./Polar"),n=t("./AngleAxis"),r=t("./RadiusAxis"),s=t("../ComponentLibrary"),o=i.extend({_refresh:function(){this._axisList=this._axisList||[];for(var t=this.options,i=(t=e.isArray(t)?t:[t]).length,o=i;o<this._axisList.length;o++)this._axisList[o].remove(),this._axisList[o]=null;this._axisList.length=i;for(o=i-1;o>=0;o--)if(t[o].axisIndex=o,this._axisList[o]&&this._axisList[o].type!=t[o].type&&(this._axisList[o].remove(),this._axisList[o]=null),this._axisList[o])this._axisList[o].refresh(t[o]);else{var l;if(this.componentType===s.POLAR_COMPONENT)l=a;else{var c=t[o].type||s.VALUE_AXIS_COMPONENT;c==s.VALUE_AXIS_COMPONENT?l=r:c==s.CATEGORY_AXIS_COMPONENT&&(l=n)}this._axisList[o]=new l(t[o],this.componentType,this.vanchart)}},doLayout:function(){for(var t=this._axisList.length-1;t>=0;t--)this._axisList[t].doLayout()},render:function(){this._axisList.map(function(t){t.componentType===s.POLAR_COMPONENT&&t.render()})}});return s.register(s.RADIUS_AXIS_COMPONENT,o),s.register(s.ANGLE_AXIS_COMPONENT,o),s.register(s.POLAR_COMPONENT,o),o}),define("component/Title",["require","./Base","../utils/BaseUtils","../Constants","../ComponentLibrary"],function(t){var e,i=t("./Base"),a=t("../utils/BaseUtils"),n=t("../Constants"),r=t("../ComponentLibrary"),s=function(){return null==e&&(e=a.paddingConvertWithScale("0.3125rem")),e},o=i.extend({doLayout:function(){var t=this.options;if(t.text){var e,i=this.vanchart.bounds,o=i.width,l=i.height;if(this.isFloat)o-=this._floatX-i.x,l-=this._floatY-i.y;else{var c=this.vanchart.components[r.TOOLBAR_COMPONENT];this.initBarWidth=c&&c.getToolBarInitWidth()||0,o-=this.initBarWidth,"center"===t.align&&(o-=this.initBarWidth)}if(o-=2*s(),l-=2*s(),(e=a.getTextDimension(t.text,t.style,t.useHtml)).width>o){var h=a.clone(t.style);h.width=Math.max(o,0)+"px",e=a.getTextWrapDimension(t.text,h,t.useHtml)}else e.width+=.5;if(e.height=Math.min(this._maxHeight(),l,e.height),this.isFloat)this.bounds={x:this._floatX,y:this._floatY,width:e.width+2*s(),height:e.height+2*s()};else{var u=e.height+2*s();this._setComponentBounds(n.TOP,u)}if(this.isFloat)this.textBounds={x:s(),y:s(),width:e.width,height:e.height};else{var d;switch(t.align){case"right":d=o-e.width;break;case"center":d=this.bounds.width/2-e.width/2;break;case"left":default:d=this.bounds.x+s()}this.textBounds={x:d,y:s(),width:e.width,height:e.height}}if(t.useHtml)this.labels=[],this.labels.push({text:t.text,dim:e,style:t.style});else{var p=a.splitText(t.text,t.style,this.textBounds.width);this.labels=p.map(function(e){return{text:e,dim:a.getTextDimension(e,t.style,t.useHtml),style:t.style}})}}},render:function(){if(!this.textBounds||this.textBounds.width<0||this.textBounds.height<0)this.remove();else{var t=this.vanchart,e=t.renderer;this.titleGroup||(this.titleGroup=e.vgroup(),this.titleGroup.renderG.addTo(this.isFloat?t.frontGroup:t.backGroup),this.titleGroup.divG.add(),this.titleGroup.divG.style("pointer-events","auto")),this.titleGroup.attr("transform",a.makeTranslate([this.bounds.x,this.bounds.y])),this._innerClip(this.titleGroup),this.drawBackground(this.titleGroup.renderG),this.drawTitle(this.titleGroup)}},drawBackground:function(t){var e=this.options,i=this.bounds;e.backgroundColor&&this.vanchart._renderRectangleBackground(t,e,{x:0,y:0,width:i.width,height:i.height})},drawTitle:function(t){this.text&&(this.text.remove(),this.text=null);var e=this.vanchart.renderer,i=this.options,r=this.textBounds,s=i.useHtml,o=i.align,l=e.vtext(s).attr({transform:a.makeTranslate([r.x,r.y]),width:r.width+"px","text-align":o,"white-space":"normal"});this.text=l;var c=s?{}:a.isMS?{dy:"1em"}:{"dominant-baseline":"central",dy:r.height/this.labels.length/2},h=0;this.labels.map(function(t){var i,a=t.dim;switch(o){case n.LEFT:i=0;break;case n.RIGHT:i=r.width-a.width;break;case n.CENTER:default:i=(r.width-a.width)/2}l.append(e.vtspan(s).attr({y:h,x:0,dx:i}).attr(c).textContent(t.text).style(t.style)),h+=a.height}),t.append(l)},remove:function(){this.titleGroup&&this.titleGroup.remove(),this._clip&&this._clip.remove(),this.titleGroup=this._clip=null}});return r.register(r.TITLE_COMPONENT,o),o}),define("FullChartTypes",["require","./VanCharts","./Carousel","./chart/Bar","./chart/Pie","./chart/Line","./chart/LineRadar","./chart/ColumnRadar","./chart/PointerGauge","./chart/SlotGauge","./chart/RingGauge","./chart/ThermometerGauge","./component/Tooltip","./component/Axis","./component/GaugeAxis","./component/Legend","./component/ToolBar","./component/Polar","./component/PolarAxis","./component/Title"],function(t){t("./VanCharts"),t("./Carousel"),t("./chart/Bar"),t("./chart/Pie"),t("./chart/Line"),t("./chart/LineRadar"),t("./chart/ColumnRadar"),t("./chart/PointerGauge"),t("./chart/SlotGauge"),t("./chart/RingGauge"),t("./chart/ThermometerGauge"),t("./component/Tooltip"),t("./component/Axis"),t("./component/GaugeAxis"),t("./component/Legend"),t("./component/ToolBar"),t("./component/Polar"),t("./component/PolarAxis"),t("./component/Title")});var VanCharts=require("VanCharts");return require("./Carousel"),require("./chart/Bar"),require("./chart/Pie"),require("./chart/Line"),require("./chart/LineRadar"),require("./chart/ColumnRadar"),require("./chart/PointerGauge"),require("./chart/SlotGauge"),require("./chart/RingGauge"),require("./chart/ThermometerGauge"),require("./component/Tooltip"),require("./component/Axis"),require("./component/GaugeAxis"),require("./component/Legend"),require("./component/ToolBar"),require("./component/Polar"),require("./component/PolarAxis"),require("./component/Title"),VanCharts}),FXM.ChartUtils=function(t){this.options=$.extend({yGroups:[],xGroups:[],valueFields:[],data:{},userMap:{},departmentMap:{}},t)},$.extend(FXM.ChartUtils.prototype,{getChartData:function(){var t=this.options;return this.nameMap={},this._createCategory(t.data.x,t.xGroups),this._createSeriesAndData(t.data.val,t.yGroups),{category:this.category,series:this.series,data:this.data,nameMap:this.nameMap}},_createCategory:function(t,e){var i=this,a=this.options;this.category=[];var n=[];FXM.Utils.forEach(t,function(t,e){FXM.Utils.forEach(e.data,function(t,e){n[t]||(n[t]=[]),n[t].push(e)})}),FXM.Utils.isObjectEmpty(e)&&this.category.push(a.valueFields[0].text),FXM.Utils.forEach(n,function(t,a){i.category.push(i._getGroupText(a,e))})},_createSeriesAndData:function(t,e){var i=this,a=this.options;this.series=[],this.data=[],FXM.Utils.forEach(t,function(t,a){a.is_summary_col||i.series.push(i._getGroupText(a.y,e)),a.data.length?i.data.push(a.data):i.data.push([a.sum])}),e.length||FXM.Utils.forEach(a.valueFields,function(t,e){!1!==e.enable&&i.series.push(e.text)})},_getGroupText:function(t,e){var i,a=this,n=this.options,r=["yyyy","yyyy-MM","yyyy-MM-dd"],s="";return FXM.Utils.forEach(e,function(o,l){var c=t[o];switch(l.type){case"datetime":i||(i=new Date);var h=r[o];0===o?i.setFullYear(c):1===o?i.setMonth(c-1,1):i.setDate(c),o===e.length-1&&(s=FXM.Utils.date2Str(i,h));break;case"address":case"location":s+=c,o<e.length-1&&(s+="/");break;case"id":case"user":var u=n.userMap[c];s=u?u.nickname:c,a.nameMap[s]=c;break;case"did":case"dept":var d=n.departmentMap[c];s=d?d.name:c,a.nameMap[s]=c;break;default:"creator"===l.name?(s=n.userMap[c].nickname,a.nameMap[s]=c):s=c}}),s}}),function(t){FXM.Chart=FXM.extend(FXM.Block,{_defaults:function(){return t.extend(FXM.Chart._super._defaults.apply(),{baseCls:"x-chart",onItemClick:null,forms:[],relations:{},joinedFields:[],xFields:[],yFields:[],valueFields:[],asyncURL:FXM.Utils.getApi(FXM.API.data.chart_group)})},_init:function(){FXM.Chart._super._init.apply(this,arguments);var t=this;this.options;t.myChart=VanCharts.init(t.$body[0]),t.chartOptions={padding:5,zoom:{zoomType:"xy"},plotOptions:{click:t._getClickEvent(),large:!1,connectNulls:!0,curve:!1,marker:{symbol:"circle",radius:4.5,enabled:!0},tooltip:{formatter:{identifier:"${CATEGORY}${SERIES}${VALUE}"},shared:!0,padding:5,backgroundColor:"rgba(0,0,0,0.4980392156862745)",borderColor:"rgb(0,0,0)",shadow:!1,borderRadius:2,borderWidth:0,follow:!1,enabled:!0,animation:!0,hideDelay:3e3},step:!1,lineWidth:2,animation:!0},drag:!0,borderColor:"rgb(238,238,238)",xAxis:{enableMinorTick:!1,minorTickColor:"rgb(176,176,176)",tickColor:"rgb(176,176,176)",showArrow:!1,lineColor:"rgb(176,176,176)",plotLines:[],type:"category",lineWidth:1,showLabel:!0,gridLineWidth:0,enableTick:!0,labelStyle:{fontFamily:"verdana",color:"#6f6f6f",fontSize:"12px",fontWeight:""},plotBands:[],position:"bottom",labelRotation:0,reversed:!1},legend:{borderColor:"rgb(204,204,204)",borderRadius:0,shadow:!1,borderWidth:0,style:{fontFamily:"verdana",color:"rgba(102,102,102,1.0)",fontSize:"13px",fontWeight:""},maxHeight:"30%",position:"bottom",enabled:!0},plotBorderColor:"rgba(255,255,255,0)",tools:{hidden:!1,toImage:{enabled:!1},sort:{enabled:!0},enabled:!0,fullScreen:{enabled:!1}},yAxis:[{enableMinorTick:!1,gridLineColor:"rgb(196,196,196)",minorTickColor:"rgb(176,176,176)",tickColor:"rgb(176,176,176)",showArrow:!1,lineColor:"rgb(176,176,176)",plotLines:[],type:"value",lineWidth:1,showLabel:!0,gridLineWidth:1,enableTick:!1,labelStyle:{fontFamily:"Verdana",color:"rgba(102,102,102,1.0)",fontSize:"13px",fontWeight:""},plotBands:[],position:"left",labelRotation:0,reversed:!1}],style:"gradual"},t._initChartSize(),t._initData()},_initData:function(){var t=[],e=[],i=[];this._checkFields()?this._setData(t,e,i):this._initChartOption(!0,t,e,i,this.chartOptions)},_initChartOption:function(){},_checkFields:function(){var t=this.options;return(t.xFields.length>0||t.yFields.length>0)&&t.valueFields.length>0},_setData:function(t,e,i){var a=this.options,n=this;if(this._checkFields()){var r,s,o;a.xFields.length>0&&(r=n._makeGroups([a.xFields[0]])),a.yFields.length>0&&a.valueFields.length<=1&&(s=n._makeGroups([a.yFields[0]])),o=a.valueFields;var l=this.getFilterData();this.loadingAjax({url:a.asyncURL,data:{widgetId:a.widgetName,filter:l,onlyGroup:!0}},function(t){if(this._isChartEmpty(t)){n.clearChart();var e=!FXM.Utils.isObjectEmpty(l)?"":"";FXM.UI.createEmptyTip({msg:e}).appendTo(n.$body)}else{var i=new FXM.ChartUtils({yGroups:s,xGroups:r,valueFields:o,data:t.data,userMap:t.user,departmentMap:t.department}).getChartData();n.nameMap=i.nameMap,n._initChartOption(!1,i.series,i.category,i.data,n.chartOptions)}})}else this._initChartOption(!0,t,e,i,n.chartOptions)},_isChartEmpty:function(t){return 0===t.data.x.length&&0===t.data.val.length},_dealLinkData:function(t,e){var i=e;switch(t.type){case"datetime":i=[];var a=e.split("-");FXM.Utils.forEach(a,function(t,e){a[t]=parseInt(e,10)}),i=FXM.Utils.getDateRange({year:a[0],month:a[1],day:a[2]});break;case"address":case"location":i=i.split("/")}return FXM.Utils.getLinkFilter(t,i)},_getClickEvent:function(){var t=this,e=this.options;return function(){var i=[];if(e.yFields[0]){var a=t.nameMap[this.seriesName]||this.seriesName,n=t._dealLinkData(e.yFields[0],a);n.field=e.yFields[0].name,i.push(n)}if(e.xFields[0]){var r=t.nameMap[this.category]||this.category,s=t._dealLinkData(e.xFields[0],r);s.field=e.xFields[0].name,i.push(s)}if(e.valueFields[0]){var o=t._getLinkFilterParams(i);FXM.Utils.applyFunc(t,e.onItemClick,[o],!1)}}},clearChart:function(){this.myChart.clear()},_initChartSize:function(){var t=this.element;this.$body.css({width:t.width(),height:t.height()})},_formatValue:function(t,e){var i=this.options;FXM.Utils.isObjectEmpty(i.valueFields)||1!==i.valueFields.length||(e=0);var a=null;FXM.Utils.forEach(i.valueFields,function(t,i){if(!1!==i.enable)return t===e?(a=i.cellFmt,!1):void 0;e++});var n=FXM.Utils.fixDecimalPrecision(t),r=n;return a&&a.data&&(r=FXM.Utils.num2Str(n,a.data)),r},resize:function(t){FXM.Chart._super.resize.apply(this,arguments),this._initChartSize(),this.myChart.resize()},_reloadData:function(){t(".x-empty-info",this.element).remove(),this._initData()}})}(Zepto),function(t){FXM.LineChart=FXM.extend(FXM.Chart,{_initChartOption:function(e,i,a,n,r){var s=this;this.options;e&&(i=["1","2"],a=["1","2","3","4","5"],n=[[1,3,8,7,9],[8,6,4,2,7]]);var o=[];FXM.Utils.forEach(i,function(t,e){var r={},l=[];r.tooltip={formatter:{identifier:"${CATEGORY}${SERIES}${VALUE}",valueFormat:function(e){return s._formatValue(e,t)}},shared:!1,padding:5,backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgb(0,0,0)",shadow:!1,borderRadius:2,borderWidth:0,follow:!1,enabled:!0,animation:!0,hideDelay:3e3},FXM.Utils.forEach(a,function(e,i){var r={};r.x=a[e],r.y=n[t][e]||0,l.push(r)}),r.data=l,r.name=i[t],o.push(r)}),this.chartOpt=t.extend(r,{series:o,chartType:"line"}),FXM.Utils.isNull(this.myChart.options)?this.myChart.setOptions(this.chartOpt):this.myChart.setData(this.chartOpt)}}),FXM.register("linechart",FXM.LineChart)}(Zepto),function(t){FXM.BarChart=FXM.extend(FXM.Chart,{_initChartOption:function(e,i,a,n,r){var s=this;this.options;e&&(i=["1","2"],a=["1","2","3","4","5"],n=[[1,3,8,7,9],[8,6,4,2,7]]);var o=[];FXM.Utils.forEach(i,function(t,e){var r={},l=[];r.tooltip={formatter:{identifier:"${CATEGORY}${SERIES}${VALUE}",valueFormat:function(e){return s._formatValue(e,t)}},shared:!1,padding:5,backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgb(0,0,0)",shadow:!1,borderRadius:2,borderWidth:0,follow:!1,enabled:!0,animation:!0,hideDelay:3e3},FXM.Utils.forEach(n[t],function(e,i){var r={};r.x=a[e],r.y=n[t][e]||0,l.push(r)}),r.data=l,r.name=i[t],o.push(r)}),this.chartOpt=t.extend(r,{plotOptions:{click:s._getClickEvent(),dataLabels:{formatter:function(){return s._formatValue(this.value,this.series.index)},connectorWidth:1,align:"outside",enabled:!0,autoAdjust:!0},animation:!0},series:o,chartType:"column"}),FXM.Utils.isNull(this.myChart.options)?this.myChart.setOptions(this.chartOpt):this.myChart.setData(this.chartOpt)}}),FXM.register("barchart",FXM.BarChart)}(Zepto),function(t){FXM.areaChart=FXM.extend(FXM.Chart,{_initChartOption:function(e,i,a,n,r){var s=this;this.options;e&&(i=["1","2"],a=["1","2","3","4","5"],n=[[1,3,8,7,9],[8,6,4,2,7]]);var o=[];FXM.Utils.forEach(i,function(t,e){var r={},l=[];r.tooltip={formatter:{identifier:"${CATEGORY}${SERIES}${VALUE}",valueFormat:function(e){return s._formatValue(e,t)}},shared:!0,padding:5,backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgb(0,0,0)",shadow:!1,borderRadius:2,borderWidth:0,follow:!1,enabled:!0,animation:!0,hideDelay:3e3},FXM.Utils.forEach(n[t],function(e,i){var r={};r.x=a[e],r.y=n[t][e]||0,l.push(r)}),r.data=l,r.name=i[t],r.stack=1,o.push(r)}),this.chartOpt=t.extend(r,{plotOptions:{click:s._getClickEvent(),fillColorOpacity:.3,large:!1,connectNulls:!0,curve:!1,marker:{symbol:"circle_hollow",radius:2.5,enabled:!1},step:!1,lineWidth:2,animation:!0},series:o,chartType:"area"}),FXM.Utils.isNull(this.myChart.options)?this.myChart.setOptions(this.chartOpt):this.myChart.setData(this.chartOpt)}}),FXM.register("areachart",FXM.areaChart)}(Zepto),function(t){FXM.donutChart=FXM.extend(FXM.Chart,{_initChartOption:function(e,i,a,n,r){this.options;e&&(i=["1","2","3"],a=["1","2"],n=[[1,3],[8,6],[2,4]]);var s=[];FXM.Utils.forEach(i,function(t,e){var r={},o=[];FXM.Utils.forEach(n[t],function(e,i){var r={};r.x=a[e],r.y=n[t][e],o.push(r)}),r.data=o,r.name=i[t],s.push(r)}),this.chartOpt=t.extend(r,{series:s,chartType:"column"}),FXM.Utils.isNull(this.myChart.options)?this.myChart.setOptions(this.chartOpt):this.myChart.setData(this.chartOpt)}}),FXM.register("donutchart",FXM.donutChart)}(Zepto),function(t){FXM.radarChart=FXM.extend(FXM.Chart,{_initChartOption:function(e,i,a,n,r){var s=this;this.options;e&&(i=["1","2"],n=[[15,12,9,8,11,6],[13,15,19,17,4,8]],a=["1","2","3","4","5","6"]);var o=[];FXM.Utils.forEach(i,function(t,e){var r={},l=[];r.tooltip={formatter:{identifier:"${CATEGORY}${SERIES}${VALUE}",valueFormat:function(e){return s._formatValue(e,t)}},shared:!0,padding:5,backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgb(0,0,0)",shadow:!1,borderRadius:2,borderWidth:0,follow:!1,enabled:!0,animation:!0,hideDelay:3e3},FXM.Utils.forEach(n[t],function(t,e){var i={};i.x=a[t],i.y=e||0,l.push(i)}),l.length&&(r.data=l,r.name=i[t],o.push(r))}),o.length?(this.chartOpt=t.extend(r,{padding:0,plotOptions:{click:s._getClickEvent(),large:!1,connectNulls:!0,curve:!1,marker:{symbol:"circle_hollow",radius:2.5,enabled:!1},step:!1,lineWidth:2,animation:!0,shape:"polygon"},xAxis:null,yAxis:null,angleAxis:{minorTickColor:"rgb(176,176,176)",tickColor:"rgb(176,176,176)",lineColor:"rgb(176,176,176)",labelStyle:{fontFamily:"verdana",color:"rgba(102,102,102,1.0)",fontSize:"13px",fontWeight:""},showLabel:!0,type:"category"},series:o,chartType:"radar"}),FXM.Utils.isNull(this.myChart.options)?this.myChart.setOptions(this.chartOpt):this.myChart.setData(this.chartOpt)):this.clearChart()}}),FXM.register("radarchart",FXM.radarChart)}(Zepto),function(t){FXM.PieChart=FXM.extend(FXM.Chart,{_defaultConfig:function(){return t.extend(FXM.PieChart._super._defaultConfig.apply(),{})},_initContent:function(t){FXM.PieChart._super._initContent.apply(this,arguments),this.options.xFields=[]},_initChartOption:function(t,e,i,a,n){var r=this;this.options;t&&(e=["1","2","3"],a=[15,12,9]);var s=[],o={},l=[];FXM.Utils.forEach(a,function(t,i){var n={};n.x=e[t],n.y=a[t],n.tooltip={formatter:{identifier:"${SERIES}${VALUE}",valueFormat:function(e){return r._formatValue(e,t)}},hideDelay:3,shared:!1,padding:5,backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgb(0,0,0)",shadow:!1,borderRadius:2,borderWidth:0,follow:!1,enabled:!0,animation:!1},l.push(n)}),o.data=l,s.push(o),this.chartOpt={padding:0,plotOptions:{click:r._getClickEvent(),rotatable:!1,borderColor:"rgb(255,255,255)",startAngle:0,borderRadius:0,borderWidth:1,endAngle:360,innerRadius:"0.0%",animation:!0,dataLabels:{formatter:function(){return r._formatValue(this.value,this.series.index)+" "+FXM.Utils.num2Str(this.percentage,"(0.00%)")},connectorWidth:1,align:"outside",enabled:!0}},legend:{borderColor:"rgb(204,204,204)",borderRadius:0,shadow:!1,borderWidth:0,style:{fontFamily:"verdana",color:"rgba(102,102,102,1.0)",fontSize:"13px",fontWeight:""},maxHeight:"30%",position:"bottom",enabled:!0},plotBorderColor:"rgb(238,238,238)",tools:{hidden:!1,toImage:{enabled:!1},sort:{enabled:!0},enabled:!0,fullScreen:{enabled:!1}},series:s,chartType:"pie",style:"gradual"},FXM.Utils.isNull(this.myChart.options)?this.myChart.setOptions(this.chartOpt):this.myChart.setData(this.chartOpt)},_checkFields:function(){return this.options.valueFields.length>0},_setData:function(t,e,i){this.options.xFields=[],FXM.PieChart._super._setData.apply(this,arguments)}}),FXM.register("piechart",FXM.PieChart)}(Zepto),FXM.DashChartUtils=function(t){this.options=$.extend({yGroups:[],xGroups:[],valueFields:[],data:{},userMap:{},departmentMap:{}},t)},$.extend(FXM.DashChartUtils.prototype,{getChartData:function(){var t=this.options;return this.nameMap={},this._createCategory(t.data.x,t.xGroups),this._createSeriesAndData(t.data.val,t.yGroups),{category:this.category,series:this.series,data:this.data,nameMap:this.nameMap}},_createCategory:function(t,e){var i=this,a=this.options;this.category=[];var n=[];FXM.Utils.forEach(t,function(t,e){FXM.Utils.forEach(e.data,function(t,e){n[t]||(n[t]=[]),n[t].push(e)})}),FXM.Utils.isObjectEmpty(e)&&this.category.push(a.valueFields[0].title),FXM.Utils.forEach(n,function(t,a){i.category.push(i._getGroupText(a,e))})},_createSeriesAndData:function(t,e){var i=this,a=this.options;this.series=[],this.data=[],FXM.Utils.forEach(t,function(t,a){a.is_summary_col||i.series.push(i._getGroupText(a.y,e)),a.data.length?i.data.push(a.data):i.data.push([a.sum])}),e.length||FXM.Utils.forEach(a.valueFields,function(t,e){!1!==e.enable&&i.series.push(e.title)})},_getGroupText:function(t,e){var i=this,a=this.options,n="";return FXM.Utils.forEach(e,function(e,r){var s=t[e];switch(r.type){case"datetime":n=FXM.Utils.date2GroupStr(s,r.groupRule),i.nameMap[n]=s;break;case"user":var o=a.userMap[s];n=o?o.nickname:s,i.nameMap[n]=s;break;case"dept":var l=a.departmentMap[s];n=l?l.name:s,i.nameMap[n]=s;break;case"location":case"address":n="";var c=r.groupRule.split("_");FXM.Utils.forEach(c,function(t,e){n+=s[e]}),i.nameMap[n]=s;break;default:"creator"===r.name?(n=a.userMap[s].nickname,i.nameMap[n]=s):n=s}}),n}}),function(t){FXM.DashChart=FXM.extend(FXM.Widget,{_defaults:function(){return t.extend(FXM.DashChart._super._defaults.apply(),{baseCls:"x-dash-chart",onItemClick:null,form:null,relations:{},xFields:[],yFields:[],valueFields:[],asyncURL:FXM.Utils.getApi(FXM.API.dash.combined_group),filter:null,onLoadFail:null})},_init:function(){FXM.DashChart._super._init.apply(this,arguments);var e=this;this.options;this.$body=t('<div class="chart-body"/>').appendTo(this.element),this.setReloadState(!0),e.myChart=VanCharts.init(e.$body[0]),e.chartOptions={padding:5,zoom:{zoomType:"xy"},plotOptions:{click:e._getClickEvent(),large:!1,connectNulls:!0,curve:!1,marker:{symbol:"circle",radius:4.5,enabled:!0},tooltip:{formatter:{identifier:"${CATEGORY}${SERIES}${VALUE}"},shared:!0,padding:5,backgroundColor:"rgba(0,0,0,0.4980392156862745)",borderColor:"rgb(0,0,0)",shadow:!1,borderRadius:2,borderWidth:0,follow:!1,enabled:!0,animation:!0,hideDelay:3e3},step:!1,lineWidth:2,animation:!0,dataLabels:{style:{fontFamily:"verdana",color:"#2d2d2d",fontSize:"12px",fontWeight:""}}},drag:!0,borderColor:"rgb(238,238,238)",xAxis:{enableMinorTick:!1,minorTickColor:"#d0d0d0",tickColor:"#d0d0d0",showArrow:!1,lineColor:"#d0d0d0",plotLines:[],type:"category",lineWidth:1,showLabel:!0,gridLineWidth:0,enableTick:!0,labelStyle:{fontFamily:"verdana",color:"#6f6f6f",fontSize:"12px",fontWeight:""},plotBands:[],position:"bottom",labelRotation:0,reversed:!1},legend:{borderColor:"rgb(204,204,204)",borderRadius:0,shadow:!1,borderWidth:0,style:{fontFamily:"verdana",color:"#6f6f6f",fontSize:"12px",fontWeight:""},maxHeight:"30%",position:"bottom",enabled:!0},plotBorderColor:"rgba(255,255,255,0)",tools:{hidden:!1,toImage:{enabled:!1},sort:{enabled:!0},enabled:!0,fullScreen:{enabled:!1}},yAxis:[{enableMinorTick:!1,gridLineColor:"#f5f5f5",minorTickColor:"#d0d0d0",tickColor:"#d0d0d0",showArrow:!1,lineColor:"#d0d0d0",plotLines:[],type:"value",lineWidth:1,showLabel:!0,gridLineWidth:1,enableTick:!1,labelStyle:{fontFamily:"Verdana",color:"#6f6f6f",fontSize:"12px",fontWeight:""},plotBands:[],position:"left",labelRotation:0,reversed:!1}],colors:["#1397DC","#12C1EC","#6FE498","#F5D04F","#FF9F7F","#FB7293","#DA99EC","#8378EA"],style:"normal"},e._initChartSize(),e._initData()},loadingAjax:function(t,e,i){var a=this;this.isLoading||(this.isLoading=!0,FXM.Utils.dataAjax(t,function(t,i){return FXM.Utils.applyFunc(a,e,[t,i],!1)},function(t,e){return FXM.Utils.applyFunc(a,i,[t,e],!1)},function(){a.isLoading=!1,a.setReloadState(!1)}))},setReloadState:function(t,e){this.needReload=t,t&&(this._linkFilterParam=e)},_initData:function(){var t=[],e=[],i=[];this._checkFields()?this._setData(t,e,i):this._initChartOption(!0,t,e,i,this.chartOptions)},_initChartOption:function(){},_checkFields:function(){var t=this.options;return(t.xFields.length>0||t.yFields.length>0)&&t.valueFields.length>0},_setGroups:function(){var t=this.options;t.xFields.length>0&&(this.xGroups=t.xFields.slice(0,1)),t.xFields.length>1&&t.valueFields.length<=1&&(this.yGroups=t.xFields.slice(1,2))},_setData:function(t,e,i){var a=this.options,n=this;if(this._checkFields()){var r=a.valueFields;this._setGroups();var s=this.getFilterData();this.loadingAjax({url:a.asyncURL,data:{widgetId:a.widgetName,filter:s}},function(t){if(this._isChartEmpty(t)){n.clearChart();var e=!FXM.Utils.isObjectEmpty(s)?"":"";FXM.UI.createEmptyTip({msg:e}).appendTo(n.$body)}else{var i=new FXM.DashChartUtils({yGroups:n.yGroups,xGroups:n.xGroups,valueFields:r,data:t.data,userMap:t.user,departmentMap:t.department}).getChartData();n.nameMap=i.nameMap,n._initChartOption(!1,i.series,i.category,i.data,n.chartOptions)}},function(t){FXM.Utils.applyFunc(n,a.onLoadFail,[t],!1)})}else this._initChartOption(!0,t,e,i,n.chartOptions)},_isChartEmpty:function(t){return 0===t.data.x.length&&0===t.data.val.length},_dealLinkData:function(t,e){var i=e;switch(t.type){case"datetime":i=FXM.Utils.getDateRange(e);break;case"address":case"location":i=FXM.Utils.getArrayFromRange(i,"address")}return FXM.Utils.getLinkFilter(t,i)},_getLinkFilterParams:function(e){var i=this.options,a=[];return FXM.Utils.forEach(e,function(e,n){var r={method:n.method,type:n.type,value:n.value,keyType:n.keyType};a.push(t.extend(r,FXM.Utils.dealFilterInfoByField({id:i.form,name:n.field})))}),a},getFilterData:function(){var t=this.options,e=FXM.Utils.applyFunc(this,t.onDataFilter,[],!1),i=[];return e&&(i=i.concat(e)),FXM.Utils.isObjectEmpty(this._linkFilterParam)||(i=i.concat(this._linkFilterParam)),FXM.Utils.isObjectEmpty(i)?{}:{cond:i,rel:FXM.CONSTS.FILTER_RELATION.AND}},_getClickEvent:function(){var t=this,e=this.options;return function(){var i=[];if(t.yGroups&&t.yGroups[0]){var a=t.nameMap[this.seriesName]||this.seriesName,n=t._dealLinkData(t.yGroups[0],a);n.field=t.yGroups[0].name,i.push(n)}if(t.xGroups&&t.xGroups[0]){var r=t.nameMap[this.category]||this.category,s=t._dealLinkData(t.xGroups[0],r);s.field=t.xGroups[0].name,i.push(s)}if(e.valueFields[0]){var o=t._getLinkFilterParams(i);FXM.Utils.applyFunc(t,e.onItemClick,[o],!1)}}},clearChart:function(){this.myChart.clear()},_initChartSize:function(){var t=this.element;this.$body.css({width:t.width(),height:t.height()})},_formatValue:function(t,e){var i=this.options,a=i.valueFields[e]&&i.valueFields[e].format,n=FXM.Utils.fixDecimalPrecision(t);return FXM.Utils.num2Str(n,a)},resize:function(t){FXM.DashChart._super.resize.apply(this,arguments),this._initChartSize(),this.myChart.resize()},reload:function(t){(t||this.needReload)&&this._reloadData()},_reloadData:function(){t(".x-empty-info",this.element).remove(),this._initData()}})}(Zepto),function(t){FXM.DashLineChart=FXM.extend(FXM.DashChart,{_initChartOption:function(e,i,a,n,r){var s=this;this.options;e&&(i=["1","2"],a=["1","2","3","4","5"],n=[[1,3,8,7,9],[8,6,4,2,7]]);var o=[];FXM.Utils.forEach(i,function(t,e){var r={},l=[];r.tooltip={formatter:{identifier:"${CATEGORY}${SERIES}${VALUE}",valueFormat:function(e){return s._formatValue(e,t)}},shared:!1,padding:5,backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgb(0,0,0)",shadow:!1,borderRadius:2,borderWidth:0,follow:!1,enabled:!0,animation:!0,hideDelay:3e3},FXM.Utils.forEach(a,function(e,i){var r={};r.x=a[e],r.y=n[t][e]||0,l.push(r)}),r.data=l,r.name=i[t],o.push(r)}),this.chartOpt=t.extend(r,{series:o,chartType:"line"}),FXM.Utils.isNull(this.myChart.options)?this.myChart.setOptions(this.chartOpt):this.myChart.setData(this.chartOpt)}}),FXM.register("dashlinechart",FXM.DashLineChart)}(Zepto),function(t){FXM.DashBarChart=FXM.extend(FXM.DashChart,{_defaults:function(){return t.extend(FXM.DashBarChart._super._defaults.apply(this,arguments),{isInverted:!1})},_initChartOption:function(e,i,a,n,r){var s=this;this.options;e&&(i=["1","2"],a=["1","2","3","4","5"],n=[[1,3,8,7,9],[8,6,4,2,7]]);var o=[];FXM.Utils.forEach(i,function(t,e){var r={},l=[];r.tooltip={formatter:{identifier:"${CATEGORY}${SERIES}${VALUE}",valueFormat:function(e){return s._formatValue(e,t)}},shared:!1,padding:5,backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgb(0,0,0)",shadow:!1,borderRadius:2,borderWidth:0,follow:!1,enabled:!0,animation:!0,hideDelay:3e3},FXM.Utils.forEach(n[t],function(e,i){var r={};r.x=a[e],r.y=n[t][e]||0,l.push(r)}),r.data=l,r.name=i[t],o.push(r)}),this.chartOpt=t.extend(r,{plotOptions:{click:s._getClickEvent(),dataLabels:{formatter:function(){return s._formatValue(this.value,this.series.index)},connectorWidth:1,align:"outside",enabled:!0,autoAdjust:!0},animation:!0,inverted:this.options.isInverted},series:o,chartType:"column"}),FXM.Utils.isNull(this.myChart.options)?this.myChart.setOptions(this.chartOpt):this.myChart.setData(this.chartOpt)}}),FXM.register("dashbarchart",FXM.DashBarChart)}(Zepto),function(t){FXM.DashAreaChart=FXM.extend(FXM.DashChart,{_initChartOption:function(e,i,a,n,r){var s=this;this.options;e&&(i=["1","2"],a=["1","2","3","4","5"],n=[[1,3,8,7,9],[8,6,4,2,7]]);var o=[];FXM.Utils.forEach(i,function(t,e){var r={},l=[];r.tooltip={formatter:{identifier:"${CATEGORY}${SERIES}${VALUE}",valueFormat:function(e){return s._formatValue(e,t)}},shared:!0,padding:5,backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgb(0,0,0)",shadow:!1,borderRadius:2,borderWidth:0,follow:!1,enabled:!0,animation:!0,hideDelay:3e3},FXM.Utils.forEach(n[t],function(e,i){var r={};r.x=a[e],r.y=n[t][e]||0,l.push(r)}),r.data=l,r.name=i[t],r.stack=1,o.push(r)}),this.chartOpt=t.extend(r,{plotOptions:{click:s._getClickEvent(),fillColorOpacity:.3,large:!1,connectNulls:!0,curve:!1,marker:{symbol:"circle_hollow",radius:2.5,enabled:!1},step:!1,lineWidth:2,animation:!0},series:o,chartType:"area"}),FXM.Utils.isNull(this.myChart.options)?this.myChart.setOptions(this.chartOpt):this.myChart.setData(this.chartOpt)}}),FXM.register("dashareachart",FXM.DashAreaChart)}(Zepto),function(t){FXM.DashRadarChart=FXM.extend(FXM.DashChart,{_initChartOption:function(e,i,a,n,r){var s=this;this.options;e&&(i=["1","2"],n=[[15,12,9,8,11,6],[13,15,19,17,4,8]],a=["1","2","3","4","5","6"]);var o=[];FXM.Utils.forEach(i,function(t,e){var r={},l=[];r.tooltip={formatter:{identifier:"${CATEGORY}${SERIES}${VALUE}",valueFormat:function(e){return s._formatValue(e,t)}},shared:!0,padding:5,backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgb(0,0,0)",shadow:!1,borderRadius:2,borderWidth:0,follow:!1,enabled:!0,animation:!0,hideDelay:3e3},FXM.Utils.forEach(n[t],function(t,e){var i={};i.x=a[t],i.y=e||0,l.push(i)}),l.length&&(r.data=l,r.name=i[t],o.push(r))}),o.length?(this.chartOpt=t.extend(r,{padding:0,plotOptions:{click:s._getClickEvent(),large:!1,connectNulls:!0,curve:!1,marker:{symbol:"circle_hollow",radius:2.5,enabled:!1},step:!1,lineWidth:2,animation:!0,shape:"polygon"},xAxis:null,yAxis:null,angleAxis:{minorTickColor:"rgb(176,176,176)",tickColor:"rgb(176,176,176)",lineColor:"rgb(176,176,176)",labelStyle:{fontFamily:"verdana",color:"rgba(102,102,102,1.0)",fontSize:"13px",fontWeight:""},showLabel:!0,type:"category"},series:o,chartType:"radar"}),FXM.Utils.isNull(this.myChart.options)?this.myChart.setOptions(this.chartOpt):this.myChart.setData(this.chartOpt)):this.clearChart()}}),FXM.register("dashradarchart",FXM.DashRadarChart)}(Zepto),function(t){FXM.DashPieChart=FXM.extend(FXM.DashChart,{_defaultConfig:function(){return t.extend(FXM.DashPieChart._super._defaultConfig.apply(),{})},_initContent:function(t){FXM.DashPieChart._super._initContent.apply(this,arguments),this.options.xFields=[]},_initChartOption:function(t,e,i,a,n){var r=this;this.options;t&&(e=["1","2","3"],a=[15,12,9]);var s=[],o={},l=[];FXM.Utils.forEach(a,function(t,i){var n={};n.x=e[t],n.y=a[t],n.tooltip={formatter:{identifier:"${SERIES}${VALUE}",valueFormat:function(e){return r._formatValue(e,t)}},hideDelay:3,shared:!1,padding:5,backgroundColor:"rgba(0,0,0,0.5)",borderColor:"rgb(0,0,0)",shadow:!1,borderRadius:2,borderWidth:0,follow:!1,enabled:!0,animation:!1},l.push(n)}),o.data=l,s.push(o),this.chartOpt={padding:0,plotOptions:{click:r._getClickEvent(),rotatable:!1,borderColor:"rgb(255,255,255)",startAngle:0,borderRadius:0,borderWidth:1,endAngle:360,innerRadius:"0.0%",animation:!0,dataLabels:{formatter:function(){return r._formatValue(this.value,this.series.index)+" "+FXM.Utils.num2Str(this.percentage,"(0.00%)")},connectorWidth:1,align:"outside",enabled:!0}},legend:{borderColor:"rgb(204,204,204)",borderRadius:0,shadow:!1,borderWidth:0,style:{fontFamily:"verdana",color:"#6f6f6f",fontSize:"12px",fontWeight:""},maxHeight:"30%",position:"bottom",enabled:!0},plotBorderColor:"rgb(238,238,238)",tools:{hidden:!1,toImage:{enabled:!1},sort:{enabled:!0},enabled:!0,fullScreen:{enabled:!1}},series:s,chartType:"pie",style:"normal",colors:["#1397DC","#12C1EC","#6FE498","#F5D04F","#FF9F7F","#FB7293","#DA99EC","#8378EA"]},FXM.Utils.isNull(this.myChart.options)?this.myChart.setOptions(this.chartOpt):this.myChart.setData(this.chartOpt)},_checkFields:function(){return this.options.valueFields.length>0},_setGroups:function(){var t=this.options;t.xFields.length>0&&t.valueFields.length<=1&&(this.yGroups=t.xFields.slice(0,1))}}),FXM.register("dashpiechart",FXM.DashPieChart)}(Zepto),FXM.DataTableProcessor=function(t){this.header=t.header,this.data=t.data,this.sort=t.sort||[],this._process()},FXM.DataTableProcessor.prototype={_process:function(){this._processHeader(this.header),this.processData(this.data)},processData:function(t){var e=this,i=[];FXM.Utils.forEach(t,function(t,a){for(var n=[],r=e._getDataRowCount(a),s=0;s<r;s++)n.push([]);FXM.Utils.forEach(e.columns,function(t,i){if(i.subform){var s=a[i.subform]||[];if(FXM.Utils.forEach(s,function(t,a){n[t].push(e._createDataCell(a[i.field],i))}),s.length<r)for(var o=s.length;o<r;o++)n[o].push(e._createDataCell(null))}else{var l=e._createDataCell(a[i.field],i);l.rowspan=r,n[0].push(l)}}),i=i.concat(n)}),this.tableData=i},_createDataCell:function(t,e){var i={text:""};if(FXM.Utils.isObjectEmpty(t))return i;switch(e.type){case"checkboxgroup":case"combocheck":i.text=t.join(", ");break;case"text":if(e.regex&&new RegExp(e.regex).test(t)){var a=FXM.CONSTS.TEXT_TYPE_REGEXP;e.regex===a.email?i.html='<a href="mailto:'+t+'">'+t+"</a>":e.regex!==a.mobile&&e.regex!==a.tel||(i.html='<a href="tel:'+t+'">'+t+"</a>")}else i.html=FXM.Utils.replaceURL(t);break;case"usergroup":case"deptgroup":var n=[];FXM.Utils.forEach(t,function(t,e){n.push(e||"")}),i.text=n.join(",");break;case"formula":case"number":var r=FXM.Utils.fixDecimalPrecision(t);i.text=FXM.Utils.num2Str(r,e.format);break;case"address":case"location":var s=[];t.province&&(s.push(t.province),t.city&&t.province!==t.city&&s.push(t.city),t.district&&s.push(t.district)),t.detail&&s.push(t.detail),i.text=FXM.Utils.address2Str(t,s.join(""),e.format);break;case"textarea":i.html="<pre>"+FXM.Utils.replaceURL(t)+"</pre>";break;case"datetime":i.text=FXM.Utils.date2Str(new Date(t),e.format);break;case"image":case"upload":case"signature":var o=$('<a class="table-op-btn table-file-btn"/>');o.text("").data("op","file"),o.data("file",t),i.html=o;break;case"linkdata":var l=t.key;"datetime"===e.linkType&&(l=FXM.Utils.date2Str(new Date(l),"yyyy-MM-dd")),i.text=l;break;default:i.text=t}return i},_getDataRowCount:function(t){var e=this,i=1;return FXM.Utils.forEach(t,function(t,a){"subform"===(e.fieldMap[t]||{}).type&&(i=Math.max(a.length,i))}),i},_processHeader:function(t){for(var e=this,i=this._getHeadRowCount(t),a=[],n=[],r={},s=0;s<i;s++)a.push([]);FXM.Utils.forEach(t,function(t,s){var o=e._getFieldName(s);if(r[o]=s,"subform"===s.type){if(FXM.Utils.isObjectEmpty(s.items))return;a[0].push({text:s.title,colspan:s.items.length,cls:"combined-col"}),FXM.Utils.forEach(s.items,function(t,s){var l=[o,e._getFieldName(s)].join(".");r[l]=s,a[1].push(e._createHeadCell(s,i,o)),n.push(e._createHeadCol(s,o))})}else a[0].push(e._createHeadCell(s,i)),n.push(e._createHeadCol(s))}),this.tableHead=a,this.columns=n,this.fieldMap=r},_createHeadCell:function(t,e,i){var a=this._getFieldName(t),n={html:$("<pre/>").text(t.title).html(),cls:t.type+"-col",data:{}};if($.extend(n,this._getFieldWidth(t)),i?a=[i,a].join("."):n.rowspan=e,n.data.field=a,!i&&FXM.CONSTS.LIMIT_FIELDS.sort.indexOf(t.type)>-1){n.cls+=" clickable sortable";var r;FXM.Utils.forEach(this.sort,function(t,e){e[a]&&(r=e[a])}),r?r===FXM.CONSTS.SORT.ASC?(n.cls+=" sort sort-asc",n.html+='<div class="sort-icon"><i class="icon-sort-asc"></i></div>'):(n.cls+=" sort sort-desc",n.html+='<div class="sort-icon"><i class="icon-sort-desc"></i></div>'):n.html+='<div class="sort-icon"><i class="icon-sort"></i></div>'}return n},_getFieldWidth:function(t){var e={};switch(t.type){case"text":case"radiogroup":case"combo":e={minWidth:50,maxWidth:200};break;case"textarea":case"checkboxgroup":case"combocheck":e={minWidth:50,maxWidth:300};break;case"formula":case"number":e={minWidth:50,maxWidth:150};break;case"datetime":var i=t.format&&t.format.indexOf("HH")>-1;e.minWidth=i?120:80;break;case"address":case"location":e={minWidth:50,maxWidth:300};break;case"image":case"upload":case"signature":e={minWidth:50,maxWidth:100};break;default:e={minWidth:50,maxWidth:200}}return e},_createHeadCol:function(t,e){var i=this._getFieldName(t),a={type:t.type,field:i,format:t.format};return e&&(a.subform=e),t.regex&&(a.regex=t.regex),"linkdata"===t.type&&(a.linkType=t.linkType),a},_getHeadRowCount:function(t){var e=1;return FXM.Utils.forEach(t,function(t,i){if("subform"===i.type)return e=2,!1}),e},_getFieldName:function(t){return t.tag||t.name},getTable:function(){return{tableHead:this.tableHead,tableData:this.tableData}}},function(){FXM.PG.APPLICATION=function(t){if(FXM.STATIC.CACHED_APPMENU)return e(t),void s();FXM.UI.showLoader(),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.app.get,t)},function(i){FXM.STATIC.CACHED_APPMENU=i,e(t),FXM.Vip.showUpgradeTip(i.bufferState)},null,function(t){FXM.UI.closeLoader()})};var t=function(t,e){return t.sort(function(t,i){var a=e[t.id]&&e[t.id].seq,n=e[i.id]&&e[i.id].seq;if(a!==n)return a-n;var r=e[t.id]&&e[t.id].entryId,s=e[i.id]&&e[i.id].entryId,o=0;return r>s?o=1:r<s&&(o=-1),o}),t},e=function(e){if(!FXM.Router.isPathChanged()){FXM.Router.clearPage(),$("body").addClass("page-application");var a=FXM.STATIC.CACHED_APPMENU;if(FXM.Utils.setPageTitle(a.name),a.entryList&&a.entryList.length>0){var n=a.entryMap,r=t(a.entryList.slice(0),n),s=$('<div class="menu-tree"/>').appendTo("body > .x-page");i(s,r,n)}else $("body > .x-page").html('<div class="empty-info"><div class="empty-img"></div><div class="empty-title">/</div><span class="empty-msg">/</span></div>');FXM.STATIC.ALLOW_APP_INSTALL&&new FXM.AppInstallBtn({forkId:e})}},i=function(t,e,i){var n=$('<ul class="flow-manage-node"/>').appendTo(t),s=$('<ul class="entry-nodes">').appendTo(t);FXM.Utils.forEach(e,function(t,e){var l=r(e,i);"flowManage"===e.id?(n.append(l),o()):s.append(l);var c=FXM.STATIC.CACHED_APPMENU.entryMap[e.id];if(c&&c.expand){var h=document.getElementById(e.id);$(h).length>0&&a($(h),i,!1)}}),t.on("click",".menu-node",function(t){a($(t.currentTarget),i,!0)})},a=function(t,e,i){var a=t.data("node");"flowManage"===a.id?(FXM.STATIC.CACHED_FLOWMENU={},FXM.STATIC.CACHED_FILTER=null,FXM.Router.redirectTo("/app/"+FXM.STATIC.APPID+"/flow")):"group"===a.type&&a.child?n(t,a,e,i):FXM.Router.redirectTo("/app/"+FXM.STATIC.APPID+"/"+a.type+"/"+a.id)},n=function(t,e,i,a){if(!e.isLoaded){var n=$("<ul/>").insertAfter(t);FXM.Utils.forEach(e.child,function(t,e){r(e,i).appendTo(n)}),e.isLoaded=!0}var s=t.parent("li").toggleClass("expand"),o=t.next("ul");if(s.hasClass("expand")){FXM.STATIC.CACHED_APPMENU.entryMap[e.id].expand=!0,a?o.addClass("animate"):o.removeClass("animate"),FXM.Utils.isNull(o.data("ori-height"))&&o.data("ori-height",o.height());var l=o.data("ori-height");o.height(l)}else FXM.STATIC.CACHED_APPMENU.entryMap[e.id].expand=!1,o.height(0)},r=function(t,e){var i,a=$.extend({id:t.id,child:t.child,text:t.text},e[t.id]),n=$("<li/>"),r=$('<i class="arrow-icon icon-arrow-right"/>'),s=$('<a class="menu-node" />').attr("id",t.id).data("node",a).appendTo(n);switch(a.type){case"group":i="icon-folder-close",r.appendTo(s);break;case"form":i=a.hasCoop?"icon-form":"icon-flow";break;case"report":i="icon-report";break;case"dash":i="icon-dash"}return i&&s.append($('<i class="node-icon"/>').addClass(i)),s.append($("<span/>").text(a.text)),n},s=function(){$(".page-application > .x-page").scrollTop(FXM.STATIC.SCROLL_TOP||0)},o=function(){FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.flow.flow_query_data_count,FXM.STATIC.APPID),data:{type:"todo"}},function(t){if(t.count>0){var e=t.count<=FXM.CONSTS.FLOW_COUNT_MAX?t.count:FXM.CONSTS.FLOW_COUNT_MAX+"+";$("#flowManage").append('<span class="todo-count has-todo">'+e+'</span><i class="arrow-icon icon-arrow-right"/>')}else $("#flowManage").append('<span class="todo-count"></span>')})}}(),FXM.PG.DASH=function(t,e){FXM.UI.showLoader(),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.dash.get,t,e)},function(t){if(!FXM.Router.isPathChanged()){FXM.Router.clearPage(),$("body").addClass("page-dash");var i=t.entry;FXM.Utils.setPageTitle(i.name),new FXM.Dash($.extend(i||{},{render:$("<div/>").appendTo("body > .x-page"),title:i.name,entryId:e}))}},null,function(){FXM.UI.closeLoader()})},function(t){FXM.PG.DASH_VIEW=FXM.PG.DASH_VIEW||{},t.extend(FXM.PG.DASH_VIEW,{init:function(e,i,a,n){this.$body=t("body").addClass("page-report-view"),this.appId=a,this.entryId=n,this.$report=t(".public-report"),this.$passPane=t(".public-password"),e?this._showPassPane():(this.$passPane.hide(),this._loadReport())},_loadReport:function(){var e=this;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.dash.get,this.appId,this.entryId)},function(i){FXM.Vip.showUpgradeTip(i.bufferState);var a=i.entry;new FXM.Dash(t.extend(a,{render:e.$report,title:a.name}))})},_showPassPane:function(){var e=this;t('<div class="tip"/>').text("").appendTo(this.$passPane);var i=new FXM.Password({render:t("<div/>").appendTo(this.$passPane),allowBlank:!1});i.select();var a=t('<button class="x-btn style-green"/>').text("").click(function(){FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.entry.dash_password,FXM.STATIC.DASH_TOKEN),data:{publicPwd:i.getValue()}},function(){e.$passPane.remove(),e._loadReport()},function(){FXM.UI.alert({msg:""})})});t('<div class="confirm-btn"/>').append(a).appendTo(this.$passPane)}})}(Zepto),function(t){FXM.PG.DASHBOARD=function(){var t=FXM.GB.user;return e()||FXM.Cookie.get(t._id+FXM.CONSTS.COOKIE.PORTRAIT.SUFFIX_KEY)||FXM.Utils.isRegtimeBeforeUpdate("persona")?FXM.STATIC.CACHED_APPS?(FXM.Utils.setPageTitle(FXM.STATIC.CACHED_TITLE),void i()):(FXM.STATIC.CACHED_TITLE=FXM.Utils.getPageTitle(),FXM.UI.showLoader(),void FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.dashboard.apps),data:{corpId:FXM.STATIC.dashConfig.corpId}},function(t){FXM.STATIC.CACHED_APPS=t.apps,i(),FXM.GB.autoInstallApp&&(h(FXM.GB.autoInstallApp),FXM.GB.autoInstallApp=null)},null,function(){FXM.UI.closeLoader()})):(FXM.Utils.dt(FXM.CONSTS.TRACKER.USER_PORTRAIT_COLLECT),void FXM.UserPortrait.init())};var e=function(){var t=!0,e=FXM.GB.user;if(e&&e.corpId){var i=["job","favorites"];FXM.Utils.isFromWorkWechat(e)||(i.push("company","corpSize","industry"),FXM.Utils.isFromDingDing(e)||i.push("phone")),FXM.Utils.forEach(i,function(i,a){if(!e[a])return t=!1,!1})}return t},i=function(){function e(e){var i,a,n=FXM.Utils.isWorkWechatAgent();e&&e.isSysManager?FXM.CORP.DD?(i="/",a="ddadmin"):FXM.CORP.WX&&n?(i="/",a="wxadmin"):(i="",a="guide"):i=FXM.CORP.DD?"//":FXM.CORP.WX&&n?"//":"//",t("body > .x-page").append('<div class="empty-info"><div class="empty-img"></div><div class="empty-title"></div><div class="empty-msg">'+i+"</div></div>"),a&&t('<div class="empty-tip"><a></a></div>').on("click","a",function(){FXM.PG.WELCOME(a)}).appendTo(".empty-info")}function i(e){(e=e<=FXM.CONSTS.FLOW_COUNT_MAX?e:FXM.CONSTS.FLOW_COUNT_MAX+"+")&&t(".app-top-menu .left .menu-icon").append('<span class="badge">'+e+"</span>")}if(FXM.STATIC.SCROLL_TOP=0,!FXM.Router.isPathChanged()){FXM.Router.clearPage(),FXM.Cookie.get("install_success_tip")&&(FXM.Cookie.remove("install_success_tip"),FXM.UI.toast({type:"success",msg:""})),t("body").addClass("page-dashboard");var l=FXM.STATIC.CACHED_APPS;if(!FXM.GB.isCorpUser||0===l.length){var h,u;FXM.GB.isCorpUser||(h=t('<div class="header-bar"/>').prependTo("body > .x-page")),FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.dashboard.user_corps)},function(i){t.extend(FXM.STATIC.dashConfig,{corps:i.corps}),FXM.Utils.forEach(i.corps,function(t,e){if(e.id===FXM.STATIC.dashConfig.corpId)return u=e,!1}),h&&o(h,u),0===l.length&&e(u)})}var d=c();if(t("body > .x-page").append(d+'<div class="apps-title"></div>'),l.length>0){var p='<div class="app-wrapper">';FXM.Utils.forEach(l,function(t,e){p+=s(e)}),p+="</div>",t("body > .x-page").append(p),t(".page-dashboard .app-wrapper").on("click",".app-item",function(e){var i=t(e.currentTarget).attr("id");i&&(FXM.STATIC.CACHED_APPMENU=null,FXM.Router.redirectTo("/app/"+i))})}switch(t(".app-top-menu .left").on("click",function(t){FXM.Router.redirectTo("/flowcenter/todo")}),t(".app-top-menu .right").on("click",function(t){FXM.STATIC.CACHED_LAUNCHAPPS={},FXM.Router.redirectTo("/flowcenter/launch")}),FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.dashboard.flow_todo_count),data:{corpId:FXM.STATIC.dashConfig.corpId}},function(t){i(t.count)}),FXM.GB.isDDActivity&&r(),FXM.STATIC.dashConfig.guide){case"dingtalk_admin":a({title:"",onClick:function(){FXM.PG.WELCOME("ddadmin")}});break;case"wx_admin":n();break;case"internal":a({title:"",onClick:function(){FXM.PG.WELCOME("guide")}})}FXM.STATIC.dashConfig.guide=null}},a=function(e){var i=t('<div class="broadcast">'+e.title+"</div>").prependTo(".x-page");t('<div class="close-btn"><i class="icon-close"></i></div>').on("click",function(){i.remove()}).appendTo(i),t('<span class="broadcast-btn"></span>').on("click",function(){i.remove(),e.onClick&&e.onClick()}).appendTo(i)},n=function(){var e=FXM.Utils.scrollLock(t("body")),i=t('<div class="x-window-mask"/>').append('<div class="guide-wrapper"><div class="guide-title"></div><div class="guide-text"></div><div class="guide-separator"></div><div class="guide-text">\nhttps://work.weixin.qq.com/login</div><div class="guide-btn"></div></div>').on("click",function(a){t(a.target).hasClass("guide-btn")&&(e.release(),i.remove())}).appendTo("body").addClass("dark-in")},r=function(){var e=t('<div class="x-window-mask"/>').append('<div class="activity-wrapper"><div class="menu-close"><i class="icon-close"></i></div><div class="wrapper-body"><div class="body-line title"><span></span></div><div class="body-line sub-title"><span class="text"><span class="style-orange margin">45</span></span></div><div class="body-line bg-gift"></div><div class="body-btn"></div></div></div>').on("click",function(i){var a=t(i.target);a.hasClass("icon-close")&&e.remove(),a.hasClass("body-btn")&&t(".wrapper-body",e).empty().addClass("size-large").append('<div class="body-line title"><span></span></div><div class="body-line sub-title"><span class="text"><span class="style-orange">45</span></span></div><div class="body-line bg-env"></div><div class="body-line info">45</div><div class="body-line info">45</div>')}).appendTo("body").addClass("dark-in")},s=function(t){if(!t)return"";var e=FXM.Utils.escapeHtmlSpecialChar(t.name);return'<div class="app-item" id="'+t._id+'"><div class="app-inner"><div class="app-icon app-cover-'+t.color+'"><i class="icon-cover-'+t.icon+'"></i></div><div class="app-title">'+e+"</div></div></div>"},o=function(e,i){if(i){var a=i.name?i.name:"";e.text(a),t('<i class="icon-menu btn-left"/>').prependTo(e).click(function(){l()}),FXM.Utils.setPageTitle(a)}},l=function(){var e=t("<div/>").append('<div class="team-pane-title"></div>'),i=new FXM.SlidePanel({content:e,direction:"left",text4Left:"",text4Right:""}),a=t('<div class="team-wrapper" />').appendTo(e),n=FXM.STATIC.dashConfig.corps||[];FXM.Utils.forEach(n,function(e,n){var r=n.id===FXM.STATIC.dashConfig.corpId?"select":"";t('<div class="team-wrapper-item  '+r+'"/>').text(n.name).prepend(t('<i class="icon-menu-item"/>')).append(t('<i class="icon-tick"/>')).on("click",function(e){t(e.currentTarget).hasClass("select")?i.close():FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.dashboard.switch_corp),data:{corpId:n.id}},function(){i.close(),FXM.STATIC.CACHED_APPS=null,FXM.STATIC.dashConfig.corpId=n.id,FXM.PG.DASHBOARD(),FXM.Vip.clear()})}).appendTo(a)}),n.length<2&&e.append('<div class="team-empty"></div>'),FXM.CORP.WX||t('<a href="/signout" class="team-item-bottom"></a>').appendTo(e),i.show()},c=function(){return'<div class="app-top-menu"><div class="left"><div class="inner"><div class="menu-icon"><i class="icon-alarm"></i></div><div class="menu-text"></div></div></div><div class="right"><div class="inner"><div class="menu-icon"><i class="icon-note"></i></div><div class="menu-text"></div></div></div></div>'},h=function(e){FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.dashboard.install),data:{forkId:e}},function(e){FXM.UI.toast({type:"success",msg:""}),t(s(e.app)).appendTo(".x-page >.app-wrapper")},function(t){var e=FXM.Utils.parseJSON(t.responseText);FXM.Vip.showUpgradeTip(e,"!")})}}(Zepto),FXM.PG.DATACREATE=function(t,e,i){FXM.UI.showLoader(),FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.form.get,t,e)},function(a){if(!FXM.Router.isPathChanged()){FXM.Router.clearPage(),$("body").addClass("page-form");var n=a.entry;if(n){FXM.Vip.showDataLimitTip({render:$("<div/>").prependTo("body > .x-page"),customCls:"data-limit-tip"});var r=$("<div/>").appendTo("body > .x-page");FXM.Utils.isEmpty(FXM.STATIC.ATOKEN)&&n.hasFlow&&n.flow&&n.flow.flowVer&&FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.flow.stash_data_count,t)},function(t){t.count&&t.count>0&&$('<div class="page-form-header-msg"><span >'+t.count+"</span></div>").on("click",function(){FXM.Router.redirectTo("/app/"+n.appId+"/form/"+n.entryId+"/stash")}).prependTo(r)});var s=[];a.flow&&a.flow.allowSave&&s.push({nav:"save",text:FXM.Utils.getFlowActionText("save",a.flow),style:"grey",onClick:function(){this.options.flowAction="save",this.doSubmit(function(){FXM.UI.indicator("",function(){FXM.Router.back()})})}}),s.push({nav:"submit",text:FXM.Utils.getFlowActionText("forward",a.flow),onClick:function(){this.doVerifyAndSubmit(function(){FXM.UI.indicator("",function(){FXM.Router.back()})})}}),new FXM.Form($.extend(n.content,{render:r,title:n.name,entryId:e,dataId:null,authGroupId:parseInt(i,10),cacheEnable:n.hasCache,updateTime:n.updateTime,navBtns:s}))}else $("body > .x-page").html('<div class="empty-info"><div class="empty-img"></div><div class="empty-title"></div></div>')}},function(){FXM.Router.isPathChanged()},function(t){FXM.UI.closeLoader()})},function(t){FXM.ViewData=FXM.ViewData||{},t.extend(FXM.ViewData,{init:function(e){var i=this;t("body").addClass("page-form page-form-hasheader").append(t('<div class="x-page"/>')),this.$formData=t("<div/>").appendTo("body > .x-page"),FXM.UI.showLoader(),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.read),data:{formId:e.entryId,authGroupId:FXM.CONSTS.DEFAULT_AUTH_GROUP}},function(a){i.hasExtParams=a.hasExtParams,FXM.Utils.setPageTitle(a.data.label||""),i.formConfig={render:i.$formData,authGroupId:a.authGroupId,data:t.extend(!0,{},a.data),dataId:e.dataId,editValue:a.data,form:a.form,formId:e.entryId,hasCancelBtn:!1,hasDeleteBtn:a.isDeletable,hasEditBtn:a.isEditable,hasSwitchBtn:!1,header:i.getHeader(a.form.items||[],e.entryId,e.hasCoop),ignoreVisible:!1,optAuth:FXM.Utils.isObjectEmpty(a.optAuth)?{}:a.optAuth,title:a.formName,onEditData:function(){i.$formData.hide()},onAfterEditData:function(){t("body >.x-page").remove(),i.init(e)},onAfterCancel:function(){i.$formData.show()},onAfterDeleteData:function(){t("body").empty(),t('<div class="success-info"><div class="data-update-success-icon"/><span class="msg-title"></div></div>').appendTo("body")}},e.hasCoop?new FXM.CoopFormData(i.formConfig):(t.extend(i.formConfig,{onAfterFlowChange:function(){t("body >.x-page").remove(),i.init(e)},flowAction:{flowActivate:!!a.allowActivate,flowClose:!!a.allowClose,flowTransfer:!!a.allowTransfer,flowUpdate:!!a.isEditable}}),new FXM.FlowFormData(i.formConfig)),FXM.Utils.setPageTitle(a.data.label)},function(t){var e=FXM.Utils.parseJSON(t.responseText);FXM.UI.renderError(e.msg)},function(){FXM.UI.closeLoader()})},getHeader:function(t,e,i){var a=this,n=[],r=FXM.Utils.createEntryAttributeField("label",{id:e});n.push(r),n=n.concat(t);var s=FXM.Utils.getEntryAttribute(a.hasExtParams,i);return FXM.Utils.forEach(s,function(t,i){var a=FXM.Utils.createEntryAttributeField(i,{id:e});n.push(a)}),n}})}(Zepto),function(t){FXM.PG.FLOW=function(e){FXM.Router.clearPage(),t("body").addClass("page-flow"),u(),d(),s(e),p(e,"")};var e=null,i=null,a=null,n=null,r=null,s=function(i){e=t('<div class="flow-menu"><div class="menu-item  current-item" id="todo"></div><div class="menu-item" id="create"></div><div class="menu-item" id="part"></div></div>').on("click",".menu-item",function(e){t(".current-item").removeClass("current-item");var a=t(e.currentTarget).addClass("current-item");if(FXM.STATIC.CACHED_FLOWMENU={},a.length>0){var n=a.attr("id");h(),o(n),p(i,n)}}).appendTo(t(".page-flow > .x-page")),FXM.Utils.isObjectEmpty(FXM.STATIC.CACHED_FLOWMENU)?o("todo"):(t(".current-item").removeClass("current-item"),t("#"+FXM.STATIC.CACHED_FLOWMENU.currentMenu,e).addClass("current-item"))},o=function(t){FXM.Utils.isEmpty(FXM.STATIC.CACHED_FLOWMENU)?(FXM.STATIC.CACHED_FLOWMENU={},FXM.STATIC.CACHED_FLOWMENU.currentMenu=t):FXM.STATIC.CACHED_FLOWMENU.currentMenu=t},l=function(e,n){n||(n="todo");var s=i[n];FXM.Utils.isEmpty(s)&&(s.filterType=FXM.CONSTS.FLOW_FILTER_TYPE.ALL,s.filter={},"todo"===n?s.sort={updateTime:-1}:"create"===n&&(s.sort={createTime:-1})),FXM.STATIC.CACHED_FILTER=i,a?(a.options.filterCache=s,a.rebuild()):a=new FXM.FlowFilter({render:t('<div class="flow-filter"/>').prependTo(r),appId:e,flowType:n,filterCache:s,onFilterSuccess:function(t){c(n,t),p(e,n)}})},c=function(e,a){var n=i[e];t.extend(n,a)},h=function(){a&&(a.element.remove(),a=null)},u=function(){r&&(r.remove(),r=null),h()},d=function(){var t={todo:{},create:{},part:{}};return i=FXM.STATIC.CACHED_FILTER||t},p=function(e,a){FXM.Utils.isEmpty(a)&&(a="todo");var s=FXM.STATIC.CACHED_FLOWMENU.currentMenu?FXM.STATIC.CACHED_FLOWMENU.currentMenu:a;r||(r=t('<div class="flow-body has-header scroll"/>').appendTo(".page-flow > .x-page")),n&&n.remove(),n=t('<div class="flow-pane"/>').appendTo(r);var o=FXM.CONSTS.FLOW_FILTER_TYPE,c=i[a],u=c.filterType?c.filterType:o.ALL,d=u===o.CUSTOM?c.filter:{},p=u===o.CUSTOM?c.formId:null,f=c.sort;FXM.Utils.isObjectEmpty(f)&&"create"===a&&(f={createTime:-1}),new FXM.FlowPane({render:n,listType:s,filterType:u,sort:f,filter:d,formId:p,url:FXM.Utils.getApi(FXM.API.flow.flow_query_data,e),onItemClick:function(t){FXM.Router.redirectTo("/app/"+e+"/form/"+t.entryId+"/data/"+t._id+"/flow/"+t.flowId+"/"+s+"/back")},onAsyncSuccess:function(t){u===o.ALL&&FXM.Utils.isObjectEmpty(t.data)?h():l(e,s)}})}}(Zepto),function(t){FXM.PG.FLOWCENTER=function(a){FXM.Router.clearPage(),t("body").addClass("page-flow-center");var n=t('<div class="flow-wrapper"/>').appendTo("body > .x-page");switch(a){case"todo":e(n);break;case"launch":i(n)}};var e=function(e){FXM.Utils.setPageTitle(""),new FXM.FlowPane({render:t('<div class="flow-todo"/>').appendTo(e),listType:"todo",url:FXM.Utils.getApi(FXM.API.dashboard.flow_todo),corpId:FXM.STATIC.dashConfig.corpId,onItemClick:function(t){FXM.Router.redirectTo("/app/"+t.appId+"/form/"+t.entryId+"/data/"+t._id+"/flow/"+t.flowId+"/todo/back")}})},i=function(e){function i(i){FXM.Utils.isObjectEmpty(i.appMap)?t("body > .x-page").html('<div class="empty-info"><div class="empty-img"></div><span class="empty-msg"></span></div>'):FXM.Utils.forEach(i.appMap,function(a,n){var r=t('<div class="flow-launch"/>').appendTo(e);r.append(t('<div class="flow-launch-title"/>').text(n.name));var s=t("<ul/>").data("appid",a).appendTo(r);i.appEntryMap[a].map(function(e){t("<li />").text(e.name).data("entryid",e.entryId).prepend(t('<i class="icon-flow"/>')).append(t('<i class="arrow-icon icon-arrow-right"/>')).on("click",function(e){var i=t(e.target).data("entryid"),a=t(t(e.target).parent()[0]).data("appid");FXM.Utils.dt(FXM.CONSTS.TRACKER.DASHBOARD_FLOW_LAUNCH_FROM_MOBILE),FXM.Router.redirectTo("/app/"+a+"/datacreate/"+i+"/"+FXM.CONSTS.AUTHGROUP.SUBMIT)}).appendTo(s)})})}FXM.Utils.setPageTitle(""),FXM.Utils.isObjectEmpty(FXM.STATIC.CACHED_LAUNCHAPPS)?FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.dashboard.flow_start),data:{corpId:FXM.STATIC.dashConfig.corpId}},function(t){FXM.STATIC.CACHED_LAUNCHAPPS=t,i(t)}):i(FXM.STATIC.CACHED_LAUNCHAPPS)}}(Zepto),function(t){FXM.PG.FLOWFORMDATA=function(e,i,a,n,r,s,o){FXM.Router.clearPage(),t("body").addClass("page-flow"),FXM.UI.showLoader();var l=t("body > .x-page");FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.read),data:{entryId:i,formId:i,dataId:a,flowId:n}},function(c){FXM.Utils.setPageTitle(c.formName);var h=[];if(FXM.Utils.isArray(c.flowNodes)&&(h=c.flowNodes.filter(function(t){return"todo"===r?"charger"===t.type:"part"===r?"transactor"===t.type:void 0})).length>1){var u=t('<div class="flow-header-wrapper"/>').appendTo(l),d=t('<div class="flow-action-sheet"><i class="action-icon icon-arrow-down"></i></div>').on("click",function(n){var s=t(n.target).closest(".x-select-item");if(s&&s.length){if(s.hasClass("active"))return n.preventDefault(),!1;s.addClass("active").siblings().removeClass("active"),f.toggleClass("x-ui-hidden");var o=s.data("flowId");FXM.PG.FLOWFORMDATA(e,i,a,o,r,"back")}else f.toggleClass("x-ui-hidden")}).appendTo(u),p=t("<span/>").prependTo(d),f=t('<div class="action-sheet x-ui-hidden"/>').appendTo(d),m=t('<div class="sheet-content"/>').appendTo(f);FXM.Utils.forEach(h,function(e,i){var a=t('<div class="x-select-item"/>').append('<div class="item-checkbox"/>').append(t('<div class="item-text"/>').text(i.name)).data("flowId",i.flowId).appendTo(m);i.flowId===parseInt(n)&&(a.addClass("active"),p.text(i.name))})}FXM.FlowFormDataPage._init({flowContent:c,render:l,dataid:a,flowid:n,listType:r,source:s,callback:o,flowNodes:h})},null,function(){FXM.UI.closeLoader()})},FXM.FlowFormDataPage=FXM.FlowFormDataPage||{},t.extend(FXM.FlowFormDataPage,{_init:function(e){this.options=t.extend({},e);var i=this.options;null!==i.render&&(this.element=t(i.render)),FXM.STATIC.DATAID=i.dataid,this.flowForm=null,this.flowFormData=null,this.flowLog=null,this.flowApproval=null,this.flowChartView=null,this._renderHeader()},_renderHeader:function(){var e=this.options,i=this,a=e.flowContent;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.log_flow)},function(n){var r=[{cls:"header-menu-item",text:"",onClick:function(t){i._renderFormContent(t)}}];if(n.logs&&n.logs.length){if(r.push({cls:"header-menu-item",text:"",onClick:function(a){var n=t(".body-wrapper > .wrapper-content",i.$body).eq(a);i.flowApproval||(i.flowApproval=new FXM.FlowApproval({render:t("<div/>").appendTo(n),appId:e.flowContent.data.appId,entryId:e.flowContent.data.entryId,version:e.flowContent.data.flowVer,dataId:e.dataid}))}}),a.hasLogView?(r.push({cls:"header-menu-item",text:"",onClick:function(e){var a=t(".body-wrapper > .wrapper-content",this.$body).eq(e);i.flowLog||(i.flowLog=new FXM.FlowLog({render:t("<div/>").appendTo(a)}))}}),r.push({cls:"header-menu-item",text:FXM.Utils.getFlowActionText("state"),onClick:function(e){var n=a.data.chargers,r=[];FXM.Utils.forEach(n,function(t,e){r.push(e.flowId)});var s=a.data.transactors,o=[];FXM.Utils.forEach(s,function(t,e){o.push(e.flowId)});var l=t(".body-wrapper > .wrapper-content",this.$body).eq(e);i._createFlowContent(o,r,l)}})):r.push({cls:"header-block"},{cls:"header-block"}),r.length>1){var s=t(".flow-header-wrapper",i.element);s&&s.length||(s=t('<div class="flow-header-wrapper"/>').appendTo(i.element));var o=t('<div class="flow-bar-header"/>').appendTo(s);FXM.Utils.forEach(r,function(e,a){var n=t('<div class="'+a.cls+'"/>').on("click",function(n){if(t(n.currentTarget).hasClass("active"))return n.preventDefault(),!1;a.onClick&&a.onClick(e),i._activeMenuItem(t(".header-menu-item").index(this))}).appendTo(o);a.text&&t('<div class="item-menu-text"/>').text(a.text).appendTo(n)}),i._activeMenuItem()}i._renderBody(r)}r[0].onClick(0)})},_activeMenuItem:function(e){e=e||0;var i=t(".flow-bar-header",this.element),a=t(".flow-body > .body-wrapper",this.element),n=t(".wrapper-content",a);if(i&&i.length){t(".header-menu-item",i).eq(e).addClass("active").siblings().removeClass("active"),n&&n.length&&n.eq(e).removeClass("invisible").siblings().addClass("invisible");var r="translate(-"+100*e+"%,0)";a.css(FXM.Utils.formatTransform(r))}},_renderBody:function(e){var i=t(".x-page > div",this.element).last(),a=i&&i.length?i.outerHeight(!0)+i.offset().top:0;this.$body=t('<div class="flow-body"/>').css("top",a).appendTo(this.element);var n=t('<div class="body-wrapper"/>').appendTo(this.$body);if(e.length>1)for(var r=0;r<e.length;r++)t('<div class="wrapper-content"/>').css("left",100*r+"%").appendTo(n);else t('<div class="wrapper-content"/>').appendTo(n)},_isEditable:function(){var t=this.options;return t.flowContent.isEditable&&t.flowContent.currentFlowId!==FXM.CONSTS.WORKFLOW.END_FLOW_ID&&"todo"===t.listType},_renderFormContent:function(e){var i=this.options,a=t(".body-wrapper > .wrapper-content",this.$body).eq(e);if(this._isEditable()){if(!this.flowForm){var n=t('<div class="form-content-wrapper"/>').appendTo(a);this.flowForm=new FXM.Form(t.extend(i.flowContent.form,{render:t("<div/>").appendTo(n),appId:FXM.STATIC.APPID,entryId:i.formid,dataId:i.dataid,ignoreOptAuth:!1,submitUrl:FXM.Utils.getApi(FXM.API.data.update),widgetOptAuth:i.flowContent.optAuth?i.flowContent.optAuth:{},buttonPosition:"middle",editValue:i.flowContent.data,mode:"edit",navBtns:null,comment:i.flowContent.comment,signature:i.flowContent.signature})),this._renderFooter(a)}}else if(!this.flowFormData){this._renderFooter(a);var r=[];FXM.Utils.forEach(i.flowContent.form.items,function(t,e){var i=FXM.Utils.getFieldAttr(e);i&&r.push(i)});var s=t("<div/>").appendTo(a),o=t(".x-form-btn-group > .btn-group-wrapper",a),l=o&&o.outerHeight(!0)||0;s.css("bottom",l),this.flowFormData=new FXM.FormData({render:s,entryId:i.formid,customCls:"flow-form-data-view",header:r,data:t.extend({},i.flowContent.data),optAuth:i.flowContent.optAuth,ignoreVisible:!1})}},_renderFooter:function(e){var i=this.options,a=this._getFlowBtns(i.flowContent,i.listType);a.length||t(".form-content-wrapper",e).addClass("full-content"),new FXM.FormBtnGroup({render:t("<div/>").appendTo(e),btns:a,target:this})},_submitFunc:function(e,i){var a=this.options,n=this;this.flowForm&&(this.flowForm.options.submitData=t.extend({dataId:a.dataid,flowAction:e,flowId:a.flowContent.currentFlowId,appId:a.flowContent.data.appId},i)),"forward"===e?this.flowForm&&this.flowForm.doVerifyAndSubmit(function(t,e){n._submitSuccess(t,e)}):this.flowForm?this.flowForm.checkFlowComment(function(){n.flowForm.doSubmit(function(t,e){n._submitSuccess(t,e)})}):this._doSubmit(a.flowid,e,function(t,e){n._submitSuccess(t,e)})},_submitSuccess:function(t,e){var i,a=this.options,n=this;switch(e){case"revoke":i="";break;case"close":i="";break;default:i=FXM.Utils.getFlowActionText(e)+""}FXM.UI.indicator(i,function(){switch(FXM.Utils.applyFunc(n,a.callback,[],!1),e){case"forward":case"save":case"back":if(a.flowNodes.length>1){var t="";FXM.Utils.forEach(a.flowNodes,function(e,i){if(i.flowId===parseInt(a.flowid)){var n=a.flowNodes[e+1];t=n?n.flowId:a.flowNodes[e-1].flowId}}),FXM.PG.FLOWFORMDATA(a.flowContent.data.appId,a.flowContent.data.entryId,a.dataid,t,a.listType,"back")}else n._redirectToSource();break;default:n._redirectToSource()}})},_redirectToSource:function(){"other"===this.options.source?window.location="/dashboard":FXM.Router.back()},_doSubmit:function(t,e,i){FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.flow_change),data:{formId:FXM.STATIC.ENTRYID,flowId:t,flowAction:e}},function(t){i&&i(t,e)})},_createBackSlider:function(t){var e=this,i=this.options.flowContent;new FXM.ComboSlider({text4Right:FXM.Utils.getFlowActionText("back",i),title:"",async:{url:FXM.Utils.getApi(FXM.API.data.allow_back_nodes),data:{flowId:t}},onAsyncSuccess:function(t){var e=[];return FXM.Utils.forEach(t.flowNodes,function(t,i){e.push({text:i.name,value:i.flowId})}),e},onOk:function(){var t=this.getValue();FXM.Utils.isEmpty(t)?FXM.UI.toast({msg:"",type:"warning"}):(e._submitFunc("back",{backFlowIds:[parseInt(t,10)]}),this.close())}}).show()},_createCandidateSlider:function(t){var e=this,i=this.options.flowContent;new FXM.ComboSlider({text4Right:FXM.Utils.getFlowActionText("transfer",i),title:"",emptyTip:"",async:{url:FXM.Utils.getApi(FXM.API.data.allow_transfer_users),data:{flowId:t}},onAsyncSuccess:function(t){var e=[];return FXM.Utils.forEach(t.candidates,function(t,i){e.push({text:i.nickname,value:i._id})}),e},onOk:function(){var t=this.getValue();if(FXM.Utils.isEmpty(t))return FXM.UI.toast({msg:"",type:"warning"});e._submitFunc("transfer",{candidateId:t}),this.close()}}).show()},_createFlowContent:function(e,i,a){var n=this.options,r=n.flowContent;this.flowChartView||(this.flowChartView=new FXM.FlowChartView({render:t("<div />").appendTo(a),appId:r.data.appId,entryId:r.data.entryId,dataId:n.dataid,flow:r.data,passNodes:e,currentNodes:i,flowState:r.data.flowState,flowVer:r.data.flowVer}))},_getFlowBtns:function(t,e){var i=this,a=[];switch(e){case"todo":t.isEditable&&t.currentFlowId!==FXM.CONSTS.WORKFLOW.END_FLOW_ID&&(a.unshift({nav:"submit",text:FXM.Utils.getFlowActionText("forward",t),onClick:function(){i._submitFunc("forward")}}),t.allowSave&&a.unshift({nav:"save",text:FXM.Utils.getFlowActionText("save",t),onClick:function(){i._submitFunc("save")}}),t.allowBack&&a.unshift({nav:"back",text:FXM.Utils.getFlowActionText("back",t),onClick:function(){var e=t.backNodes;FXM.Utils.isObjectEmpty(e)?i._submitFunc("back"):1===e.length?i._submitFunc("back",{backFlowIds:e}):i._createBackSlider(t.currentFlowId)}}),t.allowClose&&a.unshift({nav:"over",text:FXM.Utils.getFlowActionText("close",t),onClick:function(){FXM.UI.confirm("",function(){i._submitFunc("close")})}}),t.allowTransfer&&a.push({nav:"transfer",text:FXM.Utils.getFlowActionText("transfer",t),onClick:function(){i._createCandidateSlider(t.currentFlowId)}}));break;case"create":t.allowRevoke&&a.unshift({nav:"revoke",text:FXM.Utils.getFlowActionText("revoke"),onClick:function(){i._submitFunc("revoke")}})}return a}})}(Zepto),function(t){FXM.PG.FLOWSTASH=function(e,i){FXM.Router.clearPage(),t("body").addClass("page-flow-stash");var a=t('<div class="flow-wrapper"/>').appendTo("body >.x-page");a.append('<div class="flow-stash-title"></div>'),new FXM.FlowPane({render:t('<div class="flow-todo"/>').appendTo(a),listType:"stash",url:FXM.Utils.getApi(FXM.API.flow.flow_query_data,e),formId:i,onAsyncSuccess:function(e){e.data&&0===e.data.length&&t(".page-flow-stash > .x-page").html('<div class="empty-info"><div class="empty-img"></div><div class="empty-title"></div></div>')},onItemClick:function(t){FXM.Router.redirectTo("/app/"+e+"/form/"+i+"/data/"+t._id+"/flow/"+t.flowId+"/todo/back")}})}}(Zepto),function(t){function e(e,i,a,n){var r=t('<div class="page-form-header"></div>').appendTo("body");t("body").addClass("page-form-hasheader"),l(e,i,a,n).appendTo(r)}function i(t,e,i){F=null,_=i.groupId,i.groupId===FXM.CONSTS.AUTHGROUP.SUBMIT?(d(),h(t,e,i.groupId)):(d(),u(t,e,i.dataPerms,i.optAuth,i.groupId)),a(i)}function a(e){var i=t(".page-form-header"),a=t(".head-tools");if(a.length?a.empty():a=t('<div class="head-tools"/>').appendTo(i),e.groupId!==FXM.CONSTS.AUTHGROUP.SUBMIT){var n=t('<div class="form-data-filter"/>'),l=M.getParamFields(),c=r(l);F=new FXM.Filter({render:n,fields:l,filters:c.cond,relation:c.rel,onStopEdit:function(){var t=F.getCacheValue();o(t);var e=FXM.Utils.getValidFilters(t);h.toggleClass("active",!FXM.Utils.isObjectEmpty(e.cond))},authGroupId:_});var h=t('<div class="btn-header"/>').append(t('<div class="btn-inner"/>').append(t('<i class="icon-filter"/>'))).on("click",function(e){s(n,t(e.currentTarget))}).appendTo(a),u=FXM.Utils.getValidFilters(c);h.toggleClass("active",!FXM.Utils.isObjectEmpty(u.cond));var d=t('<div class="btn-header"/>').append(t('<div class="btn-inner"/>').append(t('<i class="icon-eye"/>'))).appendTo(a),p=M&&M.getShowItems(),f=!0;FXM.Utils.forEach(p,function(t,e){if(!e.selected)return f=!1,!1}),d.toggleClass("active",!f),new FXM.DataCombocheck({title:"",render:d,items:M&&M.getShowItems(),onStopEdit:function(t){d.toggleClass("active",t.length<p.length),M&&M.setShowFields(t)}})}}function n(){return FXM.Store.getKey("filterValue",{appId:FXM.STATIC.APPID,entryId:FXM.STATIC.ENTRYID,groupId:_})}function r(t){var e=[];t&&FXM.Utils.forEach(t.slice(0,3),function(t,i){e.push({field:i.name})});var i={cond:e,rel:FXM.CONSTS.FILTER_RELATION.AND};return FXM.Store.get(n())||i}function s(t,e){new FXM.SlidePanel({direction:"bottom",content:t,text4Right:"",text4Left:"",onLeftClick:function(){this.close()},onRightClick:function(){M.reload(!0),this.close();var t=F.getCacheValue(!0);o(t);var i=FXM.Utils.getValidFilters(t);e.toggleClass("active",!FXM.Utils.isObjectEmpty(i.cond))}}).show()}function o(t){var e=n();FXM.Store.set(e,t)}function l(e,a,n,r){f=[];var s=[],o={};FXM.Utils.forEach(n,function(t,e){o[e.groupId]=e,e.groupId>=0&&f.push(e)});var l=r?FXM.CONSTS.AUTH_GROUP_NAME:FXM.CONSTS.FLOW_AUTH_GROUP_NAME;FXM.Utils.forEach(l,function(t,e){var i=o[t];FXM.Utils.isNull(i)||(i.name=e,s.push(i))}),f=s.concat(f);var c=FXM.Store.getKey("authGroup",{appId:e,entryId:a}),h=FXM.Store.get(c)||f[0].groupId,u=o[h];u||(h=f[0].groupId,u=o[h]);var d=t('<span class="page-form-title"/>').text(u.name),p=t('<div class="page-form-selector"/>').append(d);if(i(e,a,u),f.length>1){var m=t('<div class="page-form-option x-ui-hidden"/>').on("click",function(n){var r=t(n.target).closest(".x-select-item");if(r.length>0){var s=r.data("item");d.text(s.name),r.addClass("active").siblings().removeClass("active"),i(e,a,s),FXM.Store.set(c,s.groupId)}m.toggleClass("x-ui-hidden")}).css("z-index",FXM.STATIC.zIndex++).appendTo("body"),g=t('<div class="option-list"/>').appendTo(m);FXM.Utils.forEach(f,function(e,i){var a=t('<div class="x-select-item"/>').data("item",i).append(t('<div class="item-checkbox"/>')).append(t('<div class="item-text"/>').text(i.name)).appendTo(g);i.groupId===h&&a.addClass("active")}),p.append(t('<i class="page-form-header-arrow icon-arrow-down"/>')).on("click",function(){m.toggleClass("x-ui-hidden")})}return p}function c(i,a){FXM.UI.showLoader(),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.form.get,i,a)},function(t){g=t.entry,p=g.content?g.content.items:[],m=g.hasExtParams,v=t.flow,FXM.Utils.setPageTitle(g.name),FXM.Utils.isObjectEmpty(t.authGroups)?h(i,a):1===t.authGroups.length&&t.authGroups[0].groupId===FXM.CONSTS.AUTHGROUP.SUBMIT?h(i,a,t.authGroups[0].groupId):e(i,a,t.authGroups,g.hasCoop),FXM.STATIC.ALLOW_APP_INSTALL&&new FXM.AppInstallBtn({forkId:i})},function(e){if(3009!==FXM.Utils.parseJSON(e.responseText).code)return!1;t("body > .x-page").html('<div class="empty-info"><div class="empty-entry"></div><div class="empty-title"></div><div><span class="empty-msg"></span></div></div>')},function(){FXM.UI.closeLoader()})}function h(e,i,a){if(g){FXM.Vip.showDataLimitTip({render:t("<div/>").prependTo("body > .x-page"),customCls:"data-limit-tip"});var n=t("<div/>").appendTo("body > .x-page"),r=[];FXM.Utils.isEmpty(FXM.STATIC.ATOKEN)&&g.hasFlow&&g.flow&&g.flow.flowVer&&(FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.flow.stash_data_count,e)},function(e){e.count&&e.count>0&&t('<div class="page-form-header-msg"><span >'+e.count+"</span></div>").on("click",function(){FXM.Router.redirectTo("/app/"+g.appId+"/form/"+g.entryId+"/stash")}).prependTo(n)}),v.allowSave&&r.push({nav:"save",text:FXM.Utils.getFlowActionText("save",v),style:"grey",onClick:function(){this.options.flowAction="save",this.doSubmit(function(){FXM.UI.indicator("",function(){FXM.STATIC.CACHED_APPMENU?FXM.Router.back():FXM.Router.reload()})})}})),r.push({nav:"submit",text:FXM.Utils.getFlowActionText("forward",v),onClick:function(){this.doVerifyAndSubmit(function(e){if(n.empty(),e&&e.flowFailureCode)window.location.reload();else{var i,a=t('<div class="success-info"/>').appendTo(n);e&&e.data&&(i=e.data.submitPrompt),i&&"custom"===i.mode?a.addClass("custom-info x-subhtml").html(i.content):t('<div class="data-create-success-icon"></div><div class="msg-title"></div>').appendTo(a),(!i||i&&("custom"===i.mode&&i.hasAddBtn||"system"===i.mode))&&t('<div class="reload-btn x-btn style-blue"></div>').on("click",function(){window.location.reload()}).appendTo(a)}})}}),y=new FXM.Form(t.extend(g.content||{},{render:n,title:g.name,entryId:i,dataId:null,authGroupId:a,cacheEnable:g.hasCache,updateTime:g.updateTime,navBtns:r}))}else t("body > .x-page").html('<div class="empty-info"><div class="empty-img"></div><div class="empty-title"></div></div>')}function u(e,i,a,n,s){var o=[];FXM.Utils.forEach(p,function(e,i){if(i.widget){var a=i.widget.widgetName;if(n[a]&&n[a].visible){var r=t.extend(!0,{},i);if("subform"===r.widget.type){var s=[];FXM.Utils.forEach(r.widget.items,function(t,e){var i=[a,e.widget.widgetName].join(".");n[i]&&n[i].visible&&s.push(e)}),r.widget.items=s}o.push(r)}}}),M=new FXM.DataCoop({render:t("<div />").appendTo("body >.x-page"),fields:o,appid:e,formid:i,groupid:s,dataPerms:a,optAuth:n,hasExtParams:m,hasLogView:!0,hasFlow:!!(g.hasFlow&&g.flow&&g.flow.flowVer),hasCoop:g.hasCoop,onDataCreate:function(){FXM.Router.redirectTo("/app/"+e+"/datacreate/"+i+"/"+s)},onDataFilter:function(){return F?F.getValue():FXM.Utils.getValidFilters(r())}})}function d(){y&&y.saveFormData(),t("body >.x-page").empty()}FXM.PG.FORM=function(e,i){FXM.Router.clearPage(),t("body").addClass("page-form"),c(e,i)};var p,f,m,g,v,y,M,F,_}(Zepto),function(t){FXM.FormDataLink=FXM.FormDataLink||{},t.extend(FXM.FormDataLink,{init:function(e,i,a,n){var r=this;this.entryId=a,this.dataId=n,t("body").addClass("page-form-data-view"),FXM.UI.showLoader(),FXM.Utils.setPageTitle(e),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.data.read),data:{formId:this.entryId,dataId:this.dataId}},function(e){r.hasEditBtn=e.isEditable,r.data=e.data,r.form=e.form,r.optAuth=e.optAuth,r.$wrapper=t(".wrapper",".page-form-data-view"),FXM.Utils.setPageTitle(r.data.label||""),r._createFormData(),r._createEditPane()},null,function(){FXM.UI.closeLoader()})},_createFormData:function(){var e=this.form&&this.form.items||[];this.formData=new FXM.FormData({render:t("<div/>").appendTo(this.$wrapper),data:this.data,header:this._getHeader(e),ignoreVisible:!1,optAuth:this.optAuth})},_createEditPane:function(){if(this._hasEditPane()){var e=this;this.$wrapper.toggleClass("no-edit-pane",!this._hasEditPane()),this.$editPane=t('<div class="edit-pane"/>').appendTo(this.$wrapper),new FXM.DataBtnGroup({render:e.$editPane,hasEditBtn:e.hasEditBtn}),this.$editPane.click(function(i){switch(t(i.target).closest(".item-btn").attr("role")){case"edit":e._doEditData()}})}},_doEditData:function(){var e=this;this.$wrapper.addClass("no-edit-pane").empty();var i={render:t("<div/>").appendTo(this.$wrapper),appId:this.appId,entryId:this.entryId,dataId:this.dataId,submitUrl:FXM.Utils.getApi(FXM.API.data.update),editValue:this.data,widgetOptAuth:this.optAuth,mode:"edit",ignoreOptAuth:!1,navBtns:[{nav:"update",text:"",onClick:function(){this.doVerifyAndSubmit(function(t){e.data=t.data,FXM.UI.indicator("",function(){e.$wrapper.empty(),e._createFormData(),e._createEditPane()})})}},{nav:"cancel",text:"",onClick:function(){e.$wrapper.empty(),e._createFormData(),e._createEditPane()}}]};new FXM.Form(t.extend({},this.form,i))},_hasEditPane:function(){return this.hasEditBtn},_getHeader:function(t){var e=[].concat(t);return FXM.Utils.forEach(FXM.CONSTS.EntryAttributes,function(t){var i=FXM.Utils.createEntryAttributeField(t,{id:FXM.STATIC.ENTRYID});e.push(i)}),e}})}(Zepto),function(t){FXM.PG.FORM_QUERY=FXM.PG.FORM_QUERY||{},t.extend(FXM.PG.FORM_QUERY,{init:function(e,i,a){this.$body=t("body").addClass("page-form-query"),this.appId=i,this.entryId=a,this.$report=t(".public-report"),this.$passPane=t(".public-password"),this.$wrapper=t('<div class="widget-wrapper has-parameter"/>').hide().appendTo(this.$report),this.$parameter=t('<div class="parameter"/>').appendTo(this.$report),this.$btnPane=t('<div class="query-btn-pane"/>').appendTo(this.$report),e?(this.$report.hide(),this._showPassPane()):(this.$passPane.hide(),this._loadQueryForm())},_loadQueryForm:function(){var e=this;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.entry.query_content,this.appId,this.entryId)},function(i){e.form=i,e.filterFields=[],FXM.Utils.forEach(e.form.fields,function(t,i){e.form.filterFields.indexOf(i.name)>-1&&e.filterFields.push(i)}),e.parameter=new FXM.Parameter({render:t("<div/>").appendTo(e.$parameter),allowBlank:!1,fields:e.filterFields,onBeforeConvertField:function(t,e){return"text"===e.type&&(t.type="text",!0)}}),e._showQueryBtn()})},_showQueryBtn:function(){var e=this;this.$queryBtn?this.$queryBtn.show():(this.$queryBtn=t('<button class="x-btn style-green"/>').text("").click(function(){e.parameter.checkValidate()?(e.$parameter.hide(),e.$wrapper.show(),t(this).hide(),e._showResetBtn(),e.table?e.table.reload(!0):e._createTable()):FXM.UI.alert({msg:""})}),this.$queryBtn.appendTo(this.$btnPane))},_showResetBtn:function(){var e=this;this.$resetBtn?this.$resetBtn.show():(this.$resetBtn=t('<button class="x-btn style-green"/>').text("").click(function(){e.$wrapper.hide(),e.$parameter.show(),t(this).hide(),e._showQueryBtn()}),this.$resetBtn.appendTo(this.$btnPane))},_showPassPane:function(){var e=this;t('<div class="tip"/>').text("").appendTo(this.$passPane);var i=new FXM.Password({render:t("<div/>").appendTo(this.$passPane),waterMark:"",allowBlank:!1});i.select();var a=t('<button class="x-btn style-green"/>').text("").click(function(){FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.entry.q_password,FXM.STATIC.QTOKEN),data:{queryPwd:i.getValue()}},function(){e.$passPane.remove(),e.$report.show(),e._loadQueryForm()},function(){FXM.UI.alert({msg:""})})});t('<div class="confirm-btn"/>').append(a).appendTo(this.$passPane)},_createTable:function(){var e=this;this.$table=t('<div class="query-table"/>').appendTo(this.$wrapper),this.table=new FXM.DataTable({render:this.$table,isHeadSticky:!0,forms:[this.entryId],isExternalLink:!0,onDataFilter:function(){return e.parameter.getValue()}}),this._bindScrollEvents()},_bindScrollEvents:function(){var e=this;t(window).scroll(function(){(document.documentElement.scrollTop||document.body.scrollTop)+t(this).height()>e.$report.height()-60&&e.table.loadMore()})}})}(Zepto),function(t){FXM.PG.FORM_VIEW=FXM.PG.FORM_VIEW||{},t.extend(FXM.PG.FORM_VIEW,{init:function(e,i,a,n,r){this.$body=t("body").addClass("page-form-view"),this.appId=a,this.entryId=n,this.extParam=r,this.entryToken=i,this.$form=t(".public-form"),this.$passPane=t(".public-password"),e?this._showPassPane():(this.$passPane.hide(),this._loadForm())},_loadForm:function(){var e=this;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.form.get,this.appId,this.entryId)},function(i){var a=i.entry;FXM.Vip.showUpgradeTip(i.bufferState),FXM.Vip.showDataLimitTip({render:t("<div/>").prependTo(e.$body)}),new FXM.Form(t.extend(a.content,{render:e.$form,appId:e.appId,entryId:e.entryId,submitText:"",title:a.name,extParam:e.extParam,cacheEnable:a.hasCache,updateTime:a.updateTime,navBtns:[{nav:"submit",text:"",onClick:function(){this.doVerifyAndSubmit(function(i){if(e.$form.empty(),i.flowFailureCode)e._showFlowFailInfo(i.flowFailureCode);else{var a,n=t('<div class="success-info"/>').appendTo(e.$form);i&&i.data&&(a=i.data.submitPrompt),a&&"custom"===a.mode?n.addClass("custom-info x-subhtml").html(a.content):t('<div class="data-create-success-icon"></div><div class="msg-title"></div>').appendTo(n),(!a||a&&("custom"===a.mode&&a.hasAddBtn||"system"===a.mode))&&t('<div class="reload-btn x-btn style-blue"></div>').on("click",function(){e.$form.empty(),e.init(!1,e.entryToken,e.appId,e.entryId,e.extParam)}).appendTo(n)}})}}]}))})},_showFlowFailInfo:function(e){var i="",a=FXM.CONSTS.FLOW_FAIL_CODE;e===a.FORWARD_CHARGER?i+="":e===a.FORWARD_COND&&(i+=""),t('<div class="fail-content"><div class="fail-icon"><i class="icon-sad-face"/></div><div class="fail-title"></div><div class="fail-detail">'+i+'</div><div class="fail-detail">!</div></div>').appendTo(this.$form.addClass("flow-fail"))},_showPassPane:function(){var e=this;t('<div class="tip"/>').text("").appendTo(this.$passPane);var i=new FXM.Password({render:t("<div/>").appendTo(this.$passPane),waterMark:"",allowBlank:!1});i.select();var a=t('<button class="x-btn style-green"/>').text("").click(function(){FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.entry.f_password,FXM.STATIC.FTOKEN),data:{publicPwd:i.getValue()}},function(){e.$passPane.remove(),e._loadForm()},function(){FXM.UI.alert({msg:""})})});t('<div class="confirm-btn"/>').append(a).appendTo(this.$passPane)}})}(Zepto),FXM.PG.REPORT=function(t,e){FXM.UI.showLoader(),FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.report.get,t,e)},function(i,a){if(!FXM.Router.isPathChanged()){FXM.Router.clearPage(),$("body").addClass("page-report");var n=i.entry;if(!n.content||FXM.Utils.isObjectEmpty(n.content.items))return FXM.Utils.setPageTitle(n.name),void $("body > .x-page").html('<div class="empty-info"><div class="empty-img"></div><div class="empty-title"></div></div>');new FXM.Report($.extend(n.content||{},{render:$("<div/>").appendTo("body > .x-page"),title:n.name,entryId:e})),FXM.STATIC.ALLOW_APP_INSTALL&&new FXM.AppInstallBtn({forkId:t})}},function(t){if(!FXM.Router.isPathChanged()){if(3009!==FXM.Utils.parseJSON(t.responseText).code)return!1;$("body > .x-page").html('<div class="empty-info"><div class="empty-entry"></div><div class="empty-title"></div><div><span class="empty-msg"></span></div></div>')}},function(t){FXM.UI.closeLoader()})},function(t){FXM.PG.REPORT_VIEW=FXM.PG.REPORT_VIEW||{},t.extend(FXM.PG.REPORT_VIEW,{init:function(e,i,a,n){this.$body=t("body").addClass("page-report-view"),this.appId=a,this.entryId=n,this.$report=t(".public-report"),this.$passPane=t(".public-password"),e?this._showPassPane():(this.$passPane.hide(),this._loadReport())},_loadReport:function(){var e=this;FXM.Utils.dataAjax({url:FXM.Utils.getApi(FXM.API.report.get,this.appId,this.entryId)},function(i){FXM.Vip.showUpgradeTip(i.bufferState);var a=i.entry;new FXM.Report(t.extend(a.content,{render:e.$report,title:a.name}))})},_showPassPane:function(){var e=this;t('<div class="tip"/>').text("").appendTo(this.$passPane);var i=new FXM.Password({render:t("<div/>").appendTo(this.$passPane),allowBlank:!1});i.select();var a=t('<button class="x-btn style-green"/>').text("").click(function(){FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.entry.r_password,FXM.STATIC.RTOKEN),data:{publicPwd:i.getValue()}},function(){e.$passPane.remove(),e._loadReport()},function(){FXM.UI.alert({msg:""})})});t('<div class="confirm-btn"/>').append(a).appendTo(this.$passPane)}})}(Zepto),function(t){FXM.SignaturePadPage=FXM.SignaturePadPage||{},t.extend(FXM.SignaturePadPage,{init:function(e){var i=t(".signature-pad-page");new FXM.SignaturePad({render:t("<div/>").appendTo(i),text4Cancel:null,onOk:function(){var a=this.getFileObj();FXM.Utils.uploadFile({appId:e.appId,entryId:e.entryId,uploadToken:e.uploadToken,uploader:e.uploader,signatureToken:e.signatureToken,signatureKey:e.signatureKey,uploadToForm:!0,fileName:a.fileName},a.file,null,function(){t('<div class="success-pane"><div class="success-icon"/><div class="success-tip"></div></div>').appendTo(i.empty())})}})}})}(Zepto),function(t){FXM.PG.TEMPLATE=function(){FXM.Router.clearPage(),t("body").addClass("page-template");var e=t('<div class="template"/>').appendTo(t("body > .x-page"));i="list",a(e),r(e,"quick_start")};var e=FXM.CONSTS.APP_CATE_MAP,i="list",a=function(a){var n,o=t('<div class="template-header"/>').appendTo(a),l=t('<div class="header-search"><div class="search-wrapper"/></div>').appendTo(o),c=t('<input placeholder=""/>').on({focus:function(){l.addClass("search-focus")},blur:function(){n&&clearTimeout(n),n=setTimeout(function(){"search"!==i&&l.removeClass("search-focus")},50)}}).appendTo(".search-wrapper",l);t('<div class="search-btn-group"><div class="btn-item blue" role="search"></div><div class="btn-item" role="cancel"></div></div>').on("click",function(e){var n=t(e.target).closest(".btn-item");if(n&&n.length)switch(n.attr("role")){case"search":var r=c.val().trim();FXM.Utils.isEmpty(r)||(i="search",a.addClass("mode-search"),s(a,r));break;case"cancel":i="list",l.removeClass("search-focus"),a.removeClass("mode-search")}}).appendTo(l);var h=t('<div class="header-menu"/>').on("click",function(e){var i=t(e.target).closest(".menu-item");i&&i.length&&!i.hasClass("active")&&(t(".menu-item.active",h).removeClass("active"),i.addClass("active"),r(a,i.data("menu")))}).appendTo(o);FXM.Utils.forEach(e,function(e,i){t('<div class="menu-item"/>').text(FXM.CONSTS.APP_CATE_NAME[e]).data("menu",e).appendTo(h)}),t(".menu-item",h).eq(0).addClass("active")},n=function(t){return e[t]&&e[t].length>1},r=function(i,a){t(".template-list-wrapper",i).remove();var r=t('<div class="template-list-wrapper"/>').appendTo(i);n(a)?(FXM.Utils.forEach(e[a],function(e,i){var a=t('<div class="template-line"/>').appendTo(r);t('<div class="line-label"><div class="label-left">'+FXM.CONSTS.APP_CATE_NAME[i]+'</div><div class="label-right btn-more"></div></div>').on("click",function(e){var a=t(e.target).closest(".btn-more");a&&a.length&&FXM.Router.redirectTo("/template/list/"+i)}).appendTo(a);var n=t('<div class="template-list"/>').appendTo(a);o({layout:"landscape",render:t("<div/>").appendTo(n),perPage:5,renderEmpty:!1},{category:i})}),t('<a class="survey-link"/>').text("").attr("href",FXM.CONSTS.TEMPLATE_SURVEY_URL).appendTo(r)):o({render:t("<div/>").appendTo(r)},{category:a})},s=function(e,i){t(".template-search-wrapper",e).remove();var a=t('<div class="template-search-wrapper"/>').appendTo(e);o({render:t("<div/>").appendTo(a),emptyTip:""},{keywords:i})},o=function(e,i){return new FXM.TemplateList(t.extend({async:{url:FXM.Utils.getApi(FXM.API.dashboard.template_list),data:i},onItemClick:function(t){FXM.STATIC.CACHED_APPMENU=null,FXM.Utils.dt(FXM.CONSTS.TRACKER.APP_VIEW_FROM_MOBILE),window.location.href="/template/"+t._id}},e))}}(Zepto),function(t){FXM.PG.TEMPLATE_LIST=function(e){FXM.Router.clearPage(),t("body").addClass("page-template-list");var i=t('<div class="template"/>').appendTo(t("body > .x-page"));t('<div class="template-label"/>').text(FXM.CONSTS.APP_CATE_NAME[e]).appendTo(i),new FXM.TemplateList({render:t('<div class="template-content"/>').appendTo(i),async:{url:FXM.Utils.getApi(FXM.API.dashboard.template_list),data:{category:e}},emptyTip:"",onItemClick:function(t){FXM.STATIC.CACHED_APPMENU=null,FXM.Utils.dt(FXM.CONSTS.TRACKER.APP_VIEW_FROM_MOBILE),window.location.href="/template/"+t._id}})}}(Zepto),function(t){FXM.PG.WELCOME=function(i){var a=[{title:"",info:"",page:"jdy"},{title:"",info:"",page:"app"},{title:"",info:"",page:"form"},{title:"",info:"",page:"data"}];switch(i){case"dduser":FXM.Router.clearPage(),t("body").addClass("pg-user-empty"),t("body > .x-page").html('<div class="empty-info"><div class="empty-user-img"></div><div class="empty-user-title"></div><div class="empty-user-title-list"></div></div>');break;case"ddadmin":a.splice(1,0,{title:"",info:"oa.dingtalk.com",page:"dd"}),e(a);break;case"guide":a.splice(1,0,{title:"",info:"(www.jiandaoyun.com)",page:"pc"}),a[3].info="",e(a);break;case"wxadmin":a.splice(1,0,{title:"",info:"",page:"wx"}),a[3].info="",e(a)}};var e=function(e){t("body").addClass("page-welcome");var i=0,a=0,n=0,r=0,s=t('<div class="welcome-wrapper"/>').on({touchstart:function(t){var e=t.touches[0];i=e.pageX},touchend:function(t){var s=t.changedTouches[0];if(r=s.pageX-i,0===a&&r>0)return t.preventDefault(),!1;if(a===e.length-1&&r<0)return t.preventDefault(),!1;Math.abs(r)>.18*h&&(r>0?a--:a++),f.eq(a).addClass("active").siblings().removeClass("active"),n=-a*h;var l="translate3d(-"+100*a+"%,0,0)";o.css(FXM.Utils.formatTransform(l))}}).appendTo("body > .x-page"),o=t('<div class="wrapper-body"/>').appendTo(s),l=t('<div class="wrapper-main"/>').appendTo(o);e.map(function(i,a){var n=t('<div class="main-item '+i.page+'"><div class="content"><div class="title">'+i.title+'</div><div class="info">'+i.info+"</div></div></div>").css("left",100*a+"%").appendTo(l);a===e.length-1&&t('<div class="btn-group"><div class="btn style-fill template" ></div><div class="btn style-empty dashboard" ></div></div>').on("click",function(e){var i=t(e.target);return i.closest(".template").length?(FXM.Router.redirectTo("/template/list"),!1):i.closest(".dashboard").length?(s.remove(),t("body").removeClass("pg_welcome"),!1):void 0}).appendTo(n)});for(var c=100/e.length,h=l.outerWidth(!0)*(.01*c),u=t('<div class="wrapper-footer"/>').appendTo(s),d=0;d<e.length;d++){var p=t('<div class="footer-angle"><div class="angle"></div></div>').appendTo(u);d===a&&p.addClass("active")}var f=t(".footer-angle",u);t('<div class="wrapper-close-btn" ></div>').on("click",function(){s.remove(),t("body").removeClass("pg_welcome")}).appendTo(s)}}(Zepto),function(t){FXM.CORP=FXM.CORP||{},t.extend(FXM.CORP,{init:function(t,e){var i=this;window.dd?FXM.GB.user?(e&&e(),this.config(t,function(){FXM.UI.disableBounce()})):this.config(t,function(){i.auth(t.corpId,function(t){e&&e(t)}),FXM.UI.disableBounce()}):(e&&e(),this.config(t,function(){FXM.UI.disableBounce()}))},config:function(t,e,i){this.CONFIG=t,window.wx?(this.WX=window.wx,this.WX.config(t),this.WX.ready(function(){e&&e()}),this.WX.error(function(t){i&&i()})):window.dd&&(this.DD=window.dd,this.DD.config(t),this.DD.ready(function(){e&&e()}))},auth:function(e,i){if(this.WX)i();else if(this.DD){var a;a=/\/suite\/accept_login/.test(window.location.href)?window.location.href:FXM.Utils.getUrlParameter("redirect_uri"),this.DD.runtime.permission.requestAuthCode({corpId:e,onSuccess:function(n){FXM.Utils.ajax({url:FXM.Utils.getApi(FXM.API.corp.dingtalk_login,e),data:{code:n.code}},function(e){a?window.location.href=decodeURIComponent(a):(e.user&&t.extend(FXM.GB,e,{isCorpUser:!0}),i())},function(t){var e=FXM.Utils.parseJSON(t.responseText);i(e)})},onFail:function(t){FXM.Utils.dt(FXM.CONSTS.TRACKER.DD_AUTH_FAIL,JSON.stringify(t))}})}}})}(Zepto),function(t){var e=function(t,e){FXM.STATIC.APPID=t,FXM.STATIC.ENTRYID=e||null,FXM.STATIC.DATAID=null,FXM.FORMCACHE=null},i={"/":FXM.PG.DASHBOARD,"/app/:appid":{on:[e,FXM.PG.APPLICATION],after:function(){var e=t(".page-application > .x-page");e&&e.length&&(FXM.STATIC.SCROLL_TOP=t(".page-application > .x-page").scrollTop())}},"/app/:appid/report/:reportid":[e,FXM.PG.REPORT],"/app/:appid/dash/:dashid":[e,FXM.PG.DASH],"/app/:appid/form/:formid":{on:[e,FXM.PG.FORM],after:function(){FXM.FORMCACHE&&(FXM.FORMCACHE.saveFormData(),FXM.FORMCACHE=null)}},"/app/:appid/form/:formid/stash":[e,FXM.PG.FLOWSTASH],"/app/:appid/datacreate/:formid/:groupid":{on:[e,FXM.PG.DATACREATE],after:function(){FXM.FORMCACHE&&(FXM.FORMCACHE.saveFormData(),FXM.FORMCACHE=null)}},"/app/:appid/flow":[e,FXM.PG.FLOW],"/app/:appid/form/:formid/data/:dataid/flow/:flowid/:listType/:source":[e,FXM.PG.FLOWFORMDATA],"/flowcenter/:flowtype":[FXM.PG.FLOWCENTER],"/template/list":[FXM.PG.TEMPLATE],"/template/list/:cate":[FXM.PG.TEMPLATE_LIST]},a=Router(i);a.configure({before:function(){FXM.CORP.WX&&FXM.CORP.config(FXM.CORP.CONFIG,function(){}),FXM.Router.setCurrentPath(),FXM.Router.clearPage(),t(window).unbind("scroll")},notfound:function(){FXM.Router.initNull()}}),FXM.Router={initialized:!1,currentPath:null,clearPage:function(){t("body > div").remove(),t("body").removeClass().prepend('<div class="x-page"/>')},isPathChanged:function(){return this.currentPath!==this.getPath()},setCurrentPath:function(){this.currentPath=this.getPath()},init:function(t){this.initialized||(this.initialized=!0,FXM.Utils.isNull(t)?(a.init(),FXM.Router.initNull()):a.init(t))},initNull:function(){FXM.Utils.isEmpty(this.getPath())&&(FXM.Router.setCurrentPath(),FXM.Router.clearPage(),FXM.PG.DASHBOARD())},redirectTo:function(t){a.setRoute(t)},getPath:function(){return(a.getRoute()||[]).join("/")},back:function(t){a.back(t)},reload:function(){a.reload()}}}(Zepto),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.SignaturePad=e()}(this,function(){"use strict";function t(t,e,i){this.x=t,this.y=e,this.time=i||(new Date).getTime()}function e(t,e,i,a){this.startPoint=t,this.control1=e,this.control2=i,this.endPoint=a}function i(t,e,i){var a,n,r,s=null,o=0;i||(i={});var l=function(){o=!1===i.leading?0:Date.now(),s=null,r=t.apply(a,n),s||(a=n=null)};return function(){var c=Date.now();o||!1!==i.leading||(o=c);var h=e-(c-o);return a=this,n=arguments,h<=0||h>e?(s&&(clearTimeout(s),s=null),o=c,r=t.apply(a,n),s||(a=n=null)):s||!1===i.trailing||(s=setTimeout(l,h)),r}}function a(t,e){var n=this,r=e||{};this.velocityFilterWeight=r.velocityFilterWeight||.7,this.minWidth=r.minWidth||.5,this.maxWidth=r.maxWidth||2.5,this.throttle="throttle"in r?r.throttle:16,this.minDistance="minDistance"in r?r.minDistance:5,this.throttle?this._strokeMoveUpdate=i(a.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=a.prototype._strokeUpdate,this.dotSize=r.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=r.penColor||"black",this.backgroundColor=r.backgroundColor||"rgba(0,0,0,0)",this.onBegin=r.onBegin,this.onEnd=r.onEnd,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(t){1===t.which&&(n._mouseButtonDown=!0,n._strokeBegin(t))},this._handleMouseMove=function(t){n._mouseButtonDown&&n._strokeMoveUpdate(t)},this._handleMouseUp=function(t){1===t.which&&n._mouseButtonDown&&(n._mouseButtonDown=!1,n._strokeEnd(t))},this._handleTouchStart=function(t){if(1===t.targetTouches.length){var e=t.changedTouches[0];n._strokeBegin(e)}},this._handleTouchMove=function(t){t.preventDefault();var e=t.targetTouches[0];n._strokeMoveUpdate(e)},this._handleTouchEnd=function(t){t.target===n._canvas&&(t.preventDefault(),n._strokeEnd(t))},this.on()}return t.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1},t.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time},e.prototype.length=function(){for(var t=0,e=void 0,i=void 0,a=0;a<=10;a+=1){var n=a/10,r=this._point(n,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),s=this._point(n,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(a>0){var o=r-e,l=s-i;t+=Math.sqrt(o*o+l*l)}e=r,i=s}return t},e.prototype._point=function(t,e,i,a,n){return e*(1-t)*(1-t)*(1-t)+3*i*(1-t)*(1-t)*t+3*a*(1-t)*t*t+n*t*t*t},a.prototype.clear=function(){var t=this._ctx,e=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._data=[],this._reset(),this._isEmpty=!0},a.prototype.fromDataURL=function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new Image,n=i.ratio||window.devicePixelRatio||1,r=i.width||this._canvas.width/n,s=i.height||this._canvas.height/n;this._reset(),a.src=t,a.onload=function(){e._ctx.drawImage(a,0,0,r,s)},this._isEmpty=!1},a.prototype.toDataURL=function(t){var e;switch(t){case"image/svg+xml":return this._toSVG();default:for(var i=arguments.length,a=Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return(e=this._canvas).toDataURL.apply(e,[t].concat(a))}},a.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},a.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},a.prototype.isEmpty=function(){return this._isEmpty},a.prototype._strokeBegin=function(t){this._data.push([]),this._reset(),this._strokeUpdate(t),"function"==typeof this.onBegin&&this.onBegin(t)},a.prototype._strokeUpdate=function(t){var e=t.clientX,i=t.clientY,a=this._createPoint(e,i),n=this._data[this._data.length-1],r=n&&n[n.length-1],s=r&&a.distanceTo(r)<this.minDistance;if(!r||!s){var o=this._addPoint(a),l=o.curve,c=o.widths;l&&c&&this._drawCurve(l,c.start,c.end),this._data[this._data.length-1].push({x:a.x,y:a.y,time:a.time,color:this.penColor})}},a.prototype._strokeEnd=function(t){var e=this.points.length>2,i=this.points[0];if(!e&&i&&this._drawDot(i),i){var a=this._data[this._data.length-1],n=a[a.length-1];i.equals(n)||a.push({x:i.x,y:i.y,time:i.time,color:this.penColor})}"function"==typeof this.onEnd&&this.onEnd(t)},a.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},a.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},a.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},a.prototype._createPoint=function(e,i,a){var n=this._canvas.getBoundingClientRect();return new t(e-n.left,i-n.top,a||(new Date).getTime())},a.prototype._addPoint=function(t){var i=this.points,a=void 0;if(i.push(t),i.length>2){3===i.length&&i.unshift(i[0]);var n=(a=this._calculateCurveControlPoints(i[0],i[1],i[2])).c2,r=(a=this._calculateCurveControlPoints(i[1],i[2],i[3])).c1,s=new e(i[1],n,r,i[2]),o=this._calculateCurveWidths(s);return i.shift(),{curve:s,widths:o}}return{}},a.prototype._calculateCurveControlPoints=function(e,i,a){var n=e.x-i.x,r=e.y-i.y,s=i.x-a.x,o=i.y-a.y,l={x:(e.x+i.x)/2,y:(e.y+i.y)/2},c={x:(i.x+a.x)/2,y:(i.y+a.y)/2},h=Math.sqrt(n*n+r*r),u=Math.sqrt(s*s+o*o),d=l.x-c.x,p=l.y-c.y,f=u/(h+u),m={x:c.x+d*f,y:c.y+p*f},g=i.x-m.x,v=i.y-m.y;return{c1:new t(l.x+g,l.y+v),c2:new t(c.x+g,c.y+v)}},a.prototype._calculateCurveWidths=function(t){var e=t.startPoint,i=t.endPoint,a={start:null,end:null},n=this.velocityFilterWeight*i.velocityFrom(e)+(1-this.velocityFilterWeight)*this._lastVelocity,r=this._strokeWidth(n);return a.start=this._lastWidth,a.end=r,this._lastVelocity=n,this._lastWidth=r,a},a.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)},a.prototype._drawPoint=function(t,e,i){var a=this._ctx;a.moveTo(t,e),a.arc(t,e,i,0,2*Math.PI,!1),this._isEmpty=!1},a.prototype._drawCurve=function(t,e,i){var a=this._ctx,n=i-e,r=Math.floor(t.length());a.beginPath();for(var s=0;s<r;s+=1){var o=s/r,l=o*o,c=l*o,h=1-o,u=h*h,d=u*h,p=d*t.startPoint.x;p+=3*u*o*t.control1.x,p+=3*h*l*t.control2.x,p+=c*t.endPoint.x;var f=d*t.startPoint.y;f+=3*u*o*t.control1.y,f+=3*h*l*t.control2.y,f+=c*t.endPoint.y;var m=e+c*n;this._drawPoint(p,f,m)}a.closePath(),a.fill()},a.prototype._drawDot=function(t){var e=this._ctx,i="function"==typeof this.dotSize?this.dotSize():this.dotSize;e.beginPath(),this._drawPoint(t.x,t.y,i),e.closePath(),e.fill()},a.prototype._fromData=function(e,i,a){for(var n=0;n<e.length;n+=1){var r=e[n];if(r.length>1)for(var s=0;s<r.length;s+=1){var o=r[s],l=new t(o.x,o.y,o.time),c=o.color;if(0===s)this.penColor=c,this._reset(),this._addPoint(l);else if(s!==r.length-1){var h=this._addPoint(l),u=h.curve,d=h.widths;u&&d&&i(u,d,c)}}else this._reset(),a(r[0])}},a.prototype._toSVG=function(){var t=this,e=this._data,i=this._canvas,a=Math.max(window.devicePixelRatio||1,1),n=i.width/a,r=i.height/a,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttributeNS(null,"width",i.width),s.setAttributeNS(null,"height",i.height),this._fromData(e,function(t,e,i){var a=document.createElement("path");if(!(isNaN(t.control1.x)||isNaN(t.control1.y)||isNaN(t.control2.x)||isNaN(t.control2.y))){var n="M "+t.startPoint.x.toFixed(3)+","+t.startPoint.y.toFixed(3)+" C "+t.control1.x.toFixed(3)+","+t.control1.y.toFixed(3)+" "+t.control2.x.toFixed(3)+","+t.control2.y.toFixed(3)+" "+t.endPoint.x.toFixed(3)+","+t.endPoint.y.toFixed(3);a.setAttribute("d",n),a.setAttribute("stroke-width",(2.25*e.end).toFixed(3)),a.setAttribute("stroke",i),a.setAttribute("fill","none"),a.setAttribute("stroke-linecap","round"),s.appendChild(a)}},function(e){var i=document.createElement("circle"),a="function"==typeof t.dotSize?t.dotSize():t.dotSize;i.setAttribute("r",a),i.setAttribute("cx",e.x),i.setAttribute("cy",e.y),i.setAttribute("fill",e.color),s.appendChild(i)});var o='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 '+n+" "+r+'" width="'+n+'" height="'+r+'">',l=s.innerHTML;if(void 0===l){var c=document.createElement("dummy"),h=s.childNodes;c.innerHTML="";for(var u=0;u<h.length;u+=1)c.appendChild(h[u].cloneNode(!0));l=c.innerHTML}var d=o+l+"</svg>";return"data:image/svg+xml;base64,"+btoa(d)},a.prototype.fromData=function(t){var e=this;this.clear(),this._fromData(t,function(t,i){return e._drawCurve(t,i.start,i.end)},function(t){return e._drawDot(t)}),this._data=t},a.prototype.toData=function(){return this._data},a});