!function(e){window.FX=window.FX||{},FX.API=FX.API||{},e.extend(FX.API,{sign:{get_email:"/auth/email/get",get_phone:"/auth/phone/get",captcha_valid:"/auth/captcha/valid",unbind:"/auth/:value/unbind",password_forget:"/password/forget",password_reset:"/password/reset",register:"/register",signin:"/signin"},profile:{acquire_coupon:"/profile/acquire_coupon",apply:"/profile/affiliate/apply",apply_cash:"/profile/affiliate/apply_cash",get_income:"/profile/affiliate/get_income",list_apps:"/profile/affiliate/list_apps",list_asset:"/profile/affiliate/list_asset",list_joined_member:"/profile/affiliate/list_joined_member",list_paid_member:"/profile/affiliate/list_paid_member",user_verify:"/profile/affiliate/user_verify",user_verify_read:"/profile/affiliate/user_verify/read",user_verify_update:"/profile/affiliate/user_verify/update",reset_api_key:"/profile/api_key/reset",remove_api_key:"/profile/api_key/remove",get_api_key:"/profile/api_key/get",check_gift:"/profile/check_gift",corp_verify_check:"/profile/corp_verify/check",corp_verify_submit:"/profile/corp_verify/submit",coupons:"/profile/coupons",me:"/profile/me",check_unpaid:"/profile/order/check_unpaid",default_receipt:"/profile/order/default_receipt",order_list:"/profile/order/list",order_pricing:"/profile/order/pricing",order_receipt:"/profile/order/receipt",order_receipt_list:"/profile/order/receipt/list",order_submit:"/profile/order/submit",order_cancel:"/profile/order/:orderId/cancel",pay_proof_submit:"/profile/order/:orderId/pay_proof/submit",order_remove:"/profile/order/:orderId/remove",persona:"/profile/persona",persona_app_list:"/profile/persona/app_list",start_trail:"/profile/start_trail",update:"/profile/update",unbind:"/profile/unbind/user_info",check_password:"/profile/check_password",vip_center:"/profile/vip_center",vip_item_usage:"/profile/vip_item_usage",order_compare:"/profile/order/compare",account_cancel:"/profile/account_cancel"},sa:{audit_apply:"/sa/affiliate/audit_apply",audit_cash:"/sa/affiliate/audit_cash",block_app:"/sa/affiliate/block_app",list:"/sa/affiliate/dingtalk_apply/list",update:"/sa/affiliate/dingtalk_apply/update",enable_user:"/sa/affiliate/enable_user",get_income:"/sa/affiliate/get_income",list_apply:"/sa/affiliate/list_apply",list_cash:"/sa/affiliate/list_cash",list_joined_member:"/sa/affiliate/list_joined_member",list_paid_member:"/sa/affiliate/list_paid_member",list_public_apps:"/sa/affiliate/list_public_apps",list_user:"/sa/affiliate/list_user",user_verify_list:"/sa/affiliate/user_verify/list",user_verify_update:"/sa/affiliate/user_verify/update",corp_verify_list:"/sa/corp_verify/list",corp_verify_update:"/sa/corp_verify/update",order_list:"/sa/order/list",order_update:"/sa/order/update",receipt_deny:"/sa/receipt/deny",receipt_list:"/sa/receipt/list",receipt_send:"/sa/receipt/send",get_order_user:"/sa/order/get_user",get_order_price:"/sa/order/get_price",get_order_info:"/sa/order/get_info",create_order:"/sa/order/create",update_order_price:"/sa/order/update_price",set_order_receipted:"/sa/order/set_receipted",set_order_collected:"/sa/order/pay_collect",bind_utm_id:"/sa/affiliate/bind_utm_id"},dingtalk:{secret_install:"/dingtalk/corp/secret/install",update:"/dingtalk/corp/ssosecret/update",suite_install:"/dingtalk/corp/suite/install",login:"/dingtalk/corp/:corpId/login"},corp_suite:{get_cron_sync:"/corp/suite/get_cron_sync",set_cron_sync:"/corp/suite/set_cron_sync",unbind:"/corp/suite/unbind",user_sync:"/corp/suite/user_sync",login_check:"/corp/:corpId/suite/login_check"},file:{file_url:"/dashboard/app/:appId/file_url",upload_token:"/dashboard/app/:appId/upload_token",get_token:"/upload/get_token"},app:{get:"/_/app/:appId",create:"/dashboard/app/create",apps:"/dashboard/apps",flow_start:"/dashboard/flow_start",flow_todo:"/dashboard/flow_todo",flow_todo_count:"/dashboard/flow_todo_count",get_config:"/dashboard/get_config",sort_app:"/dashboard/sort_app",switch_corp:"/dashboard/switch_corp",install:"/dashboard/template/install",list:"/dashboard/template/list",user_corps:"/dashboard/user_corps",accept:"/dashboard/app/:appId/accept",get_vip_pack:"/dashboard/app/:appId/get_vip_pack",publish:"/dashboard/app/:appId/publish",publisher:"/dashboard/app/:appId/publisher",refuse:"/dashboard/app/:appId/refuse",data_usage:"/dashboard/app/:appId/data_usage"},flow:{batch_transfer:"/dashboard/app/:appId/workflow/batch_transfer",batch_transfer_tasks:"/dashboard/app/:appId/workflow/batch_transfer_tasks",batch_close:"/data/flow_batch_close",distinct:"/dashboard/app/:appId/workflow/distinct",get_node_fields:"/dashboard/app/:appId/workflow/get_node_fields",query_data:"/dashboard/app/:appId/workflow/query_data",query_data_count:"/dashboard/app/:appId/workflow/query_data_count",query_menu:"/dashboard/app/:appId/workflow/query_menu",query_node:"/dashboard/app/:appId/workflow/query_node",stash_data_count:"/dashboard/app/:appId/workflow/stash_data_count"},entry:{get_submit_prompt:"/dashboard/app/:appId/entry/:entryId/get_submit_prompt",set_submit_prompt:"/dashboard/app/:appId/entry/:entryId/set_submit_prompt",edit:"/dashboard/app/:appId/form/:formId/edit",query_content:"/dashboard/app/:appId/form/:formId/query_content",qr_link:"/dashboard/app/:appId/form/:formId/data/:dataId/qr_link",f:"/f/:formId/password",q:"/q/:formId/password",r:"/r/:reportId/password",dash:"/dash/:dashId/password"},data:{batch_qr:"/data/batch_qr",batch_update:"/data/batch_update",batch_update_tasks:"/data/batch_update_tasks",chart_group:"/data/chart_group",combined_group:"/data/combined_group",excel_export:"/data/combined_group/excel_export",create:"/data/create",distinct:"/data/distinct",filter_link:"/data/filter_link",find:"/data/find",count:"/data/count",find_excel_export:"/data/find/excel_export",hard_remove:"/data/hard_remove",link:"/data/link",list:"/data/list",query:"/_/data/public_query",list_excel_export:"/data/list/excel_export",excel_template:"/data/list/excel_template",coop_comment_create:"/data/log/coop_comment/create",coop_comment_list:"/data/log/coop_comment/list",coop_log_list:"/data/log/coop_log/list",log_flow:"/data/log/flow_log/list",current_departments:"/data/member/current_departments",departments:"/data/member/departments",user_dept_role:"/data/member/dept_role_users",users:"/data/member/users",roles:"/data/member/roles",print:"/data/print",read:"/data/read",view:"/data/view",read_link:"/data/read_link",recover:"/data/recover",remove:"/data/remove",update:"/_/data/update",flow_change:"/data/flow_change",flow_creators:"/data/flow_creators",transfer_list:"/data/log/flow_transfer/list",flow_comment_list:"/data/log/flow_comment/list",allow_activate_nodes:"/_/data/allow_activate_nodes",allow_back_nodes:"/_/data/allow_back_nodes",allow_transfer_users:"/_/data/allow_transfer_users",flow_chargers:"/_/data/flow_chargers",signature:" /_/data/signature/get_qr_link",admin_signature:"/_/admin/data/signature/get_qr_link"},formula:{aggregate:"/data/formula/aggregate",map:"/data/formula/map",recno:"/data/formula/recno"},manager:{create:"/manager/team/create",delete:"/manager/team/:corpId/delete"},excel:{get_sample:"/dashboard/app/:appId/excel/get_sample",import:"/dashboard/app/:appId/excel/import",check_data:"/dashboard/app/:appId/excel/check_data",match_head:"/dashboard/app/:appId/excel/match_head",upload:"/dashboard/app/:appId/excel/upload"},message:{list:"/manager/message/list",set_read:"/manager/message/set_read",unread:"/manager/message/unread",notice:"/manager/message/notice"},corp:{contact_create:"/corp/contact/create",contact_list:"/corp/contact/list",contact_remove:"/corp/contact/remove",contact_update:"/corp/contact/:contactId/update",department_edit:"/corp/department/:departmentId/edit",department_list_member:"/corp/department/:departmentId/list_member",department_remove:"/corp/department/:departmentId/remove",department_create:"/corp/department/create",department_list:"/corp/department/list",get_manager:"/corp/department/manager/get",set_manager:"/corp/department/manager/set",list_dimission_member:"/corp/list_dimission_member",list_member_name:"/corp/list_member_name",group_remove:"/corp/manage/group/remove",group_update:"/corp/manage/group/update",group_list:"/corp/manage/group_list",get_config:"/corp/manage/group/:groupId/get_config",invite:"/corp/member/invite",invite_link_get:"/corp/member/invite_link/get",invite_link_set:"/corp/member/invite_link/set",invite_list:"/corp/member/invite_list",set_dept:"/corp/member/set_dept",member_list_department:"/corp/member/:memberId/list_department",role_list:"/corp/role/list",role_update:"/corp/role/update",role_list_member:"/corp/role/:roleId/list_member",role_remove:"/corp/role/:roleId/remove",set_member:"/corp/role/:roleId/set_member"},bbs:{topics:"/bbs/topics",create:"/bbs/topic/create",reply_remove:"/bbs/topic/reply/:replyId/remove",topicId:"/bbs/topic/:topicId",remove:"/bbs/topic/:topicId/remove",reply_create:"/bbs/topic/:topicId/reply/create",update:"/bbs/topic/:topicId/update"},form:{get:"/_/app/:appId/form/:formId"},report:{get:"/_/app/:appId/report/:reportId"},dash:{get:"/_/app/:appId/dash/:entryId",combined_group:"/_/data/report/combined_group",list:"/_/data/report/list",excel_export:"/_/data/report/combined_group/excel_export",list_excel_export:"/_/data/report/list/excel_export",distinct:"/_/data/distinct",check_formula:"/_/admin/app/:appid/dash/:dashid/check_formula",current_departments:"/_/data/member/current_departments",departments:"/_/data/member/departments"}}),FX._API=FX._API||{},e.extend(FX._API,{app:{get:"/_/admin/app/:appId",update:"/_/admin/app/:appId/update",remove:"/_/admin/app/:appId/remove",copy:"/_/admin/app/:appId/copy",get_config:"/_/admin/app/:appId/get_config",set_app_public:"/_/admin/app/:appId/set_app_public",ref_apps:"/_/admin/app/:appId/ref_apps",ref_app_forms:"/_/admin/app/:appId/ref_app_forms",get_ref:"/_/admin/app/:appId/get_ref",set_ref:"/_/admin/app/:appId/set_ref",get_entry_auth:"/_/admin/app/:appId/entry_auth/get",set_entry_auth:"/_/admin/app/:appId/entry_auth/set",set_data_auth:"/_/admin/app/:appId/data_auth/set",get_data_auth:"/_/admin/app/:appId/member/:memberId/data_auth/get",list_aggregate:"/_/admin/app/:appId/list_aggregate",get_fields:"/_/admin/app/:appId/fields/get",get_form_fields:" /_/admin/app/:appId/get_form_fields",entry_sort:"/_/admin/app/:appId/entry/sort",data_source:"/_/admin/app/:appId/get_data_source",item_usage:"/_/admin/app/:appId/check_item_usage",trigger:{list:"/_/admin/app/:appId/list_trigger",get_config:"/_/admin/app/:appId/trigger/:triggerId/get_config",create:"/_/admin/app/:appId/trigger/create",update:"/_/admin/app/:appId/trigger/:triggerId/update",remove:"/_/admin/app/:appId/trigger/:triggerId/remove",check:"/_/admin/app/:appId/check_trigger",logs:"/_/admin/app/:appId/trigger/:triggerId/logs",operators:"/_/admin/app/:appId/trigger/:triggerId/log_operators"}},entry:{rename:"/_/admin/app/:appId/entry/:entryId/rename"},dash:{edit:"/_/admin/app/:appId/dash/:entryId/edit",create:"/_/admin/app/:appId/dash/create",update:"/_/admin/app/:appId/dash/:entryId/update",remove:"/_/admin/app/:appId/dash/:entryId/remove",copy:"/_/admin/app/:appId/dash/:entryId/copy",widget_create:"/_/admin/app/:appId/dash/:entryId/widget/create",widget_update:"/_/admin/app/:appId/dash/:entryId/widget/:widgetId/update",widget_remove:"/_/admin/app/:appId/dash/:entryId/widget/:widgetId/remove",preview_list:"/_/admin/data/report/preview/list",preview_combined_group:"/_/admin/data/report/preview/combined_group"},form:{create:"/_/admin/app/:appId/form/create",edit:"/_/admin/app/:appId/form/:entryId/edit",update:"/_/admin/app/:appId/form/:entryId/update",remove:"/_/admin/app/:appId/form/:entryId/remove",copy:"/_/admin/app/:appId/form/:entryId/copy",cross_app_copy:"/_/admin/app/:appId/form/:formid/cross_app_copy",data_usage:"/_/admin/app/:appId/form/:entryId/data_usage",ext_param:{add:"/_/admin/app/:appId/form/:formId/ext_param/add",remove:"/_/admin/app/:appId/form/:formId/ext_param/remove"},auth_group:{list:"/_/admin/app/:appId/form/:formId/auth_group/list",get_config:"/_/admin/app/:appId/form/:formId/auth_group/:groupId/get_config",list_name:"/_/admin/app/:appId/form/:formId/auth_group/list_name",update:"/_/admin/app/:appId/form/:formId/auth_group/update",remove:"/_/admin/app/:appId/form/:formId/auth_group/remove",pt_update:"/_/admin/app/:appId/form/:formId/auth_group/pt_update"},workflow:{get:"/_/admin/app/:appId/form/:formId/workflows",update:"/_/admin/app/:appId/form/:formId/workflow/update",remove:"/_/admin/app/:appId/form/:formId/workflow/remove",create:"/_/admin/app/:appId/form/:formId/workflow/create",config_version:"/_/admin/app/:appId/form/:formId/workflow/config_version"},print_tmp:{list:"/_/admin/app/:appId/form/:formId/pt/list",create:"/_/admin/app/:appId/form/:formId/pt/create",activate:"/_/admin/app/:appId/form/:formId/pt/activate",fields:"/_/admin/app/:appId/form/:formId/pt/fields",get:"/_/admin/app/:appId/form/:formId/pt/:printId/get",update:"/_/admin/app/:appId/form/:formId/pt/:printId/update",remove:"/_/admin/app/:appId/form/:formId/pt/:printId/remove",get_apply_node:"/_/admin/app/:appId/form/:formId/pt/:printId/get_apply_node",set_apply_node:"/_/admin/app/:appId/form/:formId/pt/:printId/set_apply_node"},notify:{create:"/_/admin/app/:appId/form/:formId/notify/create",update:"/_/admin/app/:appId/form/:formId/notify/:notifyId/update",remove:"/_/admin/app/:appId/form/:formId/notify/:notifyId/remove",list:"/_/admin/app/:appId/form/:formId/notify/list"},web_hook:{create:"/_/admin/app/:appId/entry/:entryId/webhook/create",list:"/_/admin/app/:appId/entry/:entryId/webhook/list",test:"/_/admin/app/:appId/entry/:entryId/webhook/test",update:"/_/admin/app/:appId/entry/:entryId/webhook/:webhookId/update",remove:"/_/admin/app/:appId/entry/:entryId/webhook/:webhookId/remove"},data_label:{get:"/_/admin/app/:appId/entry/:entryId/get_data_label",set:"/_/admin/app/:appId/entry/:entryId/set_data_label"},qr_print:{get:"/_/admin/app/:appId/entry/:entryId/get_qr_style",set:"/_/admin/app/:appId/entry/:entryId/set_qr_style"},file_task:{remove:"/_/admin/app/:appId/filetask/:taskId/delete",zip:"/_/admin/app/:appId/form/:formId/filetask/mkzip",list:"/_/admin/app/:appId/form/:formId/filetask/list"}},report:{create:"/_/admin/app/:appId/report/create",edit:"/_/admin/app/:appId/report/:entryId/edit",update:"/_/admin/app/:appId/report/:entryId/update",remove:"/_/admin/app/:appId/report/:entryId/remove",copy:"/_/admin/app/:appId/report/:entryId/copy",preview_list:"/_/admin/data/preview/list",preview_combined_group:"/_/admin/data/preview/combined_group",preview_chart_group:"/_/admin/data/preview/chart_group"},aggregate_table:{create:"/_/admin/app/:appId/aggregate_table/create",edit:"/_/admin/app/:appId/aggregate_table/:entryId/edit",update:"/_/admin/app/:appId/aggregate_table/:entryId/update",remove:"/_/admin/app/:appId/aggregate_table/:entryId/remove"},group:{create:"/_/admin/app/:appId/group/create",update:"/_/admin/app/:appId/group/:entryId/update",remove:"/_/admin/app/:appId/group/:entryId/remove"},data:{allow_activate_nodes:"/_/admin/data/allow_activate_nodes",flow_chargers:"/_/admin/data/flow_chargers"},excel:{create_entry:"/_/admin/app/:appId/excel/create_entry"},etl:{create:"/_/admin/app/:appId/etl/create",formula:"/_/admin/app/:appId/etl/:entryId/check_formula",list:"/_/admin/app/:appId/list_etl",table_list:"/_/admin/app/:appId/list_etl_table",remove:"/_/admin/app/:appId/etl/:entryId/remove",logs:"/_/admin/app/:appId/etl/:entryId/logs",execute:" /_/admin/app/:appId/etl/:entryId/execute",update:"/_/admin/app/:appId/etl/:entryId/update",edit:"/_/admin/app/:appId/etl/:entryId/edit",get_stage_fields:"/_/admin/app/:appId/etl/:entryId/get_stage_fields",preview:"/_/admin/data/etl/preview/list"}})}(jQuery),function(e){window.FX=window.FX||{};var t={};e.shortcut=function(i,a){if(null!=t[i])throw"shortcut:["+i+"] has been registered";t[i]=a,e.extend(a.prototype,{xtype:i})},FX.createWidget=function(i){if(i instanceof e)return new FX.Widget({renderEl:i});var a=i.type.toLowerCase(),s=t[a];if(!s)throw a+" does not exist";return new s(i)},FX.extend=function(t,i,a){"object"==typeof i&&(a=i,i=t,t=function(){i.apply(this,arguments)});var s=function(){},n=i.prototype;return s.prototype=n,t.prototype=new s,t.superclass=n,e.extend(t.prototype,a),t},FX.STATIC={_st:(new Date).getTime(),_ct:(new Date).getTime(),zIndex:8e3,Language:"zh",num:0,IDBase:new Date-0,CSRF:e('meta[name="csrf-token"]').attr("content"),site:window.location.protocol+"//"+window.location.hostname}}(jQuery),function(e){var t=window._jdy_config||{};e.extend(FX,{CONFIG:{HOST:{SITE_HOST:t.site,SITE_SHORT_HOST:(t.site||"").replace("www.",""),IMAGE_HOST:"https://images.jiandaoyun.com",OSS_IMAGE_HOST:"https://oss-image.jiandaoyun.com",HELP_DOC_HOST:"https://hc.jiandaoyun.com/doc",HELP_UPDATE_HOST:"https://hc.jiandaoyun.com/update",HELP_VIDEO_HOST:"https://hc.jiandaoyun.com/video",TRACK_HOST:"https://track.jiandaoyun.com",ASSETS_HOST:t.assets_site},COOKIE_DOMAIN:t.cookie_domain},ValueWidgets:{text:1,number:1,textarea:1,datetime:1,checkboxgroup:1,radiogroup:1,combo:1,combocheck:1,address:1,image:1,upload:1,signature:1,subform:1,user:1,usergroup:1,dept:1,deptgroup:1,location:1,linkdata:1},ValueTypeMap:{text:"string",textarea:"string",combo:"string",radiogroup:"string",user:"id",combocheck:"array",checkboxgroup:"array",usergroup:"idarray",number:"number",datetime:"datetime",address:"address",location:"address",dept:"did",deptgroup:"didarray",upload:"upload",image:"upload",signature:"signature"},USER_ID:{CurrentUser:"100000000000000000000001",SYS_ROBOT:"100000000000000000000002"},DATA_PREFIX:{Aggregate:"2"},WidgetValueOption:{CUSTOM:0,ASYNC:1,RELY:2,FORMULA:3},Keys:{ENTER:13,BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},States:{NORMAL:0,SUCCESS:1,ERROR:2,WARNING:3},EntryAttributes:{creator:1,createTime:1,updateTime:1,ext:1},Time:{excelDayOffset:25569,millisecondsOfDay:864e5},TimeZone:{defaultOffset:288e5},Events:{RELY:"x-rely"},InvisibleSubmitRules:{KEEP:1,NULL:2,ALWAYS:3},LimitFields:{queryFilter:["text","radiogroup","combo","number","datetime","address","user"],parameter:["text","radiogroup","combo","number","datetime","address","user","dept","subform"],filter:["text","textarea","radiogroup","checkboxgroup","combo","combocheck","number","datetime","address","location","user","usergroup","dept","deptgroup","subform","flowstate","flownode","image","upload","signature"],reportDataAuth:["text","textarea","radiogroup","checkboxgroup","combo","combocheck","number","datetime","address","location","user","usergroup","dept","deptgroup","subform","flowstate","flownode"],list:["text","textarea","combo","radiogroup","checkboxgroup","combocheck","number","datetime","address","location","user","usergroup","dept","deptgroup","image","upload","signature","subform","linkdata"],listJoin:["text","combo","radiogroup","number","user","dept"],group:["text","radiogroup","combo","number","datetime","address","string","subform","user","dept","id","location","linkdata"],subGroup:["text","combo","number","datetime","linkdata"],groupJoin:["text","combo","radiogroup","number","user","datetime","address","location","subform","linkdata","dept"],subGroupJoin:["text","combo","number","datetime","linkdata"],validate:["number","text","datetime","radiogroup","checkboxgroup","combo","combocheck","user","usergroup","linkdata","dept","deptgroup","subform"],rely:["combo","combocheck","text","datetime","number","subform","radiogroup","checkboxgroup","user","linkdata","dept"],link:["combo","combocheck","text","textarea","datetime","number","radiogroup","checkboxgroup","address","user","usergroup","linkdata","dept","deptgroup"],brief:["text","textarea","combo","radiogroup","combocheck","checkboxgroup","number","datetime","address","location","user","usergroup","dept","deptgroup"],import:["text","textarea","combo","radiogroup","combocheck","checkboxgroup","number","datetime","address","subform","user","usergroup","dept","deptgroup"],combodata:["combo","combocheck","text","datetime","number","radiogroup","checkboxgroup"],linkData:["text","textarea","combo","radiogroup","checkboxgroup","combocheck","number","datetime","address","location","upload","image","signature","user","usergroup","dept","deptgroup","subform"],linkKey:["text","number","datetime","radiogroup","combo"],subLinkData:["text","combo","combocheck","radiogroup","checkboxgroup","number","datetime","address","location"],aggregate:["text","radiogroup","combo","string","subform","linkdata"],batchEdit:["number","text","textarea","datetime","radiogroup","checkboxgroup","combo","combocheck","address","user","usergroup","dept","deptgroup"],fileExport:["image","upload"],fileExportName:["text","number","radiogroup","combo","user"],itemLink:["combo","radiogroup"],printTemplate:["text","textarea","combo","radiogroup","checkboxgroup","combocheck","number","datetime","address","location","user","usergroup","dept","deptgroup","subform","linkdata","flow","image","signature","dataQr"],excelExport:["text","textarea","combo","radiogroup","checkboxgroup","combocheck","number","datetime","address","location","user","usergroup","dept","deptgroup","subform","linkdata"],_sysExcelExport:["flowState","chargers"],noCache:["location","separator","linkquery"],dataLabel:["text","number","datetime","radiogroup","checkboxgroup","combo","combocheck","address","location","user","usergroup","dept","deptgroup"],sort:["text","textarea","number","radiogroup","datetime","combo","linkdata"],dashDimension:["text","radiogroup","combo","datetime","address","subform","user","dept","location"],dashQuota:["text","combo","radiogroup","datetime","address","location","number","user","dept","subform","formula"],dashFilter:["text","radiogroup","combo","datetime","address","user","dept","location","number"],dashField:["text","number","radiogroup","combo","datetime","address","subform","user","dept","location","linkdata"],dashTableField:["text","textarea","number","radiogroup","combo","checkboxgroup","combocheck","datetime","address","subform","user","dept","usergroup","deptgroup","location","linkdata","formula","image","upload","signature"],dashTableFilter:["text","textarea","radiogroup","checkboxgroup","combo","combocheck","number","datetime","address","location","user","usergroup","dept","deptgroup","image","upload","signature"],dashTableFormula:["number"],dashCompFilter:["text_filter","number_filter","address_filter","date_filter","datetime_filter","dept_filter"],dashCompChart:["metric_table","data_table","pivot_table","line_chart","column_chart","bar_chart","area_chart","pie_chart","radar_chart"],etlInput:["text","textarea","combo","radiogroup","checkboxgroup","combocheck","number","datetime","address","location","user","usergroup","dept","deptgroup","subform"],etlMapFormula:["number"],triggerCond:["text","textarea","combo","radiogroup","checkboxgroup","combocheck","number","datetime","address","location","user","usergroup","dept","deptgroup"],triggerQuery:["text","textarea","combo","radiogroup","checkboxgroup","combocheck","number","datetime","user","usergroup","dept","deptgroup"],triggerWrite:["text","textarea","combo","radiogroup","checkboxgroup","combocheck","number","datetime","address","location","user","usergroup","dept","deptgroup","image","upload"],disable:["text","textarea","number","datetime","radiogroup","checkboxgroup","combo","combocheck","address","location","user","usergroup","dept","deptgroup"],userDept:["user","usergroup","dept","deptgroup"]},Operators:{group:["+","-","*","/","."],aggregate:["+","-","."]},CONST:{MAX_COUNT:1e5,MAX_TODO_COUNT:999,MAX_FORMULA_FIELD:80,MAX_FORMULA_OPERATOR:80,REPORT_REBUILD_WAIT:500,WIDGET_LIST:{text:{name:"单行文本",changeList:["combo","radiogroup"],subChangeList:["combo","radiogroup"]},radiogroup:{name:"单选按钮组",changeList:["combo","text"],subChangeList:["combo","text"]},combo:{name:"下拉框",changeList:["radiogroup","text"],subChangeList:["text","radiogroup"]},checkboxgroup:{name:"复选框组",changeList:["combocheck"],subChangeList:["combocheck"]},combocheck:{name:"下拉复选框",changeList:["checkboxgroup"],subChangeList:["checkboxgroup"]},number:{name:"数字"},datetime:{name:"日期时间"},address:{name:"地址"},textarea:{name:"多行文本"},image:{name:"图片"},upload:{name:"附件"},subform:{name:"子表单"},separator:{name:"分割线"},user:{name:"成员单选"},usergroup:{name:"成员多选"},location:{name:"定位"},linkdata:{name:"关联数据"},linkquery:{name:"关联查询"},dept:{name:"部门单选"},deptgroup:{name:"部门多选"},signature:{name:"手写签名"}},LIMIT_FORMULA:{etl_map:["ABS","AVERAGE","CEILING","FLOOR","INT","MAX","MIN","MOD","POWER","ROUND","SQRT"]},CHINA_CODE:"+86",AREA_CODE:[{value:"+86",text:"中国"},{value:"+886",text:"中国台湾"},{value:"+852",text:"中国香港"},{value:"+853",text:"中国澳门"}],APP_CATE_NAME:{quick_start:"快速上手",rank:"精选推荐",application:"用途",common:"行业",feature:"功能",it:"IT互联网",manufacturing:"制造业",trade:"贸易零售",service:"服务业",education:"教育培训",housing:"建筑房产",financial:"金融",medicine:"医疗医药",government:"政府单位",logistics:"物流运输",business_service:"商业服务",hr:"人力行政",audit:"财务报销",office:"办公协作",inventory:"进销存",store:"门店管理",crm:"客户关系",sales:"销售",project:"项目任务",production:"生产管理",asset_equipment:"资产设备",formula:"公式函数",flow:"流程",aggregate:"聚合表",print:"自定义打印",data_rely:"数据联动",data_auth:"数据权限",notify:"推送提醒",association:"选项关联"},APP_CATE:{QUICK_START:"quick_start",RANK:"rank",APPLICATION:"application",COMMON:"common",FEATURE:"feature",IT:"it",MANUFACTURING:"manufacturing",TRADE:"trade",SERVICE:"service",EDUCATION:"education",HOUSING:"housing",FINANCIAL:"financial",MEDICINE:"medicine",GOVERNMENT:"government",LOGISTICS:"logistics",BUSINESS_SERVICE:"business_service",HR:"hr",AUDIT:"audit",OFFICE:"office",INVENTORY:"inventory",STORE:"store",CRM:"crm",SALES:"sales",PROJECT:"project",PRODUCTION:"production",ASSET_EQUIPMENT:"asset_equipment",FORMULA:"formula",FLOW:"flow",AGGREGATE:"aggregate",PRINT:"print",DATA_RELY:"data_rely",DATA_AUTH:"data_auth",NOTIFY:"notify",ASSOCIATION:"association"},APP_CATE_MAP:{quick_start:["quick_start"],rank:["rank"],application:["hr","audit","office","inventory","store","crm","sales","project","production","asset_equipment"],common:["it","manufacturing","trade","service","education","housing","financial","medicine","government","logistics","business_service"],feature:["formula","flow","aggregate","print","data_rely","data_auth","notify","association"]},FLOW_ACTION_NAME:{forward:"提交",save:"暂存",print:"提交并打印",back:"回退",transfer:"转交",close:"结束流程",revoke:"撤回"},QN_BUCKET:{PUBLIC_IMAGE:"media",PRIVATE_FILE:"file"},OSS_BUCKET:{PUBLIC_IMAGE:"oss_image"},WORKFLOW:{NODE_DELIMITER:"@",START_FLOW_ID:0,END_FLOW_ID:-1,APPROVAL_ALL:0,APPROVAL_ANY:1,BACKRULE:{DISALLOW:0,PARENT_NODE:1,RANGE_NODE:2},FLOWSTATE:{INPROCESS:0,COMPLETE:1,CLOSE:2},FLOWTYPE:{NORMAL:"flow",CC:"cc"},CREATOR_ID:"100000000000000000000000",DEPT_MANAGER_ID:"110000000000000000000000",CHARGER_ID:"111000000000000000000000",CHARGER_DEPT_MANAGER_ID:"111100000000000000000000"},DEPT_ID:{CURRENT:"110000000000000000000001"},PARAMETER:{EMPTY:"fx_param_empty"},TEXT_TYPE_REGEXP:{mobile:"^((\\(\\d{2,3}\\))|(\\d{3}\\-))?1\\d{10}$",interMobile:"^\\+?\\d+$",tel:"^(0[0-9]{2,3}\\-)?([2-9][0-9]{6,7})+(\\-[0-9]{1,4})?$",zip:"^\\d{6}$",email:"^([a-zA-Z0-9_\\.\\-])+\\@(([a-zA-Z0-9\\-])+\\.)+([a-zA-Z0-9]{2,4})+$",ID:"(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)",URL:"(?:http(?:s)?:\\/\\/|www)[\\w.]+[\\w:./\\-?#=&%]+"},VIP_ORDER:{PACK:{free:{name:"免费版"},lite:{name:"青春版",service:"basic",data:2e5,validAddons:["data","aggregate","data_backup","form_data"]},std:{name:"标准版",service:"silver",data:75e4,validAddons:["data","aggregate","file_upload","managers","data_backup","form_data"]},user:{name:"按用户数购买",service:"silver",data:25e3,validAddons:[]},pro:{name:"专业版",service:"silver",data:2e6,validAddons:["data","aggregate","file_upload","managers","data_backup","form_data"]},ent:{name:"企业版",service:"silver",data:1e7,validAddons:["data","aggregate","file_upload","managers","data_backup","form_data"]},logo:{name:"去LOGO版"},oem:{name:"定制版",service:"silver",data:75e4,validAddons:["data","aggregate","file_upload","managers","data_api","data_backup","form_data"]}},PACK_STATE:{TRAIL:0,USING:1,BUFFER:2,EXPIRED:3},SERVICE:{basic:{name:"基本服务",desc:"赠送"},silver:{name:"高级服务",desc:"+2500元升级高级服务"},gold:{name:"高级服务",desc:""}},DATA_UNIT:1e4,DATA_ADD_UNIT:1e5,FORM_DATA_UNIT:1e4,USER_ADD_UNIT:5,UPLOAD_ADD_UNIT:1073741824,DATA_BACKUP_UNIT:15},ORDER_STATE:{CANCELED:-1,UNPAID:0,PAID:1,RECEIPTING:2,RECEIPTED:3},SORT:{ASC:1,DESC:-1},FIELD_WIDTH:{HALF:"half",NORMAL:"normal",TWICE:"twice"},FIELD_LINE_WIDTH:12,FIELD:{SUBFORM_DELIMITER:".",DELIMITER:"@",ENTRY_DELIMITER:"#",FORMULA_FIELD_DELIMITER:"$"},DEFAULT_AUTH_GROUP:0,AUTH_GROUP:{SUBMIT:-1,VIEW_ALL:-2,MANAGE_OWN:-3,MANAGE_ALL:-4},AUTH_GROUP_CONTENT:[{groupId:-1,name:"直接提交数据",desc:"在此分组内的成员只可以填报数据，设置了页面共享的成员自动加入此分组"},{groupId:-4,name:"管理全部数据",desc:"在此分组内的成员可以管理全部数据、填报数据、但不可以导入数据"},{groupId:-2,name:"查看全部数据",desc:"在此分组内的成员可以查看所有数据"},{groupId:-3,name:"管理本人数据",desc:"在此分组内的成员可以管理自己填报的数据"}],FLOW_AUTH_GROUP_CONTENT:[{groupId:-1,name:"发起流程",desc:"在此分组内的成员可以发起流程，设置了表单共享的成员自动加入此分组"},{groupId:-2,name:"查看全部流程",desc:"在此分组内的成员可以查看全部流程"},{groupId:-4,name:"管理全部流程",desc:"在此分组内的成员可以管理全部流程"}],APP_STATE:{private:0,review:1,onSale:2},K12_APPROVE:{NOTPASS:-1,PASS:1},VIP_MODULE:{USERS:"users",FORM_DATA:"form_data",DATA:"data",EXCEL_IMPORT:"excel_import",FILE_UPLOAD:"file_upload",AGGREGATE:"aggregate",PRINT:"print",TRIGGER:"trigger",DATA_BACKUP:"data_backup",SUBMIT_PROMPT:"submit_prompt",FILE_ZIP:"file_zip",LOGO:"logo",USER_SYNC:"user_sync",APP_BRIDGE:"app_bridge",LEVEL:"level",SIGNATURE:"signature"},VIP_COOKIE:{TRAIL:{SUFFIX_KEY:"#tr_time",EXPIRES_DATE:new Date((new Date).getTime()+1296e6)},SYS_DATA:{KEY:"exceed",EXPIRES_DATE:new Date((new Date).getTime()+864e5),VALUE:!0},SERVICE_UPGRADE:{SUFFIX_KEY:"#up_time",EXPIRES_DATE:new Date((new Date).getTime()+864e5),VALUE:!0}},COOKIE:{PHONE:{KEY:"bind_phone",EXPIRES:new Date((new Date).getTime()+864e5),VALUE:!0},GUIDE:{SUFFIX_KEY:"#guide",EXPIRES_DATE:new Date((new Date).getTime()+864e5),TYPE:{APP_EDIT:1}},HELP_ONLINE:{KEY:"help_online",EXPIRES:new Date((new Date).getTime()+31536e6)},USER_GUIDE_BTN:{KEY:"user_guide_btn",EXPIRES:new Date((new Date).getTime()+31536e6)},USER_GUIDE:{KEY:"user_guide",EXPIRES:new Date((new Date).getTime()+31536e6),VALUE:!0},FORM_GUIDE:{KEY:"form_guide",EXPIRES:new Date((new Date).getTime()+31536e6),VALUE:!0},DASH_CHART_GUIDE:{KEY:"dash_chart_guide",EXPIRES:new Date((new Date).getTime()+31536e6),VALUE:!0},LAST_LOC:{SUFFIX_KEY:"#last_loc",EXPIRES:new Date((new Date).getTime()+2592e6)},DOT_GUIDE:{KEY:"dot_guide",EXPIRES:new Date((new Date).getTime()+2592e6),VALUE:{MEI_QIA:64,FLOW_FILTER_PART:32,FLOW_FILTER_CREATE:16,FLOW_FILTER_TODO:8,DATA_FILTER:4,APP_SET:2,DASH_BOARD:1}},STEP_GUIDE:{KEY:"step_guide",EXPIRES:new Date((new Date).getTime()+31536e6),VALUE:{HELP_CENTER:20,NAVIBAR:17,FLOW:16,SHARE_INTRO:15,SHARE_FORM:14,SAVE_FORM:13,EDIT_WIDGET:12,ADD_WIDGET:11,FORM_BEGIN:10,DASHBOARD:6,MENU:5,FORM_VISIT:4,APP_VISIT:3,FORM_EDIT:2,APP_EDIT:1,BEGIN:0}},GIFT:{KEY:"gift-coupon",EXPIRES:new Date((new Date).getTime()+6048e5)},ACTIVITY:{KEY:"activity",EXPIRES:new Date((new Date).getTime()+31536e6),VALUE:"1"},PERSONA:{SUFFIX_KEY:"#user_portrait",EXPIRES:new Date((new Date).getTime()+2592e5),VALUE:!0},MUTE_PERSONA:{SUFFIX_KEY:"#mute_user_portrait",EXPIRES:new Date((new Date).getTime()+2592e6),VALUE:!0},RECOMMEND:{SUFFIX_KEY:"#recommend_apps",EXPIRES:new Date((new Date).getTime()+31536e6),VALUE:!0},INVITE_MEMBER:{SUFFIX_KEY:"#invite_member",EXPIRES:new Date((new Date).getTime()+2592e6),VALUE:!0},PUBLISH_TIP:{KEY:"publish_tip",EXPIRES:new Date((new Date).getTime()+31536e6),VALUE:"1"}},TRACKER:{APP_CREATE:"app_create",APP_FORK:"app_fork",APP_EDIT:"app_edit",APP_CONFIG:"app_config",APP_REF:"app_ref",APP_VISIT:"app_visit",APP_RENAME:"app_rename",AUTH_GROUPS:"auth_groups",AGGREGATE_TABLE_CREATE:"aggregate_table_create",AGGREGATE_TABLE_EDIT:"aggregate_table_edit",FORM_CREATE:"form_create",FORM_EDIT:"form_edit",REPORT_CREATE:"report_create",REPORT_EDIT:"report_edit",REPORT_RENAME:"report_rename",REPORT_SHARE:"report_share",REPORT_REF:"report_ref",ORDER_LIST:"order_list",VIP_CENTER:"vip_center",WORKFLOW:"workflow",MENU_PACK:"menu_pack",VIP_CENTER_PACK:"vip_center_pack",MEMBER_LIST:"member_list",MEMBER_ADD:"member_add",HELP_DOC:"help_doc",HELP_VIDEO:"help_video",HELP_CUSTOM:"help_custom",TEMP_SEARCH:"temp_search",APP_VIEW:"app_view",PRINT_CREATE:"print_create",FORM_SHARE:"form_share",FORM_RENAME:"form_rename",FORM_TYPE_CHANGE:"form_type_change",FLOW_FORM_CREATE:"flow_form_create",AUTH_GROUP_CREATE:"auth_group_create",APP_INSTALL:"app_install",FORM_SETTING:"form_setting",FORM_REF:"form_ref",TRAIL_DASHBOARD:"trail_dashboard",TRAIL_VIP_CENTER:"trail_vip_center",FORM_FIELD_ADD:"form_field_add",FORM_FIELD_RENAME:"form_field_rename",FORM_CREATE_FROM_EXCEL:"form_create_from_excel",FLOW_FORM_CREATE_FORM_EXCEL:"flow_form_create_from_excel",DASHBOARD_FLOW_LAUNCH:"dashboard_flow_launch",DATA_SOURCE_PICK:"data_source_pick",ENTRY_SHARE_TO_MEMBER:"entry_share_to_member",USER_PORTRAIT_COLLECT:"user_portrait_collect",USER_PORTRAIT_FINISH:"user_portrait_finish",FILE_PREVIEW:"file_preview",VIP_LIMIT_ALERT:"vip_limit_alert",SUBFORM_EXPAND:"subform_expand",TRAIL_SECOND:"trail_second"},KEY_CODE:{LEFT:37,RIGHT:39,ENTER:13,BACKSPACE:8},ALLIANCE_APPLY_STATE:{APPROVED:"approved",WAITING:"waiting",DENIED:"denied",NOT_APPLIED:"not_applied",BANNED:"banned"},CONTACT_DEF_GROUP:"1",DEPARTMENT_ROOT:1,MANAGE_GROUP:{SYS:{ID:-1,NAME:"系统管理组"}},LOCAL_STORAGE:{APP_INSTALL_GUIDE:"app_install_guide"},WEBHOOK:{API_TRIGGER:{CREATE:"data_create",UPDATE:"data_update",REMOVE:"data_remove"},SERVER_TYPE:{FR:"fr",CUSTOM:"custom"}},PRINT_DPI:96,UPLOAD_FILE_COUNT:{SINGLE:1,MULTI:10},SEP_LINE_STYLE:{NONE:"none",DASHED:"dashed",THIN:"thin",THICK:"thick"},FILTER_METHOD:{EQ:"eq",NE:"ne",ALL:"all",IN:"in",NIN:"nin",LK:"like",ULK:"unlike",EP:"empty",NEP:"not_empty",GT:"gt",GTE:"gte",LT:"lt",LTE:"lte",RG:"range"},FILTER_RELATION:{AND:"and",OR:"or"},DASH_AGGREGATE_FUNC:["SUM","AVERAGE","MAX","MIN","COUNT"],DIMENSION_GROUP:{ADDRESS:[{text:"省",value:"province"},{text:"省-市",value:"province_city"},{text:"省-市-区",value:"province_city_district"}],DATE:[{text:"年",value:"year"},{text:"年-季",value:"year_quarter"},{text:"年-月",value:"year_month"},{text:"年-周",value:"year_week"},{text:"年-月-日",value:"year_month_day"}]},DATA_LIMIT_TIP:{LINK:"该账号的本月数据流量已用完，无法提交新数据，请联系链接发布者升级套餐",ACCOUNT:"该账号的本月数据流量已用完，无法提交新数据，请联系账号创建者升级套餐"},FLOW_FAIL_CODE:{FORWARD_CHARGER:5008,BACK:5009,FORWARD_COND:5011},FLOW_FAIL_HINT:{forward:"提交失败",back:"回退失败",auto_forward:"自动提交失败",auto_back:"自动回退失败"},SAVE_CONFIRM_PANE:{FORM_DESIGN:"form-design",FORM_SET:"form-set",FLOW_DESIGN:"flow-design",DATA_LABEL:"data-label",PUBLIC_LINK:"public-link",CUSTOM_SUBMIT:"custom-submit",REPORT_DESIGN:"report-design",AGGREGATE:"aggregate-design",APP_SHARE:"app-share",APP_DATA:"app-data",APP_REF:"app-ref",APP_SUMMARY:"app-summary"},TRIGGER:{TRIGGERS:{CREATE:"data_create",UPDATE:"data_update"},EXE:{CREATE:"create_data",UPDATE:"update_data"},STEP:{TRIG:1,EXE:2}},VIP_ERR_MSG_MAP:{7104:{title:"系统用量受到限制，您是否要立即升级？",msg:"聚合表数量已达上限，您可以至会员中心查看套餐使用情况和升级套餐，或删除无用聚合表后再进行新建。",memMsg:"聚合表数量已达上限，请联系企业创建者升级套餐后再使用该功能。",doc:"9117",addon:"aggregate"},7105:{title:"系统用量受到限制，您是否要立即升级？",msg:"你所安装的应用中聚合表数量超出当前套餐限制。请联系企业创建者升级套餐后再安装应用。",doc:"9117",addon:"aggregate"},7106:{addon:"aggregate"},7107:{addon:"file_upload"},7108:{addon:"data"},7109:{addon:"form_data"},7110:{addon:"users"},7111:{title:"系统用量受到限制，您是否要立即升级？",msg:"成员数量超出限制。您可以至会员中心查看套餐使用详情和升级套餐，以同步/邀请更多成员。",memMsg:"成员数量超出限制。请联系创建者升级套餐以同步/邀请更多成员。",addon:"users"},7112:{title:"使用该功能需升级套餐，您是否要立即升级？",msg:"您当前使用的套餐不包含自定义打印功能，您可以至会员中心查看套餐使用详情和升级套餐。",memMsg:"您当前使用的套餐不包含自定义打印功能，请联系企业创建者升级套餐。",doc:"9140",addon:"print"},7113:{title:"系统用量受到限制，您是否要立即升级？",msg:"自定义打印模板数量已达上限，您可以至会员中心查看套餐使用情况和升级套餐，或删除无用自定义打印模板后再进行新建。",memMsg:"自定义打印模板数量已达上限，请联系企业创建者升级套餐后再新建。",doc:"9140",addon:"print"},7114:{title:"系统用量受到限制，您是否要立即升级？",msg:"您所安装的应用中自定义打印模板数量超出当前套餐限制。请联系企业创建者升级套餐后再安装应用。",doc:"9140",addon:"print"},7115:{addon:"manager"},7116:{addon:"manager"},7117:{addon:"manager"},7118:{addon:"manager"},7119:{addon:"manager"},7120:{title:"使用该功能需升级套餐，您是否要立即升级？",msg:"您当前使用的套餐不包含数据推送功能，您可以至会员中心查看套餐使用详情和升级套餐。",memMsg:"您当前使用的套餐不包含数据推送功能，请联系企业创建者升级套餐。",doc:"10732",addon:"data_api"},7121:{title:"使用该功能需升级套餐，您是否要立即升级？",msg:"您当前使用的套餐不包含数据回收站功能，您可以至会员中心查看套餐使用详情和升级套餐。",memMsg:"您当前使用的套餐不包含数据回收站功能，请联系企业创建者升级套餐。",doc:"9136",addon:"data_backup"},7122:{title:"使用该功能需升级套餐，您是否要立即升级？",msg:"您当前使用的套餐不包含导出附件功能，您可以至会员中心查看套餐使用详情和升级套餐。",memMsg:"您当前使用的套餐不包含导出附件功能，请联系企业创建者升级套餐。",doc:"9145",addon:"file_zip"},7123:{title:"使用该功能需升级套餐，您是否要立即升级？",msg:"您当前使用的套餐不包含跨应用取数功能，您可以至会员中心查看套餐使用详情和升级套餐。",memMsg:"您当前使用的套餐不包含跨应用取数功能，请联系企业创建者升级套餐。",doc:"9139",addon:"app_bridge"},7124:{title:"使用该功能需升级套餐，您是否要立即升级？",msg:"您当前使用的套餐不包含自动同步功能，您可以至会员中心查看套餐使用详情和升级套餐。",doc:"9138",addon:"user_sync"},7125:{title:"使用该功能需升级套餐，您是否要立即升级？",msg:"您当前使用的套餐不包含自定义提交成功页面功能，您可以至会员中心查看套餐使用详情和升级套餐。",memMsg:"您当前使用的套餐不包含自定义提示页面功能，请联系企业创建者升级套餐。",doc:"10884",addon:"submit_prompt"},7128:{addon:"aggregate"},7130:{title:"使用该功能需升级套餐，您是否要立即升级？",msg:"您使用的当前套餐中不包含手写签名功能，您可至会员中心查看套餐详情和升级套餐",memMsg:"您当前使用的套餐不包含手写签名功能，请联系企业创建者升级套餐。",doc:"10947",addon:"signature"},7131:{title:"功能测试中，无法创建数据流",msg:"数据工厂处于Beta测试中，当前账号无法创建数据流，敬请谅解",memMsg:"数据工厂处于Beta测试中，无法创建数据流"},7132:{title:"数据流数量已达上限，无法创建数据流",msg:"当前账号最多可以创建5个数据流，您可以查看数据流使用情况，在删除无用数据流后再新建。",memMsg:"数据流数量已达上限，请联系企业创建者调整系统用量，删除无用数据流后再新建"},7133:{title:"系统用量受到限制",msg:"数据流数量已超出当前套餐限制，为避免系统受限影响您的正常使用，您可以点击查看详情删除无用数据流。",memMsg:"数据流数量已超上限，请联系企业创建者升级套餐或调整系统用量"},7134:{title:"使用该功能需要升级套餐，您是否要立即升级？",msg:"您使用的当前套餐中不包含智能助手功能，您可至会员中心查看套餐详情和升级套餐",memMsg:"您所使用的套餐不包含智能助手功能，请联系企业创建者升级套餐。",doc:"11021",addon:"trigger"},7135:{title:"智能助手已达上限，无法创建智能助手",msg:"每个帐号仅可创建5个智能助手，请删除无用的智能助手后再新建",memMsg:"智能助手数量已达上限，无法新建智能助手"},7136:{title:"系统用量受到限制，您是否要立即升级",msg:"智能助手数量已超出当前套餐限制，为避免系统受限影响您的正常使用，请点击查看详情删除无用智能助手。"}},VIP_ERR_NAME_MAP:{DATA_BACKUP:7121,FILE_ZIP:7122,SUBMIT_PROMPT:7125,DATA_API:7120,PRINT:7112,SIGNATURE:7130,TRIGGER_NO:7134,TRIGGER_LIMIT:7135},MAX_FILE_SIZE:20971520},MEI_QIA:{VIP:"https://static.meiqia.com/dist/standalone.html?_=t&eid=89905&groupid=ccd49a5cfe1ac9576135a9f0bd0a9414&fallback=1",FREE:"https://static.meiqia.com/dist/standalone.html?_=t&eid=89905&groupid=24eb490c50ca74c3e276a6cdb8ac4787&fallback=1"}})}(jQuery),$.extend(FX,{PROPERTIES:{zh:{Sunday:"星期日",Monday:"星期一",Tuesday:"星期二",Wednesday:"星期三",Thursday:"星期四",Friday:"星期五",Saturday:"星期六","Short-Sun":"日","Short-Mon":"一","Short-Tue":"二","Short-Wed":"三","Short-Thu":"四","Short-Fri":"五","Short-Sat":"六",January:"一月",February:"二月",March:"三月",April:"四月",May:"五月",June:"六月",July:"七月",August:"八月",September:"九月",October:"十月",November:"十一月",December:"十二月","Short-Jan":"一","Short-Feb":"二","Short-Mar":"三","Short-Apr":"四","Short-May":"五","Short-Jun":"六","Short-Jul":"七","Short-Aug":"八","Short-Sep":"九","Short-Oct":"十","Short-Nov":"十一","Short-Dec":"十二"},en:{Sunday:"Sunday",Monday:"Monday",Tuesday:"Tuesday",Wednesday:"Wednesday",Thursday:"Thursday",Friday:"Friday",Saturday:"Saturday","Short-Sun":"Sun","Short-Mon":"Mon","Short-Tue":"Tue","Short-Wed":"Wed","Short-Thu":"Thu","Short-Fri":"Fri","Short-Sat":"Sat",January:"January",February:"February",March:"March",April:"April",May:"May",June:"June",July:"July",August:"August",September:"September",October:"October",November:"November",December:"December","Short-Jan":"Jan","Short-Feb":"Feb","Short-Mar":"Mar","Short-Apr":"Apr","Short-May":"May","Short-Jun":"Jun","Short-Jul":"Jul","Short-Aug":"Aug","Short-Sep":"Sep","Short-Oct":"Oct","Short-Nov":"Nov","Short-Dec":"Dec"},ja:{}},i18nText:function(e){return FX.PROPERTIES[FX.STATIC.Language][e]}}),function(e){FX.Utils=FX.Utils||{},e.extend(FX.Utils,{isString:function(e){return"string"==typeof e},isNumber:function(t){return e.isNumeric(t)},isFunction:function(t){return e.isFunction(t)},isDate:function(e){return e instanceof Date},isArray:function(t){return e.isArray(t)},isEmpty:function(e){return""===e||FX.Utils.isNull(e)},isBlank:function(e){return FX.Utils.isNull(e)||""===e.trim()},isNull:function(e){return null==e},isObjectEmpty:function(e){if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var t in e)if(hasOwnProperty.call(e,t))return!1;return isNaN(e)},remove:function(e,t){var i=[];if(!FX.Utils.isArray(e)||!e.length)return i;for(var a=[],s=0,n=e.length;s<n;s++){var o=e[s];t.apply(e,[s,o,e])&&(i.push(o),a.push(s))}for(var l=a.length,r=-1,d=l-1;l--;){var c=a[l];l!==d&&c===r||(r=c,e.splice(c,1))}return i},shuffleArray:function(e){var t=[];if(!FX.Utils.isArray(e)||!e.length)return t;for(var i=(t=e.slice(0)).length,a=0;a<i-1;a++){var s=Math.floor(Math.random()*(i-a)),n=t[s];t[s]=t[i-a-1],t[i-a-1]=n}return t},isValueWidget:function(e){return!!FX.ValueWidgets[e]},pick:function(e,t){var i={};return FX.Utils.forEach(t,function(t,a){a in e&&(i[a]=e[a])}),i},applyFunc:function(e,t,i,a){return FX.Utils.isFunction(t)?t.apply(e,i||[]):a},forEach:function(e,t){if(Array.isArray(e)||e instanceof jQuery)for(var i=0,a=e.length;i<a&&!1!==t.apply(e[i],[i,e[i]]);i++);else if(e&&"object"==typeof e)for(var s in e)if(e.hasOwnProperty(s)&&!1===t.apply(e[s],[s,e[s]]))break},flatten:function(e,t,i){if(i||(i=[]),e)for(var a=0,s=e.length;a<s;a++){var n=e[a];Array.isArray(n)?FX.Utils.flatten(n,t,i):t&&!t(n)||i.push(n)}return i},applyCss:function(e,t){FX.Utils.isEmpty(t)||(FX.Utils.isString(t)?e.addClass(t):e.css(t))},getServerDate:function(e){if(e&&e.getResponseHeader){var t=e.getResponseHeader("date");t&&(FX.STATIC._st=new Date(t).getTime(),FX.STATIC._ct=(new Date).getTime())}},getApi:function(e){if(!FX.Utils.isString(e))return"";var t=arguments;if(t.length<=1)return e;var i=/\/:[a-z]+/gi,a=1;return e.replace(i,function(){return"/"+t[a++]})},replaceURL:function(e){if(FX.Utils.isNull(e))return"";e+="";var t="",i=FX.CONST.TEXT_TYPE_REGEXP.URL,a=e.split(new RegExp("("+i+")"));return FX.Utils.forEach(a,function(e,i){if(e%2!=0){var a=i;FX.Utils.startWith(i,"www")&&(a="http://"+i),t+='<a class="nest-link" target="_blank" href="'+a+'">'+i+"</a>"}else t+=FX.Utils.escapeHtmlSpecialChar(i)}),t},ajax:function(t,i,a,s){return e.ajax({type:"POST",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",FX.STATIC.CSRF),e.setRequestHeader("X-JDY-Ver",FX.STATIC._ver)},url:t.url,async:!1!==t.async,data:JSON.stringify(t.data),contentType:"application/json;charset=UTF-8",timeout:t.timeout}).done(function(e,t,a){FX.Utils.getServerDate(a),i&&i(e,t),s&&s(e,t)}).fail(function(e,t,i){switch(e.status){case 400:if(!1===FX.Utils.applyFunc(this,a,[e,t],!1)){var n=e.responseJSON||{};n.msg?FX.Msg.toast({type:"warning",msg:n.msg}):FX.Msg.toast({type:"error",msg:"错误的请求"})}break;case 401:FX.Msg.toast({type:"warning",msg:"用户未登录"});break;case 402:FX.Msg.toast({type:"warning",msg:"当前会话已过期"});break;case 403:FX.Msg.toast({type:"warning",msg:"没有数据请求权限"});break;case 404:FX.Msg.toast({type:"warning",msg:"找不到数据资源"});break;case 0:break;default:FX.Msg.toast({type:"warning",msg:"与服务器通信失败"}),console&&console.log("通信失败")}s&&s(e,t)})},ajaxUpload:function(t,i,a,s){e.ajax({type:"POST",url:t.url,data:t.data,cache:!1,contentType:!1,processData:!1,beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",FX.STATIC.CSRF)},xhr:function(){var i=e.ajaxSettings.xhr();return i.upload&&t.onUpload&&i.upload.addEventListener("progress",function(e){e.lengthComputable?t.onUpload(e.loaded,e.total):t.onUpload(3,10)},!1),i}}).done(function(){i&&i.apply(this,arguments),s&&s.apply(this,arguments)}).fail(function(){a&&a.apply(this,arguments),s&&s.apply(this,arguments)})},dataAjax:function(e,t,i,a){e.data=e.data||{};var s=e.data;return FX.Utils.isEmpty(FX.STATIC.APPID)||(s.appId=FX.STATIC.APPID),FX.Utils.isEmpty(FX.STATIC.ENTRYID)||(s.entryId=FX.STATIC.ENTRYID),FX.Utils.isEmpty(FX.STATIC.DATAID)||(s.dataId=FX.STATIC.DATAID),FX.STATIC.BACKUP&&(s.isBackup=!0),FX.Utils.isEmpty(FX.STATIC.FTOKEN)?FX.Utils.isEmpty(FX.STATIC.QTOKEN)?FX.Utils.isEmpty(FX.STATIC.RTOKEN)?FX.Utils.isEmpty(FX.STATIC.ATOKEN)?FX.Utils.isEmpty(FX.STATIC.DTOKEN)?FX.Utils.isEmpty(FX.STATIC.DASH_TOKEN)||(s.fx_access_token=FX.STATIC.DASH_TOKEN,s.fx_access_type="dash_public"):(s.fx_access_token=FX.STATIC.DTOKEN,s.fx_access_type="form_data"):(s.fx_access_token=FX.STATIC.ATOKEN,s.fx_access_type="app_public"):(s.fx_access_token=FX.STATIC.RTOKEN,s.fx_access_type="report_public"):(s.fx_access_token=FX.STATIC.QTOKEN,s.fx_access_type="form_query"):(s.fx_access_token=FX.STATIC.FTOKEN,s.fx_access_type="form_public"),FX.Utils.ajax(e,function(e,i){t(e,i)},i,a)},getUrlParameter:function(e){for(var t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var a=t[i].split("=");if(a[0]==e)return a[1]}return null},escapeRegexp:function(e){if("string"!=typeof e)return"";var t=/[|\\{}()[\]^$+*?.]/g;return e.replace(t,"\\$&")},validateEmail:function(e){return new RegExp(FX.CONST.TEXT_TYPE_REGEXP.email).test(e)},validateMobile:function(e){return new RegExp(FX.CONST.TEXT_TYPE_REGEXP.mobile).test(e)},validateInterMobile:function(e){return new RegExp(FX.CONST.TEXT_TYPE_REGEXP.interMobile).test(e)},redirectTo:function(e){window.location.href=e},isCanvasSupported:function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},isFormDataSupported:function(){return void 0!==window.FormData},getFileDownloadURL:function(e,t,i){switch(e.bucket){case FX.CONST.QN_BUCKET.PUBLIC_IMAGE:var a="?attname="+encodeURIComponent(e.name),s=e.thumb;return s&&(a+="&imageView2/"+s.mode+"/w/"+s.width+"/h/"+s.height),t&&t(FX.CONFIG.HOST.IMAGE_HOST+"/"+e.qnKey+a);case FX.CONST.OSS_BUCKET.PUBLIC_IMAGE:return t&&t(FX.CONFIG.HOST.OSS_IMAGE_HOST+"/"+e.ossKey);case FX.CONST.QN_BUCKET.PRIVATE_FILE:default:if(!FX.STATIC.APPID)return i&&i();FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.file.file_url,FX.STATIC.APPID),data:e},function(e){t&&t(e.url)},function(e){!1===FX.Utils.applyFunc(this,i,[e],!1)&&FX.Msg.toast({type:"warning",msg:"文件获取失败"})})}},evalFormula:function(e){var t=[];FX.STATIC.FormulaEnv||(FX.Utils.forEach(Object.keys(FX.Formula),function(e,i){t.push("var "+i+"=FX.Formula."+i)}),FX.STATIC.FormulaEnv=t.join(";")+";");var i;try{i=new Function(FX.STATIC.FormulaEnv+"return "+e)()}catch(e){i=null}return i},getEntryAttribute:function(e,t){var i=["creator","createTime","updateTime"];return e&&i.push("ext"),t||i.push("flowState","chargers"),i},createEntryAttributeField:function(t,i,a){if(a&&a.indexOf(t)>-1)return null;var s={id:i.entryId};switch(t){case"label":e.extend(s,{name:"label",type:"text",text:"标题"});break;case"ext":e.extend(s,{name:"ext",type:"text",text:"扩展字段",items:i.extParams});break;case"createTime":e.extend(s,{name:"createTime",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",text:"提交时间"});break;case"updateTime":e.extend(s,{name:"updateTime",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",text:"更新时间"});break;case"creator":e.extend(s,{name:"creator",type:"user",text:"提交人"});break;case"flowState":e.extend(s,{name:"flowState",type:"flowState",text:"流程状态"});break;case"chargers":e.extend(s,{name:"chargers",type:"chargers",text:"当前节点/负责人"});break;case"deleter":e.extend(s,{name:"deleter",type:"user",text:"删除人"});break;case"deleteTime":e.extend(s,{name:"deleteTime",type:"datetime",format:"yyyy-MM-dd HH:mm:ss",text:"删除时间"});break;default:return null}return s},createWidgetName:function(){return"_widget_"+FX.STATIC.IDBase++},formatFileSize:function(e){return FX.Utils.isNumber(e)?e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB":"未知"},formatData:function(e,t){if(!e)return t;var i=e.cellFmt&&e.cellFmt.data||e.format;switch(e.type){case"datetime":(i=i||"yyyy-MM-dd")&&t&&(t=FX.Utils.date2Str(new Date(t),i));break;case"address":i=i||"pcda",t=FX.Utils.address2Str(t,"",i);break;case"location":i=i||"pcda";var a="";e.lnglatVisible&&(a=FX.Utils.getLnglatText(t)),t={address:FX.Utils.address2Str(t,"",i),lngLat:a};break;case"number":case"formula":i=i||"",t=FX.Utils.num2Str(t,i);break;case"text":t=t||"","creator"!==e.name||FX.Utils.isString(t)||(t=t?t.name:"");break;default:t=FX.Utils.isNull(t)?"":t}return t},chunkArray:function(e,t){var i=[];if(!t||!e.length)return i;for(var a=0,s=e.length;a<s;a+=t){var n=e.slice(a,a+t);i.push(n)}return i},UUID:function(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,this.UUID)},GCD:function(e,t){return t?this.GCD(t,e%t):e},LCM:function(e,t){return e*t/this.GCD(e,t)},str2num:function(e){if(FX.Utils.isEmpty(e))return null;var t=parseFloat(e);return isNaN(t)?null:t},fixDecimalPrecision:function(e,t){var i="";if(t||(t=8),!this.isEmpty(e)){var a=parseFloat(e);if(!isNaN(a)){var s=(a+"").split(".")[1];i=s&&s.length>t?parseFloat(FX.Utils.toFixed(a,t)):a,t>6&&Math.abs(i)<1&&/e-/.test(i+"")&&(i=parseFloat(FX.Utils.toFixed(a,6)))}}return i},toFixed:function(e,t){return new Big(e).toFixed(t).toString()},getSelectionText:function(){return window.getSelection?window.getSelection().toString():document.selection&&document.selection.createRange?document.selection.createRange().text:""},getCorpType:function(e){return e?(e=e.toLowerCase(),/^ding/.test(e)?"dingtalk":/^w/.test(e)?"wechat":"internal"):null},isFromWorkWechat:function(e){return!(!e||!e.username)&&/^wxtmp-/.test(e.username)},isFromDingDing:function(e){return!(!e||!e.username)&&/^dingtmp-/.test(e.username)},isCorpSuiteAdmin:function(e){var t=FX.Utils.getCorpType(e);return t&&("dingtalk"===t||"wechat"===t)},parseNumber:function(e){var t=parseFloat(e);return!isNaN(t)&&isFinite(t)?t:null},getWeekStartDate:function(e){var t=e.getDay();return 0===t&&(t=7),new Date(e.getFullYear(),e.getMonth(),e.getDate()-(t-1))},getWeekEndDate:function(e){var t=e.getDay();return 0===t&&(t=7),new Date(e.getFullYear(),e.getMonth(),e.getDate()+(7-t))},getMonthStartDate:function(e){return new Date(e.getFullYear(),e.getMonth(),1)},getMonthEndDate:function(e){return new Date(e.getFullYear(),e.getMonth()+1,0)},setPageTitle:function(e){FX.Utils.isEmpty(e)||(document.title=e)},createMask:function(t,i){var a=e('<div class="x-window-mask"/>'),s=i||{};if(s.isModal&&a.addClass("modal"),s.isLight?a.addClass("light"):s.isDark&&a.addClass("dark"),s.hasLoader){var n=!s.isDark;this.createLoadIcon(a,n)}return t&&a.css({"z-index":FX.STATIC.zIndex++}).appendTo(t),a},createLoadIcon:function(t,i){var a=e('<div class="x-loader-icon"/>').appendTo(t);return i&&a.addClass("colorful"),e("<div/>").appendTo(a),a},createQrcodeBtn:function(t,i){i=i||"icon-qrcode";var a=e("<a/>").attr("title","二维码").append(e("<i/>").addClass(i)).on("click",function(){FX.Utils.createQrcodeDropDown(a,t,"扫描二维码，分享给好友")});return a},createQrcodeDropDown:function(t,i,a){var s=e('<div class="qrcode-dropdown"/>');e("<img/>").attr("src","/qrcode?u="+encodeURIComponent(i)).appendTo(s),e("<div/>").text(a).appendTo(s),FX.Msg.bubble({anchor:t,text4Ok:null,minWidth:150,text4Cancel:null,contentHTML:s,edge:200})},doPrint:function(t,i){e("body").children("div, svg").addClass("x-ui-notprint");var a=e("#x-printer").removeClass().empty();0===a.length&&(a=e('<div id="x-printer"/>').appendTo("body")),t&&a.append(t),i=FX.Utils.isNull(i)?0:i,setTimeout(function(){window.print()},i)},cancelPrint:function(){e("body").children(".x-ui-notprint").removeClass("x-ui-notprint"),e("#x-printer").remove()},parseMm2Pt:function(e){return parseFloat((e/25.4*FX.CONST.PRINT_DPI).toFixed(6))},parsePt2Mm:function(e){return parseFloat((e/FX.CONST.PRINT_DPI*25.4).toFixed(6))},copyToClipboard:function(e,t){if(e&&e.length){var i=document.createElement("textarea");i.style.background="transparent",i.style.color="transparent",i.value=e,document.body.appendChild(i),i.select();var a;try{a=document.execCommand("copy")}catch(e){a=!1}document.body.removeChild(i),a&&FX.Utils.applyFunc(this,t,[],!1)}},getFlowOption:function(e,t){var i={btn:{}},a=i.btn;switch(e.hasPrint&&(a.print={text:"打印"}),t){case"stash":case"todo":e.isEditable&&e.currentFlowId!==FX.CONST.WORKFLOW.END_FLOW_ID&&(a.forward={text:FX.Utils.getFlowActionText("forward",e)},e.allowSave&&(a.save={text:FX.Utils.getFlowActionText("save",e)}),e.allowBack&&(a.back={text:FX.Utils.getFlowActionText("back",e)}),e.allowClose&&(a.close={text:FX.Utils.getFlowActionText("close",e)}),e.hasPrint&&(a.print={text:FX.Utils.getFlowActionText("print",e)}),e.allowTransfer&&(a.transfer={text:FX.Utils.getFlowActionText("transfer",e)}),i.comment=e.comment,i.signature=e.signature,i.isEditable=!0);break;case"create":e.allowRevoke&&(a.revoke={text:FX.Utils.getFlowActionText("revoke")})}i.flowState=e.data.flowState,i.version=e.data.flowVer,i.hasLogView=e.hasLogView,i.chargers=e.data.chargers,i.transactors=e.data.transactors,i.dataId=e.data._id,i.ccUsers=e.data.ccUsers,i.flowStack=e.data.flowStack;var s=[];return FX.Utils.isArray(e.flowNodes)&&e.flowNodes.length>0&&(s=e.flowNodes.filter(function(e){return"todo"===t?"charger"===e.type:"part"===t?"transactor"===e.type:void 0})),i.flowId=e.currentFlowId,i.printId=e.printId,i.flowNodes=s,i.backNodes=e.backNodes,i},getFlowActionText:function(e,t){t=t||{};var i="",a=FX.CONST.FLOW_ACTION_NAME[e];switch(e){case"forward":i=t.submit_text||a;break;case"save":i=t.save_text||a;break;case"print":i=t.print_text||a;break;case"back":i=t.back_text||a;break;case"transfer":i=t.transfer_text||a;break;case"close":i=t.close_text||a;break;default:i=a}return i},getCurrentCorp:function(){return FX.STATIC.currentCorpId||FX.STATIC.corpId},isCorpCreator:function(){var e=FX.Utils.getCurrentCorp(),t=FX.STATIC.user?FX.STATIC.user.corpId:"";return!(!e||!t)&&e===t},getTeamManageText:function(){return"通讯录"},getColorNumber:function(e){return FX.Utils.isEmpty(e)?1:parseInt(e.toString().substring(0,8),16)%6+1},getShowFieldItems:function(e,t,i){var a=[],s={};return FX.Utils.forEach(e,function(e,t){"subform"===t.type?FX.Utils.forEach(t.items,function(e,i){s[[t.name,i.name].join(".")]=!0}):s[t.name]=!0}),FX.Utils.forEach(t,function(e,t){if(!(i&&i.indexOf(t.type)<0)){var n={text:"chargers"===t.type?"当前节点/负责人":t.text,value:t.name};n.selected=s[n.value],"subform"===t.type?FX.Utils.forEach(t.items,function(e,n){if(!(i&&i.indexOf(n.type)<0)){var o={value:[t.name,n.name].join("."),text:[t.text,n.text].join(".")};o.selected=s[o.value],a.push(o)}}):a.push(n)}}),a},getFieldAttr:function(t,i){if(!FX.Utils.isValueWidget(t.widget.type))return null;if(i&&i.indexOf(t.widget.type)<0)return null;var a={id:t.formId,text:t.label,name:t.widget.widgetName,type:t.widget.type};switch(t.widget.type){case"subform":var s=[];FX.Utils.forEach(t.widget.items,function(a,n){e.extend(n,{formId:t.formId});var o=FX.Utils.getFieldAttr(n,i);o&&(e.extend(o,{subform:t.widget.widgetName}),s.push(o))}),e.extend(a,{items:s});break;case"linkdata":e.extend(a,{linkForm:t.widget.linkForm,linkFields:t.widget.linkFields,linkType:t.widget.linkType,linkKey:t.widget.linkKey,refAppId:t.widget.refAppId});break;case"combo":case"combocheck":case"radiogroup":case"checkboxgroup":e.extend(a,{async:t.widget.async,items:t.widget.items});break;case"datetime":e.extend(a,{format:t.widget.format});break;case"address":e.extend(a,{needDetail:t.widget.needDetail});break;case"location":e.extend(a,{lnglatVisible:t.widget.lnglatVisible})}return a},leftPad:function(e,t,i){var a=String(e);for(i||(i=" ");a.length<t;)a=i+a;return a.toString()},startWith:function(e,t){var i=e.length;return!(null==t||""==t||0===i||t.length>i)&&e.substr(0,t.length)==t},getFieldInfoByFormula:function(e){var t={},i=(e+"").match(/(\$[0-9a-zA-Z\._]+)(#[0-9a-f]+)?(@[0-9a-f]+)?/),a=["","field","entryId","appId"];return FX.Utils.forEach(i,function(e,i){0!==e&&i&&(t[a[e]]=i.substr(1))}),t},getFieldInfoById:function(e){var t={},i=(e="#"+e).match(/(#[0-9a-f]+)(@[0-9a-f]+)?/),a=["","entryId","appId"];return FX.Utils.forEach(i,function(e,i){0!==e&&i&&(t[a[e]]=i.substr(1))}),t},fieldAuthValue2Json:function(e){return{visible:!!(1&e),enable:!!(2&e),brief:!!(4&e),subform_create:!!(16&e),subform_edit:!!(32&e),subform_delete:!!(64&e)}},fieldAuthJson2Value:function(e){return(+e.visible<<0)+(+e.enable<<1)+(+e.brief<<2)+(+e.subform_create<<4)+(+e.subform_edit<<5)+(+e.subform_delete<<6)},isFieldAuthVisible:function(e){return 1&e},isFieldValid:function(e){return/^_widget_/.test(e)},getSubformRowIdx:function(t){return e(t.element).closest(".subform-row").data("row-idx")},getSubformWidgetWidth:function(e){var t=150;switch(e.type){case"datetime":t=180;break;case"combo":case"combocheck":case"checkboxgroup":case"user":case"usergroup":case"dept":case"deptgroup":t=200;break;case"address":case"textarea":case"location":t=250}switch(e.fieldWidth){case FX.CONST.FIELD_WIDTH.HALF:"datetime"===e.type?t=2*t/3:t/=2;break;case FX.CONST.FIELD_WIDTH.TWICE:t*=2}return t},setLayoutSize:function(t,i,a){switch(i){case"normal":e.extend(t,FX.Utils.getNormalLayoutSize(a));break;case"grid-2":e.extend(t,FX.Utils.getGrid2LayoutSize(a));break;case"full-line":e.extend(t,FX.Utils.getFullLineLayoutSize(a))}"linkquery"!==t.type&&"linkdata"!==t.type||e.extend(t,{layout:i})},getNormalLayoutSize:function(e){switch(e){case"location":return{width:330,btnWidth:330};case"image":case"upload":return{width:"100%",thumbWidth:65,thumbHeight:65};case"subform":return{tipWidth:330};case"linkdata":case"linkquery":return{width:330,btnWidth:330};case"text":case"number":case"datetime":case"combo":case"combocheck":return{widget:330,height:30};case"user":case"dept":return{width:330,height:40};case"checkboxgroup":return{width:720};case"usergroup":case"deptgroup":return{width:720,height:80};case"textarea":return{width:720,height:140};case"radiogroup":return{width:720,otherInputWidth:274};case"address":return{width:720,width4province:310,width4city:200,width4district:200};case"signature":return{width:null,height:null};default:return{}}},getGrid2LayoutSize:function(e){switch(e){case"location":return{width:330,btnWidth:330};case"image":case"upload":return{width:"100%",thumbWidth:65,thumbHeight:65};case"subform":return{tipWidth:330};case"linkdata":case"linkquery":return{width:330,btnWidth:330};case"text":case"number":case"datetime":case"combo":case"combocheck":return{width:330,height:30};case"user":case"dept":return{width:330,height:40};case"checkboxgroup":return{width:330};case"usergroup":case"deptgroup":return{width:330,height:80};case"textarea":return{width:330,height:140};case"radiogroup":return{width:330,otherInputWidth:274};case"address":return{width:330,width4province:150,width4city:85,width4district:85};case"signature":return{width:null,height:null};default:return{}}},getFullLineLayoutSize:function(e){switch(e){case"location":return{width:720,btnWidth:330};case"image":case"upload":return{width:"100%",thumbWidth:65,thumbHeight:65};case"subform":return{tipWidth:330};case"linkdata":case"linkquery":return{width:720,btnWidth:720};case"text":case"number":case"datetime":case"combo":case"combocheck":return{width:720,height:30};case"user":case"dept":return{width:720,height:40};case"checkboxgroup":return{width:720};case"usergroup":case"deptgroup":return{width:720,height:80};case"textarea":return{width:720,height:140};case"radiogroup":return{width:720,otherInputWidth:664};case"address":return{width:720,width4province:310,width4city:200,width4district:200};case"signature":return{width:null,height:null};default:return{}}},fileDownload:function(e,t){FX.Utils.redirectTo(e)},isSupportPdf:function(){return void 0!==navigator.mimeTypes["application/pdf"]},isExternalLink:function(){return FX.STATIC.FTOKEN||FX.STATIC.RTOKEN||FX.STATIC.ATOKEN||FX.STATIC.DTOKEN},isMembersEmpty:function(e){return!!FX.Utils.isObjectEmpty(e)||!e.creator&&!e.charger&&!e.chargerDeptManager&&!e.deptManager&&!e.hasCurrentUser&&!e.hasCurrentDept&&FX.Utils.isObjectEmpty(e.widgets)&&FX.Utils.isObjectEmpty(e.departs)&&FX.Utils.isObjectEmpty(e.users)&&FX.Utils.isObjectEmpty(e.deptWidgets)&&FX.Utils.isObjectEmpty(e.deptMgrWidgets)&&FX.Utils.isObjectEmpty(e.contacts)&&FX.Utils.isObjectEmpty(e.roles)},dt:function(t,i){if(t){var a=["e="+t,"t="+(new Date).getTime()];FX.Utils.isEmpty(i)||a.push("ext="+i),FX.STATIC.user&&FX.STATIC.user.username&&a.push("u="+FX.STATIC.user.username),e.ajax({type:"GET",url:FX.CONFIG.HOST.TRACK_HOST+"/log?"+a.join("&")})}},createSvgEl:function(t,i){return e(document.createElementNS("http://www.w3.org/2000/svg",t)).attr(i||{})},getTargetUrl:function(e,t){var i="/dashboard";switch(e){case"aggregateList":i+="#/app/"+t.appId+"/set/app-aggregate";break;case"printList":i+="/app/"+t.appId+"/form/"+t.entryId+"/edit?action=print#/set";break;case"formData":i+="/app/"+t.appId+"/form/"+t.entryId+"/edit#/data";break;case"etl":i+="#/app/"+t.appId+"/set/app-etl";break;case"trigger":i+="#/app/"+t.appId+"/set/app-trigger"}return i},formatOrderProduct:function(e){var t="";switch(e.type){case"level":t=FX.CONST.VIP_ORDER.PACK[e.value].name;break;case"service":t=FX.CONST.VIP_ORDER.SERVICE[e.value].name;break;case"user":t="按用户数购买 * "+e.value+"人";break;case"data_addon":t="总数据量增购包10万条 * "+e.value/FX.CONST.VIP_ORDER.DATA_ADD_UNIT;break;case"form_data_addon":t="单表数据上限增购包 * "+e.value/FX.CONST.VIP_ORDER.FORM_DATA_UNIT+"万条";break;case"data_api_addon":t="数据接口";break;case"upload_addon":t="附件上传增购包 * "+e.value/FX.CONST.VIP_ORDER.UPLOAD_ADD_UNIT+"GB";break;case"aggregate_addon":t="聚合表增购包 * "+e.value+"个/应用";break;case"data_backup_addon":t="数据回收站 * "+e.value+"天";break;case"managers_addon":t="子管理员 * "+e.value+"人"}return t},addClsToSystemField:function(t,i){return FX.Utils.forEach(t,function(t,a){var s=a.value;/^_widget_/.test(s)||e.extend(a,{cls:i})}),t},parseMembers2Ids:function(e){var t={};return FX.Utils.forEach(e,function(e,i){switch(e){case"users":case"departs":case"roles":case"contacts":t[e]=i.map(function(e){return e._id});break;default:t[e]=i}}),t},format2ThumbDate:function(e){if(FX.Utils.isNull(e))return null;var t,i=new Date(e),a=new Date,s=a.getTime()-i.getTime(),n=+a.setHours(0,0,0,0),o=+a.setHours(23,59,59,999);return 0<=s&&s<36e5?(t=parseInt(s/6e4,10))?t+"分钟前":"刚刚":n<+i&&+i<=o?"今天"+FX.Utils.leftPad(i.getHours()+"",2,"0")+":"+FX.Utils.leftPad(i.getMinutes()+"",2,"0"):FX.Utils.date2Str(i,"yyyy-MM-dd HH:mm:dd")},getDateInfoFromNow:function(e){if(FX.Utils.isNull(e))return null;var t={isLater:!0},i=new Date(e),a=(new Date).getTime()-i.getTime();a>0&&(t.isLater=!1);return(a=Math.abs(a))>=864e5?(t.day=parseInt(a/864e5,10),t.hour=parseInt(a%864e5/36e5,10),t.minute=parseInt(a%864e5%36e5/6e4,10)):a>=36e5?(t.hour=parseInt(a/36e5,10),t.minute=parseInt(a%36e5/6e4,10)):a>=6e4?t.minute=parseInt(a/6e4,10):t.isJustNow=!0,t},formatUserThumb:function(e){if(!FX.Utils.isEmpty(e))return{color:e.charCodeAt(0)%6,name:e.substr(0,1).toUpperCase()}},getCouponTip:function(e){var t=[];if(e.discount<1){var i=[];FX.Utils.forEach(e.levels,function(e,t){FX.CONST.VIP_ORDER.PACK[t]&&i.push(FX.CONST.VIP_ORDER.PACK[t].name)}),t.push("折扣仅对"+i.join("或")+"「套餐」生效")}return t.join("，")},isPdfExt:function(e){return/^pdf$/i.test(e)},isOfficeExt:function(e){return/^(doc|docx|ppt|pptx|xls|xlsx)$/i.test(e)},isImageExt:function(e){return/^(png|jpg|jpeg|gif)$/i.test(e)},getArrayFromRange:function(e,t){var i=[];switch(t){case"number":i.push(FX.Utils.isNull(e.min)?null:e.min),i.push(FX.Utils.isNull(e.max)?null:e.max);break;case"address":i.push(e.province||null),i.push(e.city||null),i.push(e.district||null);break;case"datetime":i.push(e.min?FX.Utils.date2Str(new Date(e.min),"yyyy-MM-dd"):null),i.push(e.max?FX.Utils.date2Str(new Date(e.max),"yyyy-MM-dd"):null)}return i},createFileThumb:function(t,i){i=i||"normal";var a=["ppt","pptx","doc","docx","xls","xlsx","zip","rar","csv","txt","pdf"].indexOf(t)>-1?t:"other";return e('<div class="fui_file_thumb '+a+" size-"+i+'"/>')},getFileOnlineUrl:function(e,t){return FX.Utils.isPdfExt(e)?"https://assets.jiandaoyun.com/shared/pdfjs/1.10/web/viewer.html?file="+encodeURIComponent(t):FX.Utils.isOfficeExt(e)?"https://view.officeapps.live.com/op/view.aspx?src="+encodeURIComponent(t):void 0},getRandomCode:function(e,t){for(var i=t||"1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",a="";e>0;)a+=i[Math.floor(Math.random()*i.length)],e--;return a},resolveUsername:function(e,t){return t=t||"nickname",FX.Utils.isObjectEmpty(e)?"":FX.Utils.isString(e)?e:e._id===FX.USER_ID.SYS_ROBOT?"系统机器人":e[t]||""},limitText:function(e,t){if(FX.Utils.isEmpty(e))return"";var i=t||10;return e.length>i&&(e=e.slice(0,i)+"..."),e},getShowFieldsByNames:function(t,i){var a=[];return i?FX.Utils.forEach(t,function(t,s){if("subform"===s.type){var n=[];FX.Utils.forEach(s.items,function(e,t){i.indexOf([s.name,t.name].join("."))>-1&&n.push(t)}),FX.Utils.isObjectEmpty(n)||a.push(e.extend({},s,{items:n}))}else i.indexOf(s.name)>-1&&a.push(s)}):a=t,a},formatSubformName:function(t,i,a){if(FX.Utils.isObjectEmpty(t))return null;if(i=i||"name",a=a||"name",t.subform&&t[a]&&t[a].indexOf(".")<0){var s={};return s[a]=t.subform+"."+t[i],e.extend(!0,{},t,s)}return t},getFieldsByLimits:function(t,i,a){var s=[];return FX.Utils.forEach(t,function(t,n){i.indexOf(n.type)>-1?s.push(n):"subform"===n.type&&a&&FX.Utils.forEach(n.items,function(t,a){i.indexOf(a.type)>-1&&s.push(e.extend({},a,{name:[n.name,a.name].join("."),text:[n.text,a.text].join(".")}))})}),s},showTemplate:function(t,i){if(t){FX.Utils.dt(FX.CONST.TRACKER.APP_VIEW);var a=e.extend({judgeState:!1,channel:null},i),s=FX.CONFIG.HOST.SITE_HOST+"/template/"+t._id,n="/dashboard/app/"+t._id+"?__hideHeader=true",o=e('<div class="iframe-container"/>'),l=e('<div class="container-header"/>').appendTo(o);if(e('<div class="header-thumb"><i class="icon-cover-'+t.icon+" color-"+t.color+'"></i></div>').appendTo(l),e('<div class="header-title">'+t.name+"</div>").appendTo(l),e(".header-title",l).after(e('<div class="header-desc"/>').text(t.description)),!a.judgeState||a.judgeState&&t.state===FX.CONST.APP_STATE.onSale){var r=e('<div class="header-btn-group"/>').appendTo(l);FX.Utils.isEmpty(t.usecase)||e('<a class="btn-item" target="fx_help" href="'+decodeURIComponent(t.usecase)+'"><div class="item-text"><i class="text-icon icon-usage"/><span>使用案例</span></div></a>').appendTo(r),e('<div class="btn-item"><div class="item-text"><i class="text-icon icon-share"></i><span>分享</span></div></div>').on("click",function(){new FX.Dialog({title:"分享",width:600,customCls:"fx_template_dialog",onContentCreate:function(t){var i=e('<div class="template-body"/>').appendTo(t);e('<div class="line-label">请复制以下链接来分享应用</div>').appendTo(i),new FX.ShareUrlPane({renderEl:e("<div/>").appendTo(i),url:s})}}).show()}).appendTo(r),new FX.Button({renderEl:e('<div class="btn-item"/>').appendTo(r),height:32,text:"安装应用",style:"green",onClick:function(){FX.STATIC.APPID=t._id;var e={forkId:FX.STATIC.APPID,corpId:FX.Utils.getCurrentCorp()};a.channel&&(e.channel=a.channel),FX.Utils.ajax({url:FX.Utils.getApi(FX.API.app.install),data:e},function(e){FX.Utils.dt(FX.CONST.TRACKER.APP_FORK),d.close(),a.onClose&&a.onClose(),FX.Utils.redirectTo("/dashboard#/app/"+e.app._id+"/edit")},function(e){var t=e.responseJSON||{};FX.Utils.getTemplateTrail(t)})}})}e('<div class="container-body"><iframe width="100%" height="100%" frameborder="0" src="'+n+'"/></div>').appendTo(o);var d=new FX.Slider({title:t.name,content:o});d.show()}},hasDashAggregateFunc:function(e){return new RegExp(FX.CONST.DASH_AGGREGATE_FUNC.join("|")).test(e)},getVipTrail:function(t){FX.Utils.ajax({url:FX.Utils.getApi(FX.API.profile.start_trail)},function(i){if(i&&i.errCode){var a=i.user;switch(i.errCode){case 1069:var s={isVIPTrail:!0,user:a};FX.Utils.isRegtimeBeforeUpdate("persona",a.regTime)||e.extend(s,{isOldUser:!1}),FX.Utils.isPersonaNeedPhone(a)&&e.extend(s,{needPhone:!0}),new FX.PersonaDialog(s).show()}}else FX.Msg.alert(e.extend({type:"success",title:"领取成功",msg:"您已领取简道云高级功能30天试用期。",text4Ok:"开始使用",text4Cancel:null,onOk:function(){if(FX.STATIC.user){var e=FX.Cookie.get(FX.STATIC.user.username+FX.CONST.VIP_COOKIE.TRAIL.SUFFIX_KEY);e&&1===(e=e.split(",")).length&&(e.push(+new Date),FX.Cookie.set(FX.STATIC.user.username+FX.CONST.VIP_COOKIE.TRAIL.SUFFIX_KEY,e.join(","),{expires:FX.CONST.VIP_COOKIE.TRAIL.EXPIRES_DATE})),window.location.reload()}}},t))})},getTemplateTrail:function(e){if(e)switch(e.code){case 7126:FX.Msg.alert({title:"模板中包含高级功能，是否领取试用?",msg:"此模板中包含的功能已超出您当前使用的版本，是否领取高级功能30天试用期?",type:"query",text4Ok:"开始试用",text4Cancel:"暂不试用",onOk:function(){FX.Utils.getVipTrail({title:"领取成功，请返回安装模板",msg:"您已领取简道云高级功能30天试用期。",text4Ok:null,text4Cancel:"我知道了"})}});break;case 7127:FX.Msg.alert({title:"模板中包含高级功能，是否领取试用?",msg:"此模板中包含的功能已超出您当前使用的版本，是否领取高级功能7天试用期?",type:"query",text4Ok:"开始试用",text4Cancel:"暂不试用",onOk:function(){FX.Utils.dt(FX.CONST.TRACKER.TRAIL_SECOND),FX.Utils.getVipTrail({title:"领取成功，请返回安装模板",msg:"您已领取简道云高级功能7天试用期。",text4Ok:null,text4Cancel:"我知道了"})}});break;case 2014:FX.Msg.alert({title:"安装失败",msg:e.msg,type:"warning"});break;default:FX.Msg.alert({title:"安装失败",msg:"此模板包含的高级功能已超出您当前使用的版本。如需体验请请升级您的账号。",type:"warning",text4Ok:"立即升级",text4Cancel:"暂不升级",onOk:function(){var t=FX.CONST.VIP_ERR_MSG_MAP[e.code]||{},i=FX.Utils.getApi(FX.API.profile.order_compare)+"?addon="+t.addon;FX.Utils.redirectTo(i)}})}},skipEmptyStringify:function(e){return JSON.stringify(e,function(e,t){if(!FX.Utils.isObjectEmpty(t))return t})||""},filterFieldsByLimit:function(t,i){if(!i)return t;var a=[];return FX.Utils.forEach(t,function(t,s){if(i.indexOf(s.type)>-1)if("subform"===s.type){var n=[];FX.Utils.forEach(s.items,function(e,t){i.indexOf(t.type)>-1&&n.push(t)}),a.push(e.extend({},s,{items:n}))}else a.push(s)}),a},escapeHtmlSpecialChar:function(e){return e.replace(/[<>"&]/g,function(e,t,i){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case'"':return"&quot;"}})},loadScript:function(t,i){if(e("script[src^='"+t+"']").length<=0){var a=document.createElement("script");a.type="text/javascript",a.src=t,document.body.appendChild(a),a.addEventListener("load",i)}else i&&i()},uploadFile:function(t,i,a,s,n){var o=e.extend({uploadSite:"qn",uploadUrl:"https://up.qbox.me",uploadToMedia:!1,uploadToForm:!1,appId:FX.STATIC.APPID,entryId:FX.STATIC.ENTRYID,uploadToken:"",widgetName:"",uploader:FX.STATIC.user?FX.STATIC.user._id:""},t),l=new FormData;if("qn"===o.uploadSite)l.append("file",i),l.append("token",o.uploadToken),l.append("x:bucketType",o.uploadToMedia?FX.CONST.QN_BUCKET.PUBLIC_IMAGE:FX.CONST.QN_BUCKET.PRIVATE_FILE),l.append("x:uploader",o.uploader),o.uploadToForm&&(l.append("x:appId",o.appId),l.append("x:entryId",o.entryId),l.append("x:field",o.widgetName));else if("oss"===o.uploadSite){var r=FX.Utils.UUID(),d=o.uploadToken.split(":");l.append("Signature",d[2]),l.append("OSSAccessKeyId",d[0]),l.append("policy",d[1]),l.append("callback",d[3]),l.append("x:file_name",i.name),l.append("x:bucket_type",FX.CONST.OSS_BUCKET.PUBLIC_IMAGE),l.append("x:uploader",o.uploader),l.append("key",r),l.append("file",i)}else l.append("file",i);FX.Utils.ajaxUpload({url:o.uploadUrl,data:l,onUpload:a},function(e){if(!e.file)return n();"qn"===o.uploadSite||"oss"===o.uploadSite?s(e):s&&s.apply(this,arguments)},n)},debounce:function(e,t,i){t=t||0;var a=null;return function(){a&&clearTimeout(a);var s=arguments;a=setTimeout(function(){FX.Utils.applyFunc(i,e,s,!1)},t)}},getLnglatText:function(e){return FX.Utils.isObjectEmpty(e)||FX.Utils.isObjectEmpty(e.lnglatXY)?"":"纬度："+FX.Utils.fixDecimalPrecision(e.lnglatXY[1],6)+"，经度："+FX.Utils.fixDecimalPrecision(e.lnglatXY[0],6)},getDropDownPos:function(t,i){var a={"z-Index":FX.STATIC.zIndex++},s=t.offset(),n=document.body.clientWidth-s.left;n<i.width?(a.right=n-this.element.outerWidth(),a.left="auto"):(a.right="auto",a.left=s.left+20);var o=document.body.clientHeight+document.body.scrollTop-s.top-t.height(),l=e("body").offset().top;return o<i.height?(a.top="auto",a.bottom=document.body.clientHeight-s.top+l):(a.top=s.top+30-l,a.bottom="auto"),a}})}(jQuery),function(e){FX.FormUtils=FX.FormUtils||{},e.extend(FX.FormUtils,{getWidgetDefaultConfig:function(t){var i={type:t,enable:!0,visible:!0,allowBlank:!0};switch(t){case"datetime":e.extend(i,{format:"yyyy-MM-dd"});break;case"checkboxgroup":case"radiogroup":case"combo":case"combocheck":e.extend(i,{items:[{value:"选项1",text:"选项1"},{value:"选项2",text:"选项2"},{value:"选项3",text:"选项3"}]});break;case"address":e.extend(i,{needDetail:!0});break;case"image":case"upload":e.extend(i,{maxFileCount:FX.CONST.UPLOAD_FILE_COUNT.MULTI});break;case"number":e.extend(i,{allowDecimals:!0});break;case"subform":e.extend(i,{subform_create:!0,subform_edit:!0,subform_delete:!0,items:[]});break;case"dept":case"deptgroup":e.extend(i,{valueOption:FX.WidgetValueOption.CUSTOM});break;case"separator":e.extend(i,{lineStyle:"thin"})}return i}})}(jQuery),jQuery.extend(FX.Utils,{needDotGuide:function(e){FX.STATIC.user&&FX.STATIC.user.regTime;return!1},getTimeById:function(e){var t=e.toString().substr(0,8);return new Date(1e3*parseInt(t,16))},isRegtimeBeforeUpdate:function(e,t){var i=FX.STATIC.user?FX.STATIC.user.regTime:t||"";if(!i)return!1;var a=new Date(i),s=!1;switch(e){case"persona":s=a<new Date(2017,11,4).getTime();break;case"formGuide":s=a<new Date(2018,1,26).getTime();break;case"referrer":s=a<new Date(2018,2,14).getTime()}return s},handleInviteGuide:function(e,t,i){FX.Utils.needInviteGuide()?FX.Utils.ajax({url:FX.Utils.getApi(FX.API.corp.department_list_member,FX.CONST.DEPARTMENT_ROOT),data:{corpId:FX.Utils.getCurrentCorp(),limit:1}},function(a){a.count>1?(FX.Cookie.set(FX.STATIC.user._id+FX.CONST.COOKIE.INVITE_MEMBER.SUFFIX_KEY,FX.CONST.COOKIE.INVITE_MEMBER.VALUE,{expires:FX.CONST.COOKIE.INVITE_MEMBER.EXPIRES,path:"/"}),t&&t()):(e&&FX.UI.inviteGuide(e),i&&i())}):t&&t()},needInviteGuide:function(){return"internal"===FX.STATIC.user.corpType&&FX.Utils.getCurrentCorp()===FX.STATIC.user.corpId&&!FX.Cookie.get(FX.STATIC.user._id+FX.CONST.COOKIE.INVITE_MEMBER.SUFFIX_KEY)},getMeiQiaURL:function(){var e=FX.STATIC.vipService&&"basic"!==FX.STATIC.vipService?FX.MEI_QIA.VIP:FX.MEI_QIA.FREE,t=FX.STATIC.user||{},i={id:t._id,name:t.username,nickname:t.nickname,tel:t.phone,email:t.email,regTime:t.regTime,corpId:t.corpId,corpType:t.corpType,vip:t.vip,vipService:t.vipService,vipBufDays:t.vipBufDays,vipTrail:t.vipTrail&&FX.Utils.date2Str(new Date(t.vipTrail),"yyyy-MM-dd")};return e+="&metadata="+encodeURIComponent(JSON.stringify(i))},isPersonaNeedPhone:function(e){return!FX.Utils.isFromWorkWechat(e)&&!FX.Utils.isFromDingDing(e)&&!e.phone},isPersonaComplete:function(){var e=!0,t=FX.STATIC.user;if(t.corpId===FX.Utils.getCurrentCorp()){var i=["job","favorites"];FX.Utils.isFromWorkWechat(t)||(i.push("company","corpSize","industry"),FX.Utils.isFromDingDing(t)||i.push("phone")),FX.Utils.forEach(i,function(t,i){if(!FX.STATIC.user[i])return e=!1,!1})}return e}}),function(e){e.extend(FX.Utils,{getLinkFilter:function(t,i){var a={type:t.type};switch(e.extend(a,FX.Utils.dealFilterFieldName(t)),t.type){case"datetime":a.method=FX.CONST.FILTER_METHOD.RG,a.value=i;break;case"address":case"location":a.type="address",a.method=FX.CONST.FILTER_METHOD.ALL,a.value=i;break;case"user":case"id":a.type="user",a.method=FX.CONST.FILTER_METHOD.IN,a.value=e.makeArray(i);break;case"dept":case"did":a.type="dept",a.method=FX.CONST.FILTER_METHOD.IN,a.value=e.makeArray(i);break;case"number":a.method=FX.CONST.FILTER_METHOD.EQ,a.value=e.makeArray(i);break;case"linkdata":"number"===t.linkType?(a.keyType="number",a.method=FX.CONST.FILTER_METHOD.EQ):(a.keyType="text",a.method=FX.CONST.FILTER_METHOD.IN),a.value=e.makeArray(i);break;default:"creator"===t.name?(a.type="user",a.method=FX.CONST.FILTER_METHOD.IN,a.value=e.makeArray(i)):(a.type="text",a.method=FX.CONST.FILTER_METHOD.IN,a.value=e.makeArray(i))}return a},dealFilterFieldName:function(e){var t={};if(/\./.test(e.name)){var i=e.name.split(".");t.subform=i[0],t.subField=i[1]}else t.field=e.name;return t},dealFilterInfoByField:function(t){var i=FX.Utils.getFieldInfoById(t.id),a=FX.Utils.dealFilterFieldName(t);return e.extend({},i,a)},dealFormFilterCond:function(e){if(e&&e.cond){var t=[];FX.Utils.forEach(e.cond,function(e,i){i.entryId=void 0,t.push(i)}),e.cond=t}return e},pretreatFormFilterCond:function(e){var t=[];return e&&(FX.Utils.forEach(e,function(e,t){t.entryId=void 0}),t=e),t},getDateRange:function(e){var t="yyyy-MM-dd",i=new Date,a=[];if(FX.Utils.isNull(e.day))if(FX.Utils.isNull(e.week))FX.Utils.isNull(e.month)?FX.Utils.isNull(e.quarter)?(i.setFullYear(e.year,0,1),a.push(FX.Utils.date2Str(i,t)),i.setFullYear(e.year+1,0,1),i.setHours(0,0,0,0),a.push(FX.Utils.date2Str(new Date(i.getTime()-1),t))):(i.setFullYear(e.year,3*(e.quarter-1),1),a.push(FX.Utils.date2Str(i,t)),i.setFullYear(e.year,3*e.quarter,1),i.setHours(0,0,0,0),a.push(FX.Utils.date2Str(new Date(i.getTime()-1),t))):(i.setFullYear(e.year,e.month-1,1),a.push(FX.Utils.date2Str(i,t)),i.setFullYear(e.year,e.month,1),i.setHours(0,0,0,0),a.push(FX.Utils.date2Str(new Date(i.getTime()-1),t)));else{i.setFullYear(e.year,0,1);var s=(7-(i.getDay()||7)+1)%7;i.setTime(i.getTime()+864e5*(s+7*(e.week-1))),a.push(FX.Utils.date2Str(i,t)),i.setTime(i.getTime()+6048e5),i.setHours(0,0,0,0),a.push(FX.Utils.date2Str(new Date(i.getTime()-1),t))}else{i.setFullYear(e.year,e.month-1,e.day);var n=FX.Utils.date2Str(i,t);a=[n,n]}return a},formatDataFilter:function(e,t,i){var a="",i=i||"text",s=e.type;switch("linkdata"===s&&(s=e.linkType),s){case"textarea":case"text":case"linkdata":a=e[i]+" "+FX.Utils.getFilterMethodInfo(e.method,e.type)+" "+FX.Utils.formatFilterWidgetText(e);break;case"address":a=e[i]+" "+FX.Utils.getFilterMethodInfo(e.method,e.type)+" "+FX.Utils.formatFilterWidgetText(e,!1);break;case"combocheck":a=e[i]+" "+FX.Utils.getFilterMethodInfo(e.method,e.type,!0)+" "+FX.Utils.formatFilterWidgetText(e);break;case"formula":case"number":a=e[i]+" ";var n="",o="";e.value&&e.value.length&&(n=FX.Utils.isNull(e.value[0])?"":e.value[0],o=FX.Utils.isNull(e.value[1])?"":e.value[1]),e.method===FX.CONST.FILTER_METHOD.RG?a+="在"+n+"到"+o+"之间":a+=FX.Utils.getFilterMethodInfo(e.method)+" "+n;break;case"datetime":if(a=e[i]+" ",e.method===FX.CONST.FILTER_METHOD.RG)e.value&&e.value.length&&(e.value[0]&&(a+="在"+e.value[0]),e.value[1]&&(a+="到"+e.value[1]+"之间"));else if(e.method===FX.CONST.FILTER_METHOD.EQ){var l={today:"今天",yesterday:"昨天",thisWeek:"本周",lastWeek:"上周",thisMonth:"本月",lastMonth:"上月"};a+="等于 ",l[e.value]?a+=l[e.value]:e.value&&e.value.length&&(a+=e.value[0])}else a+=FX.Utils.getFilterMethodInfo(e.method),e.value&&e.value.length&&(a+=" "+e.value[0]);break;case"usergroup":case"user":FX.Utils.getUserOrDeptName("user",e.value,function(s){var n=[];FX.Utils.forEach(s.users,function(e,t){n.push(t.nickname)}),a=e[i]+" "+FX.Utils.getFilterMethodInfo(e.method)+" "+n.join("、"),t&&t(a)});break;case"deptgroup":case"dept":FX.Utils.getUserOrDeptName("dept",e.value,function(s){var n=[];FX.Utils.forEach(s.departments,function(e,t){n.push(t.name)}),a=e[i]+" "+FX.Utils.getFilterMethodInfo(e.method)+" "+n.join("、"),t&&t(a)});break;case"file_list":case"signature":a=e[i]+" "+FX.Utils.getFilterMethodInfo(e.method)}return a.trim()},getFilterType:function(e){var t;switch(e){case"text":case"radiogroup":case"combo":t="text";break;case"combocheck":case"checkboxgroup":t="combocheck";break;case"address":case"location":t="address";break;case"upload":case"image":t="file_list";break;default:t=e}return t},getFilterMethodInfo:function(e,t,i){var a={};return a[FX.CONST.FILTER_METHOD.EQ]={name:"等于"},a[FX.CONST.FILTER_METHOD.NE]={name:"不等于"},a[FX.CONST.FILTER_METHOD.ALL]={name:"address"!==t?"同时包含":"属于"},a[FX.CONST.FILTER_METHOD.IN]={name:i?"包含任意一个":"等于任意一个"},a[FX.CONST.FILTER_METHOD.NIN]={name:"address"!==t?"不等于任意一个":"不属于"},a[FX.CONST.FILTER_METHOD.LK]={name:"包含"},a[FX.CONST.FILTER_METHOD.ULK]={name:"不包含"},a[FX.CONST.FILTER_METHOD.EP]={name:"为空"},a[FX.CONST.FILTER_METHOD.NEP]={name:"不为空"},a[FX.CONST.FILTER_METHOD.GT]={name:"大于"},a[FX.CONST.FILTER_METHOD.GTE]={name:"大于等于"},a[FX.CONST.FILTER_METHOD.LT]={name:"小于"},a[FX.CONST.FILTER_METHOD.LTE]={name:"小于等于"},a[FX.CONST.FILTER_METHOD.RG]={name:"选择范围"},a[e]&&a[e].name||""},formatFilterWidgetText:function(e,t){if(t=!1!==t,e&&e.value){var i=[];return FX.Utils.forEach(e.value,function(e,t){FX.Utils.isString(t)&&i.push(t)}),i.join(t?"、":"")}return""},getUserOrDeptName:function(t,i,a){var s={members:i};"user"===t?e.extend(s,{isUserOnly:!0}):e.extend(s,{isDepartmentOnly:!0}),FX.Utils.ajax({url:FX.Utils.getApi(FX.API.corp.list_member_name),data:s},function(e){FX.Utils.applyFunc(this,a,[e],!1)})},getValidFilters:function(e){var t=[];return FX.Utils.forEach(e.cond,function(e,i){FX.Utils.checkFilterValid(i)&&t.push(i)}),{cond:t,rel:e.rel}},checkFilterValid:function(e){var t=FX.CONST.FILTER_METHOD;switch(e.type){case"address":switch(e.method){case t.ALL:case t.NIN:return!FX.Utils.isObjectEmpty(e.value);default:return!0}case"dept":case"user":switch(e.method){case t.EP:case t.NEP:return!0;default:return!FX.Utils.isObjectEmpty(e.value)||e.hasEmpty||e.hasCurrentUser||e.hasCurrentDept}case"deptgroup":case"usergroup":switch(e.method){case t.EP:case t.NEP:return!0;default:return!FX.Utils.isObjectEmpty(e.value)||e.hasCurrentDept||e.hasCurrentUser}case"combocheck":switch(e.method){case t.EP:case t.NEP:return!0;default:return!FX.Utils.isObjectEmpty(e.value)}case"date":case"number":switch(e.method){case t.RG:return!FX.Utils.isObjectEmpty(e.value);case t.EP:case t.NEP:return!0;default:return!FX.Utils.isObjectEmpty(e.value)}case"textarea":switch(e.method){case t.EP:case t.NEP:return!0;default:return!FX.Utils.isObjectEmpty(e.value)}default:switch(e.method){case t.IN:case t.NIN:return!FX.Utils.isObjectEmpty(e.value)||e.hasEmpty;case t.EP:case t.NEP:return!0;default:return!FX.Utils.isObjectEmpty(e.value)}}},getFilterKey:function(e){return e.subField?[e.subform,e.subField].join("."):e.field}})}(jQuery),$.extend(FX.Utils,{getPeriodWithLimit:function(e,t,i){if(e=Math.round(e),!i)return e;var a=1;switch(t){case"d":a=86400;break;case"h":a=3600;break;case"m":a=60}var s=Math.round(Math.max(i[0]/a,1)),n=Math.round(Math.max(i[1]/a,1));return e<s&&(e=s),e>n&&(e=n),e},date2GroupStr:function(e,t){var i="",a=t.split("_");return FX.Utils.forEach(a,function(t,a){var s=0!==t;i+=FX.Utils._compileDateGroupRule(e[a],a,s)}),i},_compileDateGroupRule:function(e,t,i){var a;switch(t){case"year":a=e+"年";break;case"quarter":a="第"+e+"季度";break;case"month":a=i?FX.Utils.leftPad(e,2,"0")+"月":e+"月";break;case"week":a=i?FX.Utils.leftPad(e,2,"0")+"周":e+"周";break;case"day":a=i?FX.Utils.leftPad(e,2,"0")+"日":e+"日";break;default:a=""}return a},parseDate:function(e){if(FX.Utils.isNull(e))return null;if(FX.Utils.isNumber(e))return new Date(e);if(FX.Utils.isString(e)){var t=e.match(/^(\d{4})-?(\d{1,2})-?(\d{0,2})(.*?(\d{1,2}):(\d{1,2}):(\d{1,2}))?.?(\d{1,3})?$/);return t?new Date(t[1],t[2]-1,t[3],t[5]||0,t[6]||0,t[7]||0,t[8]||0):null}return new Date(e)},getWeekOfDate:function(e){var t=new Date;t.setFullYear(e.getFullYear());var i=(7-(t.getDay()||7)+1)%7;return Math.floor((e.getTime()-(t.getTime()+864e5*i))/6048e5)}}),function(e){FX.Utils=FX.Utils||{},e.extend(FX.Utils,{address2Str:function(e,t,i){if(i&&e){t="";var a=!0;/p/.test(i)&&e.province&&(t+=e.province,e.province===e.city&&(a=!1)),/c/.test(i)&&e.city&&a&&(t+=e.city),/d/.test(i)&&e.district&&(t+=e.district),/a/.test(i)&&e.detail&&(t+=e.detail)}return t},num2Str:function(e,t){if(FX.Utils.isEmpty(e))return"";var i=e+"";if(FX.Utils.isEmpty(t))return i;var a=/\[Num0\]/;if(a.test(t))return t.replace(a,i);if((a=/\[Num1\]/).test(t))return t.replace(a,FX.Utils._num2CN(i,!1));if((a=/\[Num2\]/).test(t))return t.replace(a,FX.Utils._num2CN(i,!0));a=/[#0]+,?[#0]*\.?[#0]*%?/;var s=t.match(a);if(s&&s.length>0){var n=s[0];return i=FX.Utils._numberFormat(e,n),t.replace(a,i)}return t},_numberFormat:function(e,t){var i="",a=e+"";if(/%$/.test(t)){i="%",e*=100,t=t.replace("%","");var s=a.indexOf(".");if(s>-1){var n=a.length-3-s;n=n<0?0:n>8?8:n,e=parseFloat(e.toFixed(n))}a=e+""}var o=t.split("."),l=o[0],r=o[1];if(""!==r){for(var d=r?r.length:0,c=(a=FX.Utils.toFixed(parseFloat(e),d)).split(""),u=d;u>0&&"#"===r.charAt(u-1);u--){var h=c.pop();if("0"!==h){c.push(h);break}}var p=c.pop();"."===p&&(p=""),a=c.join("")+p}var f=a.split("."),m=f[0];if(/,/.test(l))f[0]=m.replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,");else{var g=l.match(/[0]+[0#]*$/);g&&g.length>0&&(f[0]=FX.Utils.leftPad(m,g[0].length,"0"))}return f.join(".")+i},_num2CN:function(e,t){var i="〇一二三四五六七八九",a="个十百千万亿";t&&(i="零壹贰叁肆伍陆柒捌玖",a="个拾佰仟万亿");var s=Math.floor(Math.abs(e)),n=Math.abs(e).toString(),o=n.replace(/\..*$/,""),l=n.split("."),r=i,d=a,c=r[0],u=new RegExp(r[0]+"*$"),h=new RegExp(r[0]+"+","g"),p="",f="";if(p=e<0?"-."[0]:"",l.length>=2){var m=l[1];if(m){f="-."[1];for(var g=0;g<m.length;g++)f+=r[+m[g]]}}if(1==o.length)return p+r[s]+f;if(o.length<=5){for(var F="",v=0,s=o.length;s--;){var _=+o[v];F+=this._num2CN(o[v],t)+(_&&s?d[s]:""),v++}return F=F.replace(h,c),F=F.replace(u,""),p+F+f}for(var b=o.length/4>>0,y=o.length%4,F="";0==y||!d[3+b];)y+=4,b--;if(+o.substr(0,y)){F=this._num2CN(o.substr(0,y),t)+d[3+b];var C=o.substr(y);"0"===C[0]&&(F+=r[0]),F+=this._num2CN(C,t)}else F=this._num2CN(o.substr(0,y),t)+this._num2CN(o.substr(y),t);return F=F.replace(h,c),F=F.replace(u,""),p+F+f},date2Str:function(e,t){if(!e)return"";var i=(t=t||"yyyy-MM-dd").length,a="";if(i>0){for(var s=t.charAt(0),n=0,o=s,l=1;l<i;l++){var r=t.charAt(l);s!==r?(a+=FX.Utils._compileDateFormat({char:s,str:o,len:l-n},e),n=l,o=s=r):o+=r}a+=FX.Utils._compileDateFormat({char:s,str:o,len:i-n},e)}return a},_compileDateFormat:function(e,t){var i=e.str,a=e.len;switch(e.char){case"E":i=a>2?Date._DN[t.getDay()]:a>1?Date._SDN[t.getDay()]:t.getDay()+"";break;case"y":i=a<=3?(t.getFullYear()+"").slice(2,4):t.getFullYear();break;case"M":i=a>2?Date._MN[t.getMonth()]:a<2?t.getMonth()+1:FX.Utils.leftPad(t.getMonth()+1+"",2,"0");break;case"d":i=a>1?FX.Utils.leftPad(t.getDate()+"",2,"0"):t.getDate();break;case"h":var s=t.getHours()%12;0===s&&(s=12),i=a>1?FX.Utils.leftPad(s+"",2,"0"):s;break;case"H":i=a>1?FX.Utils.leftPad(t.getHours()+"",2,"0"):t.getHours();break;case"m":i=a>1?FX.Utils.leftPad(t.getMinutes()+"",2,"0"):t.getMinutes();break;case"s":i=a>1?FX.Utils.leftPad(t.getSeconds()+"",2,"0"):t.getSeconds();break;case"a":i=t.getHours()<12?"am":"pm";break;default:i=e.str}return i},getPercentFormat:function(e){return e||(e="0."),/%$/.test(e)||(e+="%"),e}})}(jQuery),function($){FX.Formula={AND:function(){for(var e=FX.Utils.flatten(arguments),t=0,i=e.length;t<i;t++)if(!e[t])return!1;return!0},OR:function(){for(var e=FX.Utils.flatten(arguments),t=0,i=e.length;t<i;t++)if(e[t])return!0;return!1},FALSE:function(){return!1},TRUE:function(){return!0},IF:function(e,t,i){return e?t:i},NOT:function(e){return!e},XOR:function(){for(var e=0,t=FX.Utils.flatten(arguments),i=0,a=t.length;i<a;i++)t[i]&&e++;return!!(1&Math.floor(Math.abs(e)))},CHAR:function(e){return 10===e||34===e||39===e||92===e?String.fromCharCode(e):""},CONCATENATE:function(){for(var e=FX.Utils.flatten(arguments),t=0;(t=e.indexOf(!0))>-1;)e[t]="TRUE";for(var i=0;(i=e.indexOf(!1))>-1;)e[i]="FALSE";return e.join("")},EXACT:function(e,t){return e===t},LEFT:function(e,t){return t=FX.Utils.isEmpty(t)?1:t,e?e.substring(0,t):""},LEN:function(e){return FX.Utils.isString(e)?e?e.length:0:e&&e.length?e.length:0},LOWER:function(e){return FX.Utils.isString(e)?e?e.toLowerCase():e:""},REPLACE:function(e,t,i,a){return FX.Utils.isNumber(t)&&FX.Utils.isNumber(i)?(e=e||"",a=a||"",e.substr(0,t-1)+a+e.substr(t-1+i)):e},REPT:function(e,t){return t=t||0,new Array(t+1).join(e)},RIGHT:function(e,t){return t=void 0===t?1:t,e?e.substring(e.length-t):""},SEARCH:function(e,t,i){return FX.Utils.isString(e)&&FX.Utils.isString(t)?(i=FX.Utils.isNull(i)?0:i,t.toLowerCase().indexOf(e.toLowerCase(),i-1)+1):0},SPLIT:function(e,t){return FX.Utils.isString(e)?e.split(t):[]},TRIM:function(e){return FX.Utils.isString(e)?e.replace(/ +/g," ").trim():""},UPPER:function(e){return FX.Utils.isString(e)?e.toUpperCase():""},MID:function(e,t,i){return e=e||"",FX.Utils.isNumber(t)&&FX.Utils.isNumber(i)?e.substr(t-1,i):e},AVERAGE:function(){for(var e=FX.Utils.flatten(arguments,function(e){return FX.Utils.isNumber(e)}),t=e.length,i=0,a=0,s=0;s<t;s++)i+=e[s],a+=1;return i/a},COUNT:function(){return FX.Utils.flatten(arguments).length},COUNTIF:function(){var len=arguments.length,criteria=arguments[len-1];/[<>=!]/.test(criteria)||(criteria='=="'+criteria+'"');for(var args=FX.Utils.flatten(Array.prototype.slice.call(arguments,0,len-1)),matches=0,i=0;i<args.length;i++)"string"!=typeof args[i]?eval(args[i]+criteria)&&matches++:eval('"'+args[i]+'"'+criteria)&&matches++;return matches},LARGE:function(e,t){return(e=FX.Utils.flatten(e,function(e){return FX.Utils.isNumber(e)})).sort(function(e,t){return t-e})[t-1]},MAX:function(){var e=FX.Utils.flatten(arguments,function(e){return FX.Utils.isNumber(e)});return 0===e.length?0:Math.max.apply(Math,e)},MIN:function(){var e=FX.Utils.flatten(arguments,function(e){return FX.Utils.isNumber(e)});return 0===e.length?0:Math.min.apply(Math,e)},SMALL:function(e,t){return(e=FX.Utils.flatten(e,function(e){return FX.Utils.isNumber(e)})).sort(function(e,t){return e-t})[t-1]},ABS:function(e){return FX.Utils.isNumber(e)?Math.abs(e):0},ROUND:function(e,t){if(e=FX.Utils.parseNumber(e),t=FX.Utils.parseNumber(t),FX.Utils.isNull(e)||FX.Utils.isNull(t))return null;var i=e*Math.pow(10,t);return Number(new Big(i).round(0).toString())/Math.pow(10,t)},CEILING:function(e,t){if(e=FX.Utils.parseNumber(e),t=FX.Utils.parseNumber(t),FX.Utils.isNull(e)||FX.Utils.isNull(t))return null;if(0===t)return 0;var i=t<0?-1:0,a=(t=Math.abs(t))-Math.floor(t),s=0;return a>0&&(s=-Math.floor(Math.log(a)/Math.log(10))),e>=0?FX.Formula.ROUND(Math.ceil(e/t)*t,s):0===i?-FX.Formula.ROUND(Math.floor(Math.abs(e)/t)*t,s):-FX.Formula.ROUND(Math.ceil(Math.abs(e)/t)*t,s)},FLOOR:function(e,t){if(e=FX.Utils.parseNumber(e),t=FX.Utils.parseNumber(t),FX.Utils.isNull(e)||FX.Utils.isNull(t))return null;if(0===t)return 0;if(!(e>0&&t>0||e<0&&t<0))return 0;var i=(t=Math.abs(t))-Math.floor(t),a=0;return i>0&&(a=-Math.floor(Math.log(i)/Math.log(10))),e>=0?FX.Formula.ROUND(Math.floor(e/t)*t,a):-FX.Formula.ROUND(Math.floor(Math.abs(e)/t)*t,a)},INT:function(e){return FX.Utils.isNumber(e)?Math.floor(e):0},LOG:function(e,t){return t=void 0===t?10:t,FX.Utils.isNumber(t)?Math.log(e)/Math.log(t):0},MOD:function(e,t){if(0===t)return 0;var i=Math.abs(e%t);return t>0?i:-i},POWER:function(e,t){var i=Math.pow(e,t);return isNaN(i)?0:i},PRODUCT:function(){var e=FX.Utils.flatten(arguments,function(e){return FX.Utils.isNumber(e)}),t=1;if(e.length)for(var i=0;i<e.length;i++)t=FX.FormulaCalcParser.evalExpression("*",t,e[i]);else t=0;return t},SQRT:function(e){return e<0?0:Math.sqrt(e)},SUM:function(){for(var e=0,t=FX.Utils.flatten(arguments,function(e){return FX.Utils.isNumber(e)}),i=0,a=t.length;i<a;++i)e=FX.FormulaCalcParser.evalExpression("+",e,t[i]);return e},SUMPRODUCT:function(){for(var e=0,t=[],i=-1,a=0;a<arguments.length;a++)arguments[a]instanceof Array&&(i=i<0?arguments[a].length:Math.min(arguments[a].length,i),t.push(arguments[a]));for(var s,n,o,l=0;l<i;l++){for(s=1,n=0;n<t.length;n++)o=parseFloat(t[n][l]),isNaN(o)&&(o=0),s=FX.FormulaCalcParser.evalExpression("*",s,o);e=FX.FormulaCalcParser.evalExpression("+",e,s)}return e},FIXED:function(e,t){return e=FX.Utils.parseNumber(e),FX.Utils.isNull(e)?null:(t=void 0===t?0:t,FX.Utils.isNumber(t)&&t>=0?FX.Utils.toFixed(e,t):"")},RAND:function(){return FX.Utils.fixDecimalPrecision(Math.random(),6)},DATE:function(){return 6===arguments.length?new Date(parseInt(arguments[0],10),parseInt(arguments[1],10)-1,parseInt(arguments[2],10),parseInt(arguments[3],10),parseInt(arguments[4],10),parseInt(arguments[5],10)):3===arguments.length?new Date(parseInt(arguments[0],10),parseInt(arguments[1],10)-1,parseInt(arguments[2],10)):new Date(arguments[0])},TIME:function(e,t,i){return(3600*e+60*t+i)/86400},TIMESTAMP:function(e){return FX.Utils.isDate(e)?e.getTime():0},TODAY:function(){return new Date},NOW:function(){return new Date},SYSTIME:function(){var e=FX.STATIC._st,t=(new Date).getTime()-FX.STATIC._ct;return t>0&&t<36e5&&(e+=t),new Date(e)},IP:function(){return FX.STATIC.ip||""},DAY:function(e){var e=FX.Utils.parseDate(e);if(!FX.Utils.isNull(e))return e.getDate()},MONTH:function(e){var e=FX.Utils.parseDate(e);if(!FX.Utils.isNull(e))return e.getMonth()+1},YEAR:function(e){var e=FX.Utils.parseDate(e);if(!FX.Utils.isNull(e))return e.getFullYear()},HOUR:function(e){var e=FX.Utils.parseDate(e);if(!FX.Utils.isNull(e))return e.getHours()},MINUTE:function(e){var e=FX.Utils.parseDate(e);if(!FX.Utils.isNull(e))return e.getMinutes()},SECOND:function(e){var e=FX.Utils.parseDate(e);if(!FX.Utils.isNull(e))return e.getSeconds()},DAYS:function(e,t){var e=FX.Utils.parseDate(e);if(!FX.Utils.isNull(e)){var t=FX.Utils.parseDate(t);if(!FX.Utils.isNull(t))return(new Date(e.getFullYear(),e.getMonth(),e.getDate())-new Date(t.getFullYear(),t.getMonth(),t.getDate()))/864e5}},DAYS360:function(e,t,i){var e=FX.Utils.parseDate(e);if(!FX.Utils.isNull(e)){var t=FX.Utils.parseDate(t);if(!FX.Utils.isNull(t)){var a,s,n=t.getMonth(),o=e.getMonth();if(i)a=31===t.getDate()?30:t.getDate(),s=31===e.getDate()?30:e.getDate();else{var l=new Date(t.getFullYear(),n+1,0).getDate(),r=new Date(e.getFullYear(),o+1,0).getDate();a=t.getDate()===l?30:t.getDate(),e.getDate()===r?a<30?(o++,s=1):s=30:s=e.getDate()}return 360*(e.getFullYear()-t.getFullYear())+30*(o-n)+(s-a)}}},DATEDELTA:function(e,t){var e=FX.Utils.parseDate(e);if(!FX.Utils.isNull(e))return FX.Utils.isNumber(t)||(t=0),new Date(e.getTime()+864e5*t)},ISOWEEKNUM:function(e){var e=FX.Utils.parseDate(e);if(!FX.Utils.isNull(e)){e.setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var t=new Date(e.getFullYear(),0,1);return Math.ceil(((e-t)/864e5+1)/7)}},WEEKNUM:function(e,t){var e=FX.Utils.parseDate(e);if(!FX.Utils.isNull(e)){var i=2===t?1:0,a=new Date(e.getFullYear(),0,1),s=(i+7-a.getDay())%7,n=s>0?1:0,o=a.getTime()+24*s*60*60*1e3;return Math.floor((e.getTime()-o)/864e5/7+1)+n}},TEXT:function(e,t){return FX.Utils.isNull(e)?"":FX.Utils.isDate(e)&&!FX.Utils.isEmpty(t)?FX.Utils.date2Str(e,t):FX.Utils.num2Str(e,t)},VALUE:function(e){return FX.Utils.isEmpty(e)?0:isNaN(e)?0:parseFloat(e)},UUID:function(){return FX.Utils.UUID()},RECNO:function(){return FX.Utils.isNull(FX.STATIC.EntryRecNo)?FX.STATIC.APPID&&FX.STATIC.ENTRYID?(FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.formula.recno),async:!1,data:{appId:FX.STATIC.APPID,formId:FX.STATIC.ENTRYID,hasIncLock:FX.STATIC.RecnoLock}},function(e){FX.STATIC.EntryRecNo=e.incId}),FX.STATIC.EntryRecNo):"":FX.STATIC.EntryRecNo},ISEMPTY:function(e){return FX.Utils.isObjectEmpty(e)},MAPX:function(e,t,i,a){var s=null;if(FX.Utils.isEmpty(e)||FX.Utils.isObjectEmpty(t))return s;e=e.toLowerCase();var n=FX.Utils.getFieldInfoByFormula(i),o=FX.Utils.getFieldInfoByFormula(a);if(/^sum|avg|max|min|count|first|last$/.test(e)&&n.entryId&&n.entryId===o.entryId){var l=FX.Utils.isDate(t),r=l?t.getTime():t;FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.formula.aggregate),async:!1,data:{op:e,formId:n.entryId,lookup_value:r,lookup_field:n.field,result_field:o.field,date_type:l,refAppId:n.appId}},function(e){e.result&&e.result[0]&&!FX.Utils.isNull(e.result[0].result)&&(s=e.result[0].result)})}return s},MAP:function(e,t,i){var a=[];if(FX.Utils.isObjectEmpty(e))return a;var s=FX.Utils.getFieldInfoByFormula(t),n=FX.Utils.getFieldInfoByFormula(i);return s.entryId&&s.entryId===n.entryId&&FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.formula.map),async:!1,data:{formId:s.entryId,lookup_value:e,lookup_field:s.field,result_field:n.field,refAppId:s.appId}},function(e){FX.Utils.forEach(e.result,function(e,t){a.push(t[n.field])})},function(){}),a},GETUSERNAME:function(){return FX.STATIC.user?FX.STATIC.user.nickname:""}}}(jQuery),function($){FX.FormulaCalcParser=FX.FormulaCalcParser||{},$.extend(FX.FormulaCalcParser,{evalExpression:function(op,left,right){var calcOps=["+","-","*","/"];if("!"===op)return eval(op+"left");if(calcOps.indexOf(op)>-1&&FX.FormulaCalcParser.isValidNumber(left)&&FX.FormulaCalcParser.isValidNumber(right)){var result;switch(op){case"+":result=new Big(left).plus(right);break;case"-":result=new Big(left).minus(right);break;case"*":result=new Big(left).times(right);break;case"/":result=0===right?"":new Big(left).div(right)}return""===result?null:Number(result.toString())}return eval("left"+op+"right")},isValidNumber:function(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)},applyFunc:function(e,t){if(FX.Formula[e])return FX.Formula[e].apply(null,t)},parse:function(e){var t;try{t=FormulaCalc.parse(e)}catch(e){t=null,console.log(e)}return t}})}(jQuery),FX.OB=function(e){this.options=$.extend(this._defaultConfig(),e),this._beforeInit(),this._init(),this._afterInit()},$.extend(FX.OB.prototype,{_defaultConfig:function(){return{onBeforeInit:null,onAfterInit:null}},_init:function(){},_beforeInit:function(){FX.Utils.applyFunc(this,this.options.onBeforeInit,[],!1)},_afterInit:function(){FX.Utils.applyFunc(this,this.options.onAfterInit,[],!1)}}),FX.Widget=FX.extend(FX.OB,{_defaultConfig:function(){return $.extend(FX.Widget.superclass._defaultConfig.apply(this,arguments),{widgetName:"",baseCls:"",customCls:null,enable:!0,visible:!0,invalidateType:"blank"})},_init:function(){FX.Widget.superclass._init.apply(this,arguments),this._initRoot(),this._initNameEffects()},_afterInit:function(){this._initElementSize(),this._initVisualEffects(),this._initDefaultValue(),FX.Widget.superclass._afterInit.apply(this,arguments)},_initRoot:function(){var e=this.options;this.xtype&&(e.type=this.xtype),null!=e.renderEl?this.element=$(e.renderEl):this.element=this._defaultRoot(),e.baseCls&&this.element.addClass(e.baseCls),e.customCls&&this.element.addClass(e.customCls)},_initNameEffects:function(){var e=this.options;e.widgetName||(e.widgetName="_widget_"+FX.STATIC.IDBase++),this.element.attr({widgetName:e.widgetName})},_initElementSize:function(){this.doResize()},_initVisualEffects:function(){this.setEnable(this.options.enable),this.setVisible(this.options.visible)},_initDefaultValue:function(){var e=this.options;null!=e.value?this.setValue(e.value):null!=e.text&&this.setText(e.text)},_defaultRoot:function(){return $("<div/>")},getWidgetByName:function(e){return this.options.resultWidgets?this.options.resultWidgets[e]:null},getWidgetName:function(){return this.options.widgetName},getWidgetType:function(){return this.options.type},getText:function(){return this.options.text},setText:function(e){this.options.text=e},getValue:function(){return this.options.value},setValue:function(e){this.options.value=e},isEnabled:function(){return this.options.enable},setEnable:function(e){this.options.enable=!!e,!0===this.options.enable?this.element.removeClass("x-ui-disable"):this.element.addClass("x-ui-disable")},isVisible:function(){return this.options.visible},setVisible:function(e){this.options.visible=!!e,!0===this.options.visible?this.element.removeClass("x-ui-hidden"):this.element.addClass("x-ui-hidden")},reset:function(){this.setValue(null)},doResize:function(e){var t=this.options;e&&(t.width=e.width,t.height=e.height),FX.Utils.isEmpty(t.width)||this.element.css({width:t.width}),FX.Utils.isEmpty(t.height)||this.element.css({height:t.height})},destroy:function(){this.element.remove()},rebuild:function(){this.options.renderEl=this.element,this.element.empty(),this._beforeInit(),this._init(),this._afterInit()},checkValidate:function(){return!0},fireEvent:function(e,t){this.element.trigger(e,t)},getOptions:function(e){var t=this.options;return{type:t.type,widgetName:t.widgetName,height:t.height,width:t.width,value:t.value,enable:t.enable,visible:t.visible,allowBlank:t.allowBlank,rely:t.rely}},getInvalidateType:function(){return this.options.invalidateType},setInvalidateType:function(e){this.options.invalidateType=e},getNullValue:function(){return null},getLinkValue:function(){return this.getValue()},getLinkType:function(){return this.getWidgetType()},getCacheValue:function(){return this.getValue()},setCacheValue:function(e){this.setValue(e)},bindWidgetEvent:function(e,t){this.options[e]=t},unbindWidgetEvent:function(e){this.options[e]=null}}),function(e){FX.RelyProcessor=function(e){this.options={defaultVersion:0,version:0,versionMap:{},stateMap:{},asyncMap:{},defaults:[],relyMap:{},linkMap:{},defaultMap:{}},this._init(e)},e.extend(FX.RelyProcessor.prototype,{RELY_END:-1,_init:function(e){this.options.relyMap=this._getRelyWidgetsMap(e),this.options.linkMap=this._getLinkMap(this.options.relyMap)},_getLinkMap:function(e){var t=this,i={};return FX.Utils.forEach(e,function(e,a){FX.Utils.forEach(a,function(a,s){t._add2LinkMap(i,s,e)})}),i},_add2LinkMap:function(e,t,i){if(e[t]||(e[t]=[]),e[t].push(i),/\./.test(t)&&!/\./.test(i)){var a=t.split(".")[0];this._add2LinkMap(e,a,i)}return e},_getRelyWidgetsMap:function(e){var t=this,i={};return FX.Utils.forEach(e,function(e,a){var s=a.widget;if(s&&"linkdata"!==s.type){if("subform"===s.type){var n=t._getRelyWidgetsMap(s.items);FX.Utils.forEach(n,function(e,t){var a=[s.widgetName,e].join(".");i[a]=t})}var o=s.rely;o&&o.widgets&&(i[s.widgetName]=o.widgets)}}),i},_isSubformWidget:function(e){return/\./.test(e)},_getVersion:function(e,t){var i=this.options,a=i.versionMap[e]||i.defaultVersion;return t>-1&&this._isSubformWidget(e)&&(a=Math.max(a,i.versionMap[e+t]||i.defaultVersion)),a},_getState:function(e,t){var i=this.options,a=i.stateMap[e]||i.defaultVersion;return t>-1&&this._isSubformWidget(e)&&(a=Math.max(a,i.stateMap[e+t]||i.defaultVersion)),a},_getAsync:function(e,t){var i=this.options;return t>-1&&this._isSubformWidget(e)?i.asyncMap[e]&&i.asyncMap[e][t]:i.asyncMap[e]},getRelyVersion:function(e,t,i,a,s){var n=this;return s=s||{},this._isSubformWidget(t)||(i=-1),FX.Utils.forEach(e[t],function(t,o){s[o]||s[o+i]||(i>-1&&n._isSubformWidget(o)?s[o+i]=a:s[o]=a,n.getRelyVersion(e,o,i,a,s))}),s},checkAsyncState:function(){var e=this,t=this.options,i=!0;return FX.Utils.forEach(t.asyncMap,function(a){var s=t.asyncMap[a];if(e._isSubformWidget(a)?FX.Utils.forEach(s,function(e,t){if(!1===t)return i=!1,!1}):i=!1!==s,!i)return!1}),i},setStateMap:function(e,t,i){var a=this.options;i>-1?a.stateMap[e+i]=t:a.stateMap[e]=t},setAsyncMap:function(e,t,i){var a=this.options;i>-1?(a.asyncMap[e]=a.asyncMap[e]||{},a.asyncMap[e][i]=t):a.asyncMap[e]=t},addDefaultRely:function(e){FX.Utils.isObjectEmpty(e.getOptionValue())||this.options.defaults.push(e)},getDefaultRely:function(){return this.options.defaults},_checkRely:function(e,t,i,a){var s=this,n=this.options,o=!0;return FX.Utils.forEach(n.relyMap[i],function(n,l){if(s._isSubformWidget(l)&&!s._isSubformWidget(i)){var r=null,d=0;do{if((r=e.getWidgetByName(l,d))&&t===s._getVersion(l,d)&&s._getAsync(l,d)!==t){o=!1;break}d++}while(r)}else!1===s._getAsync(l,a)?o=!1:t===s._getVersion(l,a)&&(o=s._getAsync(l,a)===t);if(!o)return!1}),o&&(this._getState(i,a)===t?o=!1:this.setStateMap(i,t,a)),o},fireRely:function(t,i,a){var s=this.options,n=this,o=-1,l=t.getWidgetName();t.isSubformWidget()&&(l=[t.getSubformName(),l].join("."),o=FX.Utils.getSubformRowIdx(t)),i||(s.version++,i===s.defaultVersion&&(s.defaultMap[s.version]=!0),i=s.version,e.extend(s.versionMap,this.getRelyVersion(s.linkMap,l,o,i)),this.setStateMap(l,i,o)),this.setAsyncMap(l,i,o);var r=t.getLinkValue();FX.Utils.forEach(s.linkMap[l],function(e,t){if(!(i<n._getState(t,o))||s.defaultMap[i]){var l;if(n._isSubformWidget(t)&&o<0){var d=0;do{if(!n._checkRely(a,i,t,d))return;(l=a.getWidgetByName(t,d))&&(n.setAsyncMap(t,!1,d),a.dealRely(t,l,i,r)),d++}while(l)}else{if(!n._checkRely(a,i,t,o))return;if(!(l=a.getWidgetByName(t,o)))return;n.setAsyncMap(t,!1,o),a.dealRely(t,l,i,r)}}})},checkAsyncVersion:function(e,t){var i=this.options,a=-1,s=e.getWidgetName();return e.isSubformWidget()&&(s=[e.getSubformName(),s].join("."),a=FX.Utils.getSubformRowIdx(e)),this._getState(s,a)<=t||i.defaultVersion[t]}})}(jQuery),FX.AssociationProcessor=function(e){this.associationMap={},this.relyMap={},this._init(e)},$.extend(FX.AssociationProcessor.prototype,{VISIBLE:1,INVISIBLE:0,_init:function(e){this.associationMap=this._getAssociationMap(e),this.relyMap=this._getRelyWidgetsMap(this.associationMap)},_getAssociationMap:function(e){var t=this,i={};return FX.Utils.forEach(e,function(e,a){if(a.widget&&t._hasContactWidgets(a.widget)){var s=t._getAssociateWidgets(a.widget);FX.Utils.isObjectEmpty(s)||(i[a.widget.widgetName]=s)}}),i},_getAssociateWidgets:function(e){var t=this,i={};return FX.Utils.forEach(e.items,function(e,a){a.widgetsMap&&FX.Utils.forEach(a.widgetsMap,function(e,s){a.selected?i[s]=t.VISIBLE:i[s]=i[s]||t.INVISIBLE})}),i},_hasContactWidgets:function(e){return e&&("combo"===e.type||"radiogroup"===e.type)&&!e.async},_getRelyWidgetsMap:function(e){var t={};return FX.Utils.forEach(e,function(e,i){FX.Utils.forEach(i,function(i,a){t[i]=t[i]||{},t[i][e]=a})}),t},getVisibleMap:function(){var e={};return FX.Utils.forEach(this.relyMap,function(t,i){e[t]=!1,FX.Utils.forEach(i,function(i,a){if(a)return e[t]=!0,!1})}),e},dealAssociation:function(e,t){var i=this;FX.Utils.forEach(this.associationMap[e],function(a){i.associationMap[e][a]=t.indexOf(a)>-1?i.VISIBLE:i.INVISIBLE}),this.relyMap=this._getRelyWidgetsMap(this.associationMap);var a={};return FX.Utils.forEach(this.associationMap[e],function(e){a[e]=!1,FX.Utils.forEach(i.relyMap[e],function(t,i){if(i)return a[e]=!0,!1})}),a}}),function(){FX.Store=FX.Store||{},$.extend(FX.Store,{expireTime:864e5,set:function(e,t){},get:function(e,t){},has:function(e){return void 0!==this.get(e)},remove:function(e){},clear:function(){},transact:function(e,t,i){null==i&&(i=t,t=null),null==t&&(t={});var a=this.get(e,t);i(a),this.set(e,a)},getAll:function(){var e={};return this.forEach(function(t,i){e[t]=i}),e},forEach:function(){},serialize:function(e){return JSON.stringify(e)},deserialize:function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e||void 0}},getKey:function(e,t){var i="";switch(e){case"paramFields":case"showFields":case"metaFields":case"formDataShowFields":i=[e,t.appId,t.entryId,t.groupId].join("");break;case"authGroup":i=[e,t.appId,t.entryId].join("");break;case"formData":i=FX.STATIC.user&&!FX.STATIC.FTOKEN?[e,t.appId,t.entryId,FX.STATIC.user._id].join(""):[e,t.appId,t.entryId].join("");break;case"filterSticky":case"filterValue":case"itemsPerPage":i=[e,t.appId,t.entryId,t.groupId,t.ext].join("")}return i}});var e="undefined"!=typeof window?window:global,t="localStorage";(function(){try{return t in e&&e[t]}catch(e){return!1}})()&&$.extend(FX.Store,{storage:e[t],set:function(e,t,i){if(void 0===t)return this.remove(e);i&&(t={data:t,expire:+new Date+this.expireTime*i});try{this.storage.setItem(e,this.serialize(t))}catch(e){return void this.clear(!0)}return t},get:function(e,t){var i=this.deserialize(this.storage.getItem(e));return i&&i.expire&&(i=i.data),void 0===i?t:i},remove:function(e){this.storage.removeItem(e)},clear:function(e){var t=this;if(e){var i=+new Date;this.forEach(function(e,a){a.expire&&i>a.expire&&t.remove(e)})}else this.storage.clear()},forEach:function(e){for(var t=0;t<this.storage.length;t++){var i=this.storage.key(t);e(i,this.deserialize(this.storage.getItem(i)))}}})}(),function(e){FX.UI={showPopover:function(t){var i=e('<div class="x-ui-popover"/>').appendTo("body"),a=e.extend({anchor:null,position:"topLeft",content:null,maxWidth:null,animation:!0,type:"light",edge:8},t);a.maxWidth&&i.css({"max-width":a.maxWidth}),a.type&&i.addClass(a.type),a.animation&&i.addClass("animation"),a.content&&a.content.appendTo(i);var s=a.anchor,n=s.offset(),o={"z-Index":FX.STATIC.zIndex++},l=n.top-e("body").offset().top;switch(a.position){case"topLeft":i.addClass("top"),o.left=Math.max(n.left+s.width()/2-i.outerWidth()/2,a.edge/2),o.bottom=document.body.clientHeight-l+a.edge;break;case"topRight":i.addClass("top"),o.right=Math.max(document.body.clientWidth-n.left-s.width()/2-i.outerWidth()/2,a.edge/2),o.bottom=document.body.clientHeight-l+a.edge;break;case"bottomLeft":i.addClass("bottom"),o.left=Math.max(n.left+s.width()/2-i.outerWidth()/2,a.edge/2),o.top=l+s.height()+a.edge;break;case"bottomRight":i.addClass("bottom"),o.right=Math.max(document.body.clientWidth-n.left-s.width()/2-i.outerWidth()/2,a.edge/2),o.top=l+s.height()+a.edge;break;case"rightTop":i.addClass("right"),o.right=Math.max(document.body.clientWidth-n.left-s.width()-i.outerWidth()-a.edge,a.edge/2),o.bottom=Math.max(document.body.clientHeight-l-s.height()/2-i.outerHeight()/2,a.edge/2);break;case"rightBottom":i.addClass("right"),o.right=Math.max(document.body.clientWidth-n.left-s.width()-i.outerWidth()-a.edge,a.edge/2),o.top=Math.max(l+s.height()/2-i.outerHeight()/2,a.edge/2);break;case"leftTop":i.addClass("left"),o.left=Math.max(n.left-i.outerWidth()-a.edge,a.edge/2),o.bottom=Math.max(document.body.clientHeight-l-s.height()/2-i.outerHeight()/2,a.edge/2);break;case"leftBottom":i.addClass("left"),o.left=Math.max(n.left-i.outerWidth()-a.edge,a.edge/2),o.top=Math.max(l+s.height()/2-i.outerHeight()/2,a.edge/2)}return i.css(o),i.addClass("fadein"),i},closePopover:function(){var t=e(".x-ui-popover");t.length>0&&(t.remove(),t=null)},shareUrl:function(t){var i=e.extend({url:"",title:"",subTitle:"",hasCopy:!0,hasOpen:!0,hasQrcode:!0},t),a=e('<div class="share-link-content"/>');new FX.ShareUrlPane({renderEl:e("<div/>").appendTo(a),url:i.url,hasCopy:i.hasCopy,hasOpen:i.hasOpen,hasQrcode:i.hasQrcode}),new FX.Dialog({title:i.title,subTitle:i.subTitle,customCls:"share-link-dialog",width:600,contentWidget:{rowSize:[90],colSize:[600],items:[[a]]}}).show()},showSaveConfirm:function(t){var i=this,a=e.extend({key:"",onSave:null,onCancel:null,onBack:null},t),s=a.key+"有修改，是否保存？",n="您修改了"+a.key+"但没有保存，是否需要保存"+a.key+"并继续？",o=e("<a/>").text("返回"+a.key).click(function(){FX.Utils.applyFunc(i,a.onBack,[],!1),l.close()}),l=FX.Msg.alert({title:s,msg:n,tip:o,type:"query",text4Ok:"保存并继续",text4Cancel:"不保存",onOk:a.onSave,onCancel:a.onCancel})},inviteGuide:function(e){var t=new FX.Dialog({width:487,height:200,title:"",style4Header:"white",customCls:"invite-guide-dialog",contentWidget:{type:"inviteguidepane",msgType:e,onClose:function(){t.close()}}});t.show()},showHelpCenterGuide:function(){FX.Msg.dotGuide({anchor:e(".nav-help"),msg:"如需获得更多帮助，请点击此处，我们将竭诚为您服务",hAdjust:-320,delay:250,hasMask:!0,isStepGuide:!0,isCircleEnable:!1,isCircleVisible:!1,isTriangleVisible:!0,trianglePos:"arrow-right",onEnd:function(){FX.Cookie.remove(FX.CONST.COOKIE.STEP_GUIDE.KEY,{path:"/"})}})}}}(jQuery),function(e){FX.Vip={_getVip:function(){if(!FX.STATIC.VIP_PACK){if(!FX.STATIC.APPID)return{};FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.app.get_vip_pack,FX.STATIC.APPID),async:!1},function(t){FX.STATIC.VIP_PACK=e.extend({},t)},function(){FX.STATIC.VIP_PACK={}})}return FX.STATIC.VIP_PACK},_getPack:function(){var e=this._getVip();return e&&e.vipPack||{}},clear:function(){FX.STATIC.VIP_PACK=null},_getUpgradeActionConfig:function(e){var t={onOk:null,onCancel:null},i=FX.CONST.VIP_ERR_MSG_MAP[e.code]||{};if(/^71[0-9]{2}$/.test(e.code)){if(t.text4Ok="立即升级",t.text4Cancel="暂不升级",t.onOk=function(){var t=FX.Utils.getApi(FX.API.profile.order_compare)+"?addon="+i.addon;return e.arrgregateCount&&(t+="&aggregate_count="+e.arrgregateCount),FX.Utils.redirectTo(t),!1},[7131,7132,7135].indexOf(e.code)>-1&&(t.text4Ok="我知道了",t.text4Cancel="",t.onOk=null),FX.Utils.isArray(e.bufferItems)){var a=e.bufferItems.slice(0);if(a.length>1)t.onCancel=function(){FX.Utils.redirectTo("/profile#/vip")},t.text4Cancel="查看详情";else if(1===a.length){t.text4Cancel="查看详情";var s=a[0];"etl"===s&&(t.text4Ok="我知道了",t.onOk=null),t.onCancel=function(){switch(s){case"form_data":case"print":case"aggregate":case"trigger":case"etl":new FX.VipUsageDialog({usageType:a[0]}).show();break;default:FX.Utils.redirectTo("/profile#/vip")}}}}}else/^72[0-9]{2}$/.test(e.code)&&(t.text4Ok="我知道了",t.text4Cancel="");return t},_getBufferExpireMsg:function(e){return e.expireDays&&e.expireDays<8?e.expireDays+"天后系统将会受限。":""},_getUpgradeBufferMsg:function(e){return e.message||e.msg},_getUpgradeMsg:function(e,t){t=t||!1;var i=this._getUpgradeBufferMsg(e),a=FX.CONST.VIP_ERR_MSG_MAP[e.code]||{};return t?(a.memMsg||i)+this._getBufferExpireMsg(e):FX.Utils.isObjectEmpty(a)?"":(a.msg||i)+this._getBufferExpireMsg(e)},_getUpgradeTitle:function(e){var t=FX.CONST.VIP_ERR_MSG_MAP[e.code]||{};return FX.Utils.isObjectEmpty(t)?this._getUpgradeBufferMsg(e)+this._getBufferExpireMsg(e):t.title},_getUpgradeTip:function(t){var i=FX.CONST.VIP_ERR_MSG_MAP[t.code]||{};return i.doc?e('<a target="jdy_doc"/>').text("查看高级功能介绍").attr("href",FX.CONFIG.HOST.HELP_DOC_HOST+"/"+i.doc):""},showUpgradeTip:function(t,i){i=i||!1,FX.Utils.isObjectEmpty(t)||i&&FX.STATIC.user&&FX.Cookie.get(FX.STATIC.user.username+FX.CONST.VIP_COOKIE.SERVICE_UPGRADE.SUFFIX_KEY)||(i&&FX.STATIC.user&&FX.Cookie.set(FX.STATIC.user.username+FX.CONST.VIP_COOKIE.SERVICE_UPGRADE.SUFFIX_KEY,FX.CONST.VIP_COOKIE.SERVICE_UPGRADE.VALUE,{expires:FX.CONST.VIP_COOKIE.SERVICE_UPGRADE.EXPIRES_DATE}),FX.Utils.isCorpCreator()?(FX.Msg.alert(e.extend({msg:this._getUpgradeMsg(t),title:this._getUpgradeTitle(t),tip:this._getUpgradeTip(t)},this._getUpgradeActionConfig(t))),FX.Utils.dt(FX.CONST.TRACKER.VIP_LIMIT_ALERT,t.code)):FX.Msg.toast({type:"warning",msg:this._getUpgradeMsg(t,!0)}))},getExcelMFS:function(){return this._getPack()[FX.CONST.VIP_MODULE.EXCEL_IMPORT]||2097152},hasAppBridge:function(){return this._getPack()[FX.CONST.VIP_MODULE.APP_BRIDGE]>0},hasDataBackup:function(){return this._getPack()[FX.CONST.VIP_MODULE.DATA_BACKUP]>0},hasSubmitPrompt:function(){return this._getPack()[FX.CONST.VIP_MODULE.SUBMIT_PROMPT]>0},hasFileExport:function(){return this._getPack()[FX.CONST.VIP_MODULE.FILE_ZIP]>0},hasSignature:function(){return this._getPack()[FX.CONST.VIP_MODULE.SIGNATURE]>0},getPTSize:function(){return this._getPack()[FX.CONST.VIP_MODULE.PRINT]},getTriggerCount:function(){return this._getPack()[FX.CONST.VIP_MODULE.TRIGGER]},getVipLimit:function(){var e=this._getVip();return e&&e.vipLimit||{}},isDataCreateLimit:function(){return this.getVipLimit().data_create},showDataLimitTip:function(t){this.isDataCreateLimit()&&new FX.Tip(e.extend({msg:FX.CONST.DATA_LIMIT_TIP.LINK,height:45},t))}}}(jQuery),function(e){FX.Cookie=FX.Cookie||{},e.extend(FX.Cookie,{_encode:function(e){return this.raw?e:encodeURIComponent(e)},_decode:function(e){return this.raw?e:decodeURIComponent(e)},_stringifyCookieValue:function(e){return this._encode(this.json?JSON.stringify(e):String(e))},_parseCookieValue:function(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(/\+/g," ")),this.json?JSON.parse(e):e}catch(e){}},_read:function(t,i){var a=this.raw?t:this._parseCookieValue(t);return e.isFunction(i)?i(a):a},set:function(t,i,a){if(arguments.length>1&&!e.isFunction(i)){if("number"==typeof(a=e.extend({expires:new Date((new Date).getTime()+1728e6),domain:FX.CONFIG.COOKIE_DOMAIN},a)).expires){var s=a.expires,n=a.expires=new Date;n.setMilliseconds(n.getMilliseconds()+864e5*s)}return document.cookie=[this._encode(t),"=",this._stringifyCookieValue(i),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}},get:function(e,t){for(var i=e?void 0:{},a=document.cookie?document.cookie.split("; "):[],s=0,n=a.length;s<n;s++){var o=a[s].split("="),l=this._decode(o.shift()),r=o.join("=");if(e===l){i=this._read(r,t);break}e||void 0===(r=this._read(r))||(i[l]=r)}return i},remove:function(t,i){return this.set(t,"",e.extend({},i,{expires:-1})),!this.set(t)}})}(jQuery),function(e){FX.Socket=FX.Socket||{},e.extend(FX.Socket,{CONFIG:{path:"/socket",transports:["websocket"]},CONST:{default_path:"websocket_message",error_path:"error"},_initSocket:function(e){var t=this;this.onMap={};var i=FX.CONFIG.HOST.ASSETS_HOST+"/js/fx_socket.min.js";FX.Utils.loadScript(i,function(){t.socket=io(t.CONFIG),t.socket.on(t.CONST.error_path,function(e){console.log(e)}),e&&e()})},_addOn:function(){var t=this;this.socket.on(this.CONST.default_path,function(i){var a=e.parseJSON(i);a&&a.signatureKey&&FX.Utils.applyFunc(t,t.onMap[a.signatureKey],[a],!1)})},on:function(e,t){if(!(FX.Utils.isEmpty(e)||this.onMap&&this.onMap[e])){var i=this;this.socket?this._addOn():this._initSocket(function(){i._addOn()}),this.onMap[e]=t}}})}(jQuery),function(e){FX.Hotkeys={specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",188:",",190:".",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},keyHandler:function(t){var i=t.handler,a=(t.namespace||"").toLowerCase().split(" ");(1!==(a=e.map(a,function(e){return e.split(".")})).length||""!==a[0]&&"autocomplete"!==a[0].substring(0,12)&&"accordion"!==a[0].substring(0,9)&&"tabs"!==a[0].substring(0,4)&&"menu"!==a[0].substring(0,4))&&(t.handler=function(t){if(this===t.target||!/textarea|select/i.test(t.target.nodeName)&&"text"!==t.target.type&&"true"!=e(t.target).prop("contenteditable")){var s="keypress"!==t.type&&FX.Hotkeys.specialKeys[t.which],n=String.fromCharCode(t.which).toLowerCase(),o="",l={};t.altKey&&"alt"!==s&&(o+="alt_"),t.ctrlKey&&"ctrl"!==s&&(o+="ctrl_"),t.metaKey&&!t.ctrlKey&&"meta"!==s&&(o+="meta_"),t.shiftKey&&"shift"!==s&&(o+="shift_"),s?l[o+s]=!0:(l[o+n]=!0,l[o+FX.Hotkeys.shiftNums[n]]=!0,"shift_"===o&&(l[FX.Hotkeys.shiftNums[n]]=!0));for(var r=0,d=a.length;r<d;r++)if(l[a[r]])return i.apply(this,arguments)}})}},FX.Utils.forEach(["keydown","keyup","keypress"],function(t,i){e.event.special[i]={add:FX.Hotkeys.keyHandler}})}(jQuery),$.extend(Array.prototype,{remove:function(e){var t=this.indexOf(e);return-1!=t&&this.splice(t,1),this},unique:function(){for(var e={},t=this.length,i=[],a=0;a<t;a++){var s=this[a];e.hasOwnProperty(s)||(e[s]=1,i.push(s))}return i}}),$.extend(Date.prototype,{getMonthDays:function(e){var t=[31,28,31,30,31,30,31,31,30,31,30,31],i=this.getFullYear();return void 0===e&&(e=this.getMonth()),0!=i%4||0==i%100&&0!=i%400||1!==e?t[e]:29}}),Date._DN=[FX.i18nText("Sunday"),FX.i18nText("Monday"),FX.i18nText("Tuesday"),FX.i18nText("Wednesday"),FX.i18nText("Thursday"),FX.i18nText("Friday"),FX.i18nText("Saturday")],Date._SDN=[FX.i18nText("Short-Sun"),FX.i18nText("Short-Mon"),FX.i18nText("Short-Tue"),FX.i18nText("Short-Wed"),FX.i18nText("Short-Thu"),FX.i18nText("Short-Fri"),FX.i18nText("Short-Sat")],Date._MN=[FX.i18nText("January"),FX.i18nText("February"),FX.i18nText("March"),FX.i18nText("April"),FX.i18nText("May"),FX.i18nText("June"),FX.i18nText("July"),FX.i18nText("August"),FX.i18nText("September"),FX.i18nText("October"),FX.i18nText("November"),FX.i18nText("December")],Date._SMN=[FX.i18nText("Short-Jan"),FX.i18nText("Short-Feb"),FX.i18nText("Short-Mar"),FX.i18nText("Short-Apr"),FX.i18nText("Short-May"),FX.i18nText("Short-Jun"),FX.i18nText("Short-Jul"),FX.i18nText("Short-Aug"),FX.i18nText("Short-Sep"),FX.i18nText("Short-Oct"),FX.i18nText("Short-Nov"),FX.i18nText("Short-Dec")],$.extend($.Event.prototype,{stopEvent:function(){this.stopPropagation(),this.preventDefault()}}),function(e){FX.Container=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Container.superclass._defaultConfig.apply(),{baseCls:"fui_container",resultWidgets:{}})},_addWidget:function(t){var i=this.options,a=FX.createWidget(t);i.resultWidgets[a.options.widgetName]=a;var s=a.options.resultWidgets;return s&&e.extend(i.resultWidgets,s),a}})}(jQuery),function(e){FX.List=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.List.superclass._defaultConfig.apply(),{baseCls:"x-list",items:[],value:null,defaultItemIcon:"",onItemCreate:null,onItemSelect:null})},_init:function(){FX.List.superclass._init.apply(this,arguments),this._createList(),this._bindEvent()},_createList:function(){var t=this,i=this.options;this.$list=e('<div class="x-list-pane"/>').appendTo(this.element),FX.Utils.forEach(i.items,function(e,i){t.$list.append(t._createItem(i))})},_createItem:function(t){var i=this.options,a="x-list-item";t.selected&&(a+=" select");var s=e('<div class="'+a+'"/>').append('<i class="item-icon '+(t.icon||i.defaultItemIcon)+'"/>').append(e('<span class="item-title"/>').text(t.title)).attr("data-name",t.name).data({item:t});return FX.Utils.applyFunc(this,i.onItemCreate,[t,s],!1),s},_bindEvent:function(){var t=this,i=this.options;this.$list.on("click",".x-list-item",function(a){var s=e(a.currentTarget),n=s.data("item");FX.Utils.applyFunc(t,i.onItemSelect,[n,s],!1)})},reload:function(e){var t=this;this.$list.empty(),FX.Utils.forEach(e,function(e,i){t.$list.append(t._createItem(i))})}}),e.shortcut("list",FX.List)}(jQuery),jQuery,FX.CheckList=FX.extend(FX.Widget,{_defaultConfig:function(){return $.extend(FX.CheckList.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_checklist",hasSelectAll:!0,textField:"text",valueField:"value",async:null,asyncResultKey:"items",value:[],customItem:null,items:[{value:"选项1",text:"选项1"},{value:"选项2",text:"选项2"},{value:"选项3",text:"选项3"}],searchable:!0,onStopEdit:null,height:30,width:240,limit:100,hasLimit:!1,onAfterItemSelect:null,onAfterSelectAll:null,searchKey:"keyword"})},_init:function(){FX.CheckList.superclass._init.apply(this,arguments);var e=this,t=this.options;if(this.value=t.value,t.searchable){var i=$('<div class="search"/>').appendTo(this.element);$('<input class="search-input" placeholder="搜索"/>').on("input propertychange",function(t){e._doSearch($(t.currentTarget).val().trim())}).appendTo(i)}var a=$('<div class="list-wrapper"/>').appendTo(this.element);this._createMetaList().appendTo(a),this.$checkList=$('<ul class="check-list"/>').on("click",".check-item",function(t){e._handleClick($(t.currentTarget))}).appendTo(a),this._loadItems()},_createMetaList:function(){var e=this,t=this.options,i=$('<ul class="meta-list"/>').on("click",".check-item",function(t){var i=$(t.currentTarget);if(i.hasClass("select-all")){i.toggleClass("select");var a=i.hasClass("select");e._handleSelectAll(a)}i.hasClass("custom-item")&&e._handleClick(i)});if(t.hasSelectAll){var a={};a[t.textField]="全选",this.$selectAll=this._createCheckItem(a).addClass("select-all").appendTo(i)}return FX.Utils.isObjectEmpty(t.customItem)||(this.$customItem=this._createCheckItem(t.customItem).addClass("custom-item").appendTo(i)),i},_handleSelectAll:function(e){var t=this,i=this.options;FX.Utils.isObjectEmpty(i.customItem)||t._handleItemSelectAll(e,this.$customItem);var a=this.$checkList.children(".check-item");FX.Utils.forEach(a,function(i,a){t._handleItemSelectAll(e,$(a))}),FX.Utils.applyFunc(this,i.onAfterSelectAll,[e],!1),FX.Utils.applyFunc(this,i.onStopEdit,[],!1)},_handleItemSelectAll:function(e,t){if(!t.hasClass("x-ui-hidden")){var i=t.attr("option"),a=this.value.indexOf(i);e?(t.addClass("select"),a<0&&this.value.push(i)):(t.removeClass("select"),a>-1&&this.value.splice(a,1))}},_loadItems:function(){var e=this,t=this.options;if(t.async&&t.async.url){if(this.isLoading)return;this.isLoading=!0;var i=$("<li />").text("加载中...").appendTo(this.$checkList),a={hasLimit:t.hasLimit,limit:t.limit};FX.Utils.isEmpty(this.searchValue)||(a[t.searchKey]=this.searchValue),FX.Utils.dataAjax({url:t.async.url,data:$.extend({},t.async.data,a)},function(i){var a=i[t.asyncResultKey];e.items=a,e._createItems(a)},null,function(){i.remove(),e.isLoading=!1})}else this.items=t.items,e._createItems(this.items)},_createItems:function(e){var t=this;FX.Utils.forEach(e,function(e,i){t._createCheckItem(i).appendTo(t.$checkList)}),this._checkSelectAll()},_createCheckItem:function(e){var t=this.options,i=e[t.valueField]||e,a=e[t.textField]||e,s=$('<li class="check-item x-check"/>').attr("option",i).attr("title",a).data("item",e).append($('<i class="icon-blank"/>')).append($("<span />").text(a));return this.value.indexOf(i)>-1&&s.addClass("select"),s},_handleClick:function(e){var t=this.options,i=e.attr("option");if(e.toggleClass("select"),e.hasClass("select"))this.value.push(i);else{var a=this.value.indexOf(i);a>-1&&this.value.splice(a,1)}this._checkSelectAll(),FX.Utils.applyFunc(this,t.onAfterItemSelect,[e,e.data("item"),e.hasClass("select")],!1),FX.Utils.applyFunc(this,t.onStopEdit,[],!1)},_checkSelectAll:function(){var e=this.options;if(e.hasSelectAll){var t=!1,i=this.$checkList.children(".check-item").not(".x-ui-hidden");this.$checkList.children(".check-item.select").not("x-ui-hidden").length===i.length&&(t=!(!FX.Utils.isObjectEmpty(e.customItem)&&!this.$customItem.hasClass("x-ui-hidden"))||this.$customItem.hasClass("select")),this.$selectAll.toggleClass("select",t)}},_doSearch:function(e){var t=this,i=this.options;if(this.searchValue=e,this.searchInterval&&clearTimeout(this.searchInterval),i.async&&i.hasLimit)this.searchInterval=setTimeout(function(){t.items=[],t.$checkList.empty(),t._loadItems(),t._afterSearch()},500);else{var a=$("li.check-item",this.$checkList);this.searchInterval=setTimeout(function(){FX.Utils.forEach(a,function(e,i){var a=$(i),s=new RegExp(FX.Utils.escapeRegexp(t.searchValue),"i").test(a.text());a.toggleClass("x-ui-hidden",!s)}),t._afterSearch()},500)}},_afterSearch:function(){var e=this.options;this.searchValue?(this.$selectAll&&this.$selectAll.find("span").text("搜索结果全选"),FX.Utils.isObjectEmpty(e.customItem)||this.$customItem.addClass("x-ui-hidden")):(this.$selectAll&&this.$selectAll.find("span").text("全选"),FX.Utils.isObjectEmpty(e.customItem)||this.$customItem.removeClass("x-ui-hidden"))},setValue:function(e){var t=this.options;if(this.value=e,this.$checkList.empty(),this._createItems(this.items),!FX.Utils.isObjectEmpty(t.customItem)){var i=t.customItem[t.valueField];this.$customItem.toggleClass("select",e.indexOf(i)>-1)}},getValue:function(){return this.value}}),$.shortcut("checklist",FX.CheckList),function(e){FX.FormItemUtils=FX.FormItemUtils||{},e.extend(FX.FormItemUtils,{formatDateTimeValue:function(e,t){if(FX.Utils.isNull(e))return null;var i=null;i="today"===e?new Date:new Date(e),0!==t&&1!==t||i.setHours(0,0,0),i.setMilliseconds(0);var a=i.getTime();return isNaN(a)?null:a},getDateTimeViewMode:function(e){var t=1;return(e=e||"yyyy-MM-dd").match(/[YyMDd]/)?e.match(/[Dd]/)?e.match(/[Hhms]/)&&(t=3):t=0:t=e.match(/s/)?2:4,t},dealCurrentUser:function(e,t){if(!e)return null;var i=e;return"select"===(t=t||"select")&&e._id===FX.USER_ID.CurrentUser&&(i=FX.STATIC.user?{_id:FX.STATIC.user._id,nickname:FX.STATIC.user.nickname}:null),i},parseUserDeptDefaultValue:function(e){var t=e;return e&&e._id&&(t=e._id),t},parseUserDeptListDefaultValue:function(e){var t=[];return FX.Utils.forEach(e,function(e,i){i&&i._id?t.push(i._id):t.push(i)}),t},dealCurrentDept:function(e,t,i,a){if(!e)return t&&t(e);if("select"===(i=i||"select")&&e._id===FX.CONST.DEPT_ID.CURRENT){var s;a&&a.length&&(s=FX.Utils.createMask(a,{isLight:!0,hasLoader:!0})),FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.current_departments),async:!1},function(i){e&&e._id===FX.CONST.DEPT_ID.CURRENT&&(e=FX.Utils.isObjectEmpty(i.departmentList)?null:i.departmentList[0]),t&&t(e)},function(){t&&t(null)},function(){s&&s.remove()})}else t&&t(e)},dealCurrentDeptList:function(e,t,i,a){if(!e||!e.length)return t&&t([]);var s=-1;if(FX.Utils.forEach(e,function(e,t){if(t&&t._id===FX.CONST.DEPT_ID.CURRENT)return s=e,!1}),"select"===(i=i||"select")&&s>-1){var n;a&&a.length&&(n=FX.Utils.createMask(a,{isLight:!0,hasLoader:!0})),FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.current_departments),async:!1},function(i){e[s]&&e[s]._id===FX.CONST.DEPT_ID.CURRENT&&(e.splice(s,1),e=e.concat(i.departmentList)),t&&t(e)},function(){e[s]&&e[s]._id===FX.CONST.DEPT_ID.CURRENT&&e.splice(s,1),t&&t(e)},function(){n&&n.remove()})}else t&&t(e)}})}(jQuery),FX.FormItem=FX.extend(FX.Widget,{_defaultConfig:function(){return $.extend(FX.FormItem.superclass._defaultConfig.apply(),{description:"",label:"",layout:{},widget:{},mode:"new",onAddSubWidget:null,onAssociate:null,onCalFormula:null,onGetFilter:null,onGetLinkFilter:null,onGetLinkValue:null,onRowEdit:null,onStopEdit:null,onValueChange:null})},_init:function(){FX.FormItem.superclass._init.apply(this,arguments);var e=this.options;this.widget=e.widget,this._render()},_afterInit:function(){},_render:function(){var e=this.options,t=$('<div class="fl-label"/>').appendTo(this.element).append($('<span class="label-title"/>').text(e.label));!1===this.widget.allowBlank&&$('<span class="label-notnull"/>').text("*").appendTo(t),FX.Utils.isEmpty(e.description)||"<br>"===e.description||$('<div class="fl-description x-subhtml"/>').append(e.description).appendTo(this.element),this._renderField(),this.isVisible()||this.element.addClass("x-ui-hidden")},_renderField:function(){var e=this.options,t=this;this.widget.enable||FX.LimitFields.disable.indexOf(this.widget.type)<0?this.field=FX.createWidget($.extend({label:e.label,renderEl:$("<div/>").appendTo($('<div class="fl-widget"/>').appendTo(this.element))},this._getFieldConfig(this.widget.type,this),this.widget,e.layout)):this.field=new FX.FormItemDisable($.extend({renderEl:$("<div/>").appendTo($('<div class="fl-widget"/>').appendTo(this.element)),onBeforeInit:function(){if("edit"!==e.mode){var i=this.options,a=i.rely;a&&a.formula&&FX.Utils.isObjectEmpty(a.widgets)&&(i.value=FX.Utils.applyFunc(t,e.onCalFormula,[a.formula.formula],null),t.widget.value=i.value)}},widgetType:this.widget.type},this.widget,e.layout))},_getFieldConfig:function(e,t){var i=this.options,a=this,s={onStopEdit:function(){FX.Utils.applyFunc(t,i.onStopEdit,[],!1)},onBeforeInit:function(){if("edit"!==i.mode){var e=this.options,s=e.rely;s&&s.formula&&FX.Utils.isObjectEmpty(s.widgets)&&(e.value=FX.Utils.applyFunc(t,i.onCalFormula,[s.formula.formula],null),a.widget.value=e.value)}}};switch(e){case"combo":case"combocheck":$.extend(s,{onBeforeAsync:function(){var e=this.options.async.data;e&&(e.filter={cond:FX.Utils.applyFunc(t,i.onGetFilter,[],[]),rel:FX.CONST.FILTER_RELATION.AND})},onAfterItemSelect:function(e,t){a.effectItemLinkWidgets(t&&t.isOther)}});break;case"linkdata":$.extend(s,{onBeforeLinkData:function(e){var a=this.options.linkForm;a&&this.reload({cond:FX.Utils.applyFunc(t,i.onGetLinkFilter,[e,a],[]),rel:FX.CONST.FILTER_RELATION.AND})}});break;case"subform":$.extend(s,{onBeforeWidgetCreate:function(e,s){$.extend(e,a._getFieldConfig(e.type,this),{onBeforeInit:function(){var e=this.options;if(FX.Utils.isNull(s)){var a=e.rely;a&&a.formula&&FX.Utils.isObjectEmpty(a.widgets)&&(e.value=FX.Utils.applyFunc(t,i.onCalFormula,[a.formula.formula],null))}}})},onAfterWidgetCreate:function(e){FX.Utils.applyFunc(t,i.onAddSubWidget,[e],!1)},onBeforeRowEdit:function(){return FX.Utils.applyFunc(t,i.onRowEdit,[],!1)}});break;case"user":case"usergroup":$.extend(s,{onBeforeEdit:function(){var e=this.options;if(e.limitWidget){var a=FX.Utils.applyFunc(t,i.onGetLinkValue,[e.limitWidget],null);return FX.Utils.isObjectEmpty(a)?e.limit={}:e.limit={departs:$.makeArray(a)},!1}}});break;case"dept":case"deptgroup":$.extend(s,{onBeforeEdit:function(e){var a=this.options;return!(!a.rely||!a.rely.data||a.valueOption!==FX.WidgetValueOption.CUSTOM)&&(!!FX.Utils.isObjectEmpty(a.limit)&&void FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.distinct),data:$.extend({filter:{cond:FX.Utils.applyFunc(t,i.onGetFilter,[],[]),rel:FX.CONST.FILTER_RELATION.AND}},a.rely.data)},function(e){FX.Utils.isObjectEmpty(e.items)?a.limit={}:a.limit={departs:e.items}},null,function(){e&&e()}))}});break;case"image":$.extend(s,{uploadTokenURL:FX.Utils.getApi(FX.API.file.upload_token,FX.STATIC.APPID),maxFileSize:FX.CONST.MAX_FILE_SIZE,maxLimitTip:"上传失败，单张图片的上传上限为20M",onUploadSuccess:function(){FX.Utils.applyFunc(t,i.onValueChange,[],!1)}}),t.widget.enable||$.extend(s,{mode:"preview",noFileTip:"暂无内容",disableMode:"form"});break;case"upload":$.extend(s,{uploadTokenURL:FX.Utils.getApi(FX.API.file.upload_token,FX.STATIC.APPID),maxFileSize:FX.CONST.MAX_FILE_SIZE,maxLimitTip:"上传失败，单个文件的上传上限为20M",onUploadSuccess:function(){FX.Utils.applyFunc(t,i.onValueChange,[],!1)}}),t.widget.enable||$.extend(s,{mode:"preview",noFileTip:"暂无内容",disableMode:"form"});break;case"signature":$.extend(s,{allowSign:FX.Vip.hasSignature(),disableMode:"form"});break;case"radiogroup":$.extend(s,{onAfterItemSelect:function(e,t){a.effectItemLinkWidgets(t&&t.isOther)}})}return s},_hasContactWidgets:function(e){return("combo"===e.type||"radiogroup"===e.type)&&!e.async},isVisible:function(){return this.widget.visible},isNoRepeat:function(){return this.widget.noRepeat},isSubformWidget:function(){return!1},getSubformName:function(){return""},getOptionValue:function(){return this.widget.value},getLinkForm:function(){return this.widget.linkForm},getLinkFilter:function(){return this.widget.linkFilter},getRely:function(){return this.widget.rely},getFormat:function(){return this.widget.format},getAsync:function(){return this.widget.async},getValueOption:function(){return this.widget.valueOption},getWidgetName:function(){return this.widget.widgetName},getWidgetType:function(){return this.widget.type},getLinkType:function(){return"linkdata"===this.widget.type?this.widget.linkType:this.widget.type},getWidgetByName:function(e,t){return this.field.getWidgetByName(e,t)},getInvalidateType:function(){return this.field.getInvalidateType()},setInvalidateType:function(e){this.field.setInvalidateType(e)},setErrorState:function(e){if(this.element.addClass("error"),this.element.children(".error-info").length<=0){var t="此项为必填项";e&&(t=e),"regex"===this.getInvalidateType()&&(t="此项格式不正确"),this.element.append($('<div class="error-info"/>').text(t))}},clearErrorState:function(){this.setInvalidateType(),this.element.removeClass("error").children(".error-info").remove()},supportLayout:function(){var e=this.widget,t=!0;return"linkdata"!==e.type&&"linkquery"!==e.type||FX.Utils.forEach(e.linkFields,function(e,i){if("subform"===i.type)return t=!1,!1}),t},clearLimit:function(){this.widget.limit={},this.field.clearLimit&&this.field.clearLimit()},setValue:function(e){this.field.setValue(e)},getValue:function(){return this.field.getValue()},setText:function(e){this.field.setText(e)},getText:function(){return this.field.getText()},getNullValue:function(){return this.field.getNullValue()},getLinkValue:function(){return this.field.getLinkValue?this.field.getLinkValue():this.field.getValue()},setCacheValue:function(e){this.field.setCacheValue(e)},getCacheValue:function(){return this.field.getCacheValue()},rebuild:function(){["combo","combocheck"].indexOf(this.widget.type)>-1&&this.getAsync()&&(this.field.items=null),this.field.rebuild()},reload:function(e){this.field.reload(e)},effectItemLinkWidgets:function(e){var t=this.options,i=this.widget;if(this._hasContactWidgets(i)){var a=[],s=this.getValue();FX.Utils.forEach(i.items,function(t,i){return i.value===s?(a=i.widgetsMap||[],!1):!i.isOther||FX.Utils.isEmpty(s)&&!e?void 0:(a=i.widgetsMap||[],!1)}),FX.Utils.applyFunc(this,t.onAssociate,[i.widgetName,a],!1)}},effectStopEdit:function(){FX.Utils.applyFunc(this.field,this.field.options.onStopEdit,[],!1)},effectBeforeAsync:function(){FX.Utils.applyFunc(this.field,this.field.options.onBeforeAsync,[],!1)},checkValidate:function(){return this.field.checkValidate()},getOptions:function(){return this.field.getOptions()},setOptions:function(e){$.extend(this.field.options,e)}}),function(e){FX.FormItemDisable=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.FormItemDisable.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_form_item_disable",shouldResize:!1,widgetType:null,waterMark:"暂无内容"})},_init:function(){FX.FormItemDisable.superclass._init.apply(this,arguments);var e=this.options;switch(this.widgetType=e.widgetType,this.widgetType){case"number":var t="[-]?[\\d]{0,}";e.allowDecimals&&(t="[-]?[\\d]{0,}[\\.]?[\\d]{0,}"),e.regex="^"+t+"$";break;case"user":case"usergroup":case"dept":case"deptgroup":this.selectMap={};break;case"radiogroup":case"combo":i="";FX.Utils.forEach(e.items,function(e,t){if(t.selected&&!t.isOther)return i=t.value,!1}),this.setValue(i);break;case"checkboxgroup":case"combocheck":var i=[];FX.Utils.forEach(e.items,function(e,t){t.selected&&i.push(t.value)}),this.setValue(i)}this.element.attr("data-watermark",e.waterMark)},doResize:function(e){var t=this.options;e&&(t.width=e.width,t.height=e.height),t.shouldResize&&(FX.Utils.isEmpty(t.width)||this.element.css({width:t.width}),FX.Utils.isEmpty(t.height)||this.element.css({height:t.height}))},setValue:function(t){var i=this,a=this.options;switch(this.widgetType){case"number":t=FX.Utils.fixDecimalPrecision(t),this.value=t,this.cacheValue=t,this.setText(t);break;case"datetime":var s=FX.FormItemUtils.getDateTimeViewMode(a.format);this.value=FX.FormItemUtils.formatDateTimeValue(t,s),this.setText(this.value?FX.Utils.date2Str(new Date(this.value),a.format):null);break;case"checkboxgroup":case"combocheck":this.value=t,this.cacheValue=t,this.setText(e.makeArray(t).join(","));break;case"user":t=FX.FormItemUtils.dealCurrentUser(t),this.value=FX.FormItemUtils.parseUserDeptDefaultValue(t);r="";FX.Utils.isEmpty(t)||(r=t.nickname||t.name,this.selectMap[t._id]={id:t._id,name:r}),this.setText(r);break;case"usergroup":this.value=[];var n={},o=[];FX.Utils.forEach(t,function(e,t){if(t=FX.FormItemUtils.dealCurrentUser(t))if(t._id){if(!n[t._id]){n[t._id]=!0,i.value.push(t._id);var a=t.nickname||t.name;i.selectMap[t._id]={id:t._id,name:a},o.push(a)}}else n[t]||(n[t]=!0,i.value.push(t))}),this.setText(o.join(","));break;case"dept":FX.FormItemUtils.dealCurrentDept(t,function(e){i.value=FX.FormItemUtils.parseUserDeptDefaultValue(e);var t="";FX.Utils.isEmpty(e)||(t=e.name,i.selectMap[e._id]={id:e._id,name:t}),i.setText(t)});break;case"deptgroup":FX.FormItemUtils.dealCurrentDeptList(t,function(e){i.value=[];var t={},a=[];FX.Utils.forEach(e,function(e,s){s&&s._id?t[s._id]||(t[s._id]=!0,i.value.push(s._id),a.push(s.name),i.selectMap[s._id]={id:s._id,name:s.name}):t[s]||(t[s]=!0,i.value.push(s))}),i.setText(a.join(","))});break;case"address":if(this.value=t,FX.Utils.isObjectEmpty(t))this.setText("");else{var l=a.needDetail?"pcda":"pcd",r=FX.Utils.address2Str(t,"",l);this.setText(r)}break;case"location":if(this.value=t,FX.Utils.isObjectEmpty(t))this.setText("");else{r=FX.Utils.address2Str(t,"","pcda");if(a.lnglatVisible){var d=FX.Utils.getLnglatText(t);a.subform?r+="("+d+")":e('<div class="disable-info"/>').text(d).appendTo(this.element)}this.setText(r)}break;case"text":case"textarea":case"radiogroup":case"combo":t=FX.Utils.isEmpty(t)?"":t+"",this.value=t,this.cacheValue=t,this.setText(t)}},getValue:function(){switch(this.widgetType){case"number":return FX.Utils.str2num(this.value);default:return this.value}},setText:function(e){this.element.html(FX.Utils.replaceURL(e&&e.toString()))},getText:function(){return this.element.text()},getNullValue:function(){switch(this.widgetType){case"checkboxgroup":case"combocheck":case"usergroup":case"deptgroup":return[];case"address":case"location":return{};case"text":case"textarea":return"";default:return null}},checkValidate:function(){var e=this.options,t=!0,i=this.getValue();switch(this.widgetType){case"datetime":!e.allowBlank&&FX.Utils.isEmpty(i)&&(t=!1),e.startDate&&this.value<e.startDate&&(t=!1),e.endDate&&this.value>e.endDate&&(t=!1);break;case"checkboxgroup":case"combocheck":!e.allowBlank&&i&&0===i.length&&(t=!1);break;case"user":case"dept":FX.Utils.isExternalLink()?(this.setInvalidateType("regex"),t=!1):FX.Utils.isEmpty(i)&&(t=e.allowBlank);break;case"usergroup":case"deptgroup":FX.Utils.isExternalLink()?(this.setInvalidateType("regex"),t=!1):!e.allowBlank&&FX.Utils.isObjectEmpty(i)&&(t=!1);break;default:if(FX.Utils.isObjectEmpty(i))t=e.allowBlank;else if(!FX.Utils.isEmpty(e.regex)){try{t=new RegExp(e.regex).test(i)}catch(e){t=!1}t||this.setInvalidateType("regex")}}return t},rebuild:function(){FX.FormItemDisable.superclass.rebuild.apply(this,arguments),this.cacheValue=""},setCacheValue:function(e){this.setValue(e)},getCacheValue:function(){var e;switch(this.widgetType){case"number":e=FX.Utils.str2num(this.cacheValue);break;case"user":case"dept":var t=this.selectMap[this.value];e=t?{_id:t.id,name:t.name}:null;break;case"usergroup":case"deptgroup":var i=this;e=[],FX.Utils.forEach(this.getValue(),function(t,a){var s=i.selectMap[a];e.push({_id:s.id,name:s.name})});break;case"address":case"location":case"datetime":e=this.getValue();break;default:e=this.cacheValue}return e},getLinkValue:function(){switch(this.widgetType){case"combo":var e=this.getValue();return e&&e.toString();default:return this.getValue()}}}),e.shortcut("formitemdisable",FX.FormItemDisable)}(jQuery),function(e){FX.TextEditor=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.TextEditor.superclass._defaultConfig.apply(),{baseCls:"fui_text",inputCls:"x-input",width:240,height:30,allowBlank:!0,noRepeat:!1,onValidateSuccess:null,onValidateFail:null,onAfterValidate:null,onBeforeEdit:null,onAfterEdit:null,onStopEdit:null})},_init:function(){FX.TextEditor.superclass._init.apply(this,arguments);var e=this.options,t=this;this.editComp=this._createEditComp(),this.editComp.addClass(e.inputCls).appendTo(this.element),e.waterMark&&this.editComp.attr("placeholder",e.waterMark),this.editComp.focus(function(i){t.$err&&t.$err.hide(),t.isEnabled()&&t._isScanEditable()&&(t.editComp.addClass(e.inputCls+"-focus"),FX.Utils.applyFunc(t,e.onBeforeEdit,[i],!1))}).blur(function(i){if(t.isEnabled()&&t._isScanEditable()){t.editComp.removeClass(e.inputCls+"-focus");var a=t.checkValidate();a&&(t.cacheValue=t.getValue(),FX.Utils.applyFunc(t,e.onStopEdit,[a,i],!1))}}).keyup(function(i){t.isEnabled()&&t._isScanEditable()&&FX.Utils.applyFunc(t,e.onAfterEdit,[i],!1)})},_createEditComp:function(){return e("<input type='text'/>")},checkValidate:function(){var e=this.options,t=this.editComp.val().trim(),i=!0;if(FX.Utils.isEmpty(t))i=e.allowBlank;else if(!FX.Utils.isEmpty(e.regex)){try{i=new RegExp(e.regex).test(t)}catch(e){i=!1}i||this.setInvalidateType("regex")}return i?!1===FX.Utils.applyFunc(this,e.onValidateSuccess,[t],!1)&&this.setState(FX.States.NORMAL):!1===FX.Utils.applyFunc(this,e.onValidateFail,[t],!1)&&this.setState(FX.States.ERROR),FX.Utils.applyFunc(this,e.onAfterValidate,[t,i],!1),i},showErrorMsg:function(t){FX.Utils.isEmpty(t)||(this.$err||(this.$err=e('<span class="invalid-info"/>').appendTo(this.element)),this.$err.text(t).show())},select:function(){this.editComp&&(this.editComp.select(),this.editComp.focus())},_isScanEditable:function(){var e=this.options;return!e.scan||e.scan.editable},setEnable:function(e){FX.TextEditor.superclass.setEnable.apply(this,[e]),e&&this._isScanEditable()?this.editComp.removeAttr("readOnly"):this.editComp.attr("readOnly","readOnly")},setText:function(e){this.setValue(e)},setValue:function(e){this.editComp.val(e),this.cacheValue=e},getText:function(){return this.getValue()},getValue:function(){return this.editComp.val().trim()},getCacheValue:function(){return this.cacheValue},rebuild:function(){FX.TextEditor.superclass.rebuild.apply(this,arguments),this.cacheValue=""},reset:function(){this.setValue("")},setState:function(e){var t=this.options,i=t.inputCls+"-error "+t.inputCls+"-success "+t.inputCls+"-warning";switch(t.state=e,e){case FX.States.SUCCESS:this.editComp.removeClass(i).addClass(t.inputCls+"-success");break;case FX.States.ERROR:this.editComp.removeClass(i).addClass(t.inputCls+"-error");break;case FX.States.WARNING:this.editComp.removeClass(i).addClass(t.inputCls+"-warning");break;default:this.editComp.removeClass(i)}},getState:function(){return this.options.state?0:this.options.state},getOptions:function(){var t=this.options;return e.extend(FX.TextEditor.superclass.getOptions.apply(this,arguments),{regex:t.regex,noRepeat:t.noRepeat,scan:t.scan})},getNullValue:function(){return""}}),e.shortcut("text",FX.TextEditor)}(jQuery),function(e){FX.TextArea=FX.extend(FX.TextEditor,{_defaultConfig:function(){return e.extend(FX.TextArea.superclass._defaultConfig.apply(),{baseCls:"fui_textarea",inputCls:"x-textarea",width:420,height:140})},_createEditComp:function(){return e("<textarea/>")}}),e.shortcut("textarea",FX.TextArea)}(jQuery),function(e){FX.Number=FX.extend(FX.TextEditor,{_defaultConfig:function(){return e.extend(FX.Number.superclass._defaultConfig.apply(),{allowDecimals:!1,allowNegative:!0})},_init:function(){FX.Number.superclass._init.apply(this,arguments);var e=this.options,t="[\\d]{0,}";e.allowDecimals&&(t="[\\d]{0,}[\\.]?[\\d]{0,}"),e.allowNegative&&(t="[-]?"+t),e.regex="^"+t+"$"},_createEditComp:function(){return e("<input/>")},getOptions:function(){var t=this.options;return e.extend(FX.Number.superclass.getOptions.apply(this,arguments),{allowDecimals:t.allowDecimals,allowNegative:t.allowNegative})},setValue:function(e){e=FX.Utils.fixDecimalPrecision(e),this.editComp.val(e),this.cacheValue=e},getValue:function(){var e=this.editComp.val();return FX.Utils.str2num(e)},getCacheValue:function(){var e=this.cacheValue;return FX.Utils.str2num(e)},getNullValue:function(){return null},getText:function(){return this.editComp.val()}}),e.shortcut("number",FX.Number)}(jQuery),function(e){FX.Password=FX.extend(FX.TextEditor,{_createEditComp:function(){return e('<input type="password"/>')}}),e.shortcut("password",FX.Password)}(jQuery),function(e){FX.Trigger=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Trigger.superclass._defaultConfig.apply(),{baseCls:"fui_trigger",width:240,height:30,btnWidth:30,waterMark:null,onElementCreate:null,triggerIcon:"",hAdjust:0,edge:{width:240,height:200}})},_init:function(){FX.Trigger.superclass._init.apply(this,arguments);var e=this.options;!1===FX.Utils.applyFunc(this,e.onElementCreate,[],!1)&&(this.editComp=this._createEditComp(),e.waterMark&&this.editComp.attr("placeholder",e.waterMark),this.triggerBtn=this._createTriggerBtn()),this._bindEvts()},_createEditComp:function(){return e('<input class="fui_trigger-input" onfocus="this.blur();"/>').attr("readOnly","readOnly").attr("UNSELECTABLE","on").appendTo(this.element)},_createTriggerBtn:function(){return e('<i class="fui_trigger-btn"/>').addClass(this.options.triggerIcon).appendTo(this.element)},_bindEvts:function(){var e=this;this.element.unbind("click.trigger"),this.element.bind("click.trigger",function(t){e._onTriggerClick()})},_onTriggerClick:function(e){},_getTriggerView:function(){var t=e(".x-dropdown-wrapper");return 0===t.length&&(t=e('<div class="x-dropdown-wrapper"/>').appendTo("body")),t},_calTriggerViewPos:function(){var t=this.options,i={"z-Index":FX.STATIC.zIndex++},a=this.element.offset(),s=this.options.edge,n=document.body.clientWidth-a.left,o=a.top-e("body").offset().top;return n<s.width?(i.right=n-this.element.outerWidth()+t.hAdjust,i.left="auto"):(i.right="auto",i.left=a.left+t.hAdjust),document.body.clientHeight+document.body.scrollTop-o-this.element.outerHeight()<s.height?(i.top="auto",i.bottom=document.body.clientHeight-o):(i.top=o+this.element.outerHeight(),i.bottom="auto"),i},setValue:function(e){this.setText(e)},setText:function(e){this.editComp.val(e)},getValue:function(){return this.getText()},getText:function(){return this.editComp.val()},doResize:function(e){FX.Trigger.superclass.doResize.apply(this,arguments);var t=this.options.height;this.element.css({"line-height":t-2+"px"})}})}(jQuery),function(e){FX.DateTime=FX.extend(FX.Trigger,{_defaultConfig:function(){return e.extend(FX.DateTime.superclass._defaultConfig.apply(),{baseCls:"fui_datetime",triggerIcon:"icon-widget-datetime",startDate:null,endDate:null,allowBlank:!0,format:"yyyy-MM-dd",onAfterEdit:null,defaultPickDate:null,edge:{width:240,height:315}})},_init:function(){FX.DateTime.superclass._init.apply(this,arguments);var e=this.options;this.viewMode=FX.FormItemUtils.getDateTimeViewMode(e.format),this.std=this._initStartDate(e.startDate,this.viewMode),this.edd=this._initEndDate(e.endDate,this.viewMode)},_onTriggerClick:function(){if(this.isEnabled()){var t=this;this._showDatePicker(),e(document).bind("mousedown.datepicker",function(i){var a=i.target;0===e(a).closest(t.datepicker.element).length&&t._hideDatePicker()})}},_initStartDate:function(e,t){if(!e)return null;var i=new Date(e);switch(t){case 0:return new Date(i.getFullYear(),i.getMonth(),1,0,0,0);case 1:return new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0);case 2:var a=new Date;return a.setHours(0),a.setMinutes(0),a.setSeconds(0),a;case 3:return new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0);default:return i}},_initEndDate:function(e,t){if(!e)return null;var i=new Date(e);switch(t){case 0:return new Date(i.getFullYear(),i.getMonth(),i.getMonthDays(),23,59,59);case 1:return new Date(i.getFullYear(),i.getMonth(),i.getDate(),23,59,59);case 2:var a=new Date;return a.setHours(23),a.setMinutes(59),a.setSeconds(59),a;case 3:return new Date(i.getFullYear(),i.getMonth(),i.getDate(),23,59,59);default:return i}},_showDatePicker:function(){var e=this,t=this.options;if(!this.datepicker){var i=null;i=this.value?new Date(this.value):t.defaultPickDate?new Date(t.defaultPickDate):new Date;var a={viewMode:this.viewMode,startDate:this.std,endDate:this.edd,customCls:"x-dropdown",date:i,onDateUpdate:function(){var i=this.getValue();i?e.setValue(i.getTime()):e.setValue(null),FX.Utils.applyFunc(e,t.onAfterEdit,arguments,!1)},onClear:function(){e._hideDatePicker()},onOk:function(){e._hideDatePicker()},onClose:function(){e._hideDatePicker()},onToday:function(){e._hideDatePicker()}};this.datepicker=new FX.DatePicker(a)}this.datepicker.element.appendTo("body").css(this._calTriggerViewPos()).show()},_hideDatePicker:function(){this.datepicker&&(e(document).unbind("mousedown.datepicker"),this.datepicker.element.detach(),FX.Utils.applyFunc(this,this.options.onStopEdit,[],!1))},checkValidate:function(){var e=this.options;return!(!e.allowBlank&&FX.Utils.isEmpty(this.getValue()))&&(!(e.startDate&&this.value<e.startDate)&&!(e.endDate&&this.value>e.endDate))},getOptions:function(){var t=this.options;return e.extend(FX.DateTime.superclass.getOptions.apply(this,arguments),{format:t.format})},rebuild:function(){FX.DateTime.superclass.rebuild.apply(this,arguments),this.datepicker&&(this.datepicker.element.remove(),this.datepicker=null)},setValue:function(e){var t=this.options;this.value=FX.FormItemUtils.formatDateTimeValue(e,this.viewMode),this.setText(this.value?FX.Utils.date2Str(new Date(this.value),t.format):null)},setText:function(e){this.editComp.val(e)},getValue:function(){return this.value},getText:function(){return this.editComp.val()}}),e.shortcut("datetime",FX.DateTime)}(jQuery),function(e){FX.DatePicker=FX.extend(FX.Widget,{CONSTS:{VIEWMODE:{YM:0,YMD:1,HMS:2,YMDHMS:3,HM:4},MINYEAR:1900,MAXYEAR:2999,NAV:{prevm:2,nextm:3,title:4,clear:5,today:6,dok:7,prevy:8,nexty:9,cancel:10,mok:11,plus:12,minus:13,current:15,day:100,month:200,year:300}},_TT:{CALENDAR:"日历",CLEAR:"清空",TODAY:"今天",OK:"确定",CURRENT:"当前",TIME:"时间"},_defaultConfig:function(){return e.extend(FX.DatePicker.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_datepicker",viewMode:1,endDate:null,startDate:null,date:null,hasFooterBtn:!0,onDateUpdate:null,onClear:null,onOk:null,onClose:null,onToday:null})},_init:function(){FX.DatePicker.superclass._init.apply(this,arguments),this.cache={showYear:null,showMonth:null},this._initTables(),this._bindEvts()},_initTables:function(){var t=this.options;switch(this.$datetable=this._createDatePicker(),this._loadDateData(this.$datetable,new Date(this.options.date)),this.$monthtable=this._createMonthPicker(),this.$timetable=this._createTimePicker(),t.viewMode){case this.CONSTS.VIEWMODE.YM:this._loadMonthData(this.$monthtable,new Date(this.options.date)),this.$monthtable.appendTo(this.element).show();break;case this.CONSTS.VIEWMODE.HMS:this._loadTimeData(this.$timetable,this.options.date),this._addTimeOptPane(this.$timetable),this.$timetable.appendTo(this.element).show();break;case this.CONSTS.VIEWMODE.HM:this.$timetable.remove(),this.$timetable=this._createTimePicker({s:!1}),this._loadTimeData(this.$timetable,this.options.date),this.$timetable.appendTo(this.element).show();break;case this.CONSTS.VIEWMODE.YMD:this.$datetable.appendTo(this.element).show(),this.$monthtable.hide().appendTo(this.element);break;default:this.$datetable.appendTo(this.element).show(),this.$monthtable.hide().appendTo(this.element);var i=e("<tr/>").prependTo(this.$datetable.find("tfoot"));this._loadTimeData(this.$timetable,this.options.date),this.$timetable.show().appendTo(e('<td colspan="7"/>').appendTo(i))}},_createTimePicker:function(t){t=t||{};var i=e('<table cellspacing = "0" cellpadding = "0" class="tt"/>'),a=e("<tbody>").appendTo(i),s=this,n=this.options,o=this.CONSTS.NAV,l=e("<td/>").append(e('<i class="icon-angleup"/>')).data("nav",o.plus),r=e("<td/>").append(e('<i class="icon-angledown"/>')).data("nav",o.minus),d=e("<tr/>").append(e('<td rowspan="2"/>').text(this._TT.TIME));return!1!==t.h&&(i.$h=e("<input/>").data("time","h").keyup(function(){var e=this.value,t=parseInt(e,10);t<24&&t>=0&&(n.date.setHours(t),FX.Utils.applyFunc(s,n.onDateUpdate,arguments))}).focus(function(){i.focus=e(this)}),i.focus=i.$h,d.append(e('<td rowspan="2"/>').append(i.$h))),!1!==t.m&&(i.$m=e("<input/>").data("time","m").keyup(function(){var e=this.value,t=parseInt(e,10);t<60&&t>=0&&(n.date.setMinutes(t),FX.Utils.applyFunc(s,n.onDateUpdate,arguments))}).focus(function(){i.focus=e(this)}),i.focus=i.$m,d.append(e('<td class="common" rowspan="2"/>').text(":")).append(e('<td rowspan="2"/>').append(i.$m))),!1!==t.s&&(i.$s=e("<input/>").data("time","s").keyup(function(){var e=this.value,t=parseInt(e,10);t<60&&t>=0&&(n.date.setSeconds(t),FX.Utils.applyFunc(s,n.onDateUpdate,arguments))}).focus(function(){i.focus=e(this)}),i.focus=i.$s,d.append(e('<td class="common" rowspan="2"/>').text(":")).append(e('<td rowspan="2"/>').append(i.$s))),d.append(l).appendTo(a),e("<tr/>").append(r).appendTo(a),i},_addTimeOptPane:function(t){var i=this.CONSTS.NAV,a=e("<tfoot/>"),s=e("<tr/>").appendTo(a);this._createCell(s,this._TT.CLEAR,2,i.clear,"clear"),this._createCell(s,this._TT.CURRENT,3,i.current,"current"),this._createCell(s,this._TT.OK,2,i.dok,"ok"),a.appendTo(t)},_createDatePicker:function(){var t=this.options,i=e('<table cellspacing = "2px" cellpadding = "0" class="dt"/>'),a=this.CONSTS.NAV,s=e("<thead/>").appendTo(i);r=e('<tr class = "mainhead"/>'),i.$prevm=this._createCell(r,'<i class="icon-angleleft"/>',1,a.prevm,"prevm"),i.$title=e('<td class="title" colspan="5"/>').data("nav",a.title).appendTo(r),i.$nextm=this._createCell(r,'<i class="icon-angleright"/>',1,a.nextm,"nextm"),r.appendTo(s),r=e("<tr/>");for(n=7;n>0;--n)e("<td/>").appendTo(r);for(var n=0;n<7;++n){var o=r.children().eq(n);o.addClass("day name").text(Date._SDN[n]),-1!=[0,6].indexOf(n)&&o.addClass("weekend")}r.appendTo(s);var l=e('<tbody onselectstart="return false"/>').appendTo(i);for(n=6;n>0;n--)for(var r=e("<tr/>").appendTo(l),d=0;d<7;d++)e("<td/>").appendTo(r);var c=e("<tfoot/>").appendTo(i);if(t.hasFooterBtn){this._createCell(e("<tr/>").appendTo(c),"",7,null,"split");r=e("<tr/>");this._createCell(r,this._TT.CLEAR,2,a.clear,"clear"),this._createCell(r,this._TT.TODAY,3,a.today,"today"),this._createCell(r,this._TT.OK,2,a.dok,"ok"),r.appendTo(c)}return i},_createMonthPicker:function(){for(var t=e('<table cellspacing = "2px" cellpadding = "0" class="mt"/>'),i=this.CONSTS.NAV,a=e("<tbody/>").appendTo(t),s=e("<tr/>").appendTo(a),n=0;n<2;n++)e('<td class="month"/>').appendTo(s);this._createCell(s,'<i class="icon-angleleft"/>',1,i.prevy," prevy"),this._createCell(s,'<i class="icon-angleright"/>',1,i.nexty," nexty");for(var o=0;o<5;o++)s=e("<tr/>").appendTo(a),e('<td class="month"/><td class="month"/><td class="year"/><td class="year"/>').appendTo(s);var l=e("<tfoot/>").appendTo(t);return s=e("<tr/>").appendTo(l),this._createCell(s,this._TT.OK,4,i.mok,"ok"),t},_toPrevMonth:function(){var e=this.options.startDate,t=this.options.date,i=this.cache.showMonth,a=this.cache.showYear;e?a>e.getFullYear()?i>0?this._setMonth(i-1):(t.setFullYear(a-1),this._setMonth(11)):a==e.getFullYear()&&i>e.getMonth()&&i>0&&(this._setMonth(i-1),t<e&&(t=new Date(e))):i>0?this._setMonth(i-1):(t.setFullYear(a-1),this._setMonth(11))},_toNextMonth:function(){var e=this.options.endDate,t=this.options.date,i=this.cache.showMonth,a=this.cache.showYear;e?a<e.getFullYear()?i<11?this._setMonth(i+1):(t.setFullYear(a+1),this._setMonth(0)):a==e.getFullYear()&&i<e.getMonth()&&(this._setMonth(i+1),t>e&&(t=new Date(e))):i<11?this._setMonth(i+1):(t.setFullYear(a+1),this._setMonth(0))},_toPrevDecade:function(){var e,t,i=this.options.startDate,a=this.options.date,s=a.getFullYear()-10,n=a.getMonth();i&&s==(t=i.getFullYear())&&(e=i.getMonth()),(!t||t<this.CONSTS.MINYEAR)&&(t=this.CONSTS.MINYEAR),s<t?(a.setFullYear(t),n<e&&a.setMonth(e)):a.setFullYear(s)},_toNextDecade:function(){var e,t,i=this.options.endDate,a=this.options.date,s=a.getFullYear()+10,n=a.getMonth();i&&s==(t=i.getFullYear())&&(e=i.getMonth()),(!t||t>this.CONSTS.MAXYEAR)&&(t=this.CONSTS.MAXYEAR),s>t?(a.setFullYear(t),n<e&&a.setMonth(e)):a.setFullYear(s)},_setMonth:function(e){var t=this.options.date,i=t.getDate(),a=this.options.endDate,s=this.options.startDate,n=t.getMonthDays(e);i>n&&t.setDate(n),t.setMonth(e),a&&t>a&&t.setDate(a.getDate()),s&&t<s&&t.setDate(s.getDate())},_loadDateData:function(e,t){if(t){var i=t.getFullYear(),a=t.getMonth(),s=t.getDate(),n=new Date,o=n.getFullYear(),l=n.getMonth(),r=n.getDate();this.cache.showYear=i,this.cache.showMonth=a;var d=this.options.startDate,c=this.options.endDate;e.$title.text(Date._MN[a]+", "+i);var u=new Date(t);u.setDate(u.getMonthDays()+1),c&&u>c||u.getFullYear()>this.CONSTS.MAXYEAR?e.$nextm.addClass("disabled").removeClass("hover").data("disabled",!0):e.$nextm.removeClass("disabled").data("disabled",!1);var h=new Date(t);h.setDate(0),d&&h<d||h.getFullYear()<this.CONSTS.MINYEAR?e.$prevm.addClass("disabled").removeClass("hover").data("disabled",!0):e.$prevm.removeClass("disabled").data("disabled",!1),t.setDate(1);var p=t.getDay()%7;t.setDate(0-p),t.setDate(t.getDate()+1);for(var f=e.find("tbody").children().eq(0),m=0;m<6&&f.length;m++){for(var g,F=f.children(),v=0;v<7;++v,t.setDate(g+1)){var _=F.eq(v);if(_.removeClass().data("nav",this.CONSTS.NAV.day),!_.length)break;g=t.getDate(),_.text(g);var b=t.getMonth()==a;if(b){var y=!1;if(null!=d&&d>t||null!=c&&c<t?(_.addClass("day disabled"),y=!0):_.addClass("day"),_.data("disabled",y),!y){b&&g==s&&(this.cache.selectedDate&&this.cache.selectedDate.removeClass("selected"),_.addClass("selected"),this.cache.selectedDate=_,this.cache.showDay=g),t.getFullYear()==o&&t.getMonth()==l&&g==r&&_.addClass("today");var C=t.getDay();-1!=[0,6].indexOf(C)&&_.addClass("weekend")}}else _.addClass("oday").data("disabled",!0)}f=f.next()}}},_loadMonthData:function(t,i){if(i){var a=i.getFullYear(),s=i.getMonth(),n=e(t).data("midYear");n?a>n+5?n+=10:a<n-4&&(n-=10):n=a,e(t).data("midYear",n);var o,l,r,d,c=[n-4,n-3,n-2,n-1,n,n+1,n+2,n+3,n+4,n+5],u=e("td.year",t),h=e("td.month",t),p=this.options,f=p.endDate,m=p.startDate;f&&f&&a==(o=f.getFullYear())&&(l=f.getMonth()),(!o||o>this.CONSTS.MAXYEAR)&&(o=this.CONSTS.MAXYEAR),m&&m&&a==(r=m.getFullYear())&&(d=m.getMonth()),(!r||r<this.CONSTS.MINYEAR)&&(r=this.CONSTS.MINYEAR);for(var g=0;g<12;g++){var F=h.eq(g).text(Date._MN[g]).data("nav",this.CONSTS.NAV.month).data("month",g);if(g==s&&(this.cache.selectedMonth&&this.cache.selectedMonth.removeClass("selected"),F.addClass("selected"),this.cache.selectedMonth=F),!FX.Utils.isEmpty(d)&&g<d||!FX.Utils.isEmpty(l)&&g>l?F.addClass("disabled").data("disabled",!0):F.removeClass("disabled").data("disabled",!1),g<10){var v=u.eq(g).text(c[g]).data("nav",this.CONSTS.NAV.year);c[g]==a&&(this.cache.selectedYear&&this.cache.selectedYear.removeClass("selected"),v.addClass("selected"),this.cache.selectedYear=v),!FX.Utils.isEmpty(r)&&c[g]<r||!FX.Utils.isEmpty(o)&&c[g]>o?v.addClass("disabled").data("disabled",!0):v.removeClass("disabled").data("disabled",!1)}}var _=e("td.prevy",t).removeClass("disabled").data("disabled",!1);c[0]<=r&&_.addClass("disabled").data("disabled",!0).removeClass("hover");var b=e("td.nexty",t).removeClass("disabled").data("disabled",!1);c[9]>=o&&b.addClass("disabled").data("disabled",!0).removeClass("hover")}},_loadTimeData:function(e,t){if(t){var i=t.getHours()+"",a=t.getMinutes()+"",s=t.getSeconds()+"";e.$h&&e.$h.val(FX.Utils.leftPad(i,2,"0")),e.$m&&e.$m.val(FX.Utils.leftPad(a,2,"0")),e.$s&&e.$s.val(FX.Utils.leftPad(s,2,"0"))}},_doTimeInc:function(e,t){var i=t.data("time"),a=this.options;if("h"===i){s=(a.date.getHours()+1)%24;a.date.setHours(s),e.$h.val(FX.Utils.leftPad(s+"",2,"0"))}else if("m"===i){s=(a.date.getMinutes()+1)%60;a.date.setMinutes(s),e.$m.val(FX.Utils.leftPad(s+"",2,"0"))}else{var s=(a.date.getSeconds()+1)%60;a.date.setSeconds(s),e.$s.val(FX.Utils.leftPad(s+"",2,"0"))}t.select(),FX.Utils.applyFunc(this,a.onDateUpdate,arguments,!1)},_doTimeDec:function(e,t){var i=t.data("time"),a=this.options;if("h"===i){s=(a.date.getHours()+23)%24;a.date.setHours(s),e.$h.val(FX.Utils.leftPad(s+"",2,"0"))}else if("m"===i){s=(a.date.getMinutes()+59)%60;a.date.setMinutes(s),e.$m.val(FX.Utils.leftPad(s+"",2,"0"))}else{var s=(a.date.getSeconds()+59)%60;a.date.setSeconds(s),e.$s.val(FX.Utils.leftPad(s+"",2,"0"))}t.select(),FX.Utils.applyFunc(this,a.onDateUpdate,arguments,!1)},_bindEvts:function(){var t=this,i=this.options,a=this.CONSTS.NAV,s=this.$monthtable,n=this.$datetable,o=this.$timetable,l=function(l){var r=l.target,d=e(r).closest("td"),c=l.type,u=d.data("nav");if(!d.data("disabled")&&0!==d.length&&u)if(t.options.date||(t.options.date=new Date),"mouseover"===c)d.addClass("hover");else if("mouseup"===c)switch(d.removeClass("hover"),u){case a.prevm:t._toPrevMonth(),t._loadDateData(n,new Date(t.options.date)),FX.Utils.applyFunc(t,i.onDateUpdate,arguments);break;case a.nextm:t._toNextMonth(),t._loadDateData(n,new Date(t.options.date)),FX.Utils.applyFunc(t,i.onDateUpdate,arguments);break;case a.title:t._loadMonthData(s,new Date(t.cache.showYear,t.cache.showMonth)),s.css({position:"absolute",top:0,"z-index":FX.STATIC.zIndex++}).show("fast");break;case a.clear:t.options.date=null,t.cache.selectedDate&&t.cache.selectedDate.removeClass("selected"),FX.Utils.applyFunc(t,i.onDateUpdate,arguments),FX.Utils.applyFunc(t,i.onClear,arguments);break;case a.current:t.options.date=new Date,FX.Utils.applyFunc(t,i.onDateUpdate,arguments);break;case a.today:var h=new Date;if(t.options.startDate&&h<t.options.startDate||t.options.endDate&&h>t.options.endDate)return;t.options.date=h,t.cache.selectedDate&&t.cache.selectedDate.removeClass("selected"),t.cache.selectedDate=t.$datetable.find("td.today").addClass("selected");var p=i.viewMode;p!==t.CONSTS.VIEWMODE.YMD&&p!==t.CONSTS.VIEWMODE.YM&&t._loadTimeData(t.$timetable,t.options.date),FX.Utils.applyFunc(t,i.onDateUpdate,arguments),FX.Utils.applyFunc(t,i.onToday,arguments);break;case a.dok:FX.Utils.applyFunc(t,i.onDateUpdate,arguments),FX.Utils.applyFunc(t,i.onOk,arguments);break;case a.prevy:t._toPrevDecade(),t._loadMonthData(s,new Date(t.options.date)),FX.Utils.applyFunc(t,i.onDateUpdate,arguments);break;case a.nexty:t._toNextDecade(),t._loadMonthData(s,new Date(t.options.date)),FX.Utils.applyFunc(t,i.onDateUpdate,arguments);break;case a.mok:t._loadDateData(n,new Date(t.options.date)),FX.Utils.applyFunc(t,i.onDateUpdate,arguments),s.hide("fast");break;case a.cancel:t._loadDateData(n,new Date(t.options.date)),s.hide("fast");break;case a.year:t.cache.selectedYear&&t.cache.selectedYear.removeClass("selected"),t.cache.selectedYear=d,(f=t.options.date).setFullYear(d.text()),t._loadMonthData(s,new Date(f)),FX.Utils.applyFunc(t,i.onDateUpdate,arguments);break;case a.month:t.cache.selectedMonth&&t.cache.selectedMonth.removeClass("selected"),t.cache.selectedMonth=d.addClass("selected"),t.options.date.setMonth(d.data("month")),FX.Utils.applyFunc(t,i.onDateUpdate,arguments);break;case a.day:t.cache.selectedDate&&t.cache.selectedDate.removeClass("selected"),t.cache.selectedDate=d.addClass("selected");var f=t.options.date;f.setFullYear(t.cache.showYear),f.setMonth(t.cache.showMonth),f.setDate(d.text()),FX.Utils.applyFunc(t,i.onDateUpdate,arguments),o.parent().length||FX.Utils.applyFunc(t,i.onClose,arguments);break;case a.plus:t._doTimeInc(o,o.focus);break;case a.minus:t._doTimeDec(o,o.focus)}else"mouseout"===c&&d.removeClass("hover")};this.element.unbind(),this.element.bind("mousedown",l).bind("mouseover",l).bind("mouseup",l).bind("mouseout",l)},_createCell:function(t,i,a,s,n){var o=e("<td class/>").attr("colSpan",a).html(i).appendTo(t);return s&&o.data("nav",s),n=n?"btn "+n:"btn",o.addClass(n),o},doResize:function(t){var i=t&&t.width||this.options.width;if(!FX.Utils.isEmpty(i)){this.options.width=i;var a=e("tbody",this.$datetable)[0],s=e("tbody",this.$monthtable),n=e("tbody",this.$timetable),o=parseInt(i/7),l=parseInt(i/4);if(e("td",a).css("width",o),e("td",s).css("width",l),n&&n.length){var r=parseInt((i-120)/3);e("input",n).css("width",r)}}},getValue:function(){var e=this.options,t=this.CONSTS.VIEWMODE,i=this.options.date;return i&&(i.setMilliseconds(0),e.viewMode!==t.YMD&&e.viewMode!==t.YM||i.setHours(0,0,0)),i},setValue:function(e){this.options.date=e},getText:function(){return this.getValue()},setText:function(e){this.setValue(e)}}),e.shortcut("datepicker",FX.DatePicker)}(jQuery),function(e){FX.DateRange=FX.extend(FX.Widget,{VIEW_MODE:{DATE:1,DATE_TIME:3},_defaultConfig:function(){return e.extend(FX.DateRange.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_date_range",format:"yyyy-MM-dd",onStopEdit:null})},_init:function(){FX.DateRange.superclass._init.apply(this,arguments),this.viewMode=this._initViewMode(),this.value={min:null,max:null};var t=e('<div class="range-content"/>').appendTo(this.element);this._createMenu(t),this._createMain(t)},_initViewMode:function(){var e=this.options,t=this.VIEW_MODE,i=t.DATE;return e.format.match(/[YyDd]/)&&e.format.match(/[Hh]/)&&(i=t.DATE_TIME),i},_createMenu:function(t){var i=this,a=this.options,s=e('<div class="content-menu"/>').on("click",function(s){var n=e(s.target).closest(".icon-close-circle");if(n&&n.length)return n.closest(".menu-item").hasClass("start")?i._setSingleValue("start",null):i._setSingleValue("end",null),s.preventDefault(),FX.Utils.applyFunc(i,a.onStopEdit,[],!1),!1;var o=e(s.target).closest(".menu-item");o&&o.length&&!o.hasClass("select")&&(o.addClass("select").siblings().removeClass("select"),t.toggleClass("for-right"))}).appendTo(t);this.$start=e('<div class="menu-item start select"/>').appendTo(s),e('<div class="watermark"/>').text("开始时间").appendTo(this.$start),e('<i class="icon-close-circle"/>').appendTo(this.$start),this.$end=e('<div class="menu-item"/>').appendTo(s),e('<div class="watermark"/>').text("结束时间").appendTo(this.$end),e('<i class="icon-close-circle"/>').appendTo(this.$end),e('<div class="menu-line"/>').appendTo(s)},_createMain:function(t){var i=this,a=this.value.min,s=this.value.max,n=this.options,o=e('<div class="content-main"/>').appendTo(t),l=e('<div class="main-wrapper"/>').appendTo(o),r=this.options.width,d=a||(new Date).setHours(0,0,0,0),c=s||(new Date).setHours(0,0,0,0);this.startDate=new FX.DatePicker({renderEl:e("<div/>").appendTo(l),customCls:"range-picker",viewMode:this.viewMode,date:new Date(d),hasFooterBtn:!1,width:r,onDateUpdate:function(){var e=this.getValue();e?i._setSingleValue("start",e.getTime()):i._setSingleValue("start",null),FX.Utils.applyFunc(i,n.onStopEdit,[],!1)}});var u=e('<div class="main-wrapper"/>').appendTo(o);this.endDate=new FX.DatePicker({renderEl:e("<div/>").appendTo(u),customCls:"range-picker",viewMode:this.viewMode,date:new Date(c),hasFooterBtn:!1,width:r,onDateUpdate:function(){var e=this.getValue();e?i._setSingleValue("end",e.getTime()):i._setSingleValue("end",null),FX.Utils.applyFunc(i,n.onStopEdit,[],!1)}})},_setSingleValue:function(e,t){"start"===e?(this.value.min=t,this._setItemText(t,this.$start),this.endDate.options.startDate=t?new Date(t):null,this.endDate.rebuild()):(this.value.max=t,this._setItemText(t,this.$end),this.startDate.options.endDate=t?new Date(t):null,this.startDate.rebuild())},_setItemText:function(t,i){if(e(".item-text,.item-sub",i).remove(),t){var a=FX.Utils.isDate(t)?t:new Date(t),s=FX.Utils.date2Str(a,"yyyy-MM-dd HH:mm:ss");this.viewMode===this.VIEW_MODE.DATE?e('<div class="item-text"/>').text(s.split(" ")[0]).prependTo(i):(e('<div class="item-sub"/>').text(s.split(" ")[1]).prependTo(i),e('<div class="item-text sub"/>').text(s.split(" ")[0]).prependTo(i))}},doResize:function(e){FX.DateRange.superclass.doResize.apply(this,arguments);var t=e&&e.width;FX.Utils.isEmpty(t)||(this.startDate.doResize({width:t}),this.endDate.doResize({width:t}))},setValue:function(e){var t,i;FX.Utils.isObjectEmpty(e)?(t=null,i=null):(t=e.min,i=e.max),this.startDate.setValue(new Date(t||(new Date).setHours(0,0,0,0))),this.endDate.setValue(new Date(i||(new Date).setHours(0,0,0,0))),this._setSingleValue("start",t),this._setSingleValue("end",i)},getValue:function(){return this.value}}),e.shortcut("daterange",FX.DateRange)}(jQuery),function(e){FX.ComboBox=FX.extend(FX.Trigger,{_defaultConfig:function(){return e.extend(FX.ComboBox.superclass._defaultConfig.apply(),{baseCls:"fui_combo",triggerIcon:"icon-caret-down",triggerList:"combo-list",textField:"text",valueField:"value",allowBlank:!0,async:null,asyncResultKey:"items",items:[{value:"选项1",text:"选项1"},{value:"选项2",text:"选项2"},{value:"选项3",text:"选项3"}],searchable:!0,onItemCreate:null,onAfterItemSelect:null,onAfterTriggerHide:null,limitData:300,emptyTip:null,minWidth4Trigger:160})},_init:function(){FX.ComboBox.superclass._init.apply(this,arguments),this._initStoreValue(),this.options.async&&!this._hasDefaultValue()||this._createTriggerView()},_initStoreValue:function(){var e=this,t=this.options;this.text=null,this.value=null,FX.Utils.forEach(t.items,function(i,a){a.selected&&(e.value=a[t.valueField],e.text=a[t.textField])})},_hasDefaultValue:function(){return!FX.Utils.isEmpty(this.options.value)},_onTriggerClick:function(t){if(this.isEnabled()){this._showTriggerView();var i=this;e(document).bind("mousedown.trigger",function(t){var a=t.target;0===e(a).closest(i.triggerView).length&&i._hideTriggerView()})}},_hideTriggerView:function(){var t=this.options;if(this.triggerView){if(e(document).unbind("mousedown.trigger"),this.triggerView.detach(),FX.Utils.applyFunc(this,t.onAfterTriggerHide,[],!1),!this.changed)return;FX.Utils.applyFunc(this,t.onStopEdit,[],!1)}},_showTriggerView:function(){var e=this.options;null==this.triggerView&&this._createTriggerView(),this.triggerView.appendTo("body").css(this._calTriggerViewPos()).show(),this.$listView.css({maxWidth:Math.max(240,this.element.width()),minWidth:e.minWidth4Trigger}),this.changed=!1},_createTriggerView:function(){if(this.triggerView=e('<div class="x-dropdown"/>'),this.valueMap={},this.options.searchable){var t=this,i=e('<div class="fui_combo-search"/>').appendTo(this.triggerView);e("<input/>").bind("input propertychange",function(e){if(t.searchValue!==this.value){t.searchinterval&&clearTimeout(t.searchinterval),t.searchValue=this.value,t.$listView.empty();var i=t._createLoadingIcon("搜索中...");t.searchinterval=setTimeout(function(){i.remove(),t.startIndex=0,t._onBeforeItemsLoaded(),t._createItemList(t.searchValue)},500)}}).appendTo(i),i.append(e('<i class="icon-search search-icon"/>'))}this.$listView=e('<div class="x-dropdown-list"/>').addClass(this.options.triggerList).appendTo(this.triggerView),this._onLoadItems(),this._bindViewEvts()},_hideItems:function(t){var i=this.$listView.children(".x-dropdown-item");FX.Utils.forEach(i,function(i,a){var s=e(a);s.text().indexOf(t)<0&&s.addClass("hide")})},_onLoadItems:function(e){var t=this.options,i=this;if(t.async&&t.async.url)if(this.items)i._onBeforeItemsLoaded(),FX.Utils.forEach(this.items,function(t,a){i._onItemCreate(a,t,e)});else{var a=this._createLoadingIcon("加载中...");FX.Utils.applyFunc(this,t.onBeforeAsync,[],!1),FX.Utils.dataAjax({url:t.async.url,data:t.async.data},function(s,n){a.remove(),i._onBeforeItemsLoaded(),i.items=FX.Utils.applyFunc(i,t.onAsyncSuccess,[s],!1),!1===i.items?(i.items=[],i.startIndex=0,FX.Utils.forEach(s[t.asyncResultKey],function(e,a){var s={};FX.Utils.isEmpty(a)||(s[t.textField]=a[t.textField]||a,s[t.valueField]=a[t.valueField]||a,i.items.push(s))}),i.items=i._sortItems(i.items),i._createItemList(e)):FX.Utils.forEach(i.items,function(t,a){i._onItemCreate(a,t,e)}),i._onAfterItemsLoaded()},function(){a.remove()})}else if(t.items){if(i._onBeforeItemsLoaded(),FX.Utils.isArray(t.items))FX.Utils.forEach(t.items,function(t,a){i._onItemCreate(a,t,e)});else{var s=0;for(var n in t.items){var o={};o[t.valueField]=n,o[t.textField]=t.items[n],i._onItemCreate(o,s,e),s++}}i._onAfterItemsLoaded()}},_sortItems:function(e){var t=this.options;return e.sort(function(e,i){var a=e[t.valueField]||e[t.textField]||e,s=i[t.valueField]||i[t.textField]||i;return+(a>s)||+(a===s)-1})},_createItemList:function(e){var t=this,i=this.options;this.items||(this.items=i.items||[]),this.startIndex=this.startIndex||0;for(var a=0,s=!0;a<i.limitData;){if(this.startIndex>=this.items.length){s=!1;break}var n=this.items[this.startIndex];this.startIndex++,!1!==t._onItemCreate(n,a,e)&&a++}s&&t._bindLoadMore(e)},_bindLoadMore:function(e){var t=this;this.$listView.bind("scroll.loadMore",function(){t.$listView.scrollTop()+t.$listView.height()+100>=26*t.startIndex&&(t.$listView.unbind("scroll.loadMore"),t._createItemList(e))})},_createLoadingIcon:function(t){var i=this.$listView.children(".loading-text");return 0===i.length&&(i=e('<div class="loading-text"/>').appendTo(this.$listView),e("<span/>").text(t).appendTo(i)),i},_onAfterItemsLoaded:function(){var t=this.options,i=this.$listView.children(e(".x-dropdown-item")),a=t.allowBlank?1:0;t.emptyTip&&i.length<=a&&this.$listView.empty().append(e('<div class="empty-tip"/>').text(t.emptyTip))},_onBeforeItemsLoaded:function(){var t=this;this.options.allowBlank&&e('<a class="x-dropdown-item"/>').text("--请选择--").appendTo(t.$listView)},_onItemCreate:function(t,i,a){var s=this.options,n=this;if(!1===FX.Utils.applyFunc(this,s.onItemCreate,[t,i],!1)){var o=t[s.textField],l=t[s.valueField];if(this.valueMap[l]=o,!FX.Utils.isEmpty(a)&&!new RegExp(FX.Utils.escapeRegexp(a),"i").test(o+""))return!1;var r=e('<a class="x-dropdown-item"/>').data("item",t).attr("option",l).attr("title",o).text(o).appendTo(this.$listView);if(!FX.Utils.isEmpty(l)&&this._isSelected(l)&&(e(".select",this.triggerView).removeClass("select"),r.addClass("select"),this.editComp&&this.editComp.val(o)),t.isOther)if(r.addClass("item-other"),this.textOther)this.textOther.setVisible(this._isSelected(l));else{var d=e('<div class="fui-text-other"/>');s.subform&&d.addClass("subform-other"),this.element.after(d),this.textOther=FX.createWidget({renderEl:d,width:s.width?s.width:240,type:"text",visible:!!t.selected,onStopEdit:function(){FX.Utils.applyFunc(n,s.onStopEdit,[],!1)}})}}},_isSelected:function(e){return this.value==e},_bindViewEvts:function(){var t=this,i=!1;this.triggerView.bind("click",function(a){if(i)i=!1;else{var s=e(a.target).closest("a");if(s.length>0){var n=s.data("item");t._onItemClick(s,n),a.stopEvent()}}})},_onItemClick:function(t,i){var a=this.options;e(".select",this.triggerView).removeClass("select"),i?(t.addClass("select"),this.value=i[a.valueField],this.text=i[a.textField]):(this.value=null,this.text=null),this.editComp&&this.editComp.val(this.text),t.hasClass("item-other")?this.setOtherItemSelect():this.setOtherItemRemove(),FX.Utils.applyFunc(this,a.onAfterItemSelect,[t,i],!1),FX.Utils.applyFunc(this,a.onAfterEdit,[t,i],!1),this.changed=!0,this._hideTriggerView()},effectItemLinkWidgets:function(){var t=this.options;if(!t.async&&this.triggerView){var i=e(".select",this.triggerView);FX.Utils.applyFunc(this,t.onAfterItemSelect,[i,i.data("item")],!1)}},checkValidate:function(){return!(!this.options.allowBlank&&FX.Utils.isEmpty(this.getValue()))},setEnable:function(e){FX.ComboBox.superclass.setEnable.apply(this,[e]),this.textOther&&this.textOther.setEnable(e)},setValue:function(t){var i=this.options;if(this.value=t,this.valueMap&&this.valueMap[t]?this.text=this.valueMap[t]:this.text=t,this.triggerView)if(e(".select",this.triggerView).removeClass("select"),FX.Utils.isEmpty(t))this.setOtherItemRemove();else{var a=[];if(e("a.x-dropdown-item",this.$listView).each(function(s,n){var o=e(n).data("item");o&&(o[i.valueField]!=t||o.isOther||(a=e(n).addClass("select")))}),this.textOther){if(0===a.length)return void this.setOtherItemSelect(t);this.setOtherItemRemove()}}this.editComp&&this.editComp.val(this.text)},setOtherItemSelect:function(e){var t=this.options;this.$listView.children(".item-other").addClass("select"),this.editComp.val("其他");var i=t.width;this.options.subform&&(this.textOther&&this.textOther.doResize({width:.63*t.width}),this.doResize({width:.35*t.width})),t.width=i,this.textOther&&(this.textOther.setVisible(!0),this.textOther.setValue(e))},setOtherItemRemove:function(){var e=this.options;this.options.subform&&this.doResize({width:e.width}),this.textOther&&this.textOther.setVisible(!1)},setText:function(e){this.text=e,this.editComp&&this.editComp.val(e)},getValue:function(){return this.textOther&&this.textOther.isVisible()?this.textOther.getValue():this.value},getLinkValue:function(){var e=this.getValue();return e&&e.toString()},getText:function(){return this.textOther&&this.textOther.isVisible()?this.textOther.getValue():this.text},rebuild:function(){this.triggerView&&(this.triggerView.remove(),this.triggerView=null,this.$listView=null,this.textOther&&(this.textOther.destroy(),this.textOther=null)),FX.ComboBox.superclass.rebuild.apply(this,arguments)},resizeTextOther:function(){var e=this.options,t=e.width;e.subform&&this.textOther&&this.textOther.isVisible()&&(this.textOther.doResize({width:.63*e.width}),this.doResize({width:.35*e.width})),e.width=t},getOptions:function(){var t=this.options,i={noRepeat:t.noRepeat};return t.async&&t.async.url?i.async=t.async:i.items=t.items,e.extend(FX.ComboBox.superclass.getOptions.apply(this,arguments),i)}}),e.shortcut("combo",FX.ComboBox)}(jQuery),function(e){FX.ComboCheckBox=FX.extend(FX.ComboBox,{_defaultConfig:function(){return e.extend(FX.ComboCheckBox.superclass._defaultConfig.apply(),{baseCls:"fui_combocheck",triggerList:"combocheck-list",limitData:300,hasSelectAll:!0,onAfterItemCreate:null})},_initStoreValue:function(){var e=this,t=this.options;this.value=[],this.text=[],FX.Utils.forEach(t.items,function(i,a){a.selected&&(e.value.push(a[t.valueField]),e.text.push(a[t.textField]))})},_hasDefaultValue:function(){var e=this.options.value;return!FX.Utils.isNull(e)&&e.length>0},_onBeforeItemsLoaded:function(){if(this.options.hasSelectAll){var e={selectAll:!0};e[this.options.textField]="全选",this._onItemCreate(e)}},_onAfterItemsLoaded:function(){FX.ComboCheckBox.superclass._onAfterItemsLoaded.apply(this,arguments),this._setEditCompText()},_createItemList:function(e){FX.ComboCheckBox.superclass._createItemList.apply(this,arguments);var t=this.options;this._checkSelectAll(),t.hasSelectAll&&(FX.Utils.isEmpty(e)?this.$selectAllItem.find("span").text("全选"):this.$selectAllItem.find("span").text("搜索结果全选"))},_onItemCreate:function(t,i,a){var s=this.options,n=t[s.valueField],o=t[s.textField];if(!FX.Utils.isEmpty(a)&&!new RegExp(FX.Utils.escapeRegexp(a),"i").test(o+""))return!1;var l=e('<a class="x-dropdown-item x-check"/>').data("item",t).attr("option",n).attr("title",o).appendTo(this.$listView);e('<i class="icon-blank"/>').appendTo(l),e("<span/>").text(o).appendTo(l),this._getValueIndex(n)>-1&&l.addClass("select"),t.selectAll?(l.addClass("select-all field-meta"),this.$selectAllItem=l):this.valueMap[n]=o,FX.Utils.applyFunc(this,s.onAfterItemCreate,[t,i,l],!1)},_getValueIndex:function(e){var t=-1;return FX.Utils.forEach(this.value,function(i,a){if(a==e)return t=i,!1}),t},_onItemClick:function(t,i){var a=this,s=this.options,n=t.hasClass("select");if(i.selectAll){var o=e(".x-dropdown-item",this.triggerView);n?(FX.Utils.isEmpty(this.searchValue)?(this.value=[],this.text=[]):FX.Utils.forEach(o,function(t,i){var s=e(i).data("item");a._removeItem(s)}),o.removeClass("select")):(FX.Utils.forEach(o,function(t,i){var s=e(i).data("item");a._addItem(s)}),o.addClass("select"))}else n?(t.removeClass("select"),this._removeItem(t.data("item")),this.$selectAllItem&&this.$selectAllItem.removeClass("select")):(t.addClass("select"),this._addItem(t.data("item")),this._checkSelectAll());this._setEditCompText(),FX.Utils.applyFunc(this,s.onAfterItemSelect,[this.value,this.text],!1),FX.Utils.applyFunc(this,s.onAfterEdit,[this.value,this.text],!1),this.changed=!0},_addItem:function(e){var t=this.options;if(!e.selectAll){var i=e[t.valueField],a=e[t.textField];this._getValueIndex(i)>-1||(this.value.push(i),this.text.push(a))}},_removeItem:function(e){var t=this.options;if(!e.selectAll){var i=this._getValueIndex(e[t.valueField]);i<0||(this.value.splice(i,1),this.text.splice(i,1))}},_checkSelectAll:function(){this.$listView&&this.$selectAllItem&&(this.$selectAllItem.hasClass("select")?this.$listView.children().not(".select").length>=1&&this.$selectAllItem.removeClass("select"):this.$listView.children().not(".select").length<=1&&this.$selectAllItem.addClass("select"))},_setEditCompText:function(){this.editComp&&this.editComp.val(this.text.join(","))},effectItemLinkWidgets:function(){},checkValidate:function(){return!(!this.options.allowBlank&&0===this.value.length)},setValue:function(t){var i=this,a=(this.options,e.makeArray(t));this.text=[],this.value=a,this.valueMap?(e(".select",i.triggerView).removeClass("select"),FX.Utils.forEach(a,function(t,a){var s=i.valueMap[a];FX.Utils.isNull(s)?i.text.push(a):i.text.push(s),i.triggerView&&e("a.x-dropdown-item",i.$listView).each(function(t,i){e(i).attr("option")==a&&e(i).addClass("select")})})):this.text=a.slice(0),this._setEditCompText()},setText:function(t){this.text=e.makeArray(t),this._setEditCompText()},getValue:function(){return this.value},getLinkValue:function(){return this.getValue()},getNullValue:function(){return[]},getText:function(){return this.text}}),e.shortcut("combocheck",FX.ComboCheckBox)}(jQuery),function(e){FX.XComboCheckBox=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.XComboCheckBox.superclass._defaultConfig.apply(),{baseCls:"fui_xcombocheck",waterMark:null,hasSelectAll:!0,hasSelectEmpty:!0,emptySelectText:"未填写",textField:"text",valueField:"value",async:null,asyncResultKey:"items",searchable:!0,onStopEdit:null,height:30,width:240,edge:{width:240,height:200},limit:100,hasLimit:!1,searchKey:"keyword",hasScrollLoad:!1})},_init:function(){FX.XComboCheckBox.superclass._init.apply(this,arguments);var t=this.options;this.values=[],this.texts=[],this.valueMap={},t.hasSelectEmpty&&(this.valueMap[FX.CONST.PARAMETER.EMPTY]=t.emptySelectText),this.editComp=e('<input class="fui_trigger-input" />').attr("readonly","readonly").attr("placeholder",t.waterMark).appendTo(this.element),e('<i class="fui_trigger-btn icon-caret-down" />').appendTo(this.element),this._bindEvents()},_bindEvents:function(){var t=this;this.element.unbind("click.trigger"),this.element.bind("click.trigger",function(i){var a=e(i.target);(a.closest(".fui_trigger-input").length>0||a.closest(".fui_trigger-btn").length>0)&&t._onTriggerClick()})},_onTriggerClick:function(){var t=this;this._showTriggerView(),e(document).bind("mousedown.trigger",function(i){var a=i.target;0===e(a).closest(t.$triggerView).length&&t._hideTriggerView()})},_showTriggerView:function(){var e=this.options;this.$triggerView?e.hasLimit&&!FX.Utils.isObjectEmpty(this.values)&&(this._clearItems(),this._createItems(this.items)):this._createTriggerView(),this.$triggerView.appendTo("body").css(this._calTriggerViewPos()).show()},_hideTriggerView:function(){var t=this.options;this.$triggerView&&(e(document).unbind("mousedown.trigger"),this.$triggerView.detach(),FX.Utils.applyFunc(this,t.onStopEdit,[],!1))},_calTriggerViewPos:function(){var e={"z-Index":FX.STATIC.zIndex++},t=this.element.offset(),i=this.options.edge,a=document.body.clientWidth-t.left;return a<i.width?(e.right=a-this.element.outerWidth(),e.left="auto"):(e.right="auto",e.left=t.left),document.body.clientHeight+document.body.scrollTop-t.top-this.element.outerHeight()<i.height?(e.top="auto",e.bottom=document.body.clientHeight-t.top):(e.top=t.top+this.element.outerHeight(),e.bottom="auto"),e},_createTriggerView:function(){var t=this,i=this.options;if(this.$triggerView=e('<div class="x-dropdown" />'),i.searchable){var a=e('<div class="fui_combo-search"/>').appendTo(this.$triggerView);e("<input />").bind("input propertychange",function(){t.searchValue!==this.value&&t._doSearch(this.value)}).appendTo(a),a.append(e('<i class="icon-search search-icon"/>'))}this.$listView=e('<div class="x-dropdown-list combocheck-list"/>').appendTo(this.$triggerView),this.$listView.on("click",".x-dropdown-item",function(i){t._onItemClick(e(i.currentTarget))}),this.itemsMap={},this._loadItems()},_loadItems:function(t){var i=this,a=this.options;if(t=t||0,this.items=this.items||[],a.async&&a.async.url){this.ajaxObj&&this.ajaxObj.abort&&this.ajaxObj.abort();var s=e('<div class="loading-text" />').append(e("<span />").text("加载中...")).appendTo(i.$listView),n={hasLimit:a.hasLimit,skip:t,limit:a.limit};FX.Utils.isEmpty(this.searchValue)||(n[a.searchKey]=this.searchValue,n.hasCurrentUser=!1),this.ajaxObj=FX.Utils.dataAjax({url:a.async.url,data:e.extend({},a.async.data,n)},function(e){var s=e[a.asyncResultKey];i.items=i.items.concat(s),i._createItems(s),a.hasScrollLoad&&s.length>=a.limit&&i._bindLoadMore(t+a.limit)},null,function(){s.remove(),i.ajaxObj=null})}else a.items&&(this.items=a.items,i._createItems(this.items))},_createItems:function(t){var i=this,a=this.options,s=[],n=[];this._beforeCreateItems(),FX.Utils.forEach(t,function(e,t){var o={};o[a.textField]=t[a.textField]||t,o[a.valueField]=t[a.valueField]||t;var l=i._createItem(o);l.hasClass("select")?s.push(l):n.push(l)}),FX.Utils.isEmpty(this.searchValue)&&FX.Utils.forEach(this.values,function(e,t){if(!i.itemsMap[t]){var n={};n[a.valueField]=t,n[a.textField]=i.valueMap[t]||t,s.push(i._createItem(n))}}),FX.Utils.forEach(s,function(e,t){i.$listView.append(t)}),FX.Utils.forEach(n,function(e,t){i.$listView.append(t)}),this.$selectAllItem=e(".select-all",this.$listView),FX.Utils.isEmpty(this.searchValue)||(this.$selectAllItem.find("span").text("搜索结果全选"),this.$listView.children("a.select-empty").addClass("hide")),i._checkSelectAll()},_clearItems:function(){this.$listView.empty(),this.$selectAllItem=null,this.itemsMap={}},_bindLoadMore:function(e){var t=this,i=this.options,a=0;i.hasSelectAll&&(a+=26),i.hasSelectEmpty&&(a+=26),this.$listView.on("scroll.loadMore",function(){t.$listView.scrollTop()+t.$listView.height()>=26*e+a&&(t.$listView.unbind("scroll.loadMore"),t._loadItems(e))})},_doSearch:function(e){var t=this,i=this.options;t.searchValue=e,t.$listView.children().addClass("hide");var a=t._createLoadingIcon("搜索中...");t.searchinterval&&clearTimeout(t.searchinterval),i.async&&i.hasLimit?t.searchinterval=setTimeout(function(){a.remove(),t.items=null,t._clearItems(),t._loadItems()},600):(t.searchinterval=setTimeout(function(){a.remove(),t.$listView.children().removeClass("hide"),FX.Utils.isEmpty(t.searchValue)||t._hideItems(t.searchValue)},500),FX.Utils.isEmpty(e)?this.$selectAllItem.find("span").text("全选"):(this.$selectAllItem.find("span").text("搜索结果全选"),this.$listView.children("a.select-empty").addClass("hide")))},_createLoadingIcon:function(t){var i=this.$listView.children(".loading-text");return 0===i.length&&(i=e('<div class="loading-text"/>').appendTo(this.$listView),e("<span/>").text(t).appendTo(i)),i},_createItem:function(t){var i=this.options,a=t[i.valueField],s=t[i.textField];FX.Utils.isNull(a)||(this.valueMap[a]=s),this.itemsMap[a]=!0;var n=e('<a class="x-dropdown-item x-check"/>').attr("option",a).attr("title",s).append(e('<i class="icon-blank"/>')).append(e("<span />").text(s));return this.values.indexOf(a)>-1&&n.addClass("select"),t.selectAll?n.addClass("select-all field-meta"):t.selectEmpty&&n.addClass("select-empty field-meta"),n},_beforeCreateItems:function(){var e=this.options;if(!this.$selectAllItem){if(e.hasSelectAll){var t={selectAll:!0};t[e.textField]="全选",this.$listView.append(this._createItem(t))}if(e.hasSelectEmpty){var i={selectEmpty:!0};i[e.valueField]=FX.CONST.PARAMETER.EMPTY,i[e.textField]=this.valueMap[FX.CONST.PARAMETER.EMPTY],this.$listView.append(this._createItem(i))}}},_hideItems:function(t){var i=this.$listView.children("a").not(".select-all").not(".select-empty");FX.Utils.forEach(i,function(i,a){var s=e(a);new RegExp(FX.Utils.escapeRegexp(t),"i").test(s.text())||s.addClass("hide")})},_onItemClick:function(t){var i=this,a=t.hasClass("select");if(t.hasClass("select-all")){var s=this.$listView.children("a").not(".hide").not(".select-all");a?(t.removeClass("select"),FX.Utils.isEmpty(this.searchValue)&&(this.values=[])):t.addClass("select"),FX.Utils.forEach(s,function(t,s){i._handleItemClick(e(s),a)})}else this._handleItemClick(t,a);this._refreshData()},_refreshData:function(){var e=this;this.valueMap&&(e.texts=[],FX.Utils.forEach(this.values,function(t,i){var a=e.valueMap[i];a&&e.texts.push(a)})),this.editComp.val(this.texts.join(","))},_handleItemClick:function(e,t){this.options;var i=e.attr("option");if(t){e.removeClass("select");var a=this.values.indexOf(i);a>-1&&this.values.splice(a,1),this.$selectAllItem&&this.$selectAllItem.removeClass("select")}else e.addClass("select"),this.values.indexOf(i)<0&&this.values.push(i),this._checkSelectAll()},_checkSelectAll:function(){var e=this.$listView.children("a").not(".hide").not(".select-all"),t=this.$listView.children("a.select").not(".hide").not(".select-all");e.length===t.length&&this.$selectAllItem&&this.$selectAllItem.addClass("select")},doResize:function(){FX.XComboCheckBox.superclass.doResize.apply(this,arguments);var e=this.options.height;this.element.css({"line-height":e-2+"px"})},setValue:function(e){var t=this;e||(e=[]);var i=[];FX.Utils.isArray(e)?i=e:(i=i.concat(e.items||[]),e.hasEmpty&&i.indexOf(FX.CONST.PARAMETER.EMPTY)<0&&i.unshift(FX.CONST.PARAMETER.EMPTY)),t.values=[],t.texts=[],FX.Utils.forEach(i,function(e,i){var a=t.valueMap[i];FX.Utils.isNull(a)?t.texts.push(i):t.texts.push(a),t.values.push(i)}),this.editComp.val(this.texts.join(","))},getValue:function(){if(FX.Utils.isObjectEmpty(this.values))return{};var e=[].concat(this.values),t=!1,i=e.indexOf(FX.CONST.PARAMETER.EMPTY);return i>-1&&(t=!0,e.splice(i,1)),{hasEmpty:t,items:e}}}),e.shortcut("xcombocheck",FX.XComboCheckBox)}(jQuery),function(e){FX.XComboBox=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.XComboBox.superclass._defaultConfig.apply(),{baseCls:"fui_combo",waterMark:null,textField:"text",valueField:"value",async:null,asyncResultKey:"items",allowBlank:!0,searchable:!0,onStopEdit:null,height:30,width:240,edge:{width:240,height:200},limit:100,hasLimit:!1,searchKey:"keyword",hasScrollLoad:!1,onAsyncSuccess:null})},_init:function(){FX.XComboBox.superclass._init.apply(this,arguments);var t=this.options;this.valueMap={},this.editComp=e('<input class="fui_trigger-input" />').attr("readonly","readonly").attr("placeholder",t.waterMark).appendTo(this.element),e('<i class="fui_trigger-btn icon-caret-down" />').appendTo(this.element),this._bindEvents()},_bindEvents:function(){var t=this;this.element.unbind("click.trigger"),this.element.bind("click.trigger",function(i){var a=e(i.target);(a.closest(".fui_trigger-input").length>0||a.closest(".fui_trigger-btn").length>0)&&t._onTriggerClick()})},_onTriggerClick:function(){var t=this;this._showTriggerView(),e(document).bind("mousedown.trigger",function(i){var a=i.target;0===e(a).closest(t.$triggerView).length&&t._hideTriggerView()})},_showTriggerView:function(){var e=this.options;this.$triggerView?e.hasLimit&&this.value&&(this._clearItems(),this._createItems(this.items)):this._createTriggerView(),this.$triggerView.appendTo("body").css(this._calTriggerViewPos()).show()},_hideTriggerView:function(){var t=this.options;this.$triggerView&&(e(document).unbind("mousedown.trigger"),this.$triggerView.detach(),FX.Utils.applyFunc(this,t.onStopEdit,[],!1))},_calTriggerViewPos:function(){var e={"z-Index":FX.STATIC.zIndex++},t=this.element.offset(),i=this.options.edge,a=document.body.clientWidth-t.left;return a<i.width?(e.right=a-this.element.outerWidth(),e.left="auto"):(e.right="auto",e.left=t.left),document.body.clientHeight+document.body.scrollTop-t.top-this.element.outerHeight()<i.height?(e.top="auto",e.bottom=document.body.clientHeight-t.top):(e.top=t.top+this.element.outerHeight(),e.bottom="auto"),e},_createTriggerView:function(){var t=this,i=this.options;if(this.$triggerView=e('<div class="x-dropdown" />'),i.searchable){var a=e('<div class="fui_combo-search"/>').appendTo(this.$triggerView);e("<input />").bind("input propertychange",function(){t.searchValue!==this.value&&t._doSearch(this.value)}).appendTo(a),a.append(e('<i class="icon-search search-icon"/>'))}this.$listView=e('<div class="x-dropdown-list combo-list"/>').appendTo(this.$triggerView),this.$listView.on("click",".x-dropdown-item",function(i){t._onItemClick(e(i.currentTarget))}),this.itemsMap={},this._loadItems()},_loadItems:function(t){var i=this,a=this.options;if(t=t||0,this.items=this.items||[],a.async&&a.async.url){this.ajaxObj&&this.ajaxObj.abort&&this.ajaxObj.abort();var s=e('<div class="loading-text" />').append(e("<span />").text("加载中...")).appendTo(i.$listView),n={hasLimit:a.hasLimit,skip:t,limit:a.limit};FX.Utils.isEmpty(this.searchValue)||(n[a.searchKey]=this.searchValue,n.hasCurrentUser=!1),this.ajaxObj=FX.Utils.dataAjax({url:a.async.url,data:e.extend({},a.async.data,n)},function(e){var s=FX.Utils.applyFunc(i,a.onAsyncSuccess,[e],!1);!1===s&&(s=e[a.asyncResultKey]),i.items=i.items.concat(s),i._createItems(s),a.hasScrollLoad&&s.length>=a.limit&&i._bindLoadMore(t+a.limit)},null,function(){s.remove(),i.ajaxObj=null})}else a.items&&(this.items=a.items,i._createItems(this.items))},_createItems:function(e){var t=this,i=this.options;this._onBeforeItemsLoaded();var a=[],s=[];if(FX.Utils.forEach(e,function(e,n){var o={};o[i.textField]=n[i.textField]||n,o[i.valueField]=n[i.valueField]||n;var l=t._createItem(o);l.hasClass("select")?a.push(l):s.push(l)}),FX.Utils.isEmpty(this.searchValue)&&this.value&&!this.itemsMap[this.value]){var n={};n[i.valueField]=this.value,n[i.textField]=t.valueMap[this.value]||this.value,a.push(t._createItem(n))}FX.Utils.forEach(a,function(e,i){t.$listView.append(i)}),FX.Utils.forEach(s,function(e,i){t.$listView.append(i)})},_onBeforeItemsLoaded:function(){var t=this;this.options.allowBlank&&!this.$selectEmpty&&(this.$selectEmpty=e('<a class="x-dropdown-item"/>').text("--请选择--").appendTo(t.$listView))},_clearItems:function(){this.$listView.empty(),this.$selectEmpty=null,this.itemsMap={}},_bindLoadMore:function(e){var t=this;this.$listView.on("scroll.loadMore",function(){t.$listView.scrollTop()+t.$listView.height()>=26*e+0&&(t.$listView.unbind("scroll.loadMore"),t._loadItems(e))})},_doSearch:function(e){var t=this,i=this.options;t.searchValue=e,t.$listView.children().addClass("hide");var a=t._createLoadingIcon("搜索中...");t.searchinterval&&clearTimeout(t.searchinterval),i.async&&i.hasLimit?t.searchinterval=setTimeout(function(){a.remove(),t.items=null,t._clearItems(),t._loadItems()},600):t.searchinterval=setTimeout(function(){a.remove(),t.$listView.children().removeClass("hide"),FX.Utils.isEmpty(t.searchValue)||t._hideItems(t.searchValue)},500)},_createLoadingIcon:function(t){var i=this.$listView.children(".loading-text");return 0===i.length&&(i=e('<div class="loading-text"/>').appendTo(this.$listView),e("<span/>").text(t).appendTo(i)),i},_createItem:function(t){var i=this.options,a=t[i.valueField],s=t[i.textField];FX.Utils.isNull(a)||(this.valueMap[a]=s),this.itemsMap[a]=!0;var n=e('<a class="x-dropdown-item"/>').attr("option",a).attr("title",s).append(e("<span />").text(s));return this.value===a&&n.addClass("select"),n},_hideItems:function(t){var i=this.$listView.children("a");FX.Utils.forEach(i,function(i,a){var s=e(a);new RegExp(FX.Utils.escapeRegexp(t),"i").test(s.text())||s.addClass("hide")})},_onItemClick:function(t){this.value=t.attr("option"),e(".select",this.$listView).removeClass("select"),t.addClass("select"),this._hideTriggerView(),this._refreshData()},_refreshData:function(){var e=this;this.valueMap&&(e.text=this.valueMap[this.value]),this.editComp.val(this.text)},doResize:function(){FX.XComboBox.superclass.doResize.apply(this,arguments);var e=this.options.height;this.element.css({"line-height":e-2+"px"})},setValue:function(e){this.value=e,this.valueMap&&this.valueMap[e]?this.text=this.valueMap[e]:this.text=e,this.editComp&&this.editComp.val(this.text)},getValue:function(){return this.value}}),e.shortcut("xcombobox",FX.XComboBox)}(jQuery),function(e){FX.UserComboBox=FX.extend(FX.XComboBox,{_createItem:function(t){var i=this.options,a=t[i.valueField],s=t[i.textField];FX.Utils.isNull(a)||(this.valueMap[a]=s),this.itemsMap[a]=!0;var n=e('<a class="x-dropdown-item"/>').attr("option",a).attr("title",s).append(e("<span />").text(s));return this.value===a&&n.addClass("select"),a===FX.USER_ID.CurrentUser&&n.addClass("field-meta"),n},setValue:function(e){var t=this;this.value=e;var i=[];this.valueMap[e]||i.push(e),this.valueMap[FX.USER_ID.CurrentUser]="当前用户",FX.Utils.isObjectEmpty(i)||FX.Utils.ajax({url:FX.Utils.getApi(FX.API.corp.list_member_name),data:{isUserOnly:!0,members:i}},function(i){FX.Utils.forEach(i.users,function(e,i){t.valueMap[i._id]=i.nickname}),t.text=t.valueMap[e],t.editComp.val(t.text)})}}),e.shortcut("usercombobox",FX.UserComboBox)}(jQuery),function(e){FX.DeptCheckList=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.DeptCheckList.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_dept_checklist",allowBlank:!1,dynamicType:"select",hasSelectAll:!0,hasSelectCurrent:!0,hasSelectEmpty:!0,multiSelect:!0,searchable:!0,textField:"name",valueField:"_id",onMultiSelect:null,onStopEdit:null,departmentsUrl:FX.Utils.getApi(FX.API.data.departments),currentDepartmentsUrl:FX.Utils.getApi(FX.API.data.current_departments)})},_init:function(){FX.DeptCheckList.superclass._init.apply(this,arguments),this._initData()},_initData:function(){var e=this.options;this.valArray=[],this.texts=[],this.valueMap={},e.hasSelectEmpty&&(this.valueMap[FX.CONST.PARAMETER.EMPTY]="未填写"),this._createListView(),FX.Utils.isObjectEmpty(this.value)&&(this.value={items:[]}),FX.Utils.isObjectEmpty(this.value.items)&&(this.items=[])},_createListView:function(){var t=this;if(this.options.searchable){var i=e('<div class="fui_combo-search"/>').appendTo(this.element);e('<input placeholder="搜索"/>').bind("input propertychange",function(){t.searchValue!==this.value&&t._doSearch(this.value)}).appendTo(i),i.append(e('<i class="icon-search search-icon"/>'))}this.$listView=e('<div class="x-dropdown-list combocheck-list"/>').appendTo(this.element),this.$listView.on("click",".x-dropdown-item",function(i){t._onItemClick(e(i.currentTarget))}),this.itemsMap={},this._loadItems()},_loadItems:function(){var t=this,i=this.options;this.items=this.items||[],FX.Utils.dataAjax({url:i.departmentsUrl},function(a){t.departments=e.extend(!0,[],a.departments),t.departments[0]&&!t.departments[0]._id&&t.departments.shift(),FX.Utils.forEach(t.departments,function(e,a){var s=a[i.valueField],n=a[i.textField];FX.Utils.isNull(s)||(t.valueMap[s]=n)}),t.items=t.items.concat(t.departments||[]),t._createItems(t.items),t._createDepartmentList()})},_createDepartmentList:function(){var t=this,i=this.options;this.departmentTree=new FX.Tree({renderEl:e("<div/>").appendTo(this.element),customCls:"x-department-tree select-department dept-checkbox",Nodes:e.extend(!0,[],this.departments),setting:{view:{expandSpeed:100},data:{simpleData:{enable:!0,idKey:"departmentId",pIdKey:"parentId"}},callback:{onCheck:function(e,i){t._doSelectItem(i)},onClick:function(e,i){this.checkNode(i,!i.checked),t._doSelectItem(i)},beforeNodeCreate:function(e){t._checkLimit(e)||(e.nocheck=!0),e.checked=t._checkSelectState(e)},onNodeCreated:function(e,i){i.isParent&&!i.open&&i.level<1&&this.expandNode(i,!0),i.departmentId==t.currentDepartment&&this.selectNode(i)}},check:{enable:i.multiSelect,chkboxType:{Y:"",N:""}}}}),i.multiSelect&&this.departmentTree.element.addClass("multiSelect")},_createItems:function(t){var i=this,a=this.options,s=[],n=[];this._beforeCreateItems(),FX.Utils.forEach(t,function(e,t){var o={};o[a.textField]=t[a.textField]||t,o[a.valueField]=t[a.valueField]||t;var l=i._createItem(o);l.hasClass("select")?s.push(l):n.push(l)}),FX.Utils.isEmpty(this.searchValue)&&FX.Utils.forEach(this.valArray,function(e,t){if(!i.itemsMap[t]){var n={};n[a.valueField]=t,n[a.textField]=i.valueMap[t]||t,s.push(i._createItem(n))}}),FX.Utils.forEach(s,function(e,t){i.$listView.append(t.addClass("x-ui-hidden"))}),FX.Utils.forEach(n,function(e,t){i.$listView.append(t.addClass("x-ui-hidden"))}),this.$selectAllItem=e(".select-all",this.$listView),i._checkSelectAll()},_doSearch:function(e){var t=this;this.options;t.searchValue=e,t.$listView.children().addClass("x-ui-hidden");var i=t._createLoadingIcon("搜索中...");t.searchinterval&&clearTimeout(t.searchinterval),FX.Utils.isEmpty(e)?t.searchinterval=setTimeout(function(){i.remove(),t.inSearch=!1,t.departmentTree&&t.departmentTree.setVisible(!0),t.$selectAllItem.find("span").text("全选"),t.$listView.children("a.select-empty, a.select-all, a.curDept, a.placeholder").removeClass("x-ui-hidden"),t._checkSelectAll()},500):t.searchinterval=setTimeout(function(){i.remove(),t.inSearch=!0,t.departmentTree&&t.departmentTree.setVisible(!1),t.$selectAllItem.find("span").text("搜索结果全选"),t.$listView.children("a.select-all").removeClass("x-ui-hidden"),t._showItems(e),t._checkSelectAll()},500)},_createLoadingIcon:function(t){var i=this.$listView.children(".loading-text");return 0===i.length&&(i=e('<div class="loading-text"/>').appendTo(this.$listView),e("<span/>").text(t).appendTo(i)),i},_createItem:function(t){var i=this.options,a=t[i.valueField],s=t[i.textField];FX.Utils.isNull(a)||(this.valueMap[a]=s),this.itemsMap[a]=!0;var n=e('<a class="x-dropdown-item x-check"/>').attr("option",a).attr("title",s).append(i.multiSelect?'<i class="icon-blank"/>':"").append(e("<span />").text(s));return this.valArray.indexOf(a)>-1&&n.addClass("select"),t.selectAll?n.addClass("select-all field-meta"):t.selectEmpty?n.addClass("select-empty field-meta"):t.curDept&&n.addClass("curDept field-meta"),n},_beforeCreateItems:function(){var t=this,i=this.options;if(!this.$selectAllItem){if(i.allowBlank&&e('<a class="x-dropdown-item x-check placeholder field-meta"><span>--请选择--</span></a>').appendTo(t.$listView),i.hasSelectAll){var a={selectAll:!0};a[i.textField]="全选",this.$listView.append(this._createItem(a))}if("set"===i.dynamicType&&i.hasSelectCurrent){var s={_id:FX.CONST.DEPT_ID.CURRENT,name:"当前用户所处部门",curDept:!0};this.$listView.append(this._createItem(s))}if(i.hasSelectEmpty){var n={selectEmpty:!0};n[i.valueField]=FX.CONST.PARAMETER.EMPTY,n[i.textField]=this.valueMap[FX.CONST.PARAMETER.EMPTY],this.$listView.append(this._createItem(n))}}},_showItems:function(t){var i=this.$listView.children("a").not(".select-all, .curDept, .select-empty, .placeholder");FX.Utils.forEach(i,function(i,a){var s=e(a);new RegExp(FX.Utils.escapeRegexp(t),"i").test(s.text())&&s.removeClass("x-ui-hidden")})},_onItemClick:function(t){var i,a=this,s=t.hasClass("select");t.hasClass("select-all")?a.inSearch?(i=this.$listView.children("a").not(".x-ui-hidden").not(".select-all"),s?t.removeClass("select"):t.addClass("select"),FX.Utils.forEach(i,function(t,i){a._handleItemClick(e(i),s)})):(i=this.$listView.children("a").not(".select-all"),s?(t.removeClass("select"),this.selectAll=!1,FX.Utils.isEmpty(this.searchValue)&&(this.valArray=[])):(t.addClass("select"),FX.Utils.isEmpty(this.searchValue)&&(this.selectAll=!0)),FX.Utils.forEach(i,function(t,i){a._handleItemClick(e(i),s)}),this.departmentTree&&this.departmentTree.checkAllNodes(!s)):this._handleItemClick(t,s),this._refreshData()},_refreshData:function(){var e=this,t=this.options;this.inSearch&&this.departmentTree&&this.departmentTree.refresh(),this.valueMap&&(e.texts=[],FX.Utils.forEach(this.valArray,function(t,i){var a=e.valueMap[i];a&&e.texts.push(a)})),FX.Utils.applyFunc(this,t.onStopEdit,[this.texts.join(",")],!1)},_handleItemClick:function(e,t){var i=this.options,a=e.attr("option");if(t){if(!i.multiSelect)return void FX.Utils.applyFunc(this,i.onMultiSelect,[],!1);e.removeClass("select");var s=this.valArray.indexOf(a);s>-1&&this.valArray.splice(s,1),this.$selectAllItem&&this.$selectAllItem.removeClass("select"),this.selectAll=!1}else this.valArray.indexOf(a)<0&&(i.multiSelect||(this.$listView.children("a").removeClass("select"),this.valArray=[]),FX.Utils.isNull(a)||this.valArray.push(a)),e.addClass("select"),this._checkSelectAll();i.multiSelect||FX.Utils.applyFunc(this,i.onMultiSelect,[],!1)},_checkSelectAll:function(){var e,t;this.inSearch?(e=this.$listView.children("a").not(".x-ui-hidden").not(".select-all"),t=this.$listView.children("a.select").not(".x-ui-hidden").not(".select-all")):(e=this.$listView.children("a").not(".select-all"),t=this.$listView.children("a.select").not(".select-all")),e.length===t.length?(this.$selectAllItem&&this.$selectAllItem.addClass("select"),FX.Utils.isEmpty(this.searchValue)&&(this.selectAll=!0)):(this.$selectAllItem&&this.$selectAllItem.removeClass("select"),this.selectAll=!1)},_checkLimit:function(){return!0},_checkSelectState:function(e){this.options;switch(e._id){case FX.CONST.PARAMETER.EMPTY:return this.value.hasEmpty;case FX.CONST.DEPT_ID.CURRENT:return this.value.hasCurrentDept;default:return this.valArray.indexOf(e._id)>-1}},_doSelectItem:function(t){var i=this;this.options;if(this._checkLimit(t)){var a={name:t.name,_id:t._id},s=e("[option="+t._id+"]");this.valArray.indexOf(a._id)>-1?i._handleItemClick(s,!0):i._handleItemClick(s,!1),this._refreshData(),this._checkSelectAll()}},setCurDept:function(){var e=this,t=this.options;if(this.value.hasEmpty&&this.valArray.indexOf(FX.CONST.PARAMETER.EMPTY)<0&&(this.valArray.unshift(FX.CONST.PARAMETER.EMPTY),t.hasSelectEmpty&&(this.valueMap[FX.CONST.PARAMETER.EMPTY]="未填写")),this.value.hasCurrentDept)if("set"===t.dynamicType&&t.hasSelectCurrent&&this.valArray.indexOf(FX.CONST.DEPT_ID.CURRENT)<0)this.valArray.unshift(FX.CONST.DEPT_ID.CURRENT),this.valueMap[FX.CONST.DEPT_ID.CURRENT]="当前用户所处部门",this._updateDept();else{var i=FX.Utils.createMask(this.element,{isLight:!0,hasLoader:!0});FX.Utils.dataAjax({url:t.currentDepartmentsUrl},function(t){i.remove();var a=[];FX.Utils.forEach(t.departmentList,function(t,i){a.push(i._id),e.valueMap[i._id]=i.name}),e.valArray=a.concat(e.valArray).unique(),e._updateDept()})}else this._updateDept()},_updateDept:function(){this._updateText(),this._updateCheckList()},_updateText:function(){var e=this,t=this.options;this.texts=[],FX.Utils.forEach(this.valArray,function(t,i){var a=e.valueMap[i];FX.Utils.isNull(a)||e.texts.push(a)}),FX.Utils.applyFunc(this,t.onStopEdit,[this.texts.join(",")],!1)},_updateCheckList:function(){var t=this;this.departmentTree&&this.departmentTree.refresh();var i=this.$listView.children("a").not(".select-all");FX.Utils.forEach(i,function(i,a){var s=e(a);s.removeClass("select"),t.valArray.indexOf(s.attr("option"))>-1&&s.addClass("select")}),this._checkSelectAll()},setValue:function(e){var t=this;this.options;if(this.valArray=[],this.value=e,FX.Utils.isObjectEmpty(this.value)&&(this.value={items:[]}),FX.Utils.isObjectEmpty(this.value.items))this.setCurDept();else{var i=FX.Utils.createMask(this.element,{isLight:!0,hasLoader:!0});FX.Utils.ajax({url:FX.Utils.getApi(FX.API.corp.list_member_name),data:{isDepartmentOnly:!0,members:this.value.items}},function(e){i.remove();var a=[];FX.Utils.forEach(e.departments,function(e,i){a.push(i._id),t.valueMap[i._id]=i.name}),t.valArray=a.concat(t.valArray).unique(),t.setCurDept()})}},getValue:function(){if(FX.Utils.isObjectEmpty(this.valArray))return{};var e=[].concat(this.valArray),t=!1,i=!1,a=[];return FX.Utils.forEach(e,function(e,s){switch(s){case FX.CONST.PARAMETER.EMPTY:t=!0;break;case FX.CONST.DEPT_ID.CURRENT:i=!0;break;default:a.push(s)}}),{hasCurrentDept:i,hasEmpty:t,items:a}},rebuild:function(e){this.value=e,this._initData(),this._refreshData()}}),e.shortcut("deptchecklist",FX.DeptCheckList)}(jQuery),function(e){FX.DeptCheckBox=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.DeptCheckBox.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_dept_check",allowBlank:!1,dynamicType:"select",edge:{width:240,height:330},hasScrollLoad:!1,hasSelectAll:!0,hasSelectCurrent:!0,hasSelectEmpty:!0,height:30,width:240,multiSelect:!0,searchable:!0,textField:"name",valueField:"_id",departmentsUrl:FX.Utils.getApi(FX.API.data.departments),currentDepartmentsUrl:FX.Utils.getApi(FX.API.data.current_departments),waterMark:null,onStopEdit:null})},_init:function(){FX.DeptCheckBox.superclass._init.apply(this,arguments),this._initContent()},_initContent:function(){var t=this.options;this.editComp=e('<input class="fui_trigger-input" />').attr("readonly","readonly").attr("placeholder",t.waterMark).appendTo(this.element),e('<i class="fui_trigger-btn icon-caret-down" />').appendTo(this.element),this._createTriggerView(),this._bindEvents()},_bindEvents:function(){var t=this;this.element.unbind("click.trigger"),this.element.bind("click.trigger",function(i){var a=e(i.target);(a.closest(".fui_trigger-input").length>0||a.closest(".fui_trigger-btn").length>0)&&t._onTriggerClick()})},_onTriggerClick:function(){var t=this;this._showTriggerView(),e(document).bind("mousedown.dept-check",function(i){var a=i.target;0===e(a).closest(t.$triggerView).length&&t._hideTriggerView()})},_showTriggerView:function(){this.options;this.$triggerView||this._createTriggerView(),this.$triggerView.appendTo("body").css(this._calTriggerViewPos()).show()},_hideTriggerView:function(){var t=this.options;this.$triggerView&&(e(document).unbind("mousedown.dept-check"),this.$triggerView.detach(),FX.Utils.applyFunc(this,t.onStopEdit,[],!1))},_calTriggerViewPos:function(){var e={"z-Index":FX.STATIC.zIndex++},t=this.element.offset(),i=this.options.edge,a=document.body.clientWidth-t.left;return a<i.width?(e.right=a-this.element.outerWidth(),e.left="auto"):(e.right="auto",e.left=t.left),document.body.clientHeight+document.body.scrollTop-t.top-this.element.outerHeight()<i.height?(e.top="auto",e.bottom=document.body.clientHeight-t.top):(e.top=t.top+this.element.outerHeight(),e.bottom="auto"),e},_createTriggerView:function(){var t=this,i=this.options;this.$triggerView=e('<div class="x-dropdown dept-dropdown" />'),this.deptlist=new FX.DeptCheckList({renderEl:this.$triggerView,allowBlank:i.allowBlank,dynamicType:i.dynamicType,hasSelectAll:i.hasSelectAll,hasSelectCurrent:i.hasSelectCurrent,hasSelectEmpty:i.hasSelectEmpty,multiSelect:i.multiSelect,searchable:i.searchable,textField:i.textField,valueField:i.valueField,departmentsUrl:i.departmentsUrl,currentDepartmentsUrl:i.currentDepartmentsUrl,onStopEdit:function(e){t.editComp&&t.editComp.val(e)},onMultiSelect:function(){t._hideTriggerView()}})},doResize:function(){FX.DeptCheckBox.superclass.doResize.apply(this,arguments);var e=this.options.height;this.element.css({"line-height":e-2+"px"})},setValue:function(e){this.deptlist&&this.deptlist.setValue(e)},getValue:function(){return this.deptlist&&this.deptlist.getValue()},rebuild:function(e){this.deptlist&&this.deptlist.rebuild(e)}}),e.shortcut("deptcheck",FX.DeptCheckBox)}(jQuery),function(e){FX.UserCheckBox=FX.extend(FX.XComboCheckBox,{_createItem:function(t){var i=this.options,a=t[i.valueField],s=t[i.textField];FX.Utils.isNull(a)||(this.valueMap[a]=s),this.itemsMap[a]=!0;var n=e('<a class="x-dropdown-item x-check"/>').attr("option",a).attr("title",s).append(e('<i class="icon-blank"/>')).append(e("<span />").text(s));return this.values.indexOf(a)>-1&&n.addClass("select"),a===FX.USER_ID.CurrentUser&&n.addClass("field-meta"),t.selectAll?n.addClass("select-all field-meta"):t.selectEmpty&&n.addClass("select-empty field-meta"),n},setValue:function(e){var t=this;e||(e=[]);var i=[];FX.Utils.isArray(e)?i=e:(i=i.concat(e.items||[]),e.hasEmpty&&i.indexOf(FX.CONST.PARAMETER.EMPTY)<0&&i.unshift(FX.CONST.PARAMETER.EMPTY)),this.values=i,this.texts=[];var a=[];FX.Utils.forEach(this.values,function(e,i){t.valueMap[i]||a.push(i)}),this.valueMap[FX.USER_ID.CurrentUser]="当前用户",FX.Utils.isObjectEmpty(a)?this.values.indexOf(FX.CONST.PARAMETER.EMPTY)>-1&&(this.texts.push(this.valueMap[FX.CONST.PARAMETER.EMPTY]),this.editComp.val(t.texts.join(","))):FX.Utils.ajax({url:FX.Utils.getApi(FX.API.corp.list_member_name),data:{isUserOnly:!0,members:a}},function(e){FX.Utils.forEach(e.users,function(e,i){t.valueMap[i._id]=i.nickname}),t.texts=[],FX.Utils.forEach(t.values,function(e,i){t.texts.push(t.valueMap[i])}),t.editComp.val(t.texts.join(","))})}}),e.shortcut("usercheck",FX.UserCheckBox)}(jQuery),function(e){FX.ButtonGroup=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.ButtonGroup.superclass._defaultConfig.apply(),{baseCls:"x-group",btnCls:"btn_group",allowBlank:!0,layout:null,items:[{value:"选项1",text:"选项1"},{value:"选项2",text:"选项2"},{value:"选项3",text:"选项3"}]})},_init:function(){FX.ButtonGroup.superclass._init.apply(this,arguments);var e=this.options,t=this;this.$btns=[],this.$btnOther=null,e.items&&FX.Utils.forEach(e.items,function(e,i){t._createItem(i)}),this._bindEvt()},_createItem:function(t){var i=this.options,a=this._createItemDOM(t);return i.layout&&a.addClass(i.layout),e('<i class="icon-blank"/>').appendTo(a),t.selected&&a.addClass("select"),e("<span/>").text(t.text).appendTo(a),this.$btns.push(a),a},_createItemDOM:function(t){return e('<div class="group_item"/>').attr("value",t.value).data("item",t).addClass(this.options.btnCls).appendTo(this.element)},_bindEvt:function(){var t=this;this.element.unbind("click.group"),this.element.bind("click.group",function(i){if(t.isEnabled()){var a=i.target.tagName?i.target.tagName.toUpperCase():"";if("INPUT"!==a&&"TEXTAREA"!==a){var s=e(i.target).closest(".group_item");s&&s.length>0&&t._doItemClick(s)}}})},_doItemClick:function(e){},getOptions:function(){var t=this.options;return e.extend(FX.ButtonGroup.superclass.getOptions.apply(this,arguments),{items:t.items})}})}(jQuery),function(e){FX.RadioGroup=FX.extend(FX.ButtonGroup,{_defaultConfig:function(){return e.extend(FX.RadioGroup.superclass._defaultConfig.apply(),{btnCls:"x-radio",onAfterItemSelect:null,onItemCreate:null,otherInputWidth:180})},_doItemClick:function(t){var i=this.options,a=!0;if(t.hasClass("select")?(t.removeClass("select"),a=!1):(e(".select",this.element).removeClass("select"),t.addClass("select"),a=!0),t.hasClass("item-other")){var s=t.data("widget");s.setEnable(a),a&&s.select()}else this.$btnOther&&this.$btnOther.data("widget").setEnable(!1);var n=e(".select",this.element);FX.Utils.applyFunc(this,i.onAfterItemSelect,[n,n.data("item")],!1),FX.Utils.applyFunc(this,i.onStopEdit,[],!1)},_createItem:function(t){var i=FX.RadioGroup.superclass._createItem.apply(this,arguments),a=this.options,s=this;if(t.isOther){var n=FX.createWidget({renderEl:e('<div class="text-other"/>').appendTo(i),width:a.otherInputWidth,type:"text",enable:!!t.selected,onStopEdit:function(){FX.Utils.applyFunc(s,a.onStopEdit,[],!1)}});i.addClass("item-other"),this.$btnOther=i,i.data("widget",n)}FX.Utils.applyFunc(this,a.onItemCreate,[t,i],!1)},setEnable:function(e){if(FX.RadioGroup.superclass.setEnable.apply(this,[e]),this.$btnOther){var t=this.$btnOther.data("widget");this.$btnOther.hasClass("select")&&e?t.setEnable(!0):t.setEnable(!1)}},effectItemLinkWidgets:function(){var t=this.options,i=e(".select",this.element);FX.Utils.applyFunc(this,t.onAfterItemSelect,[i,i.data("item")],!1)},setValue:function(t){if(e(".select",this.element).removeClass("select"),FX.Utils.isEmpty(t))this.$btnOther&&this.$btnOther.removeClass("select");else{var i=!1;FX.Utils.forEach(this.$btns,function(e,a){var s=a.data("item");if(s.value===t&&!s.isOther)return a.addClass("select"),i=!0,!1}),!i&&this.$btnOther&&(this.$btnOther.addClass("select"),this.$btnOther.data("widget").setValue(t))}},checkValidate:function(){return!(!this.options.allowBlank&&FX.Utils.isEmpty(this.getValue()))},getValue:function(){var t=[],i=e(".select",this.element);return FX.Utils.forEach(i,function(i,a){var s=e(a).data("item");s.isOther?t.push(e(a).data("widget").getValue()):t.push(s.value)}),t.length>0?t.join(""):null},setText:function(t){var i=this;e(".select",this.element).removeClass("select"),FX.Utils.forEach(this.$btns,function(e,a){if(a.data("item").text===t)return a.addClass("select"),!1;i.$btnOther&&(i.$btnOther.addClass("select"),i.$btnOther.data("widget").setValue(t))})},getText:function(){var t=[],i=e(".select",this.element);return FX.Utils.forEach(i,function(i,a){var s=e(a).data("item");s.isOther?t.push(e(a).data("widget").getValue()):t.push(s.text)}),t.length>0?t.join(""):null}}),e.shortcut("radiogroup",FX.RadioGroup)}(jQuery),function(e){FX.CheckBoxGroup=FX.extend(FX.ButtonGroup,{_defaultConfig:function(){return e.extend(FX.CheckBoxGroup.superclass._defaultConfig.apply(),{btnCls:"x-check",onAfterItemSelect:null})},_createItemDOM:function(e){var t=FX.CheckBoxGroup.superclass._createItemDOM.apply(this,arguments),i=!1!==e.enable;return t.toggleClass("x-ui-disable",!i)},_doItemClick:function(e){FX.CheckBoxGroup.superclass._doItemClick.apply(this,arguments);var t=this.options,i=e.data("item");if(e.hasClass("x-ui-disable"))return!1;e.toggleClass("select");var a=e.hasClass("select");FX.Utils.applyFunc(this,t.onAfterItemSelect,[e,i,a],!1),FX.Utils.applyFunc(this,t.onStopEdit,[],!1)},checkValidate:function(){return!(!this.options.allowBlank&&0===e(".select",this.element).length)},setValue:function(t){e(".select",this.element).removeClass("select");var i=e.makeArray(t);FX.Utils.forEach(this.$btns,function(t,a){var s=e(a).data("item");i.indexOf(s.value)>-1&&e(a).addClass("select")})},getValue:function(){var t=[],i=e(".select",this.element);return FX.Utils.forEach(i,function(i,a){var s=e(a).data("item");t.push(s.value)}),t},setText:function(t){e(".select",this.element).removeClass("select");var i=e.makeArray(t);FX.Utils.forEach(this.$btns,function(t,a){var s=e(a).data("item");i.indexOf(s.text)>-1&&e(a).addClass("select")})},getText:function(){var t=[],i=e(".select",this.element);return FX.Utils.forEach(i,function(i,a){var s=e(a).data("item");t.push(s.text)}),t},getNullValue:function(){return[]}}),e.shortcut("checkboxgroup",FX.CheckBoxGroup)}(jQuery),function(e){FX.Address=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Address.superclass._defaultConfig.apply(),{baseCls:"fui_address",needDetail:!0,allowBlank:!0,width:420,width4province:"45%",width4city:"24%",width4district:"24%",width4detail:"100%"})},_init:function(){FX.Address.superclass._init.apply(this,arguments),FX.AddressData||(FX.AddressData={"北京市":{"北京市":["昌平区","朝阳区","大兴区","东城区","房山区","丰台区","海淀区","怀柔区","平谷区","顺义区","通州区","西城区","门头沟区","石景山区","密云区","延庆区"]},"天津市":{"天津市":["宝坻区","北辰区","东丽区","汉沽区","和平区","河北区","河东区","河西区","红桥区","津南区","南开区","塘沽区","武清区","西青区","蓟县","静海县","宁河县","滨海新区"]},"河北省":{"石家庄市":["藁城市","晋州市","鹿泉市","辛集市","新乐市","高新区","桥东区","桥西区","新华区","裕华区","长安区","赵县","高邑县","行唐县","井陉县","灵寿县","栾城县","平山县","深泽县","无极县","元氏县","赞皇县","正定县","井陉矿区","石家庄经济技术开发区"],"保定市":["安国市","定州市","涿州市","高碑店市","北市区","南市区","竞秀区","蠡县","唐县","雄县","易县","安新县","博野县","定兴县","阜平县","高阳县","涞水县","涞源县","满城县","清苑县","曲阳县","容城县","顺平县","望都县","徐水县"],"沧州市":["泊头市","河间市","黄骅市","任丘市","新华区","运河区","沧县","青县","献县","东光县","海兴县","南皮县","肃宁县","吴桥县","盐山县","孟村回族自治县"],"承德市":["双滦区","双桥区","大学城","承德县","隆化县","滦平县","平泉县","兴隆县","丰宁满族自治县","宽城满族自治县","围场满族蒙古族自治县","开发东区","开发西区","鹰手营子矿区","承德高教园区"],"邯郸市":["武安市","丛台区","复兴区","邯山区","磁县","邱县","涉县","魏县","成安县","大名县","肥乡县","馆陶县","广平县","邯郸县","鸡泽县","临漳县","曲周县","永年县","峰峰矿区","邯郸经济开发区","马头生态工业园"],"衡水市":["冀州市","深州市","桃城区","景县","安平县","阜城县","故城县","饶阳县","武强县","武邑县","枣强县","路北新区","衡水高新技术开发区"],"廊坊市":["霸州市","三河市","安次区","广阳区","大城县","固安县","文安县","香河县","永清县","大厂回族自治县"],"唐山市":["迁安市","遵化市","丰南区","丰润区","古冶区","开平区","路北区","路南区","曹妃甸区","滦县","乐亭县","滦南县","迁西县","玉田县","高新技术开发区"],"邢台市":["南宫市","沙河市","高开区","桥东区","桥西区","任县","威县","柏乡县","广宗县","巨鹿县","临城县","临西县","隆尧县","南和县","内丘县","宁晋县","平乡县","清河县","新河县","邢台县"],"秦皇岛市":["抚宁区","海港区","北戴河区","山海关区","昌黎县","卢龙县","青龙满族自治县"],"张家口市":["桥东区","桥西区","宣化区","下花园区","蔚县","赤城县","崇礼县","沽源县","怀安县","怀来县","康保县","尚义县","万全县","宣化县","阳原县","张北县","涿鹿县","察北管理区","塞北管理区","高新技术开发区"]},"山西省":{"太原市":["古交市","晋源区","小店区","迎泽区","尖草坪区","万柏林区","杏花岭区","娄烦县","清徐县","阳曲县"],"长治市":["潞城市","城区","郊区","沁县","壶关县","黎城县","沁源县","屯留县","武乡县","襄垣县","长治县","长子县","高新技术开发区"],"大同市":["城区","矿区","南郊区","新荣区","大同县","广灵县","浑源县","灵丘县","天镇县","阳高县","左云县"],"晋城市":["高平市","城区","陵川县","沁水县","阳城县","泽州县"],"晋中市":["介休市","榆次区","祁县","和顺县","灵石县","平遥县","寿阳县","太谷县","昔阳县","榆社县","左权县"],"临汾市":["侯马市","霍州市","尧都区","古县","吉县","蒲县","隰县","安泽县","大宁县","汾西县","浮山县","洪洞县","曲沃县","乡宁县","襄汾县","翼城县","永和县"],"吕梁市":["汾阳市","孝义市","离石区","岚县","临县","兴县","方山县","交城县","交口县","柳林县","石楼县","文水县","中阳县"],"朔州市":["平鲁区","朔城区","应县","怀仁县","山阴县","右玉县"],"忻州市":["原平市","忻府区","代县","保德县","定襄县","繁峙县","河曲县","静乐县","岢岚县","宁武县","偏关县","神池县","五台县","五寨县"],"阳泉市":["城区","郊区","矿区","盂县","平定县"],"运城市":["河津市","永济市","盐湖区","绛县","夏县","稷山县","临猗县","平陆县","芮城县","万荣县","闻喜县","新绛县","垣曲县","空港新区","禹都经济技术开发区"]},"内蒙古自治区":{"呼和浩特市":["回民区","赛罕区","新城区","玉泉区","武川县","清水河县","托克托县","和林格尔县","土默特左旗"],"包头市":["东河区","九原区","青山区","石拐区","昆都仑区","白云鄂博矿区","固阳县","土默特右旗","达尔罕茂明安联合旗"],"赤峰市":["红山区","松山区","元宝山区","林西县","宁城县","敖汉旗","巴林右旗","巴林左旗","喀喇沁旗","翁牛特旗","克什克腾旗","阿鲁科尔沁旗"],"通辽市":["霍林郭勒市","科尔沁区","开鲁县","库伦旗","奈曼旗","扎鲁特旗","科尔沁左翼中旗","科尔沁左翼后旗"],"乌海市":["海南区","乌达区","海勃湾区"],"巴彦淖尔市":["临河区","磴口县","五原县","杭锦后旗","乌拉特后旗","乌拉特前旗","乌拉特中旗"],"鄂尔多斯市":["东胜区","杭锦旗","乌审旗","达拉特旗","鄂托克旗","准格尔旗","鄂托克前旗","伊金霍洛旗"],"呼伦贝尔市":["根河市","满洲里市","牙克石市","扎兰屯市","额尔古纳市","海拉尔区","阿荣旗","陈巴尔虎旗","鄂伦春自治旗","新巴尔虎右旗","新巴尔虎左旗","鄂温克族自治旗","莫力达瓦达斡尔族自治旗"],"乌兰察布市":["丰镇市","集宁区","化德县","凉城县","商都县","兴和县","卓资县","四子王旗","察哈尔右翼后旗","察哈尔右翼前旗","察哈尔右翼中旗"],"兴安盟":["阿尔山市","乌兰浩特市","突泉县","扎赉特旗","科尔沁右翼前旗","科尔沁右翼中旗"],"阿拉善盟":["额济纳旗","阿拉善右旗","阿拉善左旗"],"锡林郭勒盟":["二连浩特市","锡林浩特市","多伦县","镶黄旗","正蓝旗","阿巴嘎旗","太仆寺旗","正镶白旗","苏尼特右旗","苏尼特左旗","东乌珠穆沁旗","西乌珠穆沁旗"]},"辽宁省":{"沈阳市":["新民市","大东区","东陵区","和平区","皇姑区","沈河区","铁西区","于洪区","苏家屯区","法库县","康平县","辽中县","浑南新区","沈北新区"],"大连市":["庄河市","普兰店市","瓦房店市","长海县","金州区","西岗区","中山区","甘井子区","旅顺口区","沙河口区","高新园区"],"鞍山市":["海城市","立山区","千山区","铁东区","铁西区","台安县","岫岩满族自治县","鞍山经济开发区","鞍山经济开发区西区"],"本溪市":["明山区","南芬区","平山区","溪湖区","本溪满族自治县","桓仁满族自治县"],"朝阳市":["北票市","凌源市","龙城区","双塔区","朝阳县","建平县","喀喇沁左翼蒙古族自治县"],"丹东市":["东港市","凤城市","元宝区","振安区","振兴区","宽甸满族自治县"],"抚顺市":["东洲区","顺城区","望花区","新抚区","抚顺县","清原满族自治县","新宾满族自治县","高湾开发区"],"阜新市":["海州区","太平区","细河区","新邱区","清河门区","彰武县","阜新蒙古族自治县"],"锦州市":["北镇市","凌海市","古塔区","凌河区","太和区","义县","黑山县","经济技术开发区"],"辽阳市":["灯塔市","白塔区","宏伟区","文圣区","弓长岭区","太子河区","辽阳县"],"盘锦市":["双台子区","兴隆台区","大洼县","盘山县"],"铁岭市":["开原市","调兵山市","清河区","银州区","昌图县","铁岭县","西丰县","凡河新区"],"营口市":["盖州市","大石桥市","老边区","西市区","站前区","鲅鱼圈区"],"葫芦岛市":["兴城市","连山区","龙港区","南票区","建昌县","绥中县"]},"吉林省":{"长春市":["德惠市","九台市","榆树市","朝阳区","二道区","宽城区","绿园区","南关区","双阳区","农安县","高新技术产业开发区","经济技术产业开发区","长春汽车产业开发区","净月潭旅游经济开发区"],"白城市":["大安市","洮南市","洮北区","通榆县","镇赉县"],"白山市":["临江市","浑江区","江源区","抚松县","靖宇县","长白朝鲜族自治县"],"吉林市":["桦甸市","蛟河市","磐石市","舒兰市","昌邑区","船营区","丰满区","龙潭区","永吉县"],"辽源市":["龙山区","西安区","东丰县","东辽县"],"四平市":["双辽市","公主岭市","铁东区","铁西区","梨树县","伊通满族自治县"],"松原市":["扶余市","宁江区","乾安县","长岭县","前郭尔罗斯蒙古自治县"],"通化市":["集安市","梅河口市","东昌区","二道江区","辉南县","柳河县","通化县"],"延边朝鲜族自治州":["敦化市","和龙市","珲春市","龙井市","图们市","延吉市","安图县","汪清县"]},"黑龙江省":{"哈尔滨市":["尚志市","双城市","五常市","阿城区","道里区","道外区","呼兰区","南岗区","平房区","松北区","香坊区","宾县","巴彦县","方正县","木兰县","通河县","延寿县","依兰县"],"大庆市":["大同区","红岗区","龙凤区","让胡路区","萨尔图区","林甸县","肇源县","肇州县","杜尔伯特蒙古族自治县","乙烯地区"],"鹤岗市":["东山区","工农区","南山区","向阳区","兴安区","兴山区","萝北县","绥滨县"],"黑河市":["北安市","五大连池市","爱辉区","嫩江县","孙吴县","逊克县"],"绥化市":["安达市","海伦市","肇东市","北林区","兰西县","明水县","青冈县","庆安县","绥棱县","望奎县"],"鸡西市":["虎林市","密山市","滴道区","恒山区","鸡冠区","梨树区","麻山区","城子河区","鸡东县"],"伊春市":["铁力市","翠峦区","带岭区","红星区","美溪区","南岔区","五营区","西林区","新青区","伊春区","友好区","金山屯区","上甘岭区","汤旺河区","乌马河区","乌伊岭区","嘉荫县"],"佳木斯市":["富锦市","同江市","郊区","东风区","前进区","向阳区","抚远县","桦川县","桦南县","汤原县"],"牡丹江市":["海林市","穆棱市","宁安市","绥芬河市","爱民区","东安区","西安区","阳明区","东宁县","林口县"],"七台河市":["桃山区","新兴区","茄子河区","勃利县"],"双鸭山市":["宝山区","尖山区","岭东区","四方台区","宝清县","集贤县","饶河县","友谊县"],"齐齐哈尔市":["讷河市","建华区","龙沙区","铁锋区","昂昂溪区","碾子山区","富拉尔基区","拜泉县","富裕县","甘南县","克东县","克山县","龙江县","泰来县","依安县","梅里斯达斡尔族区"],"大兴安岭地区":["呼中区","松岭区","新林区","加格达奇区","呼玛县","漠河县","塔河县"]},"上海市":{"上海市":["宝山区","奉贤区","虹口区","黄浦区","嘉定区","金山区","静安区","闵行区","普陀区","青浦区","松江区","徐汇区","杨浦区","闸北区","长宁区","浦东新区","崇明县"]},"江苏省":{"南京市":["白下区","高淳区","鼓楼区","建邺区","江宁区","溧水区","六合区","浦口区","栖霞区","秦淮区","下关区","玄武区","雨花台区"],"常州市":["金坛市","溧阳市","天宁区","武进区","新北区","钟楼区","戚墅堰区"],"淮安市":["淮安区","淮阴区","清河区","清浦区","洪泽县","金湖县","涟水县","盱眙县","经济开发区"],"南通市":["海门市","启东市","如皋市","崇川区","港闸区","开发区","通州区","海安县","如东县","南通经济技术开发区"],"苏州市":["常熟市","昆山市","太仓市","张家港市","姑苏区","虎丘区","吴江区","吴中区","相城区","工业园"],"宿迁市":["宿城区","宿豫区","沭阳县","泗洪县","泗阳县"],"泰州市":["靖江市","泰兴市","兴化市","高港区","海陵区","姜堰区","开发区","滨江工业园"],"无锡市":["江阴市","宜兴市","锡山区","惠山区","滨湖区","梁溪区","新吴区"],"徐州市":["邳州市","新沂市","鼓楼区","贾汪区","泉山区","铜山区","云龙区","丰县","沛县","睢宁县"],"盐城市":["大丰市","东台市","亭湖区","盐都区","滨海县","阜宁县","建湖县","射阳县","响水县"],"扬州市":["高邮市","仪征市","广陵区","邗江区","江都区","开发区","宝应县"],"镇江市":["丹阳市","句容市","扬中市","丹徒区","京口区","润州区"],"连云港市":["海州区","连云区","新浦区","东海县","赣榆县","灌南县","灌云县"]},"浙江省":{"杭州市":["建德市","临安市","滨江区","富阳区","拱墅区","江干区","上城区","西湖区","下城区","萧山区","余杭区","淳安县","桐庐县"],"湖州市":["南浔区","吴兴区","安吉县","德清县","长兴县"],"嘉兴市":["海宁市","平湖市","桐乡市","南湖区","秀洲区","海盐县","嘉善县"],"金华市":["东阳市","兰溪市","义乌市","永康市","金东区","婺城区","磐安县","浦江县","武义县"],"丽水市":["龙泉市","莲都区","缙云县","青田县","庆元县","松阳县","遂昌县","云和县","景宁畲族自治县"],"宁波市":["慈溪市","奉化市","余姚市","北仑区","海曙区","江北区","江东区","鄞州区","镇海区","宁海县","象山县"],"绍兴市":["嵊州市","诸暨市","柯桥区","上虞区","越城区","新昌县"],"台州市":["临海市","温岭市","黄岩区","椒江区","路桥区","三门县","天台县","仙居县","玉环县"],"温州市":["乐清市","瑞安市","龙湾区","鹿城区","瓯海区","苍南县","洞头县","平阳县","泰顺县","文成县","永嘉县"],"舟山市":["定海区","普陀区","岱山县","嵊泗县"],"衢州市":["江山市","柯城区","衢江区","常山县","开化县","龙游县"]},"安徽省":{"合肥市":["巢湖市","包河区","庐阳区","蜀山区","瑶海区","肥东县","肥西县","庐江县","长丰县","滨湖新区"],"安庆市":["桐城市","大观区","宜秀区","迎江区","枞阳县","怀宁县","潜山县","太湖县","望江县","宿松县","岳西县"],"蚌埠市":["蚌山区","淮上区","禹会区","龙子湖区","固镇县","怀远县","五河县","高新技术开发区","高新技术产业开发区"],"池州市":["贵池区","东至县","青阳县","石台县"],"滁州市":["明光市","天长市","琅琊区","南谯区","定远县","凤阳县","来安县","全椒县"],"阜阳市":["界首市","颍东区","颍泉区","颍州区","阜南县","临泉县","太和县","颍上县","阜阳经济技术开发区"],"淮北市":["杜集区","烈山区","相山区","濉溪县"],"淮南市":["大通区","潘集区","八公山区","田家庵区","谢家集区","凤台县","高新技术产业开发区"],"黄山市":["黄山区","徽州区","屯溪区","歙县","黟县","祁门县","休宁县"],"六安市":["金安区","裕安区","寿县","霍邱县","霍山县","金寨县","舒城县"],"宿州市":["埇桥区","泗县","萧县","砀山县","灵璧县"],"铜陵市":["新城区","狮子山区","铜官山区","铜陵县"],"芜湖市":["镜湖区","鸠江区","三山区","弋江区","繁昌县","南陵县","无为县","芜湖县","经济开发区","经济技术开发区"],"宣城市":["宁国市","宣州区","泾县","广德县","绩溪县","旌德县","郎溪县"],"亳州市":["谯城区","利辛县","蒙城县","涡阳县"],"马鞍山市":["博望区","花山区","雨山区","和县","当涂县","含山县"]},"福建省":{"福州市":["福清市","长乐市","仓山区","鼓楼区","晋安区","马尾区","台江区","连江县","罗源县","闽侯县","闽清县","平潭县","永泰县"],"龙岩市":["漳平市","新罗区","永定区","连城县","上杭县","武平县","长汀县"],"南平市":["建瓯市","建阳市","邵武市","武夷山市","延平区","光泽县","浦城县","顺昌县","松溪县","政和县"],"宁德市":["福安市","福鼎市","蕉城区","古田县","屏南县","寿宁县","霞浦县","柘荣县","周宁县"],"莆田市":["城厢区","涵江区","荔城区","秀屿区","仙游县"],"泉州市":["晋江市","南安市","石狮市","丰泽区","鲤城区","洛江区","泉港区","安溪县","德化县","惠安县","永春县"],"三明市":["永安市","梅列区","三元区","沙县","大田县","建宁县","将乐县","明溪县","宁化县","清流县","泰宁县","尤溪县"],"厦门市":["海沧区","湖里区","集美区","思明区","同安区","翔安区"],"漳州市":["龙海市","龙文区","芗城区","东山县","华安县","南靖县","平和县","云霄县","漳浦县","长泰县","诏安县"]},"江西省":{"南昌市":["东湖区","湾里区","西湖区","青山湖区","青云谱区","安义县","进贤县","南昌县","新建县","红谷滩新区","昌北经济技术开发区","南昌高新技术开发区"],"抚州市":["临川区","崇仁县","东乡县","广昌县","金溪县","乐安县","黎川县","南城县","南丰县","宜黄县","资溪县","金巢经济开发区"],"赣州市":["南康市","瑞金市","章贡区","赣县","安远县","崇义县","大余县","定南县","会昌县","龙南县","宁都县","全南县","上犹县","石城县","信丰县","兴国县","寻乌县","于都县","章江新区","赣州市经济技术开发区"],"吉安市":["井冈山市","吉州区","青原区","安福县","吉安县","吉水县","遂川县","泰和县","万安县","峡江县","新干县","永丰县","永新县"],"九江市":["瑞昌市","共青城市","庐山区","浔阳区","德安县","都昌县","湖口县","九江县","彭泽县","武宁县","星子县","修水县","永修县","城西港区","九江经济开发区"],"萍乡市":["安源区","湘东区","莲花县","芦溪县","上栗县","萍乡高新技术工业园区"],"上饶市":["德兴市","信州区","广丰县","横峰县","鄱阳县","铅山县","上饶县","万年县","婺源县","弋阳县","余干县","玉山县","上饶经济技术开发区"],"新余市":["渝水区","分宜县","高新经济技术开发区"],"宜春市":["丰城市","高安市","樟树市","袁州区","奉新县","靖安县","上高县","铜鼓县","万载县","宜丰县","马王塘经济开发区"],"鹰潭市":["贵溪市","月湖区","余江县","鹰潭工业园"],"景德镇市":["乐平市","昌江区","珠山区","浮梁县"]},"山东省":{"济南市":["章丘市","槐荫区","历城区","历下区","市中区","天桥区","长清区","济阳县","平阴县","商河县","高新技术开发区"],"滨州市":["滨城区","博兴县","惠民县","无棣县","阳信县","沾化县","邹平县","滨州高新区","滨州经济开发区"],"德州市":["乐陵市","禹城市","德城区","陵县","临邑县","宁津县","平原县","齐河县","庆云县","武城县","夏津县","天衢工业园","商贸开发区","经济开发区"],"东营市":["东营区","河口区","广饶县","垦利县","利津县"],"菏泽市":["牡丹区","曹县","单县","成武县","定陶县","东明县","巨野县","鄄城县","郓城县"],"济宁市":["曲阜市","兖州市","邹城市","任城区","市中区","嘉祥县","金乡县","梁山县","泗水县","微山县","汶上县","鱼台县"],"莱芜市":["钢城区","莱城区"],"聊城市":["临清市","东昌府区","冠县","莘县","茌平县","东阿县","高唐县","阳谷县","经济技术开发区","聊城经济技术开发区"],"临沂市":["河东区","兰山区","罗庄区","费县","苍山县","莒南县","临沭县","蒙阴县","平邑县","郯城县","沂南县","沂水县"],"青岛市":["即墨市","胶州市","莱西市","平度市","城阳区","黄岛区","崂山区","李沧区","市北区","市南区"],"日照市":["东港区","岚山区","莒县","五莲县"],"泰安市":["肥城市","新泰市","岱岳区","泰山区","东平县","宁阳县"],"威海市":["荣成市","乳山市","文登市","环翠区","高新技术开发区","经济技术开发区","高新技术产业开发区"],"潍坊市":["安丘市","昌邑市","高密市","青州市","寿光市","诸城市","坊子区","寒亭区","奎文区","潍城区","昌乐县","临朐县","高新技术开发区","经济技术开发区","高新技术产业开发区"],"烟台市":["海阳市","莱阳市","莱州市","龙口市","蓬莱市","栖霞市","招远市","长岛县","福山区","高新区","莱山区","牟平区","芝罘区"],"枣庄市":["滕州市","高新区","山亭区","市中区","薛城区","峄城区","台儿庄区"],"淄博市":["博山区","临淄区","张店区","周村区","淄川区","高青县","桓台县","沂源县"]},"河南省":{"郑州市":["登封市","巩义市","新密市","新郑市","荥阳市","二七区","高新区","惠济区","金水区","上街区","中原区","管城回族区","中牟县","郑东新区","经济技术开发区"],"安阳市":["林州市","北关区","龙安区","文峰区","殷都区","滑县","安阳县","内黄县","汤阴县"],"鹤壁市":["鹤山区","淇滨区","山城区","浚县","淇县","金山工业开发区"],"焦作市":["孟州市","沁阳市","解放区","马村区","山阳区","中站区","温县","博爱县","武陟县","修武县"],"济源市":["北海街道","济水街道","沁园街道","天坛街道","五龙口镇","玉泉街道","承留镇","大峪","克井镇","梨林镇","坡头镇","邵原镇","思礼镇","王屋镇","下冶镇","轵城镇"],"开封市":["鼓楼区","金明区","龙亭区","禹王台区","顺河回族区","杞县","开封县","兰考县","通许县","尉氏县"],"洛阳市":["偃师市","吉利区","涧西区","老城区","洛龙区","西工区","瀍河回族区","嵩县","栾川县","洛宁县","孟津县","汝阳县","新安县","伊川县","宜阳县","高新技术开发区","经济技术开发区"],"南阳市":["邓州市","高新区","宛城区","卧龙区","方城县","南召县","内乡县","社旗县","唐河县","桐柏县","西峡县","淅川县","新野县","镇平县"],"商丘市":["永城市","梁园区","睢阳区","睢县","民权县","宁陵县","夏邑县","虞城县","柘城县"],"新乡市":["辉县市","卫辉市","凤泉区","红旗区","牧野区","卫滨区","封丘县","获嘉县","新乡县","延津县","原阳县","长垣县"],"信阳市":["平桥区","浉河区","息县","新县","固始县","光山县","淮滨县","潢川县","罗山县","商城县","羊山新区"],"许昌市":["禹州市","长葛市","魏都区","襄城县","许昌县","鄢陵县"],"周口市":["项城市","川汇区","郸城县","扶沟县","淮阳县","鹿邑县","商水县","沈丘县","太康县","西华县","经济技术开发区"],"漯河市":["郾城区","源汇区","召陵区","临颍县","舞阳县"],"濮阳市":["华龙区","范县","南乐县","濮阳县","清丰县","台前县"],"三门峡市":["灵宝市","义马市","湖滨区","陕州区","卢氏县","渑池县"],"平顶山市":["汝州市","舞钢市","石龙区","卫东区","新城区","新华区","湛河区","郏县","叶县","宝丰县","鲁山县","高新技术开发区"],"驻马店市":["驿城区","泌阳县","平舆县","确山县","汝南县","上蔡县","遂平县","西平县","新蔡县","正阳县","高新技术开发区"]},"湖北省":{"武汉市":["蔡甸区","汉南区","汉阳区","洪山区","黄陂区","江岸区","江汉区","江夏区","硚口区","青山区","武昌区","新洲区","东西湖区","东湖新技术开发区","武汉经济技术开发区","武汉吴家山经济技术开发区"],"鄂州市":["鄂城区","华容区","梁子湖区","葛店经济技术开发区"],"黄冈市":["麻城市","武穴市","黄州区","红安县","黄梅县","罗田县","蕲春县","团风县","浠水县","英山县"],"黄石市":["大冶市","铁山区","下陆区","黄石港区","西塞山区","阳新县"],"荆门市":["钟祥市","东宝区","掇刀区","京山县","沙洋县"],"荆州市":["洪湖市","石首市","松滋市","荆州区","沙市区","公安县","监利县","江陵县"],"十堰市":["丹江口市","茅箭区","张湾区","房县","郧县","郧西县","竹山县","竹溪县"],"随州市":["广水市","曾都区","随县"],"咸宁市":["赤壁市","咸安区","崇阳县","嘉鱼县","通城县","通山县"],"襄阳市":["宜城市","枣阳市","老河口市","襄城区","襄州区","樊城区","保康县","谷城县","南漳县"],"孝感市":["安陆市","汉川市","应城市","孝南区","大悟县","孝昌县","云梦县"],"宜昌市":["当阳市","宜都市","枝江市","点军区","西陵区","猇亭区","夷陵区","伍家岗区","兴山县","远安县","秭归县","长阳土家族自治县","五峰土家族自治县"],"神农架林区":["红坪镇","木鱼镇","松柏镇","新华镇","阳日镇","九湖乡","宋洛乡","下谷坪土家族乡"],"潜江市":["浩口镇","老新镇","龙湾镇","王场镇","熊口镇","渔洋镇","张金镇","高石碑镇","积玉口镇","竹根滩镇","园林高新技术开发区"],"天门市":["竟陵街道","杨林街道","侯口街道","多宝镇","干驿镇","横林镇","胡市镇","黄潭镇","蒋场镇","九真镇","卢市镇","麻洋镇","马湾镇","彭市镇","石河镇","拖市镇","汪场镇","小板镇","渔薪镇","岳口镇","皂市镇","张港镇","佛子山镇","净潭乡","天门工业园","天门经济开发区","国营蒋湖农场","白茅湖棉花原种场"],"仙桃市":["沙嘴街道","干河街道","龙华山街道","陈场镇","剅河镇","郭河镇","彭场镇","沙湖镇","郑场镇","通海口镇","西流河镇","长埫口镇","沔城回族镇"],"恩施土家族苗族自治州":["恩施市","利川市","巴东县","鹤峰县","建始县","来凤县","咸丰县","宣恩县"]},"湖南省":{"长沙市":["浏阳市","芙蓉区","开福区","天心区","望城区","雨花区","岳麓区","长沙县","宁乡县"],"常德市":["津市市","鼎城区","武陵区","澧县","安乡县","汉寿县","临澧县","石门县","桃源县","西洞庭管理区"],"郴州市":["资兴市","北湖区","苏仙区","安仁县","桂东县","桂阳县","嘉禾县","临武县","汝城县","宜章县","永兴县"],"衡阳市":["常宁市","耒阳市","南岳区","石鼓区","雁峰区","蒸湘区","珠晖区","衡东县","衡南县","衡山县","衡阳县","祁东县"],"怀化市":["洪江市","鹤城区","洪江区","辰溪县","会同县","溆浦县","沅陵县","中方县","麻阳苗族自治县","通道侗族自治县","新晃侗族自治县","芷江侗族自治县","靖州苗族侗族自治县"],"娄底市":["涟源市","冷水江市","娄星区","双峰县","新化县","娄底经济开发区"],"邵阳市":["武冈市","北塔区","大祥区","双清区","洞口县","隆回县","邵东县","邵阳县","绥宁县","新宁县","新邵县","城步苗族自治县"],"湘潭市":["韶山市","湘乡市","雨湖区","岳塘区","湘潭县"],"益阳市":["沅江市","赫山区","资阳区","南县","安化县","桃江县"],"永州市":["零陵区","冷水滩区","道县","东安县","江永县","蓝山县","宁远县","祁阳县","双牌县","新田县","江华瑶族自治县"],"岳阳市":["临湘市","汨罗市","君山区","岳阳楼区","云溪区","华容县","平江县","湘阴县","岳阳县","屈原管理区","洞庭湖旅游度假区","岳阳经济技术开发区"],"株洲市":["醴陵市","荷塘区","芦淞区","石峰区","天元区","攸县","茶陵县","炎陵县","株洲县","云龙示范区"],"张家界市":["永定区","武陵源区","慈利县","桑植县"],"湘西土家族苗族自治州":["吉首市","保靖县","凤凰县","古丈县","花垣县","龙山县","泸溪县","永顺县"]},"广东省":{"广州市":["从化市","增城市","白云区","番禺区","海珠区","花都区","黄埔区","荔湾区","萝岗区","南沙区","天河区","越秀区"],"东莞市":["东城街道","莞城街道","南城街道","万江街道","茶山镇","常平镇","大朗镇","道滘镇","东坑镇","凤岗镇","高埗镇","横沥镇","洪梅镇","厚街镇","虎门镇","黄江镇","寮步镇","麻涌镇","企石镇","桥头镇","清溪镇","沙田镇","石碣镇","石龙镇","石排镇","塘厦镇","谢岗镇","长安镇","中堂镇","大岭山镇","望牛墩镇","樟木头镇","松山湖管委会","虎门港管委会","东莞生态园"],"潮州市":["枫溪区","湘桥区","潮安县","饶平县"],"佛山市":["禅城区","高明区","南海区","三水区","顺德区"],"河源市":["高新区","源城区","东源县","和平县","连平县","龙川县","紫金县","高新技术开发区"],"惠州市":["惠城区","惠阳区","大亚湾区","博罗县","惠东县","龙门县"],"江门市":["恩平市","鹤山市","开平市","台山市","江海区","蓬江区","新会区"],"揭阳市":["普宁市","东山区","揭东区","普侨区","榕城区","大南山区","惠来县","揭西县","试验区","渔湖经济开发试验区"],"茂名市":["高州市","化州市","信宜市","茂港区","茂南区","电白县"],"梅州市":["兴宁市","梅江区","梅县","大埔县","丰顺县","蕉岭县","平远县","五华县"],"清远市":["连州市","英德市","清城区","清新区","佛冈县","阳山县","连南瑶族自治县","连山壮族瑶族自治县"],"汕头市":["潮南区","潮阳区","澄海区","濠江区","金平区","龙湖区","南澳县"],"汕尾市":["陆丰市","城区","华侨区","红海湾区","海丰县","陆河县"],"韶关市":["乐昌市","南雄市","曲江区","武江区","浈江区","仁化县","始兴县","翁源县","新丰县","乳源瑶族自治县"],"深圳市":["宝安区","福田区","龙岗区","罗湖区","南山区","盐田区","光明新区","龙华新区","坪山新区","大鹏新区"],"阳江市":["阳春市","江城区","阳东县","阳西县","海陵岛经济开发试验区"],"云浮市":["罗定市","云城区","新兴县","郁南县","云安县"],"湛江市":["雷州市","廉江市","吴川市","赤坎区","麻章区","坡头区","霞山区","遂溪县","徐闻县","湛江经济技术开发区"],"肇庆市":["高要市","四会市","鼎湖区","端州区","德庆县","封开县","广宁县","怀集县","大旺高新技术开发区"],"中山市":["石岐区","东区街道","南区街道","西区街道","五桂山街道","板芙镇","大涌镇","东凤镇","东升镇","阜沙镇","港口镇","古镇镇","横栏镇","黄圃镇","民众镇","南朗镇","南头镇","三角镇","三乡镇","沙溪镇","神湾镇","坦洲镇","小榄镇","火炬开发区"],"珠海市":["斗门区","金湾区","香洲区"]},"广西壮族自治区":{"南宁市":["江南区","良庆区","青秀区","兴宁区","邕宁区","西乡塘区","横县","宾阳县","隆安县","马山县","上林县","武鸣县"],"百色市":["右江区","德保县","靖西县","乐业县","凌云县","那坡县","平果县","田东县","田林县","田阳县","西林县","隆林各族自治县"],"北海市":["海城区","银海区","铁山港区","合浦县"],"崇左市":["凭祥市","江洲区","大新县","扶绥县","龙州县","宁明县","天等县"],"桂林市":["叠彩区","临桂区","七星区","象山区","秀峰区","雁山区","灌阳县","荔蒲县","灵川县","平乐县","全州县","兴安县","阳朔县","永福县","资源县","恭城瑶族自治县","龙胜各族自治县"],"贵港市":["桂平市","港北区","港南区","覃塘区","平南县"],"河池市":["宜州市","金城江区","东兰县","凤山县","南丹县","天峨县","巴马瑶族自治县","大化瑶族自治县","都安瑶族自治县","环江毛南族自治县","罗城仫佬族自治县"],"贺州市":["八步区","昭平县","钟山县","富川瑶族自治县","平桂管理区"],"来宾市":["合山市","兴宾区","武宣县","象州县","忻城县","金秀瑶族自治县"],"柳州市":["城中区","柳北区","柳南区","鱼峰区","柳城县","柳江县","鹿寨县","融安县","融水苗族自治县","三江侗族自治县"],"钦州市":["钦北区","钦南区","灵山县","浦北县","钦州港经济技术开发区"],"梧州市":["岑溪市","蝶山区","龙圩区","万秀区","长洲区","藤县","苍梧县","蒙山县"],"玉林市":["北流市","福绵区","玉州区","容县","博白县","陆川县","兴业县"],"防城港市":["东兴市","防城区","港口区","上思县","行政中心区"]},"海南省":{"海口市":["龙华区","美兰区","琼山区","秀英区"],"三亚市":["河东区","河西区","凤凰镇","吉阳镇","海棠湾镇"],"白沙黎族自治县":["牙叉镇","其它"],"保亭黎族苗族自治县":["保城镇","其它"],"昌江黎族自治县":["石碌镇","其它"],"澄迈县":["金江镇","老城镇","其它"],"儋州市":["大成镇","海头镇","和庆镇","那大镇","南丰镇","王五镇","洋浦经济开发区","其它"],"定安县":["定城镇","翰林镇","龙河镇","龙门镇","其它"],"东方市":["八所镇","其它"],"乐东黎族自治县":["抱由镇","其它"],"临高县":["波莲镇","博厚镇","东英镇","多文镇","和舍镇","皇桐镇","临城镇","南宝镇","调楼镇","新盈镇","其它"],"陵水黎族自治县":["本号镇","椰林镇","英州镇","群英乡","提蒙乡","其它"],"琼海市":["博鳌镇","嘉积镇","其它"],"琼中黎族苗族自治县":["营根镇","其它"],"屯昌县":["屯昌镇","屯城镇","其它"],"万宁市":["万城镇","兴隆镇","其它"],"文昌市":["昌洒镇","会文镇","锦山镇","铺前镇","清澜镇","潭牛镇","文城镇","翁田镇","其它"],"五指山市":["冲山镇","其它"],"三沙市":["南沙群岛的岛礁及其海域","西沙群岛的岛礁及其海域","中沙群岛的岛礁及其海域"]},"重庆市":{"重庆市":["巴南区","北碚区","大足区","涪陵区","高新区","合川区","江北区","江津区","南岸区","南川区","綦江区","黔江区","双桥区","万盛区","万州区","永川区","渝北区","渝中区","长寿区","大渡口区","九龙坡区","沙坪坝区","开县","忠县","璧山县","城口县","垫江县","丰都县","奉节县","梁平县","荣昌区","铜梁县","潼南县","巫山县","巫溪县","武隆县","云阳县","石柱土家族自治县","彭水苗族土家族自治县","秀山土家族苗族自治县","酉阳土家族苗族自治县"]},"四川省":{"成都市":["崇州市","彭州市","邛崃市","都江堰市","成华区","高新区","金牛区","锦江区","青羊区","温江区","武侯区","新都区","高新西区","龙泉驿区","青白江区","郫县","大邑县","金堂县","蒲江县","双流县","新津县"],"巴中市":["巴州区","恩阳区","南江县","平昌县","通江县"],"达州市":["万源市","通川区","达县","渠县","大竹县","开江县","宣汉县"],"德阳市":["广汉市","绵竹市","什邡市","旌阳区","罗江县","中江县"],"广安市":["华蓥市","广安区","前锋区","邻水县","武胜县","岳池县"],"广元市":["朝天区","利州区","昭化区","苍溪县","剑阁县","青川县","旺苍县"],"乐山市":["峨眉山市","沙湾区","市中区","金口河区","五通桥区","夹江县","犍为县","井研县","沐川县","峨边彝族自治县","马边彝族自治县"],"眉山市":["东坡区","丹棱县","洪雅县","彭山县","青神县","仁寿县"],"绵阳市":["江油市","涪城区","游仙区","安县","平武县","三台县","盐亭县","梓潼县","北川羌族自治县","高新技术开发区"],"南充市":["阆中市","高坪区","嘉陵区","顺庆区","南部县","蓬安县","西充县","仪陇县","营山县"],"内江市":["东兴区","市中区","隆昌县","威远县","资中县"],"遂宁市":["安居区","船山区","河东新区","大英县","蓬溪县","射洪县"],"雅安市":["名山区","雨城区","宝兴县","汉源县","芦山县","石棉县","天全县","荥经县"],"宜宾市":["翠屏区","南溪区","高县","珙县","江安县","筠连县","屏山县","兴文县","宜宾县","长宁县"],"资阳市":["简阳市","雁江区","安岳县","乐至县"],"自贡市":["大安区","贡井区","沿滩区","自流井区","荣县","富顺县","汇东新区"],"泸州市":["江阳区","纳溪区","龙马潭区","泸县","古蔺县","合江县","叙永县"],"攀枝花市":["东区","西区","仁和区","米易县","盐边县"],"甘孜藏族自治州":["巴塘县","白玉县","丹巴县","道孚县","稻城县","得荣县","德格县","甘孜县","九龙县","康定县","理塘县","炉霍县","泸定县","色达县","石渠县","乡城县","新龙县","雅江县"],"凉山彝族自治州":["西昌市","布拖县","德昌县","甘洛县","会东县","会理县","金阳县","雷波县","美姑县","冕宁县","宁南县","普格县","喜德县","盐源县","越西县","昭觉县","木里藏族自治县"],"阿坝藏族羌族自治州":["理县","茂县","阿坝县","黑水县","红原县","金川县","壤塘县","松潘县","汶川县","小金县","九寨沟县","马尔康县","若尔盖县"]},"贵州省":{"贵阳市":["清镇市","白云区","花溪区","南明区","乌当区","云岩区","开阳县","息烽县","修文县","金阳新区"],"安顺市":["开发区","西秀区","平坝县","普定县","关岭布依族苗族自治县","镇宁布依族苗族自治县","紫云苗族布依族自治县"],"遵义市":["赤水市","仁怀市","汇川区","红花岗区","凤冈县","湄潭县","绥阳县","桐梓县","习水县","余庆县","正安县","遵义县","道真仡佬族苗族自治县","务川仡佬族苗族自治县"],"六盘水市":["钟山区","六枝特区","盘县","水城县","红桥新区"],"铜仁市":["碧江区","万山区","德江县","江口县","石阡县","思南县","松桃苗族自治县","玉屏侗族自治县","沿河土家族自治县","印江土家族苗族自治县"],"毕节市":["七星关区","大方县","赫章县","金沙县","纳雍县","黔西县","织金县","威宁彝族回族苗族自治县"],"黔东南苗族侗族自治州":["凯里市","岑巩县","从江县","丹寨县","黄平县","剑河县","锦屏县","雷山县","黎平县","麻江县","榕江县","三穗县","施秉县","台江县","天柱县","镇远县"],"黔南布依族苗族自治州":["都匀市","福泉市","独山县","贵定县","惠水县","荔波县","龙里县","罗甸县","平塘县","瓮安县","长顺县","三都水族自治县"],"黔西南布依族苗族自治州":["兴义市","安龙县","册亨县","普安县","晴隆县","望谟县","兴仁县","贞丰县"]},"云南省":{"昆明市":["安宁市","呈贡区","东川区","官渡区","盘龙区","五华区","西山区","富民县","晋宁县","嵩明县","宜良县","石林彝族自治县","禄劝彝族苗族自治县","寻甸回族彝族自治县"],"保山市":["隆阳区","昌宁县","龙陵县","施甸县","腾冲县"],"丽江市":["古城区","华坪县","永胜县","宁蒗彝族自治县","玉龙纳西族自治县"],"普洱市":["思茅区","景东彝族自治县","西盟佤族自治县","宁蒗彝族自治县","墨江哈尼族自治县","景谷傣族彝族自治县","江城哈尼族彝族自治县","宁洱哈尼族彝族自治县","孟连傣族拉祜族佤族自治县","镇沅彝族哈尼族拉祜族自治县"],"临沧市":["临翔区","云县","凤庆县","永德县","镇康县","沧源佤族自治县","耿马傣族佤族自治县","双江拉祜族佤族布朗族傣族自治县"],"曲靖市":["宣威市","麒麟区","富源县","会泽县","陆良县","罗平县","马龙县","师宗县","沾益县"],"玉溪市":["红塔区","澄江县","华宁县","江川县","通海县","易门县","峨山彝族自治县","新平彝族傣族自治县","元江哈尼族彝族傣族自治县"],"昭通市":["昭阳区","大关县","鲁甸县","巧家县","水富县","绥江县","威信县","盐津县","彝良县","永善县","镇雄县"],"楚雄彝族自治州":["楚雄市","大姚县","禄丰县","牟定县","南华县","双柏县","武定县","姚安县","永仁县","元谋县"],"迪庆藏族自治州":["德钦县","香格里拉县","维西傈僳族自治县"],"大理白族自治州":["大理市","宾川县","洱源县","鹤庆县","剑川县","弥渡县","祥云县","永平县","云龙县","漾濞彝族自治县","南涧彝族自治县","巍山彝族回族自治县"],"文山壮族苗族自治州":["文山市","富宁县","广南县","马关县","丘北县","西畴县","砚山县","麻栗坡县"],"怒江傈僳族自治州":["福贡县","泸水县","贡山独龙族怒族自治县","兰坪白族普米族自治县"],"西双版纳傣族自治州":["景洪市","勐海县","勐腊县"],"德宏傣族景颇族自治州":["芒市","瑞丽市","梁河县","陇川县","盈江县"],"红河哈尼族彝族自治州":["个旧市","开远市","蒙自市","红河县","建水县","泸西县","绿春县","弥勒县","石屏县","元阳县","河口瑶族自治县","屏边苗族自治县","金平苗族瑶族傣族自治县"]},"西藏自治区":{"拉萨市":["城关区","达孜县","当雄县","林周县","尼木县","曲水县","堆龙德庆县","墨竹工卡县"],"阿里地区":["措勤县","噶尔县","改则县","革吉县","普兰县","日土县","札达县"],"昌都市":["卡若区","八宿县","边坝县","察雅县","丁青县","贡觉县","江达县","洛隆县","芒康县","左贡县","类乌齐县"],"林芝地区":["朗县","波密县","察隅县","林芝县","米林县","墨脱县","工布江达县"],"那曲地区":["索县","安多县","巴青县","班戈县","比如县","嘉黎县","那曲县","尼玛县","聂荣县","申扎县"],"山南地区":["措美县","错那县","贡嘎县","加查县","隆子县","洛扎县","乃东县","琼结县","曲松县","桑日县","扎囊县","浪卡子县"],"日喀则市":["桑珠孜区","昂仁县","白朗县","定结县","定日县","岗巴县","吉隆县","江孜县","康马县","拉孜县","仁布县","萨嘎县","萨迦县","亚东县","仲巴县","南木林县","聂拉木县","谢通门县"]},"陕西省":{"西安市":["灞桥区","碑林区","莲湖区","临潼区","未央区","新城区","阎良区","雁塔区","长安区","户县","高陵县","蓝田县","周至县","高新技术开发区","西安经济技术开发区"],"宝鸡市":["陈仓区","金台区","渭滨区","凤县","陇县","眉县","凤翔县","扶风县","麟游县","岐山县","千阳县","太白县","高新技术产业开发区"],"安康市":["汉滨区","白河县","汉阴县","岚皋县","宁陕县","平利县","石泉县","旬阳县","镇坪县","紫阳县"],"汉中市":["汉台区","勉县","洋县","城固县","佛坪县","留坝县","略阳县","南郑县","宁强县","西乡县","镇巴县","北开发区"],"商洛市":["商州区","丹凤县","洛南县","山阳县","商南县","柞水县","镇安县"],"铜川市":["王益区","耀州区","印台区","宜君县","铜川新区"],"渭南市":["韩城市","华阴市","临渭区","华县","白水县","澄城县","大荔县","富平县","合阳县","蒲城县","潼关县","高新经济开发区"],"咸阳市":["兴平市","秦都区","渭城区","杨陵区","彬县","乾县","淳化县","泾阳县","礼泉县","三原县","武功县","旬邑县","永寿县","长武县"],"延安市":["宝塔区","富县","安塞县","甘泉县","黄陵县","黄龙县","洛川县","吴起县","延川县","延长县","宜川县","志丹县","子长县"],"榆林市":["榆阳区","佳县","定边县","府谷县","横山县","靖边县","米脂县","清涧县","神木县","绥德县","吴堡县","子洲县"]},"甘肃省":{"兰州市":["安宁区","城关区","红古区","西固区","七里河区","皋兰县","永登县","榆中县"],"白银市":["白银区","平川区","会宁县","景泰县","靖远县"],"定西市":["安定区","岷县","漳县","临洮县","陇西县","通渭县","渭源县"],"陇南市":["武都区","成县","徽县","康县","礼县","文县","宕昌县","两当县","西和县"],"金昌市":["金川区","永昌县"],"酒泉市":["敦煌市","玉门市","肃州区","瓜州县","金塔县","肃北蒙古族自治县","阿克塞哈萨克族自治县"],"庆阳市":["西峰区","环县","宁县","合水县","华池县","庆城县","镇原县","正宁县"],"天水市":["北道区","秦城区","甘谷县","秦安县","清水县","武山县","张家川回族自治县"],"武威市":["凉州区","古浪县","民勤县","天祝藏族自治县"],"张掖市":["甘州区","高台县","临泽县","民乐县","山丹县","肃南裕固族自治县"],"平凉市":["崆峒区","崇信县","华亭县","泾川县","静宁县","灵台县","庄浪县"],"嘉峪关市":["朝阳街道","建设街道","前进街道","胜利街道","五一街道","新华街道","峪苑街道"],"临夏回族自治州":["临夏市","广河县","和政县","康乐县","临夏县","永靖县","东乡族自治县","积石山保安族东乡族撒拉族自治县"],"甘南藏族自治州":["合作市","迭部县","临潭县","碌曲县","玛曲县","夏河县","舟曲县","卓尼县"]},"青海省":{"西宁市":["城北区","城东区","城西区","城中区","湟源县","湟中县","大通回族土族自治县"],"海东市":["乐都县","平安县","互助土族自治县","化隆回族自治县","循化撒拉族自治县","民和回族土族自治县"],"果洛藏族自治州":["班玛县","达日县","甘德县","久治县","玛多县","玛沁县"],"海北藏族自治州":["刚察县","海晏县","祁连县","门源回族自治县"],"海南藏族自治州":["共和县","贵德县","贵南县","同德县","兴海县"],"黄南藏族自治州":["尖扎县","同仁县","泽库县","河南蒙古族自治县"],"玉树藏族自治州":["玉树市","称多县","囊谦县","杂多县","治多县","曲麻莱县"],"海西蒙古族藏族自治州":["德令哈市","格尔木市","都兰县","天峻县","乌兰县","冷湖行政区","茫崖行政区","大柴旦行政区"]},"宁夏回族自治区":{"银川市":["灵武市","金凤区","西夏区","兴庆区","贺兰县","永宁县"],"固原市":["原州区","泾源县","隆德县","彭阳县","西吉县"],"吴忠市":["青铜峡市","利通区","红寺堡区","同心县","盐池县"],"中卫市":["沙坡头区","海原县","中宁县"],"石嘴山市":["惠农区","大武口区","平罗县"]},"新疆维吾尔自治区":{"乌鲁木齐市":["米东区","天山区","新市区","达坂城区","水磨沟区","头屯河区","沙依巴克区","乌鲁木齐县","经济技术开发区"],"石河子市":["东城街道","红山街道","老街街道","向阳街道","其它"],"克拉玛依市":["白碱滩区","独山子区","乌尔禾区","克拉玛依区"],"哈密地区":["哈密市","伊吾县","巴里坤哈萨克自治县"],"和田地区":["和田市","策勒县","和田县","洛浦县","民丰县","墨玉县","皮山县","于田县"],"塔城地区":["塔城市","乌苏市","额敏县","沙湾县","托里县","裕民县","和布克赛尔蒙古自治县"],"喀什地区":["喀什市","巴楚县","伽师县","莎车县","疏附县","疏勒县","叶城县","泽普县","麦盖提县","英吉沙县","岳普湖县","塔什库尔干塔吉克自治县"],"阿克苏地区":["阿克苏市","拜城县","柯坪县","库车县","沙雅县","温宿县","乌什县","新和县","阿瓦提县"],"阿勒泰地区":["阿勒泰市","福海县","富蕴县","青河县","布尔津县","哈巴河县","吉木乃县"],"吐鲁番地区":["吐鲁番市","鄯善县","托克逊县"],"阿拉尔市":["其它"],"五家渠市":["军垦路街道","人民路街道","其它"],"图木舒克市":["其它"],"北屯市":["其它"],"铁门关市":["其它"],"双河市":["其它"],"昌吉回族自治州":["昌吉市","阜康市","奇台县","呼图壁县","玛纳斯县","吉木萨尔县","木垒哈萨克自治县"],"伊犁哈萨克自治州":["奎屯市","伊宁市","霍尔果斯市","巩留县","霍城县","新源县","伊宁县","昭苏县","尼勒克县","特克斯县","察布查尔锡伯自治县"],"巴音郭楞蒙古自治州":["库尔勒市","博湖县","和静县","和硕县","轮台县","且末县","若羌县","尉犁县","焉耆回族自治县"],"博尔塔拉蒙古自治州":["博乐市","阿拉山口市","精河县","温泉县"],"克孜勒苏柯尔克孜自治州":["阿图什市","乌恰县","阿合奇县","阿克陶县"]},"香港特别行政区":{"香港特别行政区":["香港岛","新界","九龙","离岛"]},"澳门特别行政区":{"澳门特别行政区":["澳门半岛","氹仔","路环"]},"台湾":{"台北市":["大安区","大同区","内湖区","南港区","松山区","万华区","文山区","信义区","中山区","中正区","北投区","士林区"],"新北市":["林口区","莺歌区","八里区","板桥区","淡水区","芦洲区","三重区","深坑区","树林区","泰山区","土城区","五股区","新庄区","永和区","中和区","万里区","金山区","石碇区","瑞芳区","贡寮区","坪林区","乌来区","三芝区","石门区","平溪区","双溪区","三峡区","汐止区","新店区"],"台中市":["北区","北屯区","大安区","大肚区","大甲区","大里区","大雅区","东区","丰原区","后里区","龙井区","南区","南屯区","清水区","三义乡","沙鹿区","神冈区","石冈区","潭子区","通宵镇","外埔区","乌日区","梧栖区","西区","西屯区","苑里镇","中区","太平区","雾峰区","东势镇","和平乡","新社乡"],"台南市":["安定区","安南区","安平区","北区","东区","永康区","归仁区","仁德区","关庙区","官田区","佳里区","六甲区","麻豆区","南区山","上区","善化区","西港区","西区","新市区","中区","新化区","新营区","左镇区","玉井区","南化区","楠西区","龙崎区","七股区","将军区","学甲区","北门区","后壁区","白河区","东山区","下营区","柳营区","盐水区","大内区"],"高雄市":["阿莲区","大寮区","大社区","大树区","凤山区","冈山区","鼓山区","湖内区","林园区","苓雅区","路竹区","楠梓区","鸟松区","旗津区","前金区","前镇区","桥头区","仁武区","三民区","小港区","新兴区","盐埕区","燕巢区","永安区","梓官区","左营区","田寮乡","六龟乡","内门乡","茂林乡","桃源乡","甲仙乡","弥陀乡","旗山镇","美浓镇","那玛夏乡","茄萣乡","杉林乡"],"基隆市":["七堵区","中山区","中正区","仁爱区","信义区","安乐区","暖暖区"],"新竹市":["东区","北区","香山区"],"嘉义市":["东区","西区"],"桃园县":["桃园市","中坜市","平镇市","八德市","大溪镇","大园乡","观音乡","龟山乡","复兴乡","龙潭乡","芦竹乡","新屋乡","杨梅市"],"新竹县":["竹北市","湖口乡","新丰乡","新埔镇","关西镇","芎林乡","竹东镇","峨眉乡","宝山乡","五峰乡","横山乡","北埔乡","尖石乡"],"苗栗县":["竹南镇","头份镇","三湾乡","后龙镇","通霄镇","苑里镇","苗栗市","造桥乡","头屋乡","公馆乡","铜锣乡","三义乡","西湖乡","南庄乡","狮潭乡","大湖乡","泰安乡","卓兰镇"],"彰化县":["北斗镇","草屯镇","大村乡","二水乡","芳苑乡","芬园乡","福兴乡","和美镇","花坛乡","鹿港镇","南投市","埤头乡","埔心乡","埔盐乡","社头乡","伸港乡","田尾乡","田中镇","溪湖镇","线西乡","秀水乡","永靖乡","员林镇","彰化市","二林镇","大城乡","竹塘乡","溪州乡"],"南投县":["埔里镇","竹山镇","集集镇","名间乡","鹿谷乡","中寮乡","鱼池乡","国姓乡","水里乡","信义乡","仁爱乡","南投巿","草屯镇","琉球乡"],"云林县":["大埤乡","土库镇","林内乡","莿桐乡","西螺镇","仑背乡","古坑乡","褒忠乡","东势乡","台西乡","麦寮乡","二仑乡","北港镇","水林乡","口湖乡","四湖乡","元长乡","斗六市","斗南镇","虎尾镇"],"嘉义县":["竹崎乡","番路乡","梅山乡","阿里山乡","东石乡","大埔乡","溪口乡","义竹乡","布袋镇","大林镇","六脚乡","鹿草乡","民雄乡","朴子市","水上乡","太保市","新港乡","中埔乡"],"屏东县":["屏东市","万丹乡","长治乡","内埔乡","潮州镇","三地门乡","来义乡","狮子乡","牡丹乡","高树乡","满州乡","万峦乡","春日乡","雾台乡","泰武乡","玛家乡","恒春镇","枋寮乡","东港镇","林边乡","枋山乡","里港乡","车城乡","盐埔乡","九如乡","新园乡","新埤乡","佳冬乡","竹田乡","南州乡","崁顶乡","麟洛乡"],"宜兰县":["头城镇","宜兰市","礁溪乡","壮围乡","五结乡","罗东镇","员山乡","南澳乡","冬山乡","大同乡","三星乡","苏澳镇"],"花莲县":["花莲巿","光复乡","玉里镇","新城乡","吉安乡","寿丰乡","凤林镇","丰滨乡","瑞穗乡","富里乡","秀林乡","万荣乡","卓溪乡"],"台东县":["台东巿","成功镇","关山镇","卑南乡","大武乡","太麻里乡","东河乡","长滨乡","鹿野乡","池上乡","延平乡","海端乡","达仁乡","金峰乡"],"澎湖县":["马公市","湖西乡","白沙乡","西屿乡","望安乡","七美乡"],"金门县":["金城镇","金湖镇","金沙镇","金宁乡","烈屿乡","乌丘乡"],"连江县":["南竿乡","北竿乡","莒光乡","东引乡"]},"海外":{"其它":["其它"]}});var t=e('<div class="fui_address-select"/>').appendTo(this.element),i=this,a=this.options,s=[];FX.Utils.forEach(FX.AddressData,function(e){s.push({value:e,text:e})}),this.province=FX.createWidget({type:"combo",customCls:"sel-province",items:s,renderEl:e("<div/>").appendTo(t),allowBlank:a.allowBlank,width:a.width4province,waterMark:"省/自治区/直辖市",onAfterItemSelect:function(){i.linkByProvince(this.getValue()),FX.Utils.applyFunc(i,a.onStopEdit,[],!1)}}),this.city=FX.createWidget({type:"combo",customCls:"sel-city",items:[],renderEl:e("<div/>").appendTo(t),allowBlank:a.allowBlank,width:a.width4city,waterMark:"市",onAfterItemSelect:function(){i.linkByProvinceAndCity(i.province.getValue(),this.getValue()),FX.Utils.applyFunc(i,a.onStopEdit,[],!1)}}),this.district=FX.createWidget({type:"combo",renderEl:e("<div/>").appendTo(t),customCls:"sel-district",allowBlank:a.allowBlank,width:a.width4district,waterMark:"区/县",items:[],onAfterItemSelect:function(){FX.Utils.applyFunc(i,a.onStopEdit,[],!1)}}),a.needDetail?this.detail=FX.createWidget({type:"textarea",customCls:"address-detail",waterMark:"详细地址",allowBlank:a.allowBlank,width:a.width4detail,renderEl:e("<div/>").appendTo(this.element),onStopEdit:function(){FX.Utils.applyFunc(i,a.onStopEdit,[],!1)}}):this.element.addClass("no-detail")},linkByProvince:function(e){var t=[];FX.Utils.forEach(FX.AddressData[e],function(e){t.push({value:e,text:e})}),this.city.options.items=t,this.district.options.items=[],this.city.rebuild(),this.district.rebuild()},linkByProvinceAndCity:function(e,t){var i=FX.AddressData[e];if(i){var a=[];FX.Utils.forEach(i[t],function(e,t){a.push({value:t,text:t})}),this.district.options.items=a}else this.district.options.items=[];this.district.rebuild()},setEnable:function(e){this.options.enable=!!e,this.province.setEnable(e),this.city.setEnable(e),this.district.setEnable(e),this.detail&&this.detail.setEnable(e)},checkValidate:function(){var e=this.province.checkValidate()&&this.city.checkValidate()&&this.district.checkValidate();return this.detail&&(e=this.detail.checkValidate()&&e),e},setValue:function(e){if(e)return FX.Utils.isEmpty(e.detail)||this.detail&&this.detail.setValue(e.detail),void(FX.Utils.isEmpty(e.province)||(this.province.setValue(e.province),this.linkByProvince(e.province),FX.Utils.isEmpty(e.city)||(this.city.setValue(e.city),this.linkByProvinceAndCity(e.province,e.city),FX.Utils.isEmpty(e.district)||this.district.setValue(e.district))));this.province.setValue(null),this.linkByProvince(null),this.detail&&this.detail.setValue(null)},getValue:function(){var e={},t=this.province.getValue(),i=this.city.getValue(),a=this.district.getValue(),s=this.detail?this.detail.getValue():null;return FX.Utils.isEmpty(t)||(e.province=t),FX.Utils.isEmpty(i)||(e.city=i),FX.Utils.isEmpty(a)||(e.district=a),FX.Utils.isEmpty(s)||(e.detail=s),e},getText:function(){var e=this.getValue();return[e.province,e.city,e.district,e.detail].join("")},getOptions:function(){var t=this.options;return e.extend(FX.Address.superclass.getOptions.apply(this,arguments),{needDetail:t.needDetail})},getNullValue:function(){return{}}}),e.shortcut("address",FX.Address)}(jQuery),function(e){FX.Location=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Location.superclass._defaultConfig.apply(),{baseCls:"fui_location",allowBlank:!0,locationText:"获取当前位置",hasBrief:!0,btnWidth:240,btnHeight:36,isValueVisible:!0})},_init:function(){FX.Location.superclass._init.apply(this,arguments);var t=this.options;this.button=new FX.Button({renderEl:e('<div class="location-btn"/>').appendTo(this.element),text:t.locationText,style:"white",width:t.btnWidth,height:t.btnHeight}),t.hasBrief&&e('<span class="location-tip"/>').text("请在移动端打开表单获取位置信息").appendTo(this.element)},checkValidate:function(){return this.options.allowBlank||!FX.Utils.isObjectEmpty(this.value)},setValue:function(t){var i=this.options;if(this.value=t,!FX.Utils.isObjectEmpty(t)&&i.isValueVisible){var a=t.province+t.city+t.district+t.detail;this.$info?this.$info.text(a):(this.$info=e('<div class="location-info"/>').prependTo(this.element).append("<span>"+a+"</span>"),i.lnglatVisible&&e('<div class="sub-info">'+FX.Utils.getLnglatText(t)+"</div>").appendTo(this.$info))}},getValue:function(){return this.value||{}},getOptions:function(){var t=this.options;return e.extend(FX.Location.superclass.getOptions.apply(this,arguments),{adjustable:t.adjustable,radius:t.radius,limits:t.limits,lnglatVisible:t.lnglatVisible})},getNullValue:function(){return{}}}),e.shortcut("location",FX.Location)}(jQuery),function(e){FX.Upload=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Upload.superclass._defaultConfig.apply(),{files:[],fileType:[],maxFileSize:5242880,maxLimitTip:"文件大小超出限制",maxFileCount:FX.CONST.UPLOAD_FILE_COUNT.SINGLE,uploadURL:"/upload",uploadTokenURL:FX.Utils.getApi(FX.API.file.get_token),uploadSite:"qn",uploadToMedia:!1,uploadToForm:!1,allowBlank:!0,onValidateSuccess:null,onValidateFail:null,onAfterValidate:null,onUpload:null,onUploadSuccess:null,onUploadFail:null,onAfterUpload:null})},_init:function(){FX.Upload.superclass._init.apply(this,arguments);var e=this.options;this.tokenKey=e.uploadToMedia?"imageUploadToken":"fileUploadToken",this.tokenExpireKey=this.tokenKey+"Expires",this._initUploadForm(),this._initUploadInput()},_initUploadForm:function(){var t=this.options;switch(t.uploadSite){case"qn":t.uploadURL="https://up.qbox.me/";break;case"oss":t.uploadURL="https://jdy-image.oss-cn-hangzhou.aliyuncs.com"}this.$uploadForm=e('<form class="upload-form" action="'+t.uploadURL+'" enctype="multipart/form-data" method="post"/>')},_initUploadInput:function(){var t=this.options;this.files=t.files||[],this.$uploadInput=e('<input type="file" name="file" class="upload-btn-input"/>').appendTo(this.$uploadForm),t.maxFileCount>1&&this.$uploadInput.attr("multiple",!0)},doUpload:function(){var e=this;if(!this.upFiles){if(!this.$uploadInput[0].files.length>1)return;this.upFiles=this.$uploadInput[0].files}this._checkUploadToken(function(){e._doDataUpload()})},_isTokenValid:function(){return FX.STATIC[this.tokenKey]&&Date.now()<FX.STATIC[this.tokenExpireKey]},_checkUploadToken:function(e){var t=this,i=this.options;return"local"===i.uploadSite?e():this._isTokenValid()?e():void FX.Utils.dataAjax({url:i.uploadTokenURL,data:{site:i.uploadSite,isMedia:i.uploadToMedia}},function(i){FX.STATIC[t.tokenKey]=i.token,FX.STATIC[t.tokenExpireKey]=18e5+Date.now(),e()},function(e){FX.Vip.showUpgradeTip(e.responseJSON)})},_doDataUpload:function(){var e=this,t=this.options;if(FX.Utils.isFormDataSupported()){var i=0,a=[],s=0,n=0,o=function(){return a.reduce(function(e,t){return e+t})},l=function(){s+n===e.upFiles.length&&(n>0?e.onFail({failCount:n}):e.onSuccess())};if(this.upFiles)for(var r=0,d=this.upFiles.length;r<d;r++){var c=this.upFiles[r];i+=c.size,FX.Utils.uploadFile({uploadSite:t.uploadSite,uploadUrl:t.uploadURL,uploadToMedia:t.uploadToMedia,uploadToForm:t.uploadToForm,uploadToken:FX.STATIC[this.tokenKey],widgetName:t.widgetName},c,function(t){a[r]=t,e.onUpload(o(),i)},function(t){a[r]=c.size,e.onUpload(o(),i),e.files.push(t.file),s++,l()},function(){a[r]=0,e.onUpload(o(),i),n++,l()})}}else FX.Msg.toast({type:"warning",msg:"您使用的浏览器版本过低，无法使用文件上传功能！"})},checkValidate:function(){var e=this.options,t=!0;return e.allowBlank||(t=this.isUploaded()),t?FX.Utils.applyFunc(this,e.onValidateSuccess,[],!1):FX.Utils.applyFunc(this,e.onValidateFail,[],!1),FX.Utils.applyFunc(this,e.onAfterValidate,[],!1),t},checkFile:function(e){var t=this.options;if(!e)return!1;var i=e.name.split(".").pop(),a=!0;a&&t.fileType.length>0&&-1===t.fileType.indexOf(i.toLowerCase())&&(FX.Msg.toast({msg:"不支持选择的文件类型",type:"warning"}),a=!1);var s=t.maxFileSize;return a&&e.size>s&&(FX.Msg.toast({msg:t.maxLimitTip,type:"warning"}),a=!1),a},doClear:function(){this.resetUploadInput(),this.files=[]},resetUploadInput:function(){this.$uploadInput.replaceWith(this.$uploadInput=this.$uploadInput.clone(!0).val(""))},onUpload:function(e,t){var i=this.options;FX.Utils.applyFunc(this,i.onUpload,[e,t],!1)},onSuccess:function(){var e=this.options;FX.Utils.applyFunc(this,e.onUpload,[1,1],!1),FX.Utils.applyFunc(this,e.onUploadSuccess,[this.files],!1),this.resetUploadInput()},onFail:function(e){var t=this.options;FX.Utils.applyFunc(this,t.onUploadFail,[e],!1),413===e?FX.Msg.toast({type:"warning",msg:t.maxLimitTip}):FX.Msg.toast({type:"warning",msg:"文件上传失败"})},onFinish:function(){var e=this.options;FX.Utils.applyFunc(this,e.onAfterUpload,[],!1)},isUploaded:function(){return!FX.Utils.isObjectEmpty(this.files)},setEnable:function(e){this.options.enable=!!e,e?this.$uploadInput.removeAttr("disabled").removeAttr("readonly"):this.$uploadInput.attr("disabled","disabled").attr("readonly","readonly")},getValue:function(){return this.files},getUpFiles:function(){return this.upFiles},getNullValue:function(){return[]},setValue:function(t){var i=this.options;this.files=e.makeArray(t),this.files.length>i.maxFileCount&&(this.files=this.files.slice(0,i.maxFileCount))},getOptions:function(){var t=this.options;return e.extend(FX.Upload.superclass.getOptions.apply(this,arguments),{maxFileCount:t.maxFileCount})}})}(jQuery),function(e){FX.FileUpload=FX.extend(FX.Upload,{_defaultConfig:function(){return e.extend(FX.FileUpload.superclass._defaultConfig.apply(),{baseCls:"fui_upload",files:[],fileType:[],maxFileSize:5242880,maxFileCount:FX.CONST.UPLOAD_FILE_COUNT.SINGLE,uploadURL:"/upload",uploadSite:"qn",uploadToForm:!0,style:"white",size:"normal",mode:"upload",iconCls:"icon-widget-upload",btnText:"选择文件",maxCountTip:"最多允许选择{num}个文件",noFileTip:"当前没有文件上传",fileThumbSize:"",allowBlank:!0,thumbWidth:65,thumbHeight:65,hasProgress:!0,progressWidth:420,progressHeight:30,hasPreview:!0,hasPreviewList:!0,hasEmptyTip:!1,onBeforeUpload:null,onUpload:null,onAfterUpload:null,onUploadFail:null,onFileThumbCreate:null,onFileRemove:null,onStopEdit:null,disableMode:"other"})},_init:function(){FX.FileUpload.superclass._init.apply(this,arguments);var t=this.options;"upload"===t.mode&&this._createUploadBtn(),t.hasProgress&&(this.progress=FX.createWidget({type:"progress",renderEl:e("<div/>").appendTo(this.element),width:t.progressWidth,height:t.progressHeight,visible:!1})),this.$previewList=e('<div class="upload-preview-list"/>').attr("data-watermark",t.noFileTip).appendTo(this.element),t.enable||"form"!==t.disableMode||this.$previewList.addClass("disable-mode-form"),"small"===t.size&&this.$previewList.addClass("small"),this._bindFileEvent()},_createUploadBtn:function(){var t=this.options;if(this.$uploadBtn=e('<div class="upload-btn x-btn"/>').addClass("style-"+t.style).appendTo(this.element),e('<i class="'+t.iconCls+' upload-icon"/>').appendTo(this.$uploadBtn),e("<span/>").text(t.btnText).appendTo(this.$uploadBtn),this.$uploadForm.appendTo(this.$uploadBtn),t.fileType.length>0){var i="."+t.fileType.join(",.");this.$uploadInput.prop("accept",i)}},_checkUploadFiles:function(e){var t=this,i=this.options;if(this.files.length+e.length>i.maxFileCount)return FX.Msg.toast({msg:i.maxCountTip.replace(/{num}/,i.maxFileCount),type:"warning"}),!1;var a=!0;if(e)for(var s=0,n=e.length;s<n&&(a=a&&t.checkFile(e[s]));s++);return a},_previewFiles:function(e){var t=this,i=this.options;if(i.hasPreviewList){e||(e=this.files);var a=e&&e.length>0;if(a)for(var s=0,n=e.length;s<n;s++)t._createFilePreview(e[s]).appendTo(t.$previewList);i.hasEmptyTip&&this._renderEmpty(!a)}},_createFilePreview:function(t){var i=this,a=this.options,s=FX.Utils.formatFileSize(t.size),n=i._trimFileName(t.name),o=t.name?t.name.split(".").pop():"",l=FX.Utils.date2Str(new Date(t.uploadTime),"yyyy/MM/dd");if("print"===a.mode)return e("<div/>").text([n,"文件大小:"+s,"上传时间:"+l].join(" "));var r=e('<div class="upload-info"/>'),d=e('<div class="upload-preview"/>').appendTo(r),c=e('<div class="upload-file-info"/>').appendTo(r);return FX.Utils.isImageExt(o)?t instanceof File?(i.drawLocalPreview(t,a.thumbWidth,a.thumbHeight).appendTo(d),FX.Utils.applyFunc(this,a.onFileThumbCreate,[{type:"local",ext:t}],!1)):t.qnKey&&i._drawRemotePreview(t,function(e){e.appendTo(d);var t=e.clone();FX.Utils.applyFunc(i,a.onFileThumbCreate,[{type:"remote",ext:t}],!1)}):(FX.Utils.createFileThumb(o,a.fileThumbSize).appendTo(d),FX.Utils.applyFunc(this,a.onFileThumbCreate,[{type:"normal",ext:o}],!1)),e('<div class="info-text"/>').text(n).appendTo(c),e('<div class="info-sub"/>').text(s).appendTo(c),a.enable&&"upload"===a.mode&&e('<div class="upload-info-btn remove-btn"/>').append(e('<i class="icon-trasho"/>')).appendTo(r),r},_renderEmpty:function(e){var t=this.$previewList.next(".upload-empty");t&&t.length?!e&&t.hide():e&&this.$previewList.after('<div class="upload-empty">'+this.options.noFileTip+"</div>")},_bindFileEvent:function(){var t=this,i=this.options;this.$previewList.unbind(".file-op"),this.$previewList.bind({"click.file-op":function(a){var s=a.target,n=a.type,o=e(s).closest(".upload-info-btn.remove-btn"),l=e(s).closest(".upload-info");if("upload"===i.mode&&o&&o.length>0){if("click"===n){var r=l.index();t.files.splice(r,1),l.remove(),FX.Utils.applyFunc(t,i.onFileRemove,[r],!1),FX.Utils.applyFunc(t,i.onStopEdit,[],!1)}}else i.hasPreview&&l&&l.length>0&&new FX.FilePreview({files:t.files,currentItem:l.index(),autoClose:!1})}}),this.$uploadInput.unbind("change.file-upload"),this.$uploadInput.bind("change.file-upload",function(){if(t.upFiles=this.files,!t.upFiles&&!FX.Utils.isFormDataSupported()){if(!this.value)return;t.upFiles=[{name:this.value.split("\\").pop(),size:this.size}]}i.maxFileCount===FX.CONST.UPLOAD_FILE_COUNT.SINGLE&&(t.files=[],t.$previewList.empty(),t.$subWrapper&&t.$subWrapper.empty()),t._checkUploadFiles(t.upFiles)?t.doUpload():t.upFiles=null})},_trimFileName:function(e){if(FX.Utils.isEmpty(e))return"";var t=e?e.split(".").pop():"";return e.length-t.length-1>20&&(e=(e=e.slice(0,19))+"..."+t),e},drawLocalPreview:function(t,i,a){var s=e("<canvas/>"),n=window.URL||window.webkitURL,o=s[0].getContext("2d"),l=new Image,r=n.createObjectURL(t);l.src=r;var d=2*i,c=2*a;return o.canvas.width=d,o.canvas.height=c,l.onload=function(){var e=l.width/d,t=l.height/c;e>t?o.drawImage(l,(l.width-d*t)/2,0,d*t,l.height,0,0,d,c):o.drawImage(l,0,(l.height-c*e)/2,l.width,c*e,0,0,d,c),n.revokeObjectURL(r)},s},_drawRemotePreview:function(t,i){var a=this.options,s=e("<img/>").hide(),n=e.extend({thumb:{mode:1,width:a.thumbWidth,height:a.thumbHeight}},t);if(t.thumbPcUrl)return s.attr("src",t.thumbPcUrl).show(),i(s);FX.Utils.getFileDownloadURL(n,function(e){return s.attr("src",e).show(),i(s)})},doUpload:function(){FX.FileUpload.superclass.doUpload.apply(this,arguments);var e=this.options;!this.upFiles||this.upFiles.length<=0||(this.$uploadBtn.hide(),e.hasProgress&&this.progress.setVisible(!0),FX.Utils.applyFunc(this,e.onBeforeUpload,[{files:null,up:0,total:0}],!1),this._setProgress(0,1))},_setProgress:function(e,t){if(this.options.hasProgress){var i=parseInt(e/t*100);i<100?this.progress.setMessage("正在上传..."):this.progress.setMessage("上传完成"),this.progress.setValue(i)}},onUpload:function(e,t){FX.FileUpload.superclass.onUpload.apply(this,arguments),FX.Utils.applyFunc(this,this.options.onUpload,[{files:null,up:e,total:t}],!1),this._setProgress(e,t)},onSuccess:function(){FX.FileUpload.superclass.onSuccess.apply(this,arguments);var e=this.options;FX.Utils.isCanvasSupported()?this._previewFiles(this.upFiles):this._previewFiles(),e.hasProgress&&this.progress.setVisible(!1),FX.Utils.applyFunc(this,e.onAfterUpload,[{files:this.files,up:0,total:0}],!1),FX.Utils.applyFunc(this,e.onStopEdit,[],!1),this.$uploadBtn.show()},onFail:function(e){FX.FileUpload.superclass.onFail.apply(this,arguments);var t=this.options;t.hasProgress&&this.progress.setVisible(!1),this.$uploadBtn.show(),FX.Utils.applyFunc(this,t.onUploadFail,[],!1)},doClear:function(){FX.FileUpload.superclass.doClear.apply(this,arguments),this.$previewList.empty()},setEnable:function(e){FX.FileUpload.superclass.setEnable.apply(this,[e]),e?this.element.removeClass("x-ui-disable"):this.element.addClass("x-ui-disable"),this.$previewList.empty(),this._previewFiles()},setValue:function(e){FX.FileUpload.superclass.setValue.apply(this,arguments),this.$previewList.empty(),e&&this._previewFiles()}}),e.shortcut("upload",FX.FileUpload)}(jQuery),jQuery,FX.ImageUpload=FX.extend(FX.FileUpload,{_defaultConfig:function(){return $.extend(FX.ImageUpload.superclass._defaultConfig.apply(),{baseCls:"fui_upload fui_image",fileType:["jpg","jpeg","png","gif"],iconCls:"icon-widget-image",btnText:"选择图片",maxCountTip:"最多允许选择{num}个图片",noFileTip:"当前没有图片上传",compressed:!1,onlyCamera:!1})},_createUploadBtn:function(){FX.ImageUpload.superclass._createUploadBtn.apply(this,arguments),this.options.onlyCamera&&$('<span class="upload-tip">启用了「仅允许拍照上传」功能，该功能只支持微信服务号/企业微信和钉钉移动客户端</span>').appendTo(this.element)},setEnable:function(e){FX.ImageUpload.superclass.setEnable.apply(this,[e]);var t=this.options;this.$uploadBtn&&this.$uploadInput&&(!t.onlyCamera&&e?(this.element.removeClass("x-ui-disable"),this.$uploadInput.removeAttr("disabled").removeAttr("readonly")):(this.element.addClass("x-ui-disable"),this.$uploadInput.attr("disabled","disabled").attr("readonly","readonly")))},getOptions:function(){var e=this.options;return $.extend(FX.ImageUpload.superclass.getOptions.apply(this,arguments),{compressed:e.compressed,onlyCamera:e.onlyCamera})}}),$.shortcut("image",FX.ImageUpload),function(e){FX.SubForm=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.SubForm.superclass._defaultConfig.apply(),{baseCls:"fui_subform",allowBlank:!0,ignoreOptAuth:!1,items:[],itemPadding:10,itemShowCount:10,maxItemCount:200,newItemText:"添加",noFieldText:"请添加字段",needEvent:!0,label:"",mode:"edit",onBeforeRowEdit:null,onBeforeWidgetCreate:null,onAfterWidgetCreate:null,rowHeadWidth:66,rowHeight:40,rowBottom:25,tipWidth:null,subform_create:!0,subform_edit:!0,subform_delete:!0})},_init:function(){FX.SubForm.superclass._init.apply(this,arguments),this.ps=null,this.rowIdx=0,this._createContent()},_createContent:function(){var t=this.options;if(!t.items.length)return this.$content=e('<div class="subform-none-tip"/>').text(t.noFieldText).appendTo(this.element),void(t.tipWidth&&this.$content.css("width",t.tipWidth));this._createHead(),this.$content=e('<div class="subform-content"/>').appendTo(this.element).css({"max-height":t.rowHeight*t.itemShowCount+t.rowHeight/2+t.rowBottom,"max-width":this.maxWidth}),this.$rowHead=e('<div class="fix-row-head"/>').appendTo(this.element),e('<div class="fix-col-head"/>').appendTo(this.element),this._allowCreate()&&!t.value&&this._createLine(null,!0),this.$btnPane=e('<div class="btn-pane"/>').appendTo(this.element),"edit"===t.mode&&this._allowCreate()&&this._createAddBtn(),this._bindEvent()},_createAddBtn:function(){var t=this.options,i=this;this.addBtn=new FX.Button({renderEl:e('<div class="btn-add"/>').appendTo(this.$btnPane),style:"none",iconCls:"icon-add",text:t.newItemText,enable:this._allowCreate(),onClick:function(){i._allowCreate()&&t.needEvent&&(i._createLine(null,!0),i._checkItemLimit(),i.$content[0].scrollTop=i.$content[0].scrollHeight,FX.Utils.applyFunc(i,t.onStopEdit,[],!1))}})},_createHead:function(){var t=this,i=this.options,a=e('<div class="subform-head"/>').appendTo(this.element),s=e('<div class="subform-row"><div class="row-head"/></div>').appendTo(a),n=0;n+=i.rowHeadWidth,FX.Utils.forEach(i.items,function(a,o){var l=e('<div class="subform-cell"/>'),r=0;switch(o.widget.type){case"linkquery":case"linkdata":var d=t._getLinkFieldConfig(o.widget);r=d.width,l.append(d.linkField).append(e('<span class="form-cell"/>').text(o.label));break;default:l.append(e('<span class="form-cell"/>').text(o.label)),!1===o.widget.allowBlank&&l.append(e('<span class="label-notnull">*</span>')),r+=t.getWidgetWidth(o.widget)+i.itemPadding}l.css({left:n,width:r}).appendTo(s),i.ignoreOptAuth||!1!==o.widget.visible?n+=r:l.addClass("x-ui-hidden")}),this.maxWidth=n+2,this.$head=a.css("max-width",this.maxWidth)},_createLine:function(t,i){var a=this.options,s=this;if(0!==a.items.length){var n=e('<div class="subform-row"/>').appendTo(this.$content).data({editable:i,"row-idx":this.rowIdx}).attr("row-idx",this.rowIdx);this.rowIdx++;var o=0;o+=a.rowHeadWidth,FX.Utils.forEach(a.items,function(l,r){var d=s.getWidgetWidth(r.widget),c=e.extend(!0,{},r.widget);switch(a.ignoreOptAuth?(c.enable=!0,c.visible=!0):s._allowEdit()||i||(c.enable=!1),c.type){case"location":e.extend(c,{locationText:"移动端获取当前位置",hasBrief:!1,btnWidth:"100%",btnHeight:36,isValueVisible:!1});break;case"linkdata":case"linkquery":d=s._getLinkFieldWidth(c)}var u=d+a.itemPadding,h="subform-cell";!1===c.visible&&(h+=" x-ui-hidden");var p=e('<div class="'+h+'"/>').css({left:o,width:u}).attr("namecol",c.widgetName).appendTo(n);!1!==c.visible&&(o+=u);var f=new FX.SubformItem({renderEl:e("<div/>").appendTo(p),subform:a.widgetName,widget:e.extend(FX.FormUtils.getWidgetDefaultConfig(c.type),c,{width:d}),onBeforeWidgetCreate:function(e){FX.Utils.applyFunc(this,a.onBeforeWidgetCreate,[e,t],!1)}});if(FX.Utils.applyFunc(s,a.onAfterWidgetCreate,[f],!1),t){var m=t[f.getWidgetName()];FX.Utils.isNull(m)||(m.hasOwnProperty("widgetType")?f.setValue(m.data):f.setValue(m))}p.data("widget",f)}),n.append(e('<div class="row-head" style="left: '+this.$content[0].scrollLeft+'px;"><i class="head-icon icon-expand" role="edit"/><i class="head-icon icon-remove" role="delete"/></div>')).css({width:o}),e('<div class="row-head"><div class="row-num">'+this.rowIdx+'</div><i class="head-icon icon-expand" role="edit"/><i class="head-icon icon-remove '+(this._allowDelete()||i?"":"invisible")+'" role="delete"/></div>').appendTo(this.$rowHead).attr("row-idx",this.rowIdx-1),n.hover(function(){var t=e(this).data("row-idx");s.$rowHead.children('.row-head[row-idx="'+t+'"]').addClass("edit")},function(){var t=e(this).data("row-idx");s.$rowHead.children('.row-head[row-idx="'+t+'"]').removeClass("edit")})}},_getLinkFieldConfig:function(e){var t=this.options,i=this,a="",s=0;return FX.Utils.forEach(e.linkFields,function(t,n){var o=i.getWidgetWidth(n);a+='<div class="sub-link-title sub-'+e.type+'" style="width:'+o+'px;">'+FX.Utils.escapeHtmlSpecialChar(n.text)+"</div>",s+=o+4}),s+=t.itemPadding-4,"linkdata"===e.type&&(s+=35),s=Math.max(s,i.getWidgetWidth({type:e.type})+t.itemPadding),{linkField:a,width:s}},_getLinkFieldWidth:function(e){var t=this,i=-4;return FX.Utils.forEach(e.linkFields,function(e,a){var s=t.getWidgetWidth(a);i+=s+4}),"linkdata"===e.type&&(i+=35),Math.max(i,t.getWidgetWidth({type:e.type}))},_checkItemLimit:function(){var e=this.options;e.maxItemCount&&this.addBtn&&(this.rowIdx>e.maxItemCount&&FX.Msg.toast({type:"warning",msg:"子表单数据量已超过200条最大限制"}),this.addBtn.setEnable(this._allowCreate()&&this.rowIdx<e.maxItemCount)),this.doResize()},setEnable:function(e){if(this.options.enable=!!e,this.$rowHead){var t=this.$rowHead.find(".row-head > icon-remove");t.length>0&&(this._allowDelete()?t.removeClass("invisible"):t.addClass("invisible"))}this.addBtn&&this.addBtn.setEnable(this._allowCreate())},_allowCreate:function(){var e=this.options;return e.ignoreOptAuth||e.enable&&e.subform_create},_allowEdit:function(){var e=this.options;return e.ignoreOptAuth||e.enable&&e.subform_edit},_allowDelete:function(){var e=this.options;return e.ignoreOptAuth||e.enable&&e.subform_delete},getOptions:function(){var t=this.options,i=this;if(this.$content){var a=this.$content.children(".subform-row").eq(0);if(a.length>0){var s=[],n=a.children(".subform-cell");FX.Utils.forEach(n,function(t,a){var n=e(a).data("widget");n&&s.push({label:i.$head.find(".subform-cell").eq(t).children(".form-cell").text(),widget:n.getOptions()})}),t.items=s}}return e.extend(FX.SubForm.superclass.getOptions.apply(this,arguments),{items:t.items,subform_create:t.subform_create,subform_edit:t.subform_edit,subform_delete:t.subform_delete})},getWidgetByName:function(t,i){var a=[];return FX.Utils.forEach(this.$content.find('.subform-cell[namecol="'+t+'"]'),function(t,i){var s=e(i).data("widget");s&&a.push(s)}),FX.Utils.isNull(i)?a:a[i]},getWidgetWidth:function(e){return FX.Utils.getSubformWidgetWidth(e)},getEditWidgetSize:function(e){var t={width:420,height:null};switch(e.type){case"textarea":t.height=140;break;case"address":t.width4province=200,t.width4city=105,t.width4district=105;break;case"text":case"number":case"combo":case"combocheck":case"datetime":t.height=30}return t},getValue:function(){var t=[];return this.$content.find(".subform-row").each(function(i,a){var s={},n=!0;e(a).find(".subform-cell").each(function(t,i){var a=e(i).data("widget");if(a&&FX.Utils.isValueWidget(a.getWidgetType())){var o=a.getValue();n=FX.Utils.isObjectEmpty(o)&&n,s[a.getWidgetName()]={data:o,widgetType:a.getWidgetType()}}}),n||t.push(s)}),t},_rebuildRowHead:function(){var t=this;this.$rowHead.empty(),FX.Utils.forEach(this.$content.children(".subform-row"),function(i,a){e(a).data({"row-idx":i}).attr("row-idx",i);var s=e(a).data("editable");e('<div class="row-head"><div class="row-num">'+(i+1)+'</div><i class="head-icon icon-expand" role="edit"/><i class="head-icon icon-remove '+(t._allowDelete()||s?"":"invisible")+'" role="delete"/></div>').appendTo(t.$rowHead).attr("row-idx",i)})},_clearContent:function(){this.$content&&this.$content.find(".subform-row").remove(),this.$rowHead&&this.$rowHead.empty(),this.rowIdx=0},_bindEvent:function(){var t=this;this.options.needEvent?(this.element.on("mouseenter",function(){t.ps?t.ps.update():t.ps=new PerfectScrollbar(t.$content[0])}),this.$content&&this.$content.on("click",".subform-row",function(i){var a=e(i.currentTarget),s=e(i.target).closest(".head-icon");t._dealBtnAction(a,s)}),this.$content[0].addEventListener("ps-scroll-x",function(){var i=e(this).scrollLeft();t.$head.children(".subform-row").css({left:-i}),t.$content.find(".row-head").css({left:i})}),this.$content[0].addEventListener("ps-scroll-y",function(){t.$rowHead.css({top:-e(this).scrollTop()})}),this.$rowHead.on("mouseenter",".row-head",function(t){e(t.currentTarget).addClass("edit")}).on("mouseleave",".row-head",function(t){e(t.currentTarget).removeClass("edit")}).on("click",".row-head",function(i){var a=e(i.currentTarget).attr("row-idx"),s=t.$content.children('.subform-row[row-idx="'+a+'"]'),n=e(i.target).closest(".head-icon");t._dealBtnAction(s,n)})):this.element.addClass("no-event")},_dealBtnAction:function(e,t){var i=e.data("editable");switch(t.attr("role")){case"delete":if(!this._allowDelete()&&!i)break;this._deleteRowConfirm(e,t);break;case"edit":FX.Utils.dt(FX.CONST.TRACKER.SUBFORM_EXPAND),this._createRowEditor(e)}},_deleteRowConfirm:function(t,i){var a=this;if(this._isRowEmpty(t))this._deleteRow(t);else{t.addClass("select");var s=a.$rowHead.children(".edit").addClass("select");FX.Msg.bubble({anchor:i,contentHTML:e('<div style="max-width:210px"/>').text("该条记录存在数据，数据删除后将无法恢复，确定删除？"),type:"error",text4Ok:"删除",onOk:function(){a._deleteRow(t)},onClose:function(){return t.removeClass("select"),s.removeClass("select"),!1}})}},_isRowEmpty:function(t){var i=!0;return FX.Utils.forEach(e(".subform-cell",t),function(t,a){var s=e(a).data("widget");if(s&&s.isVisible())return FX.Utils.isObjectEmpty(s.getValue())?void 0:(i=!1,!1)}),i},_deleteRow:function(e){var t=this.options;e.remove(),this.rowIdx--,this._checkItemLimit(),this._rebuildRowHead(),FX.Utils.applyFunc(this,t.onStopEdit,[],!1)},_createRowEditor:function(t){var i=this,a=this.options,s=FX.Utils.applyFunc(this,a.onBeforeRowEdit,[],!1);s||(s=e("<div/>").appendTo(e("body")));var n=t.data("row-idx"),o={};t.find(".subform-cell").each(function(t,i){var a=e(i).data("widget");a&&(o[a.getWidgetName()]=a)});var l=e('<div class="subform-row-editor">').appendTo(s).css({"z-index":FX.STATIC.zIndex++}),r=e('<div class="edit-content"><div class="row-title"><span class="label">'+a.label+'</span><i class="close-btn icon-contract"/></div></div>').appendTo(l).on("click",".close-btn",function(){FX.Utils.forEach(o,function(e,t){t.unbindWidgetEvent("onRelyDone")}),l.addClass("close"),setTimeout(function(){s.remove()},300)}),d=e('<div class="subform-row"/>').appendTo(r).data("row-idx",n);FX.Utils.forEach(a.items,function(t,a){var s=o[a.widget.widgetName];if(s){var n=e('<div class="subform-cell"/>').appendTo(d),l=s.getOptions(),r=s.getCacheValue(),c=e.extend(!0,{},a.widget,{subform:null,enable:l.enable,visible:l.visible,limit:l.limit,onStopEdit:function(){s.setCacheValue(this.getCacheValue()),s.effectStopEdit()},onBeforeAsync:function(){s.effectBeforeAsync(),this.options.async=s.getOptions().async}},i.getEditWidgetSize(a.widget));FX.LimitFields.userDept.indexOf(c.type)>-1&&(c.onBeforeEdit=function(e){!1===FX.Utils.applyFunc(s.field,s.field.options.onBeforeEdit,[function(){u.setOptions({limit:s.getOptions().limit}),e&&e()}],!1)&&(u.setOptions({limit:s.getOptions().limit}),e&&e())});var u=new FX.FormItem({renderEl:n,label:a.label,widget:c});u.setCacheValue(r),s.bindWidgetEvent("onRelyDone",function(e){switch(e.getWidgetType()){case"combo":case"combocheck":u.rebuild();break;case"dept":case"deptgroup":u.clearLimit();break;default:u.setCacheValue(e.getCacheValue())}}),n.attr("namecol",s.getWidgetName()),n.data("widget",s)}})},getCacheValue:function(){var t=[];return this.$content.find(".subform-row").each(function(i,a){var s={},n=!0;e(a).find(".subform-cell").each(function(t,i){var a=e(i).data("widget");if(!(FX.LimitFields.noCache.indexOf(a.getWidgetType())>-1)){var o=a.getCacheValue();n=FX.Utils.isObjectEmpty(o)&&n,s[a.getWidgetName()]={data:o,widgetType:a.getWidgetType()}}}),s.editable=e(a).data("editable"),n||t.push(s)}),t},setCacheValue:function(e){var t=this;this._clearContent(),FX.Utils.forEach(e,function(e,i){t._createLine(i,i.editable)}),this._checkItemLimit()},getText:function(){var t=[];return this.$content.find(".subform-row").each(function(i,a){var s={},n=!0;e(a).find(".subform-cell").each(function(t,i){var a=e(i).data("widget"),o=a.getText();n=FX.Utils.isObjectEmpty(o)&&n,"linkdata"===a.getWidgetType()?e.extend(s,o):s[a.getWidgetName()]=o}),n||t.push(s)}),t},setValue:function(e){var t=this;this._clearContent(),FX.Utils.forEach(e,function(e,i){t._createLine(i)}),this._checkItemLimit()},checkValidate:function(){var t=this.options,i=[],a=!0;return this.$content&&this.$content.find(".subform-row").each(function(t,s){var n={},o=!0,l=!0;e(s).find(".subform-cell").each(function(t,i){var a=e(i).data("widget");if(a&&a.isVisible()){l=a.checkValidate()&&l;var s=a.getValue();o=FX.Utils.isObjectEmpty(s)&&o,n[a.getWidgetName()]={data:s,widgetType:a.getWidgetType()}}}),o?l=!0:i.push(n),a=l&&a}),!(!t.allowBlank&&i.length<=0)&&(a||this.setInvalidateType("regex"),a)},getNullValue:function(){return[]},doResize:function(){this.ps&&this.ps.update(),this.$btnPane&&(this.rowIdx>0?this.$btnPane.removeClass("no-border"):this.$btnPane.addClass("no-border"),this.$btnPane.css({"max-width":this.maxWidth}))}}),e.shortcut("subform",FX.SubForm)}(jQuery),function(e){FX.Separator=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Separator.superclass._defaultConfig.apply(),{baseCls:"fui_separator",allowBlank:!0,lineStyle:FX.CONST.SEP_LINE_STYLE.THIN})},_init:function(){FX.Separator.superclass._init.apply(this,arguments);var t=this.options;e('<div class="sep-line '+t.lineStyle+'"/>').appendTo(this.element),this.$description=e('<div class="x-subhtml"/>').appendTo(this.element)},setValue:function(e){FX.Separator.superclass.setValue.apply(this,arguments),this.$description.empty(),FX.Utils.isEmpty(e)||this.$description.append(e)},getOptions:function(){var t=this.options;return e.extend(FX.Separator.superclass.getOptions.apply(this,arguments),{lineStyle:t.lineStyle})}}),e.shortcut("separator",FX.Separator)}(jQuery),function(e){FX.User=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.User.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_user",title:"成员列表",msg:"点击选择成员",width:240,height:40,value:null,allowBlank:!0,noRepeat:!1,editable:!1,count:100,limit:{},dynamicFields:[{id:FX.USER_ID.CurrentUser,name:"当前用户",type:"dynamic"}],dynamicKey:FX.USER_ID.CurrentUser,dynamicType:"select",onStopEdit:null,onBeforeEdit:null})},_init:function(){FX.User.superclass._init.apply(this,arguments);var e=this.options;e.limit=e.limit||{},this.selectMap={},this._initSelectPane()},_initData:function(){if(!FX.Utils.isExternalLink()){var e=this.options;e.items&&(this.items=e.items),this._initSelectPane()}},_initSelectPane:function(){if(FX.Utils.isExternalLink())return this.element.empty(),void e('<div class="nonsupport-msg"/>').text("外链不支持成员字段").appendTo(this.element);var t=this,i=this.options;this.selectMap={},FX.Utils.forEach(this.items,function(e,i){t.selectMap[i.id]=i}),this._createSelectList(),i.editable?this._createSelectPane():this._bindEditEvent()},_bindEditEvent:function(){var e=this,t=this.options;this.$selectList.unbind("click"),this.$selectList.bind("click",function(){if(e.isEnabled()){FX.Utils.applyFunc(e,t.onBeforeEdit,[],!1);var i=new FX.ConfirmDialog({title:t.title,width:610,contentWidget:{rowSize:[440],colSize:[570],items:[[{widgetName:t.widgetName,type:t.type,editable:!0,limit:t.limit,limitWidget:t.limitWidget,items:e.items,value:e.value}]]},onOk:function(){var a=i.getWidgetByName(t.widgetName);return e.value=a.getValue(),e.items=a.getItems(),e._initSelectPane(),FX.Utils.applyFunc(e,t.onStopEdit,[],!1),!1}});i.show()}})},_createSelectList:function(){var t=this,i=this.options;if(this.$selectList?this.$selectList.empty():this.$selectList=e('<ul class="select-list"/>').appendTo(this.element),this.value){var a=t.selectMap[this.value];t._createSelectItem(a)}else i.editable||this.$selectList.append(e('<div class="select-empty"/>').text(i.msg))},_setSelectItem:function(e){this.$selectList.empty(),this._createSelectItem(e),this.value=e.id,this.selectMap[e.id]=e,this.refresh()},_clearSelectItem:function(){this.$selectList.empty(),this.value=null,this.refresh()},_createSelectItem:function(t){var i=this.options,a=this;if(t){var s=e('<li class="select-item"/>').append(e("<span/>").text(t.name)).appendTo(this.$selectList).attr("id",t.id).data("item",t);s.prepend(e('<i class="select-icon icon-member-normal"/>')),i.editable&&e('<span class="remove-btn"/>').append(e('<i class="icon-close-normal"/>')).click(function(){a._clearSelectItem()}).appendTo(s)}},_createSelectPane:function(){if(!this.$selectPane){var t=this.options,i=this,a=e('<div class="select-menu"/>').on("click",".select-btn",function(t){var a=e(t.currentTarget);i._switchTab(a.attr("role"))}).appendTo(this.element);this.$selectPane=e('<div class="select-pane"/>').appendTo(this.element),this._hasType("organization")&&e('<div class="select-btn"/>').attr("role","organization").text("组织架构").appendTo(a),this._hasType("role")&&e('<div class="select-btn"/>').attr("role","role").text("角色").appendTo(a),this._hasType("member")&&e('<div class="select-btn"/>').attr("role","member").text("成员").appendTo(a),this._hasType("dynamic")&&("set"===t.dynamicType?e('<div class="select-btn"/>').attr("role","dynamic").text("动态参数").appendTo(a):e('<div class="select-btn"/>').attr("role","curUser").text("当前用户").appendTo(a)),e('<i class="icon-search"/>').appendTo(a).on("click",function(){return e(".search-info").hide(),e(".search-input").show(),e("input",a).val("").focus(),e(document).on("click.search",function(t){var a=t.target;0===e(a).closest(".search-input").length&&(e(".search-info").show(),e(".search-input").hide(),e(document).off("click.search"),0===e(a).closest(".search-list li").length&&i._switchOriginTab())}),!1});var s=e("<input />").on("input propertychange",function(){i.searchInterval&&clearTimeout(i.searchInterval),i.searchInterval=setTimeout(function(){i.$searchList&&(i.$searchList.remove(),i.$searchList=null),i._createSearchList(s.val())},500)});a.append(e('<div class="search-input"/>').append(s).append(e('<i class="icon-search"/>'))),i._switchTab()}},_switchTab:function(t){if(t||(t=this.types[0]),e('.select-menu [role="'+t+'"]',this.element).addClass("select").siblings().removeClass("select"),this._isRelyLimitEmpty()){var i=e(".tip-empty",this.$selectPane);i.length?i.show():e('<span class="tip-empty"/>').text("没有可选成员").appendTo(this.$selectPane)}else switch(t){case"organization":this._createOrganizationPane();break;case"role":this._createRolePane();break;case"member":this._createMemberPane();break;case"dynamic":this._createDynamicPane();break;case"curUser":this._createCurrentUserPane()}},_switchOriginTab:function(){var t=e(".select-menu .select-btn.select");this._switchTab(t.attr("role"))},_isRelyLimitEmpty:function(){var e=this.options;return FX.Utils.isObjectEmpty(e.limit)&&!FX.Utils.isObjectEmpty(e.limitWidget)},_initLimitMap:function(e){var t=this.options,i=this,a={};FX.Utils.forEach(e,function(e,t){a[t._id]=t}),this.limitMap={},FX.Utils.forEach(t.limit,function(e,t){var s=a[t];s&&s.departmentId&&(i.limitMap[s.departmentId]=!0)})},_createOrganizationPane:function(){var t=this;this.options;this.$selectPane.children().hide(),this.$organizationPane?this.$organizationPane.show():this.$organizationPane=e('<div class="organization-pane"/>').appendTo(this.$selectPane),this._createMemberMenu().appendTo(this.$organizationPane),t._createOrganizationUserList()},_createOrganizationUserList:function(t){t=t||0;var i=this,a=this.options;FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.user_dept_role),data:{departmentLimit:a.limit.departs,departmentId:i._getDepartmentId(),limit:a.count,skip:t}},function(s){var n;0===t?(e(".user-list",i.$organizationPane).remove(),n=i._createUserList(s.users).appendTo(i.$organizationPane)):(n=e(".user-list",i.$organizationPane),FX.Utils.forEach(s.users,function(e,t){i._createUserItem(t).appendTo(n)})),s.users.length===a.count&&i._createLoadMoreBtn(t+s.users.length,i._createOrganizationUserList).appendTo(n)})},_createMemberMenu:function(){var t=this,i=this.options;return this.$memberMenu?(this.$memberMenu.show(),this.$memberMenu):(this.$memberMenu=e('<div class="member-menu"/>'),FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.departments),data:{departmentLimit:i.limit.departs}},function(i){t.memberTree=new FX.Tree({renderEl:e("<div/>").appendTo(t.$memberMenu),customCls:"x-department-tree select-department",Nodes:i.departments,setting:{view:{expandSpeed:100},data:{simpleData:{enable:!0,idKey:"departmentId",pIdKey:"parentId"}},callback:{onNodeCreated:function(e,t){t.isParent&&!t.open&&t.level<1&&this.expandNode(t,!0)},onClick:function(e,i){t.currentDepartment=i.departmentId,t._createOrganizationUserList()}}}})}),this.$memberMenu)},_createRolePane:function(){var t=this,i=this.options;this.$selectPane.children().hide(),this.$rolePane?this.$rolePane.show():(this.$rolePane=e('<div class="role-pane"/>').appendTo(this.$selectPane),FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.roles),data:{roleLimit:i.limit.roles}},function(e){FX.Utils.isObjectEmpty(e.roles)||(t.curRole=e.roles[0].role_id,t._createRoleList(e.roles).appendTo(t.$rolePane),t._createRoleUserList())}))},_createRoleList:function(t){var i=this,a=(this.options,e('<ul class="role-list"/>'));return FX.Utils.forEach(t,function(t,s){var n=e('<li class="role-item"/>').append(e("<span />").text(s.name)).data("role",s.role_id).appendTo(a);s.role_id===i.curRole&&n.addClass("select")}),a.on("click",".role-item",function(t){var a=e(t.currentTarget);a.addClass("select").siblings().removeClass("select");var s=a.data("role");s!==i.curRole&&(i.curRole=s,i._createRoleUserList())}),a},_createRoleUserList:function(t){t=t||0;var i=this,a=this.options;FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.user_dept_role),data:{roleId:this.curRole,roleLimit:a.limit.roles,limit:a.count,skip:t}},function(s){var n;0===t?(e(".user-list",i.$rolePane).remove(),n=i._createUserList(s.users).appendTo(i.$rolePane)):(n=e(".user-list",i.$rolePane),FX.Utils.forEach(s.users,function(e,t){i._createUserItem(t).appendTo(n)})),s.users.length===a.count&&i._createLoadMoreBtn(t+s.users.length,i._createRoleUserList).appendTo(n)})},_createMemberPane:function(){var t=this;this.options;this.$selectPane.children().hide(),this.$memberPane?this.$memberPane.show():(this.$memberPane=e('<div class="member-pane"/>').appendTo(this.$selectPane),t._createMemberUserList())},_createMemberUserList:function(t){t=t||0;var i=this,a=this.options;FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.users),data:{departmentLimit:a.limit.departs,roleLimit:a.limit.roles,userLimit:a.limit.users,hasCurrentUser:a.limit.hasCurrentUser,limit:a.count,skip:t}},function(s){var n;0===t?(e(".user-list",i.$memberPane).remove(),n=i._createUserList(s.users).appendTo(i.$memberPane)):(n=e(".user-list",i.$memberPane),FX.Utils.forEach(s.users,function(e,t){i._createUserItem(t).appendTo(n)}),s.users.length===a.count&&i._createLoadMoreBtn(t+s.users.length,i._createMemberUserList).appendTo(n))})},_createLoadMoreBtn:function(t,i){var a=this;return e('<div class="load-more"/>').text("点击加载更多...").click(function(s){e(s.currentTarget).remove(),FX.Utils.applyFunc(a,i,[t],!1)})},_getSelectItem:function(e){return{id:e._id||e.id,name:e.nickname||e.name}},_getDynamicFields:function(){return this.options.dynamicFields},_createCurrentUserPane:function(){if(this.$selectPane.children().hide(),this.$currentUserPane)this.$currentUserPane.show();else{this.$currentUserPane=e('<div class="current-pane"/>').appendTo(this.$selectPane);var t=[{_id:FX.STATIC.user._id,nickname:FX.STATIC.user.nickname}];this._createUserList(t).appendTo(this.$currentUserPane)}},_createDynamicPane:function(){this.$selectPane.children().hide(),this.$dynamicPane?this.$dynamicPane.show():(this.$dynamicPane=e('<div class="dynamic-pane"/>').appendTo(this.$selectPane),this._createUserList(this._getDynamicFields()).appendTo(this.$dynamicPane))},_createSearchList:function(t){var i=this.options,a=this;if(!this._isRelyLimitEmpty()){this.$selectPane.children().hide(),this.$searchList?this.$selectList.empty():this.$searchList=e('<div class="select-search"/>').appendTo(this.$selectPane);var s=this.$searchList;FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.users),data:{departmentLimit:i.limit.departs,roleLimit:i.limit.roles,userLimit:i.limit.users,hasCurrentUser:i.limit.hasCurrentUser,keyword:t,limit:i.count}},function(t){var i=t.users||[];if(i.length<=0)s.append(e('<span class="search-empty"/>').text("暂无相关成员"));else{var n=e('<ul class="search-list"/>').appendTo(s);FX.Utils.forEach(i,function(t,i){var s=a._getSelectItem(i);e("<li/>").appendTo(n).text(i.nickname).data("user",s)})}}),s.bind("click",function(t){var i=t.target,s=e(i).closest("li"),n=s.data("user");s.length>0&&n&&(a._switchOriginTab(),a._setSelectItem(n))})}},_getDepartmentId:function(){return FX.Utils.isEmpty(this.currentDepartment)&&(this.currentDepartment=1),this.currentDepartment},getItems:function(){var t=[];return e(".select-item",this.$selectList).each(function(i,a){t.push(e(a).data("item"))}),t},setValue:function(e){var t=this.options;e=FX.FormItemUtils.dealCurrentUser(e,t.dynamicType),this.value=FX.FormItemUtils.parseUserDeptDefaultValue(e),e&&(this.items=this._getDynamicFields().concat([{id:e._id,name:e.nickname||e.name}])),this._initData()},getValue:function(){return this.value},getCacheValue:function(){var e=this.selectMap[this.value];return e?{_id:e.id,name:e.name}:null},getText:function(){return this.value&&this.selectMap[this.value]?this.selectMap[this.value].name:""},refresh:function(){var t=this;e(".user-item",this.$selectPane).each(function(i,a){var s=e(a).data("user");if(s){var n=e(a).children(".select-btn");t.value===s.id?n.addClass("select"):n.removeClass("select")}})},checkValidate:function(){if(FX.Utils.isExternalLink())return this.setInvalidateType("regex"),!1;var e=this.options;return!FX.Utils.isEmpty(this.getValue())||e.allowBlank},rebuild:function(e){this.setValue(e),this.refresh()},getOptions:function(t){var i=this.options;return e.extend(FX.User.superclass.getOptions.apply(this,arguments),{noRepeat:i.noRepeat,limit:i.limit,limitWidget:i.limitWidget,value:"save"===t?FX.FormItemUtils.parseUserDeptDefaultValue(i.value):i.value,valueOption:i.valueOption})},_createUserList:function(t){var i=this,a=e('<ul class="user-list"/>');return t.length?(FX.Utils.forEach(t,function(e,t){i._createUserItem(t).appendTo(a)}),a.on("click",".user-item",function(t){var s=e(t.currentTarget),n=e(".select-btn",s);n.hasClass("select")?(n.removeClass("select"),i._clearSelectItem()):(e(".select",a).removeClass("select"),n.addClass("select"),i._setSelectItem(s.data("user")))}),a):(e('<span class="tip-empty"/>').text("没有可选成员").appendTo(a),a)},_createUserItem:function(t){var i=this._getSelectItem(t),a=e('<li class="user-item"/>').append(e("<span />").text(i.name)).append(e('<div class="select-btn x-radio"/>').append('<i class="icon-blank"/>')).data("user",i);return this.value===i.id&&a.children(".select-btn").addClass("select"),a},_hasType:function(e){var t=this.options;return this.types||(this.types=[],FX.Utils.isObjectEmpty(t.limit)?this.types=["organization","member","dynamic"]:(FX.Utils.isObjectEmpty(t.limit.departs)||this.types.push("organization"),FX.Utils.isObjectEmpty(t.limit.roles)||this.types.push("role"),this.types.push("member"),t.limit.hasCurrentUser&&this.types.push("dynamic"))),this.types.indexOf(e)>-1}}),e.shortcut("user",FX.User)}(jQuery),function(e){FX.UserGroup=FX.extend(FX.User,{_defaultConfig:function(){return e.extend(FX.UserGroup.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_user fui_user_group ",title:"成员列表",msg:"点击选择成员",width:420,height:80,value:[],onStopEdit:null})},_init:function(){this.value=[],FX.UserGroup.superclass._init.apply(this,arguments)},_initData:function(){if(!FX.Utils.isExternalLink()){var e=this.options;this.selectMap={},e.items&&(this.items=e.items),this._initSelectPane()}},_createSelectList:function(){var t=this,i=this.options;this.$selectList?this.$selectList.empty():this.$selectList=e('<ul class="select-list"/>').appendTo(this.element),this.value&&this.value.length>0?FX.Utils.forEach(this.value,function(e,i){var a=t.selectMap[i];t._createSelectItem(a)}):i.editable||this.$selectList.append(e('<div class="select-empty"/>').text(i.msg))},_addSelectItem:function(e){this.options;this.value.indexOf(e.id)>-1||(this._createSelectItem(e),this.value=this.getValue(),this.selectMap[e.id]=e,this.refresh())},_setSelectItem:function(e){this._addSelectItem(e)},_removeSelectItem:function(t){this.options;e("#"+t.id,this.$selectList).remove(),this.value=this.getValue(),this.refresh()},_createSelectItem:function(t){var i=this.options,a=this;if(t){var s=e('<li class="select-item"/>').append(e("<span/>").text(t.name)).appendTo(this.$selectList).attr("id",t.id).data("item",t);s.prepend(e('<i class="select-icon icon-member-normal"/>')),i.editable&&e('<span class="remove-btn"/>').append(e('<i class="icon-close-normal"/>')).click(function(){a._removeSelectItem(t),a.refresh()}).appendTo(s)}},_createUserList:function(t){var i=this,a=e('<ul class="user-list"/>');return t.length?(FX.Utils.forEach(t,function(e,t){i._createUserItem(t).appendTo(a)}),a.on("click",".user-item",function(t){var a=e(t.currentTarget),s=e(".select-btn",a);s.hasClass("select")?(s.removeClass("select"),i._removeSelectItem(a.data("user"))):(s.addClass("select"),i._addSelectItem(a.data("user")))}),a):(e('<span class="tip-empty"/>').text("没有可选成员").appendTo(a),a)},_createUserItem:function(t){var i=this._getSelectItem(t),a=e('<li class="user-item"/>').data("user",i).append(e("<span/>").text(i.name)).append(e('<div class="select-btn x-check"/>').append(e('<i class="icon-blank"/>')));return this.value.indexOf(i.id)>-1&&a.children(".select-btn").addClass("select"),a},checkValidate:function(){return FX.Utils.isExternalLink()?(this.setInvalidateType("regex"),!1):!(!this.options.allowBlank&&0===this.getValue().length)},setValue:function(e){var t=this,i=this.options;this.value=[],this.items=[].concat(this._getDynamicFields());var a={};FX.Utils.forEach(e,function(e,s){(s=FX.FormItemUtils.dealCurrentUser(s,i.dynamicType))&&(s._id?a[s._id]||(a[s._id]=!0,t.value.push(s._id),t.items.push({id:s._id,name:s.nickname||s.name})):a[s]||(a[s]=!0,t.value.push(s)))}),this._initData()},getValue:function(){this.options;var t=this.value;return this.$selectList&&(t=[],e(".select-item",this.$selectList).each(function(i,a){t.push(e(a).attr("id"))})),t},getCacheValue:function(){var e=this,t=[];return FX.Utils.forEach(this.getValue(),function(i,a){var s=e.selectMap[a];t.push({_id:s.id,name:s.name})}),t},getText:function(){var e=this,t=[];return FX.Utils.forEach(this.value,function(i,a){e.selectMap[a]&&t.push(e.selectMap[a].name)}),t},getNullValue:function(){return[]},refresh:function(){var t=this;e(".user-item",this.$selectPane).each(function(i,a){var s=e(a).data("user");if(s){var n=e(a).children(".select-btn");t.value.indexOf(s.id)>-1?n.addClass("select"):n.removeClass("select")}})},getOptions:function(t){var i=this.options;return e.extend(FX.User.superclass.getOptions.apply(this,arguments),{noRepeat:i.noRepeat,limit:i.limit,limitWidget:i.limitWidget,value:"save"===t?FX.FormItemUtils.parseUserDeptListDefaultValue(i.value):i.value,valueOption:i.valueOption})}}),e.shortcut("usergroup",FX.UserGroup)}(jQuery),function(e){FX.Dept=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Dept.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_dept",title:"部门列表",msg:"点击选择部门",width:240,height:40,value:null,allowBlank:!0,noRepeat:!1,editable:!1,count:100,limit:{},dynamicFields:[{_id:FX.CONST.DEPT_ID.CURRENT,name:"当前用户所处部门",type:"dynamic"}],dynamicKey:FX.CONST.DEPT_ID.CURRENT,dynamicType:"select",valueOption:FX.WidgetValueOption.CUSTOM,onBeforeEdit:null,onStopEdit:null})},_init:function(){FX.Dept.superclass._init.apply(this,arguments),this.selectMap={},this._initSelectPane()},_initData:function(){if(!FX.Utils.isExternalLink()){var e=this.options;e.items&&(this.items=e.items),this._initSelectPane()}},_initSelectPane:function(){if(FX.Utils.isExternalLink())return this.element.empty(),void e('<div class="nonsupport-msg"/>').text("外链不支持部门字段").appendTo(this.element);var t=this,i=this.options;this.selectMap={},FX.Utils.forEach(this.items,function(e,i){t.selectMap[i._id]=i}),this._createSelectList(),i.editable?(this._createSelectPane(),this._bindSelectEvent()):this._bindEditEvent()},_bindEditEvent:function(){var e=this,t=this.options;this.$selectList.unbind("click"),this.$selectList.bind("click",function(){e.isEnabled()&&!1===FX.Utils.applyFunc(e,t.onBeforeEdit,[function(){e._showEditDialog()}],!1)&&e._showEditDialog()})},_showEditDialog:function(){var e=this.options,t=this,i=new FX.ConfirmDialog({title:e.title,width:610,contentWidget:{rowSize:[440],colSize:[570],items:[[{widgetName:e.widgetName,type:e.type,editable:!0,limit:e.limit,rely:e.rely,items:t.items,value:t.value,valueOption:e.valueOption}]]},onOk:function(){var a=i.getWidgetByName(e.widgetName);return t.value=a.getValue(),t.items=a.getItems(),t._initSelectPane(),FX.Utils.applyFunc(t,e.onStopEdit,[],!1),!1}});i.show()},_createSelectList:function(){var t=this,i=this.options;if(this.$selectList?this.$selectList.empty():this.$selectList=e('<ul class="select-list"/>').appendTo(this.element),this.value){var a=t.selectMap[this.value];t._createSelectItem(a)}else i.editable||this.$selectList.append(e('<div class="select-empty"/>').text(i.msg))},_bindSelectEvent:function(){var t=this;this.$selectList.unbind("click"),this.$selectList.bind("click",function(i){var a=e(i.target).closest(".select-item").data("item");a&&e(i.target).closest(".remove-btn").length>0&&t._removeSelectItem(a)})},_addSelectItem:function(e){this.$selectList.empty(),this._createSelectItem(e),this.value=e._id,this.selectMap[e._id]=e,this.refresh()},_removeSelectItem:function(){this.$selectList.empty(),this.value=null,this.refresh()},_createSelectItem:function(t){var i=this.options;if(t){var a=e('<li class="select-item"/>').append(e("<span/>").text(t.name)).appendTo(this.$selectList).attr("id",t._id).data("item",t);a.prepend(e('<i class="select-icon icon-department"/>')),i.editable&&e('<span class="remove-btn"/>').append(e('<i class="icon-close-normal"/>')).appendTo(a)}},_createSelectPane:function(){if(!this.$selectPane){var t=this.options,i=this,a=e('<div class="select-menu"/>').appendTo(this.element);this.$selectPane=e('<div class="select-pane"/>').appendTo(this.element);var s=e('<div class="select-btn"/>').attr("role","depart").click(function(){e(".select-btn",a).removeClass("select"),e(this).addClass("select"),i._createDepartmentList()}).text("组织架构").appendTo(a);(FX.Utils.isObjectEmpty(t.limit)||t.limit.hasCurrentDept)&&("set"===t.dynamicType?(e('<div class="select-btn"/>').attr("role","dynamic").click(function(){e(".select-btn",a).removeClass("select"),e(this).addClass("select"),i._createDynamicList()}).text("动态参数").appendTo(a),this._createDynamicList()):e('<div class="select-btn"/>').attr("role","curDepart").click(function(){e(".select-btn",a).removeClass("select"),e(this).addClass("select"),i._createCurrentDepartmentList()}).text("当前用户所处部门").appendTo(a)),e('<i class="icon-search" />').appendTo(a).on("click",function(){return e(".search-info").hide(),e(".search-input").show(),e("input",a).val("").focus(),e(document).bind("click.search",function(t){var a=t.target;0===e(a).closest(".search-input").length&&(e(".search-info").show(),e(".search-input").hide(),e(document).unbind("click.search"),0===e(a).closest(".select-search li").length&&i._switchOriginTab())}),!1});var n=e("<input />").on("input propertychange",function(){i.searchInterval&&clearTimeout(i.searchInterval),i.searchInterval=setTimeout(function(){i.$searchList&&(i.$searchList.remove(),i.$searchList=null),i._createSearchList(n.val())})});a.append(e('<div class="search-input"/>').append(n).append(e('<i class="icon-search"/>'))),s.addClass("select"),this._createDepartmentList()}},_switchOriginTab:function(){switch(e(".select-menu .select-btn.select").attr("role")){case"depart":this._createDepartmentList();break;case"dynamic":this._createDynamicList();break;case"curDepart":this._createCurrentDepartmentList()}},_isRelyLimitEmpty:function(){var e=this.options;return FX.Utils.isObjectEmpty(e.limit)&&e.valueOption!==FX.WidgetValueOption.RELY&&!FX.Utils.isObjectEmpty(e.rely)},_initLimitMap:function(e){var t=this.options,i=this;if(!FX.Utils.isObjectEmpty(t.limit)){var a={};FX.Utils.forEach(e,function(e,t){a[t._id]=t}),this.limitMap={},FX.Utils.forEach(t.limit.departs,function(e,t){var s=a[t];s&&s.departmentId&&(i.limitMap[s.departmentId]=!0)}),FX.Utils.forEach(e,function(e,t){i.limitMap[t.departmentId]||FX.Utils.forEach(t.path,function(e,a){i.limitMap[a]&&(i.limitMap[t.departmentId]=!0)})})}},_doSelectItem:function(e){if(this._checkLimit(e)){var t={name:e.name,_id:e._id};this.value!==t._id?this._addSelectItem(t):this._removeSelectItem(t),this.departmentTree.refresh()}},_createDepartmentList:function(){var t=this,i=this.options;this._isRelyLimitEmpty()||(this.$selectPane.children().hide(),this.$memberMenu?this.$memberMenu.show():(this.$memberMenu=e('<div class="select-department"/>').appendTo(t.$selectPane),FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.departments),data:{departmentLimit:i.limit.departs,hasCurrentDept:i.limit.hasCurrentDept}},function(i){t.departments=e.extend(!0,[],i.departments),t.departments[0]&&!t.departments[0]._id&&t.departments.shift(),t._initLimitMap(t.departments),t.departmentTree=new FX.Tree({renderEl:e("<div/>").appendTo(t.$memberMenu),customCls:"x-department-tree select-department",Nodes:t.departments,setting:{view:{expandSpeed:100},data:{simpleData:{enable:!0,idKey:"departmentId",pIdKey:"parentId"}},callback:{onCheck:function(e,i){t._doSelectItem(i)},onClick:function(e,i){t._doSelectItem(i)},beforeNodeCreate:function(e){t._checkLimit(e)||(e.nocheck=!0),e.checked=e._id===t.value},onNodeCreated:function(e,i){i.isParent&&!i.open&&i.level<1&&this.expandNode(i,!0),i.departmentId==t.currentDepartment&&this.selectNode(i)}},check:{enable:!0,chkStyle:"x-radio",chkboxType:{Y:"",N:""}}}})})))},_checkLimit:function(e){var t=this.options;return!!e&&(!!FX.Utils.isObjectEmpty(t.limit)||this.limitMap[e.departmentId])},_getDynamicFields:function(){return this.options.dynamicFields},_createDepartmentItem:function(t){var i=this,a=e("<li/>").append(e('<i class="icon-department"/>')).append(e("<span/>").text(t.name)).append(e('<div class="select-btn x-radio"/>').append(e('<i class="icon-blank"/>'))).data("item",t).click(function(){var e=a.children(".select-btn");if(e.hasClass("select"))e.removeClass("select"),i._removeSelectItem();else{e.addClass("select");var t=a.data("item");i._addSelectItem(t)}});return this.value===t._id&&a.children(".select-btn").addClass("select"),a},_createCurrentDepartmentList:function(){var t=this;this._isRelyLimitEmpty()||(this.$selectPane.children().hide(),this.$currentDepartmentList?this.$currentDepartmentList.empty().show():this.$currentDepartmentList=e('<ul class="department-list"/>').appendTo(this.$selectPane),this.currentDepartments?FX.Utils.forEach(this.currentDepartments,function(e,i){t.$currentDepartmentList.append(t._createDepartmentItem(i))}):FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.current_departments)},function(e){t.currentDepartments=e.departmentList,t._createCurrentDepartmentList()}))},_createDynamicList:function(){var t=this;this.$selectPane.children().hide(),this.$dynamicList?this.$dynamicList.empty().show():this.$dynamicList=e('<ul class="department-list"/>').appendTo(this.$selectPane),FX.Utils.forEach(this._getDynamicFields(),function(e,i){t.$dynamicList.append(t._createDepartmentItem(i))})},_createSearchList:function(t){var i=this;if(!this._isRelyLimitEmpty()){this.$selectPane.children().hide();var a=[],s=e('<div class="select-search"/>').appendTo(this.$selectPane),n=new RegExp(FX.Utils.escapeRegexp(t),"i");FX.Utils.forEach(this.departments,function(e,t){n.test(t.name)&&a.push(t)}),a.length<=0?s.append(e('<span class="search-empty"/>').text("暂无相关部门")):(this.$searchList=e('<ul class="department-list"/>').appendTo(s),FX.Utils.forEach(a,function(t,a){i._checkLimit(a)&&e('<li class="search-item"/>').text(a.name).data("depart",a).appendTo(i.$searchList)})),s.bind("click",function(t){var a=e(t.target).closest("li"),s=a.data("depart");a.length>0&&(i._addSelectItem(s),i._createDepartmentList())})}},getItems:function(){var t=[];return e(".select-item",this.$selectList).each(function(i,a){t.push(e(a).data("item"))}),t},setValue:function(e){var t=this,i=this.options;FX.FormItemUtils.dealCurrentDept(e,function(e){t.value=FX.FormItemUtils.parseUserDeptDefaultValue(e),e&&(t.items=t._getDynamicFields().concat([e])),t._initData()},i.dynamicType,this.element)},getValue:function(){return this.value},getCacheValue:function(){var e=this.selectMap[this.value];return e?{_id:e._id,name:e.name}:null},getText:function(){return this.value&&this.selectMap[this.value]?this.selectMap[this.value].name:""},_refreshDepartmentList:function(t){var i=this;e("li",t).each(function(t,a){var s=e(a).data("item");s&&(i.value===s._id?e(a).children(".select-btn").addClass("select"):e(a).children(".select-btn").removeClass("select"))})},clearLimit:function(){this.options.limit={}},refresh:function(){this.departmentTree.refresh(),this.$dynamicList&&this._refreshDepartmentList(this.$dynamicList),this.$currentDepartmentList&&this._refreshDepartmentList(this.$currentDepartmentList),this.$searchList&&this._refreshDepartmentList(this.$searchList)},checkValidate:function(){if(FX.Utils.isExternalLink())return this.setInvalidateType("regex"),!1;var e=this.options;return!FX.Utils.isEmpty(this.getValue())||e.allowBlank},rebuild:function(e){this.setValue(e),this.refresh()},getOptions:function(t){var i=this.options;return e.extend(FX.Dept.superclass.getOptions.apply(this,arguments),{noRepeat:i.noRepeat,limit:i.limit,value:"save"===t?FX.FormItemUtils.parseUserDeptDefaultValue(i.value):i.value,valueOption:i.valueOption})}}),e.shortcut("dept",FX.Dept)}(jQuery),function(e){FX.DeptGroup=FX.extend(FX.Dept,{_defaultConfig:function(){return e.extend(FX.DeptGroup.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_dept fui_dept_group",width:420,height:80,value:[]})},_init:function(){this.value=[],FX.DeptGroup.superclass._init.apply(this,arguments)},_initData:function(){if(!FX.Utils.isExternalLink()){var e=this.options;this.selectMap={},e.items&&(this.items=e.items),this._initSelectPane()}},_createSelectList:function(){var t=this,i=this.options;this.$selectList?this.$selectList.empty():this.$selectList=e('<ul class="select-list"/>').appendTo(this.element),this.value&&this.value.length>0?FX.Utils.forEach(this.value,function(e,i){var a=t.selectMap[i];t._createSelectItem(a)}):i.editable||this.$selectList.append(e('<div class="select-empty"/>').text(i.msg))},_addSelectItem:function(e){this.value.indexOf(e._id)>-1||(this._createSelectItem(e),this.value=this.getValue(),this.selectMap[e._id]=e,this.refresh())},_removeSelectItem:function(t){e("#"+t._id,this.$selectList).remove(),this.value=this.getValue(),this.refresh()},_doSelectItem:function(e){if(this._checkLimit(e)){var t={name:e.name,_id:e._id};this.value.indexOf(t._id)>-1?this._removeSelectItem(t):this._addSelectItem(t)}},_createDepartmentList:function(){var t=this,i=this.options;this._isRelyLimitEmpty()||(this.$selectPane.children().hide(),this.$memberMenu?this.$memberMenu.show():(this.$memberMenu=e('<div class="select-department"/>').appendTo(t.$selectPane),FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.departments),data:{departmentLimit:i.limit.departs,hasCurrentDept:i.limit.hasCurrentDept}},function(i){t.departments=e.extend(!0,[],i.departments),t.departments[0]&&!t.departments[0]._id&&t.departments.shift(),t._initLimitMap(t.departments),t.departmentTree=new FX.Tree({renderEl:e("<div/>").appendTo(t.$memberMenu),customCls:"x-department-tree select-department",Nodes:t.departments,setting:{view:{expandSpeed:100},data:{simpleData:{enable:!0,idKey:"departmentId",pIdKey:"parentId"}},callback:{onCheck:function(e,i){t._doSelectItem(i)},onClick:function(e,i){t._doSelectItem(i)},beforeNodeCreate:function(e){t._checkLimit(e)||(e.nocheck=!0),e.checked=t.value.indexOf(e._id+"")>-1},onNodeCreated:function(e,i){i.isParent&&!i.open&&i.level<1&&this.expandNode(i,!0),i.departmentId==t.currentDepartment&&this.selectNode(i)}},check:{enable:!0,chkboxType:{Y:"",N:""}}}})})))},_createDepartmentItem:function(t){var i=this,a=e("<li/>").append(e('<i class="icon-department"/>')).append(e("<span/>").text(t.name)).append(e('<div class="select-btn x-check"/>').append(e('<i class="icon-blank"/>'))).data("item",t).click(function(){var e=a.children(".select-btn");if(e.hasClass("select"))e.removeClass("select"),i._removeSelectItem(a.data("item"));else{e.addClass("select");var t=a.data("item");i._addSelectItem(t)}});return this.value.indexOf(t._id)>-1&&a.children(".select-btn").addClass("select"),a},getItems:function(){var t=[];return e(".select-item",this.$selectList).each(function(i,a){t.push(e(a).data("item"))}),t},checkValidate:function(){return FX.Utils.isExternalLink()?(this.setInvalidateType("regex"),!1):!(!this.options.allowBlank&&0===this.getValue().length)},setValue:function(e){var t=this,i=this.options;FX.FormItemUtils.dealCurrentDeptList(e,function(e){t.value=[],t.items=[].concat(t._getDynamicFields());var i={};FX.Utils.forEach(e,function(e,a){a&&a._id?i[a._id]||(i[a._id]=!0,t.value.push(a._id),t.items.push(a)):i[a]||(i[a]=!0,t.value.push(a))}),t._initData()},i.dynamicType,this.element)},getValue:function(){var t=this.value;return this.$selectList&&(t=[],e(".select-item",this.$selectList).each(function(i,a){t.push(e(a).attr("id"))})),t},getCacheValue:function(){var e=this,t=[];return FX.Utils.forEach(this.getValue(),function(i,a){var s=e.selectMap[a];t.push({_id:s._id,name:s.name})}),t},getText:function(){var e=this,t=[];return FX.Utils.forEach(this.value,function(i,a){e.selectMap[a]&&t.push(e.selectMap[a].name)}),t},getNullValue:function(){return[]},_refreshDepartmentList:function(t){var i=this;e("li",t).each(function(t,a){var s=e(a).data("item");s&&(i.value.indexOf(s._id)>-1?e(a).children(".select-btn").addClass("select"):e(a).children(".select-btn").removeClass("select"))})},getOptions:function(t){var i=this.options;return e.extend(FX.Dept.superclass.getOptions.apply(this,arguments),{noRepeat:i.noRepeat,limit:i.limit,value:"save"===t?FX.FormItemUtils.parseUserDeptListDefaultValue(i.value):i.value,valueOption:i.valueOption})}}),e.shortcut("deptgroup",FX.DeptGroup)}(jQuery),function(e){FX.LinkQuery=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.LinkQuery.superclass._defaultConfig.apply(),{baseCls:"fui_link_query",allowBlank:!0,linkFields:[],linkFilter:[],linkForm:null,layout:"",itemPadding:4})},_init:function(){FX.LinkQuery.superclass._init.apply(this,arguments);var t=this.options,i=this;this.widgetsMap={},this.typeMap={};var a=["image","upload","signature"];FX.Utils.forEach(t.linkFields,function(s,n){var o=e('<div class="link-field"/>').appendTo(i.element),l=i._formatSubFormItems(n),r={},d=i._formatWidgetType(n.type);t.subform?(o.addClass("sub-link"),r.width=FX.Utils.getSubformWidgetWidth(n)):(o.append(e('<div class="fl-label"/>').text(n.text)),FX.Utils.isEmpty(t.layout)||FX.Utils.setLayoutSize(r,t.layout,d)),e.extend(r,i._getWidgetLinkConfig(d));var c=e.extend(r,{renderEl:e("<div/>").appendTo(o),widgetName:n.name,type:d,items:l,format:n.format,enable:!1});a.indexOf(d)>-1&&e.extend(r,{disableMode:"form",noFileTip:"暂无内容"}),FX.LimitFields.disable.indexOf(d)>-1&&(e.extend(c,{widgetType:d,type:"formitemdisable"}),t.subform&&e.extend(c,{customCls:"fui_subform_item_disable",shouldResize:!0})),i.widgetsMap[n.name]=FX.createWidget(c),i.typeMap[n.name]=n.type})},_getWidgetLinkConfig:function(e){var t={};switch(e){case"image":case"upload":t.mode="preview",t.maxFileCount=FX.CONST.UPLOAD_FILE_COUNT.MULTI;break;case"signature":case"subform":t.mode="preview"}return t},_formatSubFormItems:function(t){if("subform"===t.type){var i=this,a=[];return FX.Utils.forEach(t.items,function(t,s){if(s.widget){i.typeMap[s.widget.widgetName]=s.widget.type;var n=e.extend(!0,{},s);n.widget.type=i._formatWidgetType(s.widget.type),e.extend(n.widget,i._getWidgetLinkConfig(s.widget.type)),a.push(n)}}),a}},_formatWidgetType:function(e){switch(e){case"combo":case"combocheck":case"radiogroup":case"checkboxgroup":case"address":case"location":return"text";default:return e}},_formatWidgetData:function(e,t){var i=this;switch(e){case"address":return FX.Utils.address2Str(t,"","pcda");case"location":var a=FX.Utils.formatData({type:e},t),s="";return a.address&&(s=a.address),a.lngLat&&(s+=" "+a.lngLat),s;case"subform":return FX.Utils.forEach(t,function(e,t){FX.Utils.forEach(t,function(e,a){t[e]=i._formatWidgetData(i.typeMap[e],a)})}),t;default:return t}},getOptions:function(){var t=this.options;return e.extend(FX.LinkQuery.superclass.getOptions.apply(this,arguments),{linkFilter:t.linkFilter,linkFields:t.linkFields,linkForm:t.linkForm,refAppId:t.refAppId})},reload:function(e){var t=this.options,i=this,a=[];FX.Utils.forEach(t.linkFields,function(e,t){a.push(t.name)}),!t.linkForm||a.length<=0||FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.filter_link),data:{formId:t.linkForm,fields:a,filter:e,refAppId:t.refAppId}},function(e){var a={};FX.Utils.isObjectEmpty(e.dataList)?FX.Utils.forEach(i.widgetsMap,function(e,t){t.setValue(null)}):(a=e.dataList[0],FX.Utils.forEach(i.widgetsMap,function(e,t){var s=i._formatWidgetData(i.typeMap[e],a[e]);t.setValue(s)})),FX.Utils.applyFunc(i,t.onRelyDone,[i],!1)})},getCacheValue:function(){var e={};return FX.Utils.forEach(this.widgetsMap,function(t,i){e[t]=i.getCacheValue()}),e},setCacheValue:function(e){FX.Utils.forEach(this.widgetsMap,function(t,i){e?i.setCacheValue(e[t]):i.setCacheValue(null)})},doResize:function(e){var t=this.options;if(t.subform){var i=-t.itemPadding;FX.Utils.forEach(t.linkFields,function(e,a){i+=FX.Utils.getSubformWidgetWidth(a)+t.itemPadding}),i=Math.max(i,FX.Utils.getSubformWidgetWidth({type:t.type})),this.element.css({width:i})}}}),e.shortcut("linkquery",FX.LinkQuery)}(jQuery),function(e){FX.LinkData=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.LinkData.superclass._defaultConfig.apply(),{baseCls:"fui_link_data",allowBlank:!0,linkFields:[],linkKey:null,linkFilter:[],linkForm:null,itemsPerPage:20,layout:"",onBeforeLinkData:null,itemPadding:4,selectWidth:35,btnWidth:240})},_init:function(){FX.LinkData.superclass._init.apply(this,arguments);var t=this.options,i=this;this._createSelectBtn(),this.widgetsMap={},this.typeMap={},this.keyword="";var a=["image","upload","signature"];FX.Utils.forEach(t.linkFields,function(s,n){var o=e('<div class="link-field"/>').appendTo(i.element),l=i._formatSubFormItems(n),r={},d=i._formatWidgetType(n.type);t.subform?(o.addClass("sub-link"),r.width=FX.Utils.getSubformWidgetWidth(n)):(o.append(e('<div class="fl-label"/>').text(n.text)),FX.Utils.isEmpty(t.layout)||FX.Utils.setLayoutSize(r,t.layout,d)),e.extend(r,i._getWidgetLinkConfig(d));var c=e.extend(r,{renderEl:e("<div/>").appendTo(o),widgetName:n.name,type:d,items:l,format:n.format,enable:!1});a.indexOf(d)>-1&&e.extend(r,{disableMode:"form",noFileTip:"暂无内容"}),FX.LimitFields.disable.indexOf(d)>-1&&(e.extend(c,{widgetType:d,type:"formitemdisable"}),t.subform&&e.extend(c,{customCls:"fui_subform_item_disable",shouldResize:!0})),i.widgetsMap[n.name]=FX.createWidget(c),i.typeMap[n.name]=n.type})},_getWidgetLinkConfig:function(e){var t={};switch(e){case"image":case"upload":t.mode="preview",t.maxFileCount=FX.CONST.UPLOAD_FILE_COUNT.MULTI;break;case"signature":case"subform":t.mode="preview"}return t},_setWidgetsValue:function(e){var t=this;FX.Utils.forEach(this.widgetsMap,function(i,a){var s=t._formatWidgetData(t.typeMap[i],e[i]);a.setValue(s)})},_formatSubFormItems:function(t){if("subform"===t.type){var i=this,a=[];return FX.Utils.forEach(t.items,function(t,s){if(s.widget){i.typeMap[s.widget.widgetName]=s.widget.type;var n=e.extend(!0,{},s);n.widget.type=i._formatWidgetType(s.widget.type),e.extend(n.widget,i._getWidgetLinkConfig(n.widget.type)),a.push(n)}}),a}},_formatWidgetType:function(e){switch(e){case"combo":case"combocheck":case"radiogroup":case"checkboxgroup":case"address":case"location":return"text";default:return e}},_formatWidgetData:function(e,t){var i=this;switch(e){case"address":return FX.Utils.address2Str(t,"","pcda");case"location":var a=FX.Utils.formatData({type:e},t),s="";return a.address&&(s=a.address),a.lngLat&&(s+=" "+a.lngLat),s;case"subform":return FX.Utils.forEach(t,function(e,t){FX.Utils.forEach(t,function(e,a){t[e]=i._formatWidgetData(i.typeMap[e],a)})}),t;default:return t}},_createSelectBtn:function(){var t=this.options,i=this;if(t.subform)e('<div class="data-select select-btn"/>').append(e('<i class="icon-data-picker"/>')).appendTo(this.element).click(function(){i.isEnabled()&&FX.Utils.applyFunc(i,t.onBeforeLinkData,[t.linkFilter],!1)});else{if(!i.isEnabled())return;new FX.Button({text:"选择数据",width:t.btnWidth,style:"white",renderEl:e('<div class="select-btn"/>').appendTo(this.element),onClick:function(){i.isEnabled()&&FX.Utils.applyFunc(i,t.onBeforeLinkData,[t.linkFilter],!1)}})}},_createDataList:function(t){var i=this;if(this.datalist?e(".link-empty-list",this.datalist).remove():this.datalist=e('<ul class="link-data-list"/>'),this.items=t,!e(".data-search-wrapper",this.datalist).length){var a=e('<li class="data-search-wrapper"><i class="icon-search"></i></li>').appendTo(this.datalist);e("<input />").on("input propertychange",function(){i.keyword!==this.value&&(i.searchinterval&&clearTimeout(i.searchinterval),i.keyword=this.value,i.searchinterval=setTimeout(function(){i.skip=0,i._loadData(!0)},500))}).appendTo(a)}this.$listWrapper?this.$listWrapper.empty():this.$listWrapper=e('<ul class="data-list-wrapper"/>').appendTo(this.datalist),this.$listWrapper.append(e('<li class="data-item data-clear"/>').text("--请选择--")),t.length<=0?this.datalist.append(e('<div class="link-empty-list"/>').text("没有符合条件的数据")):FX.Utils.forEach(t,function(e,t){i._createDataItem(t)}),this.bubble||(this.bubble=FX.Msg.bubble({anchor:e(".select-btn",this.element),text4Ok:null,text4Cancel:null,minWidth:330,contentHTML:this.datalist,hAdjust:158,contentPadding:0,edge:240,hasTriangle:!1,onClose:function(){return i.keyword="",i.datalist.remove(),i.datalist=null,i.$listWrapper=null,i.bubble=null,!1}}),this._bindListEvent(this.bubble))},_createDataItem:function(t){var i=this.options,a=this,s=t.label,n="";if(FX.Utils.isEmpty(s)){var o=[];FX.Utils.forEach(i.linkFields,function(e,i){var s=a._formatData(i.type,t[i.name],i.format);s&&o.push(s)}),s=o.join(","),"template"===a.dataLabelMode&&(n="style-blue")}var l=e('<li class="data-item" title="'+s+'"/>').text(s).appendTo(this.$listWrapper).data("data",t).addClass(n);this.value&&this.value.id===t._id&&l.addClass("select")},_bindListEvent:function(t){var i=this,a=this.options;this.$listWrapper.click(function(s){var n=s.target,o=e(n).closest(".data-item");if(o&&o.length>0){if(o.hasClass("data-clear"))i.value={},FX.Utils.forEach(i.widgetsMap,function(e,t){t.setValue(null)});else{var l=o.data("data");i.value={id:l._id,key:l[a.linkKey]},i._setWidgetsValue(l)}FX.Utils.applyFunc(i,a.onStopEdit,[],!1),t.close()}return!1}),this.$listWrapper.scroll(function(){this.scrollTop+e(this).height()>this.scrollHeight-5&&i.loadMore()})},_formatData:function(e,t,i){if(FX.Utils.isObjectEmpty(t))return"";var a=t.toString();switch(e){case"address":case"location":a=FX.Utils.address2Str(t,"","pcda");break;case"datetime":a=FX.Utils.date2Str(new Date(t),i||"yyyy-MM-dd");break;case"upload":case"image":case"signature":case"subform":a="";break;case"user":case"dept":a=t&&t.name;break;case"usergroup":case"deptgroup":a=t&&t.map(function(e){return e.name})}return a},checkValidate:function(){return this.options.allowBlank||!FX.Utils.isObjectEmpty(this.value)},setValue:function(e){var t=this.options,i=this;this.value=e,!FX.Utils.isObjectEmpty(e)&&e.hasOwnProperty("id")&&FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.read_link),data:{formId:e.entryId||t.linkForm,linkId:e.id,refAppId:e.appId||t.refAppId}},function(e,t){i._setWidgetsValue(e.data)},function(){})},getValue:function(){var t=this.options;return this.value&&this.value.id?e.extend({appId:t.refAppId,entryId:t.linkForm},this.value):{}},getText:function(){var e={};return FX.Utils.forEach(this.widgetsMap,function(t,i){e[t]=i.getText()}),e},getLinkValue:function(){return this.value&&this.value.key},getLinkType:function(){return this.options.linkType},getOptions:function(){var t=this.options;return e.extend(FX.LinkData.superclass.getOptions.apply(this,arguments),{linkFilter:t.linkFilter,linkFields:t.linkFields,linkForm:t.linkForm,linkKey:t.linkKey,linkType:t.linkType,refAppId:t.refAppId})},getNullValue:function(){return{}},_loadData:function(e){var t=this.options,i=this;this.loading=!0,FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.filter_link),data:{multi:!0,formId:t.linkForm,fields:this.fields,filter:this.filter,limit:t.itemsPerPage,skip:this.skip,refAppId:t.refAppId,keyword:this.keyword}},function(a){var s=[];FX.Utils.isObjectEmpty(a.dataList)||(s=a.dataList),i.dataLabelMode=a.dataLabelMode,s.length<t.itemsPerPage&&(i.hasMore=!1),e?i._createDataList(s):FX.Utils.forEach(s,function(e,t){i._createDataItem(t)})},function(){},function(){i.skip+=t.itemsPerPage,i.loading=!1})},loadMore:function(){!this.loading&&this.hasMore&&this._loadData()},reload:function(e){var t=this.options,i=[];FX.Utils.forEach(t.linkFields,function(e,t){i.push(t.name)}),t.linkKey&&i.push(t.linkKey),!t.linkForm||i.length<=0||(this.filter=e,this.fields=i,this.skip=0,this.hasMore=!0,this._loadData(!0))},doResize:function(e){var t=this.options;if(t.subform){var i=t.selectWidth-t.itemPadding;FX.Utils.forEach(t.linkFields,function(e,a){i+=FX.Utils.getSubformWidgetWidth(a)+t.itemPadding}),i=Math.max(i,FX.Utils.getSubformWidgetWidth({type:t.type})),this.element.css({width:i})}}}),e.shortcut("linkdata",FX.LinkData)}(jQuery),function(e){FX.Signature=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Signature.superclass._defaultConfig.apply(),{baseCls:"fui_signature",width4SignatureBtn:125,height4SignatureBtn:60,mode:"view",tip:"扫描二维码，添加签名",allowBlank:!0,allowSign:!0,maxImgRetry:5,onStopEdit:null,onValidateFail:null,waterMark:"暂无内容",disableMode:"other"})},_init:function(){FX.Signature.superclass._init.apply(this,arguments),this.expired=!1,this._createEditBtn()},_createEditBtn:function(){var t=this,i=this.options;i.allowSign?i.enable||"form"!==i.disableMode?this.editBtn=new FX.Button({renderEl:e("<div />").appendTo(this.element),customCls:"signature-btn",text:"添加签名",width:i.width4SignatureBtn,height:i.height4SignatureBtn,iconCls:"icon-widget-signature",style:"white",enable:i.enable,onClick:function(i){t._createQrcodeDropDown(e(i.currentTarget))}}):this.element.addClass("disable-mode-form").attr("data-watermark",i.waterMark):this._createUnusable()},_createUnusable:function(){var t=this.options;e('<div class="signature-unusable"/>').append('<i class="icon-widget-signature"/>').append(e("<span />").text("不可用")).css({"line-height":t.height4SignatureBtn-2+"px",width:t.width4SignatureBtn,height:t.height4SignatureBtn}).appendTo(this.element)},_createQrcodeDropDown:function(t){var i=this,a=this.options;this._fetchQrlink(function(s){var n=e('<div class="qrcode-dropdown"/>');i.$qrcode=e("<img/>").attr("src","/qrcode?u="+encodeURIComponent(i.qrLink)).appendTo(n),e("<div/>").text(a.tip).appendTo(n),i.bubble=FX.Msg.bubble({anchor:t,text4Ok:null,minWidth:150,text4Cancel:null,contentHTML:n,hAdjust:75,edge:200,onClose:function(){return i._clearInterval(),i.qrLink=null,!1}}),i._bindSocket(s),i._setInterval()})},_bindSocket:function(e){var t=this,i=this.options;FX.Socket.on(e,function(e){if(e)switch(e.type){case"qr_link_expired":t.setExpired(!0),t.closeBubble();break;case"signature_upload_done":t.setValue(e.file),t.closeBubble(),FX.Utils.applyFunc(t,i.onStopEdit,[],!1)}})},_setInterval:function(){var e=this;this.interval||(this.interval=setInterval(function(){e.setExpired(!0),e._fetchQrlink(function(t){e.$qrcode&&e.$qrcode.attr("src","/qrcode?u="+encodeURIComponent(e.qrLink)),e._bindSocket(t)})},6e4))},_clearInterval:function(){this.interval&&clearInterval(this.interval),this.interval=null},_fetchQrlink:function(e){var t=this,i=this.options;if(this.qrLink&&!this.expired)FX.Utils.applyFunc(this,e,[],null);else{var a="edit"===i.mode?FX.Utils.getApi(FX.API.data.admin_signature):FX.Utils.getApi(FX.API.data.signature),s=this.getKey();FX.Utils.dataAjax({url:a,data:{signatureKey:s,field:i.widgetName}},function(i){t.qrLink=i.qrLink,FX.Utils.applyFunc(t,e,[s],null)})}},setSignature:function(t){var i=this,a=this.options;this.element.empty(),this.editBtn=null;var s=e('<div class="signature-wrapper"/>').appendTo(this.element),n=e('<div class="signature-img"/>').appendTo(s);this.$delBtn=e('<span class="del-btn"/>').append('<i class="icon-trasho"/>').toggleClass("x-ui-hidden",!this.isEnabled()).on("click",function(){i.setValue(null),FX.Utils.applyFunc(i,a.onStopEdit,[],!1)}).appendTo(s),FX.Utils.getFileDownloadURL(t,function(t){var s=0;e("<img/>").attr("src",t).on("click",function(){new FX.FilePreview({files:e.makeArray(i.getValue())})}).on("error",function(){e(this).attr("src",t),++s>=a.maxImgRetry&&e(this).off("error")}).appendTo(n)})},checkValidate:function(){var e=this.options;return!FX.Utils.isObjectEmpty(this.getValue())||(e.allowBlank||FX.Utils.applyFunc(this,e.onValidateFail,[],!1),e.allowBlank)},setValue:function(e){var t=this;this.value=e,FX.Utils.isObjectEmpty(this.value)?(t.element.empty(),t._createEditBtn()):t.setSignature(this.value)},setEnable:function(e){FX.Signature.superclass.setEnable.apply(this,arguments),this.editBtn&&this.editBtn.setEnable(e),this.$delBtn&&this.$delBtn.toggleClass("x-ui-hidden",!this.isEnabled())},setExpired:function(e){this.expired=e},closeBubble:function(){this.bubble&&this.bubble.close()},getValue:function(){return this.value},getKey:function(){return this.UUID||(this.UUID=FX.Utils.UUID()),this.UUID}}),e.shortcut("signature",FX.Signature)}(jQuery),function(e){FX.Block=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Block.superclass._defaultConfig.apply(),{title:"",visible4Title:!0,cls4FullScreen:"block-fullscreen",hasHeader:!0,hasBorder:!0,height4Head:35,height:230,width:200,forms:[],filter:null,linkWidgets:null,allowDataLoad:!0,onAfterHeadCreate:null,scalable:!1})},_init:function(){FX.Block.superclass._init.apply(this,arguments);var e=this.options;this.element.addClass("x-block-bg"),e.hasBorder||this.element.addClass("no-border"),e.hasHeader&&this._onCreateHead(),this._onCreateBody()},_onCreateHead:function(){var t=this.options;if(t.height4Head){this.$head=e('<div class="x-block-head"/>').height(t.height4Head).css({"line-height":t.height4Head+"px"}).appendTo(this.element);var i=e('<div class="x-block-head-title"/>').appendTo(this.$head);t.visible4Title&&i.text(t.title)}return FX.Utils.applyFunc(this,t.onAfterHeadCreate,[this.$head],!1),this.$head},createHeadTools:function(){var t=this,i=this.options;if(this.$head.children("a").remove(),i.scalable){var a="全屏",s=e("<a />").append('<i class="icon-enlarge">');t.element.hasClass(i.cls4FullScreen)&&(s=e("<a />").append('<i class="icon-shrink">'),a="缩小"),s.appendTo(this.$head).click(function(){t.doFullScreen()?(s.children("i").removeClass().addClass("icon-shrink"),a="缩小"):(s.children("i").removeClass().addClass("icon-enlarge"),a="全屏")}).hover(function(){FX.UI.showPopover({position:"bottomLeft",anchor:e(this).children("i"),content:e("<span/>").text(a),type:"dark"})},function(){FX.UI.closePopover()})}},_onCreateBody:function(){return this.$body=e('<div class="x-block-body"/>').appendTo(this.element),this._resizeBody(),this._initContent(this.$body),this.$body},_resizeBody:function(){var e=this.options,t={};if(FX.Utils.isNumber(e.width)){var i=e.width;e.hasBorder&&(i-=2),t.width=i}else FX.Utils.isNull(e.width)||(t.width=e.width);if(FX.Utils.isNumber(e.height)){var a=e.height;e.hasBorder&&(a-=2),e.hasHeader&&(a-=e.height4Head),t.height=a,this.$body.addClass("fixed-height")}else FX.Utils.isNull(e.height)?(this.$body.removeClass("fixed-height"),t.height="auto"):(this.$body.removeClass("fixed-height"),t.height=e.height);this.$body.css(t)},_initContent:function(e){},isAllowDataLoad:function(){return this.options.allowDataLoad},setAllowDataLoad:function(e){this.options.allowDataLoad=!!e},loadingAjax:function(e,t,i){var a=this;if(this.isAllowDataLoad()&&!this.isLoading){this.isLoading=!0;var s=this.createLoadingMask();FX.Utils.dataAjax(e,function(e,i){return FX.Utils.applyFunc(a,t,[e,i],!1)},function(e,t){return FX.Utils.applyFunc(a,i,[e,t],!1)},function(){s.remove(),a.isLoading=!1})}},createLoadingMask:function(){return FX.Utils.createMask(this.element,{hasLoader:!0,isLight:!0})},_makeGroups:function(t){var i=[],a=function(t,a){t.forEach(function(t){var s=e.extend({},a),n=a.tag||a.name;s.groupName=n+"_"+t,s.groupBy=t,i.push(s)})};return FX.Utils.forEach(t,function(e,t){switch(t.type){case"datetime":var s=t.dateType||"year";a(s.split("&"),t);break;case"address":case"location":var n=t.addressType||"province";a(n.split("&"),t);break;default:i.push(t)}}),i},reload:function(e){},rebuild:function(){this.$body.remove(),this._onCreateBody()},getOptions:function(){var t=this.options;return e.extend(FX.Block.superclass.getOptions.apply(this,arguments),{title:t.title,linkWidgets:t.linkWidgets,forms:t.forms,filter:t.filter})},_getWidgetNameByTag:function(e){var t=this.options,i=e;return FX.Utils.forEach([].concat(t.xFields,t.yFields),function(t,a){if(a.tag&&a.tag===e)return i=a.name,!1}),i},_getLinkFilterParams:function(t){var i=this.options,a=this,s=[];return FX.Utils.forEach(t,function(t,n){var o=a._getWidgetNameByTag(n.field);if(i.relations[o]){var l=i.relations[o];FX.Utils.forEach(l,function(t,i){var a=FX.Utils.pick(n,["method","type","value","keyType"]);e.extend(a,FX.Utils.dealFilterInfoByField({id:t,name:i})),s.push(a)})}else s.push(e.extend(FX.Utils.pick(n,["method","type","value","keyType"]),FX.Utils.dealFilterInfoByField({id:i.forms[0],name:n.field})))}),s},getFilterData:function(e){var t=this,i=this.options,a=FX.Utils.applyFunc(this,i.onDataFilter,[],!1),s=[];return a&&(s=s.concat(a)),FX.Utils.isObjectEmpty(e)||FX.Utils.forEach(e,function(e,a){FX.Utils.forEach(i.forms,function(e,i){t._isSameEntry(i,a)&&s.push(a)})}),i.filter&&"edit"===i.mode&&(s=s.concat(i.filter.cond)),FX.Utils.isObjectEmpty(s)?{}:{cond:s,rel:FX.CONST.FILTER_RELATION.AND}},_isSameEntry:function(e,t){var i=FX.Utils.getFieldInfoById(e),a=i.entryId,s=i.appId||t.appId;return a===t.entryId&&s===t.appId},doResize:function(e){FX.Block.superclass.doResize.apply(this,arguments),this._resizeBody()},doFullScreen:function(){var e=this.options;return this.element.hasClass(e.cls4FullScreen)?(this.element.removeClass(e.cls4FullScreen),this.doResize({width:FX.Utils.isEmpty(this.originStyle.w)?"auto":this.originStyle.w,height:FX.Utils.isEmpty(this.originStyle.h)?"auto":this.originStyle.h}),!1):(this.originStyle={w:this.element.outerWidth(),h:e.height},this.element.addClass(e.cls4FullScreen),this.doResize({width:document.body.clientWidth,height:document.body.clientHeight}),!0)}})}(jQuery),function(e){FX.Table=FX.extend(FX.Block,{_defaultConfig:function(){return e.extend(FX.Table.superclass._defaultConfig.apply(),{baseCls:"fui_table",tableHead:null,tableRowHead:null,tableData:[],hasMenu:!1,isHeadSticky:!1,isRowHeadSticky:!1,onScroll:null,onAfterTableCreate:null,onCheckValid:null,exportable:!0,scalable:!0,tableClass:"x-table"})},_initContent:function(t){FX.Table.superclass._initContent.apply(this,arguments);var i=this.options;this.$wrapper=e('<div class="fui_table-wrapper"/>').appendTo(t),i.hasMenu&&(this.$wrapper.addClass("has-menu"),this.$menu=e('<div class="fui-table-menu"/>').appendTo(t)),this._removeTable()},createHeadTools:function(){FX.Table.superclass.createHeadTools.apply(this,arguments);var t=this;this.options.exportable&&e("<a/>").append('<i class="icon-export">').append(e("<span/>").text("导出Excel")).appendTo(this.$head).click(function(){t.doExcelExport()})},createTable:function(){var t=this,i=this.options;if(this.$tableScroller=e('<div class="table-scroller"/>').scroll(function(){t._scrollStickyHead()}).appendTo(this.$wrapper),this.$table=e('<table cellpadding="0" cellspacing="0" class="'+i.tableClass+' x-table-bordered x-table-striped t-main"/>').appendTo(this.$tableScroller),this.tableHead&&this.tableHead.length>0){var a=e('<thead class="t-head"/>').appendTo(this.$table);FX.Utils.forEach(this.tableHead,function(i,s){var n=e('<tr class="t-row th-row"/>').appendTo(a);FX.Utils.forEach(s,function(e,i){t._createCell(i,{tag:"th",cls:"th-cell"}).appendTo(n)})})}this.$tableBody=e('<tbody class="t-body"/>').appendTo(this.$table),this._appendTableData(),this._setEvent(),this._createStickyHead(),FX.Utils.applyFunc(this,i.onAfterTableCreate,[],!1)},_appendTableData:function(){var t=this;FX.Utils.forEach(this.tableData,function(i,a){var s=i%2==0?"odd":"even",n=e('<tr class="t-row tb-row"/>').addClass(s).appendTo(t.$tableBody);t._bindRowData(t.$tableBody,n,i),t.tableRowHead&&t.tableRowHead.length>0&&t.tableRowHead.forEach(function(e){var a=e[i];a&&t._createCell(a,{tag:"th",cls:"rh-cell"}).appendTo(n)}),FX.Utils.forEach(a,function(e,a){a.row=i,a.col=e,t._createCell(t._formatCell(a),{tag:"td",cls:"td-cell"}).appendTo(n)})})},_bindRowData:function(e,t,i){},_formatCell:function(t){return e.extend({},t)},_createCell:function(t,i){var a=i||{tag:"td"};a.cls&&t.cls&&(t.cls=a.cls+" "+t.cls);var s=e.extend(a,t.text||t.html||!FX.Utils.isString(t)?t:{text:t}),n=e("<"+s.tag+' class="t-cell"/>');switch(n.attr({row:s.row,col:s.col}),s.hasOwnProperty("html")?n.html(s.html):n.text(s.text),s.align){case"center":n.addClass("h-center");break;case"right":n.addClass("h-right")}if(s.data)for(var o in s.data)s.data.hasOwnProperty(o)&&n.data(o,s.data[o]);return s.cls&&n.addClass(s.cls),s.colspan&&n.attr("colspan",s.colspan),s.rowspan&&n.attr("rowspan",s.rowspan),s.width&&n.width(s.width),s.height&&n.width(s.height),n},_createStickyHead:function(){var t=this,i=this.options;!0===i.isHeadSticky&&(this.$stickyHead=e('<table cellpadding="0" cellspacing="0" class="'+i.tableClass+' x-table-bordered x-table-striped"/>').append(this.$table.children(".t-head").clone(!0)).outerWidth(this.$table.outerWidth()),e('<div class="table-sticky-head"/>').css({width:this.$tableScroller[0].clientWidth}).append(this.$stickyHead).appendTo(this.$wrapper),this.$stickyHead.find(".t-head .th-cell").each(function(i,a){var s=t.$table.find(".t-head .th-cell").eq(i);e(a).outerWidth(s.outerWidth())})),!0===i.isRowHeadSticky&&(this.$stickyRowHead=e('<table cellpadding="0" cellspacing="0" class="'+i.tableClass+' x-table-bordered x-table-striped"/>').append(this.$table.children(".t-head, .t-body").clone(!0)),e('<div class="table-sticky-row-head"/>').css({height:this.$tableScroller[0].clientHeight}).append(this.$stickyRowHead).appendTo(this.$wrapper),this.$stickyRowHead.find(".t-head .th-cell").each(function(i,a){var s=t.$table.find(".t-head .th-cell").eq(i);e(a).outerWidth(s.outerWidth())}),this.$stickyRowHead.find(".t-row").each(function(i,a){var s=t.$table.find(".t-row").eq(i);e(a).outerHeight(s.outerHeight())}),this.$stickyRowHead.children(".t-head").children("tr.t-row").each(function(t,i){e(i).children(".th-cell").not(".group-head").remove()}),this.$stickyRowHead.find(".t-body .td-cell").remove()),!0===i.isHeadSticky&&!0===i.isRowHeadSticky&&(this.$stickyIntersect=e('<table cellpadding="0" cellspacing="0" class="'+i.tableClass+' x-table-bordered x-table-striped"/>').append(this.$stickyRowHead.children(".t-head").clone(!0)),e('<div class="table-sticky-intersect"/>').append(this.$stickyIntersect).appendTo(this.$wrapper))},rebuildStickyHead:function(){this.element.find(".table-sticky-head, .table-sticky-row-head, .table-sticky-intersect").remove(),this._createStickyHead()},_scrollStickyHead:function(){var e=this.options,t=this.$tableScroller.scrollTop(),i=this.$tableScroller.scrollLeft();!1===FX.Utils.applyFunc(this,e.onScroll,[i,t],!1)&&(this.$stickyHead&&this.$stickyHead.css({"margin-left":-i}),this.$stickyRowHead&&this.$stickyRowHead.css({"margin-top":-t}))},_setEvent:function(){},_removeTable:function(){this.$wrapper.children().remove(),this.$menu&&this.$menu.children().remove()},reload:function(e){FX.Table.superclass.reload.apply(this,arguments),this._removeTable()},refresh:function(){this.tableRowHead=[],this._removeTable(),this.createTable()},doResize:function(e){this.options;FX.Table.superclass.doResize.apply(this,arguments),this.$table&&(this.$stickyHead&&this.$stickyHead.parent().remove(),this.$stickyRowHead&&this.$stickyRowHead.parent().remove(),this.$stickyIntersect&&this.$stickyIntersect.parent().remove(),this._createStickyHead(),this._scrollStickyHead())},getOptions:function(){var t=this.options;return e.extend(FX.Table.superclass.getOptions.apply(this,arguments),{exportable:t.exportable})}})}(jQuery),function(e){FX.DataTableTemplate=FX.extend(FX.Table,{_defaultConfig:function(){return e.extend(FX.DataTableTemplate.superclass._defaultConfig.apply(),{itemEditable:!1,itemRemovable:!1,hasCheck:!1,isHeadSticky:!0,isRowHeadSticky:!0,tableRowHead:[]})},createTable:function(){this._initHeadCount(),this._createTableHead(),this._extendTableHead(),this._createTableData(),FX.DataTableTemplate.superclass.createTable.call(this)},appendData:function(){var e=this.options;this.tableRowHead=[],this._extendTableHead(),this._createTableData(),this._appendTableData(),(e.isHeadSticky||e.isRowHeadSticky)&&this.rebuildStickyHead()},_initHeadCount:function(){var e=this;this.headRowCount=1,FX.Utils.forEach(e.header,function(t,i){if("subform"===i.type)return e.headRowCount=2,!1})},getSortedFieldIdx:function(e){var t=-1;return FX.Utils.forEach(this.sort,function(i,a){if(a)return a[e]?(t=i,!1):void 0}),t},_getFieldTargetName:function(e){return e?e.tag||e.name:""},_createTableHead:function(){for(var e=this,t=(this.options,[]),i=0;i<this.headRowCount;i++)t.push([]);this.cols=[],this.fieldTypeMap={_removeCheck:"_removeCheck"},FX.Utils.forEach(e.header,function(i,a){if(a&&!a.detailOnly){var s,n=e._getFieldTargetName(a),o={text:a.text,cls:a.type+"-col",colspan:1},l={field:n};a.cellFmt&&(s=a.cellFmt.data),l.format=s||a.format,a.regex&&(l.regex=a.regex);var r=e.getSortedFieldIdx(n);if(~r)switch(e.sort[r][n]){case FX.CONST.SORT.ASC:o.cls+=" sort sort-asc";break;case FX.CONST.SORT.DESC:o.cls+=" sort sort-desc"}switch(e.fieldTypeMap[n]=a.type,a.type){case"image":case"upload":case"signature":case"address":case"location":case"user":case"usergroup":case"dept":case"deptgroup":case"id":case"did":case"combocheck":case"checkboxgroup":o.rowspan=e.headRowCount,o.data={field:n},t[0].push(o),e.cols.push(l);break;case"subform":if(!a.items)return;o.colspan=a.items.length,o.cls+=" combined-col",FX.Utils.forEach(a.items,function(i,a){var s={field:n,subField:e._getFieldTargetName(a)},o=[s.field,s.subField].join(".");e.fieldTypeMap[o]=a.type;var l={text:a.text,rowspan:e.headRowCount-1};l.rowspan=e.headRowCount-1;var r;a.cellFmt&&(r=a.cellFmt.data),"linkdata"===a.type&&(s.linkType=a.linkType),s.format=r||a.format,e.cols.push(s),t[1].push(l)}),a.items.length>0&&t[0].push(o);break;case"datetime":o.rowspan=e.headRowCount,o.data={field:n},o.cls+=" clickable sortable",e.cols.push(l),t[0].push(o);break;default:"linkdata"===a.type&&(l.linkType=a.linkType),o.cls+=" clickable sortable",o.rowspan=e.headRowCount,o.data={field:n},e.cols.push(l),t[0].push(o)}}}),this.tableHead=t},_extendTableHead:function(){if(this.options.hasCheck){var t=e('<div class="x-check table-op-btn"><i class="icon-blank"/></div>').click(function(){t.toggleClass("select")});this.tableHead[0].unshift({rowspan:this.headRowCount,cls:"table-op-btn-cell group-head",html:t}),this.cols.unshift({field:"_removeCheck"}),this.removeCheckList=[],this.tableRowHead.push(this.removeCheckList)}},_createTableData:function(){var e=this;this.options;this.tableData=[],this.dataMap=[],FX.Utils.forEach(e.data,function(t,i){for(var a=[],s=e._calculateDataRowCount(i),n=0;n<s;n++)a.push([]);FX.Utils.forEach(e.cols,function(t,n){var o=e._createCellData(i,n,!1);switch(e.fieldTypeMap[n.field]){case"subform":var l=i[n.field];FX.Utils.isObjectEmpty(l)&&(l=[{}]);for(var r=0;r<s;r++){var d=l[r],c=e._createCellData(d,n,!0);a[r].push(c)}break;case"_removeCheck":o.rowspan=s,e.removeCheckList.push(o),e.removeCheckList.length+=s-1;break;default:o.rowspan=s,a[0].push(o)}}),i&&FX.Utils.forEach(a,function(i,a){e.dataMap.push(t)}),e.tableData=e.tableData.concat(a)})},_calculateDataRowCount:function(e){var t=this,i=[1];for(FX.Utils.forEach(e,function(e,a){a&&"subform"===t.fieldTypeMap[e]&&i.push(a.length||1)});i.length>=2;)i.push(Math.max(i.pop(),i.pop()));return i[0]},_createCellData:function(t,i,a){var s,n;if(FX.Utils.isNull(t))return{text:""};a?(s=t[i.subField],n=this.fieldTypeMap[i.field+"."+i.subField]):(s=t[i.field],n=this.fieldTypeMap[i.field]);var o={text:""};switch(n){case"checkboxgroup":case"combocheck":case"array":o={text:FX.Utils.isNull(s)?"":s.join(", ")};break;case"text":if(i.regex&&new RegExp(i.regex).test(s)){var l=FX.CONST.TEXT_TYPE_REGEXP;i.regex===l.email&&(o={html:'<a href="mailto:'+s+'">'+s+"</a>"})}o=!s||FX.Utils.isString(s)?{html:e("<span />").append(FX.Utils.replaceURL(s))}:{text:s.name||""};break;case"radiogroup":case"combo":case"string":case"id":case"did":o={text:FX.Utils.isNull(s)?"":s};break;case"user":case"dept":o=!s||FX.Utils.isString(s)?{text:s||""}:{text:s.name||""};break;case"usergroup":case"deptgroup":var r=[];FX.Utils.forEach(s,function(e,t){!t||FX.Utils.isString(t)?r.push(t||""):r.push(t.name)}),o={text:r.join(",")};break;case"number":case"formula":var d=FX.Utils.fixDecimalPrecision(s);o={text:FX.Utils.num2Str(d,i.format)};break;case"address":case"location":var c=[];s&&(s.province&&(c.push(s.province),s.city&&s.province!==s.city&&c.push(s.city),s.district&&c.push(s.district)),s.detail&&c.push(s.detail)),o={text:FX.Utils.address2Str(s,c.join(""),i.format)};break;case"textarea":o={html:s?e("<pre/>").append(FX.Utils.replaceURL(s)):""};break;case"datetime":s&&(o={text:FX.Utils.date2Str(new Date(s),i.format)});break;case"_removeCheck":o={cls:"table-op-btn-cell",html:e('<div class="x-check table-op-btn"/>').append(e('<i class="icon-blank"/>')).data({op:"remove_check",dataId:t._id})};break;case"image":case"upload":case"signature":var u=e('<a class="table-op-btn table-file-btn"/>').data("file",s);FX.Utils.isObjectEmpty(s)?u.text(""):u.text("查看").data("op","file"),o={html:u};break;case"linkdata":var h=s&&s.key;if(!h)break;"datetime"===i.linkType&&(h=FX.Utils.date2Str(new Date(h),"yyyy-MM-dd")),o={text:h}}return o},rebuildStickyHead:function(){if(this.$stickyHead){var e=this.$stickyHead.attr("class");this.$stickyHead.parent().remove()}if(this.$stickyRowHead){var t=this.$stickyRowHead.attr("class");this.$stickyRowHead.parent().remove()}if(this.$stickyIntersect){var i=this.$stickyIntersect.attr("class");this.$stickyIntersect.parent().remove()}this._createStickyHead(),this.$stickyHead&&this.$stickyHead.addClass(e),this.$stickyRowHead&&this.$stickyRowHead.addClass(t),this.$stickyIntersect&&this.$stickyIntersect.addClass(i)},_formatCell:function(t){return e.extend({},t)}})}(jQuery),function(e){FX.DataTable=FX.extend(FX.DataTableTemplate,{_defaultConfig:function(){return e.extend(FX.DataTable.superclass._defaultConfig.apply(),{baseCls:"fui_datatable",hasMenu:!0,itemEditable:!1,itemRemovable:!1,itemPrintable:!0,hasCheck:!1,itemsPerPage:20,filterParam:{},fields:[],data:[],asyncExportURL:FX.Utils.getApi(FX.API.data.list_excel_export),mode:"visit"})},_initContent:function(e){FX.DataTable.superclass._initContent.apply(this,arguments);var t=this.options;this.sort=[],this.page=0,this.hasCount=!0,this.hasLoadCount=!1,this.count=0,this.filterParam=t.filterParam,this._initDataTable()},_initDataTable:function(){var e=this,t=this.options;t.itemEditable&&e._isMultiForm()&&(t.itemEditable=!1),t.itemRemovable&&e._isMultiForm()&&(t.itemRemovable=!1),this.tableRowHead=[],this._loadData(function(){e.createTable()}),this._setTitle()},_setTitle:function(e){e&&(this.title=e),FX.Utils.isEmpty(this.title)?this.title=document.title:FX.Utils.setPageTitle(this.title)},_isMultiForm:function(){var e=this.options;return e.forms.length>1||!FX.Utils.isObjectEmpty(e.relations)},_loadData:function(e){var t=this;this.options;this._isFieldsValid()&&this.loadingAjax(this._getAsync(!1),function(i){t.hasCount&&!FX.Utils.isNull(i.count)&&(t.count=i.count),t.header=i.header,t.data=i.data,e&&e()},function(e){var t=e.responseJSON||{};FX.Utils.isEmpty(t.msg)||FX.Msg.toast({type:"warning",msg:t.msg})})},_getAsync:function(t){var i=this.options,a={},s=this.getFilterData(this.filterParam);switch(i.mode){case"edit":a.url=FX.Utils.getApi(FX._API.report.preview_list),a.data={fields:i.fields,forms:i.forms,relations:i.relations,filter:s};break;case"visit":a.url=FX.Utils.getApi(FX.API.data.list),a.data={widgetId:i.widgetName,filter:s};break;case"query":t?(a.url=FX.Utils.getApi(FX.API.data.count),a.data={filter:s,hasLimit:!1,hasTotalCount:!1}):(a.url=FX.Utils.getApi(FX.API.data.query),a.data={filter:s})}return t?e.extend(a.data,{isCountOnly:!0}):e.extend(a.data,{sort:this.sort,skip:this.page*i.itemsPerPage,limit:i.itemsPerPage,hasCount:this.hasCount}),a},_isFieldsValid:function(){var e=this.options;if(["view","query"].indexOf(e.mode)>-1)return!0;var t=!0;return t&=e.forms&&e.forms.length>0,t&=e.fields&&e.fields.length>0,FX.Utils.applyFunc(this,e.onCheckValid,[],!1),t},createTable:function(){FX.DataTable.superclass.createTable.call(this),this.options.hasMenu&&this._loadCount(function(){this._createPagination()})},_loadCount:function(e){var t=this;"query"!==this.options.mode||this.hasLoadCount?FX.Utils.applyFunc(t,e,[],null):FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.count),data:{filter:this.getFilterData(this.filterParam),hasLimit:!0,hasTotalCount:!1}},function(i){t.count=i.count,t.hasLoadCount=!0,FX.Utils.applyFunc(t,e,[],null)})},_createCell:function(t,i){this.options;var a=i||{tag:"td"};a.cls&&t.cls&&(t.cls=a.cls+" "+t.cls);var s=e.extend(a,t.text||t.html||!FX.Utils.isString(t)?t:{text:t}),n=e("<"+s.tag+' class="t-cell"/>');switch(n.attr({row:s.row,col:s.col}),s.hasOwnProperty("html")?n.html(s.html):n.text(s.text),s.align){case"center":n.addClass("h-center");break;case"right":n.addClass("h-right")}if(s.data)for(var o in s.data)s.data.hasOwnProperty(o)&&n.data(o,s.data[o]);return s.cls&&n.addClass(s.cls),s.colspan&&n.attr("colspan",s.colspan),s.rowspan&&n.attr("rowspan",s.rowspan),s.width&&n.width(s.width),s.height&&n.width(s.height),n},_createPagination:function(){var t=this,i=this.options;new FX.DataCountPane({renderEl:e("<div />").appendTo(this.$menu),itemsPerPage:i.itemsPerPage,count:this.count,async:this._getAsync(!0),onItemPerPageChange:function(e){i.itemsPerPage=e,t.page=0,t.reload()}});var a=this.data&&this.data.length>=i.itemsPerPage;new FX.Pagination({renderEl:e("<div />").appendTo(this.$menu),count:t.count,limit:i.itemsPerPage,curPage:t.page+1,maxCount:FX.CONST.MAX_COUNT,hasMore:a,onChangePage:function(e){t.page=e-1,t.turnPage()}})},_doShowReport:function(){this.element.closest(".fui-report").show(),this._setTitle()},_doHideReport:function(){this.element.closest(".fui-report").hide()},_doShowData:function(t,i){var a=this.data[t];if(a){var s=this.options,n=this,o=a._id,l=this.header,r=s.title;this._switchCurrentRow(t);var d=e('<div class="x-window-mask modal light"/>').css({"z-index":FX.STATIC.zIndex++}).appendTo("body");e(document).bind("keydown.left keydown.right",function(t){if(e(".x-window-mask","body").length)return t.preventDefault(),!1;e(document).unbind("keydown.left keydown.right")});var c=new FX.ReportFormDataPane({appId:s.appId,renderEl:e("<div class='x-shadow-content'/>").appendTo(d),entryId:s.forms[0],formId:s.forms[0],forms:s.forms,header:l,data:a,dataId:o,title:r,height:"100%",hasPrintBtn:s.itemPrintable,hasEditBtn:"visit"===s.mode&&s.itemEditable,hasDeleteBtn:"visit"===s.mode&&s.itemRemovable,hasSwitchBtn:!0,hasCustomPrint:!1,dataIndex:t+1,dataCount:this.data.length,onEditData:function(){d.remove()},onAfterEditData:function(e){n._doShowReport(),n._reloadWithoutCount(null,!0)},onSwitchData:function(e,t){n.data[e-1]&&d.parent().length&&(d.remove(),n._doShowData(e-1,t))},onAfterDeleteData:function(){n.turnPage(),d.remove()},onAfterCancel:function(){n._doShowReport(),d.remove(),n._doShowData(t)},onClose:function(e){n._doShowReport(),d.remove(),e&&n.reload(null,!0)}});i&&(d.remove(),c._doEditData())}},_switchCurrentRow:function(t){e("tbody > tr",this.element).removeClass("current-row"),e('tbody > tr[data-idx="'+t+'"]',this.element).addClass("current-row")},_setEvent:function(){FX.DataTable.superclass._setEvent.apply(this,arguments);var t=this,i=this.options;this.$wrapper.unbind(".data-table"),this.$wrapper.bind({"click.data-table":function(a){var s=a.target,n=a.type,o=e(s).closest("tr");if(o&&o.length>0)if(o.hasClass("th-row")){var l=e(s).closest(".th-cell");if(l&&l.length>0&&"click"===n){var r=l.data("field");if(r){if(!l.hasClass("sortable"))return;var d={},c=-1;l.hasClass("sort-asc")?(l.removeClass("sort-asc").addClass("sort-desc"),d[r]=-1,~(c=t.getSortedFieldIdx(r))?t.sort[c]=d:t.sort.push(d)):l.hasClass("sort-desc")?(l.removeClass("sort sort-desc"),~(c=t.getSortedFieldIdx(r))&&t.sort.splice(c,1)):(l.removeClass("sort-desc").addClass("sort sort-asc"),c=t.getSortedFieldIdx(r),d[r]=1,~c?t.sort[c]=d:t.sort.push(d)),t.page=0,t._reloadWithoutCount()}var u=l.find(".x-check");u&&u.length>0&&(u.toggleClass("select"),u.hasClass("select")?t.setRemoveCheckResult(!0):t.setRemoveCheckResult(!1))}}else if(o.hasClass("tb-row")){var h=e(s).closest(".table-op-btn");if("click"===n)if(h&&h.length>0){var p=h.data("op");if(!i.forms)return;if("remove_check"===p)h.hasClass("select")&&t.setRemoveCheckSelectAll(!1),h.toggleClass("select");else if("file"===p){var f=h.data("file");new FX.FilePreview({files:e.makeArray(f)})}}else{if(!FX.Utils.isEmpty(FX.Utils.getSelectionText()))return;if(e(s).closest(".nest-link").length)return;t._doShowData(parseInt(o.attr("data-idx")))}}},"mouseover.data-table":function(i){var a=e(i.target).closest("tr").attr("data-idx");FX.Utils.isNull(a)||e('tbody > tr[data-idx="'+a+'"]',t.element).addClass("hover")},"mouseout.data-table":function(i){var a=e(i.target).closest("tr").attr("data-idx");FX.Utils.isNull(a)||e('tbody > tr[data-idx="'+a+'"]',t.element).removeClass("hover")}})},_bindRowData:function(e,t,i){if(this.dataMap&&this.dataMap.length>i){var a=this.dataMap[i];t.attr("data-idx",a)}},doExcelExport:function(){var e=this.options;if(this._isFieldsValid()){var t=this.createLoadingMask();FX.Utils.dataAjax({url:e.asyncExportURL,data:{widgetId:e.widgetName,filter:this.getFilterData(this.filterParam),sort:this.sort}},function(e){t.remove(),window.location.href=e.url},function(e){t.remove();var i=e.responseJSON||{};FX.Msg.toast({type:"error",msg:i.msg||"导出失败"})})}},turnPage:function(){this._removeTable(),this._initDataTable()},reload:function(e,t,i){FX.DataTable.superclass.reload.apply(this,arguments),t||(this.page=0),i?this.hasCount=!1:(this.hasCount=!0,this.hasLoadCount=!1,this.count=0),this._setFilterParam(e),this._initDataTable()},_setFilterParam:function(e){FX.Utils.isNull(e)||(this.filterParam=e)},_reloadWithoutCount:function(e,t){this.reload(e,t,!0)},loadMore:function(e){var t=this;this.hasMore()&&!this.isLoading&&(t.page++,this._loadData(function(){t.appendData(),e&&e()}))},hasMore:function(){var e=this.options;return(this.page+1)*e.itemsPerPage<this.count},setHasCheck:function(e){this.options.hasCheck=e},setRemoveCheckSelectAll:function(e){e||this.$stickyRowHead.children(".t-head").find(".x-check").removeClass("select")},setRemoveCheckResult:function(t){t?this.$stickyRowHead.find(".x-check").each(function(t,i){e(i).addClass("select")}):this.$stickyRowHead.find(".x-check").each(function(t,i){e(i).removeClass("select")})},getCheckResult:function(){var t=[];return this.$stickyRowHead.find(".t-body .x-check").each(function(i,a){e(a).hasClass("select")&&t.push(e(a).data("dataId"))}),t},createHeadTools:function(){FX.DataTable.superclass.createHeadTools.apply(this,arguments);var t=this;this.options.itemRemovable&&e("<a/>").append('<i class="icon-trasho">').append(e("<span/>").text("批量删除")).appendTo(this.$head).click(function(){t.createTableDeleteButtons()})},createTableDeleteButtons:function(){var t=this;t.setHasCheck(!0),this.refresh(),this.$head.children("a").remove(),e("<a />").append('<i class="icon-signout">').append(e("<span />").text("退出编辑")).appendTo(this.$head).click(function(){t.setHasCheck(!1),t.refresh(),t.createHeadTools()}),e("<a />").append('<i class="icon-trasho">').append(e("<span />").text("删除选中")).appendTo(this.$head).click(function(){var e=t.getCheckResult().length;t.deleteCheckResult(!1,e)}),e("<a />").append('<i class="icon-broom">').append(e("<span />").text("清空数据")).appendTo(this.$head).click(function(){t.deleteCheckResult(!0)})},deleteCheckResult:function(t,i,a){var s,n,o=this,l=this.options;FX.Vip.hasDataBackup()?s=t?"您当前选中了全部数据，数据删除后可在回收站中恢复":'您当前选中了<span class="text warning" >'+i+"</span>条数据，数据删除后可在回收站中恢复":(s=t?"您当前选中了全部数据，免费版删除的数据无法恢复":'您当前选中了<span class="text warning" >'+i+"</span>条数据，免费版删除的数据无法恢复",n=e('<a target="jdy_doc"/>').text("恢复删除数据？了解高级版本").attr("href",FX.CONFIG.HOST.HELP_DOC_HOST+"/9136")),FX.Msg.alert({title:t?"您确定要清空所有数据吗？":"您确定要删除所选数据吗？",msg:s,tip:n,type:"warning",onOk:function(){var e={formId:l.forms[0],widgetId:l.widgetName},i=!0;if(t)e.clearAll=!0,e.filter=o.getFilterData(this.filterParam);else{var s=o.getCheckResult();s&&s.length>0?e.idList=s:i=!1}i&&FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.remove),data:e},function(e){!1===FX.Utils.applyFunc(o,a,[e.count],!1)&&(o.setHasCheck(!1),o.createHeadTools(),o.reload())})}})},getOptions:function(){var t=this.options;return e.extend(FX.DataTable.superclass.getOptions.apply(this,arguments),{relations:t.relations,joinedFields:t.joinedFields,fields:t.fields,itemEditable:t.itemEditable,itemRemovable:t.itemRemovable})}}),e.shortcut("datatable",FX.DataTable)}(jQuery),function(e){FX.CombinedTable=FX.extend(FX.Table,{GROUP_DICT:{year:"年",quarter:"季",month:"月",week:"周",day:"日",province:"省",city:"市"},GROUP_TYPE:["address","location","datetime"],_defaultConfig:function(){return e.extend(FX.CombinedTable.superclass._defaultConfig.apply(),{baseCls:"fui_combinedtable",hasMenu:!0,isHeadSticky:!0,isRowHeadSticky:!0,chunkSize:50,forms:[],relations:{},joinedFields:[],xFields:[],yFields:[],valueFields:[],asyncExportURL:FX.Utils.getApi(FX.API.data.excel_export),onItemClick:null,mode:"visit"})},_initContent:function(){FX.CombinedTable.superclass._initContent.apply(this,arguments),this._initCombinedTable()},_initCombinedTable:function(e){var t=this,i=this.options;if(this.filterParam=e,this.tableHead=[],this.tableRowHead=[],this.tableData=[],this.rowCount=0,this._isFieldsValid()){this.xGroups=this._makeGroups(i.xFields),this.yGroups=this._makeGroups(i.yFields);var a,s;"edit"===i.mode?(a=FX.Utils.getApi(FX._API.report.preview_combined_group),s={forms:i.forms,relations:i.relations,xFields:this.xGroups,yFields:this.yGroups,valFields:i.valueFields,linkWidgets:i.linkWidgets,filter:this.getFilterData(this.filterParam)}):(a=FX.Utils.getApi(FX.API.data.combined_group),s={widgetId:i.widgetName,filter:this.getFilterData(this.filterParam)}),this.loadingAjax({url:a,data:s},function(e){t.page=1,t.table=e,t._isTableEmpty(e)||(t._dealTableInfo(e),t.rowCount=t.tableData.length,t._chunkTable()),t.createTable()})}else this.createTable()},_isTableEmpty:function(e){return 0===e.data.x.length&&0===e.data.val.length},createTable:function(){FX.CombinedTable.superclass.createTable.call(this),this.options.hasMenu&&this._createPagination()},_dealTableInfo:function(e){var t=this.options;this.tableHead=[],this.tableRowHead=[],this.tableData=[],this.colDataArr=[],this.rowDataArr=[],this.rowHeadTitleRows=this._hasSubGroup(t.xFields)?2:1;var i=this._hasSubGroup(t.yFields)?2:1;this.xGroupLen=this._getXGroupLength(),this.rowHeadTitleCols=Math.max(i,this.xGroupLen);for(var a=this.yGroups.length+this.rowHeadTitleRows,s=0;s<a;s++)this.tableHead.push([]);this._createColHeadTitle(),this._createRowHeadTitle(),this._createRowHead(e),this._dealDetail(e),this._createColHeadAndData(e)},_getXGroupLength:function(){var e=this.xGroups.length;return FX.Utils.forEach(this.xGroups,function(t,i){i.detail&&(e+=i.detail.fields.length)}),e},_chunkTable:function(){var t=this,i=this.options;this.rowHeadChunks=[],FX.Utils.forEach(this.tableRowHead,function(a,s){var n=null,o=FX.Utils.chunkArray(s,i.chunkSize);FX.Utils.forEach(o,function(i,a){n&&n.rowspan&&(a[0]=n);for(var s=a.length-1;s>=0;s--){var o=a[s];if(o){o.rowspan>=a.length-s&&(n=e.extend({},o),o.rowspan=a.length-s,n.rowspan-=o.rowspan);break}}t.rowHeadChunks[i]=t.rowHeadChunks[i]||[],t.rowHeadChunks[i].push(a)})}),this.dataChunks=FX.Utils.chunkArray(this.tableData,i.chunkSize);var a=this._getPageData();this.tableHead=a.tableHead,this.tableRowHead=a.tableRowHead,this.tableData=a.tableData},_getPageData:function(){return{tableHead:this.tableHead,tableRowHead:this.rowHeadChunks[this.page-1],tableData:this.dataChunks[this.page-1]}},_hasSubGroup:function(e){var t=this,i=!1;return FX.Utils.forEach(e,function(e,a){if(t.GROUP_TYPE.indexOf(a.type)>-1)return i=!0,!1}),i},_createColHeadTitle:function(){var e,t=this;this.options;FX.Utils.forEach(this.yGroups,function(i,a){var s=t.tableHead[i];t.GROUP_TYPE.indexOf(a.type)>-1?(e&&e.text===a.text?e.rowspan+=1:(e={rowspan:1,colspan:t.rowHeadTitleCols-1,text:a.text,cls:"group-head"},s.push(e)),s.push({text:t.GROUP_DICT[a.groupBy],cls:"group-head"})):s.push({rowspan:1,colspan:t.rowHeadTitleCols,text:a.text,cls:"group-head"})})},_createRowHeadTitle:function(){var e,t=this,i=(this.options,this.tableHead[t.yGroups.length]),a=this.tableHead[t.yGroups.length+1],s=1;this.xGroupLen<this.rowHeadTitleCols&&(s=this.rowHeadTitleCols),this.xGroups.length||i.push({colspan:this.rowHeadTitleCols,cls:"group-head"}),FX.Utils.forEach(this.xGroups,function(n,o){t.GROUP_TYPE.indexOf(o.type)>-1?(e&&e.text===o.text?e.colspan+=1:(e={rowspan:1,colspan:s,text:o.text,cls:"group-head"},i.push(e)),a.push({rowspan:1,colspan:s,text:t.GROUP_DICT[o.groupBy],cls:"group-head"})):(i.push({rowspan:t.rowHeadTitleRows,colspan:s,text:o.text,cls:"group-head"}),o.detail&&FX.Utils.forEach(o.detail.fields,function(e,a){i.push({rowspan:t.rowHeadTitleCols,colspan:s,text:a.text,cls:"group-head"})}))})},_createColHeadAndData:function(e){for(var t=this,i=(this.options,e.data.val),a=i[0].data.length,s=this.tableHead,n=this.tableData,o=0;o<a;o++)n.push([]);var l=[];n.push(l);var r=null;FX.Utils.forEach(i,function(a,o){o.is_summary_col&&t.yGroups.length&&(r?r.colspan+=1:(r={text:"汇总",rowspan:t.yGroups.length,colspan:1},s[0].push(r)));var d=!0;FX.Utils.forEach(o.y,function(n,l){var r=t._getLastCell(s[n]);(d=0!==a&&(d&&i[a-1].y[n]===l))?r.colspan+=1:s[n].push({colspan:1,text:t._getGroupText(l,t.yGroups[n],e),data:{id:t._getColHeadCellData(o.y,n)},cls:"clickable"})}),s[t.yGroups.length].push({rowspan:t.rowHeadTitleRows,text:o.text}),FX.Utils.forEach(o.data,function(i,s){var l={};l=FX.Utils.isNull(s)?{text:"-",cls:"h-center"}:{field:t._getFieldTag(o),isPercent:o.isPercent,text:s,cls:"h-right clickable",data:{id:t._getCellData(e,i,a)}},n[i].push(l)}),l.push({field:o.tag,text:o.sum,isPercent:o.isPercent,cls:"h-right clickable",data:{id:t._getColHeadCellData(o.y,o.y.length-1)}})})},_getColHeadCellData:function(e,t){for(var i={},a=0;a<=t;a++){var s=this.yGroups[a];i[s.groupName||s.tag]=e[a]}return i},_getRowHeadCellData:function(e,t,i){for(var a={},s=0;s<=i;s++){var n=this.xGroups[s];a[n.groupName||n.tag||n.name]=e[s].data[t]}return a},_getCellData:function(t,i,a){var s=this.colDataArr[a],n=this.rowDataArr[i];return s||(s=this._getColHeadCellData(t.data.val[a].y,this.yGroups.length-1),this.colDataArr[a]=s),n||(n=this._getRowHeadCellData(t.data.x,i,this.xGroups.length-1),this.rowDataArr[i]=n),e.extend({},n,s)},_createRowHead:function(e){var t=this,i=(this.options,e.data.x),a=this.tableRowHead;if(i.length)for(var s=0;s<i.length;s++)a.push([]);else a.push([]);FX.Utils.forEach(i,function(s,n){var o=null;FX.Utils.forEach(n.data,function(l,r){var d=!1;if(l>0&&(d=n.data[l-1]===r,s>0&&(d=d&&FX.Utils.isNull(a[s-1][l]))),d)o.rowspan+=1,a[s].push(null);else{var c=1;t.xGroupLen<t.rowHeadTitleCols&&(c=t.rowHeadTitleCols),o={colspan:c,rowspan:1,text:t._getGroupText(r,t.xGroups[s],e),data:{id:t._getRowHeadCellData(i,l,s)},cls:"clickable"},a[s].push(o)}})}),a[0].push({text:"汇总",colspan:this.rowHeadTitleCols})},_dealDetail:function(t){var i=this,a=(this.options,0);FX.Utils.forEach(this.xGroups,function(s,n){var o=n.detail;if(!o)return!1;var l=s+a;FX.Utils.forEach(o.fields,function(n,r){var d=t.details[o.entry],c=[];FX.Utils.forEach(i.tableRowHead[l],function(t,i){var a=null;i&&d[i.text]&&(a=e.extend({},i,{text:d[i.text][r.name]})),c.push(a)}),a++,i.tableRowHead.splice(s+a,0,c)})})},_getGroupText:function(e,t,i){var a=e;switch(t.type){case"user":case"id":var s=i.user[e];a=s?s.nickname:e;break;case"dept":case"did":var n=i.department[e];a=n?n.name:e}return a},doExcelExport:function(){var e=this.options;this._isFieldsValid()&&FX.Utils.dataAjax({url:e.asyncExportURL,data:{widgetId:e.widgetName,filter:this.getFilterData(this.filterParam)}},function(e){window.location.href=e.url},function(e){var t=e.responseJSON||{};FX.Msg.toast({type:"error",msg:t.msg||"导出失败"})})},_createPagination:function(){var t=this,i=this.options;new FX.Pagination({renderEl:e("<div />").appendTo(this.$menu),count:this.rowCount,limit:i.chunkSize,curPage:this.page,hasTurnLast:!0,onChangePage:function(e){t.page=e,t.turnPage()}})},turnPage:function(){this._removeTable(),e.extend(this,this._getPageData()),this.createTable()},_getLastCell:function(e){return e.length?e[e.length-1]:null},_isFieldsValid:function(){var e=this.options,t=!0;return t&=e.forms.length>0,t&=0!==e.valueFields.length,t&=0!==e.xFields.length||0!==e.yFields.length,FX.Utils.applyFunc(this,e.onCheckValid,[],!1),!!t},_setEvent:function(){FX.CombinedTable.superclass._setEvent.apply(this,arguments);var t=this,i=this.options;this.$wrapper.off(".combined-table"),this.$wrapper.on("click.combined-table",".t-cell",function(a){var s=e(a.currentTarget).data("id");if(s){var n=t._getGroupIdCondition(s),o=t._getLinkParams(n);o=t._getLinkFilterParams(o),FX.Utils.applyFunc(t,i.onItemClick,[o],!1)}})},_getGroupIdCondition:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var a=i,s=i.match(/(createTime|updateTime|\d{13})_([a-zA-Z]+)/);if(s&&s.length>1){var n=s[s.length-1];a=i.replace("_"+n,""),t.hasOwnProperty(a)||(t[a]={}),t[a][n]=e[i]}else t[a]=e[i]}return t},_getLinkParams:function(t){var i=this;if(t){var a=[];return FX.Utils.forEach(t,function(s){var n=i._getFieldByName(s),o=t[s];switch(n.type){case"datetime":o=FX.Utils.getDateRange(o);break;case"address":case"location":o=FX.Utils.getArrayFromRange(o,"address")}a.push(e.extend(FX.Utils.getLinkFilter(n,o),{field:n.name}))}),a}},_getFieldByName:function(e){var t=this.options,i=[].concat(t.xFields,t.yFields),a=null;return FX.Utils.forEach(i,function(t,i){if((i.tag||i.name)===e)return a=i,!1}),a},reload:function(e){FX.CombinedTable.superclass.reload.apply(this,arguments),this._initCombinedTable(e)},getOptions:function(){var t=this.options;return e.extend(FX.CombinedTable.superclass.getOptions.apply(this,arguments),{isHeadSticky:t.isHeadSticky,isRowHeadSticky:t.isRowHeadSticky,forms:t.forms,relations:t.relations,joinedFields:t.joinedFields,xFields:t.xFields,yFields:t.yFields,valueFields:t.valueFields})},_appendTableData:function(){var e=this;this.options;this.formatMap={},FX.Utils.forEach(this.table&&this.table.valFields,function(t,i){i.cellFmt&&!i.isPercent&&(e.formatMap[e._getFieldTag(i)]=i.cellFmt.data)}),FX.CombinedTable.superclass._appendTableData.apply(this,arguments)},_getFieldTag:function(e){var t=e.tag||e.name;return e.isPercent&&(t+="_percent"),t},_formatCell:function(t){var i=e.extend({},t),a=i.field;a&&(a=a.replace("%","."));var s=this.formatMap[a];if(!t.isPercent){var n=FX.Utils.fixDecimalPrecision(t.text);i.text=FX.Utils.num2Str(n,s)||"-"}return i}}),e.shortcut("combinedtable",FX.CombinedTable)}(jQuery),function(e){FX.Parameter=FX.extend(FX.Block,{_defaultConfig:function(){return e.extend(FX.Parameter.superclass._defaultConfig.apply(),{baseCls:"fui_parameter",height:null,width:null,fields:[],showFields:null,filter:null,authGroupId:null,onBeforeConvertField:null,onStopEdit:null,onAfterShowFieldsSelected:null})},_initContent:function(e){FX.Parameter.superclass._initContent.apply(this,arguments);var t=this.options,i=this;this.fieldMap={};var a=this._dealFields(t.fields);FX.Utils.forEach(a,function(e,t){i._createItem(t)})},_dealFields:function(t){var i=[];return FX.Utils.forEach(t,function(t,a){"subform"===a.type?FX.Utils.forEach(a.items,function(t,s){i.push(e.extend({},s,{text:[a.text,s.text].join("."),name:[a.name,s.name].join(".")}))}):i.push(a)}),i},setFields:function(e){var t=this.options,i=[],a=this._dealFields(t.showFields);FX.Utils.forEach(a,function(t,a){e.indexOf(a.name)>=0&&i.push(a)}),t.fields=i,this.rebuild()},_createItem:function(t){var i=this.options,a=this,s=e('<div class="fui_parameter_cell"/>').appendTo(this.$body),n=a.getConfigFromItem(t);if(n){e('<div class="cell-title"/>').text(n.title).appendTo(s),n.renderEl=e("<div/>").appendTo(s);n.onStopEdit=function(){var e=JSON.stringify(this.getValue());this.oldValue&&this.oldValue==e||(this.oldValue=e,FX.Utils.applyFunc(a,i.onStopEdit,[t.id],!1))};var o=FX.createWidget(n);s.data("widget",o),this.fieldMap[o.getWidgetName()]=t}},_resizeBody:function(){},getConfigFromItem:function(t){var i=this.options,a={title:t.text,value:this._parseDefaultValue(t)};if(!1===FX.Utils.applyFunc(this,i.onBeforeConvertField,[a,t],!1))switch(t.type){case"text":case"radiogroup":case"combo":"creator"===t.name?e.extend(a,this._getUserConfig(t)):e.extend(a,this._getComboConfig(t));break;case"number":a.type="numberlimit";break;case"datetime":a.type="datelimit";break;case"address":a.type="address",a.needDetail=!1;break;case"dept":a.type="deptselect",a.limit=this._getComboConfig(t).async;break;case"user":e.extend(a,this._getUserConfig(t));break;default:"creator"===t.name&&e.extend(a,this._getUserConfig(t))}return FX.Utils.isNull(a.type)?null:a},_parseDefaultValue:function(t){if(t.defaultValue){var i;if("datetime"===t.type&&t.defaultValue){i={};var a=t.defaultValue,s=new Date,n=s.getTime();switch(a.type){case"today":i.min=n,i.max=n;break;case"yesterday":i.min=n-864e5,i.max=n-864e5;break;case"lastWeek":i.min=n-6048e5,i.max=n;break;case"thisWeek":i.min=FX.Utils.getWeekStartDate(s).getTime(),i.max=FX.Utils.getWeekEndDate(s).getTime();break;case"thisMonth":i.min=FX.Utils.getMonthStartDate(s).getTime(),i.max=FX.Utils.getMonthEndDate(s).getTime();break;case"formula":var o,l;o="before"===a.min.type?-1*a.min.value:a.min.value,l="before"===a.max.type?-1*a.max.value:a.max.value,i.min=n+o,i.max=n+l;break;default:i.min=a.min,i.max=a.max}}else if("user"!==t.type&&"creator"!==t.name||!t.defaultValue)i=e.extend(!0,{},t.defaultValue);else{var r=[].concat(t.defaultValue.items||[]),d=r.indexOf(FX.USER_ID.CurrentUser);d>-1&&(!FX.STATIC.user||!FX.STATIC.user._id||r.indexOf(FX.STATIC.user._id)>-1?r.splice(d,1):r[d]=FX.STATIC.user._id),i={items:r,hasEmpty:t.defaultValue.hasEmpty}}return i}},_getComboConfig:function(e){var t=this.options,i=FX.Utils.getFieldInfoById(e.id);return{type:"xcombocheck",async:{url:FX.Utils.getApi(FX.API.data.distinct),data:{refAppId:i.appId,formId:i.entryId,field:e.name,type:e.type,authGroupId:t.authGroupId,filter:t.filter}},hasLimit:!0,searchable:!0,width:150}},_getUserConfig:function(t){return e.extend(this._getComboConfig(t),{type:"usercheck",textField:"nickname",valueField:"_id"})},getOptions:function(){var t=this.options;return e.extend(FX.Parameter.superclass.getOptions.apply(this,arguments),{fields:t.fields})},removeField:function(t){e(".fui_parameter_cell",this.element).eq(t).remove()},updateField:function(t,i){FX.Utils.isNull(i)||(e(".fui_parameter_cell",this.element).eq(i).children(".cell-title").text(t.text),e(".fui_parameter_cell",this.element).eq(i).data("widget").setValue(this._parseDefaultValue(t)))},addField:function(e){this._createItem(e)},checkValidate:function(){if(!this.options.allowBlank){var t=e(".fui_parameter_cell",this.element),i=!0;return FX.Utils.forEach(t,function(t,a){var s=e(a).data("widget");if(s){var n=s.getValue();return FX.Utils.isObjectEmpty(n)?(i=!1,!1):void 0}}),i}return!0},_checkWidgetValue:function(e,t){var i=!1;switch(e){case"xcombocheck":case"usercheck":i=t.hasEmpty||!FX.Utils.isObjectEmpty(t.value);break;case"deptselect":i=t.hasEmpty||t.hasCurrentDept||!FX.Utils.isObjectEmpty(t.value);default:t.value.length>0&&FX.Utils.forEach(t.value,function(e,t){if(!FX.Utils.isNull(t))return i=!0,!1})}return i},_getFilterByWidget:function(t,i){var a={type:i.type};e.extend(a,FX.Utils.dealFilterInfoByField(i));var s=t.getValue();switch(t.options.type){case"usercheck":e.extend(a,{type:"user",method:FX.CONST.FILTER_METHOD.IN,value:s.items,hasEmpty:!!s.hasEmpty});break;case"xcombocheck":e.extend(a,{type:"text",method:FX.CONST.FILTER_METHOD.IN,value:s.items,hasEmpty:!!s.hasEmpty});break;case"deptselect":e.extend(a,{method:FX.CONST.FILTER_METHOD.IN,value:s.items,hasEmpty:!!s.hasEmpty,hasCurrentDept:!!s.hasCurrentDept});break;case"datelimit":e.extend(a,{method:FX.CONST.FILTER_METHOD.RG,value:FX.Utils.getArrayFromRange(s,"datetime")});break;case"numberlimit":e.extend(a,{method:FX.CONST.FILTER_METHOD.RG,value:FX.Utils.getArrayFromRange(s,"number")});break;case"address":e.extend(a,{method:FX.CONST.FILTER_METHOD.ALL,value:FX.Utils.getArrayFromRange(s,"address")});break;default:e.extend(a,{method:FX.CONST.FILTER_METHOD.EQ,value:e.makeArray(s)})}return a},getValue:function(){var t=e(".fui_parameter_cell",this.element),i=[],a=this;this.options;return FX.Utils.forEach(t,function(t,s){var n=e(s).data("widget");if(n){var o=a.fieldMap[n.getWidgetName()],l=a._getFilterByWidget(n,o);a._checkWidgetValue(n.options.type,l)&&i.push(l)}}),i}}),e.shortcut("parameter",FX.Parameter)}(jQuery),FX.SubformItem=FX.extend(FX.FormItem,{_defaultConfig:function(){return $.extend(FX.SubformItem.superclass._defaultConfig.apply(),{subform:"",widget:{},onBeforeWidgetCreate:null})},_render:function(){this._renderField()},_renderField:function(){var e=this.options,t=$.extend({renderEl:this.element},this.widget);if(FX.Utils.applyFunc(this,e.onBeforeWidgetCreate,[t],!1),!1===t.enable&&FX.LimitFields.disable.indexOf(t.type)>-1){var i="fui_subform_item_disable";"textarea"===this.widget.type&&(i+=" wrap"),this.field=new FX.FormItemDisable($.extend(t,{widgetType:this.widget.type,customCls:i,subform:e.subform}))}else this.field=FX.createWidget(this._getFieldConfig(t))},_getFieldConfig:function(e){var t=this,i=this.options;switch(e.oriType=e.type,e.subform=i.subform,e.type){case"address":case"user":case"usergroup":case"dept":case"deptgroup":case"radiogroup":case"checkboxgroup":case"upload":case"image":case"location":case"text":case"textarea":case"datetime":case"number":case"combo":case"combocheck":e.type="subform_"+e.type,e.height=30;break;case"linkquery":e.onRelyDone=function(){FX.Utils.applyFunc(t,i.onRelyDone,[t],!1)}}return e},isSubformWidget:function(){return!0},getSubformName:function(){return this.options.subform}}),function(e){FX.SubformBase=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.SubformBase.superclass._defaultConfig.apply(),{oriType:""})},_init:function(){FX.SubformBase.superclass._init.apply(this,arguments),this._createOriWidget()},_createOriWidget:function(){this.oriWidget=FX.createWidget(e.extend(this.getOptions(),{renderEl:e("<div/>").appendTo(this.element)}))},getValue:function(){return this.oriWidget.getValue()},setValue:function(e){this.oriWidget.setValue(e)},setText:function(e){this.oriWidget.setText(e)},getText:function(){return this.oriWidget.getText()},getWidgetType:function(){return this.options.oriType},getNullValue:function(){return this.oriWidget.getNullValue()},checkValidate:function(){return this.oriWidget.checkValidate()},getCacheValue:function(){return this.oriWidget.getCacheValue()},setCacheValue:function(e){this.oriWidget.setCacheValue(e)},getOptions:function(){var t=this.options;return e.extend(FX.SubformBase.superclass.getOptions.apply(this,arguments),{type:t.oriType,fieldWidth:t.fieldWidth})}}),e.shortcut("subform_base",FX.SubformBase)}(jQuery),FX.SubformText=FX.extend(FX.SubformBase,{_defaultConfig:function(){return $.extend(FX.SubformText.superclass._defaultConfig.apply(),{noRepeat:!1,regex:null,scan:!1})},_createOriWidget:function(){var e=this,t=this.options;this.oriWidget=FX.createWidget($.extend(this.getOptions(),{renderEl:$("<div/>").appendTo(this.element),onStopEdit:function(){FX.Utils.applyFunc(e,t.onStopEdit,[],!1)}}))},getOptions:function(){var e=this.options;return $.extend(FX.SubformText.superclass.getOptions.apply(this,arguments),{regex:e.regex,scan:e.scan})}}),$.shortcut("subform_text",FX.SubformText),FX.SubformTextarea=FX.extend(FX.SubformText,{}),$.shortcut("subform_textarea",FX.SubformTextarea),FX.SubformNumber=FX.extend(FX.SubformText,{_defaultConfig:function(){return $.extend(FX.SubformNumber.superclass._defaultConfig.apply(),{allowDecimals:!1,allowNegative:!0})},getOptions:function(){var e=this.options;return $.extend(FX.SubformNumber.superclass.getOptions.apply(this,arguments),{allowDecimals:e.allowDecimals,allowNegative:e.allowNegative})}}),$.shortcut("subform_number",FX.SubformNumber),FX.SubformCombo=FX.extend(FX.SubformBase,{_defaultConfig:function(){return $.extend(FX.SubformCombo.superclass._defaultConfig.apply(),{noRepeat:!1,async:null,items:[{value:"选项1",text:"选项1"},{value:"选项2",text:"选项2"},{value:"选项3",text:"选项3"}]})},_createOriWidget:function(){var e=this,t=this.options;this.oriWidget=FX.createWidget($.extend(this.getOptions(),{renderEl:$("<div/>").appendTo(this.element),subform:t.subform,onBeforeAsync:function(){FX.Utils.applyFunc(e,t.onBeforeAsync,[],!1)},onStopEdit:function(){FX.Utils.applyFunc(e,t.onStopEdit,[],!1)}})),this.oriWidget.resizeTextOther()},getOptions:function(){var e=this.options,t={};return e.async&&e.async.url?t.async=e.async:t.items=e.items,$.extend(FX.SubformCombo.superclass.getOptions.apply(this,arguments),t)}}),$.shortcut("subform_combo",FX.SubformCombo),FX.SubformCombocheck=FX.extend(FX.SubformCombo,{_initDefaultValue:function(){var e=this.options;null!=e.value&&this.setValue(e.value)}}),$.shortcut("subform_combocheck",FX.SubformCombocheck),FX.SubformDate=FX.extend(FX.SubformBase,{_defaultConfig:function(){return $.extend(FX.SubformDate.superclass._defaultConfig.apply(),{format:"yyyy-MM-dd"})},_createOriWidget:function(){var e=this,t=this.options;this.oriWidget=FX.createWidget($.extend(this.getOptions(),{renderEl:$("<div/>").appendTo(this.element),onStopEdit:function(){FX.Utils.applyFunc(e,t.onStopEdit,[],!1)}}))},getOptions:function(){var e=this.options;return $.extend(FX.SubformDate.superclass.getOptions.apply(this,arguments),{format:e.format})}}),$.shortcut("subform_datetime",FX.SubformDate),function(e){FX.SubformUser=FX.extend(FX.SubformBase,{_defaultConfig:function(){return e.extend(FX.SubformUser.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_subform_user",oriType:"user",title:"成员列表",limit:{},limitWidget:"",value:null,allowBlank:!0,dynamicFields:[{id:FX.USER_ID.CurrentUser,name:"当前用户"}],dynamicType:"select",onBeforeEdit:null,onStopEdit:null})},_init:function(){FX.SubformUser.superclass._init.apply(this,arguments),this._createTriggerBtn(),this._createSelectList()},_createOriWidget:function(){var e=this.options,t={type:e.oriType,limit:e.limit,limitWidget:e.limitWidget,allowBlank:e.allowBlank,visible:e.visible,enable:e.enable,dynamicType:e.dynamicType};this.oriWidget=FX.createWidget(t)},_createTriggerBtn:function(){var t=this;this.$selectTrigger=e('<div class="select-trigger"><i class="widget-icon icon-widget-user"/></div>').click(function(){t._createSelectDialog()}).appendTo(this.element)},_createSelectDialog:function(){var e=this.oriWidget,t=this.options,i=this;if(e.isEnabled()){FX.Utils.applyFunc(i,t.onBeforeEdit,[],!1);var a=new FX.ConfirmDialog({title:t.title,width:610,contentWidget:{rowSize:[440],colSize:[570],items:[[{widgetName:t.widgetName,type:t.oriType,editable:!0,limit:t.limit,limitWidget:t.limitWidget,items:e.items,value:e.value,onStopEdit:t.onStopEdit}]]},onOk:function(){var s=a.getWidgetByName(t.widgetName);return e.value=s.getValue(),e.items=s.getItems(),e._initSelectPane(),i._createSelectList(),FX.Utils.applyFunc(i,t.onStopEdit,[],!1),!1}});a.show()}},_createSelectList:function(){if(this.$selectList?this.$selectList.empty():this.$selectList=e('<span class="select-list"/>').prependTo(this.$selectTrigger),FX.Utils.isExternalLink())e('<div class="nonsupport-msg"/>').text("外链不支持成员字段").appendTo(this.element.empty());else{var t=this.oriWidget.getCacheValue();t&&e('<span class="select-item"/>').text(t.name).prepend('<i class="select-icon icon-member-normal"/>').appendTo(this.$selectList)}},getOptions:function(t){var i=this.options;return e.extend(FX.SubformUser.superclass.getOptions.apply(this,arguments),{limit:i.limit,limitWidget:i.limitWidget,value:"save"===t?this.oriWidget._parseDefaultValue(i.value):i.value,valueOption:i.valueOption,type:i.oriType})},setCacheValue:function(e){FX.Utils.applyFunc(this,FX.SubformUser.superclass.setCacheValue,[e],!1),this._createSelectList()},setValue:function(e){FX.Utils.applyFunc(this,FX.SubformUser.superclass.setValue,[e],!1),this._createSelectList()}}),e.shortcut("subform_user",FX.SubformUser)}(jQuery),function(e){FX.SubformUserGroup=FX.extend(FX.SubformUser,{_defaultConfig:function(){return e.extend(FX.SubformUserGroup.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_subform_usergroup",oriType:"usergroup"})},_init:function(){FX.SubformUserGroup.superclass._init.apply(this,arguments)},_createTriggerBtn:function(){var t=this;this.$selectTrigger=e('<div class="select-trigger"><i class="widget-icon icon-widget-usergroup"/></div>').click(function(){t._createSelectDialog()}).appendTo(this.element)},_createSelectList:function(){if(this.$selectList?this.$selectList.empty():this.$selectList=e('<span class="select-list"/>').prependTo(this.$selectTrigger),FX.Utils.isExternalLink())e('<div class="nonsupport-msg"/>').text("外链不支持成员字段").appendTo(this.element.empty());else{var t=this,i=this.oriWidget.getCacheValue();FX.Utils.isObjectEmpty(i)||FX.Utils.forEach(i,function(i,a){e('<span class="select-item"/>').text(a.name).prepend('<i class="select-icon icon-member-normal"/>').appendTo(t.$selectList)})}}}),e.shortcut("subform_usergroup",FX.SubformUserGroup)}(jQuery),function(e){FX.SubformDept=FX.extend(FX.SubformBase,{_defaultConfig:function(){return e.extend(FX.SubformDept.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_subform_dept",oriType:"dept",title:"部门列表",value:null,allowBlank:!0,limit:{},dynamicType:"select",valueOption:FX.WidgetValueOption.CUSTOM,onBeforeEdit:null})},_init:function(){FX.SubformDept.superclass._init.apply(this,arguments),this._createTriggerBtn(),this._createSelectList()},_createOriWidget:function(){var e=this.options,t={type:e.oriType,limit:e.limit,rely:e.rely,allowBlank:e.allowBlank,visible:e.visible,enable:e.enable,dynamicType:e.dynamicType};this.oriWidget=FX.createWidget(t)},_createTriggerBtn:function(){var t=this;this.$selectTrigger=e('<div class="select-trigger"><i class="widget-icon icon-widget-dept"/></div>').click(function(){t._createSelectDialog()}).appendTo(this.element)},_createSelectDialog:function(){var e=this.oriWidget,t=this.options,i=this;e.isEnabled()&&!1===FX.Utils.applyFunc(i,t.onBeforeEdit,[function(){i._showEditDialog()}],!1)&&i._showEditDialog()},_showEditDialog:function(){var e=this.oriWidget,t=this.options,i=this,a=new FX.ConfirmDialog({title:t.title,width:610,contentWidget:{rowSize:[440],colSize:[570],items:[[{widgetName:t.widgetName,type:t.oriType,editable:!0,limit:t.limit,rely:t.rely,items:e.items,value:e.value,valueOption:t.valueOption,onStopEdit:t.onStopEdit}]]},onOk:function(){var s=a.getWidgetByName(t.widgetName);return e.value=s.getValue(),e.items=s.getItems(),e._initSelectPane(),i._createSelectList(),FX.Utils.applyFunc(i,t.onStopEdit,[],!1),!1}});a.show()},_createSelectList:function(){if(this.$selectList?this.$selectList.empty():this.$selectList=e('<span class="select-list"/>').prependTo(this.$selectTrigger),FX.Utils.isExternalLink())e('<div class="nonsupport-msg"/>').text("外链不支持部门字段").appendTo(this.element.empty());else{var t=this.oriWidget.getCacheValue();t&&e('<span class="select-item"/>').text(t.name).prepend('<i class="select-icon dept-icon icon-department"/>').appendTo(this.$selectList)}},clearLimit:function(){this.options.limit={}},getOptions:function(t){var i=this.options;return e.extend(FX.SubformDept.superclass.getOptions.apply(this,arguments),{limit:i.limit,value:"save"===t?this._parseDefaultValue(i.value):i.value,valueOption:i.valueOption,type:i.oriType})},setCacheValue:function(e){FX.Utils.applyFunc(this,FX.SubformDept.superclass.setCacheValue,[e],!1),this._createSelectList()},setValue:function(e){FX.Utils.applyFunc(this,FX.SubformDept.superclass.setValue,[e],!1),this._createSelectList()}}),e.shortcut("subform_dept",FX.SubformDept)}(jQuery),function(e){FX.SubformDeptGroup=FX.extend(FX.SubformDept,{_defaultConfig:function(){return e.extend(FX.SubformDeptGroup.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_subform_deptgroup",oriType:"deptgroup"})},_init:function(){FX.SubformDeptGroup.superclass._init.apply(this,arguments)},_createTriggerBtn:function(){var t=this;this.$selectTrigger=e('<div class="select-trigger"><i class="widget-icon icon-widget-deptgroup"/></div>').click(function(){t._createSelectDialog()}).appendTo(this.element)},_createSelectList:function(){if(this.$selectList?this.$selectList.empty():this.$selectList=e('<span class="select-list"/>').prependTo(this.$selectTrigger),FX.Utils.isExternalLink())e('<div class="nonsupport-msg"/>').text("外链不支持部门字段").appendTo(this.element.empty());else{var t=this,i=this.oriWidget.getCacheValue();FX.Utils.isObjectEmpty(i)||FX.Utils.forEach(i,function(i,a){e('<span class="select-item"/>').text(a.name).prepend('<i class="select-icon dept-icon icon-department"/>').appendTo(t.$selectList)})}}}),e.shortcut("subform_deptgroup",FX.SubformDeptGroup)}(jQuery),function(e){FX.SubformAddress=FX.extend(FX.SubformBase,{_defaultConfig:function(){return e.extend(FX.SubformAddress.superclass._defaultConfig.apply(),{baseCls:"fui_subform_address",needDetail:!0,allowBlank:!0,onStopEdit:null})},_init:function(){FX.SubformAddress.superclass._init.apply(this,arguments);var t=this;this.$input=e('<input readonly onfocus="this.blur()" unselectable="on"/>').appendTo(this.element),e('<i class="icon-widget-address"/>').appendTo(this.element),this.element.on("click",function(i){t.oriWidget.isEnabled()&&t._showTriggerView(e(i.currentTarget))})},_createOriWidget:function(){var e=this.options,t=this,i={type:e.oriType,allowBlank:e.allowBlank,needDetail:e.needDetail,visible:e.visible,enable:e.enable,onStopEdit:function(){t._showSelectValue()}};e.needDetail?(i.width=370,i.width4province=150,i.width4city=105,i.width4district=105):(i.width=310,i.width4province="100%",i.width4city=150,i.width4district=150),this.oriWidget=FX.createWidget(i)},_showTriggerView:function(t){var i=this,a=this.options;this.$triggerView||(this.$triggerView=e('<div class="subform-address-trigger"/>'),this.oriWidget.element.appendTo(this.$triggerView)),FX.Msg.bubble({anchor:t,contentHTML:this.$triggerView,text4Cancel:null,text4Ok:null,contentPadding:0,hasTriangle:!1,hAdjust:120,animation:!1,edge:240,minWidth:340,onClose:function(){i.$triggerView.detach(),i._showSelectValue(),FX.Utils.applyFunc(i,a.onStopEdit,[],null)}})},_showSelectValue:function(){this.$input.val(this.getText())},getOptions:function(){var t=this.options;return e.extend(FX.SubformAddress.superclass.getOptions.apply(this,arguments),{type:this.oriWidget.getWidgetType(),needDetail:t.needDetail})},getText:function(){var e=this.getValue();return[e.province||"",e.city||"",e.district||"",e.detail||""].join("")},setCacheValue:function(e){FX.Utils.applyFunc(this,FX.SubformAddress.superclass.setCacheValue,[e],!1),this._showSelectValue()},setValue:function(e){FX.Utils.applyFunc(this,FX.SubformAddress.superclass.setValue,[e],!1),this._showSelectValue()}}),e.shortcut("subform_address",FX.SubformAddress)}(jQuery),function(e){FX.SubformLocation=FX.extend(FX.SubformBase,{_defaultConfig:function(){return e.extend(FX.SubformLocation.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_subform_location",iconCls:"icon-widget-location",oriType:"location"})},_init:function(){FX.SubformLocation.superclass._init.apply(this,arguments);var t=this.options,i=this,a=e('<div class="location-subform-wrapper"><div class="btn-icon-wrapper"><i class="'+t.iconCls+'"></i></div></div>').on("click",function(a){t.enable&&FX.Msg.bubble({anchor:e(a.currentTarget),contentHTML:i.$triggerView,text4Ok:"",text4Cancel:"",hAdjust:100,minWidth:340,hasTriangle:!1,contentPadding:0,onClose:function(){return i.$triggerView.detach(),!1}})}).toggleClass("x-ui-disable",!t.enable).appendTo(this.element);this.$text=e('<div class="location-text"/>').prependTo(a)},_createOriWidget:function(){var t=this.options;this._renderTriggerView();var i=e(".location-bubble",this.$triggerView);this.oriWidget=FX.createWidget({type:t.oriType,allowBlank:t.allowBlank,visible:t.visible,enable:t.enable,customCls:"sub-location",btnWidth:t.btnWidth,lnglatVisible:t.lnglatVisible,renderEl:e("<div/>").appendTo(i)})},_renderTriggerView:function(){var t=this.options;this.$triggerView||(this.$triggerView=e('<div class="'+t.baseCls+'"/>')),this.$triggerView.empty(),e('<div class="location-bubble"/>').appendTo(this.$triggerView)},setValue:function(e){FX.SubformLocation.superclass.setValue.apply(this,arguments),this.$text.text(FX.Utils.address2Str(e,"","pcda"))},getOptions:function(){var t=this.options;return e.extend(FX.SubformLocation.superclass.getOptions.apply(this,arguments),{type:this.oriWidget.getWidgetType(),adjustable:t.adjustable,radius:t.radius,limits:t.limits,lnglatVisible:t.lnglatVisible})}}),e.shortcut("subform_location",FX.SubformLocation)}(jQuery),function(e){FX.SubformRadioGroup=FX.extend(FX.SubformBase,{_defaultConfig:function(){return e.extend(FX.SubformRadioGroup.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_subform_radiogroup",type:"radiogroup",items:[{value:"选项1",text:"选项1"},{value:"选项2",text:"选项2"},{value:"选项3",text:"选项3"}]})},_init:function(){FX.SubformRadioGroup.superclass._init.apply(this,arguments),this._createTriggerBtn(),this._showSelectValue()},_createOriWidget:function(){var e=this,t=this.options,i={type:t.oriType,items:t.items,allowBlank:t.allowBlank,visible:t.visible,enable:t.enable,onAfterItemSelect:function(t,i){i&&i.isOther||e.bubble&&e.bubble.close()}};this.oriWidget=FX.createWidget(i)},_createTriggerBtn:function(){var t=this;this.$selectTrigger=e('<div class="select-trigger"><span class="select-val"></span><i class="widget-icon icon-widget-radiogroup"/></div>').click(function(){t.oriWidget.isEnabled()&&t._createTriggerView()}).appendTo(this.element)},_createTriggerView:function(){var t=this,i=this.options;this.$triggerView||(this.$triggerView=e('<div class="group-trigger-view"></div>').append(this.oriWidget.element)),this.bubble=FX.Msg.bubble({anchor:this.$selectTrigger,contentHTML:this.$triggerView,text4Ok:"",text4Cancel:"",hasTriangle:!1,hAdjust:70,minWidth:200,contentPadding:0,onClose:function(){return t.$triggerView.detach(),t._showSelectValue(),FX.Utils.applyFunc(t,i.onStopEdit,[],!1),!1}})},_showSelectValue:function(){var t=this.oriWidget.getValue();e(".select-val",this.$selectTrigger).text(t)},getOptions:function(){var t=this.options;return e.extend(FX.SubformRadioGroup.superclass.getOptions.apply(this,arguments),{items:t.items,type:t.oriType})},setCacheValue:function(e){FX.Utils.applyFunc(this,FX.SubformRadioGroup.superclass.setCacheValue,[e],!1),this._showSelectValue()},setValue:function(e){FX.Utils.applyFunc(this,FX.SubformRadioGroup.superclass.setValue,[e],!1),this._showSelectValue()}}),e.shortcut("subform_radiogroup",FX.SubformRadioGroup)}(jQuery),function(e){FX.SubformCheckboxGroup=FX.extend(FX.SubformBase,{_defaultConfig:function(){return e.extend(FX.SubformCheckboxGroup.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_subform_checkboxgroup",oriType:"checkboxgroup",items:[{value:"选项1",text:"选项1"},{value:"选项2",text:"选项2"},{value:"选项3",text:"选项3"}]})},_init:function(){FX.SubformCheckboxGroup.superclass._init.apply(this,arguments),this._createTriggerBtn(),this._showSelectValue()},_createOriWidget:function(){var e=this.options,t=this,i={type:e.oriType,items:e.items,allowBlank:e.allowBlank,visible:e.visible,enable:e.enable,onAfterItemSelect:function(){t._showSelectValue(),FX.Utils.applyFunc(t,e.onStopEdit,[],!1)}};this.oriWidget=FX.createWidget(i)},_createTriggerBtn:function(){var t=this;this.$selectTrigger=e('<div class="select-trigger"><span class="select-val"></span><i class="widget-icon icon-widget-checkboxgroup"/></div>').click(function(){t.oriWidget.isEnabled()&&t._createTriggerView()}).appendTo(this.element)},_createTriggerView:function(){var t=this;this.$triggerView||(this.$triggerView=e('<div class="group-trigger-view"></div>').append(this.oriWidget.element)),this.bubble=FX.Msg.bubble({anchor:this.$selectTrigger,contentHTML:this.$triggerView,text4Ok:"",text4Cancel:"",hasTriangle:!1,hAdjust:95,minWidth:200,contentPadding:0,onClose:function(){return t.$triggerView.detach(),t._showSelectValue(),!1}})},_showSelectValue:function(){var t=this.oriWidget.getValue();e(".select-val",this.$selectTrigger).text(t)},getOptions:function(){var t=this.options;return e.extend(FX.SubformCheckboxGroup.superclass.getOptions.apply(this,arguments),{items:t.items,type:t.oriType})},setCacheValue:function(e){FX.Utils.applyFunc(this,FX.SubformCheckboxGroup.superclass.setCacheValue,[e],!1),this._showSelectValue()},setValue:function(e){FX.Utils.applyFunc(this,FX.SubformCheckboxGroup.superclass.setValue,[e],!1),this._showSelectValue()}}),e.shortcut("subform_checkboxgroup",FX.SubformCheckboxGroup)}(jQuery),function(e){FX.SubformFileUpload=FX.extend(FX.SubformBase,{_defaultConfig:function(){return e.extend(FX.SubformFileUpload.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_subform_file_upload",iconCls:"icon-widget-upload",uploadTokenURL:FX.Utils.getApi(FX.API.file.upload_token,FX.STATIC.APPID),waterMark:"暂无内容"})},_init:function(){FX.SubformFileUpload.superclass._init.apply(this,arguments),this._createSubformUploadBtn(),this._createOriWidget()},_createSubformUploadBtn:function(){var t=this.options,i=this;this.$btn=e('<div class="upload-subform-btn"><div class="btn-icon-wrapper"><i class="'+t.iconCls+'"/></div></div>').on("click",function(a){var s=e(a.target).closest(".thumbnail");if(s&&s.length)return new FX.FilePreview({files:i.oriWidget.files,currentItem:s.index(),autoClose:!1}),!1;t.enable&&FX.Msg.bubble({anchor:i.$btn,contentHTML:i.$triggerView,text4Ok:"",text4Cancel:"",hAdjust:53,minWidth:340,hasTriangle:!1,contentPadding:0,onClose:function(){return i.$triggerView.detach(),!1}})}).toggleClass("x-ui-disable",!t.enable).appendTo(this.element),this.$subWrapper=e('<div class="subform-thumb-wrapper"/>').attr("data-watermark",t.waterMark).prependTo(this.$btn)},_createOriWidget:function(){var t=this.options,i=this;this.$triggerView=e('<div class="'+t.baseCls+'"/>');var a={renderEl:e('<div class="upload-bubble"/>').appendTo(this.$triggerView),type:t.oriType,baseCls:"fui_upload",uploadTokenURL:t.uploadTokenURL,thumbWidth:60,thumbHeight:60,progressWidth:310,progressHeight:20,hasEmptyTip:!0,fileThumbSize:"small",width:"100%",height:"100%",enable:t.enable,maxFileSize:t.maxFileSize,maxLimitTip:t.maxLimitTip,maxFileCount:t.maxFileCount,visible:t.visible,allowBlank:t.allowBlank,compressed:t.compressed,onlyCamera:t.onlyCamera,onFileThumbCreate:function(a){switch(t.maxFileCount===FX.CONST.UPLOAD_FILE_COUNT.SINGLE&&i.$subWrapper.empty(),a.type){case"normal":var s=e('<div class="thumbnail"/>').appendTo(i.$subWrapper);FX.Utils.createFileThumb(a.ext,"tiny").appendTo(s);break;case"local":var n=this.drawLocalPreview(a.ext,13,13);e('<div class="thumbnail"/>').append(n).appendTo(i.$subWrapper);break;case"remote":e('<div class="thumbnail"/>').append(a.ext.css({width:26,height:26})).appendTo(i.$subWrapper)}},onFileRemove:function(t){e(".thumbnail",i.$subWrapper).eq(t).remove()}};this.oriWidget=FX.createWidget(a)},getOptions:function(){return e.extend(FX.SubformFileUpload.superclass.getOptions.apply(this,arguments),{type:this.oriWidget.getWidgetType(),maxFileCount:this.options.maxFileCount})},setCacheValue:function(e){this.$subWrapper.empty(),FX.Utils.applyFunc(this,FX.SubformFileUpload.superclass.setCacheValue,[e],!1)}}),e.shortcut("subform_upload",FX.SubformFileUpload)}(jQuery),function(e){FX.SubformImage=FX.extend(FX.SubformFileUpload,{_defaultConfig:function(){return e.extend(FX.SubformImage.superclass._defaultConfig.apply(this,arguments),{iconCls:"icon-widget-image"})},getOptions:function(){var t=this.options;return e.extend(FX.SubformImage.superclass.getOptions.apply(this,arguments),{type:this.oriWidget.getWidgetType(),maxFileCount:t.maxFileCount,compressed:t.compressed,onlyCamera:t.onlyCamera})}}),e.shortcut("subform_image",FX.SubformImage)}(jQuery),function(e){FX.DashComponent=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.DashComponent.superclass._defaultConfig.apply(),{baseCls:"fui_dash_component",mode:"edit",widgetType:"",widgetId:"",form:null,fields:[],xFields:[],yFields:[],metrics:[],filter:{},title:"",emptyTip:"暂无数据",value:null,onItemClick:null,onClick:null,onStopEdit:null,widget:{}})},_init:function(){FX.DashComponent.superclass._init.apply(this,arguments);var e=this.options,t=this._getWidgetConfig(e.widgetType);this._renderWidget(t)},_renderWidget:function(t){var i=this,a=this.options;if(t.type){if(!this._checkFieldsValid())return;this.widget=FX.createWidget(e.extend({widgetName:a.widgetId,renderEl:e('<div class="component-content"/>').appendTo(this.element),hasHeader:!1,hasBorder:!1,width:this.element.width(),height:this.element.height(),sizeX:a.widget.width,sizeY:a.widget.height,form:a.form,fields:a.fields,filter:a.filter,mode:a.mode,title:a.title,defaultConfig:a.defaultConfig,onItemClick:a.onItemClick,onStopEdit:a.onStopEdit,onDataFilter:a.onDataFilter,onLoadFail:function(e){var t=e.responseJSON||{};i._renderTip(i._getInvalidTip(t.code))},triggers:a.triggers,componentAttr:FX.Utils.pick(a.widget,["posX","posY","height","width","type","formulas"])},t))}},_isChartOrTable:function(){var e=this.options;return e.widgetType.indexOf("table")>-1||e.widgetType.indexOf("chart")>-1},_dealValueFields:function(t){var i=this,a=[];return FX.Utils.forEach(t,function(t,s){a.push(e.extend({text:i._getFieldText(s)},s))}),a},_getFieldText:function(e){return e.title},doResize:function(e){FX.DashComponent.superclass.doResize.apply(this,arguments);var t=this.element.height();e&&(e.height=t),this.widget&&this.widget.doResize(e),this.$empty&&this.$empty.css({width:this.element.width(),height:this.element.height()})},_getWidgetConfig:function(e){var t="",i={},a=this.options;switch(i.xFields=a.xFields,i.yFields=a.yFields,i.valueFields=this._dealValueFields(a.metrics),i.chartType=e,e){case"metric_table":t="metrictable";break;case"data_table":t="dashdatatable";break;case"pivot_table":t="dashpivottable";break;case"line_chart":t="dashlinechart";break;case"column_chart":t="dashbarchart";break;case"bar_chart":t="dashbarchart",i.isInverted=!0;break;case"area_chart":t="dashareachart";break;case"pie_chart":t="dashpiechart";break;case"radar_chart":t="dashradarchart";break;case"text_filter":t="dashcombocheck";break;case"dept_filter":t="dashdeptcheck";break;case"number_filter":t="dashnumber";break;case"address_filter":t="dashaddress";break;case"date_filter":t="dashdate";break;case"datetime_filter":t="dashdate",i.format="yyyy-MM-dd HH:mm:ss";break;case"filter_btn":t="dashbutton",i.onClick=a.onClick;break;default:t=e}return i.type=t,i},getSize:function(){var e={};return this.widget&&this.widget.getSize&&(e=this.widget.getSize()),e},getEditConfig:function(){return this.widget&&this.widget.getEditConfig()},setConfig:function(t){t&&e.extend(this.options,{form:t.form,xFields:t.xFields,yFields:t.yFields,metrics:t.metrics,fields:t.fields,filter:t.filter,mode:t.mode,title:t.title,defaultConfig:t.defaultConfig,widgetType:t.type,triggers:t.triggers}),this.rebuild()},_checkFieldsValid:function(){var e=this.options,t=!0;if(!this._isChartOrTable())return t;var i=null;return e.xFields.concat(e.fields).length||e.metrics.length?this._checkSubDimensionFields()?(t=!1,i=4212):this._checkSubCrossFields()&&(t=!1,i=4213):t=!1,t||this._renderTip(this._getInvalidTip(i)),t},_getInvalidTip:function(e){var t=this.options,i="";switch(e){case 4212:i="维度字段为子表单字段时，指标需为子表单字段";break;case 4213:i="无法统计来自不同子表单的字段";break;default:i=t.emptyTip}return i},_renderTip:function(t){this.$empty=e('<div class="component-content component-content-empty"><div class="empty-wrapper"><i class="icon-field-auth"></i><div class="empty-text">'+t+"</div></div></div>").css({width:this.element.width(),height:this.element.height()}).appendTo(this.element.empty())},_checkSubDimensionFields:function(){var e=this.options,t=[].concat(e.xFields).concat(e.yFields),i=[].concat(e.metrics),a=!1,s=!1;return FX.Utils.forEach(t,function(e,t){if(t.subform)return a=!0,!1}),a&&FX.Utils.forEach(i,function(e,t){if("formula"!==t.type&&!t.subform)return s=!0,!1}),a&&s},_checkSubCrossFields:function(){var e=this.options,t=[].concat(e.xFields).concat(e.yFields).concat(e.metrics),i=!1,a=null;return FX.Utils.forEach(t,function(e,t){if(t.subform)if(a){if(a!==t.subform)return i=!0,!1}else a=t.subform}),i},reload:function(e){this.widget&&this.widget.reload&&this.widget.reload(e)},updateTitle:function(e){this.widget&&this.widget.updateTitle&&this.widget.updateTitle(e)},dealExcelExport:function(){this.widget&&this.widget.doExcelExport&&this.widget.doExcelExport()}})}(jQuery),function(e){FX.DashBlock=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.DashBlock.superclass._defaultConfig.apply(),{baseCls:"fui_dash_block",margin:[38,10,10,10],widget:{},operate:["edit","delete"],onOperateTrigger:null,onItemClick:null,onClick:null,onStopEdit:null,onDataFilter:null,hasLazyLoad:!1})},_init:function(){FX.DashBlock.superclass._init.apply(this,arguments);var e=this.options;this.widgetData=e.widget,this._renderHead(),e.hasLazyLoad||this._renderWidget()},_renderHead:function(){this.$head=e('<div class="block-head"/>').appendTo(this.element),this._renderOperate(),this._renderTitle()},_needTitle:function(){return"metric_table"!==this.widgetData.type||this.widgetData.xFields.length>0&&this.widgetData.metrics.length>0},_renderTitle:function(){var t=this.$head.children(".block-title");if(this._needTitle()){var i=this.widgetData.title||"";t.length?t.text(i).attr("title",i):e('<div class="block-title"/>').attr("title",i).text(i).appendTo(this.$head)}else t.remove()},_renderWidget:function(){var t=this,i=this.options;this.isLoaded=!0,this.$content=e('<div class="block-content"/>').appendTo(this.element),this._needTitle()?this.setContentMargin(i.margin):this.setContentMargin([10,10]),this.dashWidget=new FX.DashComponent(e.extend({widgetType:this.widgetData.type,renderEl:e("<div/>").appendTo(this.$content),hasHeader:!1,hasBorder:!1,onItemClick:i.onItemClick,onClick:i.onClick,onStopEdit:i.onStopEdit,onDataFilter:function(){FX.Utils.applyFunc(t,i.onDataFilter,[],!1);var e=[];return t.filter&&(e=e.concat(t.filter)),t.linkFilter&&(e=e.concat(t.linkFilter)),e},mode:i.mode,widgetId:i.widgetId,widget:i.widget},this.widgetData,{width:this.$content.outerWidth(),height:this.$content.outerHeight()}))},_renderOperate:function(){var t=this.options,i=this,a="";FX.Utils.forEach(t.operate,function(e,t){a+=i._getOperateBtn(t)});var s=e(".block-operate",this.$head);s.length?s.empty().append(a):(s=e('<div class="block-operate">'+a+"</div>").appendTo(this.$head),this._bindOperate(s)),this._bindOperateTip(s)},_getOperateBtn:function(e){var t="",i="";switch(e){case"edit":t+='<i class="icon-flow-edit"/>';break;case"delete":t+='<i class="icon-trasho"/>';break;case"remove":t+='<i class="icon-close-normal"/>',i+="right-top";break;case"enlarge":t+='<i class="icon-enlarge"/>';break;case"shrink":t+='<i class="icon-shrink"/>';break;case"export":t+='<i class="icon-export"/>'}return'<div class="operate-btn '+i+'" role="'+e+'">'+t+"</div>"},_getOperateTip:function(e){var t="";switch(e){case"edit":t="编辑";break;case"delete":case"remove":t="删除";break;case"enlarge":t="放大";break;case"shrink":t="缩小";break;case"export":t="导出"}return t},_bindOperate:function(t){var i=this,a=this.options;t.on("click",".operate-btn",function(t){var s=e(t.currentTarget);FX.UI.closePopover(),FX.Utils.applyFunc(i,a.onOperateTrigger,[s.attr("role")],!1)})},_bindOperateTip:function(t){var i=this;t.children(".operate-btn").hover(function(){var t=e(this).attr("role");FX.UI.showPopover({position:"bottomLeft",anchor:e(this),content:e("<span/>").text(i._getOperateTip(t)),type:"dark"})},function(){FX.UI.closePopover()})},doResize:function(e){if(this.dashWidget){e||(e={width:this.element.width(),height:this.element.height()});var t=this.options;e={width:e.width-t.margin[1]-(t.margin[3]||t.margin[1]),height:e.height-t.margin[0]-(t.margin[2]||t.margin[0]),sizeX:e.sizeX||this.widgetData.width,sizeY:e.sizeY||this.widgetData.height},this.dashWidget.doResize(e)}},getSize:function(){this.dashWidget.getSize()},getOptions:function(){return this.widgetData},getFilter:function(){return this.filter},getLinkFilter:function(){return this.linkFilter},setContentMargin:function(t){var i=this.options;FX.Utils.isObjectEmpty(t)||(e.extend(i,{margin:t}),this.$content.css({margin:i.margin.join("px ")+"px"}))},getEditConfig:function(){return e.extend({title:this.widgetData.title},this.dashWidget.getEditConfig())},setConfig:function(t){e.extend(this.widgetData,t),this.dashWidget.setConfig(t),this._renderTitle()},reload:function(){this.dashWidget&&this.dashWidget.reload()},setFilter:function(e){this.filter=e},setLinkFilter:function(e){this.linkFilter=e},dealExcelExport:function(){this.dashWidget.dealExcelExport()},loadWidget:function(){this._renderWidget(),this.doResize()},isWidgetLoaded:function(){return this.isLoaded},updateOperate:function(e){this.options.operate=e,this._renderOperate()},enlarge:function(){this.element.addClass("block-full-screen"),this.doResize()},shrink:function(){this.element.removeClass("block-full-screen"),this.doResize()}}),e.shortcut("dashblock",FX.DashBlock)}(jQuery),function(e){FX.DashDate=FX.extend(FX.Widget,{DEFAULT_SIZE:{defaultSizeX:20,defaultSizeY:5,single:{minSizeX:20,minSizeY:5},double:{minSizeX:15,minSizeY:8}},VIEW_MODE:{CAL:1,LIM:2},_defaultConfig:function(){return e.extend(FX.DashDate.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_dash_date",minRow:8,calendarMinCol:20,calendarDateMinRow:22,calendarDateTimeMinRow:24,onStopEdit:null})},_init:function(){FX.DashDate.superclass._init.apply(this,arguments),this.$content=e('<div class="date-content"/>').appendTo(this.element),this.viewMode=this._getViewMode(),this._createDate()},_createDate:function(){var e=this.getValue();this.date=FX.createWidget(this._getDateConfig()),this.setValue(e),this._doWrap()},_getDateConfig:function(){var t=this.options,i=this,a=this.VIEW_MODE,s={renderEl:e("<div/>").appendTo(this.$content),format:t.format,width:t.width,height:t.height,onStopEdit:function(){FX.Utils.applyFunc(i,t.onStopEdit,[],!1)}};switch(this.viewMode){case a.CAL:s.type="daterange";break;case a.LIM:s.type="datelimit",s.width4date="auto",s.customCls="date-range"}return s},_getViewMode:function(){var e=this.options;return e.sizeX>=e.calendarMinCol?e.format&&e.format.match(/[YyDd]/)&&e.format.match(/[Hh]/)?e.sizeY>e.calendarDateTimeMinRow?this.VIEW_MODE.CAL:this.VIEW_MODE.LIM:e.sizeY>e.calendarDateMinRow?this.VIEW_MODE.CAL:this.VIEW_MODE.LIM:this.VIEW_MODE.LIM},_doWrap:function(){var t=this.options,i=e(".date-range",this.$content);if(i&&i.length){if(t.sizeY>t.minRow)return void i.addClass("wrap");i.removeClass("wrap")}},_initDefaultValue:function(){var e=this.options;FX.Utils.isObjectEmpty(e.defaultConfig)||this.setValue(e.defaultConfig)},doResize:function(e){var t=this.options;if(FX.DashDate.superclass.doResize.apply(this,arguments),this.date.doResize(e),e){t.sizeX=e.sizeX,t.sizeY=e.sizeY;var i=this._getViewMode();if(this._doWrap(),i===this.viewMode)return;this.viewMode=i,this.$content.empty(),this._createDate()}},setValue:function(e){this.date&&this.date.setValue(e)},getValue:function(){return this.date?this.date.getValue():{min:null,max:null}},getSize:function(){var t=this.options,i={defaultSizeX:this.DEFAULT_SIZE.defaultSizeX,defaultSizeY:this.DEFAULT_SIZE.defaultSizeY};return t.sizeY>t.minRow?e.extend(i,this.DEFAULT_SIZE.double):e.extend(i,this.DEFAULT_SIZE.single)},getEditConfig:function(){var e=this.options;return{fields:e.fields,triggers:e.triggers,defaultConfig:this.getValue()}},getOptions:function(){var t="date_filter",i=this.options;return i.format&&i.format.match(/[YyDd]/)&&i.format.match(/[Hh]/)&&(t="datetime_filter"),e.extend(FX.DashDate.superclass.getOptions.apply(this,arguments),{type:t},this.getEditConfig())},rebuild:function(e){var t=this.options;t.defaultConfig=e.defaultConfig,t.fields=e.fields,FX.DashDate.superclass.rebuild.apply(this,arguments)}}),e.shortcut("dashdate",FX.DashDate)}(jQuery),function(e){FX.DashMetricTable=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.DashMetricTable.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_dash_metric_table",widgetName:"",form:null,xFields:[],valueFields:[],filter:{},componentAttr:null,mode:"edit",title:"未命名图表",titleMinSize:12,valueMinSize:30,onDataFilter:null,onLoadFail:null})},_init:function(){FX.DashMetricTable.superclass._init.apply(this,arguments);var e=this,t=FX.Utils.createMask(this.element,{hasLoader:!0,isLight:!0});this._fetchData(function(i){t.remove(),e.data=i,e._initContent()})},_fetchData:function(t){var i=this.options,a=this;if(FX.Utils.isObjectEmpty(i.valueFields)){i.xFields=[];var s={val:[{sum:2e6}]};return t&&t(s)}var n,o;"edit"===i.mode?(n=FX.Utils.getApi(FX._API.dash.preview_combined_group),o={widget:e.extend({form:i.form,xFields:i.xFields,yFields:[],metrics:i.valueFields,filter:this._getFilter(),type:i.chartType},i.componentAttr)}):(n=FX.Utils.getApi(FX.API.dash.combined_group),o={widgetId:i.widgetName,filter:this._getFilter()}),FX.Utils.dataAjax({url:n,data:o},function(e){a.resData=e,t&&t(e.data)},function(e){FX.Utils.applyFunc(a,i.onLoadFail,[e],!1)})},_getFilter:function(){var e=this.options,t=[],i=FX.Utils.applyFunc(this,e.onDataFilter,[],!1);return i&&(t=t.concat(i)),FX.Utils.isObjectEmpty(e.filter.cond)||(t=t.concat(e.filter.cond)),{rel:FX.CONST.FILTER_RELATION.AND,cond:t}},_initContent:function(){this.element.empty(),this._hasDimension()?this._createOneDimensionTable():(this._createNoDimensionTable(),this.doResize())},_hasDimension:function(){return this.options.xFields.length>0},_createOneDimensionTable:function(){var t=this,i=this.options,a=this.data&&this.data.val,s=this.data&&this.data.x;if(this.element.addClass("one-dimension"),!FX.Utils.isObjectEmpty(a)&&!FX.Utils.isObjectEmpty(s)){var n=a[0].sum,o=s[0].data,l=a[0].data,r=i.xFields[0];this.$contentWrapper=e('<div class="content-wrapper one-dimension"/>').appendTo(this.element);var d=e('<div class="number-lines"><div class="line sum"><div class="left">共计</div><div class="right">'+this._formatData(n)+"</div></div></div>").appendTo(this.$contentWrapper);FX.Utils.forEach(o,function(i,a){e('<div class="line number"/>').append(e('<div class="left"/>').text(t._formatLabel(a,r))).append(e('<div class="right"/>').text(t._formatData(l[i]))).appendTo(d)})}},_formatLabel:function(e,t){var i=e,a=this.resData;switch(t.type){case"user":var s=a.user[e];s&&(i=s.nickname||"");break;case"dept":var n=a.department[e];n&&(i=n.name||"");break;case"datetime":var o=t.groupRule||"year";i=FX.Utils.date2GroupStr(e,o);break;case"location":case"address":i="";var l=t.groupRule.split("_");FX.Utils.forEach(l,function(t,a){i+=e[a]})}return i},_createNoDimensionTable:function(){var t=this.options,i=this.data&&this.data.val;if(this.element.addClass("no-dimension"),!FX.Utils.isObjectEmpty(i)){var a=t.title,s=this._formatData(i[0].sum);this.valFontCount=s.toString().length,this.$contentWrapper=e('<div class="content-wrapper">').append(e('<div class="inner-content"/>').append(e('<div class="title"/>').attr("title",a).append(e('<span class="title-val"/>').text(a))).append(e('<div class="sum"/>').attr("title",s).append(e('<span class="sum-val"/>').text(s)))).appendTo(this.element)}},_formatData:function(e){var t=this.options.valueFields[0];return t&&t.format?FX.Utils.num2Str(e,t.format):FX.Utils.fixDecimalPrecision(e)},doResize:function(e){if(FX.DashMetricTable.superclass.doResize.apply(this,arguments),!this._hasDimension()&&this.$contentWrapper){var t;t=e?e.height/3:this.element.height()/3,this.$contentWrapper.height(t),this._adjustFontSize()}},_adjustFontSize:function(){if(!this._hasDimension()){this.outerW=this.$contentWrapper.width(),this.outerH=this.$contentWrapper.height(),this._initFontSize();var t=this.options,i=e(".title-val",this.$contentWrapper),a=e(".sum-val",this.$contentWrapper),s=this.valBaseSize;if(this._collisionCheck(this.outerW,this.outerH))for(;this._collisionCheck(this.outerW,this.outerH)&&(s-=1,a.css({fontSize:s+"px"}),!(s<=t.valueMinSize)););else{for(;!this._collisionCheck(this.outerW,this.outerH);)s+=1,a.css({fontSize:s+"px"});a.css({fontSize:s-1+"px"})}var n=Math.min((this.outerH-a.height())/1.2,s/4);i.css({fontSize:Math.max(n,t.titleMinSize)+"px"})}},_initFontSize:function(){var t=this.options,i=e(".sum-val",this.$contentWrapper);this.valBaseSize=Math.max(t.valueMinSize,Math.min(this.outerW/this.valFontCount/.6,.8*this.outerH/1.2)),i.css({fontSize:this.valBaseSize+"px"})},_collisionCheck:function(t,i){var a=e(".sum-val",this.$contentWrapper),s=a.height(),n=a.width(),o=!1;return(s>=.8*i||n>=t)&&(o=!0),o},updateTitle:function(t){this._hasDimension()||(t=t||"未命名图表",e(".title-val",this.$contentWrapper).text(t))},reload:function(){this.rebuild()},doExcelExport:function(){var e=this.options;FX.Utils.isObjectEmpty(e.valueFields)||FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.dash.excel_export),data:{widgetId:e.widgetName,filter:this._getFilter()}},function(e){window.location.href=e.url},function(e){var t=e.responseJSON||{};FX.Msg.toast({type:"error",msg:t.msg||"导出失败"})})}}),e.shortcut("metrictable",FX.DashMetricTable)}(jQuery),function(e){FX.DashDataTable=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.DashDataTable.superclass._defaultConfig.apply(),{title:"",baseCls:"fui_dash_datatable",cls4FullScreen:"block-fullscreen",form:null,filter:null,allowDataLoad:!0,onCheckValid:null,exportable:!1,itemsPerPage:20,fields:[],data:[],componentAttr:null,asyncExportURL:FX.Utils.getApi(FX.API.dash.list_excel_export),mode:"visit",onDataFilter:null,onLoadFail:null})},_init:function(){FX.DashDataTable.superclass._init.apply(this,arguments),this.element.addClass("x-block-bg"),this._onCreateBody()},_initContent:function(t){this.$wrapper=e('<div class="fui_table-wrapper has-menu"/>').appendTo(t),this.$menu=e('<div class="fui-table-menu"/>').appendTo(t),this.sort=[],this.page=0,this.count=0,this._initDataTable()},_initDataTable:function(){var e=this;this._loadData(function(){e.createTable()})},_loadData:function(e){var t=this,i=this.options;this._isFieldsValid()&&this.loadingAjax(this._getAsyncConfig(!1),function(i){!1!==t.hasCount&&(t.count=i.count),t.header=i.header,t.data=i.data,e&&e()},function(e){FX.Utils.applyFunc(t,i.onLoadFail,[e],!1)})},_getAsyncConfig:function(t){var i,a,s=this.options;return"edit"===s.mode?(i=FX.Utils.getApi(FX._API.dash.preview_list),a={widget:e.extend({fields:s.fields,form:s.form,filter:this.getFilterData(this.filterParam),hasHeader:!0,hasCount:!1!==this.hasCount},s.componentAttr),sort:this.sort,skip:this.page*s.itemsPerPage,limit:s.itemsPerPage,isCountOnly:t}):(i=FX.Utils.getApi(FX.API.dash.list),a={widgetId:s.widgetName,sort:this.sort,skip:this.page*s.itemsPerPage,limit:s.itemsPerPage,filter:this.getFilterData(this.filterParam),hasCount:!1!==this.hasCount,isCountOnly:t}),{url:i,data:a}},_isFieldsValid:function(){var e=this.options,t=!0;return t&=!FX.Utils.isEmpty(e.form),t&=e.fields&&e.fields.length>0,FX.Utils.applyFunc(this,e.onCheckValid,[],!1),t},createTable:function(){this.headRowCount=this._getHeadRowCount();var e=this._dealHeader(this.header);this.tableHead=e.tableHead,this.cols=e.cols,this.fieldTypeMap=e.fieldTypeMap,this._createTableData(),this.table?this.table.reload(this._getTableRenderData()):this.table=this._doCreateTable(),this._createPagination()},_doCreateTable:function(){var t=this;return new FX.PlainTable(e.extend({renderEl:this.$wrapper,isHeadSticky:!0,height:"auto",onHeadCellClick:function(e){e.hasClass("sortable")&&t._sortTable(e)},onOpBtnClick:function(t){if("file"===t.data("op")){var i=t.data("file");FX.Utils.dt(FX.CONST.TRACKER.FILE_PREVIEW),new FX.FilePreview({files:e.makeArray(i)})}},onMouseOverRow:function(i){var a=i.attr("data-idx");FX.Utils.isNull(a)||e('tbody > tr[data-idx="'+a+'"]',t.$wrapper).addClass("hover")},onMouseOutRow:function(i){var a=i.attr("data-idx");FX.Utils.isNull(a)||e('tbody > tr[data-idx="'+a+'"]',t.$wrapper).removeClass("hover")},onRowCreate:function(e,i){if(t.dataMap&&t.dataMap.length>i){var a=t.dataMap[i];e.attr("data-idx",a)}}},this._getTableRenderData()))},_getTableRenderData:function(){return{tableHead:this.tableHead,tableData:this.tableData}},_sortTable:function(e){var t=e.data("field");if(t){var i={},a=-1;e.hasClass("sort-asc")?(e.removeClass("sort-asc").addClass("sort-desc"),i[t]=-1,(a=this.getSortedFieldIdx(t))>-1?this.sort[a]=i:this.sort.push(i)):e.hasClass("sort-desc")?(e.removeClass("sort sort-desc"),(a=this.getSortedFieldIdx(t))>-1&&this.sort.splice(a,1)):(e.removeClass("sort-desc").addClass("sort sort-asc"),a=this.getSortedFieldIdx(t),i[t]=1,a>-1?this.sort[a]=i:this.sort.push(i)),this.page=0,this._reloadWithoutCount()}},_getHeadRowCount:function(){var e=1;return FX.Utils.forEach(this.header,function(t,i){if("subform"===i.type)return e=2,!1}),e},_dealHeader:function(e){for(var t=this,i=(this.options,[]),a=[],s={},n=0;n<this.headRowCount;n++)i.push([]);return FX.Utils.forEach(e,function(e,n){var o=t._getFieldName(n);s[o]=n.type,"subform"===n.type?(FX.Utils.isObjectEmpty(n.items)||i[0].push({text:n.title,colspan:n.items.length,cls:"combined-col"}),FX.Utils.forEach(n.items,function(e,n){var l=[o,t._getFieldName(n)].join(".");s[l]=n.type,i[1].push(t._createHeadCell(n,t.headRowCount,o)),a.push(t._createHeadCol(n,o))})):(i[0].push(t._createHeadCell(n,t.headRowCount,null)),a.push(t._createHeadCol(n)))}),{tableHead:i,cols:a,fieldTypeMap:s}},_createHeadCell:function(e,t,i){var a=this._getFieldName(e),s={text:e.title,cls:e.type+"-col",data:{}};i?a=[i,a].join("."):s.rowspan=t,s.data.field=a;var n;return FX.Utils.forEach(this.sort,function(e,t){t[a]&&(n=t[a])}),n&&(n===FX.CONST.SORT.ASC?s.cls+=" sort sort-asc":s.cls+=" sort sort-desc"),!i&&FX.LimitFields.sort.indexOf(e.type)>-1&&(s.cls+=" clickable sortable"),s},_getFieldName:function(e){return e.tag||e.name},_createHeadCol:function(e,t){var i=this._getFieldName(e),a={};return t?(a.field=t,a.subField=i):a.field=i,a.format=e.format,e.regex&&(a.regex=e.regex),"linkdata"===e.type&&(a.linkType=e.linkType),a},getSortedFieldIdx:function(e){var t=-1;return FX.Utils.forEach(this.sort,function(i,a){if(a)return a[e]?(t=i,!1):void 0}),t},_createTableData:function(){var e=this;this.tableData=[],this.dataMap=[],FX.Utils.forEach(e.data,function(t,i){for(var a=[],s=e._calculateDataRowCount(i),n=0;n<s;n++)a.push([]);FX.Utils.forEach(e.cols,function(t,n){var o=i[n.field];if("subform"===e.fieldTypeMap[n.field]){var l=o||[];if(FX.Utils.forEach(l,function(t,i){a[t].push(e._createCellData(i[n.subField],n))}),l.length<s)for(var r=l.length;r<s;r++)a[r].push(e._createCellData(null))}else{var d=e._createCellData(o,n);d.rowspan=s,a[0].push(d)}}),i&&FX.Utils.forEach(a,function(){e.dataMap.push(t)}),e.tableData=e.tableData.concat(a)})},_calculateDataRowCount:function(e){var t=this,i=1;return FX.Utils.forEach(e,function(e,a){"subform"===t.fieldTypeMap[e]&&(i=Math.max(a.length,i))}),i},_createCellData:function(t,i){var a={text:""};if(FX.Utils.isObjectEmpty(t))return a;var s=i.field;switch(i.subField&&(s+="."+i.subField),this.fieldTypeMap[s]){case"checkboxgroup":case"combocheck":a={text:FX.Utils.isNull(t)?"":t.join(", ")};break;case"text":if(i.regex&&new RegExp(i.regex).test(t)){var n=FX.CONST.TEXT_TYPE_REGEXP;i.regex===n.email&&(a={html:'<a href="mailto:'+t+'">'+t+"</a>"})}a={html:e("<span />").append(FX.Utils.replaceURL(t))};break;case"radiogroup":case"combo":a={text:FX.Utils.isNull(t)?"":t};break;case"user":case"dept":a={text:t||""};break;case"usergroup":case"deptgroup":var o=[];FX.Utils.forEach(t,function(e,t){o.push(t||"")}),a={text:o.join(",")};break;case"formula":case"number":var l=FX.Utils.fixDecimalPrecision(t);a={text:FX.Utils.num2Str(l,i.format)};break;case"address":case"location":var r=[];t&&(t.province&&(r.push(t.province),t.city&&t.province!==t.city&&r.push(t.city),t.district&&r.push(t.district)),t.detail&&r.push(t.detail)),a={text:FX.Utils.address2Str(t,r.join(""),i.format)};break;case"image":case"upload":case"signature":var d=e('<a class="table-op-btn table-file-btn"/>').data("file",t);FX.Utils.isObjectEmpty(t)?d.text(""):d.text("查看").data("op","file"),a={html:d};break;case"textarea":a={html:t?e("<pre/>").append(FX.Utils.replaceURL(t)):""};break;case"datetime":t&&(a={text:FX.Utils.date2Str(new Date(t),i.format)});break;case"linkdata":var c=t&&t.key;if(!c)break;"datetime"===i.linkType&&(c=FX.Utils.date2Str(new Date(c),"yyyy-MM-dd")),a={text:c}}return a},_createPagination:function(){var t=this,i=this.options;this.$menu.empty(),new FX.DataCountPane({renderEl:e("<div />").appendTo(this.$menu),itemsPerPage:i.itemsPerPage,count:this.count,async:this._getAsyncConfig(!0),onItemPerPageChange:function(e){i.itemsPerPage=e,t.page=0,t.reload(i.filterParam)}});var a=this.data&&this.data.length>=i.itemsPerPage;new FX.Pagination({renderEl:e("<div />").appendTo(this.$menu),count:t.count,limit:i.itemsPerPage,curPage:t.page+1,maxCount:FX.CONST.MAX_COUNT,hasMore:a,onChangePage:function(e){t.page=e-1,t.turnPage()}})},doExcelExport:function(){var e=this.options;this._isFieldsValid()&&FX.Utils.dataAjax({url:e.asyncExportURL,data:{widgetId:e.widgetName,filter:this.getFilterData(this.filterParam),sort:this.sort}},function(e){window.location.href=e.url},function(e){var t=e.responseJSON||{};FX.Msg.toast({type:"error",msg:t.msg||"导出失败"})})},turnPage:function(){this._initDataTable()},reload:function(e,t,i){t||(this.page=0),i?this.hasCount=!1:(this.hasCount=!0,this.count=0),this._setFilterParam(e),this._initDataTable()},_setFilterParam:function(e){FX.Utils.isNull(e)||(this.filterParam=e)},_reloadWithoutCount:function(e,t){this.reload(e,t,!0)},createHeadTools:function(){var t=this,i=this.options;this.$head.children("a").remove();var a="全屏",s=e("<a />").append('<i class="icon-enlarge">');t.element.hasClass(i.cls4FullScreen)&&(s=e("<a />").append('<i class="icon-shrink">'),a="缩小"),s.appendTo(this.$head).click(function(){t.doFullScreen()?(s.children("i").removeClass().addClass("icon-shrink"),a="缩小"):(s.children("i").removeClass().addClass("icon-enlarge"),a="全屏")}).hover(function(){FX.UI.showPopover({position:"bottomLeft",anchor:e(this).children("i"),content:e("<span/>").text(a),type:"dark"})},function(){FX.UI.closePopover()}),i.exportable&&e("<a/>").append('<i class="icon-export">').append(e("<span/>").text("导出Excel")).appendTo(this.$head).click(function(){t.doExcelExport()})},_onCreateBody:function(){return this.$body=e('<div class="x-block-body"/>').appendTo(this.element),this._resizeBody(),this._initContent(this.$body),this.$body},_resizeBody:function(){var e=this.options;this.$body.addClass("fixed-height"),this.$body.css({width:e.width-2,height:e.height-2})},isAllowDataLoad:function(){return this.options.allowDataLoad},setAllowDataLoad:function(e){this.options.allowDataLoad=!!e},loadingAjax:function(e,t,i){var a=this;if(this.isAllowDataLoad()&&!this.isLoading){this.isLoading=!0;var s=this.createLoadingMask();FX.Utils.dataAjax(e,function(e,i){return FX.Utils.applyFunc(a,t,[e,i],!1)},function(e,t){return FX.Utils.applyFunc(a,i,[e,t],!1)},function(){s.remove(),a.isLoading=!1})}},createLoadingMask:function(){return FX.Utils.createMask(this.element,{hasLoader:!0,isLight:!0})},rebuild:function(){this.$body.remove(),this._onCreateBody()},refresh:function(){this.createTable()},doResize:function(){FX.DashDataTable.superclass.doResize.apply(this,arguments),this._resizeBody(),this.table&&this.table.doResize()},doFullScreen:function(){var e=this.options;return this.element.hasClass(e.cls4FullScreen)?(this.element.removeClass(e.cls4FullScreen),this.doResize({width:FX.Utils.isEmpty(this.originStyle.w)?"auto":this.originStyle.w,height:FX.Utils.isEmpty(this.originStyle.h)?"auto":this.originStyle.h}),!1):(this.originStyle={w:this.element.outerWidth(),h:e.height},this.element.addClass(e.cls4FullScreen),this.doResize({width:document.body.clientWidth,height:document.body.clientHeight}),!0)},getFilterData:function(e){var t=this.options,i=FX.Utils.applyFunc(this,t.onDataFilter,[],!1),a=[];return i&&(a=a.concat(i)),FX.Utils.isObjectEmpty(e)||(a=a.concat(e)),t.filter&&"edit"===t.mode&&(a=a.concat(t.filter.cond)),FX.Utils.isObjectEmpty(a)?{}:{cond:a,rel:FX.CONST.FILTER_RELATION.AND}}}),e.shortcut("dashdatatable",FX.DashDataTable)}(jQuery),function(e){FX.DashPivotTable=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.DashPivotTable.superclass._defaultConfig.apply(),{baseCls:"fui_dash_pivottable",title:"",cls4FullScreen:"block-fullscreen",height4Head:35,filter:null,linkWidgets:null,allowDataLoad:!0,chunkSize:50,form:null,xFields:[],yFields:[],valueFields:[],asyncExportURL:FX.Utils.getApi(FX.API.dash.excel_export),tableData:[],tableHead:null,tableRowHead:null,onItemClick:null,onScroll:null,onCheckValid:null,onLoadFail:null,exportable:!0,scalable:!0,tableClass:"x-table",mode:"visit",componentAttr:null})},_init:function(){FX.Block.superclass._init.apply(this,arguments);this.options;this.element.addClass("x-block-bg"),this._onCreateBody()},_initContent:function(t){this.$wrapper=e('<div class="fui_table-wrapper"/>').appendTo(t),this.$wrapper.addClass("has-menu"),this.$menu=e('<div class="fui-table-menu"/>').appendTo(t),this._removeTable(),this._initCombinedTable()},createHeadTools:function(){var t=this,i=this.options;if(this.$head.children("a").remove(),i.scalable){var a="全屏",s=e("<a />").append('<i class="icon-enlarge">');t.element.hasClass(i.cls4FullScreen)&&(s=e("<a />").append('<i class="icon-shrink">'),a="缩小"),s.appendTo(this.$head).click(function(){t.doFullScreen()?(s.children("i").removeClass().addClass("icon-shrink"),a="缩小"):(s.children("i").removeClass().addClass("icon-enlarge"),a="全屏")}).hover(function(){FX.UI.showPopover({position:"bottomLeft",anchor:e(this).children("i"),content:e("<span/>").text(a),type:"dark"})},function(){FX.UI.closePopover()})}i.exportable&&e("<a/>").append('<i class="icon-export">').append(e("<span/>").text("导出Excel")).appendTo(this.$head).click(function(){t.doExcelExport()})},_onCreateBody:function(){return this.$body=e('<div class="x-block-body"/>').appendTo(this.element),this._resizeBody(),this._initContent(this.$body),this.$body},_resizeBody:function(){var e=this.options,t={};FX.Utils.isNumber(e.width)?t.width=e.width-2:FX.Utils.isNull(e.width)||(t.width=e.width),FX.Utils.isNumber(e.height)?(t.height=e.height-2,this.$body.addClass("fixed-height")):FX.Utils.isNull(e.height)?(this.$body.removeClass("fixed-height"),t.height="auto"):(this.$body.removeClass("fixed-height"),t.height=e.height),this.$body.css(t)},isAllowDataLoad:function(){return this.options.allowDataLoad},setAllowDataLoad:function(e){this.options.allowDataLoad=!!e},loadingAjax:function(e,t,i){var a=this;if(this.isAllowDataLoad()&&!this.isLoading){this.isLoading=!0;var s=this.createLoadingMask();FX.Utils.dataAjax(e,function(e,i){return FX.Utils.applyFunc(a,t,[e,i],!1)},function(e,t){return FX.Utils.applyFunc(a,i,[e,t],!1)},function(){s.remove(),a.isLoading=!1})}},createLoadingMask:function(){return FX.Utils.createMask(this.element,{hasLoader:!0,isLight:!0})},_initCombinedTable:function(t){var i=this,a=this.options;if(this.filterParam=t,this.tableHead=[],this.tableRowHead=[],this.tableData=[],this.rowCount=0,this._isFieldsValid()){var s,n;"edit"===a.mode?(s=FX.Utils.getApi(FX._API.dash.preview_combined_group),n={widget:e.extend({form:a.form,xFields:a.xFields,yFields:a.yFields,metrics:a.valueFields,filter:this.getFilterData(this.filterParam),type:a.chartType},a.componentAttr)}):(s=FX.Utils.getApi(FX.API.dash.combined_group),n={widgetId:a.widgetName,filter:this.getFilterData(this.filterParam)}),this.loadingAjax({url:s,data:n},function(e){i.page=1,i._isTableEmpty(e)||(i._dealTableInfo(e),i.rowCount=i.tableData.length,i._chunkTable()),i.createTable()},function(e){FX.Utils.applyFunc(i,a.onLoadFail,[e],!1)})}else this.createTable()},_isTableEmpty:function(e){return 0===e.data.x.length&&0===e.data.val.length},createTable:function(){var t=this,i=this.options;if(this.$tableScroller=e('<div class="table-scroller"/>').scroll(function(){t._scrollStickyHead()}).appendTo(this.$wrapper),this.$table=e('<table cellpadding="0" cellspacing="0" class="'+i.tableClass+' x-table-bordered x-table-striped t-main"/>').appendTo(this.$tableScroller),this.tableHead&&this.tableHead.length>0){var a=e('<thead class="t-head"/>').appendTo(this.$table);FX.Utils.forEach(this.tableHead,function(i,s){var n=e('<tr class="t-row th-row"/>').appendTo(a);FX.Utils.forEach(s,function(e,i){t._createCell(i,{tag:"th",cls:"th-cell"}).appendTo(n)})})}this.$tableBody=e('<tbody class="t-body"/>').appendTo(this.$table),this._appendTableData(),this._setEvent(),this._createStickyHead(),this._createPagination()},_createCell:function(t,i){var a=i||{tag:"td"};a.cls&&t.cls&&(t.cls=a.cls+" "+t.cls);var s=e.extend(a,t.text||t.html||!FX.Utils.isString(t)?t:{text:t}),n=e("<"+s.tag+' class="t-cell"/>');switch(n.attr({row:s.row,col:s.col}),s.hasOwnProperty("html")?n.html(s.html):n.text(s.text),s.align){case"center":n.addClass("h-center");break;case"right":n.addClass("h-right")}if(s.data)for(var o in s.data)s.data.hasOwnProperty(o)&&n.data(o,s.data[o]);return s.cls&&n.addClass(s.cls),s.colspan&&n.attr("colspan",s.colspan),s.rowspan&&n.attr("rowspan",s.rowspan),s.width&&n.width(s.width),s.height&&n.width(s.height),n},_createStickyHead:function(){var t=this,i=this.options;this.$stickyHead=e('<table cellpadding="0" cellspacing="0" class="'+i.tableClass+' x-table-bordered x-table-striped"/>').append(this.$table.children(".t-head").clone(!0)).outerWidth(this.$table.outerWidth()),e('<div class="table-sticky-head"/>').css({width:this.$tableScroller[0].clientWidth}).append(this.$stickyHead).appendTo(this.$wrapper),this.$stickyHead.find(".t-head .th-cell").each(function(i,a){var s=t.$table.find(".t-head .th-cell").eq(i);e(a).outerWidth(s.outerWidth())}),this.$stickyRowHead=e('<table cellpadding="0" cellspacing="0" class="'+i.tableClass+' x-table-bordered x-table-striped"/>').append(this.$table.children(".t-head, .t-body").clone(!0)),e('<div class="table-sticky-row-head"/>').css({height:this.$tableScroller[0].clientHeight}).append(this.$stickyRowHead).appendTo(this.$wrapper),this.$stickyRowHead.find(".t-head .th-cell").each(function(i,a){var s=t.$table.find(".t-head .th-cell").eq(i);e(a).outerWidth(s.outerWidth())}),this.$stickyRowHead.find(".t-row").each(function(i,a){var s=t.$table.find(".t-row").eq(i);e(a).outerHeight(s.outerHeight())}),this.$stickyRowHead.children(".t-head").children("tr.t-row").each(function(t,i){e(i).children(".th-cell").not(".group-head").remove()}),this.$stickyRowHead.find(".t-body .td-cell").remove(),this.$stickyIntersect=e('<table cellpadding="0" cellspacing="0" class="'+i.tableClass+' x-table-bordered x-table-striped"/>').append(this.$stickyRowHead.children(".t-head").clone(!0)),e('<div class="table-sticky-intersect"/>').append(this.$stickyIntersect).appendTo(this.$wrapper)},rebuildStickyHead:function(){this.element.find(".table-sticky-head, .table-sticky-row-head, .table-sticky-intersect").remove(),this._createStickyHead()},rebuild:function(){this.$body.remove(),this._onCreateBody()},_scrollStickyHead:function(){var e=this.options,t=this.$tableScroller.scrollTop(),i=this.$tableScroller.scrollLeft();!1===FX.Utils.applyFunc(this,e.onScroll,[i,t],!1)&&(this.$stickyHead&&this.$stickyHead.css({"margin-left":-i}),this.$stickyRowHead&&this.$stickyRowHead.css({"margin-top":-t}))},_removeTable:function(){this.$wrapper.children().remove(),this.$menu&&this.$menu.children().remove()},_dealTableInfo:function(e){var t=this.options;this.tableHead=[],this.tableRowHead=[],this.tableData=[],this.colDataArr=[],this.rowDataArr=[],this.rowHeadTitleCols=Math.max(1,t.xFields.length);for(var i=t.yFields.length+1,a=0;a<i;a++)this.tableHead.push([]);this._createColHeadTitle(),this._createRowHeadTitle(),this._createRowHead(e),this._createColHeadAndData(e)},_chunkTable:function(){var t=this,i=this.options;this.rowHeadChunks=[],FX.Utils.forEach(this.tableRowHead,function(a,s){var n=null,o=FX.Utils.chunkArray(s,i.chunkSize);FX.Utils.forEach(o,function(i,a){n&&n.rowspan&&(a[0]=n);for(var s=a.length-1;s>=0;s--){var o=a[s];if(o){o.rowspan>=a.length-s&&(n=e.extend({},o),o.rowspan=a.length-s,n.rowspan-=o.rowspan);break}}t.rowHeadChunks[i]=t.rowHeadChunks[i]||[],t.rowHeadChunks[i].push(a)})}),this.dataChunks=FX.Utils.chunkArray(this.tableData,i.chunkSize);var a=this._getPageData();this.tableHead=a.tableHead,this.tableRowHead=a.tableRowHead,this.tableData=a.tableData},_getPageData:function(){return{tableHead:this.tableHead,tableRowHead:this.rowHeadChunks[this.page-1],tableData:this.dataChunks[this.page-1]}},_createColHeadTitle:function(){var e=this,t=this.options;FX.Utils.forEach(t.yFields,function(t,i){e.tableHead[t].push({rowspan:1,colspan:e.rowHeadTitleCols,text:i.title,cls:"group-head"})})},_createRowHeadTitle:function(){var e=this.options,t=this.tableHead[e.yFields.length],i=1;e.xFields.length<this.rowHeadTitleCols&&(i=this.rowHeadTitleCols),e.xFields.length||t.push({colspan:this.rowHeadTitleCols,cls:"group-head"}),FX.Utils.forEach(e.xFields,function(e,a){t.push({colspan:i,text:a.title,cls:"group-head"})})},_createColHeadAndData:function(e){for(var t=this,i=this.options,a=e.data.val,s=a[0].data.length,n=this.tableHead,o=this.tableData,l=0;l<s;l++)o.push([]);var r=[];o.push(r);var d=null;FX.Utils.forEach(a,function(s,l){l.is_summary_col&&i.yFields.length&&(d?d.colspan+=1:(d={text:"汇总",rowspan:i.yFields.length,colspan:1},n[0].push(d)));var c=!0;FX.Utils.forEach(l.y,function(o,r){var d=t._getLastCell(n[o]);(c=0!==s&&(c&&t._compareCell(a[s-1].y[o],r)))?d.colspan+=1:n[o].push({colspan:1,text:t._getGroupText(r,i.yFields[o],e),data:{id:t._getColHeadCellData(l.y,o)},cls:"clickable"})}),n[i.yFields.length].push({text:t._getMetricTitle(e.metrics,l.tag)}),FX.Utils.forEach(l.data,function(i,a){var n={};n=FX.Utils.isNull(a)?{text:"-",cls:"h-center"}:{field:l.tag,text:a,cls:"h-right clickable",data:{id:t._getCellData(e,i,s)}},o[i].push(n)}),r.push({field:l.tag,text:l.sum,cls:"h-right clickable",data:{id:t._getColHeadCellData(l.y,l.y.length-1)}})})},_getMetricTitle:function(e,t){var i="";return FX.Utils.forEach(e,function(e,a){if(a.tag===t)return i=a.title,!1}),i},_getColHeadCellData:function(e,t){for(var i=this.options,a={},s=0;s<=t;s++){var n=i.yFields[s];a[n.groupName||n.tag]=e[s]}return a},_getRowHeadCellData:function(e,t,i){for(var a=this.options,s={},n=0;n<=i;n++){var o=a.xFields[n];s[o.groupName||o.tag||o.name]=e[n].data[t]}return s},_getCellData:function(t,i,a){var s=this.options,n=this.colDataArr[a],o=this.rowDataArr[i];return n||(n=this._getColHeadCellData(t.data.val[a].y,s.yFields.length-1),this.colDataArr[a]=n),o||(o=this._getRowHeadCellData(t.data.x,i,s.xFields.length-1),this.rowDataArr[i]=o),e.extend({},o,n)},_createRowHead:function(e){var t=this,i=this.options,a=e.data.x,s=this.tableRowHead;if(a.length)for(var n=0;n<a.length;n++)s.push([]);else s.push([]);FX.Utils.forEach(a,function(n,o){var l=null;FX.Utils.forEach(o.data,function(r,d){var c=!1;if(r>0&&(c=t._compareCell(o.data[r-1],d),n>0&&(c=c&&FX.Utils.isNull(s[n-1][r]))),c)l.rowspan+=1,s[n].push(null);else{var u=1;i.xFields.length<t.rowHeadTitleCols&&(u=t.rowHeadTitleCols),l={colspan:u,rowspan:1,text:t._getGroupText(d,i.xFields[n],e),data:{id:t._getRowHeadCellData(a,r,n)},cls:"clickable"},s[n].push(l)}})}),s[0].push({text:"汇总",colspan:this.rowHeadTitleCols})},_compareCell:function(t,i){var a=t===i;return e.isPlainObject(t)&&e.isPlainObject(i)&&(a=!0,FX.Utils.forEach(t,function(e,t){if(t!==i[e])return a=!1,!1})),a},_getGroupText:function(e,t,i){var a=e;switch(t.type){case"user":var s=i.user[e];a=s?s.nickname:e;break;case"dept":var n=i.department[e];a=n?n.name:e;break;case"datetime":a=FX.Utils.date2GroupStr(e,t.groupRule||"year");break;case"location":case"address":a="";var o=t.groupRule.split("_");FX.Utils.forEach(o,function(t,i){a+=e[i]})}return a},doExcelExport:function(){var e=this.options;this._isFieldsValid()&&FX.Utils.dataAjax({url:e.asyncExportURL,data:{widgetId:e.widgetName,filter:this.getFilterData(this.filterParam)}},function(e){window.location.href=e.url},function(e){var t=e.responseJSON||{};FX.Msg.toast({type:"error",msg:t.msg||"导出失败"})})},_createPagination:function(){var t=this,i=this.options;new FX.Pagination({renderEl:e("<div />").appendTo(this.$menu),count:this.rowCount,limit:i.chunkSize,curPage:this.page,hasTurnLast:!0,onChangePage:function(e){t.page=e,t.turnPage()}})},turnPage:function(){this._removeTable(),e.extend(this,this._getPageData()),this.createTable()},_getLastCell:function(e){return e.length?e[e.length-1]:null},_isFieldsValid:function(){var e=this.options,t=!0;return t&=!FX.Utils.isEmpty(e.form),t&=0!==e.valueFields.length,t&=0!==e.xFields.length||0!==e.yFields.length,FX.Utils.applyFunc(this,e.onCheckValid,[],!1),!!t},_setEvent:function(){var t=this,i=this.options;this.$wrapper.off(".combined-table"),this.$wrapper.on("click.combined-table",".t-cell",function(a){var s=e(a.currentTarget).data("id");if(s){var n=t._getLinkParams(s);n=t._getLinkFilterParams(n),FX.Utils.applyFunc(t,i.onItemClick,[n],!1)}})},_getLinkParams:function(t){var i=this;if(t){var a=[];return FX.Utils.forEach(t,function(s){var n=i._getFieldByName(s),o=t[s];switch(n.type){case"datetime":o=FX.Utils.getDateRange(o);break;case"address":case"location":o=FX.Utils.getArrayFromRange(o,"address")}a.push(e.extend(FX.Utils.getLinkFilter(n,o),{field:n.name}))}),a}},_getFieldByName:function(e){var t=this.options,i=[].concat(t.xFields,t.yFields),a=null;return FX.Utils.forEach(i,function(t,i){if((i.tag||i.name)===e)return a=i,!1}),a},reload:function(e){this._removeTable(),this._initCombinedTable(e)},refresh:function(){this.tableRowHead=[],this._removeTable(),this.createTable()},doResize:function(e){this.options;FX.DashPivotTable.superclass.doResize.apply(this,arguments),this._resizeBody(),this.$table&&(this.$stickyHead&&this.$stickyHead.parent().remove(),this.$stickyRowHead&&this.$stickyRowHead.parent().remove(),this.$stickyIntersect&&this.$stickyIntersect.parent().remove(),this._createStickyHead(),this._scrollStickyHead())},doFullScreen:function(){var e=this.options;return this.element.hasClass(e.cls4FullScreen)?(this.element.removeClass(e.cls4FullScreen),this.doResize({width:FX.Utils.isEmpty(this.originStyle.w)?"auto":this.originStyle.w,height:FX.Utils.isEmpty(this.originStyle.h)?"auto":this.originStyle.h}),!1):(this.originStyle={w:this.element.outerWidth(),h:e.height},this.element.addClass(e.cls4FullScreen),this.doResize({width:document.body.clientWidth,height:document.body.clientHeight}),!0)},getOptions:function(){var t=this.options;return e.extend(FX.DashPivotTable.superclass.getOptions.apply(this,arguments),{title:t.title,linkWidgets:t.linkWidgets,form:t.form,filter:t.filter,xFields:t.xFields,yFields:t.yFields,valueFields:t.valueFields,exportable:t.exportable})},_getWidgetNameByTag:function(e){var t=this.options,i=e;return FX.Utils.forEach([].concat(t.xFields,t.yFields),function(t,a){if(a.tag&&a.tag===e)return i=a.name,!1}),i},_getLinkFilterParams:function(t){var i=this.options,a=[];return FX.Utils.forEach(t,function(t,s){a.push(e.extend(FX.Utils.pick(s,["method","type","value","keyType"]),FX.Utils.dealFilterInfoByField({id:i.form,name:s.field})))}),a},getFilterData:function(e){var t=this.options,i=FX.Utils.applyFunc(this,t.onDataFilter,[],!1),a=[];return i&&(a=a.concat(i)),FX.Utils.isObjectEmpty(e)||(a=a.concat(e)),t.filter&&"edit"===t.mode&&(a=a.concat(t.filter.cond)),FX.Utils.isObjectEmpty(a)?{}:{cond:a,rel:FX.CONST.FILTER_RELATION.AND}},_appendTableData:function(){var t=this,i=this.options;this.formatMap={},FX.Utils.forEach(i.valueFields,function(e,i){t.formatMap[i.tag]=i.format}),FX.Utils.forEach(this.tableData,function(i,a){var s=i%2==0?"odd":"even",n=e('<tr class="t-row tb-row"/>').addClass(s).appendTo(t.$tableBody);t.tableRowHead&&t.tableRowHead.length>0&&t.tableRowHead.forEach(function(e){var a=e[i];a&&t._createCell(a,{tag:"th",cls:"rh-cell"}).appendTo(n)}),FX.Utils.forEach(a,function(e,a){a.row=i,a.col=e,t._createCell(t._formatCell(a),{tag:"td",cls:"td-cell"}).appendTo(n)})})},_formatCell:function(t){var i=e.extend({},t),a=i.field;a&&(a=a.replace("%","."));var s=this.formatMap[a],n=FX.Utils.fixDecimalPrecision(t.text);return i.text=FX.Utils.num2Str(n,s)||"-",i}}),e.shortcut("dashpivottable",FX.DashPivotTable)}(jQuery),function(e){FX.DashNumber=FX.extend(FX.Widget,{DEFAULT_SIZE:{defaultSizeX:15,defaultSizeY:5,single:{minSizeX:10,minSizeY:5},double:{minSizeX:10,minSizeY:8}},_defaultConfig:function(){return e.extend(FX.DashNumber.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_dash_number",minRow:8,onStopEdit:null})},_init:function(){FX.DashNumber.superclass._init.apply(this,arguments);var t=this.options,i=this;this.$content=e('<div class="range-number"/>').appendTo(this.element),this.numberLimit=new FX.NumberLimit({renderEl:this.$content,width4number:"auto",width:t.width,height:30,onStopEdit:function(){FX.Utils.applyFunc(i,t.onStopEdit,[],!1)}}),this._doWrap(t.sizeY>t.minRow)},_doWrap:function(e){e?this.$content.addClass("wrap"):this.$content.removeClass("wrap")},_initDefaultValue:function(){var e=this.options;FX.Utils.isObjectEmpty(e.defaultConfig)||this.setValue(e.defaultConfig)},doResize:function(e){FX.DashNumber.superclass.doResize.apply(this,arguments);var t=this.options;this.numberLimit.doResize(e),e&&(t.sizeX=e.sizeX,t.sizeY=e.sizeY,this._doWrap(e.sizeY>t.minRow))},setValue:function(e){this.numberLimit.setValue(e)},getValue:function(){return this.numberLimit.getValue()},getSize:function(){var t=this.options,i={defaultSizeX:this.DEFAULT_SIZE.defaultSizeX,defaultSizeY:this.DEFAULT_SIZE.defaultSizeY};return t.sizeY>t.minRow?e.extend(i,this.DEFAULT_SIZE.double):e.extend(i,this.DEFAULT_SIZE.single)},getEditConfig:function(){var e=this.options;return{fields:e.fields,triggers:e.triggers,defaultConfig:this.getValue()}},getOptions:function(){return e.extend(FX.DashNumber.superclass.getOptions.apply(this,arguments),{type:"number_filter"},this.getEditConfig())},rebuild:function(e){var t=this.options;t.defaultConfig=e.defaultConfig,t.fields=e.fields,FX.DashNumber.superclass.rebuild.apply(this,arguments)}}),e.shortcut("dashnumber",FX.DashNumber)}(jQuery),function(e){FX.DashAddress=FX.extend(FX.Widget,{DEFAULT_SIZE:{defaultSizeX:20,defaultSizeY:5,single:{minSizeX:20,minSizeY:5},double:{minSizeX:15,minSizeY:8}},ITEM_WIDTH:{NO_WRAP:{width4province:"33.3%",width4city:"33.3%",width4district:"33.3%"},WRAP:{width4province:"100%",width4city:"50%",width4district:"50%"}},_defaultConfig:function(){return e.extend(FX.DashAddress.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_dash_address",minRow:8,onStopEdit:null})},_init:function(){FX.DashAddress.superclass._init.apply(this,arguments);var t=this.options,i=this;this.$content=e('<div class="range-address"/>').appendTo(this.element),this.address=new FX.Address(e.extend({renderEl:this.$content,needDetail:!1,width:t.width,height:t.height,value:t.defaultConfig,onStopEdit:function(){FX.Utils.applyFunc(i,t.onStopEdit,[],!1)}},this.ITEM_WIDTH.NO_WRAP)),this._doWrap(t.sizeY>t.minRow)},_doWrap:function(t){t?(this.$content.addClass("wrap"),e.extend(this.address.options,this.ITEM_WIDTH.WRAP)):(this.$content.removeClass("wrap"),e.extend(this.address.options,this.ITEM_WIDTH.NO_WRAP)),this.address.rebuild()},_initDefaultValue:function(){var e=this.options;FX.Utils.isObjectEmpty(e.defaultConfig)||this.setValue(e.defaultConfig)},doResize:function(e){FX.DashAddress.superclass.doResize.apply(this,arguments);var t=this.options;this.address.doResize(e),e&&(t.sizeX=e.sizeX,t.sizeY=e.sizeY,this._doWrap(e.sizeY>this.options.minRow))},setValue:function(e){this.address.setValue(e)},getValue:function(){return this.address.getValue()},getSize:function(){var t=this.options,i={defaultSizeX:this.DEFAULT_SIZE.defaultSizeX,defaultSizeY:this.DEFAULT_SIZE.defaultSizeY};return t.sizeY>t.minRow?e.extend(i,this.DEFAULT_SIZE.double):e.extend(i,this.DEFAULT_SIZE.single)},getEditConfig:function(){var e=this.options;return{fields:e.fields,triggers:e.triggers,defaultConfig:this.getValue()}},getOptions:function(){return e.extend(FX.DashAddress.superclass.getOptions.apply(this,arguments),{type:"address_filter"},this.getEditConfig())},rebuild:function(e){var t=this.options;t.defaultConfig=e.defaultConfig,t.fields=e.fields,FX.DashAddress.superclass.rebuild.apply(this,arguments)}}),e.shortcut("dashaddress",FX.DashAddress)}(jQuery),function(e){FX.DashComboCheck=FX.extend(FX.Widget,{DEFAULT_SIZE:{defaultSizeX:15,defaultSizeY:5,minSizeX:10,minSizeY:5},FIELDS:{comboCheck:["combocheck","checkboxgroup","usergroup"],user:["user","usergroup"]},_defaultConfig:function(){return e.extend(FX.DashComboCheck.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_dash_combo_check",minRow:10,onStopEdit:null,customItem:{text:"未填写",value:"hasEmpty"}})},_init:function(){FX.DashComboCheck.superclass._init.apply(this,arguments),this.$content=e('<div class="dash-content"/>').appendTo(this.element),this.vm=this._getViewMode(),this._createComboCheck()},_getViewMode:function(){var e=this.options;return e.sizeY>e.minRow?"checklist":"xcombocheck"},_createComboCheck:function(){var e=this.options,t=this,i=null;if(e.fields&&e.fields.length){var a=e.fields[0],s=FX.Utils.getFieldInfoById(a.form);return i={url:FX.Utils.getApi(FX.API.dash.distinct),data:{formId:s.entryId,type:a.type}},s.appId&&(i.data.refAppId=s.appId),a.subform?i.data.field=a.subform+"."+a.subField:i.data.field=a.field,void t._createMain(i,a.type)}this._createMain(i)},_createMain:function(t,i){var a=this.options,s=this,n={renderEl:e("<div/>").appendTo(this.$content),width:a.width,type:this.vm,async:t,hasLimit:!0,items:[],onStopEdit:function(){FX.Utils.applyFunc(s,a.onStopEdit,[],!1)}},o=!1,l=!1;i&&(o=this.FIELDS.comboCheck.indexOf(i)>-1,l=this.FIELDS.user.indexOf(i)>-1),"checklist"===this.vm?(e.extend(n,{height:"100%"}),l||o||e.extend(n,{customItem:a.customItem})):(o&&e.extend(n,{hasSelectEmpty:!1}),l&&e.extend(n,{type:"usercheck"})),l&&(e.extend(n,{textField:"nickname",valueField:"_id"}),o||e.extend(n,{customItem:{nickname:"未填写",_id:"hasEmpty"}})),this.combocheck=FX.createWidget(n),this._initDefaultValue()},_initDefaultValue:function(){var e=this.options;FX.Utils.isObjectEmpty(e.defaultConfig)||this.setValue(e.defaultConfig)},doResize:function(e){var t=this.options;if(FX.DashComboCheck.superclass.doResize.apply(this,arguments),e&&this.combocheck){this.combocheck.doResize({width:e.width}),t.sizeX=e.sizeX,t.sizeY=e.sizeY;var i=this._getViewMode();if(i===this.vm)return;this.vm=i,this.$content.empty(),this._createComboCheck()}},setValue:function(e){var t=this.options;if(this.combocheck)if("checklist"===this.vm){var i=e.items.slice(0);e.hasEmpty&&i.push(t.customItem.value),this.combocheck.setValue(i)}else this.combocheck.setValue(e)},getValue:function(){var e=this.options;if(this.combocheck){var t=this.combocheck.getValue();if("checklist"===this.vm){var i=!1,a=[];return FX.Utils.forEach(t,function(t,s){s!==e.customItem.value?a.push(s):i=!0}),{hasEmpty:i,items:a}}return t}return{hasEmpty:!1,items:[]}},getSize:function(){return this.DEFAULT_SIZE},getEditConfig:function(){var e=this.options;return{fields:e.fields,triggers:e.triggers,defaultConfig:this.getValue()}},getOptions:function(){return e.extend(FX.DashComboCheck.superclass.getOptions.apply(this,arguments),{type:"text_filter"},this.getEditConfig())},rebuild:function(e){var t=this.options;t.defaultConfig=e.defaultConfig,t.fields=e.fields,FX.DashComboCheck.superclass.rebuild.apply(this,arguments)}}),e.shortcut("dashcombocheck",FX.DashComboCheck)}(jQuery),function(e){FX.DashDeptCheck=FX.extend(FX.Widget,{DEFAULT_SIZE:{defaultSizeX:15,defaultSizeY:5,minSizeX:10,minSizeY:5},_defaultConfig:function(){return e.extend(FX.DashDeptCheck.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_dash_dept_check",minRow:12,onStopEdit:null})},_init:function(){FX.DashDeptCheck.superclass._init.apply(this,arguments),this.$content=e('<div class="dash-content"/>').appendTo(this.element),this.vm=this._getViewMode(),this._createDeptCheck()},_getViewMode:function(){var e=this.options;return e.sizeY>e.minRow?"deptchecklist":"deptcheck"},_createDeptCheck:function(){var e=this.options,t=!0;e.fields&&e.fields.length&&"deptgroup"===e.fields[0].type&&(t=!1),this._createMain(t)},_createMain:function(t){var i=this.options,a=this;t=!1!==t;var s={renderEl:e("<div/>").appendTo(this.$content),width:i.width,type:this.vm,hasSelectEmpty:t,departmentsUrl:FX.Utils.getApi(FX.API.dash.departments),currentDepartmentsUrl:FX.Utils.getApi(FX.API.dash.current_departments),onStopEdit:function(){FX.Utils.applyFunc(a,i.onStopEdit,[],!1)}};if("deptchecklist"===this.vm){var n="dash_dept_check";t&&(n+=" has-empty"),s.customCls=n}this.deptcheck=FX.createWidget(s),this._initDefaultValue()},_initDefaultValue:function(){var e=this.options;FX.Utils.isObjectEmpty(e.defaultConfig)||this.setValue(e.defaultConfig)},doResize:function(e){var t=this.options;if(FX.DashDeptCheck.superclass.doResize.apply(this,arguments),e&&this.deptcheck){this.deptcheck.doResize({width:e.width}),t.sizeX=e.sizeX,t.sizeY=e.sizeY;var i=this._getViewMode();if(i===this.vm)return;this.vm=i,this.$content.empty(),this._createDeptCheck()}},setValue:function(e){this.deptcheck&&this.deptcheck.setValue(e)},getValue:function(){return this.deptcheck?this.deptcheck.getValue():{hasEmpty:!1,items:[]}},getSize:function(){return this.DEFAULT_SIZE},getEditConfig:function(){var e=this.options;return{fields:e.fields,triggers:e.triggers,defaultConfig:this.getValue()}},getOptions:function(){return e.extend(FX.DashDeptCheck.superclass.getOptions.apply(this,arguments),{type:"dept_filter"},this.getEditConfig())},rebuild:function(e){var t=this.options;t.defaultConfig=e.defaultConfig,t.fields=e.fields,FX.DashDeptCheck.superclass.rebuild.apply(this,arguments)}}),e.shortcut("dashdeptcheck",FX.DashDeptCheck)}(jQuery),function(e){FX.DashButton=FX.extend(FX.Widget,{DEFAULT_SIZE:{defaultSizeX:6,defaultSizeY:3,minSizeX:4,minSizeY:2},_defaultConfig:function(){return e.extend(FX.DashButton.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_dash_button",onClick:null,text:"筛选"})},_init:function(){FX.DashButton.superclass._init.apply(this,arguments);var e=this.options,t=this;this.element.addClass("x-btn style-green").text(e.text).on("click",function(){FX.Utils.applyFunc(t,e.onClick,[],!1)})},doResize:function(e){FX.DashButton.superclass.doResize.apply(this,arguments),e&&this.element.css("line-height",e.height+"px")},getSize:function(){return this.DEFAULT_SIZE},getOptions:function(){return e.extend(FX.DashButton.superclass.getOptions.apply(this,arguments),{type:"filter_btn"})}}),e.shortcut("dashbutton",FX.DashButton)}(jQuery),FX.Dash=FX.extend(FX.Widget,{_defaultConfig:function(){return $.extend(FX.Dash.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_dash",entryId:"",components:{},sizeUnit:15,cols:60,gap:10,padding:[2,5],hasLazyLoad:!1,supportExport:!0,relative:!1,scrollView:null})},_init:function(){FX.Dash.superclass._init.apply(this,arguments);var e=this.options;FX.STATIC.ENTRYID=e.entryId,this.widgetsMap={},this._initSizeUnit(),this._initFilter(),this._renderComponents(),this._bindLazyLoadEvt()},_initSizeUnit:function(){var e=this.options,t=this.element.width()-e.gap-2*e.padding[1];this.widthUnit=Math.max(t/e.cols,e.sizeUnit),this.heightUnit=e.sizeUnit},_getSize:function(e){var t=this.options;return{x:e.posX*this.widthUnit+t.gap+t.padding[1],y:e.posY*this.heightUnit+t.gap+t.padding[0],width:e.width*this.widthUnit-t.gap,height:e.height*this.heightUnit-t.gap}},_renderComponents:function(){var e=this,t=this.options;FX.Utils.forEach(t.components,function(t,i){if(i){var a=e._renderWidget(t,i);e.hasFilterBtn||a.setFilter(e._getFilter(t))}}),this.$dashGap=$('<div class="dash-gap"/>').css({top:this.lastBottomHeight+"px",height:t.gap+"px"}).appendTo(this.element),this._doLazyLoad()},_renderWidget:function(e,t){var i=this,a=this.options,s=$('<div class="dash-widget"/>').appendTo(this.element),n=this._getSize(t);s.css({left:n.x+"px",top:n.y+"px",width:n.width+"px",height:n.height+"px"}),this.lastBottomHeight?this.lastBottomHeight=Math.max(this.lastBottomHeight,n.y+n.height):this.lastBottomHeight=n.y+n.height;var o=new FX.DashBlock($.extend({renderEl:s,widget:t,operate:this._getOperate(t),hasLazyLoad:a.hasLazyLoad,mode:"visit",widgetId:e,onItemClick:function(e){FX.Utils.forEach(t.triggers,function(t,a){var s=i.getWidgetByName(a);s&&(s.setLinkFilter(e),s.reload())})},onClick:function(){i._dealFilter()},onOperateTrigger:function(t){i._dealOperate(t,e)},onStopEdit:function(){var a=this.getValue();i._updateFilter(e,i._getFilterConfig(t),a),i.hasFilterBtn||i._dealFilter(t.triggers)}},this._getBlockConfig(t.type)));return this.widgetsMap[e]=o,o},_getOperate:function(e,t){var i=[];return this._isSupportExport(e.type)&&e.hasExport&&i.push("export"),e.form&&(t?i.push("shrink"):i.push("enlarge")),i},_isSupportExport:function(e){return this.options.supportExport&&/table/.test(e)},_dealOperate:function(e,t){var i=this.widgetsMap[t];if(i)switch(e){case"enlarge":i.updateOperate(this._getOperate(i.getOptions(),!0)),i.enlarge();break;case"shrink":i.updateOperate(this._getOperate(i.getOptions(),!1)),i.shrink();break;case"export":i.dealExcelExport()}},_getFilterConfig:function(e){var t={};switch(e.type){case"dept_filter":case"text_filter":e.fields&&e.fields.length?t.type=e.fields[0].type:t.type="text";break;case"number_filter":t.type="number";break;case"date_filter":t.type="datetime",t.format="yyyy-MM-dd";break;case"datetime_filter":t.type="datetime",t.format="yyyy-MM-dd HH:mm:ss";break;case"address_filter":t.type="address"}return t},_initFilter:function(){var e=this.options,t=this;this.hasFilterBtn=!1,this.filter={},FX.Utils.forEach(e.components,function(e,i){if(i){"filter_btn"===i.type&&(t.hasFilterBtn=!0);var a=t._getFilterConfig(i);if(a.type&&i.fields.length){var s=i.fields[0];t.filter[e]={entryId:s.form,field:s.field,triggers:i.triggers},i.defaultConfig&&t._updateFilter(e,a,i.defaultConfig)}}})},_updateFilter:function(e,t,i){var a=i,s={type:t.type};switch(this.filter[e]=this.filter[e]||{},t.type){case"datetime":a=[],i.min?a.push(FX.Utils.date2Str(new Date(i.min),t.format)):a.push(null),i.max?a.push(FX.Utils.date2Str(new Date(i.max),t.format)):a.push(null),s.method=FX.CONST.FILTER_METHOD.RG,s.value=a;break;case"address":case"location":a=[i.province,i.city,i.district],s.type="address",s.method=FX.CONST.FILTER_METHOD.ALL,s.value=a;break;case"number":a=[i.min||null,i.max||null],s.method=FX.CONST.FILTER_METHOD.RG,s.value=a;break;case"user":case"dept":$.extend(s,this._getComboCheckFilter(t.type,FX.CONST.FILTER_METHOD.IN,a));break;case"combocheck":case"checkboxgroup":$.extend(s,this._getComboCheckFilter("combocheck",FX.CONST.FILTER_METHOD.ALL,a));break;case"usergroup":case"deptgroup":$.extend(s,this._getComboCheckFilter(t.type,FX.CONST.FILTER_METHOD.ALL,a));break;default:$.extend(s,this._getComboCheckFilter("text",FX.CONST.FILTER_METHOD.IN,a))}$.extend(this.filter[e],s)},_getComboCheckFilter:function(e,t,i){return{type:e,hasEmpty:!(!i||!i.hasEmpty),method:t,value:$.makeArray(i&&i.items)}},_getFilter:function(e){var t=[];return FX.Utils.forEach(this.filter,function(i,a){a.triggers&&a.method&&a.triggers.indexOf(e)>-1&&t.push(a)}),FX.Utils.getValidFilters({cond:t}).cond},_dealFilter:function(e){var t=this;e?FX.Utils.forEach(e,function(e,i){var a=t.widgetsMap[i];a&&(a.setFilter(t._getFilter(i)),a.reload())}):FX.Utils.forEach(this.widgetsMap,function(e,i){i&&(i.setFilter(t._getFilter(e)),i.reload())})},_bindLazyLoadEvt:function(){var e=this.options,t=this;if(e.hasLazyLoad){this._doLazyLoad();var i=this.element;e.scrollView&&(i=$(e.scrollView)),i.unbind("scroll.lazy"),i.bind("scroll.lazy",function(){t._doLazyLoad()})}},_doLazyLoad:function(){this.options.hasLazyLoad&&FX.Utils.forEach(this.widgetsMap,function(e,t){t&&(t.isWidgetLoaded()||$(t.element).offset().top<=document.body.clientHeight&&t.loadWidget())})},_getBlockConfig:function(e){var t={};switch(e){case"filter_btn":t={margin:[0,0]}}return t},getWidgetByName:function(e){return this.widgetsMap[e]},updateComponentsPos:function(){var e=this,t=this.options;this._initSizeUnit(),FX.Utils.forEach(t.components,function(t,i){if(i){var a=e._getSize(i);e.widgetsMap[t].element.css({left:a.x+"px",top:a.y+"px",width:a.width+"px",height:a.height+"px"}),e.widgetsMap[t].doResize(),e.lastBottomHeight?e.lastBottomHeight=Math.max(e.lastBottomHeight,a.y+a.height):e.lastBottomHeight=a.y+a.height}}),this.$dashGap.css({top:this.lastBottomHeight+"px",height:t.gap+"px"})},doResize:function(e,t){FX.Dash.superclass.doResize.apply(this,arguments);var i=this.options;t&&this.updateComponentsPos(),i.relative&&this.element.addClass("relative").css({height:this.lastBottomHeight+10})}}),$.shortcut("dash",FX.Dash),function(e){FX.TableContainer=FX.extend(FX.Container,{_defaultConfig:function(){return e.extend(FX.TableContainer.superclass._defaultConfig.apply(this,arguments),{baseCls:"x-layout-table",rowSize:[],colSize:[],hgap:0,vgap:0,items:[],padding:0})},_init:function(){FX.TableContainer.superclass._init.apply(this,arguments),this.$rows=[];var t=this.options;t.padding&&this.element.css({padding:t.padding});for(var i=0,a=t.rowSize.length;i<a;i++){for(var s=e('<div class="x-layout-table-row"/>').appendTo(this.element),n=0,o=t.colSize.length;n<o;n++){var l=t.items[i][n];if(l){var r=e('<div class="x-layout-table-item"/>').appendTo(s);l.type?this._addWidget(e.extend(l,{width:l.width?l.width:t.colSize[n],height:l.height?l.height:t.rowSize[i],renderEl:r})):r.css({width:t.colSize[n],height:t.rowSize[i]}).append(l),n>0&&r.css({"margin-left":t.hgap})}}i>0&&s.css({"margin-top":t.vgap}),this.$rows.push(s)}},getRowAt:function(e){return this.$rows[e]},setRowVisible:function(e,t){for(var i=0,a=e.length;i<a;i++)t?this.$rows[e[i]].show():this.$rows[e[i]].hide()}}),e.shortcut("tablecontainer",FX.TableContainer)}(jQuery),function(e){FX.CheckBox=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.CheckBox.superclass._defaultConfig.apply(),{baseCls:"x-check",isSelected:!1,onStateChange:null})},_init:function(){FX.CheckBox.superclass._init.apply(this,arguments);var t=this.options,i=this;e('<i class="icon-blank"/>').appendTo(this.element),this.$text=e("<span/>").appendTo(this.element),this.element.click(function(){i.isEnabled()&&i.setSelected(!t.isSelected)&&FX.Utils.applyFunc(i,t.onStateChange,[t.isSelected],!1)})},_initDefaultValue:function(){var e=this.options;FX.Utils.isEmpty(e.text)||this.setText(e.text),e.value&&this.setValue(e.value)},setSelected:function(e){return this.options.isSelected!==e&&(this.options.isSelected=e,e?this.element.addClass("select"):this.element.removeClass("select"),!0)},isSelected:function(){return this.options.isSelected},setValue:function(e){e?this.setSelected(!0):this.setSelected(!1)},getValue:function(){return this.isSelected()},setText:function(e){this.$text.text(e)},getText:function(){return this.$text.text()}}),e.shortcut("checkbox",FX.CheckBox)}(jQuery),function(e){FX.Switch=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Switch.superclass._defaultConfig.call(),{baseCls:"fui_switch",width:44,height:22,value:!1,onSwitch:null,btnPadding:2,text4On:"开",text4Off:"关"})},_init:function(){FX.Switch.superclass._init.apply(this,arguments);var t=this.options,i=this;this.$text=e('<span class="switch-text"/>').text(t.text4On).appendTo(this.element),this.$btn=e('<span class="switch-btn"/>').appendTo(this.element),this.element.click(function(){i.isEnabled()&&i._doSwitch(!t.value,!0)})},_doSwitch:function(e,t){var i=this.options,a=this,s={},n={},o="";i.value=e,!0===i.value?(this.element.addClass("on").removeClass("off"),this.$text.text(""),s.left=i.width-i.height+i.btnPadding,n["padding-left"]=0,n["padding-right"]=i.height-3*i.btnPadding,o=i.text4On):(this.element.addClass("off").removeClass("on"),this.$text.text(""),s.left=i.btnPadding,n["padding-left"]=i.height-3*i.btnPadding,n["padding-right"]=0,o=i.text4Off),t?this.$btn.animate(s,150,function(){a.element.css(n),a.$text.text(o),FX.Utils.applyFunc(a,i.onSwitch,[i.value],!1)}):(this.$btn.css(s),this.element.css(n),this.$text.text(o))},setValue:function(e){this._doSwitch(e,!1)},getValue:function(){return this.options.value},doResize:function(e){FX.Switch.superclass.doResize.apply(this,arguments);var t=this.options,i=t.height,a=t.width,s=i-2*t.btnPadding,n={};i&&(n["line-height"]=i+"px"),a&&(this.$btn.css({width:s,height:s}),n["border-radius"]=a/2),this.element.css(n)}}),e.shortcut("switch",FX.Switch)}(jQuery),function(e){FX.Button=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Button.superclass._defaultConfig.apply(),{baseCls:"x-btn",iconCls:null,style:"blue"})},_init:function(){FX.Button.superclass._init.apply(this,arguments);var t=this.options,i=this;t.iconCls&&e("<i/>").addClass(t.iconCls).appendTo(this.element),this.$text=e("<span/>").appendTo(this.element),t.style&&this.element.addClass("style-"+t.style),t.hoverCls&&this.element.hover(function(){i.isEnabled()&&e(this).addClass(t.hoverCls)},function(){i.isEnabled()&&e(this).removeClass(t.hoverCls)}),this.element.click(function(e){i.isEnabled()&&FX.Utils.applyFunc(i,t.onClick,[e],!1)})},doResize:function(e){FX.Button.superclass.doResize.apply(this,arguments);var t=this.options;FX.Utils.isEmpty(t.height)||this.element.css("line-height",t.height-2+"px")},setValue:function(e){FX.Button.superclass.setValue.apply(this,arguments),FX.Utils.isNull(e)&&(e=""),this.$text.text(e)},setText:function(e){FX.Button.superclass.setText.apply(this,arguments),FX.Utils.isNull(e)&&(e=""),this.$text.text(e)}}),e.shortcut("button",FX.Button)}(jQuery),function(e){FX.Label=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Label.superclass._defaultConfig.apply(),{baseCls:"x-label",text:"",onClick:null})},_init:function(){FX.Label.superclass._init.apply(this,arguments);var t=this,i=this.options;this.$label=e("<a/>").appendTo(this.element),i.onClick&&this.$label.addClass("link").click(function(){FX.Utils.applyFunc(t,i.onClick,[t.$label],!1)})},setText:function(e){e=FX.Utils.isNull(e)?"":e,this.$label.text(e)},setValue:function(e){this.setText(e)}}),e.shortcut("label",FX.Label)}(jQuery),function(e){FX.MultiTextEditor=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.MultiTextEditor.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_multi_text",value:[],waterMark:"请输入文本内容，多个值用‘enter’分开",maxWidth4ValList:200,onStopEdit:null})},_init:function(){var e=this.options;FX.MultiTextEditor.superclass._init.apply(this,arguments),this.element.css({lineHeight:e.height-2+"px"}),this.valList=e.value,this.activeValIdx=-1,this.editVal="",this._createContent(this.valList),this._bindEvent(),this._dealWaterMark()},_createContent:function(e){this._createValList(e),this._createInput(this.editVal)},_createValList:function(t){var i=this,a=this.options;this.$valWrapper&&this.$valWrapper.remove(),this.$valWrapper=e('<div class="val-wrapper"/>').css({maxWidth:a.maxWidth4ValList}).appendTo(this.element),this.$list=e('<div class="val-list"/>').appendTo(this.$valWrapper),FX.Utils.forEach(t,function(e,t){var a=i._createValTag(t).appendTo(i.$list);e===i.activeValIdx&&a.addClass("active")}),this._adjustListPos()},_adjustListPos:function(){var t=this.$list.width(),i=this.$valWrapper.width()-t,a=e(".active",this.$list);if(a.length){var s=a.position().left;s<-i&&(i=-s-5)}this.$list.css({left:i})},_createValTag:function(t){return e('<span class="val-tag"/>').text(t)},_createInput:function(t){var i=this;return this.$input&&this.$input.remove(),this.$input=e('<input class="text-input"/>').val(t).on("input propertychange",function(){i.editVal=this.value}).appendTo(this.element),this.$input},_bindEvent:function(){var e=this;this.element.attr("tabindex",-1),this.element.on("keydown",function(t){switch(t.which||t.keyCode){case FX.CONST.KEY_CODE.ENTER:e._addValTag();break;case FX.CONST.KEY_CODE.BACKSPACE:e._removeValTag();break;case FX.CONST.KEY_CODE.LEFT:e._focusValTag("left");break;case FX.CONST.KEY_CODE.RIGHT:e._focusValTag("right")}}),this.element.on("blur",".text-input",function(){e._dealWaterMark(),e.element.focus(),e._addValTag()}),this.element.on("focus",".text-input",function(){e._removeWaterMark()})},_focusValTag:function(e){if(!FX.Utils.isObjectEmpty(this.valList)&&FX.Utils.isEmpty(this.editVal)){var t=this.activeValIdx,i=!1;switch(e){case"left":t<0?this.activeValIdx=this.valList.length-1:t>0&&(this.activeValIdx-=1);break;case"right":t>-1&&(this.valList.length===t+1?(this.activeValIdx=-1,i=!0):this.activeValIdx+=1)}this.refresh(i?"focus":"blur")}},_addValTag:function(){var e=this.options;FX.Utils.isEmpty(this.editVal)||(this.valList.push(this.editVal),this.editVal="",this.refresh("focus"),FX.Utils.applyFunc(this,e.onStopEdit,[],null))},_removeValTag:function(){var e=this.options;if(FX.Utils.isEmpty(this.editVal)){this.valList.splice(this.activeValIdx,1);var t=!1;this.activeValIdx>=this.valList.length&&(this.activeValIdx=-1),this.activeValIdx<0&&(t=!0),this.refresh(t?"focus":"blur"),FX.Utils.applyFunc(this,e.onStopEdit,[],null)}},_dealWaterMark:function(){var t=this.options;FX.Utils.isObjectEmpty(this.valList)&&!this.$waterMark?this.$waterMark=e('<div class="water-mark"/>').text(t.waterMark).appendTo(this.element):FX.Utils.isObjectEmpty(this.valList)||this._removeWaterMark()},_removeWaterMark:function(){this.$waterMark&&(this.$waterMark.remove(),this.$waterMark=null)},getValue:function(){var t=[];return e(".val-tag",this.$list).each(function(i,a){var s=e(a);t.push(s.text())}),t},refresh:function(e){this._createContent(this.valList),"focus"===e&&this.$input.focus()}}),e.shortcut("multitext",FX.MultiTextEditor)}(jQuery),function(e){FX.ComboTree=FX.extend(FX.Trigger,{_defaultConfig:function(){return e.extend(FX.ComboTree.superclass._defaultConfig.apply(),{baseCls:"fui_combotree",triggerIcon:"icon-caret-down",triggerList:"combotree-list",delimiter:",",items:null,onAfterNodeClick:null})},_init:function(){FX.ComboTree.superclass._init.apply(this,arguments),this.value=[],this.text=[],this.options.async||this._createTreeView()},_onTriggerClick:function(t){if(this.isEnabled()){var i=this;this._showTreeView(),e(document).bind("mousedown.treeview",function(t){var a=t.target;0===e(a).closest(i.treeView).length&&i._hideTreeView()})}},_createTreeView:function(){var t=this.options,i=this;this.treeView=e('<div class="x-dropdown x-dropdown-list"/>').addClass(t.triggerList),this.tree=new FX.Tree({renderEl:this.treeView,Nodes:t.items,setting:{treeId:t.treeId,data:{simpleData:{enable:!0}},callback:{onClick:function(e,a){a.isParent?this.onSwitchNode(e,a):(i._setValueByNode(a),FX.Utils.applyFunc(i,t.onAfterNodeClick,[a],!1),i._hideTreeView())}}}})},_setValueByNode:function(e){if(e){this.value=[e.id],this.text=[e.name];for(var t=e.getParentNode();t;)this.value.unshift(t.id),this.text.unshift(t.name),t=t.getParentNode()}this.editComp&&this.editComp.val(this.text.join(this.options.delimiter))},_hideTreeView:function(){this.treeView&&(e(document).unbind("mousedown.treeview"),this.treeView.detach())},_showTreeView:function(){null==this.treeView&&this._createTreeView(),this.treeView.appendTo("body").css(this._calTriggerViewPos()).show()},setValue:function(t){var i=this,a=e.makeArray(t),s=this.tree.getNodes();this.value=[],this.text=[],FX.Utils.forEach(a,function(e,t){var n=!1;if(FX.Utils.forEach(s,function(o,l){if(l.id===t)return i.value.push(l.id),i.text.push(l.name),n=!0,s=l.children,e===a.length-1&&i.tree.selectNode(l),!1}),!n)return!1}),this.editComp&&this.editComp.val(this.text.join(this.options.delimiter))},getValue:function(){return this.value},getText:function(){return this.text}}),e.shortcut("combotree",FX.ComboTree)}(jQuery),function(e){FX.Grid=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Grid.superclass._defaultConfig.call(),{baseCls:"fui-grid",baseId:null,itemsPerPage:15,items:[],columnsConfig:[],footAlign:"bottom",isHeadShow:!0,multiSelect:!1,intervalColor:!1,noWrap:!1,async:null,hasHoverCls:!0,hasPagination:!1,onPageTurn:null,onAsyncSuccess:null,onAsyncError:null,onBeforeRowCreate:null,onAfterRowCreate:null,onBeforeHeadCreate:null,onAfterHeadCreate:null,onAfterRowCheck:null})},_init:function(){FX.Grid.superclass._init.apply(this,arguments);var e=this.options;e.baseId&&this.element.attr("id",e.baseId),e.noWrap&&this.element.addClass("cell-nowrap"),e.hasPagination&&!this.page&&(this.page=0),this.refresh()},refresh:function(t){var i=this,a=this.options;if(e.isArray(t))a.items=t,this._createTable();else if(a.async){var s=a.async.data;a.hasPagination&&(s=e.extend({},s,{skip:this.page*a.itemsPerPage,limit:a.itemsPerPage})),FX.Utils.ajax({url:a.async.url,data:s},function(e,s){FX.Utils.applyFunc(i,a.onAsyncSuccess,[e,s,t],!1),a.hasPagination&&(i.count=e.count),i._createTable()},function(e,s){FX.Utils.applyFunc(i,a.onAsyncError,[e,s,t],!1)})}else this._createTable()},_createTable:function(){var t=this.options;t.multiSelect&&(this.allBoxes=[]),this.element.empty(),this.$container=e('<div class="fui-grid-table"/>').appendTo(this.element),this.$table=e('<table cellPadding="0" cellSpacing="0"/>'),this._onCreateHead(),this._onCreateTable(),this._bindEvts(),t.hasPagination&&this._createPagination(),this.$container.append(this.$table)},_onCreateHead:function(){var t=this.options,i=this,a=t.isHeadShow;this.$head=e("<thead/>");var s=e("<tr/>").appendTo(this.$head);FX.Utils.applyFunc(this,t.onBeforeHeadCreate,[s],!1),t.multiSelect&&(this.$AllCheck=new FX.CheckBox({width:25,onStateChange:function(){if(i.allBoxes){var e=this.isSelected();FX.Utils.forEach(i.allBoxes,function(t,i){i.isEnabled()&&i.setValue(e)}),FX.Utils.applyFunc(i,t.onAfterRowCheck,[this.isSelected()],!1)}}}),e("<td/>").width(25).append(this.$AllCheck.element).appendTo(s)),FX.Utils.forEach(t.columnsConfig,function(t,i){var a=e("<td/>").width(i.width),n=FX.Utils.applyFunc(this,i.onHeadCellCreate,[t,i],!1);!1===n?a.css("text-align",i.textAlign?i.textAlign:"left").text(i.value?i.value:i.key):a.append(n),a.appendTo(s)}),FX.Utils.applyFunc(this,t.onAfterHeadCreate,[s],!1),a&&this.$table.append(this.$head)},_onCreateTable:function(){this.$tbody=e("<tbody/>");var t=this,i=this.options.items;FX.Utils.forEach(i,function(e,i){var a=t.onCreateRow(e,i);t.$tbody.append(a)}),this.$table.append(this.$tbody)},_bindEvts:function(){var e=this,t=this.options,i=function(i){var a=i.target,s=i.type,n=e._getTargetDom(a,"TR");if(n){var o=n.data("item");"mousedown"===s?FX.Utils.applyFunc(e,t.onRowMouseDown,[n,o],!1):"mouseover"===s?(t.hasHoverCls&&n.addClass("hover"),FX.Utils.applyFunc(e,t.onRowMouseOver,[n,o],!1)):"mouseout"===s?(n.removeClass("hover"),FX.Utils.applyFunc(e,t.onRowMouseOut,[n,o],!1)):"mouseup"===s&&FX.Utils.applyFunc(e,t.onRowClick,[n,o],!1)}};this.$tbody.unbind(),this.$tbody.bind("mousedown",i).bind("mouseover",i).bind("mouseup",i).bind("mouseout",i)},_getTargetDom:function(t,i){for(;t&&t.tagName;){if(t.tagName.toUpperCase()===i.toUpperCase())return e(t);t=t.parentNode}return null},onCreateRow:function(t,i){var a=this,s=this.options,n=e("<tr/>").data("item",i);if(FX.Utils.applyFunc(this,s.onBeforeRowCreate,[n,t,i],!1),s.multiSelect){var o=new FX.CheckBox({width:25,enable:!1!==i.enable,gridRowData:i,onStateChange:function(){if(a.$AllCheck){if(this.isSelected()){var e=!0;FX.Utils.forEach(a.allBoxes,function(t,i){if(!i.isSelected())return e=!1,!1}),a.$AllCheck.setValue(e)}else a.$AllCheck.setValue(!1);FX.Utils.applyFunc(a,s.onAfterRowCheck,[this.isSelected()],!1)}}});i.selected&&o.setSelected(i.selected),this.allBoxes.push(o),e("<td/>").append(o.element).appendTo(n)}return FX.Utils.forEach(s.columnsConfig,function(e,s){a.onCellCreate(t,e,i,s).appendTo(n)}),s.intervalColor&&t%2==0&&n.addClass("even"),FX.Utils.applyFunc(this,s.onAfterRowCreate,[n,t,i],!1),n},onCellCreate:function(t,i,a,s){var n=e("<td/>"),o=this,l=this.options,r=FX.Utils.applyFunc(this,s.onCellCreate,[t,i,a,s],!1);if(!1===r){if(!FX.Utils.isEmpty(s.value)){var d=FX.Utils.isEmpty(a[s.key])?"":a[s.key];r=e('<div class="cell"/>').text(d).attr("title",d).appendTo(n)}l.noWrap&&r.css({maxWidth:s.width})}else n.append(r);return n.click(function(){FX.Utils.applyFunc(o,s.onCellClick,[t,i,a,s,r],!1)}),FX.Utils.applyCss(r,s.css),n},getValue:function(){return this.options.items},addRowData:function(e){if(this.options.async);else{var t=this.onCreateRow(this.options.items.length,e);this.options.items.push(e),t.appendTo(this.$tbody)}},getSelectedData:function(){var e=[];return this.allBoxes&&FX.Utils.forEach(this.allBoxes,function(t,i){i.isSelected()&&e.push(i.options.gridRowData)}),e},hasMore:function(){var e=this.options;return(this.page+1)*e.itemsPerPage<this.count},_createPagination:function(){var t=this,i=this.options;new FX.Pagination({renderEl:e("<div />").appendTo(this.element),count:this.count,limit:i.itemsPerPage,curPage:this.page+1,onChangePage:function(e,i){t.page=e-1,t.rebuild()}})}}),e.shortcut("grid",FX.Grid)}(jQuery),function(e){FX.PlainTable=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.PlainTable.superclass._defaultConfig.apply(),{baseCls:"fx_plain_table",tableHead:[],tableRowHead:[],tableData:[],isHeadSticky:!1,isRowHeadSticky:!1,onHeadCellClick:null,onRowClick:null,onOpBtnClick:null,onRowCreate:null,onMouseOverRow:null,onMouseOutRow:null})},_init:function(){FX.PlainTable.superclass._init.apply(this,arguments),this._createTable(),this.bindEvent()},_createTable:function(){var t=this,i=this.options;this.$tableScroller=e('<div class="table-scroller"/>').on("scroll",function(){t._scrollStickyHead()}).appendTo(this.element),this.$table=e('<table class="x-table x-table-bordered x-table-striped"/>').appendTo(this.$tableScroller);var a=e('<thead class="t-head"/>').appendTo(this.$table);i.tableHead.length>0&&FX.Utils.forEach(i.tableHead,function(i,s){var n=e('<tr class="t-row th-row"/>').appendTo(a);FX.Utils.forEach(s,function(e,i){t._createCell(i,{tag:"th",cls:"th-cell"}).appendTo(n)})});var s=e('<tbody class="t-body" />').appendTo(this.$table);FX.Utils.forEach(i.tableData,function(a,n){var o=a%2==0?"odd":"even",l=e('<tr class="t-row tb-row"/>').addClass(o).appendTo(s);FX.Utils.applyFunc(t,i.onRowCreate,[l,a],null),FX.Utils.forEach(i.tableRowHead,function(e,i){var s=i[a];s&&t._createCell(s,{tag:"th",cls:"rh-cell"}).appendTo(l)}),FX.Utils.forEach(n,function(e,i){i.row=a,i.col=e,t._createCell(i,{tag:"td",cls:"td-cell"}).appendTo(l)})}),this._createStickyHead()},_createCell:function(t,i){this.options;var a=i||{tag:"td"};a.cls&&t.cls&&(t.cls=a.cls+" "+t.cls);var s=e.extend(a,t.text||t.html||!FX.Utils.isString(t)?t:{text:t}),n=e("<"+s.tag+' class="t-cell"/>');switch(n.attr({row:s.row,col:s.col}),s.hasOwnProperty("html")?n.html(s.html):n.text(s.text),s.align){case"center":n.addClass("h-center");break;case"right":n.addClass("h-right")}return FX.Utils.forEach(s.data,function(e,t){n.data(e,t)}),s.cls&&n.addClass(s.cls),s.colspan&&n.attr("colspan",s.colspan),s.rowspan&&n.attr("rowspan",s.rowspan),s.width&&n.width(s.width),s.height&&n.width(s.height),n},_createStickyHead:function(){var t=this,i=this.options;!0===i.isHeadSticky&&(this.$stickyHead=e('<table cellpadding="0" cellspacing="0" class="x-table x-table-bordered x-table-striped"/>').append(this.$table.children(".t-head").clone(!0)).outerWidth(this.$table.outerWidth()),e('<div class="table-sticky-head"/>').css({width:this.$tableScroller[0].clientWidth}).append(this.$stickyHead).appendTo(this.element),this.$stickyHead.find(".t-head .th-cell").each(function(i,a){var s=t.$table.find(".t-head .th-cell").eq(i);e(a).outerWidth(s.outerWidth())})),!0===i.isRowHeadSticky&&(this.$stickyRowHead=e('<table cellpadding="0" cellspacing="0" class="x-table x-table-bordered x-table-striped"/>').append(this.$table.children(".t-head, .t-body").clone(!0)),e('<div class="table-sticky-row-head"/>').css({height:this.$tableScroller[0].clientHeight}).append(this.$stickyRowHead).appendTo(this.element),this.$stickyRowHead.find(".t-head .th-cell").each(function(i,a){var s=t.$table.find(".t-head .th-cell").eq(i);e(a).outerWidth(s.outerWidth())}),this.$stickyRowHead.find(".t-row").each(function(i,a){var s=t.$table.find(".t-row").eq(i);e(a).outerHeight(s.outerHeight())}),this.$stickyRowHead.children(".t-head").children("tr.t-row").each(function(t,i){e(i).children(".th-cell").not(".group-head").remove()}),this.$stickyRowHead.find(".t-body .td-cell").remove()),!0===i.isHeadSticky&&!0===i.isRowHeadSticky&&(this.$stickyIntersect=e('<table cellpadding="0" cellspacing="0" class="x-table x-table-bordered x-table-striped"/>').append(this.$stickyRowHead.children(".t-head").clone(!0)),e('<div class="table-sticky-intersect"/>').append(this.$stickyIntersect).appendTo(this.element))},reload:function(t){e.extend(this.options,t),this.element.empty(),this._createTable()},doResize:function(){FX.PlainTable.superclass.doResize.apply(this,arguments),this.$stickyHead&&this.$stickyHead.parent().remove(),this.$stickyRowHead&&this.$stickyRowHead.parent().remove(),this.$stickyIntersect&&this.$stickyIntersect.parent().remove(),this._createStickyHead(),this._scrollStickyHead()},_scrollStickyHead:function(){var e=this.$tableScroller.scrollTop(),t=this.$tableScroller.scrollLeft();this.$stickyHead&&this.$stickyHead.css({"margin-left":-t}),this.$stickyRowHead&&this.$stickyRowHead.css({"margin-top":-e})},bindEvent:function(){var t=this,i=this.options;this.element.on("click",function(a){var s=e(a.target),n=s.closest(".th-cell");n.length>0&&FX.Utils.applyFunc(t,i.onHeadCellClick,[n],null);var o=s.closest(".tb-row");o.length>0&&FX.Utils.applyFunc(t,i.onRowClick,[o],null);var l=s.closest(".table-op-btn");l.length>0&&FX.Utils.applyFunc(t,i.onOpBtnClick,[l],null)}),this.element.on("mouseover",function(a){var s=e(a.target).closest(".tb-row");s.length>0&&FX.Utils.applyFunc(t,i.onMouseOverRow,[s],null)}),this.element.on("mouseout",function(a){var s=e(a.target).closest(".tb-row");s.length>0&&FX.Utils.applyFunc(t,i.onMouseOutRow,[s],null)})}})}(jQuery),function(e){FX.Dialog=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Dialog.superclass._defaultConfig.apply(),{renderEl:e("<div/>").appendTo("body"),baseCls:"x-dialog",title:"",subTitle:"",animation:300,hasPadding:!1,style4Header:null,hasCloseBtn:!0,contentWidget:{},autoClose:!1,onContentCreate:null,onBeforeClose:null,onClose:null})},_init:function(){FX.Dialog.superclass._init.apply(this,arguments);var t=this.options,i=this;this.$mask=e('<div class="x-window-mask light modal fadeout scrollable"/>').css({"z-index":FX.STATIC.zIndex++}).appendTo("body"),this.element.appendTo(this.$mask),t.autoClose&&this.$mask.click(function(t){e(t.target).hasClass("x-window-mask")&&i._doClose()}),this._createHeader(),this.$content=e('<div class="dialog-body"/>').appendTo(this.element),t.hasPadding&&this.$content.addClass("has-padding"),this._createContent(this.$content)},_createHeader:function(){var t=this.options,i=this,a=e('<div class="dialog-header"/>').append(e('<span class="title"/>').text(t.title)).appendTo(this.element);t.subTitle&&(a.addClass("has-subtitle"),a.append(e('<span class="subtitle"/>').text(t.subTitle))),t.style4Header&&a.addClass(t.style4Header),t.hasCloseBtn&&e('<i class="icon-close-normal"/>').click(function(){i._doClose()}).appendTo(a)},_createContent:function(t){var i=this.options;!1===FX.Utils.applyFunc(this,i.onContentCreate,[t],!1)&&(this.container=FX.createWidget(e.extend({type:"tablecontainer",renderEl:e("<div/>").appendTo(t)},i.contentWidget)))},_doClose:function(){var e=this.options;FX.Utils.applyFunc(this,e.onBeforeClose,[],!0)&&this.close()},getWidgetByName:function(e){return this.container?this.container.getWidgetByName(e):null},show:function(){var e=this;setTimeout(function(){e.$mask.addClass("fadein").removeClass("fadeout")},0)},close:function(){var e=this.options,t=this;this.$mask.addClass("fadeout").removeClass("fadein"),setTimeout(function(){t.element.remove(),t.$mask.remove(),FX.Utils.applyFunc(t,e.onClose,[],!1)},e.animation)},rebuildContent:function(t){this.options=e.extend(this.options,t),this.$content.empty(),this._createContent(this.$content),this.doResize()}}),e.shortcut("dialog",FX.Dialog)}(jQuery),function(e){FX.ConfirmDialog=FX.extend(FX.Dialog,{_defaultConfig:function(){return e.extend(FX.ConfirmDialog.superclass._defaultConfig.apply(),{text4Ok:"确定",text4Cancel:"取消",hasSeparator:!1,onOk:null,onCancel:null,hasPadding:!0,onCreateFooterLeft:null})},_init:function(){FX.ConfirmDialog.superclass._init.apply(this,arguments),this.$content.addClass("has-footer"),this._createFooter().appendTo(this.element)},_createButtonGroup:function(){var t=this,i=this.options,a=e('<div class="dialog-btn-row"/>'),s=e('<div class="dialog-btn ok-btn"/>'),n=e('<div class="dialog-btn cancel-btn"/>');return i.text4Cancel&&(this.btnCancel=new FX.Button({renderEl:n.appendTo(a),widgetName:"confirmBtnCancel",text:i.text4Cancel,style:"white",height:32,onClick:function(){t._handleCancel()}})),i.text4Ok&&(this.btnOk=new FX.Button({renderEl:s.appendTo(a),widgetName:"confirmBtnOK",text:i.text4Ok,style:"green",height:32,onClick:function(){t._handleOk()}})),a},_createFooter:function(){var t=this.options,i=e('<div class="dialog-footer"/>');t.hasSeparator&&i.addClass("has-top-border"),this._createButtonGroup().appendTo(i);var a=e('<div class="footer-left"/>').appendTo(i);return FX.Utils.applyFunc(this,t.onCreateFooterLeft,[a],!1),i},_handleOk:function(){var e=this.options;!1===FX.Utils.applyFunc(this,e.onOk,[],!1)&&this.close()},_handleCancel:function(){var e=this.options;!1===FX.Utils.applyFunc(this,e.onCancel,[],!1)&&this.close()},getOkBtn:function(){return this.btnOk},rebuildContent:function(t){FX.ConfirmDialog.superclass.rebuildContent.apply(this,arguments),e(".dialog-footer",this.element).remove(),this._createFooter().appendTo(this.element)}}),e.shortcut("confirmdialog",FX.ConfirmDialog)}(jQuery),function(e){FX.Form=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Form.superclass._defaultConfig.apply(),{baseCls:"fui-form",title:"",appId:null,entryId:null,dataId:null,onAfterItemCreate:null,onAfterSubmit:null,onSuccess:null,onAfterCancel:null,onAfterClose:null,isPublicData:!1,layout:"normal",mode:"new",submitRule:FX.InvisibleSubmitRules.KEEP,width:780,extParam:null,submitUrl:FX.Utils.getApi(FX.API.data.create),submitData:{},submitText:null,validators:null,ignoreOptAuth:!1,isLaunchFlow:!1,ignoreValidate:!1,widgetOptAuth:null,editValue:null,buttonPosition:"left",hasFooter:!0,hasHeader:!0,onCreateMoreBtn:null,flow:null,authGroupId:null,cacheEnable:!1,updateTime:null})},_init:function(){FX.Form.superclass._init.apply(this,arguments);var e=this.options;FX.STATIC.DATAID=e.dataId,this._initMain()},_initMain:function(){var t=this,i=this.options;i.hasHeader&&(this.$header?this.$header.children("span").text(i.title):this.$header=e('<div class="header"/>').append(e("<span/>").text(i.title)).appendTo(this.element),i.flow&&this._initFlowHeader(),i.onAfterCancel&&e('<i class="icon-close-normal form-exit-icon">').click(function(){t.doCancel()}).appendTo(this.$header)),FX.STATIC.RecnoLock=this._isPreviewMode(),FX.STATIC.EntryRecNo=null,this.$wrapper=e('<div class="widget-wrapper">').appendTo(this.element);var a=e("<ul/>").appendTo(this.$wrapper),s="normal-layout";"grid-2"===i.layout&&(s="grid-layout"),this.element.addClass(s),this.rely=new FX.RelyProcessor(i.items),this.association=new FX.AssociationProcessor(i.items),this.widgetsMap={},i.items&&(i.resultWidgets={},i.widgetOptAuth=i.widgetOptAuth||{},FX.Utils.forEach(i.items,function(e,i){t._createItem(i,a)})),FX.Utils.forEach(this.association.getVisibleMap(),function(e,i){t._setWidgetVisible(e,i)}),this._initFooter(),this._isEditMode()?(FX.Utils.forEach(i.editValue,function(e,i){var a=t.getWidgetByName(e);a&&(a.setValue(i),a.effectItemLinkWidgets&&a.effectItemLinkWidgets())}),this._setLinkQuery()):(this.loadFormData(),i.cacheEnable&&this.needCache||FX.Utils.forEach(this.rely.getDefaultRely(),function(e,i){t._fireWidgetRelyEvent(i,t.rely.options.defaultVersion)}))},_initFooter:function(){var t=this,i=this.options;if(i.hasFooter){this.$footer=e('<div class="footer"/>').appendTo(this.element);var a=i.flow&&i.flow.comment,s=i.flow&&i.flow.signature,n=s&&s.enable,o=a&&a.enable,l=a&&a.required;if(o||n){this.$footer.addClass("comment-footer");var r=e('<div class="comment-pane"><span>审批意见</span></div>').appendTo(this.$footer),d="";o?l?d="*":n&&(d="（手写签名必填）"):n&&(d="*"),!FX.Utils.isEmpty(d)&&r.append(e('<span class="label-notnull"/>').text(d));var c=e('<div class="comment-content"/>').appendTo(r);o&&(this.flowComment=new FX.TextArea({renderEl:e('<div class="content-item"/>').appendTo(c),allowBlank:!l,width:n?585:"100%",height:65,onStopEdit:function(){i.submitData.comment=this.getValue()}})),n&&(this.flowSignature=new FX.Signature({renderEl:e('<div class="content-item"/>').appendTo(c),allowBlank:!1,allowSign:FX.Vip.hasSignature(),height4SignatureBtn:65,onStopEdit:function(){i.submitData.signature=this.getValue(),this.element.removeClass("invalid")},onValidateFail:function(){this.element.addClass("invalid")}}))}var u=e('<div class="btn-pane"/>').addClass(i.buttonPosition).appendTo(this.$footer);i.flow?new FX.FlowBtn({renderEl:u,flow:i.flow,onSubmit:function(a,s,n){"print"===a&&(t.needPrint=!0,a="forward"),i.submitData.flowAction=a,e.extend(i.submitData,n),s?t.doVerifyAndSubmit():t._checkFlowComment(function(){t.doSubmit()})},onCancel:function(){t.doCancel()},onPrint:i.onPrint}):(i.submitText&&new FX.Button({renderEl:e('<div class="ok-btn"/>').appendTo(u),text:i.submitText,width:120,style:"green",onClick:function(){t.doVerifyAndSubmit()}}),i.cancelText&&new FX.Button({renderEl:e('<div class="cancel-btn"/>').appendTo(u),text:i.cancelText,width:120,style:"white",onClick:function(){t.doCancel()}}),i.submitText&&!i.cancelText&&u.addClass("single"),FX.Utils.applyFunc(this,i.onCreateMoreBtn,[u],!1))}},_initFlowHeader:function(){var t=this.options,i=this;FX.Utils.isArray(t.flow.flowNodes)&&(this.flowMenu?this.flowMenu.refresh({currentMenuId:t.submitData.flowId,items:t.flow.flowNodes}):(this.$menu=e("<div/>").appendTo(this.$header.empty()),this.flowMenu=new FX.FlowNodes({renderEl:this.$menu,title:t.title,items:t.flow.flowNodes,currentMenuId:t.submitData.flowId,menuKey:"flowId",onMenuClick:function(e){FX.Utils.applyFunc(i,t.onFlowNodeClick,[t.entryId,t.dataId,e],!1)}}))),this._createFlowInfo()},_createFlowInfo:function(){var t=this.options;this.element.addClass("has-log"),this.flowInfoPane=new FX.FlowInfoPane({renderEl:e('<div class="log-wrapper"/>').appendTo(this.element),flow:t.flow,data:t.data,entryId:t.entryId,authGroupId:t.authGroupId,hasLog:t.flow.hasLogView})},_isEditMode:function(){return"edit"===this.options.mode},_isPreviewMode:function(){return"preview"===this.options.mode},_isNewMode:function(){return"new"===this.options.mode},_setWidgetVisible:function(e,t){var i=this.getWidgetByName(e);if(i){this.widgetVisibleMap||(this.widgetVisibleMap={});var a=i.isVisible(),s=i.element.closest(".widget-view");a&&t?(this.widgetVisibleMap[e]=!0,s.removeClass("x-ui-hidden")):(this.widgetVisibleMap[e]=!1,s.addClass("x-ui-hidden"))}},_dealWidgetAssociation:function(e,t){var i=this,a=this.association.dealAssociation(e,t);FX.Utils.forEach(a,function(e,t){i._setWidgetVisible(e,t)})},_isWidgetVisible:function(e){return!(!e||!e.isVisible())&&!(this.widgetVisibleMap&&!1===this.widgetVisibleMap[e.getWidgetName()])},_getWidgetOptAuth:function(t){var i=this.options,a=this,s={};switch(i.mode){case"new":i.ignoreOptAuth&&(s={ignoreOptAuth:!0,visible:!0,enable:!0});break;case"edit":i.ignoreOptAuth?s={ignoreOptAuth:!0,visible:!0,enable:!0}:(i.flow||!FX.Utils.isNull(i.authGroupId)||i.isPublicData)&&("subform"===t.widget.type&&FX.Utils.forEach(t.widget.items,function(i,s){e.extend(s.widget,a._getWidgetOptAuth({widget:{widgetName:[t.widget.widgetName,s.widget.widgetName].join(".")}}))}),s=i.widgetOptAuth[t.widget.widgetName]||{visible:!1,enable:!1})}return s},_createItem:function(t,i){var a=this.options,s=this,n=e('<li class="widget-view"/>').appendTo(i),o={renderEl:n,description:t.description,label:t.label,mode:a.mode,widget:e.extend(FX.FormUtils.getWidgetDefaultConfig(t.widget.type),t.widget,this._getWidgetOptAuth(t)),layout:this._doLayoutResize({type:t.widget.type},t.lineWidth),onAssociate:function(e,t){s._dealWidgetAssociation(e,t)},onAddSubWidget:function(e){s._addLinkQuery(e)},onCalFormula:function(e){return s._calFormula(e,{})},onGetFilter:function(){return s._iterAddFilter(this)},onGetLinkFilter:function(e,t){var i=[],a=FX.Utils.getSubformRowIdx(this);return FX.Utils.forEach(e,function(e,n){var o=-1;s._isSubformWidget(n.rely)&&(o=a);var l=s.getWidgetByName(n.rely,o);if(l){var r=l.getLinkValue();if(!FX.Utils.isObjectEmpty(r)){var d=s._createDataFilter(l,r,n.link);d.entryId=t,i.push(d)}}}),i},onGetLinkValue:function(e){var t=s.getWidgetByName(e);if(t)return t.getLinkValue()},onRowEdit:function(){if(a.height){var t=e('<div class="editor-container"/>').appendTo(s.element);return a.hasHeader&&t.css({top:s.$header.outerHeight()}),t}return!1},onStopEdit:function(){s._fireWidgetRelyEvent(this,null),s.needCache=!0},onValueChange:function(){s.needCache=!0}},l=new FX.FormItem(o);if(l.supportLayout()){var r=t.lineWidth||FX.CONST.FIELD_LINE_WIDTH;n.addClass("x-grid-col-"+r)}this._addLinkQuery(l),this.rely.addDefaultRely(l),a.resultWidgets[l.getWidgetName()]=l},_doLayoutResize:function(e,t){var i=this.options;return"grid-2"===i.layout&&t===FX.CONST.FIELD_LINE_WIDTH?FX.Utils.setLayoutSize(e,"full-line",e.type):FX.Utils.setLayoutSize(e,i.layout,e.type),e},_fireWidgetRelyEvent:function(e,t){t&&FX.Utils.applyFunc(this,e.options.onRelyDone,[e],!1),this.rely.fireRely(e,t,this)},_iterAddFilter:function(e,t){var i=this;if(e){var a=e.getRely();if(a){t||(t={});var s=e.getWidgetName();if(e.isSubformWidget()&&(s=[e.getSubformName(),s].join(".")),!t[s]){t[s]=!0;var n=[];return a.data&&a.ref&&FX.Utils.forEach(a.widgets,function(s,o){if(t[o])return!1;var l=-1;i._isSubformWidget(o)&&e.isSubformWidget()&&(l=FX.Utils.getSubformRowIdx(e));var r=i.getWidgetByName(o,l);if(!r)return!1;var d=r.getLinkValue(),c=i._createDataFilter(r,d,a.ref.field);return c.entryId=a.ref.formId,n.push(c),n=n.concat(i._iterAddFilter(r,t)||[]),!1}),n}}}},_createDataFilter:function(e,t,i){var a={};if(e){var s=t;if("datetime"===e.getLinkType()){var n=FX.Utils.date2Str(new Date(t),e.getFormat()||"yyyy-MM-dd HH:mm:ss");s=[n,n]}a=FX.Utils.getLinkFilter({type:e.getLinkType(),name:i},s)}return a},dealRely:function(e,t,i,a){var s=this,n=null,o=t.getRely();if(t.isSubformWidget()&&(n=FX.Utils.getSubformRowIdx(t)),o.formula){var l=o.formula.formula,r={};r[e]=a,FX.Utils.forEach(o.widgets,function(e,t){var i=s.getWidgetByName(t,n);if(FX.Utils.isArray(i)){var a=[];FX.Utils.forEach(i,function(e,t){a.push(t.getLinkValue())}),r[t]=a}else i&&(r[t]=i.getLinkValue())});var d=s._calFormula(l,r);t.setValue(d),s._fireWidgetRelyEvent(t,i)}if(o.ref&&o.data){var c=o.data;switch(t.getWidgetType()){case"combo":case"combocheck":t.rebuild(),s._fireWidgetRelyEvent(t,i);break;case"dept":case"deptgroup":t.getValueOption()===FX.WidgetValueOption.CUSTOM?(t.clearLimit(),s._fireWidgetRelyEvent(t,i)):s._dealValueDataLink(c,t,i);break;default:s._dealValueDataLink(c,t,i)}}s._getLinkQueryData(t)},_dealValueDataLink:function(e,t,i){var a=this,s=this._iterAddFilter(t),n=!0;if(FX.Utils.forEach(s,function(t,i){if(i.entryId===e.formId){if(FX.Utils.isObjectEmpty(i.value))return n=!1,!1;var a=!0;return FX.Utils.forEach(i.value,function(e,t){if(!FX.Utils.isEmpty(t))return a=!1,!1}),a?(n=!1,!1):void 0}}),!n)return t.setValue(null),void this._fireWidgetRelyEvent(t,i);e.filter={cond:s,rel:FX.CONST.FILTER_RELATION.AND},FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.link),data:e},function(e){a.rely.checkAsyncVersion(t,i)&&(t.setValue(e.value),a._fireWidgetRelyEvent(t,i))})},_addLinkQuery:function(e){e&&"linkquery"===e.getWidgetType()&&(this.linkQueryWidgets||(this.linkQueryWidgets=[]),this.linkQueryWidgets.push(e))},_setLinkQuery:function(){var e=this;FX.Utils.forEach(this.linkQueryWidgets,function(t,i){e._getLinkQueryData(i)})},_getLinkQueryData:function(e){var t=this;if("linkquery"===e.getWidgetType()){var i=e.getWidgetName(),a=null;e.isSubformWidget()&&(i=[e.getSubformName(),i].join("."),a=FX.Utils.getSubformRowIdx(e)),this.rely.setStateMap(i,this.rely.RELY_END),this.rely.setAsyncMap(i,this.rely.RELY_END);var s=[],n=e.getLinkForm();if(n){var o=!0;FX.Utils.forEach(e.getLinkFilter(),function(e,i){var l=t.getWidgetByName(i.rely,a);if(l&&l.getLinkValue){var r=l.getLinkValue();if(FX.Utils.isObjectEmpty(r))return o=!1,!1;var d=t._createDataFilter(l,r,i.link);d.entryId=n,s.push(d)}}),o&&e.reload({cond:s,rel:FX.CONST.FILTER_RELATION.AND})}}},_isSubformWidget:function(e){return e.indexOf(".")>-1},_calFormula:function(e,t){var i=this,a=e.split(/(\$[0-9a-zA-Z\._#@]+)/g),s=[];FX.Utils.forEach(a,function(e,a){if(FX.Utils.startWith(a,"$_widget_")||FX.Utils.startWith(a,"$ext")){var n=a.replace("$","").split("#"),o=n[0],l=n[1];if(FX.Utils.isEmpty(l)){var r;if(t)r=t[o];else{var d=i.getWidgetByName(o);FX.Utils.isArray(d)?(r=[],FX.Utils.forEach(d,function(e,t){r.push(t.getLinkValue())})):d&&(r=d.getLinkValue())}var c=JSON.stringify(r)+"";c=(c=c.replace(/\\\\(?=.+)/g,'"+CHAR(92)+"')).replace(/\\\"(?=.+)/g,'"+CHAR(34)+"'),!isNaN(r)&&r<0&&(c="("+c+")"),s.push(c)}else s.push('"'+a+'"')}else s.push(a)});var n;try{n=FX.FormulaCalcParser.parse(s.join(""))}catch(e){n=""}return n},getWidgetByName:function(e,t){var i=this.options;if(FX.Utils.isEmpty(e)||!i.resultWidgets)return null;var a;if(this._isSubformWidget(e)){var s=i.resultWidgets[[e.split(".")[0]]];s&&(a=s.getWidgetByName(e.split(".")[1],t))}else a=i.resultWidgets[e];return a},doSubmit:function(){var t=this,i=this.options;if(this.rely.checkAsyncState()){if(!this.ajaxLoading){this.ajaxLoading=!0;var a=FX.Utils.createMask(this.element,{hasLoader:!0,isLight:!0}),s=e.extend({values:this.getValue()},i.submitData);e.extend(s,{appId:i.appId,entryId:i.entryId,formId:i.entryId,checkRepeat:this.checkRepeat,hasResult:!0}),FX.Utils.isNull(i.authGroupId)||e.extend(s,{authGroupId:i.authGroupId}),i.extParam&&e.extend(s.values,{ext:{data:i.extParam,widgetType:"text"}}),FX.Utils.dataAjax({url:i.submitUrl,data:s},function(e,a){FX.STATIC.DATAID=null,!1===FX.Utils.applyFunc(t,i.onSuccess,[e,s.flowAction,t.needPrint],!1)&&FX.Msg.toast({type:"success",msg:"提交成功"}),t.needCache=!1,e.flowFailureCode&&t._showFlowFailHint(e.flowFailureCode)},function(e,i){var a=e.responseJSON||{},s=a.msg||"提交失败";4002===a.code?(FX.Msg.toast({type:"warning",msg:s}),a.meta&&FX.Utils.forEach(a.meta.repeatFields,function(e,i){var a=t.getWidgetByName(i);a&&t.setErrorState(a,"此项为重复值")})):FX.Msg.toast({type:"error",msg:s})},function(){a.remove(),t.ajaxLoading=!1})}}else FX.Msg.alert({type:"warning",title:"表单数据计算中，请勿离开页面",msg:"请等待计算完成后提交，否则会丢失数据。如果此提示反复出现，请联系管理员调整表单设计",text4Cancel:"我知道了",text4Ok:null})},doVerify:function(){var e=this,t=this.options,i={result:!0};if(t.ignoreValidate)return i;var a=t.resultWidgets;for(var s in a){var n=a[s];this._isWidgetVisible(n)&&(this.clearErrorState(n),n.checkValidate()||(i.result=!1,this.setErrorState(n)))}return i.result&&FX.Utils.forEach(t.validators,function(t,a){if(!e._calFormula(a.formula))return i.result=!1,i.errMsg=a.remind,!1}),i},_checkFlowComment:function(e){var t=this.options;if(this.flowComment||this.flowSignature)if("save"===t.submitData.flowAction){var i=this.flowComment&&this.flowComment.getValue();i?FX.Msg.alert({title:"审批意见不会被保存，是否复制审批意见后继续？",msg:"系统不会保存你已填写的审批意见。点击「复制并继续」，我们会自动复制你已填写的审批意见。",type:"warning",text4Ok:"复制并继续",onOk:function(){FX.Utils.copyToClipboard(i,function(){FX.Msg.toast({type:"success",msg:"已复制审批意见"})}),e&&e()}}):e&&e()}else{var a=!this.flowComment||this.flowComment.checkValidate(),s=!this.flowSignature||this.flowSignature.checkValidate();if(a&&s)e&&e();else{var n=a?"审批意见（手写签名）为必填项":"审批意见（文本意见）为必填项";a||s||(n="审批意见为必填项"),FX.Msg.toast({type:"warning",msg:n})}}else e&&e()},setErrorState:function(e,t){e.setErrorState(t)},clearErrorState:function(e){e.clearErrorState()},getFormDataKey:function(){var e=this.options;return FX.Store.getKey("formData",{appId:e.appId,entryId:e.entryId})},removeFormData:function(){this.options.cacheEnable&&FX.Store.remove(this.getFormDataKey())},loadFormData:function(){var e=this.options;if(e.cacheEnable){this._bindCacheEvent();var t=FX.Store.get(this.getFormDataKey());t&&t.time>=e.updateTime&&t.data&&(FX.Utils.forEach(e.resultWidgets,function(e,i){var a=t.data[e];!i||FX.LimitFields.noCache.indexOf(i.getWidgetType())>-1||(i.setCacheValue(a),i.effectItemLinkWidgets&&i.effectItemLinkWidgets())}),this._setLinkQuery(),this.needCache=!0),this.removeFormData()}},saveFormData:function(){var t=this.options;if(t.cacheEnable&&e("body").find(this.element).length&&this.needCache&&this.rely.checkAsyncState()){var i={},a=t.resultWidgets;FX.Utils.forEach(a,function(e,t){if(t&&FX.Utils.isValueWidget(t.getWidgetType())&&!(FX.LimitFields.noCache.indexOf(t.getWidgetType())>-1)){var a=t.getCacheValue();FX.Utils.isObjectEmpty(a)||(i[e]=a)}}),FX.Utils.isObjectEmpty(i)||(FX.STATIC.user&&FX.Store.forEach(function(e){/formData[0-9a-f]{72}/.test(e)&&!new RegExp(FX.STATIC.user._id).test(e)&&FX.Store.remove(e)}),FX.Store.set(this.getFormDataKey(),{data:i,time:t.updateTime},1))}},_bindCacheEvent:function(){var t=this;this.options.cacheEnable&&(FX.FORMCACHE=this,e(window).one("unload",function(){t.saveFormData()}))},doCancel:function(){var e=this.options;FX.STATIC.DATAID=null,this.saveFormData(),FX.Utils.applyFunc(this,e.onAfterCancel,[],!1)},doClose:function(){var e=this.options;FX.STATIC.DATAID=null,FX.Utils.applyFunc(this,e.onAfterClose,[],!1)},doVerifyAndSubmit:function(){var e=this,t=this.doVerify();t.result?this._checkFlowComment(function(){e.doSubmit()}):FX.Msg.toast({type:"warning",msg:t.errMsg?t.errMsg:"存在不符合规范的值"})},getValue:function(){var e=this,t={},i=this.options.resultWidgets;this.checkRepeat=[];for(var a in i){var s=i[a];if(s&&FX.Utils.isValueWidget(s.getWidgetType())){var n=s.getValue();if(s.isNoRepeat()&&!FX.Utils.isEmpty(n)){var o={};o[s.getWidgetName()]=n,e.checkRepeat.push(o)}t[a]={data:n,visible:e._isWidgetVisible(s)}}}return t},doResize:function(e){FX.Form.superclass.doResize.apply(this,arguments);var t=this.options;t.height&&(this.element.addClass("form-modal"),t.hasHeader&&this.$wrapper.css({top:this.$header.outerHeight()}),t.hasFooter&&this.$wrapper.css({bottom:this.$footer.outerHeight()}))},reload:function(t){this.options=e.extend(this.options,t),e(".widget-wrapper",this.element).remove(),e(".footer",this.element).remove(),this._initMain(),this.doResize()},_showFlowFailHint:function(e){if(!FX.Utils.isExternalLink()){var t="",i="",a=FX.CONST.FLOW_FAIL_CODE;e===a.FORWARD_CHARGER?(t="提交失败，找不到下个节点负责人",i="流程已暂存至「我的待办」中，可联系管理员检查节点负责人后重新提交。"):e===a.FORWARD_COND?(t="提交失败，不符合流转条件",i="流程已暂存至「我的待办」中，可联系管理员检查流转条件后重新提交。"):e===a.BACK&&(t="回退失败，找不到回退后的负责人",i="流程已暂存至「我的待办」中，请联系管理员检查节点负责人后重新提交。"),t&&i&&FX.Msg.alert({title:t,msg:i,text4Ok:"我知道了",text4Cancel:null})}}}),e.shortcut("form",FX.Form)}(jQuery),function(e){FX.DataMenu=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.DataMenu.superclass._defaultConfig.apply(),{baseCls:"fui-form-data-menu",data:null,dataCount:10,dataIndex:1,entryId:null,isPublicData:!1,publicDataUrlPrefix:"",hasShareBtn:!1,hasShowFieldsBtn:!1,allFields:null,showFields:null,hasDeleteBtn:!1,hasEditBtn:!1,hasPrintBtn:!1,hasRecoverBtn:!1,hasSwitchBtn:!1,hasTransferBtn:!1,hasActivateBtn:!1,hasCloseBtn:!1,onDeleteData:null,onEditData:null,onPrint:null,onRecoverData:null,onSwitchData:null,onShowFieldsChange:null})},_init:function(){FX.DataMenu.superclass._init.apply(this,arguments),this._createEditPane()},_createEditPane:function(){var t=this,i=this.options;if(this.$editPane=e('<div class="edit-pane"/>').appendTo(this.element),i.hasActivateBtn&&e('<a class="activate-btn"><i class="icon-flow-comment"></i><span>激活流程</span></a>').click(function(){FX.Utils.applyFunc(t,i.onActivate,[],!1)}).appendTo(this.$editPane),i.hasCloseBtn&&e('<a class="close-btn"><i class="icon-flow-end style-red"></i><span>结束流程</span></a>').click(function(){FX.Utils.applyFunc(t,i.onClose,[],!1)}).appendTo(this.$editPane),i.hasTransferBtn&&e('<a class="transfer-btn"><i class="icon-member-normal"></i><span>调整负责人</span></a>').click(function(){FX.Utils.applyFunc(t,i.onTransfer,[],!1)}).appendTo(this.$editPane),(i.hasActivateBtn||i.hasCloseBtn||i.hasTransferBtn)&&e('<div class="split-line"/>').appendTo(this.$editPane),i.hasDeleteBtn&&e('<a class="delete-btn"/>').append(e('<i class="icon-trasho">')).append(e("<span/>").text("删除")).click(function(){FX.Utils.applyFunc(t,i.onDeleteData,[],!1)}).appendTo(this.$editPane),i.hasEditBtn&&e('<a class="edit-btn"/>').append(e('<i class="icon-flow-edit">')).append(e("<span/>").text("编辑")).click(function(){FX.Utils.applyFunc(t,i.onEditData,[],!1)}).appendTo(this.$editPane),i.hasShareBtn){this.qrcodeLink=FX.CONFIG.HOST.SITE_SHORT_HOST+FX.Utils.getApi(FX.API.entry.qr_link,FX.STATIC.APPID,i.entryId,i.data._id);var a=e('<a class="share-btn"/>').append(e('<i class="icon-share"/>')).append(e("<span/>").text("分享")).click(function(){i.isPublicData?t._showSharePane(a):FX.UI.shareUrl({url:t.qrcodeLink,title:"团队成员",subTitle:"访问数据链接需要登录系统并授权"})}).appendTo(this.$editPane)}i.hasPrintBtn&&e('<a class="print-btn"><i class="icon-print"></i><span>打印</span></a>').click(function(){FX.Utils.applyFunc(t,i.onPrint,[],!1)}).appendTo(this.$editPane),i.hasRecoverBtn&&(e('<a class="style-red"><i class="icon-trasho style-red"></i><span>彻底删除</span></a>').click(function(){FX.Utils.applyFunc(t,i.onRecoverData,[i.data._id,!1],!1)}).appendTo(this.$editPane),e('<a ><i class="icon-recover"></i><span>恢复</span></a>').click(function(){FX.Utils.applyFunc(t,i.onRecoverData,[i.data._id,!0],!1)}).appendTo(this.$editPane)),i.hasShowFieldsBtn&&(this.fieldItems=this._getFieldItems(),e('<a class="show-fields-btn"/>').append('<i class="icon-page-view"/>').append(e("<span/>").text("显示字段")).click(function(i){t._showFieldsConfigPane(e(i.currentTarget))}).toggleClass("active",!this._isAllFieldsSelected()).appendTo(this.$editPane)),i.hasSwitchBtn&&this._initSwitchBtn(this.element)},_getFieldItems:function(){var e=this.options,t=FX.LimitFields.list.concat(["flowState","chargers"]),i=FX.Utils.getShowFieldItems(e.showFields,e.allFields,t);return FX.Utils.addClsToSystemField(i,"field-system")},_showFieldsConfigPane:function(e){var t=this.options,i=this;this.fieldCheck||(this.fieldCheck=new FX.ComboCheckBox({renderEl:e,items:this.fieldItems,width:null,height:null,onElementCreate:function(){return!0},onAfterItemCreate:function(e,t,i){i.addClass(e.cls)},onStopEdit:function(){var a=this.getValue();a.length<i.fieldItems.length?e.addClass("active"):e.removeClass("active"),FX.Utils.applyFunc(i,t.onShowFieldsChange,[a],!1)}}),this.fieldCheck._onTriggerClick())},_isAllFieldsSelected:function(){var e=!0;return FX.Utils.forEach(this.fieldItems,function(t,i){if(!i.selected)return e=!1,!1}),e},_showSharePane:function(t){var i=this.options,a=this,s=i.publicDataUrlPrefix+"/d/"+i.data._id,n=e('<div class="share-select-pane"><div class="share-item qrcode"><div class="left"><i class="icon-widget-user"/></div><div class="right"><div class="title">团队成员</div><div class="desc">成员登录系统访问数据</div></div></div><div class="share-item public"><div class="left"><i class="icon-link"/></div><div class="right"><div class="title">公开链接</div><div class="desc">通过公开链接访问数据</div></div></div></div>').click(function(t){e(t.target).closest(".share-item").hasClass("qrcode")?FX.UI.shareUrl({url:a.qrcodeLink,title:"团队成员",subTitle:"访问数据链接需要登录系统并授权"}):FX.UI.shareUrl({url:s,title:"公开链接",subTitle:"通过公开链接，无需登录即可访问数据"}),o&&o.close()}),o=FX.Msg.bubble({anchor:t,contentHTML:n,minWidth:250,hasTriangle:!1,hAdjust:100,contentPadding:0,text4Cancel:null,text4Ok:null})},_initSwitchBtn:function(t){var i=this,a=this.options;this.dataIndex=a.dataIndex;var s=e('<div class="switch-pane"><div class="switch-btn prev"><i class="icon-angleleft"/></div><div class="switch-num">'+a.dataIndex+"/"+a.dataCount+'</div><div class="switch-btn next"><i class="icon-angleright"/></div></div>').appendTo(t);a.dataIndex<=1&&e(".prev",s).addClass("disabled"),a.dataIndex>=a.dataCount&&e(".next",s).addClass("disabled"),e(".switch-btn",s).hover(function(t){var i=e(t.target).closest(".switch-btn");if(!i.hasClass("disabled")){var a="查看下一条数据，快捷键「→」";i.hasClass("prev")&&(a="查看上一条数据，快捷键「←」"),FX.UI.showPopover({position:"bottomLeft",anchor:i,content:e("<span/>").text(a),type:"dark",animation:!1})}},function(){FX.UI.closePopover()}),s.click(function(t){var a=e(t.target).closest(".switch-btn");if(a.length){var s=a.hasClass("prev")?i.dataIndex-1:i.dataIndex+1;i._switchData(s)}}),e(document).one("keydown.ctrl_left.switch-shortcuts keydown.meta_left.switch-shortcuts",function(){i._switchData(i.dataIndex-1,!0)}),e(document).one("keydown.ctrl_right.switch-shortcuts keydown.meta_right.switch-shortcuts",function(){i._switchData(i.dataIndex+1,!0)}),e(document).one("keydown.left.switch-shortcuts",function(){i._switchData(i.dataIndex-1,!1)}),e(document).one("keydown.right.switch-shortcuts",function(){i._switchData(i.dataIndex+1,!1)})},destroy:function(){FX.DataMenu.superclass.destroy.apply(this,arguments),e(document).unbind(".switch-shortcuts")},_showSwitchTip:function(t,i){var a=this.options,s=FX.Utils.createMask(),n=i?"编辑":"查看",o="";return t<=0?o="已经是本页第一条数据":t>a.dataCount&&(o="已经是本页最后一条数据"),FX.Utils.isEmpty(o)?this.dataIndex<t?e('<div class="switch-tip"><span>'+n+'下一条</span><i class="next icon-arrow-right"/></div>').appendTo(s):e('<div class="switch-tip"><i class="prev icon-arrow-left"/><span>'+n+"上一条</span></div>").appendTo(s):e('<div class="switch-tip widen"><span>'+o+"</span></div>").appendTo(s),s},_switchData:function(e,t){var i=this,a=this.options;if(!t||a.hasEditBtn){FX.UI.closePopover();var s=this._showSwitchTip(e,t);FX.Utils.applyFunc(i,a.onSwitchData,[e,t,s],!1),e<1||e>a.dataCount||(this.dataIndex=e)}}}),e.shortcut("datamenu",FX.DataMenu)}(jQuery),function(e){FX.FormData=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.FormData.superclass._defaultConfig.apply(),{baseCls:"fui-form-data",authGroupId:null,comments:null,data:null,entryId:null,flow:null,hasCustomPrint:!1,header:null,ignoreVisible:!0,layout:null,optAuth:null,title:""})},_init:function(){FX.FormData.superclass._init.apply(this,arguments);var e=this.options;this.showData=this._getShowData(e.header,e.data),this._createDataWrapper()},_getShowData:function(e,t){var i=this,a={};return FX.Utils.forEach(e,function(e,s){if(s&&s.widget&&(s=FX.Utils.getFieldAttr(s)),s){var n=s.tag||s.name;switch(s.type){case"user":case"usergroup":case"dept":case"deptgroup":a[n]=i._getMemberShowValue(t[n]);break;case"linkdata":a[n]=FX.Utils.isObjectEmpty(t[n])?"":t[n];break;case"flowState":var o="";switch(t[n]){case FX.CONST.WORKFLOW.FLOWSTATE.INPROCESS:o="进行中";break;case FX.CONST.WORKFLOW.FLOWSTATE.COMPLETE:o="流转完成";break;case FX.CONST.WORKFLOW.FLOWSTATE.CLOSE:o="手动结束"}a[n]=o;break;case"subform":var l=[];FX.Utils.forEach(t[n],function(e,t){l.push(i._getShowData(s.items,t))}),a[n]=l;break;case"signature":a[n]=t[n];break;default:a[n]=FX.Utils.formatData(s,t[n])}}}),a},_getMemberShowValue:function(e){if(FX.Utils.isNull(e))return"";var t;if(FX.Utils.isArray(e)){var i=[];FX.Utils.forEach(e,function(e,t){i.push(t.name||t)}),t=i}else t=e.name||e;return t},_createDataWrapper:function(){var t=this.options,i=this,a=e("<ul/>").appendTo(e('<div class="data-wrapper"/>').appendTo(this.element));this.concatMap={},this.header=[],FX.Utils.forEach(t.header,function(s,n){if(n.widget&&(n=FX.Utils.getFieldAttr(n)),n&&"flowVer"!==n.name){var o=n.tag||n.name,l=i.showData[o],r=n.text,d=null;if(t.ignoreVisible?d=n:i._dealWidgetVisible(n,l)&&(d=n,"subform"===n.type&&(d=e.extend({},n,{items:[]}),FX.Utils.forEach(n.items,function(e,t){!1!==t.visible&&d.items.push(t)}))),!FX.Utils.isObjectEmpty(d)){i.header.push(d);var c=e('<li class="widget-data-view"/>').appendTo(a);i._createItem(d,r,l,c,!0)}}})},_dealWidgetVisible:function(e,t){var i=this,a=this.options;a.optAuth&&(e.visible=a.optAuth[e.name]&&a.optAuth[e.name].visible||!1,"subform"===e.type&&FX.Utils.forEach(e.items,function(t,i){var s=[e.name,i.name].join(".");i.visible=a.optAuth[s]&&a.optAuth[s].visible||!1}));var s={};return FX.Utils.forEach(e.items,function(e,a){a.widgetsMap&&(s[a.value]=!0,a.value===t||a.isOther&&t&&!s[t]?FX.Utils.forEach(a.widgetsMap,function(e,t){i.concatMap[t]=!0}):FX.Utils.forEach(a.widgetsMap,function(e,t){i.concatMap[t]||(i.concatMap[t]=!1)}))}),!!e.visible&&!1!==this.concatMap[e.name]},_getPrintData:function(){var t=this,i=this.options,a={};FX.Utils.forEach(i.header,function(e,t){t.tag&&t.name&&(a[t.tag]=t.name)});var s={};FX.Utils.forEach(this.header,function(e,i){i.widget&&(i=FX.Utils.getFieldAttr(i)),i&&t._dealPrintField(i,s,a)});var n={};FX.Utils.forEach(this.showData,function(i,o){a[i]&&(i=a[i]),e.extend(n,t._dealPrintData(i,o,s))});var o=[];return FX.Utils.forEach(i.comments,function(e,t){if(!FX.Utils.isEmpty(t.comment)||!FX.Utils.isObjectEmpty(t.signature)){var i=FX.Utils.resolveUsername(t.operator),a=t.flowName+" "+i+" ("+FX.Utils.date2Str(new Date(t.createTime),"yyyy-MM-dd HH:mm")+")："+(t.comment||"");o.push({comment:a,signature:t.signature})}}),e.extend(n,{flow_comment:o,_id:i.data._id}),n},_dealPrintField:function(e,t,i){var a=this,s=e.name;switch(e.tag&&i&&(s=i[e.tag]),t[s]=e,e.type){case"subform":FX.Utils.forEach(e.items,function(e,i){a._dealPrintField(i,t)});break;case"linkdata":FX.Utils.forEach(e.linkFields,function(e,i){a._dealPrintField(i,t)})}},_dealPrintData:function(e,t,i){var a=this,s={};if(!i[e])return s;switch(i[e].type){case"subform":var n={};FX.Utils.forEach(t,function(t,s){FX.Utils.forEach(s,function(t,s){i[t]&&FX.Utils.forEach(a._dealPrintData(t,s,i),function(t,i){var a=[e,t].join(".");n[a]?n[a].push(i):n[a]=[i]})})}),FX.Utils.forEach(n,function(e,t){s[e]=t});break;case"linkdata":var o=i[e].linkFields;FX.Utils.forEach(o,function(n,o){var l=o.name;i[l]&&FX.Utils.forEach(a._dealPrintData(l,t[l],i),function(t,i){s[[e,t].join("->")]=i})});break;case"location":t&&(s[e]=t.address+" "+t.lngLat);break;default:s[e]=t}return s},_doPrint:function(t){var i=this,a=this.options;if(t&&(a.comments=t),!this.isPrinting)if(a.hasCustomPrint){var s=FX.Utils.isSupportPdf();this.isPrinting=!0;var n=setTimeout(function(){i.closeMsg=FX.Msg.toast({msg:"正在生成打印文件，请等待",type:"loading"})},500);FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.print),data:{data:this._getPrintData(),formId:a.entryId,isAttachment:!s,groupId:a.authGroupId,flowId:a.flow&&a.flow.flowId,flowVer:a.flow&&a.flow.version,dataId:a.data._id}},function(t){"system"===t.printType?i._doSystemPrint():"template"===t.printType&&(s?new FX.Slider({title:"PDF预览",content:e('<embed src="'+t.url+'" width="100%" height="100%" style="position: absolute" type="application/pdf"/>')}).show():FX.Utils.redirectTo(t.url))},null,function(){i.isPrinting=!1,clearTimeout(n),i.closeMsg&&(i.closeMsg(),i.closeMsg=null)})}else this._doSystemPrint()},_doSystemPrint:function(){var e=this.options,t=new FX.FormPrint({title:e.title,header:this.header,comments:e.comments,layout:e.layout,data:this.showData});FX.Utils.doPrint(t.element)},_getLinkData:function(e,t,i){if(e.linkForm&&t&&t.id){var a={formId:t.entryId||e.linkForm,linkId:t.id},s=t.appId||e.refAppId||e.appId;s&&s!==FX.STATIC.APPID&&(a.refAppId=s),FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.read_link),data:a},function(e){i&&i(e.data)},function(){})}},_dealWidgetData:function(t,i,a,s){var n=e('<div class="widget-data"/>').appendTo(a);switch(t.type){case"image":case"upload":s?this._createFileThumbList(i,n):new FX.FileUpload({mode:"preview",renderEl:n,files:i,enable:!1});break;case"signature":this._createSignatureItem(i,n);break;case"subform":var o=[];FX.Utils.forEach(t.items,function(e,t){FX.Utils.isValueWidget(t.type)&&o.push(t)}),this._createSubformItem(o,i,n);break;case"textarea":i&&n.append(e("<pre/>").append(FX.Utils.replaceURL(i)));break;case"text":if(i=FX.Utils.isNull(i)?"":i,t.regex&&new RegExp(t.regex).test(i)){var l=FX.CONST.TEXT_TYPE_REGEXP;if(t.regex===l.email){e("<a/>").attr("href","mailto:"+i).text(i).appendTo(n);break}}n.append(FX.Utils.replaceURL(i));break;case"chargers":var r={},d={};FX.Utils.forEach(i,function(e,t){t.flowName&&(r[t.flowName]||(r[t.flowName]=!0),d[t.userNickname]||(d[t.userNickname]=!0))});var c=[];"node"===t.show?FX.Utils.forEach(r,function(e){c.push(e)}):FX.Utils.forEach(d,function(e){c.push(e)}),n.text(c);break;case"location":i.address&&n.text(i.address),i.lngLat&&e('<div class="widget-info">'+i.lngLat+"</div>").appendTo(a);break;default:i=FX.Utils.isNull(i)?"":i,n.text(i)}},_dealLinkField:function(t){switch(t.type){case"subform":FX.Utils.forEach(t.items,function(t,i){e.extend(i,FX.Utils.getFieldAttr(i))})}},_isItemValid:function(e){switch(e.type){case"formula":case"flowState":case"chargers":return!0;default:return FX.Utils.isValueWidget(e.type)||e.isJoined||/_join_/.test(e.name)}},_createItem:function(t,i,a,s,n){var o=this;if(this._isItemValid(t)){if(a&&"linkdata"===t.type){var l=e("<ul/>").appendTo(s);return this._getLinkData(t,a,function(i){e.extend(a,o._getShowData(t.linkFields,i)),FX.Utils.forEach(t.linkFields,function(t,i){var s=e("<li/>").appendTo(l);o._dealLinkField(i),o._createItem(i,i.text,a[i.name],s,!0)})}),s}if("chargers"===t.type&&!t.show){var r=e("<ul/>").appendTo(s);return o._createItem(e.extend({show:"node"},t),"当前节点",a,e("<li/>").appendTo(r),!0),o._createItem(e.extend({show:"user"},t),"当前负责人",a,e("<li/>").appendTo(r),!0),s}return i&&e('<div class="widget-label"/>').appendTo(s).append(e('<span class="label-title"/>').text(i)),FX.Utils.isNull(a)&&!n||this._dealWidgetData(t,a,s),s}},_createSubformItem:function(t,i,a){var s=this;a.addClass("subform-widget-data");var n=e('<table class="widget-subform"/>').appendTo(a),o=e("<tr/>").appendTo(e('<thead class="widget-label"/>').appendTo(n));FX.Utils.forEach(t,function(t,i){if("linkdata"===i.type)FX.Utils.forEach(i.linkFields,function(t,i){var a=e('<td class="widget-item"/>').css({"min-width":s._getSubformWidgetWidth(i.type)}).appendTo(o);s._createItem(i,i.text,null,a)});else{var a=e('<td class="widget-item"/>').css({"min-width":s._getSubformWidgetWidth(i.type)}).appendTo(o);s._createItem(i,i.text,null,a)}});var l=e('<tbody class="widget-data"/>').appendTo(n);FX.Utils.forEach(i,function(i,a){var n=e("<tr/>").appendTo(l);FX.Utils.forEach(t,function(t,i){if("linkdata"===i.type){var o={};FX.Utils.forEach(i.linkFields,function(t,i){o[i.name]=e('<td class="widget-item"/>').appendTo(n)});var l=a[i.name];s._getLinkData(i,a[i.name],function(t){var a=s._getShowData(i.linkFields,t);e.extend(l,a),FX.Utils.forEach(i.linkFields,function(e,t){s._dealWidgetData(t,l[t.name],o[t.name],!0)})})}else{var r=e('<td class="widget-item"/>').appendTo(n);s._dealWidgetData(i,a[i.name],r,!0)}})})},_getSubformWidgetWidth:function(e){var t=146;switch(e){case"user":case"usergroup":case"dept":case"deptgroup":case"radiogroup":case"checkboxgroup":t=180;break;case"textarea":case"address":case"location":t=240}return t},_createSignatureItem:function(t,i){if(!FX.Utils.isObjectEmpty(t)){var a=e('<div class="signature-item"/>').on("click",function(i){e(i.target).hasClass("signature-image")&&new FX.FilePreview({files:[t]})}).appendTo(i),s=function(t){e('<img class="signature-image"/>').attr("src",t).appendTo(a)};if(t.thumbPcUrl)s(t.thumbPcUrl);else{var n=e.extend({thumb:{mode:2,width:300,height:180}},t);FX.Utils.getFileDownloadURL(n,function(e){s(e)})}}},_createFileThumbList:function(t,i){var a=e('<div class="thumb-list"/>').click(function(i){var a=e(i.target).closest(".subform-thumb");new FX.FilePreview({files:t,currentItem:a.data("index"),autoClose:!1})}).appendTo(i);FX.Utils.forEach(t,function(t,i){var s=e('<div class="subform-thumb"/>').data("index",t),n=i.name?i.name.split(".").pop():"";if(FX.Utils.isImageExt(n)){var o=e("<img/>").hide(),l=e.extend({thumb:{mode:1,width:26,height:26}},i);FX.Utils.getFileDownloadURL(l,function(e){s.append(o.attr("src",e).show()).appendTo(a)})}else{var r=FX.Utils.createFileThumb(n,"tiny");s.append(r).appendTo(a)}})}}),e.shortcut("formdata",FX.FormData)}(jQuery),function(e){FX.MessageData=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.MessageData.superclass._defaultConfig.apply(),{baseCls:"fx_message_data",message:{}})},_init:function(){FX.MessageData.superclass._init.apply(this,arguments),this.$wrapper=e('<div class="widget-wrapper">').appendTo(this.element),this._createHeader(),this._createData()},_createHeader:function(){var t=this.options.message.formName;e('<div class="preview-title-pane"/>').append(e('<div class="preview-title"/>').text(t)).prependTo(this.element)},_createData:function(){var t=this.options,i=this,a=t.message.form,s=t.message.data,n=a&&a.items,o=e("<ul/>").appendTo(e('<div class="data-wrapper"/>').appendTo(this.$wrapper));FX.Utils.forEach(n,function(t,a){if(a.widget){var n=e('<li class="widget-data-view"/>').appendTo(o);i._createItem(a.widget,a.label,s[a.widget.widgetName],n,!0)}})},_createItem:function(t,i,a,s,n){i&&e('<div class="widget-label"/>').appendTo(s).append(e('<span class="label-title"/>').text(i)),(a||n)&&this._dealWidgetData(t,a,s)},_dealWidgetData:function(t,i,a){var s=FX.Utils.formatData(t,i),n=e('<div class="widget-data"/>').appendTo(a);switch(t.type){case"location":var o=FX.Utils.address2Str(i,"","pcda");n.text(o),a.append('<div class="widget-info">'+FX.Utils.getLnglatText(i)+"</div>");break;case"image":case"upload":new FX.FileUpload({mode:"preview",renderEl:n,files:i,enable:!1});break;case"signature":this._createSignatureItem(i,n);break;case"subform":var l=[];FX.Utils.forEach(t.items,function(e,t){l.push({label:t.label,name:t.widget.widgetName,type:t.widget.type})}),this._createSubformItem(l,s,n);break;case"combocheck":case"checkboxgroup":var r=e("<ul/>").appendTo(n);FX.Utils.forEach(s,function(t,i){r.append(e("<li/>").text(i))});break;case"textarea":s&&n.append(e("<pre/>").append(FX.Utils.replaceURL(s)));break;case"text":if(s=FX.Utils.isNull(s)?"":s,t.regex&&new RegExp(t.regex).test(s)){var d=FX.CONST.TEXT_TYPE_REGEXP;if(t.regex===d.email){e("<a/>").attr("href","mailto:"+i).text(i).appendTo(n);break}}n.append(FX.Utils.replaceURL(s));break;case"user":case"dept":n.text(s&&s.name);break;case"usergroup":case"deptgroup":var c=[];FX.Utils.forEach(s,function(e,t){t&&c.push(t.name)}),n.text(c);break;case"linkdata":n.text(s&&s.key);break;default:s=FX.Utils.isNull(s)?"":s,n.text(s)}},_createSignatureItem:function(t,i){if(!FX.Utils.isObjectEmpty(t)){var a=e('<div class="signature-item"/>').on("click",function(i){e(i.target).hasClass("signature-image")&&new FX.FilePreview({files:[t]})}).appendTo(i),s=function(t){e('<img class="signature-image"/>').attr("src",t).appendTo(a)};if(t.thumbPcUrl)s(t.thumbPcUrl);else{var n=e.extend({thumb:{mode:2,width:300,height:180}},t);FX.Utils.getFileDownloadURL(n,function(e){s(e)})}}},_createSubformItem:function(t,i,a){var s=this,n=e('<table class="widget-subform"/>').appendTo(a),o=e("<tr/>").appendTo(e('<thead class="widget-label"/>').appendTo(n));FX.Utils.forEach(t,function(t,i){s._createItem(i,i.label,null,e('<td class="widget-item"/>').appendTo(o))});var l=e('<tbody class="widget-data"/>').appendTo(n);FX.Utils.forEach(i,function(i,a){var n=e("<tr/>").appendTo(l);FX.Utils.forEach(t,function(t,i){s._dealWidgetData(i,a[i.name],e('<td class="widget-item"/>').appendTo(n))})})}})}(jQuery),function(e){FX.Report=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Report.superclass._defaultConfig.apply(),{baseCls:"fui-report",appId:null,entryId:null,supportExport:!0,hasLazyLoad:!1,scrollView:null,margin:30})},_init:function(){FX.Report.superclass._init.apply(this,arguments);var t=this.options,i=this;FX.STATIC.ENTRYID=t.entryId,t.resultWidgets={},this.widgetsMap={},this.lastBottomHeight=0;var a=this.element.width()-t.margin;if(this.$content=e('<div class="content"/>').width(a).appendTo(this.element),t.parameter){var s=e('<div class="parameter-content"/>').appendTo(this.$content);this.parameter=new FX.Parameter(e.extend({renderEl:e("<div/>").appendTo(s),onStopEdit:function(e){i._findWidgetByForm(e,function(e){e.reload()})}},t.parameter))}this.$widgetWrapper=e('<div class="report-content"/>').appendTo(this.$content);var n=1;t.layout&&t.layout.width&&(n=a/t.layout.width),FX.Utils.forEach(t.items,function(a,s){var o=e.extend({},s,i._getSize(s,n));o.renderEl=e("<div/>").css({position:"absolute",left:o.x,top:o.y}).appendTo(i.$widgetWrapper),i.lastBottomHeight=Math.max(i.lastBottomHeight,o.height+o.y),o.onAfterHeadCreate=function(e){this.createHeadTools()},o.onItemClick=function(e){FX.Utils.forEach(this.options.linkWidgets,function(t,a){var s=i.getWidgetByName(a);s&&s.reload(e)})},o.onDataFilter=function(){return i.parameter?i.parameter.getValue():null},t.supportExport||(o.exportable=!1),o.allowDataLoad=!t.hasLazyLoad;var l=FX.createWidget(o);t.resultWidgets[o.widgetName]=l,i.widgetsMap[a]=l}),this._bindLazyLoadEvt()},_getSize:function(e,t){var i=e.y/e.x,a=e.height/e.width,s=e.width,n=e.x;return{x:Math.ceil(n*t),y:Math.ceil(n*t*i),width:Math.ceil(s*t),height:Math.ceil(s*t*a)}},_bindLazyLoadEvt:function(){var t=this.options,i=this;if(t.hasLazyLoad){this.doLazyLoad();var a=this.element;t.scrollView&&(a=e(t.scrollView)),a.unbind("scroll.lazy"),a.bind("scroll.lazy",function(){i.doLazyLoad()}),e(window).unbind("resize.report_lazy_load"),e(window).bind("resize.report_lazy_load",function(){i.lazyTimer&&clearTimeout(i.lazyTimer),i.lazyTimer=setTimeout(function(){i&&i.element.closest("body").length>0?i.doLazyLoad():e(window).unbind("resize.report_lazy_load")},500)})}},doLazyLoad:function(){var t=this.options;t.hasLazyLoad&&FX.Utils.forEach(t.resultWidgets,function(t,i){i&&(i.isAllowDataLoad()||e(i.element).offset().top<=document.body.clientHeight&&(i.setAllowDataLoad(!0),i.reload()))})},_findWidgetByForm:function(e,t){if(!FX.Utils.isEmpty(e))for(var i in this.options.resultWidgets){var a=this.options.resultWidgets[i];a.options.forms.indexOf(e)>-1&&t(a)}},updateComponentsPos:function(){var e=this,t=this.options,i=this.element.width()-t.margin;this.$content.width(i);var a=1;t.layout&&t.layout.width&&(a=i/t.layout.width),FX.Utils.forEach(t.items,function(t,i){var s=e._getSize(i,a);e.widgetsMap[t].element.css({position:"absolute",left:s.x,top:s.y}),e.widgetsMap[t].doResize({width:s.width,height:s.height}),e.lastBottomHeight=Math.max(e.lastBottomHeight,s.height+s.y)})},doResize:function(e,t){FX.Report.superclass.doResize.apply(this,arguments);var i=this.options;t&&this.updateComponentsPos(),FX.Utils.isEmpty(i.height)&&this.$widgetWrapper&&this.$widgetWrapper.css({height:this.lastBottomHeight+10})}}),e.shortcut("report",FX.Report)}(jQuery),function(e){FX.DateLimit=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.DateLimit.superclass._defaultConfig.apply(),{baseCls:"fui_date_limit",format:"yyyy-MM-dd",wrap:!1,width4date:150})},_init:function(){FX.DateLimit.superclass._init.apply(this,arguments);var t=this.options,i=this,a="limit-item";t.wrap&&(a="limit-wrap"),this.startDate=new FX.DateTime({renderEl:e('<div class="'+a+'"/>').appendTo(this.element),waterMark:t.wrap?"起始日期":"",format:t.format,defaultPickDate:(new Date).setHours(0,0,0,0),onStopEdit:function(){i._setSingleValue("start",this.getValue()),FX.Utils.applyFunc(i,t.onStopEdit,[],!1)},value:null,width:t.width4date}),t.wrap||e('<div class="limit-item limit-to"/>').text("~").appendTo(this.element),this.endDate=new FX.DateTime({waterMark:t.wrap?"结束日期":"",renderEl:e('<div class="'+a+'"/>').appendTo(this.element),format:t.format,defaultPickDate:(new Date).setHours(0,0,0,0),onStopEdit:function(){i._setSingleValue("end",this.getValue()),FX.Utils.applyFunc(i,t.onStopEdit,[],!1)},value:null,width:t.width4date})},_setSingleValue:function(e,t){var i=this.getValue();"start"===e?(this.endDate.options.startDate=FX.Utils.isNull(t)?null:t,this.endDate.rebuild(),this.endDate.setValue(i.max)):(this.startDate.options.endDate=FX.Utils.isNull(t)?null:t,this.startDate.rebuild(),this.startDate.setValue(i.min))},setValue:function(e){e?(FX.Utils.isNull(e.max)?this.endDate.setValue(null):this.endDate.setValue(e.max),FX.Utils.isNull(e.min)?this.startDate.setValue(null):this.startDate.setValue(e.min)):(this.endDate.setValue(null),this.startDate.setValue(null)),this._setSingleValue("start",e?e.min:null),this._setSingleValue("end",e?e.max:null)},getValue:function(){var e=this.startDate.getValue(),t=this.endDate.getValue(),i={};return FX.Utils.isNull(e)||(i.min=e),FX.Utils.isNull(t)||(i.max=t),i}}),e.shortcut("datelimit",FX.DateLimit)}(jQuery),function(e){FX.NumberLimit=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.NumberLimit.superclass._defaultConfig.apply(),{baseCls:"fui_number_limit",width:300,width4number:150})},_init:function(){FX.NumberLimit.superclass._init.apply(this,arguments);var t=this.options,i=this;this.minNumber=new FX.Number({renderEl:e('<div class="limit-item"/>').appendTo(this.element),waterMark:"最小值",height:t.height,allowDecimals:!0,onStopEdit:function(e,a){FX.Utils.applyFunc(i,t.onStopEdit,[e,a],!1)},width:t.width4number}),e('<div class="limit-item limit-to"/>').text("~").appendTo(this.element),this.maxNumber=new FX.Number({renderEl:e('<div class="limit-item"/>').appendTo(this.element),waterMark:"最大值",allowDecimals:!0,height:t.height,onStopEdit:function(e,a){FX.Utils.applyFunc(i,t.onStopEdit,[e,a],!1)},width:t.width4number})},checkValidate:function(){return this.maxNumber.checkValidate()&&this.minNumber.checkValidate()},setValue:function(e){e?(FX.Utils.isNull(e.max)?this.maxNumber.setValue(null):this.maxNumber.setValue(e.max),FX.Utils.isNull(e.min)?this.minNumber.setValue(null):this.minNumber.setValue(e.min)):(this.maxNumber.setValue(null),this.minNumber.setValue(null))},getValue:function(){var e=this.maxNumber.getValue(),t=this.minNumber.getValue(),i={};return FX.Utils.isNull(t)||(i.min=t),FX.Utils.isNull(e)||(i.max=e),i}}),e.shortcut("numberlimit",FX.NumberLimit)}(jQuery),function($){FX.DomTree=FX.extend(FX.Widget,{setting:{treeId:"tree",treeObj:null,view:{addDiyDom:null,autoCancelSelected:!0,dblClickExpand:!1,expandSpeed:"fast",fontCss:{},nameIsHTML:!1,selectedMulti:!1,showIcon:!1,showLine:!1,showTitle:!0,txtSelectedEnable:!1},data:{key:{children:"children",name:"name",title:"",url:"url",checked:"checked"},simpleData:{enable:!1,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:!1,leaf:!1}},async:{enable:!1,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeNodeCreate:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,beforeCheck:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null,onCheck:null},consts:{className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch"},event:{NODECREATED:"tree_nodeCreated",CLICK:"tree_click",EXPAND:"tree_expand",COLLAPSE:"tree_collapse",ASYNC_SUCCESS:"tree_async_success",ASYNC_ERROR:"tree_async_error",CHECK:"tree_check"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul",CHECK:"_check"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"},checkbox:{STYLE:"x-check",DEFAULT:"x-tree-check",DISABLED:"disable",FALSE:"",TRUE:"select",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},check:{enable:!1,autoCheckTrigger:!1,chkStyle:"x-check",nocheckInherit:!1,chkDisabledInherit:!1,radioType:"level",chkboxType:{Y:"ps",N:"ps"}}},getDOMBySelector:function(e,t,i){return t&&"string"!=typeof t&&(i=t,t=""),"string"==typeof e?$(e,i?i.treeObj.get(0).ownerDocument:null):$("#"+e.tId+t,i?i.treeObj:null)},makeUlLineClass:function(e,t){return e.view.showLine&&!t.isLastNode?e.consts.line.LINE:""},makeUlHtml:function(e,t,i,a){i.push("<ul id='",t.tId,e.consts.id.UL,"' class='",e.consts.className.LEVEL,t.level," ",this.makeUlLineClass(e,t),"' style='display:",t.open?"block":"none","'>"),i.push(a),i.push("</ul>")},appendParentULDom:function(e,t){var i=[],a=this.getDOMBySelector(t,e);!a.get(0)&&t.parentTId&&(this.appendParentULDom(e,t.getParentNode()),a=this.getDOMBySelector(t,e));var s=this.getDOMBySelector(t,e.consts.id.UL,e);s.get(0)&&s.remove();var n=e.data.key.children,o=this.appendNodes(e,t.level+1,t[n],t,!1,!0);this.makeUlHtml(e,t,i,o.join("")),a.append(i.join(""))},makeNodeIcoStyle:function(e,t){var i=[];if(!t.isAjaxing){var a=t.isParent&&t.iconOpen&&t.iconClose?t.open?t.iconOpen:t.iconClose:t.icon;a&&i.push("background:url(",a,") 0 0 no-repeat;"),!1!==e.view.showIcon&&FX.Utils.applyFunc(this,e.view.showIcon,[t],!0)||i.push("width:0px;height:0px;")}return i.join("")},makeNodeLineClass:function(e,t){var i=[],a=e.consts;return e.view.showLine?0===t.level&&t.isFirstNode&&t.isLastNode?i.push(a.line.ROOT):0===t.level&&t.isFirstNode?i.push(a.line.ROOTS):t.isLastNode?i.push(a.line.BOTTOM):i.push(a.line.CENTER):i.push(a.line.NOLINE),t.isParent?i.push(t.open?e.consts.folder.OPEN:e.consts.folder.CLOSE):i.push(a.folder.DOCU),this.makeNodeLineClassEx(e,t)+i.join("_")},makeNodeLineClassEx:function(e,t){return e.consts.className.BUTTON+" "+e.consts.className.LEVEL+t.level+" "+e.consts.className.SWITCH+" x-iconfont "},setNodeLineIcos:function(e,t){if(t){var i=this.getDOMBySelector(t,e.consts.id.SWITCH,e),a=this.getDOMBySelector(t,e.consts.id.UL,e),s=this.getDOMBySelector(t,e.consts.id.ICON,e),n=this.makeUlLineClass(e,t);0===n.length?a.removeClass(e.consts.line.LINE):a.addClass(n),i.attr("class",this.makeNodeLineClass(e,t)),t.isParent?i.removeAttr("disabled"):i.attr("disabled","disabled"),s.removeAttr("style"),s.attr("style",this.makeNodeIcoStyle(e,t)),s.attr("class",this.makeNodeIcoClass(e,t))}},cancelPreSelectedNode:function(e,t){for(var i=this.root.curSelectedList,a=i.length-1;a>=0;a--)if((!t||t===i[a])&&(this.getDOMBySelector(i[a],e.consts.id.A,e).removeClass(e.consts.node.CURSELECTED),t)){this.removeSelectedNode(e,t);break}t||(this.root.curSelectedList=[])},getNodeMainDom:function(e){return $(e).parent("li").get(0)||$(e).parentsUntil("li").parent().get(0)},getMDom:function(e,t,i){if(!t)return null;for(;t&&t.id!==e.treeId;){for(var a=0,s=i.length;t.tagName&&a<s;a++)if(t.tagName==i[a].tagName&&null!==t.getAttribute(i[a].attrName))return t;t=t.parentNode}return null},getNodeName:function(e,t){return""+t[e.data.key.name]},getNodeTitle:function(e,t){return""+t[""===e.data.key.title?e.data.key.name:e.data.key.title]},makeDOMNodeIcon:function(e,t,i){var a=this.getNodeName(t,i),s=t.view.nameIsHTML?a:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");e.push("<i id='",i.tId,t.consts.id.ICON,"' title='' treeNode",t.consts.id.ICON," class='",this.makeNodeIcoClass(t,i),"' style='",this.makeNodeIcoStyle(t,i),"'></i><span id='",i.tId,t.consts.id.SPAN,"'>",s,"</span>")},makeDOMNodeLine:function(e,t,i){e.push("<i id='",i.tId,t.consts.id.SWITCH,"' title='' class='",this.makeNodeLineClass(t,i),"' treeNode",t.consts.id.SWITCH,"></i>")},makeDOMNodeMainAfter:function(e,t,i){e.push("</li>")},makeDOMNodeMainBefore:function(e,t,i){e.push("<li id='",i.tId,"' class='",t.consts.className.LEVEL,i.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(e,t,i){e.push("</a>")},makeDOMNodeNameBefore:function(e,t,i){var a=this.getNodeTitle(t,i),s=this.makeNodeUrl(t,i),n=this.makeNodeFontCss(t,i),o=[];for(var l in n)o.push(l,":",n[l],";");e.push("<a id='",i.tId,t.consts.id.A,"' class='",t.consts.className.LEVEL,i.level,"' treeNode",t.consts.id.A,' onclick="',i.click||"",'" ',null!=s&&s.length>0?"href='"+s+"'":""," target='",this.makeNodeTarget(i),"' style='",o.join(""),"'"),FX.Utils.applyFunc(this,t.view.showTitle,[i],t.view.showTitle)&&a&&e.push("title='",a.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'"),e.push(">")},makeNodeFontCss:function(e,t){var i=FX.Utils.applyFunc(this,e.view.fontCss,[t],e.view.fontCss);return i&&"function"!=typeof i?i:{}},makeNodeIcoClass:function(e,t){var i=["ico"];return t.isAjaxing||(i[0]=(t.iconSkin?t.iconSkin+"_":"")+i[0],t.isParent?i.push(t.open?e.consts.folder.OPEN:e.consts.folder.CLOSE):i.push(e.consts.folder.DOCU)),e.consts.className.BUTTON+" "+i.join("_")+" x-iconfont"},makeNodeTarget:function(e){return e.target||"_blank"},makeNodeUrl:function(e,t){var i=e.data.key.url;return t[i]?t[i]:null},setFirstNode:function(e,t){var i=e.data.key.children;t[i].length>0&&(t[i][0].isFirstNode=!0)},setLastNode:function(e,t){var i=e.data.key.children,a=t[i].length;a>0&&(t[i][a-1].isLastNode=!0)},removeNode:function(e,t){var i=e.data.key.children,a=t.parentTId?t.getParentNode():null;if(t.isFirstNode=!1,t.isLastNode=!1,t.getPreNode=function(){return null},t.getNextNode=function(){return null},this.getNodeCache(t.tId)){this.removeNodeCache(e,t),this.removeSelectedNode(e,t);for(var s=0,n=a[i].length;s<n;s++)if(a[i][s].tId==t.tId){a[i].splice(s,1);break}var o=this.getDOMBySelector(t,"");o&&o.length>0&&o.remove()}},replaceIcoClass:function(e,t,i){if(t&&!e.isAjaxing){var a=t.attr("class");if(void 0!=a){var s=a.split("_"),n=this.options.setting;switch(i){case n.consts.folder.OPEN:case n.consts.folder.CLOSE:case n.consts.folder.DOCU:s[s.length-1]=i}t.attr("class",s.join("_")+" x-iconfont")}}},replaceSwitchClass:function(e,t,i){if(t){var a=t.attr("class");if(void 0!=a){var s=a.split("_"),n=this.options.setting;switch(i){case n.consts.line.ROOT:case n.consts.line.ROOTS:case n.consts.line.CENTER:case n.consts.line.BOTTOM:case n.consts.line.NOLINE:s[0]=this.makeNodeLineClassEx(e)+i;break;case n.consts.folder.OPEN:case n.consts.folder.CLOSE:case n.consts.folder.DOCU:s[1]=i}t.attr("class",s.join("_")),i!==n.consts.folder.DOCU?t.removeAttr("disabled"):t.attr("disabled","disabled")}}},selectNode:function(e,t){var i=this.options.setting;t||this.cancelPreSelectedNode(i),this.getDOMBySelector(e,i.consts.id.A,i).addClass(i.consts.node.CURSELECTED),this.addSelectedNode(i,e)},setNodeFontCss:function(e,t){var i=this.getDOMBySelector(t,e.consts.id.A,e),a=this.makeNodeFontCss(e,t);a&&i.css(a)},setNodeName:function(e,t){var i=this.getNodeTitle(e,t),a=this.getDOMBySelector(t,e.consts.id.SPAN,e);a.empty(),e.view.nameIsHTML?a.html(this.getNodeName(e,t)):a.text(this.getNodeName(e,t)),FX.Utils.applyFunc(this,e.view.showTitle,[t],e.view.showTitle)&&this.getDOMBySelector(t,e.consts.id.A,e).attr("title",i||"")},setNodeTarget:function(e,t){this.getDOMBySelector(t,e.consts.id.A,e).attr("target",this.makeNodeTarget(t))},setNodeUrl:function(e,t){var i=this.getDOMBySelector(t,e.consts.id.A,e),a=this.makeNodeUrl(e,t);null==a||0===a.length?i.removeAttr("href"):i.attr("href",a)},switchNode:function(e,t){if(t.open||!this.canAsync(e,t))this.expandCollapseNode(e,t,!t.open);else if(e.async.enable){if(!this.asyncNode(e,t))return void this.expandCollapseNode(e,t,!t.open)}else t&&this.expandCollapseNode(e,t,!t.open)}}),FX.EventTree=FX.extend(FX.DomTree,{bindTree:function(e){var t=this.element,i=this;e.view.txtSelectedEnable||t.bind("selectstart",function(e){var t=e.originalEvent.srcElement.nodeName.toLowerCase();return"input"===t||"textarea"===t}).css({"-mo-user-select":"-mo-none"});var a=function(e){var t=i.doProxy(e),a=!0;return t&&(t.nodeEventCallback&&(a=t.nodeEventCallback.apply(i,[e,t.node])&&a),t.treeEventCallback&&(a=t.treeEventCallback.apply(i,[e,t.node])&&a)),a};t.bind("click",a).bind("dblclick",a).bind("mouseover",a).bind("mouseout",a).bind("mousedown",a).bind("mouseup",a).bind("contextmenu",a)},doProxy:function(e){var t=e.target,i=this.options.setting,a="",s=null,n="",o="",l=null,r=null,d=null;if("mousedown"==e.type?o="mousedown":"mouseup"==e.type?o="mouseup":"contextmenu"==e.type?o="contextmenu":"click"==e.type?"I"!=t.tagName&&"SPAN"!=t.tagName||null===t.getAttribute("treeNode"+i.consts.id.SWITCH)?(d=this.getMDom(i,t,[{tagName:"A",attrName:"treeNode"+i.consts.id.A}]))&&(a=this.getNodeMainDom(d).id,n="clickNode"):(a=this.getNodeMainDom(t).id,n="switchNode"):"dblclick"==e.type&&(o="dblclick",(d=this.getMDom(i,t,[{tagName:"A",attrName:"treeNode"+i.consts.id.A}]))&&(a=this.getNodeMainDom(d).id,n="switchNode")),o.length>0&&0===a.length&&(d=this.getMDom(i,t,[{tagName:"A",attrName:"treeNode"+i.consts.id.A}]))&&(a=this.getNodeMainDom(d).id),a.length>0)switch(s=this.getNodeCache(a),n){case"switchNode":s.isParent&&("click"==e.type||"dblclick"==e.type&&FX.Utils.applyFunc(this,i.view.dblClickExpand,[s],i.view.dblClickExpand))?l=this.onSwitchNode:n="";break;case"clickNode":l=this.onClickNode}switch(o){case"mousedown":r=this.onTreeMousedown;break;case"mouseup":r=this.onTreeMouseup;break;case"dblclick":r=this.onTreeDblclick;break;case"contextmenu":r=this.onTreeContextmenu}return{node:s,nodeEventType:n,nodeEventCallback:l,treeEventType:o,treeEventCallback:r}},bindEvent:function(e){var t=this.element,i=e.consts.event,a=this;t.bind(i.NODECREATED,function(t,i){FX.Utils.applyFunc(a,e.callback.onNodeCreated,[t,i])}),t.bind(i.CLICK,function(t,i,s,n){FX.Utils.applyFunc(a,e.callback.onClick,[i,s,n])}),t.bind(i.EXPAND,function(t,i){FX.Utils.applyFunc(a,e.callback.onExpand,[t,i])}),t.bind(i.COLLAPSE,function(t,i){FX.Utils.applyFunc(a,e.callback.onCollapse,[t,i])}),t.bind(i.ASYNC_SUCCESS,function(t,i,s){FX.Utils.applyFunc(a,e.callback.onAsyncSuccess,[t,i,s])}),t.bind(i.ASYNC_ERROR,function(t,i,s,n,o){FX.Utils.applyFunc(a,e.callback.onAsyncError,[t,i,s,n,o])})},unbindTree:function(){var e=this.element,t=this.options.setting.consts.event;e.unbind("click").unbind("dblclick").unbind("mouseover").unbind("mouseout").unbind("mousedown").unbind("mouseup").unbind("contextmenu").unbind(t.NODECREATED).unbind(t.CLICK).unbind(t.EXPAND).unbind(t.COLLAPSE).unbind(t.ASYNC_SUCCESS).unbind(t.ASYNC_ERROR).unbind(t.CHECK)},onSwitchNode:function(e,t){var i=this.options.setting;if(t.open){if(!1===FX.Utils.applyFunc(this,i.callback.beforeCollapse,[t],!0))return!0}else if(!1===FX.Utils.applyFunc(this,i.callback.beforeExpand,[t],!0))return!0;return this.root.expandTriggerFlag=!0,this.switchNode(i,t),!0},onClickNode:function(e,t){var i=this.options.setting,a=i.view.autoCancelSelected&&(e.ctrlKey||e.metaKey)&&this.isSelectedNode(i,t)?0:i.view.autoCancelSelected&&(e.ctrlKey||e.metaKey)&&i.view.selectedMulti?2:1;return!1===FX.Utils.applyFunc(this,i.callback.beforeClick,[t,a],!0)||(0===a?this.cancelPreSelectedNode(i,t):this.selectNode(t,2===a),i.treeObj.trigger(i.consts.event.CLICK,[e,t,a]),!0)},onTreeMousedown:function(e,t){var i=this.options.setting;return FX.Utils.applyFunc(this,i.callback.beforeMouseDown,[t],!0)&&FX.Utils.applyFunc(this,i.callback.onMouseDown,[e,t]),!0},onTreeMouseup:function(e,t){var i=this.options.setting;return FX.Utils.applyFunc(this,i.callback.beforeMouseUp,[t],!0)&&FX.Utils.applyFunc(this,i.callback.onMouseUp,[e,t]),!0},onTreeDblclick:function(e,t){var i=this.options.setting;return FX.Utils.applyFunc(this,i.callback.beforeDblClick,[t],!0)&&FX.Utils.applyFunc(this,i.callback.onDblClick,[e,t]),!0},onTreeContextmenu:function(e,t){var i=this.options.setting;return FX.Utils.applyFunc(this,i.callback.beforeRightClick,[t],!0)&&FX.Utils.applyFunc(this,i.callback.onRightClick,[e,t]),"function"!=typeof i.callback.onRightClick},createNodeCallback:function(e){if(e.callback.onNodeCreated||e.view.addDiyDom)for(var t=this.root;t.createdNodes.length>0;){var i=t.createdNodes.shift();FX.Utils.applyFunc(this,e.view.addDiyDom,[i]),e.callback.onNodeCreated&&e.treeObj.trigger(e.consts.event.NODECREATED,[i])}},getAfterA:function(e,t,i){this.afterA&&this.afterA.apply(this,arguments)},getBeforeA:function(e,t,i){this.beforeA&&this.beforeA.apply(this,arguments)},getInnerAfterA:function(e,t,i){this.innerAfterA&&this.innerAfterA.apply(this,arguments)},getInnerBeforeA:function(e,t,i){this.innerBeforeA&&this.innerBeforeA.apply(this,arguments)}}),FX.DataTree=FX.extend(FX.EventTree,{addNodeCache:function(e,t){this.cache.nodes[this.getNodeCacheId(t.tId)]=t},getNodeCacheId:function(e){return e.substring(e.lastIndexOf("_")+1)},getNodeCache:function(e){if(!e)return null;var t=this.cache.nodes[this.getNodeCacheId(e)];return t||null},canAsync:function(e,t){var i=e.data.key.children;return e.async.enable&&t&&t.isParent&&!(t.Async||t[i]&&t[i].length>0)},asyncNode:function(setting,node,isSilent,callback){var i,l,self=this;if(node&&!node.isParent)return FX.Utils.applyFunc(this,callback),!1;if(node&&node.isAjaxing)return!1;if(!1===FX.Utils.applyFunc(this,setting.callback.beforeasyncNode,[node],!0))return FX.Utils.applyFunc(this,callback),!1;if(node){node.isAjaxing=!0;var icoObj=this.getDOMBySelector(node,setting.consts.id.ICON,setting);icoObj.attr({style:"",class:setting.consts.className.BUTTON+" "+setting.consts.className.ICO_LOADING+" x-iconfont"})}var tmpParam={};for(i=0,l=setting.async.autoParam.length;node&&i<l;i++){var pKey=setting.async.autoParam[i].split("="),spKey=pKey;pKey.length>1&&(spKey=pKey[1],pKey=pKey[0]),tmpParam[spKey]=node[pKey]}if(FX.Utils.isArray(setting.async.otherParam))for(i=0,l=setting.async.otherParam.length;i<l;i+=2)tmpParam[setting.async.otherParam[i]]=setting.async.otherParam[i+1];else for(var p in setting.async.otherParam)tmpParam[p]=setting.async.otherParam[p];var _tmpV=this.root._ver;return FX.Utils.ajax({url:FX.Utils.applyFunc(this,setting.async.url,[node],setting.async.url),data:tmpParam},function(msg){if(_tmpV==self.root._ver){var newNodes=[];try{newNodes=msg&&0!==msg.length?"string"==typeof msg?eval("("+msg+")"):msg:[]}catch(e){newNodes=msg}node&&(node.isAjaxing=null,node.Async=!0),self.setNodeLineIcos(setting,node),newNodes&&""!==newNodes?(newNodes=FX.Utils.applyFunc(this,setting.async.dataFilter,[node,newNodes],newNodes),self.addNodes(setting,node,newNodes?newNodes.slice(0):[],!!isSilent)):self.addNodes(setting,node,[],!!isSilent),setting.treeObj.trigger(setting.consts.event.ASYNC_SUCCESS,[node,msg]),FX.Utils.applyFunc(this,callback)}},function(e,t,i){_tmpV==self.root._ver&&(node&&(node.isAjaxing=null),self.setNodeLineIcos(setting,node),setting.treeObj.trigger(setting.consts.event.ASYNC_ERROR,[node,e,t,i]))}),!0},addNodesData:function(e,t,i){var a=e.data.key.children;t[a]||(t[a]=[]),t[a].length>0&&(t[a][t[a].length-1].isLastNode=!1,this.setNodeLineIcos(e,t[a][t[a].length-1])),t.isParent=!0,t[a]=t[a].concat(i)},addSelectedNode:function(e,t){var i=this.root;this.isSelectedNode(e,t)||i.curSelectedList.push(t)},addCreatedNode:function(e,t){(e.callback.onNodeCreated||e.view.addDiyDom)&&this.root.createdNodes.push(t)},fixPIdKeyValue:function(e,t){e.data.simpleData.enable&&(t[e.data.simpleData.pIdKey]=t.parentTId?t.getParentNode()[e.data.simpleData.idKey]:e.data.simpleData.rootPId)},getNextNode:function(e,t){if(!t)return null;for(var i=e.data.key.children,a=t.parentTId?t.getParentNode():this.root,s=0,n=a[i].length-1;s<=n;s++)if(a[i][s]===t)return s==n?null:a[i][s+1];return null},getNodeByParam:function(e,t,i,a){if(!t||!i)return null;for(var s=e.data.key.children,n=0,o=t.length;n<o;n++){if(t[n][i]==a)return t[n];var l=this.getNodeByParam(e,t[n][s],i,a);if(l)return l}return null},getNodesByParam:function(e,t,i,a){if(!t||!i)return[];for(var s=e.data.key.children,n=[],o=0,l=t.length;o<l;o++)t[o][i]==a&&n.push(t[o]),n=n.concat(this.getNodesByParam(e,t[o][s],i,a));return n},getNodes:function(){return this.root[this.options.setting.data.key.children]},getNodesByParamFuy:function(e,t,i,a){if(!t||!i)return[];var s=e.data.key.children,n=[];a=a.toLowerCase();for(var o=0,l=t.length;o<l;o++)"string"==typeof t[o][i]&&t[o][i].toLowerCase().indexOf(a)>-1&&n.push(t[o]),n=n.concat(this.getNodesByParamFuy(e,t[o][s],i,a));return n},getNodesByFilter:function(e,t,i,a,s){if(!t)return a?null:[];for(var n=e.data.key.children,o=a?null:[],l=0,r=t.length;l<r;l++){if(FX.Utils.applyFunc(this,i,[t[l],s],!1)){if(a)return t[l];o.push(t[l])}var d=this.getNodesByFilter(e,t[l][n],i,a,s);if(a&&d)return d;o=a?d:o.concat(d)}return o},getPreNode:function(e,t){if(!t)return null;for(var i=e.data.key.children,a=t.parentTId?t.getParentNode():this.root,s=0,n=a[i].length;s<n;s++)if(a[i][s]===t)return 0===s?null:a[i][s-1];return null},isSelectedNode:function(e,t){for(var i=this.root,a=0,s=i.curSelectedList.length;a<s;a++)if(t===i.curSelectedList[a])return!0;return!1},removeNodeCache:function(e,t){var i=e.data.key.children;if(t[i])for(var a=0,s=t[i].length;a<s;a++)arguments.callee(e,t[i][a]);this.cache.nodes[this.getNodeCacheId(t.tId)]=null},removeSelectedNode:function(e,t){for(var i=this.root,a=0,s=i.curSelectedList.length;a<s;a++)t!==i.curSelectedList[a]&&this.getNodeCache(i.curSelectedList[a].tId)||(i.curSelectedList.splice(a,1),a--,s--)},expandAll:function(e){e=!!e;var t=this.options.setting;return this.expandCollapseSonNode(t,null,e,!0),e},expandNode:function(e,t,i,a,s){var n=this.options.setting;return e&&e.isParent?(!0!==t&&!1!==t&&(t=!e.open),(s=!!s)&&t&&!1===FX.Utils.applyFunc(this,n.callback.beforeExpand,[e],!0)?null:s&&!t&&!1===FX.Utils.applyFunc(this,n.callback.beforeCollapse,[e],!0)?null:(t&&e.parentTId&&this.expandCollapseParentNode(n,e.getParentNode(),t,!1),t!==e.open||i?(this.root.expandTriggerFlag=s,!this.canAsync(n,e)&&i?this.expandCollapseSonNode(n,e,t,!0,function(){}):(e.open=!t,this.switchNode(this.options.setting,e)),t):null)):null},getNodeByTId:function(e){return this.getNodeCache(e)},getNodeIndex:function(e){if(!e)return null;for(var t=this.options.setting.data.key.children,i=e.parentTId?e.getParentNode():this.root,a=0,s=i[t].length;a<s;a++)if(i[t][a]==e)return a;return-1},getSelectedNodes:function(){for(var e=[],t=this.root.curSelectedList,i=0,a=t.length;i<a;i++)e.push(t[i]);return e},reAsyncChildNodes:function(e,t,i){if(this.options.setting.async.enable){var a=!e,s=this.options.setting;if(a&&(e=this.root),"refresh"==t){for(var n=this.options.setting.data.key.children,o=0,l=e[n]?e[n].length:0;o<l;o++)this.removeNodeCache(s,e[n][o]);this.removeSelectedNode(s),e[n]=[],a?this.options.setting.treeObj.empty():this.getDOMBySelector(e,s.consts.id.UL,s).empty()}this.asyncNode(this.options.setting,a?null:e,!!i)}},refresh:function(){this.options.setting.treeObj.empty();var e=this.root,t=this.options.setting,i=e[t.data.key.children];this.initRoot(t),e[t.data.key.children]=i,this.initCache(),this.createNodes(t,0,e[t.data.key.children])},updateNode:function(e,t){if(e){var i=this.options.setting;this.getDOMBySelector(e,i).get(0)&&(this.setNodeName(i,e),this.setNodeTarget(i,e),this.setNodeUrl(i,e),this.setNodeLineIcos(i,e),this.setNodeFontCss(i,e))}},transformToArrayFormat:function(e,t){if(!t)return[];var i=e.data.key.children,a=[];if(FX.Utils.isArray(t))for(var s=0,n=t.length;s<n;s++)a.push(t[s]),t[s][i]&&(a=a.concat(this.transformToArrayFormat(e,t[s][i])));else a.push(t),t[i]&&(a=a.concat(this.transformToArrayFormat(e,t[i])));return a},transformToTreeFormat:function(e,t){var i,a,s=e.data.simpleData.idKey,n=e.data.simpleData.pIdKey,o=e.data.key.children;if(!s||""==s||!t)return[];if(FX.Utils.isArray(t)){var l=[],r=[];for(i=0,a=t.length;i<a;i++)r[t[i][s]]=t[i];for(i=0,a=t.length;i<a;i++)r[t[i][n]]&&t[i][s]!=t[i][n]?(r[t[i][n]][o]||(r[t[i][n]][o]=[]),r[t[i][n]][o].push(t[i])):l.push(t[i]);return l}return[t]}}),FX.BaseTree=FX.extend(FX.DataTree,{_defaultConfig:function(){return $.extend(FX.BaseTree.superclass._defaultConfig.apply(),{baseCls:"fui_tree"})},_init:function(){FX.BaseTree.superclass._init.apply(this,arguments);var e=this.options;e.setting=this._doSettingConfig(),this._createRoot(e.setting);var t=e.setting;this.root=this.initRoot(t);var i=t.data.key.children,a=[];e.Nodes&&(a=FX.Utils.isArray(e.Nodes)?e.Nodes.slice(0):[e.Nodes].slice(0)),e.setting.data.simpleData.enable?this.root[i]=this.transformToTreeFormat(t,a):this.root[i]=a,this.initCache(),this.bindTree(t),this.bindEvent(t),this.root[i]&&this.root[i].length>0?this.createNodes(t,0,this.root[i]):t.async.enable&&t.async.url&&""!==t.async.url&&this.asyncNode(t)},_doSettingConfig:function(){var e=this.options;return e.setting=$.extend(!0,{},this.setting,e.setting),e.setting},_createRoot:function(e){var t=$('<ul id="'+e.treeId+'" class="tree"/>').appendTo(this.element);e.treeObj=t},initRoot:function(e){var t=e?this.root:null;return t||(t={}),t[e.data.key.children]=[],t.expandTriggerFlag=!1,t.curSelectedList=[],t.noSelection=!0,t.createdNodes=[],t.radioCheckedList=[],t.Id=0,t._ver=(new Date).getTime(),t},initCache:function(){this.cache=this.cache||{},this.cache.nodes=[],this.cache.doms=[]},initNode:function(e,t,i,a,s,n,o){if(i){var l=this.root,r=e.data.key.children,d=this;i.level=t,i.tId=e.treeId+"_"+ ++l.Id,i.parentTId=a?a.tId:null,i.open="string"==typeof i.open?"true"==i.open.toLowerCase():!!i.open,i[r]&&i[r].length>0?(i.isParent=!0,i.Async=!0):(i.isParent="string"==typeof i.isParent?"true"==i.isParent.toLowerCase():!!i.isParent,i.open=!(!i.isParent||e.async.enable)&&i.open,i.Async=!i.isParent),i.isFirstNode=s,i.isLastNode=n,i.getParentNode=function(){return d.getNodeCache(i.parentTId)},i.getPreNode=function(){return d.getPreNode(e,i)},i.getNextNode=function(){return d.getNextNode(e,i)},i.isAjaxing=!1,this.fixPIdKeyValue(e,i)}},addNodes:function(e,t,i,a){if(!e.data.keep.leaf||!t||t.isParent)if(FX.Utils.isArray(i)||(i=[i]),e.data.simpleData.enable&&(i=this.transformToTreeFormat(e,i)),t){var s=this.getDOMBySelector(t,e.consts.id.SWITCH,e),n=this.getDOMBySelector(t,e.consts.id.ICON,e),o=this.getDOMBySelector(t,e.consts.id.UL,e);t.open||(this.replaceSwitchClass(t,s,e.consts.folder.CLOSE),this.replaceIcoClass(t,n,e.consts.folder.CLOSE),t.open=!1,o.css({display:"none"})),this.addNodesData(e,t,i),this.createNodes(e,t.level+1,i,t),a||this.expandCollapseParentNode(e,t,!0)}else this.addNodesData(e,this.root,i),this.createNodes(e,0,i,null)},appendNodes:function(e,t,i,a,s,n){if(!i)return[];for(var o=[],l=e.data.key.children,r=0,d=i.length;r<d;r++){var c=i[r];if(FX.Utils.applyFunc(this,e.callback.beforeNodeCreate,[c],!0),s){var u=(a||this.root)[l].length==i.length&&0===r,h=r==i.length-1;this.initNode(e,t,c,a,u,h,n),this.addNodeCache(e,c)}var p=[];c[l]&&c[l].length>0&&(p=this.appendNodes(e,t+1,c[l],c,s,n&&c.open)),n&&(this.makeDOMNodeMainBefore(o,e,c),this.getBeforeA(e,c,o),this.makeDOMNodeNameBefore(o,e,c),this.makeDOMNodeLine(o,e,c),this.getInnerBeforeA(e,c,o),this.makeDOMNodeIcon(o,e,c),this.getInnerAfterA(e,c,o),this.makeDOMNodeNameAfter(o,e,c),this.getAfterA(e,c,o),c.isParent&&c.open&&this.makeUlHtml(e,c,o,p.join("")),this.makeDOMNodeMainAfter(o,e,c),this.addCreatedNode(e,c))}return o},createNodes:function(e,t,i,a){if(i&&0!==i.length){var s=this.root,n=e.data.key.children,o=!a||a.open||!!this.getDOMBySelector(a[n][0],e).get(0);s.createdNodes=[];var l=this.appendNodes(e,t,i,a,!0,o);if(a){var r=this.getDOMBySelector(a,e.consts.id.UL,e);r.get(0)&&r.append(l.join(""))}else e.treeObj.append(l.join(""));this.createNodeCallback(e)}},expandCollapseNode:function(e,t,i,a,s){var n=this.root,o=e.data.key.children;if(t){if(n.expandTriggerFlag){var l=s;s=function(){l&&l(),t.open?e.treeObj.trigger(e.consts.event.EXPAND,[t]):e.treeObj.trigger(e.consts.event.COLLAPSE,[t])},n.expandTriggerFlag=!1}if(!t.open&&t.isParent&&(!this.getDOMBySelector(t,e.consts.id.UL,e).get(0)||t[o]&&t[o].length>0&&!this.getDOMBySelector(t[o][0],e).get(0))&&(this.appendParentULDom(e,t),this.createNodeCallback(e)),t.open!=i){var r=this.getDOMBySelector(t,e.consts.id.UL,e),d=this.getDOMBySelector(t,e.consts.id.SWITCH,e),c=this.getDOMBySelector(t,e.consts.id.ICON,e);t.isParent?(t.open=!t.open,t.iconOpen&&t.iconClose&&c.attr("style",this.makeNodeIcoStyle(e,t)),t.open?(this.replaceSwitchClass(t,d,e.consts.folder.OPEN),this.replaceIcoClass(t,c,e.consts.folder.OPEN),!1===a||""==e.view.expandSpeed?(r.show(),FX.Utils.applyFunc(this,s,[])):t[o]&&t[o].length>0?r.slideDown(e.view.expandSpeed,s):(r.show(),FX.Utils.applyFunc(this,s,[]))):(this.replaceSwitchClass(t,d,e.consts.folder.CLOSE),this.replaceIcoClass(t,c,e.consts.folder.CLOSE),!1!==a&&""!=e.view.expandSpeed&&t[o]&&t[o].length>0?r.slideUp(e.view.expandSpeed,s):(r.hide(),FX.Utils.applyFunc(this,s,[])))):FX.Utils.applyFunc(this,s,[])}else FX.Utils.applyFunc(this,s,[])}else FX.Utils.applyFunc(this,s,[])},expandCollapseParentNode:function(e,t,i,a,s){t&&(t.parentTId?(this.expandCollapseNode(e,t,i,a),t.parentTId&&this.expandCollapseParentNode(e,t.getParentNode(),i,a,s)):this.expandCollapseNode(e,t,i,a,s))},expandCollapseSonNode:function(e,t,i,a,s){var n=e.data.key.children,o=t?t[n]:this.root[n],l=!t&&a,r=this.root.expandTriggerFlag;if(this.root.expandTriggerFlag=!1,o)for(var d=0,c=o.length;d<c;d++)o[d]&&this.expandCollapseSonNode(e,o[d],i,l);this.root.expandTriggerFlag=r,this.expandCollapseNode(e,t,i,a,s)},destroy:function(e){e&&(this.initCache(),this.initRoot(e),this.unbindTree(e),e.treeObj.empty(),e=void 0)}})}(jQuery),function(e){FX.Tree=FX.extend(FX.BaseTree,{initRoot:function(e){var t=FX.Tree.superclass.initRoot.apply(this,arguments);return t.radioCheckedList=[],t},bindEvent:function(e){FX.Tree.superclass.bindEvent.apply(this,arguments);var t=this.element,i=e.consts.event,a=this;t.bind(i.CHECK,function(t,i,s){FX.Utils.applyFunc(a,e.callback.onCheck,[i||t,s])})},unbindTree:function(e){FX.Tree.superclass.unbindTree.apply(this,arguments);var t=this.element,i=this.options.setting.consts.event;t.unbind(i.CHECK)},doProxy:function(e){var t=e.target.parentNode,i=this.options.setting,a="",s=null,n="",o=null;if(i.check.enable&&("mouseover"==e.type?"SPAN"==t.tagName&&null!==t.getAttribute("treeNode"+i.consts.id.CHECK)&&(a=this.getNodeMainDom(t).id,n="mouseoverCheck"):"mouseout"==e.type?"SPAN"==t.tagName&&null!==t.getAttribute("treeNode"+i.consts.id.CHECK)&&(a=this.getNodeMainDom(t).id,n="mouseoutCheck"):"click"==e.type&&"SPAN"==t.tagName&&null!==t.getAttribute("treeNode"+i.consts.id.CHECK)&&(a=this.getNodeMainDom(t).id,n="checkNode")),a.length>0)switch(s=this.getNodeCache(a),n){case"checkNode":o=this.onCheckNode;break;case"mouseoverCheck":o=this.onMouseoverCheck;break;case"mouseoutCheck":o=this.onMouseoutCheck}return""!==n?{node:s,nodeEventType:n,nodeEventCallback:o,treeEventType:"",treeEventCallback:null}:FX.Tree.superclass.doProxy.apply(this,arguments)},initNode:function(e,t,i,a,s,n,o){if(FX.Tree.superclass.initNode.apply(this,arguments),i){var l=e.data.key.checked;"string"==typeof i[l]&&(i[l]="true"==i[l].toLowerCase()),i[l]=!!i[l],i.checkedOld=i[l],"string"==typeof i.nocheck&&(i.nocheck="true"==i.nocheck.toLowerCase()),i.nocheck=!!i.nocheck||e.check.nocheckInherit&&a&&!!a.nocheck,"string"==typeof i.chkDisabled&&(i.chkDisabled="true"==i.chkDisabled.toLowerCase()),i.chkDisabled=!!i.chkDisabled||e.check.chkDisabledInherit&&a&&!!a.chkDisabled,"string"==typeof i.halfCheck&&(i.halfCheck="true"==i.halfCheck.toLowerCase()),i.halfCheck=!!i.halfCheck,i.check_Child_State=-1,i.check_Focus=!1,i.getCheckStatus=function(){return this.getCheckStatus(e,i)},e.check.chkStyle==e.consts.radio.STYLE&&e.check.radioType==e.consts.radio.TYPE_ALL&&i[l]&&this.root.radioCheckedList.push(i)}},makeDOMNodeLine:function(e,t,i){FX.Tree.superclass.makeDOMNodeLine.apply(this,arguments),t.check.enable&&(this.makeChkFlag(t,i),e.push("<span ID='",i.tId,t.consts.id.CHECK,"' class='",this.makeChkClass(t,i),"' treeNode",t.consts.id.CHECK,!0===i.nocheck?" style='display:none;'":"","><i class='x-iconfont'></i></span>"))},getRadioCheckedList:function(e){for(var t=this.root.radioCheckedList,i=0,a=t.length;i<a;i++)this.getNodeCache(e,t[i].tId)||(t.splice(i,1),i--,a--);return t},getCheckStatus:function(e,t){if(!e.check.enable||t.nocheck||t.chkDisabled)return null;var i=e.data.key.checked;return{checked:t[i],half:t.halfCheck?t.halfCheck:e.check.chkStyle==e.consts.radio.STYLE?2===t.check_Child_State:t[i]?t.check_Child_State>-1&&t.check_Child_State<2:t.check_Child_State>0}},getTreeCheckedNodes:function(e,t,i,a){if(!t)return[];var s=e.data.key.children,n=e.data.key.checked,o=i&&e.check.chkStyle==e.consts.radio.STYLE&&e.check.radioType==e.consts.radio.TYPE_ALL;a=a||[];for(var l=0,r=t.length;l<r&&(!0===t[l].nocheck||!0===t[l].chkDisabled||t[l][n]!=i||(a.push(t[l]),!o))&&(this.getTreeCheckedNodes(e,t[l][s],i,a),!(o&&a.length>0));l++);return a},getTreeChangeCheckedNodes:function(e,t,i){if(!t)return[];var a=e.data.key.children,s=e.data.key.checked;i=i||[];for(var n=0,o=t.length;n<o;n++)!0!==t[n].nocheck&&!0!==t[n].chkDisabled&&t[n][s]!=t[n].checkedOld&&i.push(t[n]),this.getTreeChangeCheckedNodes(e,t[n][a],i);return i},makeChkFlag:function(e,t){if(t){var i=e.data.key.children,a=e.data.key.checked,s=-1;if(t[i])for(var n=0,o=t[i].length;n<o;n++){var l=t[i][n],r=-1;if(e.check.chkStyle==e.consts.radio.STYLE){if(2===(r=!0===l.nocheck||!0===l.chkDisabled?l.check_Child_State:!0===l.halfCheck?2:l[a]?2:l.check_Child_State>0?2:0)){s=2;break}0===r&&(s=0)}else if(e.check.chkStyle==e.consts.checkbox.STYLE){if(1===(r=!0===l.nocheck||!0===l.chkDisabled?l.check_Child_State:!0===l.halfCheck?1:l[a]?-1===l.check_Child_State||2===l.check_Child_State?2:1:l.check_Child_State>0?1:0)){s=1;break}if(2===r&&s>-1&&n>0&&r!==s){s=1;break}if(2===s&&r>-1&&r<2){s=1;break}r>-1&&(s=r)}}t.check_Child_State=s}},checkNode:function(e,t,i,a){var s=this.options.setting,n=s.data.key.checked;if(!0!==e.chkDisabled&&(!0!==t&&!1!==t&&(t=!e[n]),a=!!a,(e[n]!==t||i)&&(!a||!1!==FX.Utils.applyFunc(this,s.callback.beforeCheck,[e],!0))&&s.check.enable&&!0!==e.nocheck)){e[n]=t;var o=this.getDOMBySelector(e,s.consts.id.CHECK,s);(i||s.check.chkStyle===s.consts.radio.STYLE)&&this.checkNodeRelation(s,e),this.setChkClass(s,o,e),this.repairParentChkClassWithSelf(s,e),a&&s.treeObj.trigger(s.consts.event.CHECK,[null,e])}},checkAllNodes:function(e){this.repairAllChk(this.options.setting,!!e)},getCheckedNodes:function(e){var t=this.options.setting.data.key.children;return e=!1!==e,this.getTreeCheckedNodes(this.options.setting,this.root[t],e)},getChangeCheckedNodes:function(){var e=this.options.setting.data.key.children;return this.getTreeChangeCheckedNodes(this.options.setting,this.root[e])},setChkDisabled:function(e,t,i,a){t=!!t,i=!!i,a=!!a,this.repairSonChkDisabled(this.options.setting,e,t,a),this.repairParentChkDisabled(this.options.setting,e.getParentNode(),t,i)},onCheckNode:function(e,t){if(!0===t.chkDisabled)return!1;var i=this.options.setting,a=i.data.key.checked;if(!1===FX.Utils.applyFunc(this,i.callback.beforeCheck,[t],!0))return!0;t[a]=!t[a],this.checkNodeRelation(i,t);var s=this.getDOMBySelector(t,i.consts.id.CHECK,i);return this.setChkClass(i,s,t),this.repairParentChkClassWithSelf(i,t),i.treeObj.trigger(i.consts.event.CHECK,[e,t]),!0},onMouseoverCheck:function(e,t){if(!0===t.chkDisabled)return!1;var i=this.options.setting,a=this.getDOMBySelector(t,i.consts.id.CHECK,i);return t.check_Focus=!0,this.setChkClass(i,a,t),!0},onMouseoutCheck:function(e,t){if(!0===t.chkDisabled)return!1;var i=this.options.setting,a=this.getDOMBySelector(t,i.consts.id.CHECK,i);return t.check_Focus=!1,this.setChkClass(i,a,t),!0},checkNodeRelation:function(e,t){var i,a,s,n=e.data.key.children,o=e.data.key.checked,l=e.consts.radio;if(e.check.chkStyle==l.STYLE){var r=this.getRadioCheckedList(e);if(t[o])if(e.check.radioType==l.TYPE_ALL){for(a=r.length-1;a>=0;a--)(i=r[a])[o]=!1,r.splice(a,1),this.setChkClass(e,this.getDOMBySelector(i,e.consts.id.CHECK,e),i),i.parentTId!=t.parentTId&&this.repairParentChkClassWithSelf(e,i);r.push(t)}else{var d=t.parentTId?t.getParentNode():this.root;for(a=0,s=d[n].length;a<s;a++)(i=d[n][a])[o]&&i!=t&&(i[o]=!1,this.setChkClass(e,this.getDOMBySelector(i,e.consts.id.CHECK,e),i))}else if(e.check.radioType==l.TYPE_ALL)for(a=0,s=r.length;a<s;a++)if(t==r[a]){r.splice(a,1);break}}else t[o]&&(!t[n]||0===t[n].length||e.check.chkboxType.Y.indexOf("s")>-1)&&this.setSonNodeCheckBox(e,t,!0),t[o]||t[n]&&0!==t[n].length&&!(e.check.chkboxType.N.indexOf("s")>-1)||this.setSonNodeCheckBox(e,t,!1),t[o]&&e.check.chkboxType.Y.indexOf("p")>-1&&this.setParentNodeCheckBox(e,t,!0),!t[o]&&e.check.chkboxType.N.indexOf("p")>-1&&this.setParentNodeCheckBox(e,t,!1)},makeChkClass:function(e,t){var i=e.data.key.checked,a=e.consts.checkbox,s=e.consts.radio,n="";n=!0===t.chkDisabled?a.DISABLED:t.halfCheck?a.PART:e.check.chkStyle==s.STYLE?t.check_Child_State<1?a.FULL:a.PART:t[i]?2===t.check_Child_State||-1===t.check_Child_State?a.FULL:a.PART:t.check_Child_State<1?a.FULL:a.PART;var o=e.check.chkStyle+" "+(t[i]?a.TRUE:a.FALSE)+" "+n;return o=t.check_Focus&&!0!==t.chkDisabled?o+"_"+a.FOCUS:o,e.consts.className.BUTTON+" "+a.DEFAULT+" "+o},repairAllChk:function(e,t){if(e.check.enable&&e.check.chkStyle===e.consts.checkbox.STYLE)for(var i=e.data.key.checked,a=e.data.key.children,s=this.root,n=0,o=s[a].length;n<o;n++){var l=s[a][n];!0!==l.nocheck&&!0!==l.chkDisabled&&(l[i]=t),this.setSonNodeCheckBox(e,l,t)}},repairChkClass:function(e,t){if(t&&(this.makeChkFlag(e,t),!0!==t.nocheck)){var i=this.getDOMBySelector(t,e.consts.id.CHECK,e);this.setChkClass(e,i,t)}},repairParentChkClass:function(e,t){if(t&&t.parentTId){var i=t.getParentNode();this.repairChkClass(e,i),this.repairParentChkClass(e,i)}},repairParentChkClassWithSelf:function(e,t){if(t){var i=e.data.key.children;t[i]&&t[i].length>0?this.repairParentChkClass(e,t[i][0]):this.repairParentChkClass(e,t)}},repairSonChkDisabled:function(e,t,i,a){if(t){var s=e.data.key.children;if(t.chkDisabled!=i&&(t.chkDisabled=i),this.repairChkClass(e,t),t[s]&&a)for(var n=0,o=t[s].length;n<o;n++){var l=t[s][n];this.repairSonChkDisabled(e,l,i,a)}}},repairParentChkDisabled:function(e,t,i,a){t&&(t.chkDisabled!=i&&a&&(t.chkDisabled=i),this.repairChkClass(e,t),this.repairParentChkDisabled(e,t.getParentNode(),i,a))},setChkClass:function(e,t,i){t&&(!0===i.nocheck?t.hide():t.show(),t.removeClass(),t.addClass(this.makeChkClass(e,i)))},setParentNodeCheckBox:function(e,t,i,a){var s=e.data.key.children,n=e.data.key.checked,o=this.getDOMBySelector(t,e.consts.id.CHECK,e);if(a||(a=t),this.makeChkFlag(e,t),!0!==t.nocheck&&!0!==t.chkDisabled&&(t[n]=i,this.setChkClass(e,o,t),e.check.autoCheckTrigger&&t!=a&&e.treeObj.trigger(e.consts.event.CHECK,[null,t])),t.parentTId){var l=!0;if(!i)for(var r=t.getParentNode()[s],d=0,c=r.length;d<c;d++)if(!0!==r[d].nocheck&&!0!==r[d].chkDisabled&&r[d][n]||(!0===r[d].nocheck||!0===r[d].chkDisabled)&&r[d].check_Child_State>0){l=!1;break}l&&this.setParentNodeCheckBox(e,t.getParentNode(),i,a)}},setSonNodeCheckBox:function(e,t,i,a){if(t){var s=e.data.key.children,n=e.data.key.checked,o=this.getDOMBySelector(t,e.consts.id.CHECK,e);a||(a=t);var l=!1;if(t[s])for(var r=0,d=t[s].length;r<d&&!0!==t.chkDisabled;r++){var c=t[s][r];this.setSonNodeCheckBox(e,c,i,a),!0===c.chkDisabled&&(l=!0)}t!=this.root&&!0!==t.chkDisabled&&(l&&!0!==t.nocheck&&this.makeChkFlag(e,t),!0!==t.nocheck&&!0!==t.chkDisabled?(t[n]=i,l||(t.check_Child_State=t[s]&&t[s].length>0?i?2:0:-1)):t.check_Child_State=-1,this.setChkClass(e,o,t),e.check.autoCheckTrigger&&t!=a&&!0!==t.nocheck&&!0!==t.chkDisabled&&e.treeObj.trigger(e.consts.event.CHECK,[null,t]))}},updateNode:function(e,t){FX.Tree.superclass.updateNode.apply(this,arguments);var i=this.options.setting;if(e&&i.check.enable&&this.getDOMBySelector(e,i).get(0)){var a=this.getDOMBySelector(e,i.consts.id.CHECK,i);!0!==t&&i.check.chkStyle!==i.consts.radio.STYLE||this.checkNodeRelation(i,e),this.setChkClass(i,a,e),this.repairParentChkClassWithSelf(i,e)}},createNodes:function(e,t,i,a){FX.Tree.superclass.createNodes.apply(this,arguments),i&&this.repairParentChkClassWithSelf(e,a)},removeNode:function(e,t){var i=t.getParentNode();FX.Tree.superclass.removeNode.apply(this,arguments),t&&i&&(this.repairChkClass(e,i),this.repairParentChkClass(e,i))},appendNodes:function(e,t,i,a,s,n){var o=FX.Tree.superclass.appendNodes.apply(this,arguments);return a&&this.makeChkFlag(e,a),o}}),e.shortcut("tree",FX.Tree)}(jQuery),function(e){FX.Segment=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Segment.superclass._defaultConfig.apply(),{baseCls:"fui_segment",onAfterItemSelect:null,items:[]})},_init:function(){FX.Segment.superclass._init.apply(this,arguments);for(var t=this.options,i=0,a=t.items.length;i<a;i++){var s=t.items[i],n=e('<div class="fui_segment_item"/>').data("item",s).append(e("<span/>").text(s.text)).appendTo(this.element);s.iconCls&&n.prepend(e("<i/>").addClass(s.iconCls)),s.htmlContent&&n.empty().addClass("segment-html-item").append(s.htmlContent)}this._bindEvts()},_bindEvts:function(){var t=this,i=this.options,a=function(a){if(t.isEnabled()){var s=e(a.target).closest(".fui_segment_item");s&&s.length>0&&"click"===a.type&&(e(".selected",t.element).removeClass("selected"),t._setItemSelected(s),FX.Utils.applyFunc(t,i.onAfterItemSelect,null,!1))}};this.element.unbind(),this.element.bind("click",a).bind("mouseout",a)},_setItemSelected:function(e){var t=this.options;if(e&&!e.hasClass("selected")){e.addClass("selected");var i=e.data("item");t.value=i.value,t.text=i.text}},checkValidate:function(){return!(!this.options.allowBlank&&FX.Utils.isEmpty(this.getValue()))},getValue:function(){return this.options.value},getText:function(){return this.options.text},setValue:function(t){var i=this.options,a=this;e(".selected",a.element).removeClass("selected"),FX.Utils.isNull(t)&&(i.value=null,i.text=null),i.items&&e.each(i.items,function(e,i){if(t==i.value){var s=a.element.children().eq(e);a._setItemSelected(s)}})},setText:function(t){var i=this.options,a=this;e(".selected",a.element).removeClass("selected"),FX.Utils.isNull(t)&&(i.value=null,i.text=null),i.items&&e.each(i.items,function(e,i){if(t==i.text){var s=a.element.children().eq(e);a._setItemSelected(s)}})}}),e.shortcut("segment",FX.Segment)}(jQuery),function(e){FX.MultiSegment=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.MultiSegment.superclass._defaultConfig.apply(),{baseCls:"fui_multi_segment",onAfterItemSelect:null,items:[]})},_init:function(){FX.MultiSegment.superclass._init.apply(this,arguments);var t=this.options,i=this;FX.Utils.forEach(t.items,function(t,a){var s=e('<div class="fui_segment_item"/>').data("item",a).append(e("<span/>").text(a.text)).appendTo(i.element);a.iconCls&&s.prepend(e("<i/>").addClass(a.iconCls)),a.htmlContent&&s.empty().addClass("segment-html-item").append(a.htmlContent)}),this._bindEvts()},_bindEvts:function(){var t=this,i=this.options;this.element.on("click",function(a){if(t.isEnabled()){var s=e(a.target).closest(".fui_segment_item");if(s&&s.length>0){s.toggleClass("selected");var n=s.data("item"),o=s.hasClass("selected");FX.Utils.applyFunc(t,i.onAfterItemSelect,[s,n,o],!1)}}})},checkValidate:function(){return!(!this.options.allowBlank&&FX.Utils.isObjectEmpty(this.getValue()))},getValue:function(){var t=[];return e(".selected",this.element).each(function(){t.push(e(this).data("item").value)}),t},setValue:function(t){var i=e.makeArray(t);e(".selected",this.element).removeClass("selected"),e(".fui_segment_item",this.element).each(function(){var t=e(this).data("item");i.indexOf(t.value)>-1&&e(this).addClass("selected")})}}),e.shortcut("multisegment",FX.MultiSegment)}(jQuery),function(e){FX.LoginName=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.LoginName.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_login_name",waterMark:"",height:40,phoneDelimiter:"-",inputType:"phone",checkEmailValid:!0,onStopEdit:null,onValidateFail:null,onValidateSuccess:null})},_init:function(){FX.LoginName.superclass._init.apply(this,arguments);var t=this,i=this.options;this.chinaCode=FX.CONST.CHINA_CODE,this.$input=e('<input name="username" class="phone-input" placeholder="'+i.waterMark+'">').appendTo(this.element),this.$input.focus(function(){t.$err&&t.$err.hide()}).blur(function(e){var a=t.checkValidate();a&&FX.Utils.applyFunc(t,i.onStopEdit,[a,e],!1)}).on("input propertychange",function(){var e="multi";t.isPhone()&&(e="phone"),t.setValueType(e)}),this.$btn=e('<div class="phone-btn"/>').appendTo(this.element),this.$selectText=e('<div class="phone-code"/>').text(this.chinaCode).css({height:i.height,"line-height":i.height-2+"px"}).appendTo(this.$btn),this.$select=e('<select name="location" class="location-select" tabindex="-1"/>').appendTo(this.$btn),FX.Utils.forEach(FX.CONST.AREA_CODE,function(i,a){e('<option value="'+a.value+'" '+(a.value===t.chinaCode?"selected":"")+">"+a.text+" "+a.value+"</option>").appendTo(t.$select)}),e('<i class="icon-angledown"/>').css({"line-height":i.height-2+"px"}).appendTo(this.$btn),this.$select.on("change",function(e){t.$selectText.text(e.target.value)}),this.setValueType(i.inputType)},showErrorMsg:function(t){FX.Utils.isEmpty(t)||(this.$err||(this.$err=e('<span class="invalid-info"/>').appendTo(this.element)),this.$err.text(t).show())},getValue:function(){return"multi"===this.valueType?this.$input.val():this.$select.val()+this.options.phoneDelimiter+this.$input.val()},getValueType:function(){return this.valueType},setValueType:function(e){"multi"===this.options.inputType?(this.valueType=e,this.element.toggleClass("multi","multi"===e)):(this.valueType="phone",this.element.toggleClass("multi",!1))},setValue:function(e){var t=this.options;if(!FX.Utils.isEmpty(e))if("multi"===this.valueType)this.$input.val(e);else{new RegExp(t.phoneDelimiter).test(e)||(e=t.phoneDelimiter+e);var i=e.split(t.phoneDelimiter);if(i){var a=i[0];FX.Utils.isEmpty(a)&&(a=this.chinaCode),this.$select.val(a),this.$selectText.text(a);var s=i[1];s&&this.$input.val(s)}}},isPhone:function(){var e=this.$input.val().trim(),t=!0;try{t=new RegExp("^([0-9]{4,})$").test(e)}catch(e){t=!1}return t},checkValidate:function(){var e=this.options,t=this.$input.val().trim(),i=!0;if("phone"===this.valueType)try{i=new RegExp("^\\d+$").test(t)}catch(e){i=!1}else if(e.checkEmailValid)try{i=new RegExp(FX.CONST.TEXT_TYPE_REGEXP.email).test(t)}catch(e){i=!1}return i?!1===FX.Utils.applyFunc(this,e.onValidateSuccess,[t],!1)&&this.$input.removeClass("x-input-error"):!1===FX.Utils.applyFunc(this,e.onValidateFail,[t],!1)&&this.$input.addClass("x-input-error"),i},setEnable:function(e){FX.LoginName.superclass.setEnable.apply(this,arguments),e?(this.$input.removeAttr("readOnly"),this.$select.removeAttr("disabled")):(this.$input.attr("readOnly","readOnly"),this.$select.attr("disabled","disabled"))}}),e.shortcut("login_name",FX.LoginName)}(jQuery),function(e){FX.Progress=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Progress.superclass._defaultConfig.apply(),{baseCls:"fui_progress",width:200,valueMin:0,valueMax:100,value:0,style:"info",message:"",isAnimate:!0,isStriped:!0})},_init:function(){FX.Progress.superclass._init.apply(this,arguments);var t=this.options;this.$bar=e('<div class="progress-bar" />').addClass("progress-bar-"+t.style).appendTo(this.element),t.isAnimate&&this.$bar.addClass("active"),t.isStriped&&this.$bar.addClass("progress-bar-striped"),this.$message=e('<span class="progress-message" />').css({"line-height":t.height+"px"}).appendTo(this.element),this.setValue(),this.setMessage()},setValue:function(e){var t=this.options;FX.Utils.isNull(e)||(t.value=e);var i=parseInt((t.value-t.valueMin)/(t.valueMax-t.valueMin)*100);i>60?this.$message.addClass("bright"):i<=60&&this.$message.removeClass("bright"),100===i&&t.isAnimate&&this.$bar.removeClass("active"),this.$bar.css({width:i+"%"})},setMessage:function(e){var t=this.options;FX.Utils.isBlank(e)||(t.message=e),this.$message.text(t.message)}}),e.shortcut("progress",FX.Progress)}(jQuery),function(e){FX.FilePreview=FX.extend(FX.Widget,{ROTATE_DIRECTION:{UP:0,RIGHT:1,DOWN:2,LEFT:3},_defaultConfig:function(){return e.extend(FX.FilePreview.superclass._defaultConfig.apply(),{renderEl:e("<div/>").appendTo("body"),baseCls:"fui_file_preview",autoClose:!1,files:[],scale:1.25,scaleWheel:1.1,currentItem:0,duration:150,height4Head:60,width4Side:160,maxScale:5,minScale:.18,fileDoc:"https://hc.jiandaoyun.com/doc/9026#6-%E9%99%84%E4%BB%B6"})},_init:function(){FX.FilePreview.superclass._init.apply(this,arguments);var t=this.options,i=this;this.element.addClass("x-window-mask modal dark").css({"z-index":FX.STATIC.zIndex++}),t.autoClose&&this.element.click(function(t){e(t.target).hasClass("x-window-mask")&&i.destroy()}),this._bindKeydownEvent(),this._createNaviBtns(),this.$fileWrapper=e('<div class="file-wrapper"/>').appendTo(this.element),t.files&&(this.totalPage=t.files.length,t.files.map(function(t){e('<div class="file-item"/>').appendTo(i.$fileWrapper)}),this.maxWidth=this.element.width()-2*t.width4Side,this.maxHeight=this.element.height()-t.height4Head,this._viewFileAt(t.currentItem))},_bindKeydownEvent:function(){var e=this;this.element.attr("tabindex",-1),this.element.focus(),this.element.bind("keydown",function(t){t.keyCode===FX.Keys.LEFT&&e.currentPage>0&&e._viewFileAt(e.currentPage-1),t.keyCode===FX.Keys.RIGHT&&e.currentPage<e.totalPage-1&&e._viewFileAt(e.currentPage+1),t.stopEvent()})},_viewFileAt:function(t){var i=this.options,a=this;this.currentPage=t,this._refreshNav(t),this.$pageIndex&&this.$pageIndex.text(t+1+" / "+this.totalPage);var s=i.files[t];if(s)if(this.$fileWrapper.children(".file-item").hide(),this.$currentView=this.$fileWrapper.children(".file-item").eq(t),this.$currentView.show(),this.$fileName.text(s.name||""),this.$currentView.children()&&0!==this.$currentView.children().length)a._bindDownloadEvent(a.$download,a.$currentView.data("url"),s.name);else{var n=e.extend({down:!0},i.files[t]);s.downloadUrl?(a._bindDownloadEvent(a.$download,s.downloadUrl,s.name),a.$currentView.data("url",s.downloadUrl)):FX.Utils.getFileDownloadURL(n,function(e){a._bindDownloadEvent(a.$download,e,s.name),a.$currentView.data("url",e)});o=s.name?s.name.split(".").pop():"";if(FX.Utils.isImageExt(o))this._dealImageFile(s);else if(FX.Utils.isOfficeExt(o))FX.Utils.dt(FX.CONST.TRACKER.FILE_PREVIEW),this._dealBoxFile(s,{hideHeader:!0,extName:o});else if(FX.Utils.isPdfExt(o))this._dealBoxFile(s,{hideHeader:!1,extName:o});else{var o=s.name?s.name.split(".").pop():"";this._dealOtherFile(o)}}},_dealImageFile:function(t){var i=this,a=this.options,s=FX.Utils.createLoadIcon(this.$currentView),n=e('<img class="x-ui-hidden"/>').appendTo(this.$currentView);t.previewUrl?n.attr("src",t.previewUrl):FX.Utils.getFileDownloadURL(e.extend({thumb:{mode:2,width:1200,height:1200}},t),function(e){n.attr("src",e)});var o={flag:!1};n.on("load",function(){n.removeClass("x-ui-hidden"),s.remove(),i._createToolBar().appendTo(i.$currentView),n.data("scale",1),i._adjustImg(n)}).on("mousedown",function(e){o.flag=!0,o.oriX=e.clientX,o.oriY=e.clientY,o.marginLeft=parseInt(n.css("margin-left")),o.marginTop=parseInt(n.css("margin-top"))}).on("wheel",function(t){t.originalEvent.deltaY>0?i._scaleImg(e(t.currentTarget),1/a.scaleWheel):i._scaleImg(e(t.currentTarget),a.scaleWheel)}),this.element.off("mousemove.imgpreview"),this.element.on("mousemove.imgpreview",function(e){if(o.flag)return n.css({marginLeft:o.marginLeft+e.clientX-o.oriX,marginTop:o.marginTop+e.clientY-o.oriY}),!1}),this.element.off("mouseup.imgpreview"),this.element.on("mouseup.imgpreview",function(){o.flag=!1})},_dealBoxFile:function(t,i){var a=e('<div class="iframe-wrapper"/>').appendTo(this.$currentView);i.hideHeader&&a.addClass("hide-header");var s=e('<iframe class="file-box-preview" frameborder="0"/>').appendTo(a);t.downloadUrl?s.attr("src",FX.Utils.getFileOnlineUrl(i.extName,t.downloadUrl)):FX.Utils.getFileDownloadURL(t,function(e){s.attr("src",FX.Utils.getFileOnlineUrl(i.extName,e))})},_dealOtherFile:function(t){var i=this.options;e('<div class="file-unknown"/>').append(FX.Utils.createFileThumb(t)).append(e('<div class="file-tip"/>').text("当前文件类型不支持在线预览")).append(e('<a class="file-link" target="_blank"/>').text("支持预览的文件？").attr("href",i.fileDoc)).appendTo(this.$currentView)},_refreshNav:function(t){var i=e(".file-nav.prev",this.element),a=e(".file-nav.next",this.element);t===this.totalPage-1?a.addClass("x-ui-hidden"):a.removeClass("x-ui-hidden"),0===t?i.addClass("x-ui-hidden"):i.removeClass("x-ui-hidden")},_adjustImg:function(e){var t=this.options,i=e.data("scale");if(i){var a=e.width()/i,s=e.height()/i,n={width:e.width(),height:e.height(),marginLeft:(this.maxWidth-e.width())/2+t.width4Side,marginTop:(this.maxHeight-e.height())/2},o=this.maxWidth,l=this.maxHeight;if([this.ROTATE_DIRECTION.LEFT,this.ROTATE_DIRECTION.RIGHT].indexOf(e.data("directionIdx")%4)>-1&&(o=this.maxHeight,l=this.maxWidth),a>o||s>l){var r=Math.min(o/a,l/s);e.data("scale",r),n.width=a*r,n.height=s*r,n.marginLeft=(this.maxWidth-n.width)/2+t.width4Side,n.marginTop=(this.maxHeight-n.height)/2}e.css(n),this._refreshScaleVal(e)}},_refreshScaleBtn:function(t){var i=this.options,a=e("i.enlargement",this.$currentView),s=e("i.narrow",this.$currentView),n=!0;return t>i.maxScale?(a.addClass("x-ui-disable"),n=!1):a.removeClass("x-ui-disable"),t<i.minScale?(s.addClass("x-ui-disable"),n=!1):s.removeClass("x-ui-disable"),n},_refreshScaleVal:function(t){var i=parseInt(100*t.data("scale"));e(".scale-val",this.$currentView).text(i+"%")},_createNaviBtns:function(){var t=this,i=(this.options,e('<div class="file-header"/>').appendTo(this.element));e('<i class="icon-close-normal file-nav close">').click(function(){t.destroy()}).appendTo(i),this.$download=e('<a target="_blank" class="file-nav download"/>').append(e('<i class="icon-vip-center-excel-import">')).append(e("<span />").text("下载")).appendTo(i),this.$pageIndex=e('<div class="file-counter"/>').appendTo(i),this.options.files.length>1&&(e('<div class="file-nav next"/>').append(e('<div class="nav-wrapper"><i class="icon-arrow-right"/></div>')).click(function(e){t._viewFileAt(t.currentPage+1)}).appendTo(this.element),e('<div class="file-nav prev"/>').append(e('<div class="nav-wrapper"><i class="icon-arrow-left"/></div>')).click(function(){t._viewFileAt(t.currentPage-1)}).appendTo(this.element)),this.$fileName=e('<div class="file-name"/>').appendTo(i)},_createToolBar:function(){var t=this,i=this.options,a=e('<div class="file-toolbar"/>');return e('<i class="icon-enlargement file-nav enlargement">').on("click",function(a){if(!e(a.currentTarget).hasClass("x-ui-disable")){var s=t.$currentView.children("img");s.length>0&&t._scaleImg(s,i.scale)}}).appendTo(a),e('<div class="scale-val"/>').appendTo(a),e('<i class="icon-narrow file-nav narrow">').on("click",function(a){if(!e(a.currentTarget).hasClass("x-ui-disable")){var s=t.$currentView.children("img");s.length>0&&t._scaleImg(s,1/i.scale)}}).appendTo(a),e('<i class="icon-rotate rotate"/>').on("click",function(){var e=t.$currentView.children("img");e.length>0&&t._rotateImg(e)}).appendTo(a),a},_scaleImg:function(e,t){this.options;var i=e.width(),a=e.height(),s=e.data("scale");if(this._refreshScaleBtn(s*t)){s*=t,e.data("scale",s);var n=parseInt(e.css("margin-left")),o=parseInt(e.css("margin-top"));e.css({width:i*t,height:a*t,marginLeft:n+i*(1-t)/2,marginTop:o+a*(1-t)/2}),this._refreshScaleVal(e)}},_rotateImg:function(e){var t=e.data("directionIdx")||this.ROTATE_DIRECTION.UP;t++,e.data("directionIdx",t),e.css({transform:"rotate("+90*t+"deg)"}),this._adjustImg(e)},_bindDownloadEvent:function(e,t,i){e.click(function(){FX.Utils.fileDownload(t,i)})}}),e.shortcut("filepreview",FX.FilePreview)}(jQuery),function(e){FX.InputGroup=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.InputGroup.superclass._defaultConfig.apply(),{baseCls:"fui-input-group",prevEl:null,inputEl:{type:"text"},nextEl:null,height:30})},_init:function(){FX.InputGroup.superclass._init.apply(this,arguments);var t=this.options;if(t.prevEl){var i=e('<div class="addon" />').appendTo(this.element);FX.createWidget(e.extend({},t.prevEl,{renderEl:i,customCls:"mask"}))}var a=e('<div class="addon" />').appendTo(this.element);if(this.inputEl=FX.createWidget(e.extend({},t.inputEl,{renderEl:a,height:t.height})),t.nextEl){var s=e('<div class="addon" />').appendTo(this.element);FX.createWidget(e.extend({},t.nextEl,{renderEl:s,customCls:"mask"}))}},getValue:function(){return this.inputEl.getValue()},setValue:function(e){this.inputEl.setValue(e)},checkValidate:function(){return this.inputEl.checkValidate()},showErrorMsg:function(e){this.inputEl.showErrorMsg(e)}}),e.shortcut("inputgroup",FX.InputGroup)}(jQuery),function(e){FX.DeptSelect=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.DeptSelect.superclass._defaultConfig.apply(this,arguments),{baseCls:"fx_dept_select",width:240,height:30,value:{items:[]},hasSelectEmpty:!0,dynamicType:"select",emptyId:"0",limit:{},onStopEdit:null,edge:{width:300,height:300}})},_init:function(){FX.DeptSelect.superclass._init.apply(this,arguments);var e=this.options;this.value=e.value||{items:[]},this._initData()},_initData:function(){var e=this;if(FX.Utils.isObjectEmpty(this.value.items))return this.items=[],void this._initSelectPane();var t=FX.Utils.createMask(this.element,{isLight:!0,hasLoader:!0});FX.Utils.ajax({url:FX.Utils.getApi(FX.API.corp.list_member_name),data:{isDepartmentOnly:!0,members:this.value.items}},function(i){var a=[];FX.Utils.forEach(i.departments,function(e,t){a.push({_id:t._id,name:t.name})}),e.items=a,e._initSelectPane(),t.remove()})},_getDynamicFields:function(){var e=this.options,t=[];return"set"===e.dynamicType&&t.push({_id:FX.CONST.DEPT_ID.CURRENT,name:"当前用户所处部门"}),e.hasSelectEmpty&&t.push({_id:e.emptyId,name:"未填写"}),t},_initSelectPane:function(){var e=this.options,t=this;if(this.value.hasEmpty&&this.items.unshift({_id:e.emptyId,name:"未填写"}),this.value.hasCurrentDept){if("set"!==e.dynamicType)return void FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.current_departments)},function(e){var i=[];FX.Utils.forEach(e.departmentList,function(e,a){var s={_id:a._id,name:a.name};i.push(s),t._updateValue(s,!0)}),t.items=i.concat(t.items),t._createSelectList(),t._bindEditEvent()});this.items.unshift({_id:FX.CONST.DEPT_ID.CURRENT,name:"当前用户所处部门"})}this._createSelectList(),this._bindEditEvent()},_bindEditEvent:function(){var t=this;this.$selectList.unbind("click"),this.$selectList.bind("click",function(i){if(e(i.target).closest(".remove-btn").length>0){var a=e(i.target).closest(".select-item").data("item");a&&t._removeSelectItem(a)}t.$selectPane?(t._createSelectPane(),t._showSelectPane()):(t.$selectPane=e('<div class="dept-select-pane x-dropdown"/>').appendTo("body"),t._createSelectPane(),t._showSelectPane()),t.$input.children("input").focus()}),this.$input.unbind("keydown"),this.$input.bind("keydown",function(e){if(FX.Utils.isEmpty(t.$input.children("input").val())){switch(e.keyCode){case 37:var i=t.$input.prev(".select-item");i.length>0&&t.$input.insertBefore(i);break;case 39:var a=t.$input.next(".select-item");a.length>0&&t.$input.insertAfter(a);break;case 8:var s=t.$input.prev(".select-item");s.length>0&&t._removeSelectItem(s.data("item"))}t.$input.children("input").focus()}}),this.$input.unbind("keyup"),this.$input.bind("keyup",function(){var e=t.$input.children("input").val();t._createSelectPane(e)})},_createSelectPane:function(t){var i=this;this.$selectPane.children(".select-search").remove(),this._createDynamicList(),FX.Utils.isEmpty(t)?this.departmentTree?this.departmentTree.setVisible(!0):FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.departments)},function(t){i.departments=e.extend(!0,[],t.departments),i.departments[0]&&!i.departments[0]._id&&i.departments.shift(),i._createDepartmentList()}):(this.departmentTree&&this.departmentTree.setVisible(!1),this._createSearchList(t))},_calSelectPanePos:function(){var e={"z-Index":FX.STATIC.zIndex++},t=this.element.offset(),i=this.options.edge,a=document.body.clientWidth-t.left;return a<i.width?(e.right=a-this.element.outerWidth(),e.left="auto"):(e.right="auto",e.left=t.left),document.body.clientHeight+document.body.scrollTop-t.top-this.element.outerHeight()<i.height?(e.top="auto",e.bottom=document.body.clientHeight-t.top):(e.top=t.top+this.element.outerHeight(),e.bottom="auto"),e},_showSelectPane:function(){var t=this;this.$selectPane.is(":visible")||(this.$selectPane.css(this._calSelectPanePos()),this.$selectPane.slideDown("fast"),e(document).bind("mousedown.hide",function(i){e(i.target).closest(".dept-select-pane,.fx_dept_select").length>0||t._hideSelectPane()}))},_hideSelectPane:function(){var t=this.options;this.$input.children("input").val(""),this.$selectPane.slideUp("fast"),e(document).unbind("mousedown.hide"),FX.Utils.applyFunc(this,t.onStopEdit,[],!1)},_createSelectList:function(){var t=this;this.$selectList?this.$selectList.empty():this.$selectList=e('<ul class="select-list"/>').appendTo(this.element),this.$input=e('<li class="select-input"/>').append('<input placeholder="搜索"/>').appendTo(this.$selectList),FX.Utils.forEach(this.items,function(e,i){t._createSelectItem(i)})},_addSelectItem:function(e){this._createSelectItem(e),this._updateValue(e,!0),this.refresh()},_removeSelectItem:function(t){e("#"+t._id,this.$selectList).remove(),this._updateValue(t,!1),this.refresh()},_updateValue:function(e,t){var i=this.options;switch(e._id){case i.emptyId:this.value.hasEmpty=t;break;case FX.CONST.DEPT_ID.CURRENT:this.value.hasCurrentDept=t;break;default:var a=this.value.items.indexOf(e._id);a<0&&t&&this.value.items.push(e._id),a>-1&&!t&&this.value.items.splice(a,1)}},_createSelectItem:function(t){if(t){if(e("#"+t._id,this.$selectList).length>0)return;e('<li class="select-item"><i class="select-icon icon-department"/><span>'+t.name+'</span><span class="remove-btn"><i class="icon-close-normal"/></span></li>').attr("id",t._id).data("item",t).insertBefore(this.$input)}},_doSelectItem:function(e){if(this._checkLimit(e)){var t={name:e.name,_id:e._id};this.value.items.indexOf(t._id)>-1?this._removeSelectItem(t):this._addSelectItem(t)}},_createDepartmentList:function(){var t=this;this.departmentTree=new FX.Tree({renderEl:e("<div/>").appendTo(this.$selectPane),customCls:"x-department-tree select-department",Nodes:e.extend(!0,[],this.departments),setting:{view:{expandSpeed:100},data:{simpleData:{enable:!0,idKey:"departmentId",pIdKey:"parentId"}},callback:{onCheck:function(e,i){t._doSelectItem(i)},onClick:function(e,i){t._doSelectItem(i)},beforeNodeCreate:function(e){t._checkLimit(e)||(e.nocheck=!0),e.checked=t._checkSelectState(e)},onNodeCreated:function(e,i){i.isParent&&!i.open&&i.level<1&&this.expandNode(i,!0),i.departmentId==t.currentDepartment&&this.selectNode(i)}},check:{enable:!0,chkboxType:{Y:"",N:""}}}})},_createDepartmentItem:function(t){var i=this,a=e("<li/>").append(e("<span/>").text(t.name)).append(e('<div class="select-btn x-check"/>').append(e('<i class="icon-blank"/>'))).data("item",t).click(function(){var e=a.children(".select-btn");if(e.hasClass("select"))e.removeClass("select"),i._removeSelectItem(a.data("item"));else{e.addClass("select");var t=a.data("item");i._addSelectItem(t)}});return this._checkSelectState(t)&&a.children(".select-btn").addClass("select"),a},_checkSelectState:function(e){var t=this.options;switch(e._id){case t.emptyId:return this.value.hasEmpty;case FX.CONST.DEPT_ID.CURRENT:return this.value.hasCurrentDept;default:return this.value.items.indexOf(e._id)>-1}},_createDynamicList:function(){var t=this;this.options;this.$dynamicList?this.$dynamicList.show():(this.$dynamicList=e('<ul class="department-list"/>').appendTo(this.$selectPane),FX.Utils.forEach(this._getDynamicFields(),function(e,i){t.$dynamicList.append(t._createDepartmentItem(i))}))},_createSearchList:function(t){var i=this,a=[],s=e('<div class="select-search"/>').appendTo(this.$selectPane),n=new RegExp(FX.Utils.escapeRegexp(t),"i");FX.Utils.forEach(this.departments,function(e,t){n.test(t.name)&&a.push(t)}),a.length<=0?s.append(e('<div class="search-empty"/>').text("暂无相关部门")):(this.$searchList=e('<ul class="department-list"/>').appendTo(s),FX.Utils.forEach(a,function(e,t){i._checkLimit(t)&&i.$searchList.append(i._createDepartmentItem(t))}))},_checkLimit:function(){return!0},getItems:function(){var t=[];return e(".select-item",this.$selectList).each(function(i,a){t.push(e(a).data("item"))}),t},setValue:function(e){this.value=e,this._initData()},getValue:function(){return this.value},_refreshDepartmentList:function(t){var i=this;e("li",t).each(function(t,a){var s=e(a).data("item");s&&(i._checkSelectState(s)?e(a).children(".select-btn").addClass("select"):e(a).children(".select-btn").removeClass("select"))})},refresh:function(){this.departmentTree&&this.departmentTree.refresh(),this.$dynamicList&&this._refreshDepartmentList(this.$dynamicList),this.$searchList&&this._refreshDepartmentList(this.$searchList)},rebuild:function(e){this.setValue(e),this.refresh()}}),e.shortcut("deptselect",FX.DeptSelect)}(jQuery),function(e){FX.Slider=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Slider.superclass._defaultConfig.apply(this,arguments),{renderEl:e("<div />").appendTo("body"),baseCls:"x-slider",title:"",contentWidget:{},content:null,position:"bottom",contentWidth:"100%",contentTop:45,onCreate:null,onBeforeClose:null,onClose:null,onShow:null,btn4Left:null,animateDuration:218,autoClose:!1,onContentCreate:null,onHeaderCreate:null})},_init:function(){FX.Slider.superclass._init.apply(this,arguments);var t=this.options,i=this;this.element.css({"z-index":FX.STATIC.zIndex++}),t.position&&this.element.addClass(t.position);var a=e('<div class="slider-body"/>').appendTo(this.element).css({width:t.contentWidth});"bottom"===t.position&&a.css("top",t.contentTop);var s=e('<div class="slider-header"/>').appendTo(a);!1===FX.Utils.applyFunc(this,t.onHeaderCreate,[s],!1)&&s.append(e('<span class="title"/>').text(t.title)),FX.Utils.isNull(t.btn4Left)||e('<div class="header-btn"/>').text(t.btn4Left.text).on("click",function(){FX.Utils.applyFunc(this,t.btn4Left.onClick,[],!1)}).appendTo(s),e('<i class="icon-close-normal"/>').click(function(){i._doClose()}).appendTo(s);var n=e('<div class="slider-main"/>').appendTo(a);this._createContent(n),this._bindEvent()},_createContent:function(t){var i=this.options,a=this;!1===FX.Utils.applyFunc(this,i.onContentCreate,[t],!1)&&(FX.Utils.isObjectEmpty(i.contentWidget)?t.append(i.content):a.contentWidget=FX.createWidget(e.extend({renderEl:e("<div/>").appendTo(t)},i.contentWidget)))},getContentWidget:function(){return this.contentWidget},_doClose:function(){var e=this.options;FX.Utils.applyFunc(this,e.onBeforeClose,null,!0)&&this.close()},show:function(){var t=this.options,i=this;setTimeout(function(){i.element.addClass("fadein"),setTimeout(function(){var a=e(".slider-header",i.element),s=e(".slider-main",i.element);FX.Utils.applyFunc(i,t.onShow,[a,s],!1)},t.animateDuration)},0)},close:function(){var e=this.options,t=this;this.element.removeClass("fadein"),setTimeout(function(){t.element.remove(),FX.Utils.applyFunc(t,e.onClose,[],!1)},e.animateDuration)},_bindEvent:function(){var t=this,i=this.options;i.autoClose&&this.element.click(function(a){e(a.target).hasClass(i.baseCls)&&t._doClose()})}})}(jQuery),function(e){FX.Alert=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Button.superclass._defaultConfig.apply(this,arguments),{baseCls:"x-alert",type:"warning",closable:!1,messageContent:"",onClose:null})},_init:function(){FX.Alert.superclass._init.apply(this,arguments);var t=this,i=this.options;i.type&&this.element.addClass("alert-"+i.type),i.messageContent&&e('<div class="alert-message" />').html(i.messageContent).appendTo(this.element),i.closable&&e('<i class="icon-close-normal alert-close" />').appendTo(this.element).click(function(){t.element.fadeOut(function(){FX.Utils.applyFunc(t,i.onClose,[],!1)})})}})}(jQuery),function(e){FX.Pagination=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Button.superclass._defaultConfig.apply(),{baseCls:"x-pagination",limit:10,count:1,curPage:1,maxCount:0,hasMore:!1,onChangePage:null,hasTurnLast:!1})},_init:function(){FX.Pagination.superclass._init.apply(this,arguments);var t=this,i=this.options;this.curPage=i.curPage;var a=Math.ceil(i.count/i.limit)||1,s=e('<div class="page-turn"/>').appendTo(this.element);t.$pre=e('<button class="page-btn pre" />').append('<i class="icon-angleleft" />').appendTo(s),t.$next=e('<button class="page-btn next" />').append('<i class="icon-angleright" />').appendTo(s);var n=e('<div class="page-jump" />').appendTo(this.element);t.$pageInput=new FX.Number({renderEl:e('<div class="page-input" />').keyup(function(t){(t.keyCode||t.which)===FX.Keys.ENTER&&e(this).children(".x-input-focus").blur()}).appendTo(n),value:this.curPage,width:30,onStopEdit:function(e){if(e){var s=this.getValue();s<1||s>a?this.setState(FX.States.ERROR):(t.curPage=s,FX.Utils.applyFunc(t,i.onChangePage,[t.curPage,i.limit],!1))}}});var o=a;i.maxCount&&i.count>i.maxCount&&(o=Math.ceil(i.maxCount/i.limit)+"+"),e('<span class="total"/>').text(" / "+o).appendTo(n),i.hasTurnLast&&(t.$first=e('<button class="page-btn first" />').append('<i class="icon-firstpage" />').prependTo(s),t.$last=e('<button class="page-btn last" />').append('<i class="icon-lastpage" />').appendTo(s)),t._checkTurnPage(),this._bindEvents()},_bindEvents:function(){var t=this,i=this.options;e(this.element).unbind(".pagination"),e(this.element).bind("click.pagination",function(a){var s=a.target,n=a.type,o=e(s).closest(".page-btn");if(o.length&&"click"===n){if(o.hasClass("disabled"))return;o.hasClass("next")?t.curPage+=1:o.hasClass("pre")?t.curPage-=1:o.hasClass("first")?t.curPage=1:o.hasClass("last")&&(t.curPage=Math.ceil(i.count/i.limit)||1),t.$pageInput.setValue(t.curPage),t._checkTurnPage(),FX.Utils.applyFunc(t,i.onChangePage,[t.curPage,i.limit],!1)}})},_checkTurnPage:function(){var t=this,i=this.options,a=Math.ceil(i.count/i.limit)||1;e(".page-btn",this.element).removeClass("disabled"),1===t.curPage&&(t.$pre.addClass("disabled"),t.$first&&t.$first.addClass("disabled")),t.curPage>=a&&!i.hasMore&&(t.$next.addClass("disabled"),t.$last&&t.$last.addClass("disabled"))}})}(jQuery),function(e){FX.FlowNodes=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.FlowNodes.superclass._defaultConfig.apply(this,arguments),{baseCls:"fx_flow_nodes",title:"",items:[],currentMenuId:null,onMenuClick:null,enable:!0,menuKey:null})},_init:function(){FX.FlowNodes.superclass._init.apply(this,arguments),this._createMenuName()},_createMenuName:function(){var t=this,i=this.options,a=i.title,s=e('<div class="menu-name"/>').appendTo(this.element);if(i.items.length>1&&s.append('<i class="menu-icon icon-caret-down"/>').on("click",function(){t._createMenuList(s)}),i.items.length){var n=i.items[0];FX.Utils.forEach(i.items,function(e,t){t.flowId===i.currentMenuId&&(n=t)}),n&&(i.currentMenuId=n.flowId),a=[a,n.name].join(" — ")}s.append(e("<span/>").text(a))},_createMenuList:function(t){var i=this,a=this.options,s=e('<div class="fx_flow_nodes_list"/>').appendTo(this.element);FX.Utils.forEach(a.items,function(t,i){var n=[a.title,i.name].join(" — "),o=e('<div class="menu-item"/>').append('<i class="select-icon icon-ok"/>').append(e("<span/>").text(n)).appendTo(s).data("id",i.flowId);a.currentMenuId===i.flowId&&o.addClass("select")}),s.on("click",".menu-item",function(t){var s=e(t.currentTarget),o=s.data("id");s.hasClass("select")||FX.Utils.applyFunc(i,a.onMenuClick,[o],!1),n.close()});var n=FX.Msg.bubble({anchor:t,text4Ok:null,text4Cancel:null,minWidth:230,contentHTML:s,hAdjust:t.width()/2-28,contentPadding:0,hasTriangle:!1})},refresh:function(t){e(this.element).empty(),this.options=e.extend(this.options,t),this._createMenuName()}})}(jQuery),function(e){FX.FlowBtn=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.FlowBtn.superclass._defaultConfig.apply(this,arguments),{baseCls:"fx_flow_btn",flow:{},onSubmit:null,backFlowEmptyTip:"没有可回退节点",candidateEmptyTip:"无可用转交人"})},_init:function(){FX.FlowBtn.superclass._init.apply(this,arguments),this._initBtn()},_initBtn:function(){var e=this.options,t=this,i=e.flow.btn,a=[];i.print&&(0,this._appendBtn({text:i.print.text,style:"green",onClick:function(){FX.Utils.applyFunc(t,e.onSubmit,["print",!0],!1)}})),i.forward&&(0,this._appendBtn({text:i.forward.text,style:"green",onClick:function(){FX.Utils.applyFunc(t,e.onSubmit,["forward",!0],!1)}})),i.save&&(0,this._appendBtn({text:i.save.text,onClick:function(){FX.Utils.applyFunc(t,e.onSubmit,["save"],!1)}})),i.revoke&&(0,this._appendBtn({text:i.revoke.text,style:"white",onClick:function(){FX.Utils.applyFunc(t,e.onSubmit,["revoke"],!1)}})),i.back&&a.push({text:i.back.text,iconCls:"icon-undo",style:"white",onClick:function(){var i=e.flow.backNodes||[];0===i.length?FX.Utils.applyFunc(t,e.onSubmit,["back"],!1):1===i.length?FX.Utils.applyFunc(t,e.onSubmit,["back",!1,{backFlowIds:i}],!1):t._createBackDialog()}}),i.transfer&&a.push({text:i.transfer.text,style:"white",iconCls:"icon-transfer",onClick:function(){t._createTransferDialog()}}),i.close&&a.push({text:i.close.text,style:"white",iconCls:"icon-flow-end",onClick:function(){FX.Msg.alert({title:"您确定要结束流程吗？",msg:"保存在此节点中的操作，并且将流程直接结束掉，不再往下流转",onOk:function(){FX.Utils.applyFunc(t,e.onSubmit,["close"],!1)}})}}),a.length>0&&(0,this._createMoreBtn(a))},_appendBtn:function(t,i){i=i||e('<div class="flow-btn"/>').appendTo(this.element);this.options;new FX.Button(e.extend({renderEl:i,width:120},t))},_createMoreBtn:function(e){var t=this;if(1===e.length){var i=e[0];i.iconCls="",this._appendBtn(i)}else this._appendBtn({text:"更多",style:"white",onClick:function(){t._createMoreDialog(e)}})},_createMoreDialog:function(t){var i=this,a=new FX.Dialog({width:70+180*t.length,customCls:"flow-btn-dlg",style4Header:"white",onContentCreate:function(s){FX.Utils.forEach(t,function(t,n){var o=e.extend({},n,{onClick:function(){n.onClick(),a.close()}});i._appendBtn(o,e('<div class="flow-btn"/>').appendTo(s))})}});a.show()},_createTransferDialog:function(){var t=this,i=this.options,a=new FX.ConfirmDialog({customCls:"flow-transfer-dlg",title:i.flow.btn.transfer.text,text4Ok:"确定",width:460,onOk:function(){var e=t._getSelectedItem("user");if(FX.Utils.isEmpty(e))return FX.Msg.toast({msg:"请选择负责人",type:"warning"});FX.Utils.applyFunc(t,i.onSubmit,["transfer",!1,{candidateId:e}],!1),a.close()},onContentCreate:function(a){var s=e('<div class="user-list-wrapper"/>').appendTo(a);e('<div class="list-title"/>').text("请选择负责人").appendTo(s),t.$userList=e('<div class="radio-list"/>').append(e('<div class="list-head"/>').text("负责人名称")).appendTo(s);var n=FX.Utils.createMask(t.$userList,{isLight:!0,hasLoader:!0});FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.allow_transfer_users),data:{flowId:i.flow.flowId}},function(e){t._createRadioList("transfer",e.candidates,t.$userList,i.candidateEmptyTip)},null,function(){n.remove()})}});a.show()},_createBackDialog:function(){var t=this,i=this.options,a=new FX.ConfirmDialog({customCls:"flow-back-dlg",title:i.flow.btn.back.text,text4Ok:"确定",width:460,onOk:function(){var e=t._getSelectedItem("flow");if(FX.Utils.isEmpty(e))return FX.Msg.toast({msg:"请选择节点",type:"warning"});FX.Utils.applyFunc(t,i.onSubmit,["back",!1,{backFlowIds:[e]}],!1),a.close()},onContentCreate:function(a){var s=e('<div class="flow-list-wrapper">').appendTo(a);e('<div class="list-title"/>').text("请选择节点").appendTo(s),t.$flowList=e('<div class="radio-list"/>').append(e('<div class="list-head"/>').text("节点名称")).appendTo(s);var n=FX.Utils.createMask(t.$flowList,{isLight:!0,hasLoader:!0});FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.allow_back_nodes),data:{flowId:i.flow.flowId}},function(e){t._createRadioList("back",e.flowNodes,t.$flowList,i.backFlowEmptyTip)},null,function(){n.remove()})}});a.show()},_createRadioList:function(t,i,a,s){var n="transfer"===t?"_id":"flowId";FX.Utils.forEach(i,function(t,i){e('<div class="radio-item x-radio"/>').data("dataId",i[n]).append(e('<i class="icon-blank"/>')).append(e('<span class="data-name"/>').text(i.nickname||i.name)).appendTo(a)}),0===e(".radio-item",a).length&&e('<div class="empty-tip"/>').text(s).appendTo(a),a.on("click",".radio-item",function(t){var i=e(t.currentTarget);i.hasClass("x-ui-disable")||i.hasClass("select")||i.addClass("select").siblings().removeClass("select")})},_getSelectedItem:function(t){var i="",a="flow"===t?this.$flowList:this.$userList,s=e(".radio-item.select",a),n=s.data("dataId");return s.length>0&&(i="flow"===t?parseInt(n):n),i}}),e.shortcut("flowbtn",FX.FlowBtn)}(jQuery),function(e){FX.Tip=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Tip.superclass._defaultConfig.apply(),{baseCls:"x-tip",msg:""})},_init:function(){FX.Tip.superclass._init.apply(this,arguments);var t=this.options;e('<div class="tip-message">'+t.msg+"</div>").appendTo(this.element.css({"z-index":FX.STATIC.zIndex++}))},doResize:function(t){var i=this.options,a=e.extend({},FX.Utils.pick(i,["width","height"]));a.height&&(a["line-height"]=a.height-2+"px"),this.element.css(a)}}),e.shortcut("tip",FX.Tip)}(jQuery),function(e){FX.Tag=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Tag.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_tag",text:"",subText:"",closable:!0,style:"green",iconCls:"icon-angledown",height:24,onClose:null,onClick:null})},_init:function(){FX.Tag.superclass._init.apply(this,arguments);var t=this,i=this.options;this.$tagWrapper=e('<div class="tag-wrapper"/>').appendTo(this.element),i.iconCls&&e('<i class="tag-icon"/>').addClass(i.iconCls).appendTo(this.$tagWrapper),FX.Utils.isEmpty(i.style)||this.$tagWrapper.addClass("style-"+i.style);var a=e('<div class="text-wrapper"/>').appendTo(this.$tagWrapper);this.$tag=e('<span class="tag-text"/>').appendTo(a),this.$subText=e('<span class="sub-text"/>').text(i.subText).appendTo(a),this.isEnabled()&&(this.element.click(function(){FX.Utils.applyFunc(t,i.onClick,[t.$tag],!1)}),i.closable&&(this.element.addClass("closable"),this.$deleteIcon=e('<i class="icon-close-circle"/>').on("click",function(e){t.close(),e.stopEvent()}).appendTo(this.$tagWrapper)))},close:function(){var e=this.options,t=this;!1===FX.Utils.applyFunc(t,e.onClose,[],!1)&&t.destroy()},doResize:function(e){var t=this.options;FX.Tag.superclass.doResize.apply(this,arguments),FX.Utils.isEmpty(t.height)||this.element.css({"line-height":t.height+"px"})},setSubText:function(e){e=FX.Utils.isNull(e)?"":e,this.$subText.text(e)},setText:function(e){e=FX.Utils.isNull(e)?"":e,this.$tag.text(e)},setValue:function(e){this.setText(e)}}),e.shortcut("tag",FX.Tag)}(jQuery),function(e){FX.Phone=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Phone.superclass._defaultConfig.apply(this,arguments),{baseCls:"fui_phone",waterMark:"",height:40,phoneDelimiter:"-",onStopEdit:null})},_init:function(){FX.Phone.superclass._init.apply(this,arguments);var t=this,i=this.options;this.chinaCode=FX.CONST.CHINA_CODE,this.$input=e('<input class="phone-input" placeholder="'+i.waterMark+'">').appendTo(this.element),this.$input.blur(function(e){var a=t.checkValidate();a&&FX.Utils.applyFunc(t,i.onStopEdit,[a,e],!1)}),this.$btn=e('<div class="phone-btn"/>').appendTo(this.element),this.$selectText=e('<div class="phone-code"/>').text(this.chinaCode).css({height:i.height,"line-height":i.height-2+"px"}).appendTo(this.$btn),this.$select=e('<select name="location" class="location-select" tabindex="-1"/>').appendTo(this.$btn),FX.Utils.forEach(FX.CONST.AREA_CODE,function(i,a){e('<option value="'+a.value+'" '+(a.value===t.chinaCode?"selected":"")+">"+a.text+" "+a.value+"</option>").appendTo(t.$select)}),e('<i class="icon-angledown"/>').css({"line-height":i.height-2+"px"}).appendTo(this.$btn),this.$select.on("change",function(e){t.$selectText.text(e.target.value)})},getValue:function(){return FX.Utils.isEmpty(this.$input.val())?"":this.$select.val()+this.options.phoneDelimiter+this.$input.val()},setValue:function(e){var t=this.options;if(!FX.Utils.isEmpty(e)){new RegExp(t.phoneDelimiter).test(e)||(e=t.phoneDelimiter+e);var i=e.split(t.phoneDelimiter);if(i){var a=i[0];FX.Utils.isEmpty(a)&&(a=this.chinaCode),this.$select.val(a),this.$selectText.text(a);var s=i[1];s&&this.$input.val(s)}}},checkValidate:function(){this.options;var e=this.$input.val().trim(),t=!0;try{t=new RegExp("^\\d+$").test(e)}catch(e){t=!1}return t?this.$input.removeClass("x-input-error"):this.$input.addClass("x-input-error"),t},setEnable:function(e){FX.Phone.superclass.setEnable.apply(this,arguments),e?(this.$input.removeAttr("readOnly"),this.$select.removeAttr("disabled")):(this.$input.attr("readOnly","readOnly"),this.$select.attr("disabled","disabled"))}}),e.shortcut("phone",FX.Phone)}(jQuery),function(e){FX.Cascader=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.Cascader.superclass._defaultConfig.apply(this,arguments),{renderEl:e("<div/>").appendTo("body"),baseCls:"fui_cascader",anchor:null,items:[],colWidth:160,hAdjust:0,autoClose:!0,onItemCreate:null,onItemClick:null,onBeforeHide:null})},_init:function(){FX.Cascader.superclass._init.apply(this,arguments);var t=this.options;this.$ul=e('<ul class="cs-list"/>').css({width:t.colWidth}).appendTo(this.element),this._createItemList(this.$ul,t.items),this._initListPos(t.anchor),this._bindEvents()},_createItemList:function(t,i){var a=this.options,s=this;FX.Utils.forEach(i,function(i,n){var o=e('<li class="cs-item"/>').data("item",n).appendTo(t);!1===FX.Utils.applyFunc(s,a.onItemCreate,[o,n],!1)&&s._createItem(o,n)})},_createItem:function(t,i){var a=this,s=this.options;if(t&&i){var n=!FX.Utils.isObjectEmpty(i.children),o=e('<a class="cs-text">').text(i.text||i.value||"").appendTo(t),l=e('<i class="cs-item-icon"/>').appendTo(o);if(i.withLine&&t.addClass("cs-item-line"),i.disabled&&t.addClass("cs-item-disable"),i.selected&&!n&&t.addClass("cs-item-selected"),n){t.addClass("cs-item-expand"),l.addClass("icon-arrow-right");var r=e('<ul class="cs-list cs-sub-list"/>').css({width:s.colWidth}).appendTo(t);a._createItemList(r,i.children)}else l.addClass("icon-ok")}},_initListPos:function(e){if(e){var t=this.options,i=e.offset(),a=e.outerHeight(),s={"z-index":FX.STATIC.zIndex++,left:i.left+t.hAdjust,top:i.top+a},n=document.body.clientHeight-i.top-a;n<this.element.outerHeight()&&(s.bottom=n+a,s.top="auto"),this.element.css(s)}},_bindEvents:function(){var t=this.options,i=this;this.$ul.on("click",function(a){var s=e(a.target).closest(".cs-item");if(s.length){var n=s.data("item"),o=i.getItemPath(s);if(FX.Utils.applyFunc(i,n.click,[n],!1),!1===FX.Utils.applyFunc(i,t.onItemClick,[s,n,o],!1)){if(n.disabled||!FX.Utils.isObjectEmpty(n.children))return;i.setItemSelected(s,n),i.hideList()}}}),t.autoClose&&(e(document).off("mousedown.cs"),e(document).on("mousedown.cs",function(t){e(t.target).closest(i.element).length||i.hideList()}))},getItemPath:function(t){var i=[],a=t.data("item");return a&&i.unshift(a.value),FX.Utils.forEach(t.parents(".cs-item"),function(t,a){var s=e(a).data("item");s&&i.unshift(s.value)}),i},setItemSelected:function(e,t){!t.disabled&&FX.Utils.isObjectEmpty(t.children)&&(e.siblings().removeClass("cs-item-selected"),e.addClass("cs-item-selected"))},hideList:function(){var e=this.options;FX.Utils.applyFunc(this,e.onBeforeHide,[],!1),this.destroy()}})}(jQuery),function(e){FX.Msg={bubble:function(t){var i=e.extend({anchor:null,msg:"",minWidth:null,contentWidget:null,contentHTML:null,contentPadding:10,onCancel:null,onOk:null,type:"info",width4Btn:100,text4Cancel:"取消",text4Ok:"确定",dockPosition:"left",edge:150,onShow:null,onClose:null,animation:!0,scrollObj:null,hasTriangle:!0,hAdjust:0,zoom:1},t);if(i.anchor){var a=e('<div class="x-msg-bubble"/>').addClass(i.type);i.animation&&a.addClass("animation"),i.minWidth&&a.css({"min-width":i.minWidth}),i.maxHeight&&a.css({"max-height":i.maxHeight});var s,n=e('<div class="content"/>').css({padding:i.contentPadding}).appendTo(a);FX.Utils.isEmpty(i.msg)?i.contentWidget?(i.contentWidget.renderEl=e("<div/>").appendTo(n),s=FX.createWidget(i.contentWidget)):i.contentHTML&&i.contentHTML.appendTo(n):e("<span/>").text(i.msg).appendTo(n);var o=!1;if(i.text4Cancel&&(o=!0,new FX.Button({renderEl:e("<div/>").appendTo(a),customCls:"navi-btn-cancel",style:"white",text:i.text4Cancel,width:i.width4Btn,onClick:function(e){!1!==FX.Utils.applyFunc(this,i.onCancel,[s,e],!0)&&m()}})),i.text4Ok){o=!0;var l="green";"error"===i.type&&(l="border-red"),new FX.Button({renderEl:e("<div/>").appendTo(a),customCls:"navi-btn-ok",style:l,text:i.text4Ok,width:i.width4Btn,onClick:function(e){!1!==FX.Utils.applyFunc(this,i.onOk,[s,e],!0)&&m()}})}o&&n.css({"padding-bottom":i.contentPadding+50});var r,d=6;i.hasTriangle&&(d=8,r=e('<div class="triangle-up"/>').appendTo(a));var c=i.anchor.offset(),u=c.top+i.anchor.height()+d-e("body").offset().top,h={"z-index":FX.STATIC.zIndex++},p=Math.min(i.edge,document.body.clientHeight/2);document.body.clientHeight+document.body.scrollTop-u<=p?(h.top="auto",h.bottom=document.body.clientHeight-c.top+d,a.addClass("dock-bottom")):(h.top=u,h.bottom="auto",a.addClass("dock-top"));var f=i.hAdjust||0;switch(i.dockPosition){case"left":a.addClass("dock-left"),h.left=c.left+i.anchor.width()/2-d-f,r&&r.css({left:f});break;case"right":a.addClass("dock-right"),h.right=document.body.clientWidth-c.left-i.anchor.width()/2-d-f,r&&r.css({right:f})}i.zoom&&(h.zoom=i.zoom);var m=function(){!1===FX.Utils.applyFunc(this,i.onClose,arguments,!1)&&(a.removeClass("active"),e(document).unbind("mousedown.bubble"),i.scrollObj&&e(i.scrollObj).unbind("scroll.bubble"),setTimeout(function(){a.remove()},i.animation?500:0))};return a.css(h).appendTo("body"),setTimeout(function(){a.addClass("active"),FX.Utils.applyFunc(this,i.onShow,[s],!1);var t=function(t){0===e(t.target).closest(".x-msg-bubble,.x-dropdown").length&&m()};e(document).bind("mousedown.bubble",t),i.scrollObj&&e(i.scrollObj).bind("scroll.bubble",t)},0),{close:m}}},toast:function(t){var i=e.extend({msg:"",type:"success",onShow:null,onClose:null,timeout:300},t);if(!(e(".x-msg-toast").length>0||FX.Utils.isEmpty(i.msg))){var a="";switch(i.type){case"success":a="icon-select";break;case"warning":a="icon-warning-circle";break;case"error":a="icon-close-circle"}var s=e('<div class="x-msg-toast"/>').appendTo("body"),n=e('<div class="content"/>').addClass(i.type).appendTo(s);e('<div class="toast-icon"/>').append(e('<i class="icon-toast-type"/>').addClass(a)).appendTo(n);e("<div/>").text(i.msg).appendTo(n);var o,l=function(){s.fadeOut(i.timeout,function(){s.remove()})};return o="success"===i.type?2e3:"loading"===i.type?0:4e3,s.fadeIn(i.timeout,function(){if(o>0)var e=setTimeout(l,o);s.click(function(){clearTimeout(e),l()})}),l}},alert:function(t){var i=e.extend({title:"",msg:"",onCreateMsg:null,tip:null,type:"warning",text4Ok:"确定",text4Cancel:"取消",height4Btn:30,onOk:null,onCancel:null,enable4Ok:!0,enable4Cancel:!0},t);if(!(e(".x-msg-alert").length>0)){var a=function(){s.fadeOut(function(){s.remove()}),n.removeClass("showAlert"),n.addClass("hideAlert"),n.remove()},s=e('<div class="x-window-mask modal light" tabIndex="-1"/>').css({"z-index":FX.STATIC.zIndex++}).appendTo("body"),n=e('<div class="x-msg-alert"/>').appendTo("body"),o=e('<div class="icon"/>').append(e('<i class="icon-toast-type"/>')).appendTo(n),l=e('<div class="alert-body"/>').appendTo(n);o.addClass(i.type),i.title&&l.append(e('<div class="title" />').text(i.title)),i.msg?l.append(e('<div class="text" />').html(i.msg)):i.onCreateMsg&&FX.Utils.applyFunc(null,i.onCreateMsg,[l],!1);var r=e('<div class="alert-footer"/>').appendTo(n),d=e('<div class="btn-container"/>').appendTo(r);i.tip&&r.append(e('<div class="alert-tip"/>').append(i.tip));var c,u;if(i.text4Ok){var h="green";"error"!==i.type&&"warning"!==i.type||(h="border-red"),c=new FX.Button({renderEl:e("<div/>").appendTo(d),customCls:"navi-btn-ok",style:h,text:i.text4Ok,height:i.height4Btn,enable:i.enable4Ok,onClick:function(){!1!==FX.Utils.applyFunc(this,i.onOk,[],!0)&&a()}})}return i.text4Cancel&&(u=new FX.Button({renderEl:e("<div/>").appendTo(d),customCls:"navi-btn-cancel",style:"white",text:i.text4Cancel,height:i.height4Btn,enable:i.enable4Cancel,onClick:function(){!1!==FX.Utils.applyFunc(this,i.onCancel,[],!0)&&a()}})),n.addClass("showAlert"),s.fadeIn(),n.show(),{okBtn:c,cancelBtn:u,close:a}}},prompt:function(t){var i=e.extend({title:"",waterMark:"",input:"",text4Cancel:"取消",text4Ok:"确定",height4Btn:30,onCancel:null,onOk:null},t);if(!(e(".x-msg-prompt").length>0)){var a=e('<div class="x-window-mask modal light fadeout" tabIndex="-1"/>').css({"z-index":FX.STATIC.zIndex++}).appendTo("body"),s=e('<div class="x-msg-prompt"/>').appendTo(a),n=function(){a.addClass("fadeout").removeClass("fadein"),setTimeout(function(){a.remove()},300)};e('<div class="prompt-title"/>').text(i.title).appendTo(s);var o=new FX.TextEditor({renderEl:e("<div />").appendTo(s),customCls:"prompt-input",value:i.input,width:"100%",height:36,allowBlank:!1,waterMark:i.waterMark});o.select();var l=e('<div class="btn-container"/>').appendTo(s);return new FX.Button({renderEl:e("<div />").appendTo(l),style:"green",text:i.text4Ok,customCls:"btn-ok",height:i.height4Btn,onClick:function(){!1!==FX.Utils.applyFunc(this,i.onOk,[o.getValue()],!0)&&n()}}),new FX.Button({renderEl:e("<div />").appendTo(l),style:"white",text:i.text4Cancel,customCls:"btn-cancel",height:i.height4Btn,onClick:function(){!1!==FX.Utils.applyFunc(this,i.onCancel,[],!0)&&n()}}),setTimeout(function(){a.addClass("fadein").removeClass("fadeout")},0),{close:n}}},broadcast:function(t){var i=e.extend({msg:"",url:"",text4Ok:"",onOk:null,onClose:null,customCls:null,innerExtraContent:"",blank:!1,url4Btn:!1},t),a=this;if(!(e(".x-msg-broadcast").length>0||FX.Utils.isEmpty(i.msg))){e("html").addClass("broadcast-html");var s=e('<div class="x-msg-broadcast"/>').prependTo("body");i.customCls&&s.addClass(i.customCls),setTimeout(function(){s.addClass("translate-in"),e("html").addClass("translate-in"),i.customCls&&e("html").addClass(i.customCls)}),i.innerExtraContent&&s.html(i.innerExtraContent);var n=e('<a class="broadcast-content"/>').text(i.msg).appendTo(s);if(i.url&&!i.url4Btn&&(n.attr("href",i.url),i.blank&&n.attr("target","_blank")),i.text4Ok){var o=e('<a class="broadcast-btn"/>').text(i.text4Ok).on("click",function(){FX.Utils.applyFunc(this,t.onOk,[],!1)}).appendTo(s);i.url&&i.url4Btn&&(o.attr("href",i.url),i.blank&&o.attr("target","_blank"))}e('<i class="icon-close-normal"/>').on("click",function(){a.closeBroadcast(),FX.Utils.applyFunc(this,t.onClose,[],!1)}).appendTo(s)}},closeBroadcast:function(){var t=e(".x-msg-broadcast");t.length>0&&(t.removeClass("translate-in"),e("html").removeClass("translate-in"),setTimeout(function(){e("html").removeClass("broadcast-html"),t.remove()},218))},notice:function(t){var i=e.extend({position:"top-right",title:"",type:"update",content:null,onClose:null,width:340},t),a=e(".x-msg-container","body");a.length||(a=e('<div class="x-msg-container"/>').addClass(i.position).appendTo("body"));var s=e('<div class="x-msg-notice" />').appendTo(a),n=function(){FX.Utils.applyFunc(this,i.onClose,[],!1),s.removeClass("fade-in"),setTimeout(function(){s.remove()},218)};e('<i class="icon-close-normal" />').on("click",function(){n()}).appendTo(s),i.width&&s.css({width:i.width}),i.title&&s.append(e('<span class="title" />').text(i.title));var o=e('<div class="content"/>').appendTo(s);return o.on("click",function(t){var i=e(t.target).closest("a");i&&i.length>0&&n()}),i.content&&o.append(i.content),s.addClass("fade-in"),{close:n}},dotGuide:function(t){if(t.hasMask)var i=e('<div class="x-window-mask modal"/>').css({"z-index":FX.STATIC.zIndex++,"background-color":"rgba(240, 240, 240, 0.25)"}).appendTo("body");var a=e.extend({position:"bottom",title:"",msg:"",onClose:null,onNext:null,onEnd:null,width:null,anchor:null,hAdjust:-10,vAdjust:-10,index:null,total:null,delay:null,isStepGuide:!1,isCircleEnable:!0,isCircleVisible:!0,isTriangleVisible:!1,trianglePos:"",style4Circle:null},t),s=function(){i&&i.remove(),r.remove(),FX.Utils.applyFunc(this,a.onClose,[],!1)},n=function(){i&&i.remove(),r.remove(),FX.Utils.applyFunc(this,a.onNext,[],!1)},o=function(){i&&i.remove(),r.remove(),FX.Utils.applyFunc(this,a.onEnd,[],!1)},l="";FX.Utils.isNull(a.index)?l+='<div class="footer"><span class="tip-end">我知道了</span></div>':a.index===a.total?l+='<div class="footer"><span class="step">'+a.index+"/"+a.total+'</span><span class="tip-end">开始使用</span></div>':l+='<div class="footer"><span class="step">'+a.index+"/"+a.total+'</span><span class="tip-close">关闭引导</span><span class="tip-next">下一步</span></div>';var r=e('<div class="x-msg-dot-guide '+a.position+'"><div class="circle-group"><div class="circle4"></div><div class="circle3"></div><div class="circle2"></div><div class="circle1"></div></div><div class="guide-tip"><div class="content"><div class="title">'+a.title+'</div><div class="msg">'+a.msg+"</div></div>"+l+'</div><div class="triangle-up"></div></div>').click(function(t){var i=e(t.target).closest(".circle-group"),l=e(t.target).closest(".tip-end"),r=e(t.target).closest(".tip-next"),d=e(t.target).closest(".tip-close");a.isCircleEnable&&i.length||r.length?n():d.length?s():(a.isCircleEnable&&i.length||l.length)&&o()});if(a.anchor){var d=e("body").offset(),c=a.anchor.offset();r.css({left:c.left+a.anchor.width()+a.hAdjust-d.left,top:c.top+a.anchor.height()+a.vAdjust-d.top})}else r.css({left:a.hAdjust,top:a.vAdjust});return a.width&&r.children(".guide-tip").width(a.width),a.isStepGuide?(r.css({"z-index":FX.STATIC.zIndex++}),a.delay?setTimeout(function(){r.addClass("zoomIn").appendTo("body")},a.delay):r.addClass("zoomIn").appendTo("body")):r.appendTo("body"),a.style4Circle&&r.addClass(a.style4Circle),a.isCircleVisible||e(".circle-group",r).addClass("x-ui-hidden"),a.isTriangleVisible||e(".triangle-up",r).addClass("x-ui-hidden"),a.trianglePos&&r.addClass(a.trianglePos),{close:o}}}}(jQuery),function(e){FX.FormEditPane=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.FormEditPane.superclass._defaultConfig.apply(this,arguments),{baseCls:"fx_form_edit_pane",dataId:null,entryId:null,flowType:null,flowId:null,onSuccess:null,onFail:null,onCancel:null,hasFlowBtn:!0,onLoadForm:null})},_init:function(){FX.FormEditPane.superclass._init.apply(this,arguments);var e=this.options;this._fetchForm(e.dataId,e.entryId,e.flowType,e.flowId)},_fetchForm:function(e,t,i,a){var s=this,n=this.options;FX.STATIC.ENTRYID=t,FX.STATIC.DATAID=e,FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.read),data:{entryId:t,formId:t,dataId:e,flowId:a}},function(a){FX.Utils.applyFunc(s,n.onLoadForm,[a.formName],!1);var o=a.currentFlowId,l=FX.Utils.getFlowOption(a,i);if(l.isEditable){var r=s._createOpt({res:a,flow:l,flowId:o,title:a.formName,dataId:e,entryId:t,flowType:i});s.form=new FX.Form(r)}else l.flowType=i,s._showFormData(a,l)},function(){return FX.Utils.applyFunc(s,n.onFail,[],!1),!1})},_showFormData:function(t,i,a){var s=this,n=this.options,o=[].concat(t.form.items||[]),l=t.data,r=null;t.form&&"grid-2"===t.form.layout&&(r={},FX.Utils.forEach(o,function(e,t){r[t.widget.widgetName]=t.lineWidth})),new FX.FlowFormDataPane({renderEl:e("<div/>").appendTo(this.element.empty()),appId:FX.STATIC.APPID,formId:l.entryId,width:n.width,height:n.height,title:[t.formName,t.flowName].join(" — "),entryName:t.formName,layout:r,header:o,data:l,flow:i,optAuth:t.optAuth,hasFlowBtn:n.hasFlowBtn&&i.hasLogView&&!a,hasFooter:!0,hasCustomPrint:!0,ignoreVisible:!1,onClose:function(e){a?a():e?FX.Utils.applyFunc(s,n.onSuccess,[],!1):s._doClose()},onFlowNodeClick:function(e,t,i){s._fetchForm(t,e,n.flowType,i)}})},_createOpt:function(t){var i=this,a=this.options;return e.extend(t.res.form,{renderEl:e("<div/>").appendTo(this.element.empty()),appId:FX.STATIC.APPID,entryId:t.entryId,dataId:t.dataId,submitUrl:FX.Utils.getApi(FX.API.data.update),submitData:{dataId:t.dataId,flowId:t.flowId},title:t.title,width:a.width,height:a.height,widgetOptAuth:t.res.optAuth,buttonPosition:"middle",editValue:t.res.data,mode:"edit",flow:t.flow,onSuccess:function(a,s,n){if(n){var o=FX.Utils.getFlowOption(a,"print");o.flowId=t.flow.flowId,i._showFormData(e.extend(t.res,a),o,function(){i._handleSubmitSuccess(e.extend(t,{flowAction:s}))})}else i._handleSubmitSuccess(e.extend(t,{flowAction:s}))},onAfterCancel:function(){i._doClose()},onFlowNodeClick:function(e,a,s){i._fetchForm(a,e,t.flowType,s)}})},_doClose:function(){var e=this.options;FX.STATIC.ENTRYID=null,FX.STATIC.DATAID=null,FX.Utils.applyFunc(this,e.onCancel,[],!1)},_handleSubmitSuccess:function(e){var t=this,i=this.options;switch(FX.STATIC.ENTRYID=null,e.flowAction){case"forward":case"save":case"back":case"transfer":if(e.flow.flowNodes.length>1)if(e.flow.flowNodes.slice(-1)[0].flowId===e.flowId)FX.Utils.applyFunc(t,i.onSuccess,[],!1);else{var a="";FX.Utils.forEach(e.flow.flowNodes,function(t,i){if(i.flowId===e.flowId){var s=e.flow.flowNodes[t+1];a=s?s.flowId:e.flow.flowNodes[t-1].flowId}}),t._fetchForm(e.dataId,e.entryId,e.flowType,a)}else FX.Utils.applyFunc(t,i.onSuccess,[],!1);break;case"close":FX.Utils.applyFunc(t,i.onSuccess,[],!1);break;default:FX.Utils.applyFunc(t,i.onCancel,[],!1)}},doResize:function(e){this.form&&this.form.doResize(e)}})}(jQuery),function(e){FX.DataCommentPane=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.DataCommentPane.superclass._defaultConfig.apply(this,arguments),{baseCls:"fx_data_comment",perPage:20,dataId:null,appId:null,entryId:null,allowComment:!0,authGroupId:null})},_init:function(){FX.DataCommentPane.superclass._init.apply(this,arguments),this.pageNow=1,this.count=0,this.$main=e('<div class="main-content"/>').appendTo(this.element),this.$wrapper=e('<div class="main-wrapper"/>').appendTo(this.$main),this._fetch(),this._renderFooter()},_fetch:function(t){var i=this,a=this.options,s=e.extend({skip:(this.pageNow-1)*a.perPage,limit:a.perPage,dataId:a.dataId,entryId:a.entryId,appId:a.appId,authGroupId:a.authGroupId},t);FX.Utils.ajax({url:FX.Utils.getApi(FX.API.data.coop_comment_list),data:s},function(e){e.logs&&e.logs.length>0?(i.count+=e.logs.length,i._render(e)):i._renderEmpty(),i.couldLoad=!0})},_render:function(e){var t=this,i=this.options;FX.Utils.forEach(e.logs,function(e,i){t._renderItem(i)}),e.logs.length===i.perPage?this._renderLoadMore():this._removeLoadMore()},_renderEmpty:function(){0===this.count&&e('<div class="empty-box"><div class="box-content"></div><div class="box-text">暂无评论</div></div>').appendTo(this.element)},_renderLoadMore:function(){var t=this,i=e(".load-more-btn",this.element);i&&i.length||(this.couldLoad=!0,e('<div class="load-more-btn">加载更多</div>').on("click",function(){t.couldLoad&&(t.couldLoad=!1,t.pageNow++,t._fetch())}).appendTo(this.$main))},_removeLoadMore:function(){e(".load-more-btn",this.element).remove()},_renderItem:function(t){if(t){t.operator=t.operator||"匿名用户";var i=e('<div class="comment-item"/>').appendTo(this.$wrapper),a=FX.Utils.formatUserThumb(t.operator);a&&e('<div class="content-thumb color-'+a.color+'"/>').text(a.name).appendTo(i);var s=t.mentioned.users,n=t.comment,o="";FX.Utils.forEach(s,function(e,t){var i=FX.Utils.escapeHtmlSpecialChar(t.nickname);o+='<span class="item-style-green">@'+i+"</span>"});var l=e('<div class="item-content"><div class="content-main"></div></div>').appendTo(i);e('<div class="main-info"/>').text(n).appendTo(e(".content-main",l));var r=e('<div class="main-title"/>').append(e("<span/>").text(t.operator)).append(o).append(e('<div class="sub"/>').text(FX.Utils.format2ThumbDate(t.createTime))).prependTo(e(".content-main",l));r.css("padding-right",e(".sub",r).outerWidth(!0))}},_refresh:function(){var t=this.options;this.element.empty(),this.count=0,this.$main=e('<div class="main-content"/>').appendTo(this.element),this.$wrapper=e('<div class="main-wrapper"/>').appendTo(this.$main),this._fetch({skip:0,limit:this.pageNow*t.perPage}),this._renderFooter()},_createComment:function(e){var t=this.options,i=this,a=[];FX.Utils.forEach(this.commentUserMap,function(t,i){var s="@"+i;e.indexOf(s)>=0&&a.push(t)}),FX.Utils.ajax({url:FX.Utils.getApi(FX.API.data.coop_comment_create),data:{dataId:t.dataId,appId:t.appId,entryId:t.entryId,comment:e,authGroupId:t.authGroupId,mentioned:{users:a}}},function(e){i._refresh()})},_renderFooter:function(){var t=this,i=this.options,a=e('<div class="comment-wrapper"/>').appendTo(this.element);if(i.allowComment){this.commentUserMap={},e('<div class="content-tip">发表评论</div>').on("click",function(){var i=e(".content-tip",a);s=e(".comment-footer-content",a),o=e("textarea",s),i.hide(),a.addClass("for-comment"),s.show(),o.focus(),e(t.element).closest(".x-window-mask").on("click.comment",function(n){e(n.target).closest(".comment-wrapper").length||(s.hide(),i.show(),a.removeClass("for-comment"),e(t.element).closest(".x-window-mask").off("click.comment"))})}).appendTo(a);var s=e('<div class="comment-footer-content"/>').appendTo(a);s.hide();var n=e('<div class="content-area"/>').appendTo(s),o=e("<textarea></textarea>").on("keyup",function(){t.pubActive===FX.Utils.isEmpty(e(this).val())&&(t.pubActive=!t.pubActive,r.toggleClass("x-ui-disable",!t.pubActive))}).appendTo(n),l=e('<div class="content-footer"/>').appendTo(s);new FX.UserGroup({renderEl:e('<div class="btn-left"/>').appendTo(l),msg:"@",width:20,height:30,onStopEdit:function(){var i=this.getItems(),a="";FX.Utils.forEach(i,function(e,i){t.commentUserMap[i.id]=i.name,a+="@"+i.name+" "});var s=o.val();o.val(a+s).focus(),a&&r.removeClass("x-ui-disable"),e(".select-list",this.element).html('<div class="select-empty">@</div>'),this.setValue([])}}),this.pubActive=!1;var r=e('<div class="btn-right x-btn style-green x-ui-disable">发送</div>').on("click",function(){var e=o.val();FX.Utils.isEmpty(e)||t._createComment(e)}).appendTo(l)}else e('<div class="not-allowed-tip">回收站中的数据不支持新增评论</div>').appendTo(a)}})}(jQuery),function(e){FX.DataDynamicPane=FX.extend(FX.Widget,{CONST:{TYPE:{create:"创建",update:"修改",remove:"删除",recover:"恢复"}},_defaultConfig:function(){return e.extend(FX.DataDynamicPane.superclass._defaultConfig.apply(),{baseCls:"fx_data_dynamic",perPage:20,dataId:null,appId:null,entryId:null,authGroupId:null})},_init:function(){FX.DataDynamicPane.superclass._init.apply(this,arguments),this.pageNow=1,this.count=0,this.$main=e('<div class="main-content"/>').appendTo(this.element),this.$wrapper=e('<div class="main-wrapper"/>').appendTo(this.$main),this._fetch()},_fetch:function(t){var i=this,a=this.options,s=e.extend({skip:(this.pageNow-1)*a.perPage,limit:a.perPage,dataId:a.dataId,appId:a.appId,entryId:a.entryId,authGroupId:a.authGroupId},t);FX.Utils.ajax({url:FX.Utils.getApi(FX.API.data.coop_log_list),data:s},function(e){e.logs&&e.logs.length>0?(i.count+=e.logs.length,i._render(e)):i._renderEmpty(),i.couldLoad=!0})},_render:function(e){var t=this,i=this.options;FX.Utils.forEach(e.logs,function(e,i){t._createItem(i)}),e.logs.length===i.perPage?this._renderLoadMore():this._removeLoadMore()},_renderEmpty:function(){0===this.count&&e('<div class="empty-box"><div class="box-content"></div><div class="box-text">暂无动态</div></div>').appendTo(this.element)},_renderLoadMore:function(){var t=this,i=e(".btn-more",this.element);i&&i.length||(this.couldLoad=!0,e('<div class="btn-more">加载更多</div>').on("click",function(){t.couldLoad&&(t.couldLoad=!1,t.pageNow++,t._fetch())}).appendTo(this.$main))},_removeLoadMore:function(){e(".btn-more",this.element).remove()},_createItem:function(t){if(t){t.operator=t.operator||"匿名用户";var i=e('<div class="comment-item"/>').appendTo(this.$wrapper),a=FX.Utils.formatUserThumb(t.operator);a&&e('<div class="content-thumb color-'+a.color+'"/>').text(a.name).appendTo(i);var s;s="update"===t.op?this._formatFormData(t):[t.data_label||"（当前数据）"];var n=e('<div class="item-content"/>').append(e('<div class="content-main"/>').append(e('<div class="main-title"/>').text(t.operator).append(e('<span class="sub-info"/>').text(this.CONST.TYPE[t.op]||"")).append(e('<div class="sub-text"/>').text(FX.Utils.format2ThumbDate(t.createTime))))).appendTo(i),o=e('<div class="main-info"/>').appendTo(n);FX.Utils.forEach(s,function(t,i){e('<div class="info-line"/>').text(i).appendTo(o)}),e(".main-title",i).css("padding-right",e(".sub-text",i).outerWidth(!0))}},_formatFormData:function(e){var t=[];return FX.Utils.forEach(e.diff,function(e,i){var a=i.cellFmt&&i.cellFmt.data||i.format,s=i.value,n="";switch(i.type){case"subform":break;case"datetime":(a=a||"yyyy-MM-dd")&&s&&(n=FX.Utils.date2Str(new Date(s),a));break;case"address":a=a||"pcda",n=FX.Utils.address2Str(s,"",a);break;case"location":var o=FX.Utils.formatData({lnglatVisible:!0,type:i.type},s);n=o.address+" "+o.lngLat;break;case"number":a=a||"",n=FX.Utils.num2Str(s,a);break;case"checkboxgroup":case"combocheck":n=s.join(",");break;case"upload":case"image":var l=[];FX.Utils.forEach(s,function(e,t){l.push(t.name)}),n=l.join(",");break;case"signature":break;case"user":case"dept":n=s&&s.name;break;case"usergroup":case"deptgroup":var r=[];FX.Utils.forEach(s,function(e,t){r.push(t.name)}),n=r.join(",");break;case"linkdata":n=s&&s.key;break;default:n=s}var d=[i.label];"subform"!==i.type&&"signature"!==i.type&&d.push(FX.Utils.isEmpty(n)?"「空」":n),t.push(d.join("："))}),t}}),e.shortcut("DataDynamic",FX.DataDynamicPane)}(jQuery),function(e){FX.CoopFormDataPane=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.CoopFormDataPane.superclass._defaultConfig.apply(),{baseCls:"fx-coop-form-data",allowComment:!0,appId:null,authGroupId:null,data:null,dataCount:10,dataId:null,dataIndex:1,editValue:null,form:null,formId:null,isPublicData:!1,publicDataUrlPrefix:"",hasShareBtn:!1,needFetchViewData:!1,hasCustomPrint:!1,hasDeleteBtn:!1,hasEditBtn:!1,hasHeader:!0,hasPrintBtn:!1,hasRecoverBtn:!1,hasSwitchBtn:!1,header:null,height:null,ignoreOptAuth:!1,ignoreValidate:!1,ignoreVisible:!0,layout:null,optAuth:null,title:"",widgetOptAuth:null,onAfterCancel:null,onAfterDeleteData:null,onAfterEditData:null,onAfterLoadData:null,onClose:null,onDeleteData:null,onEditData:null,onRecoverData:null,onSwitchData:null})},_init:function(){var t=this.options,i=this;FX.CoopFormDataPane.superclass._init.apply(this,arguments),t.dataId=t.dataId||t.data._id,this._createHeader(),this.$wrapper=e('<div class="widget-wrapper">').appendTo(this.element),this._fetchViewData(function(){i.showFieldsKey=FX.Store.getKey("formDataShowFields",{appId:FX.STATIC.APPID,entryId:t.formId,groupId:t.authGroupId});var e=FX.Store.get(i.showFieldsKey);i.showFields=t.needFetchViewData?FX.Utils.getShowFieldsByNames(t.header,e):t.header,i._createEditPane(),i._createFormData(),FX.Utils.applyFunc(i,t.onAfterLoadData,[],!1)}),this._createDataLog()},_fetchViewData:function(e){var t=this.options;if(!t.needFetchViewData)return e&&e();FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.view),data:{formId:t.formId,dataId:t.dataId,authGroupId:t.authGroupId}},function(i){t.data=i.data,t.header=i.fields,e&&e()})},_createHeader:function(){var t=this,i=this.options;if(i.hasHeader){var a=e('<div class="preview-title-pane"/>').prependTo(this.element),s=i.data&&i.data.label||"未命名数据";a.append(e('<div class="preview-title"/>').text(s)),i.onClose&&e('<i class="icon-close-normal form-data-exit-icon">').click(function(){t.editFormPane&&t.editFormPane.doClose(),FX.Utils.applyFunc(t,i.onClose,[],!1)}).prependTo(a)}},_createEditPane:function(){var t=this,i=this.options;t._hasEditPane()&&(this.dataMenu=new FX.DataMenu({renderEl:e('<div class="preview-edit-pane"/>').appendTo(this.$wrapper),entryId:i.formId,data:i.data,dataCount:i.dataCount,dataIndex:i.dataIndex,isPublicData:i.isPublicData,publicDataUrlPrefix:i.publicDataUrlPrefix,hasShareBtn:i.hasShareBtn,hasDeleteBtn:i.hasDeleteBtn,hasEditBtn:i.hasEditBtn,hasPrintBtn:i.hasPrintBtn,hasRecoverBtn:i.hasRecoverBtn,hasSwitchBtn:i.hasSwitchBtn,hasShowFieldsBtn:i.needFetchViewData,allFields:i.header,showFields:this.showFields,onDeleteData:function(){FX.Utils.applyFunc(t,i.onDeleteData,[],!1),t._doDeleteData()},onEditData:function(){t._doEditData()},onPrint:function(){t.formData._doPrint()},onRecoverData:i.onRecoverData,onSwitchData:function(a,s,n){e(".x-window-mask",t.element).remove(),n.css({"z-index":FX.STATIC.zIndex++}).appendTo(t.element),t.switchinterval&&clearTimeout(t.switchinterval),t.switchinterval=setTimeout(function(){n.fadeOut(300,function(){FX.Utils.applyFunc(t,i.onSwitchData,[a,s],!1)})},500)},onShowFieldsChange:function(e){FX.Store.set(t.showFieldsKey,e),t.showFields=FX.Utils.getShowFieldsByNames(i.header,e),t.formData.element.remove(),t._createFormData()}}))},_hasEditPane:function(){var e=this.options;return e.hasEditBtn||e.hasDeleteBtn||e.hasSwitchBtn||e.hasPrintBtn||e.hasRecoverBtn||e.hasShareBtn},_createFormData:function(){var t=this.options;this.formData=new FX.FormData({renderEl:e("<div class='x-shadow-content'/>").appendTo(this.$wrapper),authGroupId:t.authGroupId,data:t.data,entryId:t.formId,hasCustomPrint:t.hasCustomPrint,header:this.showFields,ignoreVisible:t.ignoreVisible,layout:t.layout,optAuth:t.optAuth,title:t.title})},_createDataLog:function(){var t=this;this.$logWrapper=e('<div class="log-wrapper"/>').appendTo(this.element);var i=e('<div class="log-menu"/>').append(e('<div class="menu-item select" role="dynamic"/>').text("动态")).append(e('<div class="menu-item" role="comment"/>').text("评论")).appendTo(this.$logWrapper);e('<div class="menu-select-bar"/>').appendTo(i);var a=e('<div class="log-main"/>').appendTo(this.$logWrapper);this.$dataDynamic=e('<div class="main-item"/>').appendTo(a),this.$dataComment=e('<div class="main-item" style="left:100%"/>').appendTo(a),i.on("click",".menu-item",function(i){var a=e(i.currentTarget);if(a.hasClass("select"))return!1;a.addClass("select").siblings().removeClass("select"),t._switchLog(a.attr("role"))}),this._switchLog("dynamic")},_switchLog:function(t){var i=this.options;switch(t){case"dynamic":this.$logWrapper.removeClass("for-second"),this.dataDynamic||(this.dataDynamic=new FX.DataDynamicPane({renderEl:e("<div />").appendTo(this.$dataDynamic),dataId:i.dataId,appId:i.appId,entryId:i.formId,authGroupId:i.authGroupId}));break;case"comment":this.$logWrapper.addClass("for-second"),this.dataComment||(this.dataComment=new FX.DataCommentPane({renderEl:e("<div />").appendTo(this.$dataComment),dataId:i.dataId,appId:i.appId,entryId:i.formId,allowComment:i.allowComment,authGroupId:i.authGroupId}))}},_doEditData:function(){var t=this,i=this.options;this.dataMenu&&this.dataMenu.destroy(),this.dataMenu=null;var a={renderEl:e("<div/>").appendTo(this.$wrapper.empty()),customCls:"more-btn",authGroupId:i.authGroupId,buttonPosition:"middle",dataId:i.dataId,editValue:i.editValue,entryId:i.formId,width:"100%",height:"100%",ignoreOptAuth:i.ignoreOptAuth,ignoreValidate:i.ignoreValidate,mode:"edit",submitData:{dataId:i.dataId},submitText:"修改",submitUrl:FX.Utils.getApi(FX.API.data.update),cancelText:"取消",hasHeader:!1,widgetOptAuth:i.widgetOptAuth||i.optAuth,onSuccess:function(e){t.element.remove(),FX.Utils.applyFunc(t,i.onAfterEditData,[e],!1)},onAfterCancel:function(){t.$wrapper.empty(),t.editFormPane=null,t._createEditPane(),t._createFormData()}};i.form&&(this.editForm=i.form),FX.Utils.isNull(this.editForm)?(this.editForm={},FX.STATIC.DATAID=null,FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.read),data:{formId:i.formId,dataId:i.dataId,authGroupId:i.authGroupId}},function(s){t.editForm=s.form,t.editData={editValue:s.data,widgetOptAuth:i.optAuth||s.optAuth},t.editFormPane=new FX.Form(e.extend({},t.editForm,a,t.editData))})):this.editFormPane=new FX.Form(e.extend({},t.editForm,a,t.editData))},_doDeleteData:function(){var t,i,a=this,s=this.options,n='您当前选中了<span class="text warning">1</span>条数据，';FX.Vip.hasDataBackup()?t=n+"数据删除后可在数据回收站中恢复":(t=n+"免费版删除的数据无法恢复",i=e('<a target="jdy_doc"/>').text("恢复删除数据？了解高级版本").attr("href",FX.CONFIG.HOST.HELP_DOC_HOST+"/9136")),FX.Msg.alert({title:"您确定要删除所选数据吗？",msg:t,tip:i,type:"warning",onOk:function(){FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.remove),data:{formId:s.formId,idList:[s.dataId],authGroupId:s.authGroupId}},function(e){FX.Utils.applyFunc(a,s.onAfterDeleteData,[e.count],!1)})}})},doResize:function(){FX.CoopFormDataPane.superclass.doResize.apply(this,arguments);var e=this.options;FX.Utils.isEmpty(e.height)&&this.element.addClass("relative-height")}}),e.shortcut("CoopFormData",FX.CoopFormDataPane)}(jQuery),function(e){FX.FlowFormDataPane=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.FlowFormDataPane.superclass._defaultConfig.apply(),{baseCls:"fx-flow-form-data",appId:null,authGroupId:null,comments:null,data:null,dataCount:10,dataId:null,dataIndex:1,dataPerms:{},flow:null,formId:null,hasCustomPrint:!1,hasFlow:!0,hasFlowBtn:!0,hasHeader:!0,hasActivateBtn:!1,hasCloseBtn:!1,hasTransferBtn:!1,hasPrintBtn:!1,hasRecoverBtn:!1,hasShareBtn:!1,hasSwitchBtn:!1,header:null,height:null,ignoreOptAuth:!1,ignoreValidate:!1,ignoreVisible:!0,isPrint:!1,layout:null,nodeType:["done","doing","undone"],optAuth:null,title:"",entryName:"",needFetchViewData:!1,onAfterCancel:null,onAfterDeleteData:null,onAfterEditData:null,onAfterFlowChange:null,onAfterLoadData:null,onClose:null,onDeleteData:null,onEditData:null,onFlowNodeClick:null,onRecoverData:null,onSwitchData:null})},_init:function(){var t=this,i=this.options;FX.FlowFormDataPane.superclass._init.apply(this,arguments),i.dataId=i.dataId||i.data._id,this._createHeader(),this.$wrapper=e('<div class="widget-wrapper">').appendTo(this.element),i.hasFlow?this.$logWrapper=e('<div class="log-wrapper"/>').appendTo(this.element):i.flow={},this._hasEditPane()&&(this.$editPane=e('<div class="preview-edit-pane"/>').appendTo(this.$wrapper)),this._createFlowInfo(),i.needFetchViewData?this._fetchViewData(function(){t._initContent()}):this._getFlow(function(){t._initContent()})},_initContent:function(){var e=this.options;this.showFieldsKey=FX.Store.getKey("formDataShowFields",{appId:FX.STATIC.APPID,entryId:e.formId,groupId:e.authGroupId});var t=FX.Store.get(this.showFieldsKey);this.showFields=e.needFetchViewData?FX.Utils.getShowFieldsByNames(e.header,t):e.header,this._createEditPane(),this._createFormData(),this._createFooter(),this.flowInfoPane&&this.flowInfoPane.loadFlowState(e.flow),FX.Utils.applyFunc(self,e.onAfterLoadData,[],!1)},_fetchViewData:function(e){var t=this.options;if(!t.needFetchViewData)return e&&e();FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.view),data:{formId:t.formId,dataId:t.dataId,authGroupId:t.authGroupId}},function(i){t.data=i.data,t.header=i.fields,t.flow=FX.Utils.getFlowOption(i,"part"),e&&e()})},_createHeader:function(){var t=this,i=this.options;if(i.hasHeader){var a=e('<div class="preview-title-pane"/>').prependTo(this.element),s=i.title||i.data&&i.data.label||"未命名数据";a.append(e('<div class="preview-title"/>').text(s)),i.flow&&FX.Utils.isArray(i.flow.flowNodes)&&i.flow.flowNodes.length>1&&"part"===i.flow.flowType&&new FX.FlowNodes({renderEl:e('<div class="flow-nodes"/>').appendTo(a.empty()),title:i.entryName,items:i.flow.flowNodes,currentMenuId:i.flow.flowId,onMenuClick:function(e){FX.Utils.applyFunc(t,i.onFlowNodeClick,[i.formId,i.dataId,e],!1)}}),i.onClose&&e('<i class="icon-close-normal form-data-exit-icon">').click(function(){t.editFormPane&&t.editFormPane.doClose(),FX.Utils.applyFunc(t,i.onClose,[t.stateChanged],!1)}).prependTo(a)}},_createFlowInfo:function(){var e=this.options;e.hasFlow&&(this.element.addClass("has-log"),this.flowInfoPane=new FX.FlowInfoPane({renderEl:this.$logWrapper.empty(),flow:e.flow,data:e.data,entryId:e.formId,authGroupId:e.authGroupId,hasLog:e.hasFlowBtn}))},_createFooter:function(){var t=this,i=this.options;i.hasFooter&&i.flow&&!FX.Utils.isObjectEmpty(i.flow.btn)&&(this.$footer=e('<div class="footer"/>').appendTo(this.$wrapper),new FX.FlowBtn({renderEl:e('<div class="btn-pane"/>').appendTo(this.$footer),flow:i.flow,onSubmit:function(e){"print"!==e?FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.flow_change),data:{appId:FX.STATIC.APPID,entryId:i.formId,formId:i.formId,dataId:i.flow.dataId,flowId:i.flow.flowId,flowAction:e}},function(){FX.Utils.applyFunc(t,i.onClose,[!0],!1)}):t.formData._doPrint(t.flowInfoPane.getFlowLogs())}}))},_createEditPane:function(){var t=this,i=this.options;if(t._hasEditPane()&&t.showFields&&i.flow){var a=FX.CONST.WORKFLOW.FLOWSTATE;FX.Utils.isNull(i.flow.flowState)||([a.COMPLETE,a.CLOSE].indexOf(i.flow.flowState)<0?(i.hasTransferBtn=i.dataPerms.flow_transfer,i.hasCloseBtn=i.dataPerms.flow_close,i.hasActivateBtn=!1):(i.hasActivateBtn=i.dataPerms.flow_activate,i.hasTransferBtn=!1,i.hasCloseBtn=!1)),this.$editPane||(this.$editPane=e('<div class="preview-edit-pane"/>').appendTo(this.$wrapper)),this.dataMenu=new FX.DataMenu({renderEl:this.$editPane.empty(),data:i.data,dataCount:i.dataCount,dataIndex:i.dataIndex,entryId:i.formId,hasShareBtn:i.hasShareBtn,hasDeleteBtn:i.hasDeleteBtn,hasEditBtn:i.hasEditBtn,hasPrintBtn:i.hasPrintBtn,hasRecoverBtn:i.hasRecoverBtn,hasSwitchBtn:i.hasSwitchBtn,hasTransferBtn:i.hasTransferBtn,hasActivateBtn:i.hasActivateBtn,hasCloseBtn:i.hasCloseBtn,hasShowFieldsBtn:i.needFetchViewData,allFields:i.header,showFields:this.showFields,onDeleteData:function(){FX.Utils.applyFunc(t,i.onDeleteData,[],!1),t._doDeleteData()},onEditData:function(){t._doEditData()},onPrint:function(){t.formData._doPrint(t.flowInfoPane&&t.flowInfoPane.getFlowLogs())},onRecoverData:i.onRecoverData,onSwitchData:function(a,s,n){e(".x-window-mask",t.element).remove(),n.css({"z-index":FX.STATIC.zIndex++}).appendTo(t.element),t.switchinterval&&clearTimeout(t.switchinterval),t.switchinterval=setTimeout(function(){n.fadeOut(300,function(){FX.Utils.applyFunc(t,i.onSwitchData,[a,s],!1)})},500)},onTransfer:function(){t._showTransferPane("transfer")},onActivate:function(){t._showTransferPane("activate")},onClose:function(){t._closeFlow()},onShowFieldsChange:function(e){FX.Store.set(t.showFieldsKey,e),t.showFields=FX.Utils.getShowFieldsByNames(i.header,e),t.formData.element.remove(),t._createFormData()}})}},_hasEditPane:function(){var e=this.options;return e.hasEditBtn||e.hasDeleteBtn||e.hasSwitchBtn||e.hasPrintBtn},_createFormData:function(){var t=this.options;this.formData=new FX.FormData({renderEl:e("<div/>").appendTo(this.$wrapper),authGroupId:t.authGroupId,data:t.data,entryId:t.formId,flow:t.flow,hasCustomPrint:t.hasCustomPrint,header:this.showFields,ignoreVisible:t.ignoreVisible,layout:t.layout,optAuth:t.optAuth,title:t.title})},_doEditData:function(){var t=this,i=this.options;this.dataMenu&&this.dataMenu.destroy(),this.dataMenu=null;var a={renderEl:e("<div/>").appendTo(this.$wrapper.empty()),customCls:"more-btn",authGroupId:i.authGroupId,buttonPosition:"middle",dataId:i.dataId,entryId:i.formId,height:"100%",ignoreOptAuth:i.ignoreOptAuth,ignoreValidate:i.ignoreValidate,mode:"edit",submitData:{dataId:i.dataId},submitText:"修改",submitUrl:FX.Utils.getApi(FX.API.data.update),cancelText:"取消",hasHeader:!1,onSuccess:function(e){t.element.remove(),FX.Utils.applyFunc(t,i.onAfterEditData,[e],!1)},onAfterCancel:function(){t.$wrapper.empty(),t.$editPane=null,t.editFormPane=null,t._createEditPane(),t._createFormData()}};FX.Utils.isNull(this.editForm)?(this.editForm={},FX.STATIC.DATAID=null,FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.read),data:{formId:i.formId,dataId:i.dataId,authGroupId:i.authGroupId}},function(s){t.editForm=s.form,t.editData={editValue:s.data,widgetOptAuth:i.optAuth||s.optAuth},t.editFormPane=new FX.Form(e.extend({},t.editForm,a,t.editData))})):this.editFormPane=new FX.Form(e.extend({},t.editForm,a,t.editData))},_doDeleteData:function(){var t,i,a=this.options,s='您当前选中了<span class="text warning">1</span>条数据，';FX.Vip.hasDataBackup()?t=s+"数据删除后可在回收站中恢复":(t=s+"免费版删除的数据无法恢复",i=e('<a target="jdy_doc"/>').text("恢复删除数据？了解高级版本").attr("href",FX.CONFIG.HOST.HELP_DOC_HOST+"/9136")),FX.Msg.alert({title:"您确定要删除所选数据吗？",msg:t,tip:i,type:"warning",onOk:function(){FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.remove),data:{formId:a.formId,idList:[a.dataId],authGroupId:a.authGroupId}},function(e){FX.Utils.applyFunc(self,a.onAfterDeleteData,[e.count],!1)})}})},_closeFlow:function(){var e=this.options,t=this;FX.Msg.alert({msg:"结束流程后数据将停止流转，是否确认结束此流程？",title:"结束流程",onOk:function(){FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.flow_change),data:{flowAction:"close",appId:e.appId,entryId:e.formId,dataId:e.dataId,authGroupId:e.authGroupId}},function(i){t.stateChanged=!0,!1===FX.Utils.applyFunc(t,e.onAfterFlowChange,[],!1)&&t.reload(i)})}})},_showTransferPane:function(t){var i=this.options,a=this,s={};s.url="transfer"===t?i.ignoreOptAuth?FX.Utils.getApi(FX._API.data.flow_chargers):FX.Utils.getApi(FX.API.data.flow_chargers):i.ignoreOptAuth?FX.Utils.getApi(FX._API.data.allow_activate_nodes):FX.Utils.getApi(FX.API.data.allow_activate_nodes),s.data={dataId:i.dataId},i.ignoreOptAuth||(s.data.authGroupId=i.authGroupId),FX.Utils.dataAjax(s,function(s){var n=[],o={},l=[];"transfer"===t?FX.Utils.forEach(s.flowNodes,function(e,t){n.push({value:t.flowId,text:t.name}),o[t.flowId]=t.chargers}):FX.Utils.forEach(s.flowNodes,function(e,t){l.push({value:t.flowId,text:t.name})}),new FX.FlowTransferPane({renderEl:e('<div class="flow-info-pane"/>').appendTo(a.element),chargersMap:o,transactNodes:l,chargeNodes:n,flowState:i.flow.flowState,dataId:i.flow.dataId,authGroupId:i.authGroupId,onAfterClose:function(e){a.stateChanged=!0,!1===FX.Utils.applyFunc(a,i.onAfterFlowChange,[],!1)&&a.reload(e)}})})},_getFlow:function(e){var t=this.options,i=this;if(t.flow)return FX.Utils.applyFunc(i,e,[],!1);FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.read),data:{formId:t.formId,dataId:t.dataId,authGroupId:t.authGroupId}},function(a){t.flow=FX.Utils.getFlowOption(a,"part"),FX.Utils.applyFunc(i,e,[],!1)})},reload:function(t){if(t){var i=this.options,a=this;e.extend(i.data,{flowState:t.data.flowState,chargers:t.data.chargers,updateTime:t.data.updateTime}),a._createFormData(),a._createFlowInfo(),i.flow=FX.Utils.getFlowOption(t,"part"),a._createEditPane(),a._createFooter(),a.flowInfoPane.loadFlowState(i.flow)}},doResize:function(){FX.FlowFormDataPane.superclass.doResize.apply(this,arguments);var e=this.options;FX.Utils.isEmpty(e.height)?this.element.addClass("relative-height"):e.hasFooter&&this.$footer&&this.formData.element.css({bottom:this.$footer.outerHeight()})}}),e.shortcut("FlowFormData",FX.FlowFormDataPane)}(jQuery),function(e){FX.ReportFormDataPane=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.ReportFormDataPane.superclass._defaultConfig.apply(),{baseCls:"fx-report-form-data",appId:null,data:null,dataCount:10,dataId:null,dataIndex:1,entryId:null,formId:null,hasCustomPrint:!1,hasDeleteBtn:!1,hasEditBtn:!1,hasHeader:!0,hasPrintBtn:!1,hasSwitchBtn:!1,header:null,height:null,ignoreVisible:!0,layout:null,title:"",onAfterCancel:null,onAfterDeleteData:null,onAfterEditData:null,onClose:null,onDeleteData:null,onEditData:null,onSwitchData:null})},_init:function(){var t=this.options;FX.ReportFormDataPane.superclass._init.apply(this,arguments),t.dataId=t.dataId||t.data._id,this._createHeader(),this.$wrapper=e('<div class="widget-wrapper">').appendTo(this.element),this._createEditPane(),this._createFormData()},_createHeader:function(){var t=this,i=this.options;if(i.hasHeader){var a=e('<div class="preview-title-pane"/>').prependTo(this.element);a.append(e('<div class="preview-title"/>').text(i.title)),i.onClose&&e('<i class="icon-close-normal form-data-exit-icon">').click(function(){FX.Utils.applyFunc(t,i.onClose,[],!1)}).prependTo(a)}},_createEditPane:function(){var t=this,i=this.options;t._hasEditPane()&&(this.dataMenu=new FX.DataMenu({renderEl:e('<div class="preview-edit-pane"/>').appendTo(this.$wrapper),data:i.data,dataCount:i.dataCount,dataIndex:i.dataIndex,entryId:i.entryId,hasDeleteBtn:i.hasDeleteBtn,hasEditBtn:i.hasEditBtn,hasPrintBtn:i.hasPrintBtn,hasSwitchBtn:i.hasSwitchBtn,onDeleteData:function(){t._doDeleteData()},onEditData:function(){FX.Utils.applyFunc(t,i.onEditData,[],!1),t._doEditData()},onPrint:function(){t.formData._doPrint()},onSwitchData:function(a,s,n){e(".x-window-mask",t.element).remove(),n.css({"z-index":FX.STATIC.zIndex++}).appendTo(t.element),t.switchinterval&&clearTimeout(t.switchinterval),t.switchinterval=setTimeout(function(){n.fadeOut(300,function(){FX.Utils.applyFunc(t,i.onSwitchData,[a,s],!1)})},500)}}))},_hasEditPane:function(){var e=this.options;return e.hasEditBtn||e.hasDeleteBtn||e.hasSwitchBtn||e.hasPrintBtn},_createFormData:function(){var t=this.options;this.formData=new FX.FormData({renderEl:e("<div class='x-shadow-content'/>").appendTo(this.$wrapper),authGroupId:t.authGroupId,data:t.data,entryId:t.entryId,hasCustomPrint:t.hasCustomPrint,header:t.header,ignoreVisible:t.ignoreVisible,layout:t.layout,title:t.title})},_doEditData:function(){var t=this,i=this.options;this.dataMenu&&this.dataMenu.destroy(),this.dataMenu=null;var a=e('<div class="x-window-mask modal light"/>').css({"z-index":FX.STATIC.zIndex++}).appendTo("body");FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.read),data:{formId:i.formId,dataId:i.dataId}},function(s){new FX.Form(e.extend(s.form,{renderEl:e("<div class='x-shadow-content'/>").appendTo(a),customCls:"more-btn",buttonPosition:"middle",dataId:i.dataId,editValue:s.data,entryId:i.entryId,height:"100%",mode:"edit",submitData:{dataId:i.dataId},submitText:"修改",submitUrl:FX.Utils.getApi(FX.API.data.update),title:s.formName,widgetOptAuth:s.optAuth,onSuccess:function(e){a.remove(),t.element.remove(),FX.Utils.applyFunc(t,i.onAfterEditData,[e],!1)},onAfterCancel:function(){a.remove(),FX.Utils.applyFunc(t,i.onAfterCancel,[],!1)}}))})},_doDeleteData:function(){var t,i,a=this,s=this.options,n='您当前选中了<span class="text warning">1</span>条数据，';FX.Vip.hasDataBackup()?t=n+"数据删除后可在回收站中恢复":(t=n+"免费版删除的数据无法恢复",i=e('<a target="jdy_doc"/>').text("恢复删除数据？了解高级版本").attr("href",FX.CONFIG.HOST.HELP_DOC_HOST+"/9136")),FX.Msg.alert({title:"您确定要删除所选数据吗？",msg:t,tip:i,type:"warning",onOk:function(){FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.remove),data:{formId:s.entryId,idList:[s.dataId]}},function(e){FX.Utils.applyFunc(a,s.onAfterDeleteData,[e.count],!1)})}})},doResize:function(){FX.ReportFormDataPane.superclass.doResize.apply(this,arguments);var e=this.options;FX.Utils.isEmpty(e.height)&&this.element.addClass("relative-height")}}),e.shortcut("ReportFormData",FX.ReportFormDataPane)}(jQuery),function(e){FX.ShareUrlPane=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.ShareUrlPane.superclass._defaultConfig.apply(this,arguments),{baseCls:"fx_share_url",url:"",hasCopy:!0,hasOpen:!0,hasQrcode:!0})},_init:function(){FX.ShareUrlPane.superclass._init.apply(this,arguments),this.url=this.options.url,this._createShareContent()},_createShareContent:function(){var t=this.options,i=this;this.editComp=new FX.TextEditor({renderEl:e('<div class="url-wrapper"/>').appendTo(this.element),enable:!1,height:28,value:this.url});var a=e('<div class="btn-wrapper"/>').appendTo(this.element);t.hasCopy&&e('<div class="btn copy">复制</div>').click(function(){FX.Utils.copyToClipboard(i.url,function(){FX.Msg.toast({type:"success",msg:"链接已复制"})})}).appendTo(a),t.hasOpen&&(this.$open=e('<a class="btn open" target="_blank">打开</a>').attr("href",this.url).attr("title","打开链接").appendTo(a)),t.hasQrcode&&(this.$qrcode=e('<div class="btn qr-code"/>').append(FX.Utils.createQrcodeBtn(this.url)).appendTo(a))},setUrl:function(e){this.url=e,this.editComp.setValue(this.url),this.$open&&this.$open.attr("href",this.url),this.$qrcode&&this.$qrcode.empty().append(FX.Utils.createQrcodeBtn(this.url))}}),e.shortcut("shareurlpane",FX.ShareUrlPane)}(jQuery),function(e){FX.MenuTree=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.MenuTree.superclass._defaultConfig.apply(this,arguments),{baseCls:"fs-menutree",nodes:[],indent:0,onNodeClick:null,onNodeCreate:null,onNodeExpand:null,onNodeCollapse:null,onDisplayNodes:null})},_init:function(){FX.MenuTree.superclass._init.apply(this,arguments);var e={type:"group",child:this.options.nodes,level:0};this.expandNode(e,null,this.element),this._bindEvts()},_bindEvts:function(){var t=this,i=function(i){var a=i.target,s=e(a).closest("a.menutree-node");if(s&&s.length>0){var n=i.type;if("mouseover"===n)s.addClass("fui-seb fui-fht");else if("mouseout"===n)s.hasClass("select")||s.removeClass("fui-seb fui-fht");else if("click"===n){var o=s.data("NODE");t.clickNode(o,s)}}};this.element.bind("mouseover",i).bind("mouseout",i).bind("click",i)},createIconFont:function(t){return e("<i/>").addClass(t).addClass("entry-icon")},_onNodeCreate:function(t,i){var a=this.options,s=e('<a class="menutree-node"/>').data("NODE",t).attr("data-id",t.id);return!1===FX.Utils.applyFunc(this,a.onNodeCreate,[t,s,i],!1)?"group"===t.type?(s.addClass("fs-menu-item").attr("title",t.text).appendTo(i),this.createIconFont("icon-tree-group").appendTo(s),e('<span class="menutree-text"/>').text(t.text).appendTo(s)):this._isGroupNode(t)?(s.addClass("fs-menu-item").attr("title",t.text).appendTo(i),this.createIconFont(t.icon).appendTo(s),e('<span class="menutree-text"/>').text(t.text).appendTo(s)):(s.addClass("fs-menu-item menutree-child").attr("title",t.text).appendTo(i),a.indent&&s.css({"padding-left":(t.level-1)*a.indent+20}),e('<i class="tree-icon"/>').addClass("icon-tree-leaf "+t.icon).appendTo(s),e('<span class="menutree-text"/>').text(t.text).appendTo(s)):i.remove(),s},_isGroupNode:function(e){return"group"===e.type||"refApp"===e.type||"etlTable"===e.type},clickNode:function(e,t){var i=this.options,a=t.parent("li");!1===FX.Utils.applyFunc(this,i.onNodeClick,[e,t,a],!1)&&(this.selectNode(t),this._isGroupNode(e)&&(e.isexpand?this.collapseNode(e,t,a):this.expandNode(e,t,a)))},selectNode:function(t){e(".fs-menu-item.select",this.element).removeClass("select fui-seb fui-fht"),t.addClass("select fui-seb fui-fht")},expandNode:function(t,i,a){var s=this,n=this.options;t.level;if(!1===FX.Utils.applyFunc(this,n.onNodeExpand,[t,i,a],!1)&&this._isGroupNode(t)){if(t.isLoaded)a.children("ul").slideDown("fast");else{var o=e("<ul/>").appendTo(a);FX.Utils.forEach(t.child,function(i,a){a.level=t.level+1,a.parent=t;var n=e("<li/>").appendTo(o),l=s._onNodeCreate(a,n);a.isexpand&&s.expandNode(a,l,n)}),t.isLoaded=!0}a.addClass("group-open")}t.isexpand=!0,FX.Utils.applyFunc(this,n.onAfterNodeExpand,[t,i,a],!1)},collapseNode:function(e,t,i){var a=this.options;!1===FX.Utils.applyFunc(this,a.onNodeCollapse,[e,t,i],!1)&&(i.children("ul").slideUp("fast"),i.removeClass("group-open")),e.isexpand=!1},loadNode:function(t,i){var a=this,s=this.options,n=e('a[data-id="'+t+'"]',this.element);0===n.length&&FX.Utils.forEach(s.nodes,function(i,s){a._isGroupNode(s)&&FX.Utils.forEach(s.child,function(i,o){if(o.id===t){var l=e('a[data-id="'+s.id+'"]',a.element);return a.expandNode(l.data("NODE"),l,l.closest("li")),n=e('a[data-id="'+t+'"]',a.element),!1}})}),this.selectNode(n);var o=n.data("NODE");return FX.Utils.applyFunc(a,i,[o,n],!1),n}})}(jQuery),function(e){FX.Platform=FX.extend(FX.Widget,{CONSTS:{},THEME:{config4frame:{resizable:!0,north:{visible:!0},south:{visible:!1},east:{}},config4Gallery:{region:null},config4MenuTree:{region:"west"},config4tabPane:{style:"alpha",region:"east",isCollapsible:!1,hasHomepageBtn:!0}},_defaultConfig:function(){return e.extend(FX.Platform.superclass._defaultConfig.apply(),{baseCls:"fui_platform",appId:"",onMenuSelect:null,cacheEnable:!1,onAfterLoad:null,onLoadFail:null})},_init:function(){FX.Platform.superclass._init.apply(this,arguments);var e=this.options;FX.STATIC.APPID=e.appId,this._initFrame(this.THEME.config4frame),this._initMenu()},_initMenu:function(){var e=this,t=this.options;FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.app.get,FX.STATIC.APPID)},function(i){FX.Vip.showUpgradeTip(i.bufferState,!0),e.isOwner=i.isOwner,e.entryMap=i.entryMap,e.treeNodes=e._sortEntryList(i.entryList,e.entryMap),e.appName=i.name,FX.Utils.setPageTitle(e.appName),e._initEmptyTip(),e._initMenuTree(e.THEME.config4MenuTree),FX.Utils.applyFunc(e,t.onAfterLoad,[i.name,i.isAppManager],!1)},function(i){var a=i.responseJSON||{};FX.Utils.applyFunc(e,t.onLoadFail,[a],!1)})},_initFrame:function(){this.$body=e('<div class="fs-frame-body"/>').appendTo(this.element),this.$menu=e('<div class="fs-frame-menu"/>').appendTo(this.$body),this.$content=e('<div class="fs-frame-content"/>').appendTo(this.$body),this.CONSTS.Regions={west:this.$menu,east:this.$content}},_initEmptyTip:function(){var t='<div class="content-empty"><div class="empty-img"/><div class="empty-title">这里什么都没有</div>';this.isOwner?t+="<span>请打开「应用编辑」，添加表单和报表</span>":t+="<span>请联系贵司「简道云」管理员，将表单/报表并共享给您</span>",e(t+="</div>").appendTo(this.$content)},_sortEntryList:function(e,t){return e.sort(function(e,i){var a=t[e.id]&&t[e.id].seq,s=t[i.id]&&t[i.id].seq;if(a!==s)return a-s;var n=t[e.id]&&t[e.id].entryId,o=t[i.id]&&t[i.id].entryId,l=0;return n>o?l=1:n<o&&(l=-1),l}),e},_initMenuTree:function(t){if(!FX.Utils.isEmpty(t.region)){var i=this,a=this.CONSTS.Regions[t.region],s=this.options,n=e('<div class="fs-frame-scroll"/>').appendTo(a);this.menu=new FX.MenuTree(e.extend({renderEl:e("<div/>").appendTo(n),indent:20,nodes:i.treeNodes,onNodeClick:function(e,t){return FX.Utils.applyFunc(i,s.onMenuSelect,[e],!0)&&(e&&"flow"===e.type?i.loadContentByFlow(e,t):i.loadContentByEntry(e)),!1},onNodeCreate:function(t){switch(e.extend(t,i.entryMap[t.id]),t.type){case"flow":t.icon="icon-"+t.type+"-"+t.id;break;case"form":t.icon=t.hasCoop?"icon-form":"icon-form-flow";break;default:t.icon="icon-"+t.type}return i.selectedNode||(t.child&&t.child.length>0?t.isexpand=!0:i.selectedNode=t),!1},onAfterNodeExpand:function(t,a,s){"flowManage"===t.id&&i._loadFlowTodoCount(function(t){var a=e('a[data-id="todo"]',s);e(".flow-count",a).remove(),t>0&&a.append(e('<div class="flow-count"/>').text(i._formatFlowCount(t)))})}},t)),i.selectedNode?i.loadNode(i.selectedNode.id,i.selectedNode.type):e(".content-empty").show()}},_loadFlowTodoCount:function(e){var t=this,i=this.options;FX.Utils.ajax({url:FX.Utils.getApi(FX.API.flow.query_data_count,i.appId),data:{type:"todo"}},function(i){FX.Utils.applyFunc(t,e,[i.count],!1)})},loadNode:function(e,t){var i=this;this.treeNodes?this.menu.loadNode(e,function(e,a){e&&("flow"===t?i.loadContentByFlow(e,a):i.loadContentByEntry(e),FX.Utils.setPageTitle([e.text,i.appName].join("-")))}):this.selectedNode={id:e,type:t}},loadContentByFlow:function(t,i){var a=this;this.$content.empty(),this._createHeader(t),this.flowList=new FX.FlowListPane({renderEl:e('<div class="flow-pane"/>').appendTo(this.$content),itemsPerPage:20,listType:t.id,loadMoreTrigger:"scroll",listStyle:"line-list",onAsyncSuccess:function(s,n){var o=e(".filter-num",a.$header),l=a._formatFlowCount(this.totalCount),r=a._formatFlowCount(s.count);"todo"===t.id&&(i.children(".flow-count").remove(),i.append(e('<div class="flow-count"/>').text(this.totalCount>0?l:""))),n?o.text("（筛选出"+r+"条 / 共"+l+"条）"):o.text("（共"+l+"条）")}})},_formatFlowCount:function(e){return e<=FX.CONST.MAX_TODO_COUNT?e+"":FX.CONST.MAX_TODO_COUNT+"+"},loadContentByEntry:function(t){var i=this,a=this.options;if(t&&"group"!==t.type){var s=t.type,n=FX.STATIC.APPID;"group"!==s&&(this.$content.empty(),new FX.EntryView({renderEl:e("<div/>").appendTo(this.$content),appId:n,entryId:t.entryId,entryType:s,hasBreadCrumb:!0,hasEntryTitle:!1,hasQrCode:!1,cacheEnable:a.cacheEnable,onToggleMenu:function(e){i.element.toggleClass("hide-menu",e)},publicDataUrlPrefix:FX.CONFIG.HOST.SITE_SHORT_HOST+"/l/"+t._id}))}},_createHeader:function(t){var i=this;this.$header=e('<div class="header"/>').appendTo(this.$content);var a=!1;this.$sidebar=e('<div class="sidebar-container"/>').append(e('<div class="icon-container"><i class="icon-sidebar"/></div>').on("click",function(){a=!a,i.element.toggleClass("hide-menu",a)}).hover(function(){FX.UI.showPopover({anchor:e(this),content:e("<span/>").text(a?"显示目录":"隐藏目录"),type:"dark"})},function(){FX.UI.closePopover()})).append(e("<span/>").text(t.text)).appendTo(this.$header),e('<span class="filter-num"/>').appendTo(this.$sidebar),"part"!==t.id&&(this.$sortPane=null,e('<a class="flow-operation-btn sort"><i class="operation-icon icon-sort-flow"/><span class="operation-text sort-state">最新</span></a>').click(function(a){i._showSortSwitchPane(e(a.currentTarget),t.id)}).prependTo(this.$header)),this.flowFilterPane=null,e('<a class="flow-operation-btn filter"><i class="operation-icon icon-filter-o"/><span class="operation-text">筛选条件</span></a>').click(function(a){i._showFlowFilter(e(a.currentTarget),t.id)}).prependTo(this.$header)},_showFlowFilter:function(e,t){var i=this;this.flowFilterPane?this.flowFilterPane.show():this.flowFilterPane=new FX.FilterWrapperPane({anchor:e,hasRelation:!1,hasFlowFilters:!0,flowType:t,selectPaneEmptyTip:"请先选择当前节点",text4add:"添加字段筛选条件",onStopEdit:function(t){t.cond.length>0?e.addClass("active"):e.removeClass("active"),i.flowList.options.filter=t,i.flowList.rebuild()}})},_getFilterValueKey:function(e){var t=this.options;return FX.Store.getKey("filterValue",{appId:t.appId,ext:e})},_getFilterValue:function(e){var t={cond:[],rel:FX.CONST.FILTER_RELATION.AND};return FX.Store.get(this._getFilterValueKey(e))||t},_showSortSwitchPane:function(t,i){var a=this;if(!this.$sortPane){this.$sortPane=e('<div class="flow-sort-pane"/>').click(function(t){var i=e(t.target).closest(".sort-item");if(i.length>0){e(".select",a.$sortPane).removeClass("select"),i.addClass("select"),a.bubble&&a.bubble.close();var s=i.data("item");e(".sort-state",a.header).text(s.text.slice(0,2)),a.flowList.options.sort=s.value,a.flowList.rebuild()}});var s=[];switch(i){case"todo":s.push({text:"最新的待办",value:{updateTime:-1},select:!0},{text:"最早的待办",value:{updateTime:1}});break;case"create":s.push({text:"最新发起的",value:{createTime:-1},select:!0},{text:"最早发起的",value:{createTime:1}})}FX.Utils.forEach(s,function(t,i){var s=i.select?"select":"";e('<div class="sort-item + '+s+'"><span class="sort-text">'+i.text+'</span><i class="sort-icon icon-ok"/>').data("item",i).appendTo(a.$sortPane)})}this.bubble=FX.Msg.bubble({anchor:t,contentHTML:a.$sortPane,minWidth:120,hasTriangle:!1,hAdjust:90,contentPadding:0,text4Cancel:null,text4Ok:null,onClose:function(){return a.$sortPane.detach(),!1}})}})}(jQuery),function(e){FX.EntryView=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.EntryView.superclass._defaultConfig.apply(),{baseCls:"fui-entry-view",appId:"",entryId:"",entryType:"",mode:"platform",teamLinkUrl:"",cacheEnable:!1,onToggleMenu:null,publicDataUrlPrefix:""})},_init:function(){FX.Platform.superclass._init.apply(this,arguments);var e=this,t=this.options;FX.Utils.dataAjax({url:FX.Utils.getApi(this._getUrl(),t.appId,t.entryId)},function(t){e.data=t,FX.STATIC.APPID=t.entry&&t.entry.appId,e._initEntryView()})},_getUrl:function(){var e="";switch(this.options.entryType){case"report":e=FX.API.report.get;break;case"dash":e=FX.API.dash.get;break;default:e=FX.API.form.get}return e},_initEntryView:function(){this.$view=this.element,this._createHeader(),this._createContent()},_createHeader:function(){var t=this,i=this.options,a=this.data.entry;if(this.$header=e('<div class="header"/>').appendTo(this.$view),"teamlink"===i.mode){this.$header.addClass("team-link-header");var s,n=e('<div class="title"/>').text(a.name).appendTo(this.$header);switch(this._getEntryType()){case"coop":s="icon-form";break;case"flow":s="icon-form-flow";break;case"report":s="icon-report";break;case"dash":s="icon-dash"}n.prepend(e("<i class="+s+"/>"));var o=e('<div class="qrcode-btn"/>').append('<i class="icon-qrcode"/>').click(function(){var t=e('<div class="qrcode-dropdown"/>');e("<img/>").attr("src","/qrcode?u="+encodeURIComponent(i.teamLinkUrl)).appendTo(t),e("<div/>").text("扫描二维码，分享给好友").appendTo(t),FX.Msg.bubble({anchor:o,text4Ok:null,text4Cancel:null,contentHTML:t,minWidth:150,dockPosition:"right"})}).prependTo(this.$header)}else{var l=!1;e('<div class="sidebar-container"/>').append(e('<div class="icon-container"><i class="icon-sidebar"/></div>').on("click",function(){l=!l,FX.Utils.applyFunc(t,i.onToggleMenu,[l],!1),t.content&&t.content.doResize(null,!0)}).hover(function(){FX.UI.showPopover({anchor:e(this),content:e("<span/>").text(l?"显示目录":"隐藏目录"),type:"dark"})},function(){FX.UI.closePopover()})).append(e("<span/>").text(a.name)).prependTo(this.$header)}},_createContent:function(){var t=this.options;this.$entryContent=e('<div class="entry-content"/>').appendTo(this.$view),"teamlink"===t.mode&&this.$entryContent.addClass("team-link-content");var i=this.data.entry;switch(i.type){case"form":this._createFormViewSelector(e.extend({},i,{flowConf:this.data.flow}),this.data.authGroups);break;case"report":var a=e('<div class="scroll-layer">').appendTo(this.$entryContent),s=i.content;this.content=new FX.Report(e.extend(s,{renderEl:e('<div class="report scrollable"/>').appendTo(a),appId:i.appId,entryId:i.entryId,width:"100%",height:"100%",hasLazyLoad:!0}));break;case"dash":this.content=new FX.Dash(e.extend(i,{renderEl:e('<div class="dash"/>').appendTo(this.$entryContent),appId:i.appId,entryId:i.entryId,width:"100%",height:"100%",hasLazyLoad:!0}))}},_createFormViewSelector:function(t,i){var a=this;if(FX.Utils.isObjectEmpty(i))this._createFormView(t);else{var s={},n=[];FX.Utils.forEach(i,function(e,t){t.groupId>=0&&n.push({text:t.name,value:t.groupId}),s[t.groupId]=t});var o=[],l=t.hasCoop?FX.CONST.AUTH_GROUP_CONTENT:FX.CONST.FLOW_AUTH_GROUP_CONTENT;FX.Utils.forEach(l,function(e,t){var i=s[t.groupId];FX.Utils.isNull(i)||o.push({text:i.name,value:i.groupId})});var r=(n=o.concat(n))[0].value,d=FX.Store.getKey("authGroup",{appId:FX.STATIC.APPID,entryId:t.entryId}),c=FX.Store.get(d);FX.Utils.isNull(c)||(s[c]?r=c:FX.Store.remove(d)),a._setFormView(r,s,t),n.length<=1&&FX.CONST.AUTH_GROUP.SUBMIT===r||new FX.ComboBox({renderEl:e('<div class="form-view-selector"/>').prependTo(this.$header),allowBlank:!1,width:162,items:n,value:r,onAfterItemSelect:function(){var e=this.getValue();a._setFormView(e,s,t),FX.Store.set(d,e)}})}},_setFormView:function(t,i,a){var s=this,n=this.options;switch(t){case FX.CONST.AUTH_GROUP.SUBMIT:this.form=s._createFormView(a,t);break;default:var o=i[t];if(!o)return;this._removeStashRecord(),this.form&&this.form.saveFormData();var l=FX.Store.getKey("showFields",{appId:FX.STATIC.APPID,entryId:a.entryId,groupId:t}),r=FX.Store.getKey("metaFields",{appId:FX.STATIC.APPID,entryId:a.entryId,groupId:t});this.content=new FX.DataManagePane({renderEl:e('<div class="data-manage"/>').appendTo(s.$entryContent.empty()),appId:a.appId,entryId:a.entryId,formName:a.name,formItems:a.content.items,formAttr:{submitRule:a.content.submitRule,layout:a.content.layout,validators:a.content.validators,updateTime:a.updateTime},hasExtParams:a.hasExtParams,hasCoop:a.hasCoop,dataPerms:o.dataPerms,optAuth:o.optAuth,authGroupId:t,isPublicData:a.isPublicData,publicDataUrlPrefix:n.publicDataUrlPrefix,showFields:FX.Store.get(l),showFieldsMeta:FX.Store.get(r),cacheEnable:n.cacheEnable&&a.hasCache,onDataFieldSelect:function(e){FX.Store.set(l,e)},onDataFieldMetaChange:function(e){FX.Store.set(r,e)}})}},_createFormView:function(t,i){var a=this,s=this.options;FX.STATIC.ENTRYID=t.entryId;var n={},o=!FX.Utils.isEmpty(t.flow&&t.flow.flowVer);t.hasFlow&&o&&(n.forward={text:FX.Utils.getFlowActionText("forward",t.flowConf)},t.flowConf.allowSave&&(n.save={text:FX.Utils.getFlowActionText("save",t.flowConf)}),t.hasFlowPrint&&(n.print={text:FX.Utils.getFlowActionText("print",t.flowConf)}),this._createStashRecord(t));var l={renderEl:e('<div class="form"/>').appendTo(this.$entryContent.empty()),appId:t.appId,entryId:t.entryId,authGroupId:i,cacheEnable:s.cacheEnable&&t.hasCache,updateTime:t.updateTime,width:"100%",height:"100%",hasHeader:!1,flow:FX.Utils.isObjectEmpty(n)?null:{btn:n},submitText:"提交",buttonPosition:"left",onSuccess:function(e,s,n){a.$entryContent.empty(),e&&e.flowFailureCode?a._createFormView(t,i):a.showSuccessInfo(a.$entryContent,e,s,function(){a._createFormView(t,i)}),n&&a._showFormPrint(e.data)}};return"teamlink"===s.mode?(e.extend(l,{width:780,height:null,buttonPosition:"middle"}),FX.Vip.showDataLimitTip({renderEl:e("<div/>").insertBefore(this.$entryContent),customCls:"data-limit-tip team-link-tip"})):FX.Vip.showDataLimitTip({msg:FX.CONST.DATA_LIMIT_TIP.ACCOUNT,renderEl:e("<div/>").prependTo(this.$entryContent),customCls:"data-limit-tip"}),this.content=new FX.Form(e.extend(t.content,l)),this.content},_showFormPrint:function(t){var i=FX.Utils.createMask(e("body"),{isLight:!0,isModal:!0});new FX.FormEditPane({renderEl:e('<div class="x-shadow-content"/>').appendTo(i),height:"100%",dataId:t._id,entryId:t.entryId,flowType:"print",flowId:0,hasFlowBtn:!1,onCancel:function(){i.remove()}})},_getEntryType:function(){var e=this.data.entry;if(e){return"form"===e.type?e.hasCoop?"coop":"flow":"dash"===e.type?"dash":"report"}},_removeStashRecord:function(){this.$stashRecord&&this.$stashRecord.remove()},_createStashRecord:function(t){var i=this;this.options.cacheEnable&&t.hasFlow&&FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.flow.stash_data_count,t.appId)},function(a){if(i._removeStashRecord(),!(a.count<=0)){var s=FX.STATIC.ENTRYID;i.$stashRecord=e('<div class="stash-record" />').append(e("<span />").text("暂存")).append(e('<span class="stash-count"/>').text(a.count)).on("click",function(){var e=new FX.Slider({contentWidth:350,title:"暂存记录",position:"right",autoClose:!0,onClose:function(){FX.STATIC.ENTRYID=s,i._createStashRecord(t)},contentWidget:{type:"flowlistpane",entryId:t.entryId,itemsPerPage:10,listType:"stash",loadMoreTrigger:"click",listStyle:"card-list",onAsyncSuccess:function(t){t.count<=0&&e.close()}}});e.show()}).prependTo(i.$header)}})},showSuccessInfo:function(t,i,a,s){var n,o=this;i&&i.data&&(n=i.data.submitPrompt);var l=e('<div class="success-wrapper"/>').appendTo(t),r=e('<div class="success-pane"/>').appendTo(l);if(n&&"custom"===n.mode)r.addClass("custom-pane x-subhtml").html(n.content);else{var d="提交成功",c="data-create-success-icon";a&&"forward"!==a&&(d="操作成功",c="data-update-success-icon"),e("<div/>").append(e('<i class="'+c+'"/>')).appendTo(r),e('<div class="msg-title"/>').text(d).appendTo(r),FX.Utils.isEmpty(i.check_msg)||e("<div>"+i.check_msg+"</div>").appendTo(r)}if(s&&(!n||n&&("custom"===n.mode&&n.hasAddBtn||"system"===n.mode))){var u=e('<div class="button-pane"/>').appendTo(r);new FX.Button({renderEl:e("<div />").appendTo(u),text:"继续添加",width:120,style:"green",onClick:function(){FX.Utils.applyFunc(o,s,[],!1)}})}}})}(jQuery),function(e){FX.FormPrint=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.FormPrint.superclass._defaultConfig.apply(),{baseCls:"fx_system_print_pane",title:"",header:[],data:{},comments:null,layout:null,MAX_SUBFORM_COLS:7})},_init:function(){FX.FormPrint.superclass._init.apply(this,arguments);var t=this,i=this.options,a=i.header,s=["creator","createTime","updateTime"];this.systemFields=s,this._createMetaInfo(),this._appendTable(),this._setCursor(e("<tr />").appendTo(this.$table),e("<tr />").appendTo(this.$table),0),FX.Utils.forEach(a,function(e,a){if(a.widget&&(a=FX.Utils.getFieldAttr(a)),a&&s.indexOf(a.name)<0){var n=a.tag||a.name;t._dealWidget(a,i.data[n])}}),this._appendComments(i.comments),this._processLastRow()},_createMetaInfo:function(){var t=this.options,i=t.data,a=this.systemFields;e('<div class="print-title"/>').text(t.title).appendTo(this.element);var s=e('<div class="print-info" />').appendTo(this.element),n=0;FX.Utils.forEach(a,function(a,o){var l;if(FX.Utils.forEach(t.header,function(e,t){if(t.name===o)return l=t,!1}),l){var r=l.tag||l.name,d=i[r];e('<div class="info-item" />').append(e('<span class="info-label" />').text(l.text)).append(e('<span class="info-text" />').text(d)).appendTo(s),n++}}),s.addClass("with-item-"+n)},_dealWidget:function(t,i){var a=this;if(this._isWidgetValid(t))switch(t.type){case"linkdata":FX.Utils.forEach(t.linkFields,function(e,t){a._dealWidget(t,i&&i[t.name])});break;case"subform":this._appendSubform(t,i);break;case"chargers":this._appendChargers(t,i);break;default:var s=e("<td />").text(t.text),n=this._createDataCell(t,i);this._appendWidget(s,n,t.name)}},_appendWidget:function(t,i,a){var s=this.options.layout,n=this.$table,o=this.cursor;s?12===s[a]?(o.colspan<4&&this._processLastRow(),this._appendWidget2NewRow(t,i,4)):o.colspan<=2?(o.$tr1.append(t.attr("colspan",2)),o.$tr2.append(i.attr("colspan",2)),o.colspan+=2):this._appendWidget2NewRow(t,i,2):e("<tr />").append(t.attr("colspan",1)).append(i.attr("colspan",3)).appendTo(n)},_appendWidget2NewRow:function(t,i,a){var s=this.cursor,n=this.$table;s.$tr1=e("<tr />").appendTo(n),s.$tr2=e("<tr />").appendTo(n),s.$tr1.append(t.attr("colspan",a)),s.$tr2.append(i.attr("colspan",a)),s.colspan=a},_createDataCell:function(t,i){var a=e("<td />").attr("colspan",1);switch(t.type){case"image":case"upload":case"signature":i&&new FX.FileUpload({renderEl:a,mode:"print",files:e.makeArray(i),enable:!1});break;case"textarea":i&&a.append(e("<pre />").text(i));break;case"location":i&&a.text(i.address+" "+i.lngLat);break;default:FX.Utils.isNull(i)&&(i=""),a.text(i)}return a},_isWidgetValid:function(e){return["formula","flowState","chargers"].indexOf(e.type)>-1||(FX.Utils.isValueWidget(e.type)||e.isJoined||/_join_/.test(e.name))},_appendSubform:function(t,i){var a,s=this,n=this.options;this._processLastRow();var o=[];FX.Utils.forEach(t.items,function(t,a){"linkdata"===a.type?(FX.Utils.forEach(a.linkFields,function(e,t){o.push(t)}),FX.Utils.forEach(i,function(t,i){e.extend(i,i[a.name])})):o.push(a)});var l=s._chunkSubform(o);FX.Utils.forEach(l,function(l,r){var d=s._appendTable(!0);if(0===l){var c=Math.min(o.length,n.MAX_SUBFORM_COLS);e("<tr />").append(e('<td class="print-center" />').attr("colspan",c).text(t.text)).appendTo(d)}var u=e("<tr />").appendTo(d);FX.Utils.forEach(r,function(t,i){u.append(e("<td />").text(i.text))}),FX.Utils.forEach(i,function(t,i){a=e("<tr />").appendTo(d),FX.Utils.forEach(r,function(e,t){var n=s._createDataCell(t,i[t.name]);a.append(n)})})}),this._appendTable(),this._setCursor(e("<tr />").appendTo(this.$table),e("<tr />").appendTo(this.$table),0)},_chunkSubform:function(e){var t=[],i=FX.Utils.chunkArray(e,14);return FX.Utils.forEach(i,function(e,i){i.length<=7?t.push(i):i.length<=11?(t.push(i.splice(0,i.length-4)),t.push(i)):(t.push(i.splice(0,7)),t.push(i))}),t},_appendTable:function(t){return this.$table=e("<table />").appendTo(this.element),t||this.$table.addClass("print-body"),this.$table},_appendChargers:function(t,i){var a={},s={},n=[],o=[];FX.Utils.forEach(i,function(e,t){a[t.userNickname]=!0,s[t.flowName]=!0}),FX.Utils.forEach(a,function(e){n.push(e)}),FX.Utils.forEach(s,function(e){o.push(e)}),this._appendWidget(e("<td />").text("当前节点"),e("<td />").text(o.join(", "))),this._appendWidget(e("<td />").text("当前负责人"),e("<td />").text(n.join(", ")))},_appendComments:function(t){var i=this,a=!1;i._processLastRow(),FX.Utils.forEach(t,function(t,s){if(s.comment){a||(e("<div>审批意见</div>").appendTo(i.element),i._appendTable(!0),a=!0);var n=FX.Utils.resolveUsername(s.operator)+" ("+FX.Utils.date2Str(new Date(s.createTime),"yyyy-MM-dd HH:mm")+")："+s.comment;e("<tr />").append(e('<td class="comment-label"/>').text(s.flowName)).append(e('<td class="comment-text"/>').text(n)).appendTo(i.$table)}})},_processLastRow:function(){var t,i=this.cursor,a=i.$tr1.find("td"),s=i.$tr2.find("td");if(a.length){t=e(a[a.length-1]);var n=parseInt(t.attr("colspan")||1)+(4-i.colspan);t.attr("colspan",n),(t=e(s[s.length-1])).attr("colspan",n),i.colspan=4}},_setCursor:function(e,t,i){this.cursor={$tr1:e,$tr2:t,colspan:i}}})}(jQuery),function(e){FX.ManageTablePane=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.ManageTablePane.superclass._defaultConfig.apply(),{baseCls:"fx_manage_table",appId:"",entryId:"",formId:"",isAdmin:!1,title:"",dataPerms:{},itemPrintable:!0,isPublicData:!1,publicDataUrlPrefix:"",hasShareBtn:!1,hasRecoverBtn:!1,hasCoop:!1,dataEditable:!0,hasHeader:!0,resizable:!0,itemsPerPage:20,optAuth:null,fields:[],formLayout:{},showFields:[],availableParamFields:[],showFieldsMeta:{},authGroupId:null,height4Head:50,height:"100%",asyncURL:FX.Utils.getApi(FX.API.data.find),cls4FullScreen:"block-fullscreen",tableClass:"main-table",needStickyHead:!0,hasTotalCount:!0,needFetchViewData:!1,onAfterShowFieldsSelected:null,onAfterShowFieldsMetaChange:null,onRecoverData:null,allowDataView:!0})},_init:function(){FX.ManageTablePane.superclass._init.apply(this,arguments);var t=this.options;this.sort=[],this.page=0,this.count=null,this.itemsPerPage=this._getItemsPerPage(),this.isBackUp=!FX.Utils.isNull(t.onRecoverData),FX.Utils.isObjectEmpty(t.filterParam)?this.filter=FX.Utils.getValidFilters(this._getFilterValue()):this.filter=t.filterParam,t.needStickyHead&&this.element.addClass("has-sticky-head");var i=e('<div class="table-wrapper"/>').appendTo(this.element);t.hasHeader&&(this.element.addClass("has-header"),this._createHead().appendTo(i));var a=e('<div class="manage-table-body"/>').appendTo(i);this.$wrapper=e('<div class="fui_table-wrapper has-menu"/>').appendTo(a),this.$menu=e('<div class="fui-table-menu"/>').appendTo(a),this._initDataTable(),this._setEvent()},_getItemsPerPageKey:function(){var e=this.options,t={appId:e.appId,entryId:e.formId};return FX.Utils.isNull(e.authGroupId)||(t.groupId=e.authGroupId),this.isBackUp&&(t.ext="dataRecycle"),FX.Store.getKey("itemsPerPage",t)},_getItemsPerPage:function(){var e=FX.Store.get(this._getItemsPerPageKey());return FX.Utils.isNull(e)&&(e=this.options.itemsPerPage),e},_createHead:function(){var t=this.options;return this.$head=e('<div class="manage-table-head"/>').height(t.height4Head).css({"line-height":t.height4Head+"px"}),FX.Utils.applyFunc(this,t.onAfterHeadCreate,[this.$head],!1),this.$head},createLoadingMask:function(){return FX.Utils.createMask(this.$wrapper,{hasLoader:!0,isLight:!0})},_initDataTable:function(e){var t=this,i=this.options;FX.Utils.isObjectEmpty(e)||(this.filter=e),this.hasTotalCount=this.filter&&!FX.Utils.isObjectEmpty(this.filter.cond)&&i.hasTotalCount,this._loadData(function(){t.createTable()})},createTable:function(){var t=this,i=this.options;this.headRowCount=this._getHeadRowCount();var a=this._dealHeader(this.header);if(this.tableHead=a.tableHead,this.cols=a.cols,this.fieldTypeMap=a.fieldTypeMap,this._createTableData(),i.resizable&&this._initColumnResizer(),this.$tableScroller=e('<div class="table-scroller"/>').scroll(function(){t._scrollStickyHead()}).appendTo(this.$wrapper),this.$table=e('<table cellpadding="0" cellspacing="0" class="'+i.tableClass+' x-table-bordered x-table-striped t-main"/>').appendTo(this.$tableScroller),this.tableHead.length>0){var s=e('<thead class="t-head"/>').appendTo(this.$table);FX.Utils.forEach(this.tableHead,function(i,a){var n=e('<tr class="t-row th-row"/>').appendTo(s);FX.Utils.forEach(a,function(e,i){t._createCell(i,{tag:"th",cls:"th-cell"}).appendTo(n)})})}this.$tableBody=e('<tbody class="t-body"/>').appendTo(this.$table),this._appendTableData(),this._createStickyHead(),this._loadCount(function(){t._createPagination(),0===t.totalCount&&i.isAdmin&&t._createEmpty().appendTo(t.$tableScroller)})},_loadData:function(e){var t=this,i=this.options;if(!this.isLoading){this.isLoading=!0;var a=this.createLoadingMask();FX.Utils.dataAjax({url:i.asyncURL,data:{fields:i.fields,sort:this.sort,skip:this.page*this.itemsPerPage,limit:this.itemsPerPage,filter:this.filter,authGroupId:i.authGroupId,entryId:i.entryId,appId:i.appId}},function(i){t.header=i.header,t.data=i.data,FX.Utils.applyFunc(t,e,[],!1)},null,function(){t.isLoading=!1,a.remove()})}},_getHeadRowCount:function(){var e=1;return FX.Utils.forEach(this.header,function(t,i){if("subform"===i.type)return e=2,!1}),e},_dealHeader:function(e){for(var t=this,i=this.options,a=[],s=[],n={},o=0;o<this.headRowCount;o++)a.push([]);return this.hasCheck&&(a[0].push({rowspan:this.headRowCount,cls:"table-op-btn-cell group-head",html:'<div class="x-check table-op-btn"><i class="icon-blank"/></div>'}),s.push({field:"_rowCheck"}),n._rowCheck="_rowCheck"),FX.Utils.forEach(e,function(e,i){if(i&&!i.detailOnly){var o=t._getFieldName(i);n[o]=i.type,"subform"===i.type?(i.items&&i.items.length&&a[0].push({text:i.text,colspan:i.items.length,cls:"combined-col"}),FX.Utils.forEach(i.items,function(e,i){var l=[o,t._getFieldName(i)].join(".");n[l]=i.type,a[1]=a[1].concat(t._createHeadCell(i,t.headRowCount,o)),s=s.concat(t._createHeadCol(i,o))})):(a[0]=a[0].concat(t._createHeadCell(i,t.headRowCount)),s=s.concat(t._createHeadCol(i)))}}),i.resizable&&a[0].push({rowspan:t.headRowCount,cls:"blank-cell"}),{tableHead:a,cols:s,fieldTypeMap:n}},_createHeadCell:function(t,i,a){this.options;var s=this._getFieldName(t),n={text:t.text,cls:t.type+"-col",data:{}};a?s=[a,s].join("."):n.rowspan=i,n.data.field=s,n.data.resizeCol=s,n.width=this._getColumnSize(t);var o;FX.Utils.forEach(this.sort,function(e,t){t[s]&&(o=t[s])}),o&&(o===FX.CONST.SORT.ASC?n.cls+=" sort sort-asc":n.cls+=" sort sort-desc"),!a&&FX.LimitFields.sort.indexOf(t.type)>-1&&"creator"!==t.name&&"label"!==t.name&&(n.cls+=" clickable sortable"),"label"===t.name&&(n.cls+=" group-head");var l=[];return"chargers"===t.type?(l.push(e.extend({},n,{text:"当前节点"})),l.push(e.extend({},n,{text:"当前负责人"}))):l.push(n),l},_createHeadCol:function(e,t){var i=this._getFieldName(e),a={};t?(a.field=t,a.subField=i):a.field=i,a.format=e.cellFmt&&e.cellFmt.data||e.format,e.regex&&(a.regex=e.regex),"linkdata"===e.type&&(a.linkType=e.linkType);var s=[];return"chargers"===e.type?(s.push({show:"node",field:i}),s.push({show:"user",field:i})):s.push(a),s},_appendTableData:function(){var t=this;this.options.resizable&&FX.Utils.forEach(this.tableData,function(e,t){t.push({cls:"blank-cell"})}),FX.Utils.forEach(this.tableData,function(i,a){var s=i%2==0?"odd":"even",n=e('<tr class="t-row tb-row"/>').addClass(s).appendTo(t.$tableBody);t._bindRowData(t.$tableBody,n,i),FX.Utils.forEach(t.tableRowHead,function(e,a){var s=a[i];s&&t._createCell(s,{tag:"th",cls:"rh-cell"}).appendTo(n)}),FX.Utils.forEach(a,function(e,a){a.row=i,a.col=e,t._createCell(a,{tag:"td",cls:"td-cell"}).appendTo(n)})})},_createTableData:function(){var e=this;this.options;this.tableData=[],this.dataMap=[],this.tableRowHead=[];var t=[],i=[];FX.Utils.forEach(this.data,function(a,s){for(var n=[],o=e._calculateDataRowCount(s),l=0;l<o;l++)n.push([]);FX.Utils.forEach(e.cols,function(a,l){var r=e._createCellData(s,l,!1);if("label"===l.field)return r.rowspan=o,t.push(r),void(t.length+=o-1);switch(e.fieldTypeMap[l.field]){case"subform":var d=s[l.field];FX.Utils.isObjectEmpty(d)&&(d=[{}]);for(var c=0;c<o;c++){var u=d[c],h=e._createCellData(u,l,!0);n[c].push(h)}break;case"_rowCheck":r.rowspan=o,i.push(r),i.length+=o-1;break;default:r.rowspan=o,n[0].push(r)}}),s&&FX.Utils.forEach(n,function(){e.dataMap.push(a)}),e.tableData=e.tableData.concat(n)}),this.tableRowHead.push(i),this.tableRowHead.push(t)},_calculateDataRowCount:function(e){var t=this,i=[1];for(FX.Utils.forEach(e,function(e,a){a&&"subform"===t.fieldTypeMap[e]&&i.push(a.length||1)});i.length>=2;)i.push(Math.max(i.pop(),i.pop()));return i[0]},_createCellData:function(t,i,a){var s,n;if(FX.Utils.isNull(t))return{text:""};a?(s=t[i.subField],n=this.fieldTypeMap[i.field+"."+i.subField]):(s=t[i.field],n=this.fieldTypeMap[i.field]);var o={text:""};switch(n){case"checkboxgroup":case"combocheck":case"array":o={text:FX.Utils.isNull(s)?"":s.join(", ")};break;case"text":if(i.regex&&new RegExp(i.regex).test(s)){var l=FX.CONST.TEXT_TYPE_REGEXP;i.regex===l.email&&(o={html:'<a href="mailto:'+s+'">'+s+"</a>"})}o=!s||FX.Utils.isString(s)?{html:e("<span />").append(FX.Utils.replaceURL(s))}:{text:s.name||""};break;case"radiogroup":case"combo":o={text:FX.Utils.isNull(s)?"":s};break;case"user":case"dept":o=!s||FX.Utils.isString(s)?{text:s||""}:{text:s.name||""};break;case"usergroup":case"deptgroup":var r=[];FX.Utils.forEach(s,function(e,t){!t||FX.Utils.isString(t)?r.push(t||""):r.push(t.name)}),o={text:r.join(",")};break;case"number":case"formula":var d=FX.Utils.fixDecimalPrecision(s);o={text:FX.Utils.num2Str(d,i.format)};break;case"address":case"location":var c=[];s&&(s.province&&(c.push(s.province),s.city&&s.province!==s.city&&c.push(s.city),s.district&&c.push(s.district)),s.detail&&c.push(s.detail)),o={text:FX.Utils.address2Str(s,c.join(""),i.format)};break;case"textarea":o={html:s?e("<pre/>").append(FX.Utils.replaceURL(s)):""};break;case"datetime":s&&(o={text:FX.Utils.date2Str(new Date(s),i.format)});break;case"_rowCheck":o={cls:"table-op-btn-cell",html:e('<div class="x-check table-op-btn"/>').append(e('<i class="icon-blank"/>')).data({op:"remove_check",dataId:t._id})};break;case"image":case"upload":case"signature":var u=e('<a class="table-op-btn table-file-btn"/>').data("file",s);FX.Utils.isObjectEmpty(s)?u.text(""):u.text("查看").data("op","file"),o={html:u};break;case"linkdata":var h=s&&s.key;if(!h)break;"datetime"===i.linkType&&(h=FX.Utils.date2Str(new Date(h),"yyyy-MM-dd")),o={text:h};break;case"flowState":var p=FX.CONST.WORKFLOW.FLOWSTATE;s===p.INPROCESS?o={text:"进行中"}:s===p.COMPLETE?o={text:"流转完成"}:s===p.CLOSE&&(o={text:"手动结束"});break;case"chargers":var f={},m={};FX.Utils.forEach(s,function(e,t){t.flowName&&(f[t.flowName]||(f[t.flowName]=!0),m[t.userNickname]||(m[t.userNickname]=!0))});var g=[];"node"===i.show?FX.Utils.forEach(f,function(e){g.push(e)}):FX.Utils.forEach(m,function(e){g.push(e)}),o={text:g.join(",")}}return o},rebuildStickyHead:function(){if(this.$stickyHead){var e=this.$stickyHead.attr("class");this.$stickyHead.parent().remove()}if(this.$stickyRowHead){var t=this.$stickyRowHead.attr("class");this.$stickyRowHead.parent().remove()}if(this.$stickyIntersect){var i=this.$stickyIntersect.attr("class");this.$stickyIntersect.parent().remove()}this._createStickyHead(),this.$stickyHead&&this.$stickyHead.addClass(e),this.$stickyRowHead&&this.$stickyRowHead.addClass(t),this.$stickyIntersect&&this.$stickyIntersect.addClass(i)},getSortedFieldIdx:function(e){var t=-1;return FX.Utils.forEach(this.sort,function(i,a){if(a)return a[e]?(t=i,!1):void 0}),t},_getFieldName:function(e){return e.tag||e.name},_initColumnResizer:function(){var t=this,i=this.options;this.$columnResizerLine||(this.$columnResizerLine=e('<div class="column-resizer-line"/>').appendTo(this.element)),this.$columnResizer||(this.$columnResizer=e('<div class="column-resizer"/>').appendTo(this.element)),this.element.unbind("mouseover.resize"),this.element.bind("mouseover.resize",function(i){if(!t.pressed){var a=e(i.target).closest(".th-cell");if(a.length&&a.data("resizeCol")&&!a.hasClass("combined-col")){t.$currentTH=a;var s=a.offset();t.$columnResizer.css({left:s.left+a.outerWidth()-t.$columnResizer.outerWidth(),top:s.top,height:a.height()})}}}),this.element.unbind("mousedown.resize"),this.element.on("mousedown.resize",function(a){var s=e(a.target);if(s.hasClass("column-resizer")){t.element.addClass("unselectable"),t.pressed=!0;var n=t.$currentTH,o=s.offset(),l=t.element.offset();t.$columnResizerLine.css({left:o.left+10,top:l.top+i.height4Head,height:t.element.height()-2*i.height4Head}).addClass("active"),t.startLeft=o.left,t.currentField=n.data("resizeCol"),t.startX=a.pageX,t.startWidth=parseInt(n.outerWidth())}}),this.element.unbind("mousemove.resize"),this.element.on("mousemove.resize",function(e){if(t.pressed){var i=Math.max(e.pageX,t.startLeft-t.startWidth+45);return t.$columnResizerLine.css({left:i}),t.$columnResizer.css({left:i-5}),!1}}),this.element.unbind("mouseup.resize"),this.element.on("mouseup.resize",function(a){if(t.element.removeClass("unselectable"),t.$columnResizerLine.removeClass("active"),t.pressed&&(t.pressed=!1,t.$columnResizerLine.removeClass("active"),t.$currentTH&&t.currentField)){var s=t.$currentTH.offset();t.columnSizeMap[t.currentField]=Math.max(t.startWidth+a.pageX-t.startX,35),t.$columnResizer.css({left:s.left+t.$currentTH.outerWidth()-10});var n=t.$currentTH.parent("tr")[0].rowIndex,o=t.$currentTH[0].cellIndex;e(t.$table[0].rows[n].cells[o]).css({"min-width":t.columnSizeMap[t.currentField],width:t.columnSizeMap[t.currentField]}).children(".content").children(".data").css("width",t.columnSizeMap[t.currentField]),t.currentField=null,t.rebuildStickyHead(),t._initColumnResizer(),t.$table.scroll(),FX.Utils.applyFunc(t,i.onAfterShowFieldsMetaChange,[t.columnSizeMap],!1)}})},_getColumnSize:function(e,t){var i=this.options;if(!this.columnSizeMap){var a={};FX.Utils.forEach(i.showFieldsMeta,function(e,t){a[e]=t.width}),this.columnSizeMap=a}var s=e.name;e.subform&&(s=[e.subform,s].join(".")),FX.Utils.isNumber(t)&&(s=[s,t].join("#"));var n=this.columnSizeMap[s];if(n)return n;switch(e.type){case"textarea":case"address":case"location":n=300;break;case"image":case"upload":case"signature":n=100;break;case"usergroup":case"deptgroup":n=250;break;case"combocheck":case"checkboxgroup":n=FX.Utils.isNumber(t)?100:300;break;default:n=150}return n},_createCell:function(t,i){this.options;var a=i||{tag:"td"};a.cls&&t.cls&&(t.cls=a.cls+" "+t.cls);var s=e.extend(a,t.text||t.html||!FX.Utils.isString(t)?t:{text:t}),n=e("<"+s.tag+' class="t-cell"/>');n.attr({row:s.row,col:s.col}),n.css({"min-width":s.width||t.width,width:s.width||t.width,height:s.height||t.height});var o=e('<div class="data"/>').appendTo(e('<div class="content"/>').appendTo(n)).css("width",s.width||t.width);switch(s.hasOwnProperty("html")?o.html(s.html).attr("title",e(s.html).text()):o.text(s.text).attr("title",s.text),s.align){case"center":n.addClass("h-center");break;case"right":n.addClass("h-right")}if(s.data)for(var l in s.data)s.data.hasOwnProperty(l)&&n.data(l,s.data[l]);return s.cls&&n.addClass(s.cls),s.colspan&&n.attr("colspan",s.colspan),s.rowspan&&n.attr("rowspan",s.rowspan),n},_loadCount:function(e){var t=this,i=this.options;FX.Utils.isNull(this.count)?FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.count),data:{appId:i.appId,entryId:i.entryId,authGroupId:i.authGroupId,filter:this.filter,hasLimit:!0,hasTotalCount:this.hasTotalCount&&FX.Utils.isNull(this.totalCount)}},function(i){t.count=i.count,t.hasTotalCount?FX.Utils.isNull(t.totalCount)&&(t.totalCount=i.totalCount):t.totalCount=i.count,FX.Utils.applyFunc(t,e,[],!1)}):FX.Utils.applyFunc(t,e,[],!1)},_createPagination:function(){var t=this,i=this.options;new FX.DataCountPane({renderEl:e("<div />").appendTo(this.$menu),itemsPerPage:this.itemsPerPage,count:this.count,hasTotalCount:this.hasTotalCount,totalCount:this.totalCount,async:{url:FX.Utils.getApi(FX.API.data.count),data:{filter:this.filter,authGroupId:i.authGroupId,hasLimit:!1}},onItemPerPageChange:function(e){t.itemsPerPage=e,FX.Store.set(t._getItemsPerPageKey(),e),t.page=0,t.reload(t.filter)}});var a=this.data&&this.data.length>=this.itemsPerPage;new FX.Pagination({renderEl:e("<div />").appendTo(this.$menu),count:this.count,limit:this.itemsPerPage,curPage:this.page+1,maxCount:FX.CONST.MAX_COUNT,hasMore:a,onChangePage:function(e){t.page=e-1,t.turnPage()}})},_createEmpty:function(){var t=this.options,i=e('<div class="empty-wrapper"/>');e('<div class="empty-img"/>').appendTo(i),e('<div class="empty-tip"/>').text("暂无数据，你可以将表单发布给团队成员或公开发布来搜集数据").appendTo(i);var a=e('<div class="pub-btn"/>').appendTo(i);return FX.Utils.applyFunc(this,t.onCreateEntryShare,[a],!1),i},_isDataEditable:function(){var e=this.options;return e.hasCoop?e.dataEditable&&!1!==e.dataPerms.update:e.dataEditable&&!1!==e.dataPerms.flow_update},_doShowData:function(t,i){var a=this.data[t];if(a){var s=this.options,n=this,o=a._id,l=this.header;this._switchCurrentRow(t);var r=e('<div class="x-window-mask modal light scrollable"/>').css({"z-index":FX.STATIC.zIndex++}).appendTo("body");e(document).bind("keydown.left keydown.right",function(t){if(e(".x-window-mask","body").length)return t.preventDefault(),!1;e(document).unbind("keydown.left keydown.right")}),s.formDataConfig={appId:s.appId,renderEl:e("<div class='x-shadow-content'/>").appendTo(r),formId:s.formId,authGroupId:s.authGroupId,header:l,layout:s.formLayout,data:a,dataId:o,dataPerms:s.dataPerms,height:"100%",optAuth:s.optAuth,hasPrintBtn:s.itemPrintable,hasEditBtn:this._isDataEditable(),hasDeleteBtn:s.dataEditable&&!1!==s.dataPerms.delete,hasRecoverBtn:s.hasRecoverBtn,hasShareBtn:s.hasShareBtn,hasSwitchBtn:!0,hasCustomPrint:s.isAdmin||s.authGroupId,dataIndex:t+1,dataCount:n.data.length,ignoreOptAuth:s.isAdmin,ignoreValidate:s.isAdmin,title:s.title,needFetchViewData:s.needFetchViewData,onRecoverData:function(e,t){FX.Utils.applyFunc(n,s.onRecoverData,[e,t,r],!1)},onAfterLoadData:function(){i&&n.formData._doEditData()},onAfterEditData:function(e){r.remove();n._reloadWithoutCount(n.filter,!0),(s.isAdmin||s.authGroupId)&&(n._updateTableData(t,e.data),n._doShowData(t))},onSwitchData:function(e,t){n.data[e-1]&&r.parent().length&&(r.remove(),n._doShowData(e-1,t))},onAfterDeleteData:function(e){n.updateTotalCount(-1*e),n.reload(),r.remove()},onAfterCancel:function(){r.remove(),n._doShowData(t)},onClose:function(e){if(r.remove(),e){n.reload(this.filter,!0)}}},this.formData=n._createFormDataPane()}},_switchCurrentRow:function(t){e("tbody > tr",this.element).removeClass("current-row"),e('tbody > tr[data-idx="'+t+'"]',this.element).addClass("current-row")},_createFormDataPane:function(){var t=this.options;return t.hasCoop?(e.extend(t.formDataConfig,{allowComment:t.dataEditable,isPublicData:t.isPublicData,publicDataUrlPrefix:t.publicDataUrlPrefix}),new FX.CoopFormDataPane(t.formDataConfig)):(e.extend(t.formDataConfig,{hasFlow:!t.hasRecoverBtn,flow:t.flow,onFlowNodeClick:t.onFlowNodeClick}),new FX.FlowFormDataPane(t.formDataConfig))},_updateTableData:function(t,i){var a=this.options;if(this.data[t]){var s={};FX.Utils.forEach(a.fields,function(e,t){switch(t.type){case"user":case"dept":FX.Utils.isObjectEmpty(i[t.name])?s[t.name]=i[t.name]:s[t.name]=i[t.name].name;break;case"usergroup":case"deptgroup":var a=[];FX.Utils.forEach(i[t.name],function(e,t){a.push(t.name)}),s[t.name]=a;break;default:"creator"!==t.name||FX.Utils.isObjectEmpty(i[t.name])?s[t.name]=i[t.name]:s[t.name]=i[t.name].name}}),e.extend(this.data[t],s)}},_setEvent:function(){var t=this,i=this.options;this.$wrapper.unbind(".data-table"),this.$wrapper.bind({"click.data-table":function(a){var s=a.target,n=a.type,o=e(s).closest("tr");if(o&&o.length>0)if(o.hasClass("th-row")){var l=e(s).closest(".th-cell");if(l&&l.length>0&&"click"===n){var r=l.data("field");if(r){if(!l.hasClass("sortable"))return;var d={},c=-1;l.hasClass("sort-asc")?(l.removeClass("sort-asc").addClass("sort-desc"),d[r]=-1,(c=t.getSortedFieldIdx(r))>-1?t.sort[c]=d:t.sort.push(d)):l.hasClass("sort-desc")?(l.removeClass("sort sort-desc"),(c=t.getSortedFieldIdx(r))>-1&&t.sort.splice(c,1)):(l.removeClass("sort-desc").addClass("sort sort-asc"),c=t.getSortedFieldIdx(r),d[r]=1,c>-1?t.sort[c]=d:t.sort.push(d)),t.page=0,t._reloadWithoutCount()}var u=l.find(".x-check");u&&u.length>0&&(u.toggleClass("select"),u.hasClass("select")?t.setRemoveCheckResult(!0):t.setRemoveCheckResult(!1))}}else if(o.hasClass("tb-row")){var h=e(s).closest(".table-op-btn");if("click"===n)if(h&&h.length>0){var p=h.data("op");if("remove_check"===p)h.hasClass("select")&&t.setRemoveCheckSelectAll(!1),h.toggleClass("select");else if("file"===p){var f=h.data("file");FX.Utils.dt(FX.CONST.TRACKER.FILE_PREVIEW),new FX.FilePreview({files:e.makeArray(f)})}}else{if(!FX.Utils.isEmpty(FX.Utils.getSelectionText()))return;if(e(s).closest(".nest-link").length)return;i.allowDataView&&t._doShowData(parseInt(o.attr("data-idx")))}}},"mouseover.data-table":function(i){var a=e(i.target).closest("tr").attr("data-idx");FX.Utils.isNull(a)||e('tbody > tr[data-idx="'+a+'"]',t.element).addClass("hover")},"mouseout.data-table":function(i){var a=e(i.target).closest("tr").attr("data-idx");FX.Utils.isNull(a)||e('tbody > tr[data-idx="'+a+'"]',t.element).removeClass("hover")}})},_bindRowData:function(e,t,i){if(this.dataMap&&this.dataMap.length>i){var a=this.dataMap[i];t.attr("data-idx",a)}},turnPage:function(){this._removeTable(),this._initDataTable()},reload:function(e,t,i){this._removeTable(),t||(this.page=0),i||(this.count=null),this._initDataTable(e)},updateTotalCount:function(e){this.totalCount=this.totalCount||0,this.totalCount+=e},_reloadWithoutCount:function(e,t){this.reload(e,t,!0)},doResize:function(e){FX.ManageTablePane.superclass.doResize.apply(this,arguments),this.$table&&(this.$stickyHead&&this.$stickyHead.parent().remove(),this.$stickyRowHead&&this.$stickyRowHead.parent().remove(),this.$stickyIntersect&&this.$stickyIntersect.parent().remove(),this._createStickyHead(),this._scrollStickyHead())},refresh:function(){this.tableRowHead=[],this._removeTable(),this.createTable()},setHasCheck:function(e){this.hasCheck=e},setRemoveCheckSelectAll:function(e){e||this.$stickyRowHead.children(".t-head").find(".x-check").removeClass("select")},setRemoveCheckResult:function(t){t?this.$stickyRowHead.find(".x-check").each(function(t,i){e(i).addClass("select")}):this.$stickyRowHead.find(".x-check").each(function(t,i){e(i).removeClass("select")})},getCheckResult:function(){var t=[];return this.$stickyRowHead.find(".t-body .x-check").each(function(i,a){e(a).hasClass("select")&&t.push(e(a).data("dataId"))}),t},getFilterData:function(){return this.filter},createHeadTools:function(){var t=this,i=this.options,a="全屏",s=e("<a />").append('<i class="icon-enlarge">');t.element.hasClass(i.cls4FullScreen)&&(s=e("<a />").append('<i class="icon-shrink">'),a="缩小"),this.fieldItems||(this.fieldItems=this._getShowFieldItems()),s.appendTo(this.$head).click(function(){t.doFullScreen()?(s.children("i").removeClass().addClass("icon-shrink"),a="缩小"):(s.children("i").removeClass().addClass("icon-enlarge"),a="全屏")}).hover(function(){FX.UI.showPopover({position:"bottomLeft",anchor:e(this).children("i"),content:e("<span/>").text(a),type:"dark"})},function(){FX.UI.closePopover()}),e('<div class="separator-vertical"/>').appendTo(this.$head);var n=e('<a class="data-config-btn"/>').append('<i class="icon-page-view">').append(e("<span />").text("显示字段")).appendTo(this.$head).click(function(){t.doShowFields(n)});n.toggleClass("active",!this._isAllFieldsShow()),this._setFilterSticky(this._isFilterSticky(),!0)},_isFilterSticky:function(){var e=this.options;if(!this.filterStickyKey){var t={appId:e.appId,entryId:e.formId};FX.Utils.isNull(e.authGroupId)||(t.groupId=e.authGroupId),this.isBackUp&&(t.ext="dataRecycle"),this.filterStickyKey=FX.Store.getKey("filterSticky",t)}return FX.Store.get(this.filterStickyKey)},_getFilterValue:function(){var e=this.options;if(!this.filterValueKey){var t={appId:e.appId,entryId:e.formId};FX.Utils.isNull(e.authGroupId)||(t.groupId=e.authGroupId),this.isBackUp&&(t.ext="dataRecycle"),this.filterValueKey=FX.Store.getKey("filterValue",t)}var i={cond:[],rel:FX.CONST.FILTER_RELATION.AND};return this.isBackUp&&(i.cond.push({entryId:e.formId,field:"deleter",type:"user"}),i.cond.push({entryId:e.formId,field:"deleteTime",type:"datetime"})),FX.Store.get(this.filterValueKey)||i},_setFilterSticky:function(t,i){var a=this;this.options;if(this.filterPane&&(this.filterPane.destroy(),this.filterPane=null,i&&FX.Store.set(this.filterStickyKey,t)),t){this.element.addClass("has-sticky-filter");var s=e(".filter-wrapper",this.element);s.length||(s=e('<div class="filter-wrapper"/>').appendTo(this.element)),this.filterPane=this._createFilterPane({renderEl:s,sticky:t,onStopEdit:function(e){FX.Store.set(a.filterValueKey,e),a.reload(FX.Utils.getValidFilters(e))}})}else{this.element.removeClass("has-sticky-filter");var n=e(".filter-btn",this.$head);n.length||(n=e('<a class="data-config-btn filter-btn"/>').append(e('<i class="icon-filter-o"/>')).append(e("<span />").text("筛选条件")).appendTo(this.$head).on("click",function(t){a._showFieldFilter(e(t.currentTarget))}));var o=this._getFilterValue();FX.Utils.isObjectEmpty(FX.Utils.getValidFilters(o).cond)?n.removeClass("active"):n.addClass("active")}this.$stickyHead&&this.rebuildStickyHead()},_createFilterPane:function(t){var i=this,a=this.options,s=this._getFilterValue(),n=e.extend({formId:a.formId,fields:s.cond,relation:s.rel,availableFields:a.availableParamFields,authGroupId:a.authGroupId,hasPinBtn:!0,onPin:function(e){i._setFilterSticky(e,!0)}},t);return new FX.FilterWrapperPane(n)},_isAllFieldsShow:function(){var e=!0;return FX.Utils.forEach(this.fieldItems,function(t,i){if(!i.selected)return e=!1,!1}),e},_showFieldFilter:function(e){var t=this,i=this.options;this.filterPane?this.filterPane.show():this.filterPane=this._createFilterPane({anchor:e,sticky:!1,hasPinBtn:!this.element.hasClass(i.cls4FullScreen),onStopEdit:function(i){var a=FX.Utils.getValidFilters(i);a.cond.length>0?e.addClass("active"):e.removeClass("active"),FX.Store.set(t.filterValueKey,i),t.reload(a)}})},deleteCheckResult:function(t,i,a){var s,n,o=this,l=this.options;FX.Vip.hasDataBackup()?s=t?"您当前选中了全部数据，数据删除后可在回收站中恢复":'您当前选中了<span class="text warning" >'+i+"</span>条数据，数据删除后可在回收站中恢复":(s=t?"您当前选中了全部数据，免费版删除的数据无法恢复":'您当前选中了<span class="text warning" >'+i+"</span>条数据，免费版删除的数据无法恢复",n=e('<a target="jdy_doc"/>').text("恢复删除数据？了解高级版本").attr("href",FX.CONFIG.HOST.HELP_DOC_HOST+"/9136")),FX.Msg.alert({title:t?"您确定要清空所有数据吗？":"您确定要删除所选数据吗？",msg:s,tip:n,type:"warning",onOk:function(){var e={formId:l.formId,authGroupId:l.authGroupId},i=!0;if(t)e.clearAll=!0,e.filter=o.filter;else{var s=o.getCheckResult();s&&s.length>0?e.idList=s:i=!1}i&&FX.Utils.dataAjax({url:FX.Utils.getApi(FX.API.data.remove),data:e},function(e){!1===FX.Utils.applyFunc(o,a,[e.count],!1)&&(o.setHasCheck(!1),o.createHeadTools(),o.reload())})}})},_getShowFieldItems:function(){var e=this.options;return FX.Utils.getShowFieldItems(e.fields,e.showFields)},_createStickyHead:function(){var t=this,i=this.options;i.needStickyHead&&(this.$stickyHead=e('<table cellpadding="0" cellspacing="0" class="'+i.tableClass+' x-table-bordered x-table-striped"/>').append(this.$table.children(".t-head").clone(!0)).outerWidth(this.$table.outerWidth()),this.$stickyHead.find(".t-head .th-cell").each(function(i,a){var s=t.$table.find(".t-head .th-cell").eq(i);e(a).outerWidth(s.outerWidth())}),e('<div class="table-sticky-head"/>').css({width:this.$tableScroller[0].clientWidth}).append(this.$stickyHead).appendTo(this.$wrapper),this.$stickyRowHead=e('<table cellpadding="0" cellspacing="0" class="'+i.tableClass+' x-table-bordered x-table-striped"/>').append(this.$table.children(".t-head, .t-body").clone(!0)),this.$stickyRowHead.find(".t-head .th-cell").each(function(i,a){var s=t.$table.find(".t-head .th-cell").eq(i);e(a).outerWidth(s.outerWidth())}),this.$stickyRowHead.find(".t-row").each(function(i,a){var s=t.$table.find(".t-row").eq(i);e(a).outerHeight(s.outerHeight())}),this.$stickyRowHead.children(".t-head").children("tr.t-row").each(function(t,i){e(i).children(".th-cell").not(".group-head").remove()}),this.$stickyRowHead.find(".t-body .td-cell").remove(),e('<div class="table-sticky-row-head"/>').css({height:this.$tableScroller[0].clientHeight}).append(this.$stickyRowHead).appendTo(this.$wrapper),this.$stickyIntersect=e('<table cellpadding="0" cellspacing="0" class="'+i.tableClass+' x-table-bordered x-table-striped"/>').append(this.$stickyRowHead.children(".t-head").clone(!0)),e('<div class="table-sticky-intersect"/>').append(this.$stickyIntersect).appendTo(this.$wrapper))},_scrollStickyHead:function(){var e=this.options,t=this.$tableScroller.scrollTop(),i=this.$tableScroller.scrollLeft();!1===FX.Utils.applyFunc(this,e.onScroll,[i,t],!1)&&(this.$stickyHead&&this.$stickyHead.css({"margin-left":-i}),this.$stickyRowHead&&this.$stickyRowHead.css({"margin-top":-t}))},_removeTable:function(){this.$wrapper.children().remove(),this.$menu&&this.$menu.children().remove()},doFullScreen:function(){var e=this.options;return this.element.hasClass(e.cls4FullScreen)?(this.element.removeClass(e.cls4FullScreen),this.doResize({width:FX.Utils.isEmpty(this.originStyle.w)?"auto":this.originStyle.w,height:FX.Utils.isEmpty(this.originStyle.h)?"auto":this.originStyle.h}),this._setFilterSticky(this._isFilterSticky(),!1),!1):(this.originStyle={w:this.element.outerWidth(),h:e.height},this.element.addClass(e.cls4FullScreen),this.doResize({width:document.body.clientWidth,height:document.body.clientHeight}),this._setFilterSticky(!1,!1),!0)},setFields:function(t,i){var a=this.options,s=[],n=!0;FX.Utils.forEach(a.showFields,function(i,a){if(t.indexOf(a.name)>=0)s.push(a);else if("subform"===a.type){var o=e.extend(!0,{},a),l=[];FX.Utils.forEach(o.items,function(e,i){t.indexOf([o.name,i.name].join("."))>=0?l.push(i):n=!1}),o.items=l,FX.Utils.isObjectEmpty(o.items)||s.push(o)}else n=!1}),a.fields=s,i.toggleClass("active",!n);this._reloadWithoutCount(null,!0)},doShowFields:function(e){var t=this.options,i=this;if(!this.fieldCheck){this.fieldItems=FX.Utils.addClsToSystemField(this.fieldItems,"field-system");var a=new FX.ComboCheckBox({renderEl:e,items:this.fieldItems,width:null,height:null,onStopEdit:function(){i.setFields(this.getValue(),e)},onAfterTriggerHide:function(){FX.Utils.applyFunc(i,t.onAfterShowFieldsSelected,[this.getValue()],!1)},onElementCreate:function(){return!0},onAfterItemCreate:function(e,t,i){i.addClass(e.cls)}});this.fieldCheck=a,this.fieldCheck._onTriggerClick()}}})}(jQuery),function(e){FX.DataCountPane=FX.extend(FX.Widget,{_defaultConfig:function(){return e.extend(FX.DataCountPane.superclass._defaultConfig.apply(this,arguments),{baseCls:"fx_data_count",itemsPerPage:20,count:0,hasTotalCount:!1,totalCount:0,onItemPerPageChange:null,async:null})},_init:function(){FX.DataCountPane.superclass._init.apply(this,arguments);var t=this,i=this.options;new FX.ComboBox({renderEl:e('<div class="count-sel"/>').appendTo(this.element),width:116,height:30,searchable:!1,allowBlank:!1,items:[{value:20,text:"20 条/页"},{value:50,text:"50 条/页"},{value:100,text:"100 条/页"}],value:i.itemsPerPage,onAfterItemSelect:function(e,a){FX.Utils.applyFunc(t,i.onItemPerPageChange,[a.value],!1)}}),i.hasTotalCount?this._createCountWithFilter():this._createFilterCount(),this._bindEvents()},_createCountWithFilter:function(){var t=this.options;this.$count=e("<span/>").appendTo(this.element),e('<span class="count '+(t.count>FX.CONST.MAX_COUNT?"clickable":"")+'"/>').text("筛选出"+this._formatCount(t.count)+"条").appendTo(this.$count),e("<span/>").text(" / ").appendTo(this.$count),e('<span class="count total '+(t.totalCount>FX.CONST.MAX_COUNT?"clickable":"")+'"/>').text("共"+this._formatCount(t.totalCount)+"条").appendTo(this.$count)},_createFilterCount:function(){var t=this.options;this.$count=e('<span class="count '+(t.count>FX.CONST.MAX_COUNT?"clickable":"")+'"/>').text("共"+this._formatCount(t.count)+"条").appendTo(this.element)},_formatCount:function(e){return e>FX.CONST.MAX_COUNT?FX.CONST.MAX_COUNT+"+":e+""},_bindEvents:function(){var t=this.options,i=this;this.$count.on("click",function(a){var s=e(a.target);if(s.hasClass("count")&&s.hasClass("clickable")){s.removeClass("clickable").text("正在查询...");var n=e.extend({},t.async),o=s.hasClass("total");o&&n.data&&(n.data=e.extend({},n.data,{hasTotalCount:!0})),FX.Utils.dataAjax(n,function(e){var t=o?e.totalCount:e.count;i._setCountText(s,t+"")},function(){s.addClass("clickable"),i._setCountText(s,FX.CONST.MAX_COUNT+"+")})}})},_setCountText:function(e,t){this.options.hasTotalCount?e.hasClass("total")?e.text("共"+t+"条"):e.text("筛选出"+t+"条"):e.text("共"+t+"条")}})}(jQuery);